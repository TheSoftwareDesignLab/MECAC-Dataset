diff --git a/app/src/main/java/io/homeassistant/companion/android/settings/widgets/ManageWidgetsViewModel.kt b/app/src/main/java/io/homeassistant/companion/android/settings/widgets/ManageWidgetsViewModel.kt
index 0bfd96dd4b1..f16f09d6a0c 100755
--- a/app/src/main/java/io/homeassistant/companion/android/settings/widgets/ManageWidgetsViewModel.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/settings/widgets/ManageWidgetsViewModel.kt
@@ -5,18 +5,12 @@ import android.appwidget.AppWidgetManager
 import android.os.Build
 import android.os.RemoteException
 import android.util.Log
-import androidx.compose.runtime.mutableStateListOf
+import androidx.compose.runtime.State
 import androidx.compose.runtime.mutableStateOf
 import androidx.core.content.getSystemService
 import androidx.lifecycle.AndroidViewModel
 import androidx.lifecycle.viewModelScope
-import io.homeassistant.companion.android.HomeAssistantApplication
 import io.homeassistant.companion.android.database.AppDatabase
-import io.homeassistant.companion.android.database.widget.ButtonWidgetEntity
-import io.homeassistant.companion.android.database.widget.CameraWidgetEntity
-import io.homeassistant.companion.android.database.widget.MediaPlayerControlsWidgetEntity
-import io.homeassistant.companion.android.database.widget.StaticWidgetEntity
-import io.homeassistant.companion.android.database.widget.TemplateWidgetEntity
 import kotlinx.coroutines.flow.Flow
 import kotlinx.coroutines.launch
 import javax.inject.Inject
@@ -34,98 +28,43 @@ class ManageWidgetsViewModel @Inject constructor(
     }
 
     private val buttonWidgetDao = AppDatabase.getInstance(application).buttonWidgetDao()
-    private fun buttonWidgetFlow(): Flow<List<ButtonWidgetEntity>>? = buttonWidgetDao.getAllFlow()
     private val cameraWidgetDao = AppDatabase.getInstance(application).cameraWidgetDao()
-    private fun cameraWidgetFlow(): Flow<List<CameraWidgetEntity>>? = cameraWidgetDao.getAllFlow()
     private val staticWidgetDao = AppDatabase.getInstance(application).staticWidgetDao()
-    private fun staticWidgetFlow(): Flow<List<StaticWidgetEntity>>? = staticWidgetDao.getAllFlow()
     private val mediaPlayerControlsWidgetDao = AppDatabase.getInstance(application).mediaPlayCtrlWidgetDao()
-    private fun mediaWidgetFlow(): Flow<List<MediaPlayerControlsWidgetEntity>>? = mediaPlayerControlsWidgetDao.getAllFlow()
     private val templateWidgetDao = AppDatabase.getInstance(application).templateWidgetDao()
-    private fun templateWidgetFlow(): Flow<List<TemplateWidgetEntity>>? = templateWidgetDao.getAllFlow()
 
-    var buttonWidgetList = mutableStateListOf<ButtonWidgetEntity>()
-        private set
-    var cameraWidgetList = mutableStateListOf<CameraWidgetEntity>()
-        private set
-    var staticWidgetList = mutableStateListOf<StaticWidgetEntity>()
-        private set
-    var mediaWidgetList = mutableStateListOf<MediaPlayerControlsWidgetEntity>()
-        private set
-    var templateWidgetList = mutableStateListOf<TemplateWidgetEntity>()
-        private set
+    val buttonWidgetList = buttonWidgetDao.getAllFlow().collectAsState()
+    val cameraWidgetList = cameraWidgetDao.getAllFlow().collectAsState()
+    val staticWidgetList = staticWidgetDao.getAllFlow().collectAsState()
+    val mediaWidgetList = mediaPlayerControlsWidgetDao.getAllFlow().collectAsState()
+    val templateWidgetList = templateWidgetDao.getAllFlow().collectAsState()
     var supportsAddingWidgets = mutableStateOf(false)
         private set
 
     init {
-        buttonWidgetList()
-        cameraWidgetList()
-        staticWidgetList()
-        mediaWidgetList()
-        templateWidgetList()
-        checkSupportsAddingWidgets()
-    }
-
-    private fun buttonWidgetList() {
-        viewModelScope.launch {
-            buttonWidgetFlow()?.collect {
-                buttonWidgetList.clear()
-                it.forEach { widget ->
-                    buttonWidgetList.add(widget)
-                }
-            }
-        }
-    }
-    private fun cameraWidgetList() {
-        viewModelScope.launch {
-            cameraWidgetFlow()?.collect {
-                cameraWidgetList.clear()
-                it.forEach { widget ->
-                    cameraWidgetList.add(widget)
-                }
-            }
-        }
-    }
-    private fun staticWidgetList() {
-        viewModelScope.launch {
-            staticWidgetFlow()?.collect {
-                staticWidgetList.clear()
-                it.forEach { widget ->
-                    staticWidgetList.add(widget)
-                }
-            }
-        }
-    }
-    private fun mediaWidgetList() {
-        viewModelScope.launch {
-            mediaWidgetFlow()?.collect {
-                mediaWidgetList.clear()
-                it.forEach { widget ->
-                    mediaWidgetList.add(widget)
-                }
-            }
-        }
-    }
-    private fun templateWidgetList() {
-        viewModelScope.launch {
-            templateWidgetFlow()?.collect {
-                templateWidgetList.clear()
-                it.forEach { widget ->
-                    templateWidgetList.add(widget)
-                }
-            }
-        }
+        supportsAddingWidgets.value = checkSupportsAddingWidgets()
     }
 
-    private fun checkSupportsAddingWidgets() {
+    private fun checkSupportsAddingWidgets(): Boolean {
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
-            val appWidgetManager = getApplication<HomeAssistantApplication>().getSystemService<AppWidgetManager>()
-            supportsAddingWidgets.value = try {
-                appWidgetManager?.isRequestPinAppWidgetSupported ?: false
+            val appWidgetManager = getApplication<Application>().getSystemService<AppWidgetManager>()
+            try {
+                return appWidgetManager?.isRequestPinAppWidgetSupported ?: false
             } catch (e: RemoteException) {
                 Log.e(TAG, "Unable to read isRequestPinAppWidgetSupported", e)
-                false
             }
         }
+        return false
+    }
+
+    /**
+     * Convert a Flow into a State object that updates until the view model is cleared.
+     */
+    private fun <T> Flow<List<T>>.collectAsState(): State<List<T>> {
+        val state = mutableStateOf(emptyList<T>())
+        viewModelScope.launch {
+            collect { state.value = it }
+        }
+        return state
     }
 }
diff --git a/app/src/main/java/io/homeassistant/companion/android/settings/widgets/views/ManageWidgetsView.kt b/app/src/main/java/io/homeassistant/companion/android/settings/widgets/views/ManageWidgetsView.kt
index e6e863dbeec..ffd74e19f50 100755
--- a/app/src/main/java/io/homeassistant/companion/android/settings/widgets/views/ManageWidgetsView.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/settings/widgets/views/ManageWidgetsView.kt
@@ -2,6 +2,7 @@ package io.homeassistant.companion.android.settings.widgets.views
 
 import android.appwidget.AppWidgetManager
 import android.content.Intent
+import androidx.annotation.StringRes
 import androidx.compose.foundation.clickable
 import androidx.compose.foundation.layout.Arrangement
 import androidx.compose.foundation.layout.Box
@@ -12,6 +13,7 @@ import androidx.compose.foundation.layout.fillMaxWidth
 import androidx.compose.foundation.layout.padding
 import androidx.compose.foundation.layout.size
 import androidx.compose.foundation.lazy.LazyColumn
+import androidx.compose.foundation.lazy.LazyListScope
 import androidx.compose.material.Button
 import androidx.compose.material.ExtendedFloatingActionButton
 import androidx.compose.material.Icon
@@ -37,6 +39,7 @@ import com.mikepenz.iconics.compose.Image
 import com.mikepenz.iconics.typeface.IIcon
 import com.mikepenz.iconics.typeface.library.community.material.CommunityMaterial
 import io.homeassistant.companion.android.common.R
+import io.homeassistant.companion.android.database.widget.WidgetEntity
 import io.homeassistant.companion.android.settings.widgets.ManageWidgetsViewModel
 import io.homeassistant.companion.android.util.compose.MdcAlertDialog
 import io.homeassistant.companion.android.widgets.button.ButtonWidgetConfigureActivity
@@ -45,6 +48,22 @@ import io.homeassistant.companion.android.widgets.entity.EntityWidgetConfigureAc
 import io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidgetConfigureActivity
 import io.homeassistant.companion.android.widgets.template.TemplateWidgetConfigureActivity
 
+enum class WidgetType(val widgetIcon: IIcon) {
+    BUTTON(CommunityMaterial.Icon2.cmd_gesture_tap),
+    CAMERA(CommunityMaterial.Icon.cmd_camera),
+    STATE(CommunityMaterial.Icon3.cmd_shape),
+    MEDIA(CommunityMaterial.Icon3.cmd_play_box_multiple),
+    TEMPLATE(CommunityMaterial.Icon.cmd_code_braces);
+
+    fun configureActivity() = when (this) {
+        BUTTON -> ButtonWidgetConfigureActivity::class.java
+        CAMERA -> CameraWidgetConfigureActivity::class.java
+        MEDIA -> MediaPlayerControlsWidgetConfigureActivity::class.java
+        STATE -> EntityWidgetConfigureActivity::class.java
+        TEMPLATE -> TemplateWidgetConfigureActivity::class.java
+    }
+}
+
 @Composable
 fun ManageWidgetsView(
     viewModel: ManageWidgetsViewModel
@@ -62,23 +81,23 @@ fun ManageWidgetsView(
         }
     }) {
         if (expandedAddWidget) {
-            val availableWidgets = mapOf(
-                stringResource(R.string.widget_button_image_description) to Pair("button", CommunityMaterial.Icon2.cmd_gesture_tap),
-                stringResource(R.string.widget_camera_description) to Pair("camera", CommunityMaterial.Icon.cmd_camera),
-                stringResource(R.string.widget_static_image_description) to Pair("state", CommunityMaterial.Icon3.cmd_shape),
-                stringResource(R.string.widget_media_player_description) to Pair("media", CommunityMaterial.Icon3.cmd_play_box_multiple),
-                stringResource(R.string.template_widget) to Pair("template", CommunityMaterial.Icon.cmd_code_braces)
-            ).toSortedMap(compareBy { it })
+            val availableWidgets = listOf(
+                stringResource(R.string.widget_button_image_description) to WidgetType.BUTTON,
+                stringResource(R.string.widget_camera_description) to WidgetType.CAMERA,
+                stringResource(R.string.widget_static_image_description) to WidgetType.STATE,
+                stringResource(R.string.widget_media_player_description) to WidgetType.MEDIA,
+                stringResource(R.string.template_widget) to WidgetType.TEMPLATE
+            ).sortedBy { it.first }
+
             MdcAlertDialog(
                 onDismissRequest = { expandedAddWidget = false },
                 title = { Text(stringResource(R.string.add_widget)) },
                 content = {
                     LazyColumn {
-                        availableWidgets.forEach {
-                            item {
-                                PopupWidgetRow(widgetLabel = it.key, widgetIcon = it.value.second, widgetType = it.value.first) {
-                                    expandedAddWidget = false
-                                }
+                        items(availableWidgets.size) { index ->
+                            val (key, widgetType) = availableWidgets[index]
+                            PopupWidgetRow(widgetLabel = key, widgetType = widgetType) {
+                                expandedAddWidget = false
                             }
                         }
                     }
@@ -88,15 +107,17 @@ fun ManageWidgetsView(
             )
         }
         LazyColumn(modifier = Modifier.padding(all = 16.dp)) {
-            if (viewModel.buttonWidgetList.isNullOrEmpty() && viewModel.staticWidgetList.isNullOrEmpty() &&
-                viewModel.mediaWidgetList.isNullOrEmpty() && viewModel.templateWidgetList.isNullOrEmpty() &&
-                viewModel.cameraWidgetList.isNullOrEmpty()
+            if (viewModel.buttonWidgetList.value.isEmpty() && viewModel.staticWidgetList.value.isEmpty() &&
+                viewModel.mediaWidgetList.value.isEmpty() && viewModel.templateWidgetList.value.isEmpty() &&
+                viewModel.cameraWidgetList.value.isEmpty()
             ) {
                 item {
                     Column(
                         verticalArrangement = Arrangement.Center,
                         horizontalAlignment = Alignment.CenterHorizontally,
-                        modifier = Modifier.fillMaxWidth().padding(top = 64.dp)
+                        modifier = Modifier
+                            .fillMaxWidth()
+                            .padding(top = 64.dp)
                     ) {
                         Icon(
                             imageVector = Icons.Default.Widgets,
@@ -107,7 +128,9 @@ fun ManageWidgetsView(
                             text = stringResource(id = R.string.no_widgets),
                             style = MaterialTheme.typography.h6,
                             textAlign = TextAlign.Center,
-                            modifier = Modifier.fillMaxWidth(0.7f).padding(top = 8.dp)
+                            modifier = Modifier
+                                .fillMaxWidth(0.7f)
+                                .padding(top = 8.dp)
                         )
                         Text(
                             text = stringResource(id = R.string.no_widgets_summary),
@@ -117,92 +140,91 @@ fun ManageWidgetsView(
                     }
                 }
             }
-            if (!viewModel.buttonWidgetList.isNullOrEmpty()) {
-                item {
-                    Text(stringResource(id = R.string.button_widgets))
-                }
-                items(viewModel.buttonWidgetList.size) { index ->
-                    val item = viewModel.buttonWidgetList[index]
-                    val label = if (!item.label.isNullOrEmpty()) item.label else "${item.domain}.${item.service}"
-                    WidgetRow(widgetLabel = label.toString(), widgetId = item.id, widgetType = "button")
-                }
-            }
-            if (!viewModel.cameraWidgetList.isNullOrEmpty()) {
-                item {
-                    Text(stringResource(id = R.string.camera_widgets))
-                }
-                items(viewModel.cameraWidgetList.size) { index ->
-                    val item = viewModel.cameraWidgetList[index]
-                    WidgetRow(widgetLabel = item.entityId, widgetId = item.id, widgetType = "camera")
-                }
-            }
-            if (!viewModel.staticWidgetList.isNullOrEmpty()) {
-                item {
-                    Text(stringResource(id = R.string.entity_state_widgets))
-                }
-                items(viewModel.staticWidgetList.size) { index ->
-                    val item = viewModel.staticWidgetList[index]
-                    val label = if (!item.label.isNullOrEmpty()) item.label else "${item.entityId} ${item.stateSeparator} ${item?.attributeIds ?: ""}"
-                    WidgetRow(widgetLabel = label.toString(), widgetId = item.id, widgetType = "state")
-                }
-            }
-            if (!viewModel.mediaWidgetList.isNullOrEmpty()) {
-                item {
-                    Text(stringResource(id = R.string.media_player_widgets))
-                }
-                items(viewModel.mediaWidgetList.size) { index ->
-                    val item = viewModel.mediaWidgetList[index]
-                    val label = if (!item.label.isNullOrEmpty()) item.label else item.entityId
-                    WidgetRow(widgetLabel = label.toString(), widgetId = item.id, widgetType = "media")
-                }
-            }
-            if (!viewModel.templateWidgetList.isNullOrEmpty()) {
-                item {
-                    Text(stringResource(id = R.string.template_widgets))
-                }
-                items(viewModel.templateWidgetList.size) { index ->
-                    val item = viewModel.templateWidgetList[index]
-                    WidgetRow(widgetLabel = item.template, widgetId = item.id, widgetType = "template")
-                }
-            }
+            widgetItems(
+                viewModel.buttonWidgetList.value,
+                widgetType = WidgetType.BUTTON,
+                title = R.string.button_widgets,
+                widgetLabel = { item ->
+                    val label = item.label
+                    if (!label.isNullOrEmpty()) label else "${item.domain}.${item.service}"
+                },
+            )
+            widgetItems(
+                viewModel.cameraWidgetList.value,
+                widgetType = WidgetType.CAMERA,
+                title = R.string.camera_widgets,
+                widgetLabel = { item -> item.entityId },
+            )
+            widgetItems(
+                viewModel.staticWidgetList.value,
+                widgetType = WidgetType.STATE,
+                title = R.string.entity_state_widgets,
+                widgetLabel = { item ->
+                    val label = item.label
+                    if (!label.isNullOrEmpty()) label else "${item.entityId} ${item.stateSeparator} ${item.attributeIds.orEmpty()}"
+                },
+            )
+            widgetItems(
+                viewModel.mediaWidgetList.value,
+                widgetType = WidgetType.MEDIA,
+                title = R.string.media_player_widgets,
+                widgetLabel = { item ->
+                    val label = item.label
+                    if (!label.isNullOrEmpty()) label else item.entityId
+                },
+            )
+            widgetItems(
+                viewModel.templateWidgetList.value,
+                widgetType = WidgetType.TEMPLATE,
+                title = R.string.template_widgets,
+                widgetLabel = { item -> item.template },
+            )
+        }
+    }
+}
+
+private fun <T : WidgetEntity> LazyListScope.widgetItems(
+    widgetList: List<T>,
+    @StringRes title: Int,
+    widgetLabel: @Composable (T) -> String,
+    widgetType: WidgetType
+) {
+    if (widgetList.isNotEmpty()) {
+        item {
+            Text(stringResource(id = title))
+        }
+        items(widgetList.size, key = { index -> widgetList[index].id }) { index ->
+            val item = widgetList[index]
+            WidgetRow(widgetLabel = widgetLabel(item), widgetId = item.id, widgetType = widgetType)
         }
     }
 }
 
 @Composable
-fun PopupWidgetRow(
+private fun PopupWidgetRow(
     widgetLabel: String,
-    widgetIcon: IIcon,
-    widgetType: String,
+    widgetType: WidgetType,
     onClickCallback: () -> Unit
 ) {
     val context = LocalContext.current
     Box(
-        modifier = Modifier.fillMaxWidth().clickable {
-            val intent = Intent(
-                context,
-                when (widgetType) {
-                    "button" -> ButtonWidgetConfigureActivity::class.java
-                    "camera" -> CameraWidgetConfigureActivity::class.java
-                    "media" -> MediaPlayerControlsWidgetConfigureActivity::class.java
-                    "state" -> EntityWidgetConfigureActivity::class.java
-                    "template" -> TemplateWidgetConfigureActivity::class.java
-                    else -> ButtonWidgetConfigureActivity::class.java // We will never reach this
+        modifier = Modifier
+            .fillMaxWidth()
+            .clickable {
+                val intent = Intent(context, widgetType.configureActivity()).apply {
+                    putExtra(ManageWidgetsViewModel.CONFIGURE_REQUEST_LAUNCHER, true)
+                    addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP)
                 }
-            ).apply {
-                putExtra(ManageWidgetsViewModel.CONFIGURE_REQUEST_LAUNCHER, true)
-                addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP)
+                context.startActivity(intent)
+                onClickCallback()
             }
-            context.startActivity(intent)
-            onClickCallback()
-        }
     ) {
         Row(
             modifier = Modifier.padding(horizontal = 24.dp, vertical = 16.dp),
             verticalAlignment = Alignment.CenterVertically
         ) {
             Image(
-                asset = widgetIcon,
+                asset = widgetType.widgetIcon,
                 colorFilter = ColorFilter.tint(MaterialTheme.colors.onSurface),
                 contentDescription = widgetLabel
             )
@@ -212,25 +234,15 @@ fun PopupWidgetRow(
 }
 
 @Composable
-fun WidgetRow(
+private fun WidgetRow(
     widgetLabel: String,
     widgetId: Int,
-    widgetType: String
+    widgetType: WidgetType,
 ) {
     val context = LocalContext.current
     Row {
         Button(onClick = {
-            val intent = Intent(
-                context,
-                when (widgetType) {
-                    "button" -> ButtonWidgetConfigureActivity::class.java
-                    "camera" -> CameraWidgetConfigureActivity::class.java
-                    "media" -> MediaPlayerControlsWidgetConfigureActivity::class.java
-                    "state" -> EntityWidgetConfigureActivity::class.java
-                    "template" -> TemplateWidgetConfigureActivity::class.java
-                    else -> ButtonWidgetConfigureActivity::class.java // We will never reach this
-                }
-            ).apply {
+            val intent = Intent(context, widgetType.configureActivity()).apply {
                 putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, widgetId)
             }
             context.startActivity(intent)
diff --git a/app/src/main/java/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt b/app/src/main/java/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt
index b7295f1073e..32528c9b360 100644
--- a/app/src/main/java/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt
@@ -89,7 +89,7 @@ abstract class BaseWidgetProvider : AppWidgetProvider() {
         entityUpdates = null
     }
 
-    private fun updateAllWidgets(
+    private suspend fun updateAllWidgets(
         context: Context
     ) {
         getAllWidgetIds(context).forEach {
@@ -109,7 +109,7 @@ abstract class BaseWidgetProvider : AppWidgetProvider() {
     }
 
     abstract suspend fun getWidgetRemoteViews(context: Context, appWidgetId: Int, suggestedEntity: Entity<Map<String, Any>>? = null): RemoteViews
-    abstract fun getAllWidgetIds(context: Context): List<Int>
+    abstract suspend fun getAllWidgetIds(context: Context): List<Int>
     abstract fun saveEntityConfiguration(context: Context, extras: Bundle?, appWidgetId: Int)
-    abstract fun onEntityStateChanged(context: Context, entity: Entity<*>)
+    abstract suspend fun onEntityStateChanged(context: Context, entity: Entity<*>)
 }
diff --git a/app/src/main/java/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt b/app/src/main/java/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt
index 336bc130f7d..9bfca83dfd6 100644
--- a/app/src/main/java/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt
@@ -75,9 +75,9 @@ class ButtonWidget : AppWidgetProvider() {
 
     private fun updateAllWidgets(
         context: Context,
-        buttonWidgetEntityList: List<ButtonWidgetEntity>?
+        buttonWidgetEntityList: List<ButtonWidgetEntity>
     ) {
-        if (buttonWidgetEntityList != null) {
+        if (buttonWidgetEntityList.isNotEmpty()) {
             Log.d(TAG, "Updating all widgets")
             val appWidgetManager = AppWidgetManager.getInstance(context)
             for (item in buttonWidgetEntityList) {
@@ -99,8 +99,8 @@ class ButtonWidget : AppWidgetProvider() {
     override fun onDeleted(context: Context, appWidgetIds: IntArray) {
         buttonWidgetDao = AppDatabase.getInstance(context).buttonWidgetDao()
         // When the user deletes the widget, delete the preference associated with it.
-        for (appWidgetId in appWidgetIds) {
-            buttonWidgetDao.delete(appWidgetId)
+        mainScope.launch {
+            buttonWidgetDao.deleteAll(appWidgetIds)
         }
     }
 
@@ -124,13 +124,12 @@ class ButtonWidget : AppWidgetProvider() {
         )
 
         buttonWidgetDao = AppDatabase.getInstance(context).buttonWidgetDao()
-        val buttonWidgetList = buttonWidgetDao.getAll()
 
         super.onReceive(context, intent)
         when (action) {
             CALL_SERVICE -> callConfiguredService(context, appWidgetId)
             RECEIVE_DATA -> saveServiceCallConfiguration(context, intent.extras, appWidgetId)
-            Intent.ACTION_SCREEN_ON -> updateAllWidgets(context, buttonWidgetList)
+            Intent.ACTION_SCREEN_ON -> updateAllWidgets(context, buttonWidgetDao.getAll())
         }
     }
 
diff --git a/app/src/main/java/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt b/app/src/main/java/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt
index cc698114561..b9aa47ede96 100755
--- a/app/src/main/java/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt
@@ -85,9 +85,9 @@ class CameraWidget : AppWidgetProvider() {
 
     private fun updateAllWidgets(
         context: Context,
-        cameraWidgetList: Array<CameraWidgetEntity>?
+        cameraWidgetList: List<CameraWidgetEntity>
     ) {
-        if (cameraWidgetList != null) {
+        if (cameraWidgetList.isNotEmpty()) {
             Log.d(TAG, "Updating all widgets")
             for (item in cameraWidgetList) {
                 updateAppWidget(context, item.id)
@@ -193,13 +193,12 @@ class CameraWidget : AppWidgetProvider() {
         )
 
         cameraWidgetDao = AppDatabase.getInstance(context).cameraWidgetDao()
-        val cameraWidgetList = cameraWidgetDao.getAll()
 
         super.onReceive(context, intent)
         when (lastIntent) {
             RECEIVE_DATA -> saveEntityConfiguration(context, intent.extras, appWidgetId)
             UPDATE_IMAGE -> updateAppWidget(context, appWidgetId)
-            Intent.ACTION_SCREEN_ON -> updateAllWidgets(context, cameraWidgetList)
+            Intent.ACTION_SCREEN_ON -> updateAllWidgets(context, cameraWidgetDao.getAll())
         }
     }
 
@@ -233,8 +232,8 @@ class CameraWidget : AppWidgetProvider() {
     override fun onDeleted(context: Context, appWidgetIds: IntArray) {
         cameraWidgetDao = AppDatabase.getInstance(context).cameraWidgetDao()
         // When the user deletes the widget, delete the preference associated with it.
-        for (appWidgetId in appWidgetIds) {
-            cameraWidgetDao.delete(appWidgetId)
+        mainScope.launch {
+            cameraWidgetDao.deleteAll(appWidgetIds)
         }
     }
 
diff --git a/app/src/main/java/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt b/app/src/main/java/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt
index 8c3258887f8..d4cc1c8f684 100644
--- a/app/src/main/java/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt
@@ -89,8 +89,8 @@ class EntityWidget : BaseWidgetProvider() {
         return views
     }
 
-    override fun getAllWidgetIds(context: Context): List<Int> {
-        return AppDatabase.getInstance(context).staticWidgetDao().getAll()?.map { it.id }.orEmpty()
+    override suspend fun getAllWidgetIds(context: Context): List<Int> {
+        return AppDatabase.getInstance(context).staticWidgetDao().getAll().map { it.id }
     }
 
     private suspend fun resolveTextToShow(
@@ -180,8 +180,8 @@ class EntityWidget : BaseWidgetProvider() {
         }
     }
 
-    override fun onEntityStateChanged(context: Context, entity: Entity<*>) {
-        AppDatabase.getInstance(context).staticWidgetDao().getAll().orEmpty().forEach {
+    override suspend fun onEntityStateChanged(context: Context, entity: Entity<*>) {
+        AppDatabase.getInstance(context).staticWidgetDao().getAll().forEach {
             if (it.entityId == entity.entityId) {
                 mainScope.launch {
                     val views = getWidgetRemoteViews(context, it.id, entity as Entity<Map<String, Any>>)
@@ -193,8 +193,8 @@ class EntityWidget : BaseWidgetProvider() {
 
     override fun onDeleted(context: Context, appWidgetIds: IntArray) {
         val staticWidgetDao = AppDatabase.getInstance(context).staticWidgetDao()
-        appWidgetIds.forEach { appWidgetId ->
-            staticWidgetDao.delete(appWidgetId)
+        mainScope.launch {
+            staticWidgetDao.deleteAll(appWidgetIds)
         }
     }
 }
diff --git a/app/src/main/java/io/homeassistant/companion/android/widgets/media_player_controls/MediaPlayerControlsWidget.kt b/app/src/main/java/io/homeassistant/companion/android/widgets/media_player_controls/MediaPlayerControlsWidget.kt
index 8a799e6feba..b55ea040e2a 100644
--- a/app/src/main/java/io/homeassistant/companion/android/widgets/media_player_controls/MediaPlayerControlsWidget.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/widgets/media_player_controls/MediaPlayerControlsWidget.kt
@@ -381,8 +381,8 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
         }
     }
 
-    override fun getAllWidgetIds(context: Context): List<Int> {
-        return AppDatabase.getInstance(context).mediaPlayCtrlWidgetDao().getAll()?.map { it.id }.orEmpty()
+    override suspend fun getAllWidgetIds(context: Context): List<Int> {
+        return AppDatabase.getInstance(context).mediaPlayCtrlWidgetDao().getAll().map { it.id }
     }
 
     private suspend fun getEntity(context: Context, entityId: String, suggestedEntity: Entity<Map<String, Any>>?): Entity<Map<String, Any>>? {
@@ -472,8 +472,8 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
         }
     }
 
-    override fun onEntityStateChanged(context: Context, entity: Entity<*>) {
-        AppDatabase.getInstance(context).mediaPlayCtrlWidgetDao().getAll().orEmpty().forEach {
+    override suspend fun onEntityStateChanged(context: Context, entity: Entity<*>) {
+        AppDatabase.getInstance(context).mediaPlayCtrlWidgetDao().getAll().forEach {
             if (it.entityId == entity.entityId) {
                 mainScope.launch {
                     val views = getWidgetRemoteViews(context, it.id, entity as Entity<Map<String, Any>>)
@@ -699,8 +699,8 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     override fun onDeleted(context: Context, appWidgetIds: IntArray) {
         mediaPlayCtrlWidgetDao = AppDatabase.getInstance(context).mediaPlayCtrlWidgetDao()
         // When the user deletes the widget, delete the preference associated with it.
-        for (appWidgetId in appWidgetIds) {
-            mediaPlayCtrlWidgetDao.delete(appWidgetId)
+        mainScope.launch {
+            mediaPlayCtrlWidgetDao.deleteAll(appWidgetIds)
         }
     }
 
diff --git a/app/src/main/java/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt b/app/src/main/java/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt
index 59fa6b2c42a..10dc9249e06 100644
--- a/app/src/main/java/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt
+++ b/app/src/main/java/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt
@@ -27,14 +27,14 @@ class TemplateWidget : BaseWidgetProvider() {
     override fun onDeleted(context: Context, appWidgetIds: IntArray) {
         val templateWidgetDao = AppDatabase.getInstance(context).templateWidgetDao()
         // When the user deletes the widget, delete the preference associated with it.
-        for (appWidgetId in appWidgetIds) {
-            templateWidgetDao.delete(appWidgetId)
+        mainScope.launch {
+            templateWidgetDao.deleteAll(appWidgetIds)
         }
     }
 
-    override fun getAllWidgetIds(context: Context): List<Int> {
+    override suspend fun getAllWidgetIds(context: Context): List<Int> {
         val templateWidgetDao = AppDatabase.getInstance(context).templateWidgetDao()
-        return templateWidgetDao.getAll()?.map { it.id }.orEmpty()
+        return templateWidgetDao.getAll().map { it.id }
     }
 
     override suspend fun getWidgetRemoteViews(context: Context, appWidgetId: Int, suggestedEntity: Entity<Map<String, Any>>?): RemoteViews {
@@ -103,7 +103,7 @@ class TemplateWidget : BaseWidgetProvider() {
         }
     }
 
-    override fun onEntityStateChanged(context: Context, entity: Entity<*>) {
+    override suspend fun onEntityStateChanged(context: Context, entity: Entity<*>) {
         getAllWidgetIds(context).forEach { appWidgetId ->
             val intent = Intent(context, TemplateWidget::class.java).apply {
                 action = UPDATE_VIEW
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt
index 945c72409f2..34dbbd76a1e 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt
@@ -4,7 +4,6 @@ import androidx.room.Dao
 import androidx.room.Insert
 import androidx.room.OnConflictStrategy
 import androidx.room.Query
-import androidx.room.Update
 import kotlinx.coroutines.flow.Flow
 
 @Dao
@@ -14,17 +13,17 @@ interface ButtonWidgetDao {
     fun get(id: Int): ButtonWidgetEntity?
 
     @Insert(onConflict = OnConflictStrategy.REPLACE)
-    fun add(buttonWidgetEntity: ButtonWidgetEntity)
-
-    @Update
-    fun update(buttonWidgetEntity: ButtonWidgetEntity)
+    suspend fun add(buttonWidgetEntity: ButtonWidgetEntity)
 
     @Query("DELETE FROM button_widgets WHERE id = :id")
     fun delete(id: Int)
 
+    @Query("DELETE FROM button_widgets WHERE id IN (:ids)")
+    suspend fun deleteAll(ids: IntArray)
+
     @Query("SELECT * FROM button_widgets")
-    fun getAll(): List<ButtonWidgetEntity>?
+    fun getAll(): List<ButtonWidgetEntity>
 
     @Query("SELECT * FROM button_widgets")
-    fun getAllFlow(): Flow<List<ButtonWidgetEntity>>?
+    fun getAllFlow(): Flow<List<ButtonWidgetEntity>>
 }
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetEntity.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetEntity.kt
index 69a69d3cb76..4009927b3f2 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetEntity.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/ButtonWidgetEntity.kt
@@ -7,7 +7,7 @@ import androidx.room.PrimaryKey
 @Entity(tableName = "button_widgets")
 data class ButtonWidgetEntity(
     @PrimaryKey
-    val id: Int,
+    override val id: Int,
     @ColumnInfo(name = "icon_id")
     val iconId: Int,
     @ColumnInfo(name = "domain")
@@ -18,4 +18,4 @@ data class ButtonWidgetEntity(
     val serviceData: String,
     @ColumnInfo(name = "label")
     val label: String?
-)
+) : WidgetEntity
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt
index 860dbbb25e6..76c886c65d0 100755
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt
@@ -4,7 +4,6 @@ import androidx.room.Dao
 import androidx.room.Insert
 import androidx.room.OnConflictStrategy
 import androidx.room.Query
-import androidx.room.Update
 import kotlinx.coroutines.flow.Flow
 
 @Dao
@@ -14,17 +13,17 @@ interface CameraWidgetDao {
     fun get(id: Int): CameraWidgetEntity?
 
     @Insert(onConflict = OnConflictStrategy.REPLACE)
-    fun add(cameraWidgetEntity: CameraWidgetEntity)
-
-    @Update
-    fun update(cameraWidgetEntity: CameraWidgetEntity)
+    suspend fun add(cameraWidgetEntity: CameraWidgetEntity)
 
     @Query("DELETE FROM camera_widgets WHERE id = :id")
     fun delete(id: Int)
 
+    @Query("DELETE FROM camera_widgets WHERE id IN (:ids)")
+    suspend fun deleteAll(ids: IntArray)
+
     @Query("SELECT * FROM camera_widgets")
-    fun getAll(): Array<CameraWidgetEntity>?
+    fun getAll(): List<CameraWidgetEntity>
 
     @Query("SELECT * FROM camera_widgets")
-    fun getAllFlow(): Flow<List<CameraWidgetEntity>>?
+    fun getAllFlow(): Flow<List<CameraWidgetEntity>>
 }
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetEntity.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetEntity.kt
index 1d767698de3..7df3ce51aca 100755
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetEntity.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/CameraWidgetEntity.kt
@@ -7,7 +7,7 @@ import androidx.room.PrimaryKey
 @Entity(tableName = "camera_widgets")
 data class CameraWidgetEntity(
     @PrimaryKey
-    val id: Int,
+    override val id: Int,
     @ColumnInfo(name = "entityId")
     val entityId: String
-)
+) : WidgetEntity
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt
index 607e6824002..466b9e137ce 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt
@@ -4,7 +4,6 @@ import androidx.room.Dao
 import androidx.room.Insert
 import androidx.room.OnConflictStrategy
 import androidx.room.Query
-import androidx.room.Update
 import kotlinx.coroutines.flow.Flow
 
 @Dao
@@ -14,17 +13,17 @@ interface MediaPlayerControlsWidgetDao {
     fun get(id: Int): MediaPlayerControlsWidgetEntity?
 
     @Insert(onConflict = OnConflictStrategy.REPLACE)
-    fun add(mediaPlayCtrlWidgetEntity: MediaPlayerControlsWidgetEntity)
-
-    @Update
-    fun update(mediaPlayCtrlWidgetEntity: MediaPlayerControlsWidgetEntity)
+    suspend fun add(mediaPlayCtrlWidgetEntity: MediaPlayerControlsWidgetEntity)
 
     @Query("DELETE FROM mediaplayctrls_widgets WHERE id = :id")
     fun delete(id: Int)
 
+    @Query("DELETE FROM mediaplayctrls_widgets WHERE id IN (:ids)")
+    suspend fun deleteAll(ids: IntArray)
+
     @Query("SELECT * FROM mediaplayctrls_widgets")
-    fun getAll(): List<MediaPlayerControlsWidgetEntity>?
+    suspend fun getAll(): List<MediaPlayerControlsWidgetEntity>
 
     @Query("SELECT * FROM mediaplayctrls_widgets")
-    fun getAllFlow(): Flow<List<MediaPlayerControlsWidgetEntity>>?
+    fun getAllFlow(): Flow<List<MediaPlayerControlsWidgetEntity>>
 }
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetEntity.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetEntity.kt
index dbcc672b773..d691d3384e1 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetEntity.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetEntity.kt
@@ -7,7 +7,7 @@ import androidx.room.PrimaryKey
 @Entity(tableName = "mediaplayctrls_widgets")
 data class MediaPlayerControlsWidgetEntity(
     @PrimaryKey
-    val id: Int,
+    override val id: Int,
     @ColumnInfo(name = "entityId")
     val entityId: String,
     @ColumnInfo(name = "label")
@@ -18,4 +18,4 @@ data class MediaPlayerControlsWidgetEntity(
     val showSeek: Boolean,
     @ColumnInfo(name = "showVolume")
     val showVolume: Boolean
-)
+) : WidgetEntity
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt
index f3b79069450..dc6df3e33eb 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt
@@ -4,7 +4,6 @@ import androidx.room.Dao
 import androidx.room.Insert
 import androidx.room.OnConflictStrategy
 import androidx.room.Query
-import androidx.room.Update
 import kotlinx.coroutines.flow.Flow
 
 @Dao
@@ -14,20 +13,20 @@ interface StaticWidgetDao {
     fun get(id: Int): StaticWidgetEntity?
 
     @Insert(onConflict = OnConflictStrategy.REPLACE)
-    fun add(staticWidgetEntity: StaticWidgetEntity)
-
-    @Update
-    fun update(staticWidgetEntity: StaticWidgetEntity)
+    suspend fun add(staticWidgetEntity: StaticWidgetEntity)
 
     @Query("DELETE FROM static_widget WHERE id = :id")
     fun delete(id: Int)
 
+    @Query("DELETE FROM static_widget WHERE id IN (:ids)")
+    suspend fun deleteAll(ids: IntArray)
+
     @Query("SELECT * FROM static_widget")
-    fun getAll(): List<StaticWidgetEntity>?
+    suspend fun getAll(): List<StaticWidgetEntity>
 
     @Query("SELECT * FROM static_widget")
-    fun getAllFlow(): Flow<List<StaticWidgetEntity>>?
+    fun getAllFlow(): Flow<List<StaticWidgetEntity>>
 
     @Query("UPDATE static_widget SET last_update = :lastUpdate WHERE id = :widgetId")
-    fun updateWidgetLastUpdate(widgetId: Int, lastUpdate: String)
+    suspend fun updateWidgetLastUpdate(widgetId: Int, lastUpdate: String)
 }
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetEntity.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetEntity.kt
index d47098bb67a..822f5ca469d 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetEntity.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/StaticWidgetEntity.kt
@@ -7,7 +7,7 @@ import androidx.room.PrimaryKey
 @Entity(tableName = "static_widget")
 data class StaticWidgetEntity(
     @PrimaryKey
-    val id: Int,
+    override val id: Int,
     @ColumnInfo(name = "entity_id")
     val entityId: String,
     @ColumnInfo(name = "attribute_ids")
@@ -22,4 +22,4 @@ data class StaticWidgetEntity(
     val attributeSeparator: String = "",
     @ColumnInfo(name = "last_update")
     val lastUpdate: String
-)
+) : WidgetEntity
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt
index 104a66c2d58..593512456cc 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt
@@ -4,7 +4,6 @@ import androidx.room.Dao
 import androidx.room.Insert
 import androidx.room.OnConflictStrategy
 import androidx.room.Query
-import androidx.room.Update
 import kotlinx.coroutines.flow.Flow
 
 @Dao
@@ -14,20 +13,20 @@ interface TemplateWidgetDao {
     fun get(id: Int): TemplateWidgetEntity?
 
     @Insert(onConflict = OnConflictStrategy.REPLACE)
-    fun add(templateWidgetEntity: TemplateWidgetEntity)
-
-    @Update
-    fun update(templateWidgetEntity: TemplateWidgetEntity)
+    suspend fun add(templateWidgetEntity: TemplateWidgetEntity)
 
     @Query("DELETE FROM template_widgets WHERE id = :id")
     fun delete(id: Int)
 
+    @Query("DELETE FROM template_widgets WHERE id IN (:ids)")
+    suspend fun deleteAll(ids: IntArray)
+
     @Query("SELECT * FROM template_widgets")
-    fun getAll(): List<TemplateWidgetEntity>?
+    suspend fun getAll(): List<TemplateWidgetEntity>
 
     @Query("SELECT * FROM template_widgets")
-    fun getAllFlow(): Flow<List<TemplateWidgetEntity>>?
+    fun getAllFlow(): Flow<List<TemplateWidgetEntity>>
 
     @Query("UPDATE template_widgets SET last_update = :lastUpdate WHERE id = :widgetId")
-    fun updateTemplateWidgetLastUpdate(widgetId: Int, lastUpdate: String)
+    suspend fun updateTemplateWidgetLastUpdate(widgetId: Int, lastUpdate: String)
 }
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetEntity.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetEntity.kt
index 2d9bcec8a12..6c539f2a409 100644
--- a/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetEntity.kt
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/TemplateWidgetEntity.kt
@@ -7,9 +7,9 @@ import androidx.room.PrimaryKey
 @Entity(tableName = "template_widgets")
 data class TemplateWidgetEntity(
     @PrimaryKey
-    val id: Int,
+    override val id: Int,
     @ColumnInfo(name = "template")
     val template: String,
     @ColumnInfo(name = "last_update")
     val lastUpdate: String
-)
+) : WidgetEntity
diff --git a/common/src/main/java/io/homeassistant/companion/android/database/widget/WidgetEntity.kt b/common/src/main/java/io/homeassistant/companion/android/database/widget/WidgetEntity.kt
new file mode 100644
index 00000000000..1ff25955eb1
--- /dev/null
+++ b/common/src/main/java/io/homeassistant/companion/android/database/widget/WidgetEntity.kt
@@ -0,0 +1,5 @@
+package io.homeassistant.companion.android.database.widget
+
+interface WidgetEntity {
+    val id: Int
+}
