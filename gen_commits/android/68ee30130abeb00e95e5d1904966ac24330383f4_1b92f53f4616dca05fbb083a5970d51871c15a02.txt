diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureActivity.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureActivity.kt
index 428fb909c46..ee459cdba3c 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureActivity.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureActivity.kt
@@ -145,11 +145,14 @@ class TodoWidgetConfigureActivity : BaseActivity() {
     }
 
     private fun onAddWidget() {
-        viewModel.prepareData()
-        // TODO show the error when it makes sense
-        setResult(RESULT_OK)
-        viewModel.updateWidget(this)
-        finish()
+        try {
+            viewModel.addWidgetConfiguration()
+            setResult(RESULT_OK)
+            viewModel.updateWidget(this)
+            finish()
+        } catch (_: IllegalStateException) {
+            showAddWidgetError()
+        }
     }
 
     private fun showAddWidgetError() {
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureViewModel.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureViewModel.kt
index a2b44898aad..7d540d009d0 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureViewModel.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/todo/TodoWidgetConfigureViewModel.kt
@@ -10,8 +10,10 @@ import androidx.compose.runtime.snapshotFlow
 import androidx.glance.appwidget.GlanceAppWidgetManager
 import androidx.lifecycle.ViewModel
 import androidx.lifecycle.viewModelScope
+import com.google.android.material.color.DynamicColors
 import dagger.hilt.android.lifecycle.HiltViewModel
 import io.homeassistant.companion.android.common.data.integration.Entity
+import io.homeassistant.companion.android.common.data.integration.IntegrationDomains.TODO_DOMAIN
 import io.homeassistant.companion.android.common.data.integration.domain
 import io.homeassistant.companion.android.common.data.integration.friendlyName
 import io.homeassistant.companion.android.common.data.servers.ServerManager
@@ -19,9 +21,11 @@ import io.homeassistant.companion.android.database.widget.TodoWidgetDao
 import io.homeassistant.companion.android.database.widget.TodoWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import javax.inject.Inject
+import kotlin.time.Duration.Companion.milliseconds
 import kotlinx.coroutines.ExperimentalCoroutinesApi
 import kotlinx.coroutines.flow.SharingStarted
 import kotlinx.coroutines.flow.StateFlow
+import kotlinx.coroutines.flow.WhileSubscribed
 import kotlinx.coroutines.flow.distinctUntilChanged
 import kotlinx.coroutines.flow.mapLatest
 import kotlinx.coroutines.flow.stateIn
@@ -43,13 +47,19 @@ class TodoWidgetConfigureViewModel @Inject constructor(
     val entities: StateFlow<List<Entity<*>>> = snapshotFlow { selectedServerId }
         .distinctUntilChanged()
         .mapLatest { serverId ->
-            serverManager.integrationRepository(serverId)
-                .getEntities()
-                .orEmpty()
-                .filter { entity -> entity.domain == "todo" }
-        }.stateIn(viewModelScope, SharingStarted.WhileSubscribed(500), emptyList())
+            if (serverManager.isRegistered()) {
+                serverManager.integrationRepository(serverId)
+                    .getEntities()
+                    .orEmpty()
+                    .filter { entity -> entity.domain == TODO_DOMAIN }
+            } else {
+                Timber.w("No server registered")
+                emptyList()
+            }
+        }.stateIn(viewModelScope, SharingStarted.WhileSubscribed(500.milliseconds), emptyList())
+
     var selectedEntityId by mutableStateOf<String?>(null)
-    var selectedBackgroundType by mutableStateOf(WidgetBackgroundType.DAYNIGHT)
+    var selectedBackgroundType by mutableStateOf(if (DynamicColors.isDynamicColorAvailable()) WidgetBackgroundType.DYNAMICCOLOR else WidgetBackgroundType.DAYNIGHT)
     var textColorIndex by mutableIntStateOf(0)
     var showCompletedState by mutableStateOf(true)
     var isUpdateWidget by mutableStateOf(false)
@@ -85,15 +95,14 @@ class TodoWidgetConfigureViewModel @Inject constructor(
             selectedEntityId in entities.value.map { it.entityId }
     }
 
-    fun prepareData() {
+    fun addWidgetConfiguration() {
         if (!isValidSelection()) {
-            // TODO properly react to this in the activity
             Timber.d("Widget data is invalid")
-            return
+            throw IllegalArgumentException("Widget data is invalid")
         }
         if (widgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
             Timber.w("Widget ID is invalid")
-            return
+            throw IllegalArgumentException("Widget ID is invalid")
         }
 
         val textColor = if (selectedBackgroundType == WidgetBackgroundType.TRANSPARENT) {
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/common/data/integration/IntegrationDomains.kt b/common/src/main/kotlin/io/homeassistant/companion/android/common/data/integration/IntegrationDomains.kt
new file mode 100644
index 00000000000..200595193f6
--- /dev/null
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/common/data/integration/IntegrationDomains.kt
@@ -0,0 +1,5 @@
+package io.homeassistant.companion.android.common.data.integration
+
+object IntegrationDomains {
+    const val TODO_DOMAIN = "todo"
+}
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/common/data/websocket/impl/WebSocketRepositoryImpl.kt b/common/src/main/kotlin/io/homeassistant/companion/android/common/data/websocket/impl/WebSocketRepositoryImpl.kt
index ac78008be31..e24cd8b8ec2 100644
--- a/common/src/main/kotlin/io/homeassistant/companion/android/common/data/websocket/impl/WebSocketRepositoryImpl.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/common/data/websocket/impl/WebSocketRepositoryImpl.kt
@@ -3,6 +3,7 @@ package io.homeassistant.companion.android.common.data.websocket.impl
 import com.fasterxml.jackson.module.kotlin.contains
 import com.fasterxml.jackson.module.kotlin.convertValue
 import io.homeassistant.companion.android.common.data.integration.ActionData
+import io.homeassistant.companion.android.common.data.integration.IntegrationDomains.TODO_DOMAIN
 import io.homeassistant.companion.android.common.data.integration.impl.entities.EntityResponse
 import io.homeassistant.companion.android.common.data.servers.ServerManager
 import io.homeassistant.companion.android.common.data.websocket.WebSocketCore
@@ -87,7 +88,7 @@ class WebSocketRepositoryImpl internal constructor(
         val response = webSocketCore.sendMessage(
             mapOf(
                 "type" to "call_service",
-                "domain" to "todo",
+                "domain" to TODO_DOMAIN,
                 "service" to "get_items",
                 "target" to mapOf(
                     "entity_id" to entityId
@@ -102,7 +103,7 @@ class WebSocketRepositoryImpl internal constructor(
         val response = webSocketCore.sendMessage(
             mapOf(
                 "type" to "call_service",
-                "domain" to "todo",
+                "domain" to TODO_DOMAIN,
                 "service" to "update_item",
                 "target" to mapOf(
                     "entity_id" to entityId
