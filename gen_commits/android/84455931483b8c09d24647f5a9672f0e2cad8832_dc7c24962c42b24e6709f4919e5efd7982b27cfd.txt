diff --git a/app/lint-baseline.xml b/app/lint-baseline.xml
index 77b9de8257d..ce2667cc746 100644
--- a/app/lint-baseline.xml
+++ b/app/lint-baseline.xml
@@ -426,7 +426,7 @@
         errorLine2="      ~~~~~~~~~~~~~~">
         <location
             file="src/main/kotlin/io/homeassistant/companion/android/launch/LaunchActivity.kt"
-            line="49"
+            line="51"
             column="7"/>
     </issue>
 
@@ -967,7 +967,7 @@
         errorLine2="                        ~~~~~~~~~~~~~~~~">
         <location
             file="src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt"
-            line="306"
+            line="317"
             column="25"/>
     </issue>
 
@@ -978,19 +978,19 @@
         errorLine2="                                ~~~~~~~~~~~~~~~~">
         <location
             file="src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt"
-            line="163"
+            line="150"
             column="33"/>
     </issue>
 
     <issue
         id="AvoidAnySerializer"
         message="Prefer polymorphic serializer over AnySerializer."
-        errorLine1="                kotlinJsonMapper.encodeToString(MapAnySerializer, actionDataMap),"
-        errorLine2="                                                ~~~~~~~~~~~~~~~~">
+        errorLine1="            serviceData = kotlinJsonMapper.encodeToString(MapAnySerializer, actionDataMap),"
+        errorLine2="                                                          ~~~~~~~~~~~~~~~~">
         <location
             file="src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt"
-            line="510"
-            column="49"/>
+            line="415"
+            column="59"/>
     </issue>
 
     <issue
@@ -1231,7 +1231,7 @@
         errorLine2="                                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidgetConfigureActivity.kt"
-            line="140"
+            line="118"
             column="42"/>
     </issue>
 
@@ -1242,7 +1242,7 @@
         errorLine2="                                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidgetConfigureActivity.kt"
-            line="104"
+            line="91"
             column="42"/>
     </issue>
 
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
index f66d0312e44..b7c5af5f44f 100644
--- a/app/src/main/AndroidManifest.xml
+++ b/app/src/main/AndroidManifest.xml
@@ -112,7 +112,6 @@
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
                 <action android:name="io.homeassistant.companion.android.widgets.ButtonWidget.CALL_SERVICE" />
                 <action android:name="io.homeassistant.companion.android.widgets.ButtonWidget.CALL_SERVICE_AUTH" />
-                <action android:name="io.homeassistant.companion.android.widgets.ButtonWidget.RECEIVE_DATA" />
             </intent-filter>
 
             <meta-data
@@ -124,7 +123,6 @@
             android:exported="false">
             <intent-filter>
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.camera.CameraWidget.RECEIVE_DATA" />
                 <action android:name="io.homeassistant.companion.android.widgets.camera.CameraWidget.UPDATE_IMAGE" />
             </intent-filter>
 
@@ -137,7 +135,6 @@
             android:exported="false">
             <intent-filter>
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.StaticWidget.RECEIVE_DATA" />
             </intent-filter>
 
             <meta-data
@@ -160,7 +157,6 @@
             android:exported="false">
             <intent-filter>
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.RECEIVE_DATA" />
                 <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.UPDATE_MEDIA_IMAGE" />
                 <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.CALL_PREV_TRACK" />
                 <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.CALL_REWIND" />
@@ -185,7 +181,6 @@
                 <action android:name="android.bluetooth.device.action.ACL_DISCONNECTED" />
                 <action android:name="io.homeassistant.companion.android.background.REQUEST_SENSORS_UPDATE" />
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.template.TemplateWidget.RECEIVE_DATA" />
             </intent-filter>
 
             <meta-data
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetConfigureActivity.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetConfigureActivity.kt
index 5e5d889bbdc..55c2fcca8db 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetConfigureActivity.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetConfigureActivity.kt
@@ -1,28 +1,40 @@
 package io.homeassistant.companion.android.widgets
 
+import android.app.PendingIntent
 import android.appwidget.AppWidgetManager
+import android.content.ComponentName
+import android.content.Intent
+import android.os.Build
 import android.view.View
 import android.widget.AdapterView
 import android.widget.AdapterView.OnItemSelectedListener
 import android.widget.ArrayAdapter
 import android.widget.Spinner
 import android.widget.Toast
+import androidx.annotation.RequiresApi
+import androidx.core.content.getSystemService
 import androidx.lifecycle.lifecycleScope
 import io.homeassistant.companion.android.BaseActivity
 import io.homeassistant.companion.android.common.R
 import io.homeassistant.companion.android.common.data.servers.ServerManager
 import io.homeassistant.companion.android.database.widget.WidgetDao
+import io.homeassistant.companion.android.database.widget.WidgetEntity
 import javax.inject.Inject
+import kotlinx.coroutines.flow.drop
+import kotlinx.coroutines.flow.first
+import kotlinx.coroutines.flow.onStart
 import kotlinx.coroutines.launch
+import timber.log.Timber
 
-abstract class BaseWidgetConfigureActivity : BaseActivity() {
+abstract class BaseWidgetConfigureActivity<T : WidgetEntity<T>, DAO : WidgetDao<T>> : BaseActivity() {
 
     @Inject
     lateinit var serverManager: ServerManager
 
     protected var appWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID
 
-    abstract val dao: WidgetDao<*>
+    @Inject
+    lateinit var dao: DAO
 
     abstract val serverSelect: View
     abstract val serverSelectList: Spinner
@@ -81,4 +93,83 @@ abstract class BaseWidgetConfigureActivity : BaseActivity() {
     protected fun showAddWidgetError() {
         Toast.makeText(applicationContext, R.string.widget_creation_error, Toast.LENGTH_LONG).show()
     }
+
+    /**
+     * Return a [WidgetEntity] with the current selection, but without pushing this to the [dao]
+     */
+    abstract suspend fun getPendingDaoEntity(): T
+
+    /**
+     * The class of the widget being configured, this is going to be used when sending the broadcast
+     * intent for the creation of the widget.
+     */
+    abstract val widgetClass: Class<*>
+
+    /**
+     * Requests the widget to be created and waits until it has been saved to the DAO.
+     *
+     * **WARNING**: This function does not handle user cancellation. If a user cancels the widget creation,
+     * this function will not return. If this function is called again and the user does not cancel,
+     * both calls to the function will return. While this behavior could be avoided,
+     * it does not cause issues in the current implementation as returning multiple times has no adverse effects.
+     */
+    @RequiresApi(Build.VERSION_CODES.O)
+    protected suspend fun requestWidgetCreation() {
+        try {
+            val pendingEntity = getPendingDaoEntity()
+            // We drop the first value since we only care about knowing when the widget is actually added
+            dao.getWidgetCountFlow().drop(1).onStart {
+                val context = this@BaseWidgetConfigureActivity
+                getSystemService<AppWidgetManager>()?.requestPinAppWidget(
+                    ComponentName(context, widgetClass),
+                    null,
+                    PendingIntent.getBroadcast(
+                        context,
+                        System.currentTimeMillis().toInt(),
+                        Intent(
+                            context,
+                            widgetClass,
+                        ).apply {
+                            action = ACTION_APPWIDGET_CREATED
+                            putExtra(EXTRA_WIDGET_ENTITY, pendingEntity)
+                        },
+                        // We need the PendingIntent to be mutable so the system inject the EXTRA_APPWIDGET_ID of the created widget
+                        PendingIntent.FLAG_MUTABLE,
+                    ),
+                )
+            }.first()
+            finish()
+        } catch (e: IllegalStateException) {
+            Timber.e(e, "State error when creating widget")
+            showAddWidgetError()
+        }
+    }
+
+    protected suspend fun updateWidget() {
+        val context = this@BaseWidgetConfigureActivity
+
+        if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
+            showAddWidgetError()
+            return
+        }
+
+        try {
+            val pendingEntity = getPendingDaoEntity()
+            dao.add(pendingEntity)
+
+            val intent = Intent(context, widgetClass)
+            intent.action = BaseWidgetProvider.UPDATE_WIDGETS
+            context.sendBroadcast(intent)
+
+            // Make sure we pass back the original appWidgetId
+            setResult(
+                RESULT_OK,
+                Intent().putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId),
+            )
+            finish()
+        } catch (e: IllegalStateException) {
+            Timber.e(e, "State error when updating widget $appWidgetId")
+            showAddWidgetError()
+        }
+    }
 }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt
index 573b285bd84..5fdf223d73e 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/BaseWidgetProvider.kt
@@ -6,11 +6,13 @@ import android.content.ComponentName
 import android.content.Context
 import android.content.Intent
 import android.content.IntentFilter
-import android.os.Bundle
 import android.widget.RemoteViews
 import androidx.core.content.ContextCompat
 import io.homeassistant.companion.android.common.data.integration.Entity
 import io.homeassistant.companion.android.common.data.servers.ServerManager
+import io.homeassistant.companion.android.common.util.FailFast
+import io.homeassistant.companion.android.database.widget.WidgetDao
+import io.homeassistant.companion.android.database.widget.WidgetEntity
 import javax.inject.Inject
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.Dispatchers
@@ -23,13 +25,13 @@ import timber.log.Timber
 /**
  * A widget provider class for widgets that update based on entity state changes.
  */
-abstract class BaseWidgetProvider : AppWidgetProvider() {
+abstract class BaseWidgetProvider<T : WidgetEntity<T>, DAO : WidgetDao<T>> : AppWidgetProvider() {
 
     companion object {
         const val UPDATE_VIEW =
             "io.homeassistant.companion.android.widgets.template.BaseWidgetProvider.UPDATE_VIEW"
-        const val RECEIVE_DATA =
-            "io.homeassistant.companion.android.widgets.template.TemplateWidget.RECEIVE_DATA"
+        const val UPDATE_WIDGETS =
+            "io.homeassistant.companion.android.widgets.UPDATE_WIDGETS"
 
         var widgetScope: CoroutineScope? = null
         val widgetEntities = mutableMapOf<Int, List<String>>()
@@ -39,6 +41,9 @@ abstract class BaseWidgetProvider : AppWidgetProvider() {
     @Inject
     lateinit var serverManager: ServerManager
 
+    @Inject
+    lateinit var dao: DAO
+
     private var thisSetScope = false
     protected var lastIntent = ""
 
@@ -56,10 +61,7 @@ abstract class BaseWidgetProvider : AppWidgetProvider() {
     override fun onUpdate(context: Context, appWidgetManager: AppWidgetManager, appWidgetIds: IntArray) {
         // There may be multiple widgets active, so update all of them
         for (appWidgetId in appWidgetIds) {
-            widgetScope?.launch {
-                val views = getWidgetRemoteViews(context, appWidgetId)
-                appWidgetManager.updateAppWidget(appWidgetId, views)
-            }
+            updateView(context, appWidgetId, appWidgetManager)
         }
     }
 
@@ -70,16 +72,26 @@ abstract class BaseWidgetProvider : AppWidgetProvider() {
         super.onReceive(context, intent)
         when (lastIntent) {
             UPDATE_VIEW -> updateView(context, appWidgetId)
-            RECEIVE_DATA -> {
-                saveEntityConfiguration(
-                    context,
-                    intent.extras,
-                    appWidgetId,
-                )
+            UPDATE_WIDGETS -> {
                 onScreenOn(context)
             }
             Intent.ACTION_SCREEN_ON -> onScreenOn(context)
             Intent.ACTION_SCREEN_OFF -> onScreenOff()
+            ACTION_APPWIDGET_CREATED -> {
+                if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
+                    FailFast.fail { "Missing appWidgetId in intent to add widget in DAO" }
+                } else {
+                    widgetScope?.launch {
+                        // Use deprecated function to not have to specify the class of T
+                        @Suppress("DEPRECATION", "UNCHECKED_CAST")
+                        val entity = intent.getSerializableExtra(EXTRA_WIDGET_ENTITY) as? T
+                        entity?.let {
+                            dao.add(entity.copyWithWidgetId(appWidgetId))
+                        } ?: FailFast.fail { "Missing $EXTRA_WIDGET_ENTITY or it's of the wrong type in intent." }
+                    }
+                }
+                onScreenOn(context)
+            }
         }
     }
 
@@ -179,6 +191,5 @@ abstract class BaseWidgetProvider : AppWidgetProvider() {
 
     // A map of widget IDs to [server ID, list of entity IDs]
     abstract suspend fun getAllWidgetIdsWithEntities(context: Context): Map<Int, Pair<Int, List<String>>>
-    abstract fun saveEntityConfiguration(context: Context, extras: Bundle?, appWidgetId: Int)
     abstract suspend fun onEntityStateChanged(context: Context, appWidgetId: Int, entity: Entity)
 }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt
index d1992930d77..d88c91da036 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt
@@ -7,7 +7,6 @@ import android.content.ComponentName
 import android.content.Context
 import android.content.Intent
 import android.graphics.Color
-import android.os.Bundle
 import android.os.Handler
 import android.os.Looper
 import android.view.View
@@ -28,6 +27,7 @@ import dagger.hilt.android.AndroidEntryPoint
 import io.homeassistant.companion.android.R
 import io.homeassistant.companion.android.common.R as commonR
 import io.homeassistant.companion.android.common.data.servers.ServerManager
+import io.homeassistant.companion.android.common.util.FailFast
 import io.homeassistant.companion.android.common.util.MapAnySerializer
 import io.homeassistant.companion.android.common.util.kotlinJsonMapper
 import io.homeassistant.companion.android.database.widget.ButtonWidgetDao
@@ -35,6 +35,10 @@ import io.homeassistant.companion.android.database.widget.ButtonWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import io.homeassistant.companion.android.util.getAttribute
 import io.homeassistant.companion.android.util.icondialog.getIconByMdiName
+import io.homeassistant.companion.android.widgets.ACTION_APPWIDGET_CREATED
+import io.homeassistant.companion.android.widgets.BaseWidgetProvider
+import io.homeassistant.companion.android.widgets.BaseWidgetProvider.Companion.widgetScope
+import io.homeassistant.companion.android.widgets.EXTRA_WIDGET_ENTITY
 import io.homeassistant.companion.android.widgets.common.WidgetAuthenticationActivity
 import java.util.regex.Pattern
 import javax.inject.Inject
@@ -51,18 +55,6 @@ class ButtonWidget : AppWidgetProvider() {
             "io.homeassistant.companion.android.widgets.button.ButtonWidget.CALL_SERVICE"
         private const val CALL_SERVICE_AUTH =
             "io.homeassistant.companion.android.widgets.button.ButtonWidget.CALL_SERVICE_AUTH"
-        internal const val RECEIVE_DATA =
-            "io.homeassistant.companion.android.widgets.button.ButtonWidget.RECEIVE_DATA"
-
-        internal const val EXTRA_SERVER_ID = "EXTRA_SERVER_ID"
-        internal const val EXTRA_DOMAIN = "EXTRA_DOMAIN"
-        internal const val EXTRA_ACTION = "EXTRA_SERVICE"
-        internal const val EXTRA_ACTION_DATA = "EXTRA_SERVICE_DATA"
-        internal const val EXTRA_LABEL = "EXTRA_LABEL"
-        internal const val EXTRA_ICON_NAME = "EXTRA_ICON_NAME"
-        internal const val EXTRA_BACKGROUND_TYPE = "EXTRA_BACKGROUND_TYPE"
-        internal const val EXTRA_TEXT_COLOR = "EXTRA_TEXT_COLOR"
-        internal const val EXTRA_REQUIRE_AUTHENTICATION = "EXTRA_REQUIRE_AUTHENTICATION"
 
         // Vector icon rendering resolution fallback (if we can't infer via AppWidgetManager for some reason)
         private const val DEFAULT_MAX_ICON_SIZE = 512
@@ -144,8 +136,27 @@ class ButtonWidget : AppWidgetProvider() {
         when (action) {
             CALL_SERVICE_AUTH -> authThenCallConfiguredAction(context, appWidgetId)
             CALL_SERVICE -> callConfiguredAction(context, appWidgetId)
-            RECEIVE_DATA -> saveActionCallConfiguration(context, intent.extras, appWidgetId)
+            BaseWidgetProvider.UPDATE_WIDGETS -> updateAllWidgets(context)
             Intent.ACTION_SCREEN_ON -> updateAllWidgets(context)
+            ACTION_APPWIDGET_CREATED -> {
+                if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
+                    FailFast.fail { "Missing appWidgetId in intent to add widget in DAO" }
+                } else {
+                    widgetScope?.launch {
+                        val entity = intent.extras?.let {
+                            BundleCompat.getSerializable(
+                                it,
+                                EXTRA_WIDGET_ENTITY,
+                                ButtonWidgetEntity::class.java,
+                            )
+                        }
+                        entity?.let {
+                            buttonWidgetDao.add(entity.copyWithWidgetId(appWidgetId))
+                        } ?: FailFast.fail { "Missing $EXTRA_WIDGET_ENTITY or it's of the wrong type in intent." }
+                    }
+                }
+                updateAllWidgets(context)
+            }
         }
     }
 
@@ -358,57 +369,4 @@ class ButtonWidget : AppWidgetProvider() {
             )
         }
     }
-
-    private fun saveActionCallConfiguration(context: Context, extras: Bundle?, appWidgetId: Int) {
-        if (extras == null) return
-
-        val serverId = if (extras.containsKey(EXTRA_SERVER_ID)) extras.getInt(EXTRA_SERVER_ID) else null
-        val domain: String? = extras.getString(EXTRA_DOMAIN)
-        val action: String? = extras.getString(EXTRA_ACTION)
-        val actionData: String? = extras.getString(EXTRA_ACTION_DATA)
-        val label: String? = extras.getString(EXTRA_LABEL)
-        val requireAuthentication: Boolean = extras.getBoolean(EXTRA_REQUIRE_AUTHENTICATION)
-        val icon: String = extras.getString(EXTRA_ICON_NAME) ?: "mdi:flash"
-        val backgroundType =
-            BundleCompat.getSerializable(extras, EXTRA_BACKGROUND_TYPE, WidgetBackgroundType::class.java)
-                ?: WidgetBackgroundType.DAYNIGHT
-        val textColor: String? = extras.getString(EXTRA_TEXT_COLOR)
-
-        if (serverId == null || domain == null || action == null || actionData == null) {
-            Timber.e("Did not receive complete action call data")
-            return
-        }
-
-        mainScope.launch {
-            Timber.d(
-                "Saving action call config data:" + System.lineSeparator() +
-                    "domain: " + domain + System.lineSeparator() +
-                    "action: " + action + System.lineSeparator() +
-                    "action_data: " + actionData + System.lineSeparator() +
-                    "require_authentication: " + requireAuthentication + System.lineSeparator() +
-                    "label: " + label,
-            )
-
-            val widget =
-                ButtonWidgetEntity(
-                    appWidgetId,
-                    serverId,
-                    icon,
-                    domain,
-                    action,
-                    actionData,
-                    label,
-                    backgroundType,
-                    textColor,
-                    requireAuthentication,
-                )
-            buttonWidgetDao.add(widget)
-
-            // It is the responsibility of the configuration activity to update the app widget
-            // This method is only called during the initial setup of the widget,
-            // so rather than duplicating code in the ButtonWidgetConfigurationActivity,
-            // it is just calling onUpdate manually here.
-            onUpdate(context, AppWidgetManager.getInstance(context), intArrayOf(appWidgetId))
-        }
-    }
 }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt
index 078de405ca7..95943ba2dc6 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt
@@ -1,10 +1,7 @@
 package io.homeassistant.companion.android.widgets.button
 
 import android.annotation.SuppressLint
-import android.app.PendingIntent
 import android.appwidget.AppWidgetManager
-import android.content.ComponentName
-import android.content.Intent
 import android.graphics.PorterDuff
 import android.graphics.PorterDuffColorFilter
 import android.os.Build
@@ -20,7 +17,6 @@ import android.widget.EditText
 import android.widget.Spinner
 import androidx.appcompat.app.AlertDialog
 import androidx.core.content.ContextCompat
-import androidx.core.content.getSystemService
 import androidx.core.graphics.toColorInt
 import androidx.core.view.isVisible
 import androidx.fragment.app.DialogFragment
@@ -36,6 +32,7 @@ import io.homeassistant.companion.android.common.data.integration.Entity
 import io.homeassistant.companion.android.common.util.MapAnySerializer
 import io.homeassistant.companion.android.common.util.kotlinJsonMapper
 import io.homeassistant.companion.android.database.widget.ButtonWidgetDao
+import io.homeassistant.companion.android.database.widget.ButtonWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import io.homeassistant.companion.android.databinding.WidgetButtonConfigureBinding
 import io.homeassistant.companion.android.settings.widgets.ManageWidgetsViewModel
@@ -49,22 +46,12 @@ import io.homeassistant.companion.android.widgets.common.ActionFieldBinder
 import io.homeassistant.companion.android.widgets.common.SingleItemArrayAdapter
 import io.homeassistant.companion.android.widgets.common.WidgetDynamicFieldAdapter
 import io.homeassistant.companion.android.widgets.common.WidgetUtils
-import javax.inject.Inject
 import kotlinx.coroutines.Job
 import kotlinx.coroutines.launch
 import timber.log.Timber
 
 @AndroidEntryPoint
-class ButtonWidgetConfigureActivity : BaseWidgetConfigureActivity() {
-    companion object {
-        private const val PIN_WIDGET_CALLBACK =
-            "io.homeassistant.companion.android.widgets.button.ButtonWidgetConfigureActivity.PIN_WIDGET_CALLBACK"
-    }
-
-    @Inject
-    lateinit var buttonWidgetDao: ButtonWidgetDao
-    override val dao get() = buttonWidgetDao
-
+class ButtonWidgetConfigureActivity : BaseWidgetConfigureActivity<ButtonWidgetEntity, ButtonWidgetDao>() {
     private var actions = mutableMapOf<Int, HashMap<String, Action>>()
     private var entities = mutableMapOf<Int, HashMap<String, Entity>>()
     private var dynamicFields = ArrayList<ActionFieldBinder>()
@@ -151,7 +138,7 @@ class ButtonWidgetConfigureActivity : BaseWidgetConfigureActivity() {
 
                         val existingActionData = mutableMapOf<String, Any?>()
                         val addedFields = mutableListOf<String>()
-                        buttonWidgetDao.get(appWidgetId)?.let { buttonWidget ->
+                        dao.get(appWidgetId)?.let { buttonWidget ->
                             if (
                                 buttonWidget.serverId != selectedServerId ||
                                 "${buttonWidget.domain}.${buttonWidget.service}" != actionText
@@ -255,7 +242,7 @@ class ButtonWidgetConfigureActivity : BaseWidgetConfigureActivity() {
             ArrayAdapter(this, android.R.layout.simple_spinner_dropdown_item, backgroundTypeValues)
 
         lifecycleScope.launch {
-            val buttonWidget = buttonWidgetDao.get(appWidgetId)
+            val buttonWidget = dao.get(appWidgetId)
             if (buttonWidget != null) {
                 val actionText = "${buttonWidget.domain}.${buttonWidget.service}"
                 binding.widgetTextConfigService.setText(actionText)
@@ -375,24 +362,16 @@ class ButtonWidgetConfigureActivity : BaseWidgetConfigureActivity() {
                             widgetConfigAction.split(".", limit = 2).size == 2
                         )
                 ) {
-                    getSystemService<AppWidgetManager>()?.requestPinAppWidget(
-                        ComponentName(this, ButtonWidget::class.java),
-                        null,
-                        PendingIntent.getActivity(
-                            this,
-                            System.currentTimeMillis().toInt(),
-                            Intent(
-                                this,
-                                ButtonWidgetConfigureActivity::class.java,
-                            ).putExtra(PIN_WIDGET_CALLBACK, true).setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP),
-                            PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_MUTABLE,
-                        ),
-                    )
+                    lifecycleScope.launch {
+                        requestWidgetCreation()
+                    }
                 } else {
                     showAddWidgetError()
                 }
             } else {
-                onAddWidget()
+                lifecycleScope.launch {
+                    updateWidget()
+                }
             }
         }
 
@@ -401,22 +380,63 @@ class ButtonWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         binding.widgetConfigFieldsLayout.layoutManager = LinearLayoutManager(this)
     }
 
-    override fun onNewIntent(intent: Intent) {
-        super.onNewIntent(intent)
-        if (intent.extras != null && intent.hasExtra(PIN_WIDGET_CALLBACK)) {
-            appWidgetId = intent.extras!!.getInt(
-                AppWidgetManager.EXTRA_APPWIDGET_ID,
-                AppWidgetManager.INVALID_APPWIDGET_ID,
-            )
-            onAddWidget()
-        }
-    }
-
     override fun onServerSelected(serverId: Int) {
         binding.widgetTextConfigService.setText("")
         setAdapterActions(serverId)
     }
 
+    override suspend fun getPendingDaoEntity(): ButtonWidgetEntity {
+        val serverId = checkNotNull(selectedServerId) { "Selected server ID is null" }
+        val actionText = binding.widgetTextConfigService.text.toString()
+        val actions = actions[serverId].orEmpty()
+        val domain = actions[actionText]?.domain ?: actionText.split(".", limit = 2)[0]
+        val action = actions[actionText]?.action ?: actionText.split(".", limit = 2)[1]
+        val actionDataMap = HashMap<String, Any>()
+
+        dynamicFields.forEach {
+            var value = it.value
+            if (value != null) {
+                if (it.field == "entity_id" && value is String) {
+                    // Remove trailing commas and spaces
+                    val trailingRegex = "[, ]+$".toRegex()
+                    value = value.replace(trailingRegex, "")
+                }
+                actionDataMap[it.field] = value
+            }
+        }
+
+        return ButtonWidgetEntity(
+            id = appWidgetId,
+            serverId = serverId,
+            domain = domain,
+            service = action,
+            label = binding.label.text.toString(),
+            iconName = binding.widgetConfigIconSelector.tag as String,
+            serviceData = kotlinJsonMapper.encodeToString(MapAnySerializer, actionDataMap),
+            backgroundType = when (binding.backgroundType.selectedItem as String?) {
+                getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
+                getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
+                else -> WidgetBackgroundType.DAYNIGHT
+            },
+            textColor = if (binding.backgroundType.selectedItem as String? ==
+                getString(commonR.string.widget_background_type_transparent)
+            ) {
+                getHexForColor(
+                    if (binding.textColorWhite.isChecked) {
+                        android.R.color.white
+                    } else {
+                        commonR.color.colorWidgetButtonLabelBlack
+                    },
+                )
+            } else {
+                null
+            },
+            requireAuthentication = binding.widgetCheckboxRequireAuthentication.isChecked,
+        )
+    }
+
+    override val widgetClass: Class<*> = ButtonWidget::class.java
+
     @SuppressLint("NotifyDataSetChanged")
     private fun setAdapterActions(serverId: Int) {
         Timber.d("Actions found: $actions")
@@ -446,112 +466,4 @@ class ButtonWidgetConfigureActivity : BaseWidgetConfigureActivity() {
 
         binding.widgetConfigIconSelector.setImageBitmap(iconDrawable.toBitmap())
     }
-
-    private fun onAddWidget() {
-        if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
-            showAddWidgetError()
-            return
-        }
-        try {
-            val context = this@ButtonWidgetConfigureActivity
-
-            // Set up a broadcast intent and pass the action data as extras
-            val intent = Intent()
-            intent.action = ButtonWidget.RECEIVE_DATA
-            intent.component = ComponentName(context, ButtonWidget::class.java)
-
-            intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)
-
-            intent.putExtra(
-                ButtonWidget.EXTRA_SERVER_ID,
-                selectedServerId!!,
-            )
-
-            // Analyze and send action and domain
-            val actionText = binding.widgetTextConfigService.text.toString()
-            val actions = actions[selectedServerId].orEmpty()
-            val domain = actions[actionText]?.domain ?: actionText.split(".", limit = 2)[0]
-            val action = actions[actionText]?.action ?: actionText.split(".", limit = 2)[1]
-            intent.putExtra(
-                ButtonWidget.EXTRA_DOMAIN,
-                domain,
-            )
-            intent.putExtra(
-                ButtonWidget.EXTRA_ACTION,
-                action,
-            )
-
-            // Fetch and send label and icon
-            intent.putExtra(
-                ButtonWidget.EXTRA_LABEL,
-                binding.label.text.toString(),
-            )
-            intent.putExtra(
-                ButtonWidget.EXTRA_ICON_NAME,
-                binding.widgetConfigIconSelector.tag as String,
-            )
-
-            // Analyze and send action data
-            val actionDataMap = HashMap<String, Any>()
-            dynamicFields.forEach {
-                var value = it.value
-                if (value != null) {
-                    if (it.field == "entity_id" && value is String) {
-                        // Remove trailing commas and spaces
-                        val trailingRegex = "[, ]+$".toRegex()
-                        value = value.replace(trailingRegex, "")
-                    }
-                    actionDataMap[it.field] = value
-                }
-            }
-
-            intent.putExtra(
-                ButtonWidget.EXTRA_ACTION_DATA,
-                kotlinJsonMapper.encodeToString(MapAnySerializer, actionDataMap),
-            )
-
-            intent.putExtra(
-                ButtonWidget.EXTRA_BACKGROUND_TYPE,
-                when (binding.backgroundType.selectedItem as String?) {
-                    getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
-                    getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
-                    else -> WidgetBackgroundType.DAYNIGHT
-                },
-            )
-
-            intent.putExtra(
-                ButtonWidget.EXTRA_TEXT_COLOR,
-                if (binding.backgroundType.selectedItem as String? ==
-                    getString(commonR.string.widget_background_type_transparent)
-                ) {
-                    getHexForColor(
-                        if (binding.textColorWhite.isChecked) {
-                            android.R.color.white
-                        } else {
-                            commonR.color.colorWidgetButtonLabelBlack
-                        },
-                    )
-                } else {
-                    null
-                },
-            )
-
-            intent.putExtra(
-                ButtonWidget.EXTRA_REQUIRE_AUTHENTICATION,
-                binding.widgetCheckboxRequireAuthentication.isChecked,
-            )
-
-            context.sendBroadcast(intent)
-
-            // Make sure we pass back the original appWidgetId
-            setResult(
-                RESULT_OK,
-                Intent().putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId),
-            )
-            finish()
-        } catch (e: Exception) {
-            Timber.e(e, "Issue configuring widget")
-            showAddWidgetError()
-        }
-    }
 }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt
index 579b41ccd39..c5f1ad7d452 100755
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidget.kt
@@ -22,11 +22,16 @@ import coil3.size.Size
 import dagger.hilt.android.AndroidEntryPoint
 import io.homeassistant.companion.android.R
 import io.homeassistant.companion.android.common.data.servers.ServerManager
+import io.homeassistant.companion.android.common.util.FailFast
 import io.homeassistant.companion.android.database.widget.CameraWidgetDao
 import io.homeassistant.companion.android.database.widget.CameraWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetTapAction
 import io.homeassistant.companion.android.util.hasActiveConnection
 import io.homeassistant.companion.android.webview.WebViewActivity
+import io.homeassistant.companion.android.widgets.ACTION_APPWIDGET_CREATED
+import io.homeassistant.companion.android.widgets.BaseWidgetProvider.Companion.UPDATE_WIDGETS
+import io.homeassistant.companion.android.widgets.BaseWidgetProvider.Companion.widgetScope
+import io.homeassistant.companion.android.widgets.EXTRA_WIDGET_ENTITY
 import io.homeassistant.companion.android.widgets.common.RemoteViewsTarget
 import javax.inject.Inject
 import kotlinx.coroutines.CoroutineScope
@@ -40,8 +45,6 @@ import timber.log.Timber
 class CameraWidget : AppWidgetProvider() {
 
     companion object {
-        internal const val RECEIVE_DATA =
-            "io.homeassistant.companion.android.widgets.camera.CameraWidget.RECEIVE_DATA"
         internal const val UPDATE_IMAGE =
             "io.homeassistant.companion.android.widgets.camera.CameraWidget.UPDATE_IMAGE"
 
@@ -214,9 +217,28 @@ class CameraWidget : AppWidgetProvider() {
 
         super.onReceive(context, intent)
         when (lastIntent) {
-            RECEIVE_DATA -> saveEntityConfiguration(context, intent.extras, appWidgetId)
+            UPDATE_WIDGETS -> updateAllWidgets(context)
             UPDATE_IMAGE -> updateAppWidget(context, appWidgetId)
             Intent.ACTION_SCREEN_ON -> updateAllWidgets(context)
+            ACTION_APPWIDGET_CREATED -> {
+                if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
+                    FailFast.fail { "Missing appWidgetId in intent to add widget in DAO" }
+                } else {
+                    widgetScope?.launch {
+                        val entity = intent.extras?.let {
+                            BundleCompat.getSerializable(
+                                it,
+                                EXTRA_WIDGET_ENTITY,
+                                CameraWidgetEntity::class.java,
+                            )
+                        }
+                        entity?.let {
+                            cameraWidgetDao.add(entity.copyWithWidgetId(appWidgetId))
+                        } ?: FailFast.fail { "Missing $EXTRA_WIDGET_ENTITY or it's of the wrong type in intent." }
+                    }
+                }
+                updateAllWidgets(context)
+            }
         }
     }
 
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidgetConfigureActivity.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidgetConfigureActivity.kt
index f16b076c62b..1cced45a4e3 100755
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidgetConfigureActivity.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/camera/CameraWidgetConfigureActivity.kt
@@ -1,10 +1,7 @@
 package io.homeassistant.companion.android.widgets.camera
 
 import android.R
-import android.app.PendingIntent
 import android.appwidget.AppWidgetManager
-import android.content.ComponentName
-import android.content.Intent
 import android.os.Build
 import android.os.Bundle
 import android.view.View
@@ -13,31 +10,24 @@ import android.widget.ArrayAdapter
 import android.widget.AutoCompleteTextView
 import android.widget.Spinner
 import android.widget.Toast
-import androidx.core.content.getSystemService
 import androidx.lifecycle.lifecycleScope
 import dagger.hilt.android.AndroidEntryPoint
 import io.homeassistant.companion.android.common.R as commonR
 import io.homeassistant.companion.android.common.data.integration.Entity
 import io.homeassistant.companion.android.common.data.integration.domain
 import io.homeassistant.companion.android.database.widget.CameraWidgetDao
+import io.homeassistant.companion.android.database.widget.CameraWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetTapAction
 import io.homeassistant.companion.android.databinding.WidgetCameraConfigureBinding
 import io.homeassistant.companion.android.settings.widgets.ManageWidgetsViewModel
 import io.homeassistant.companion.android.util.applySafeDrawingInsets
 import io.homeassistant.companion.android.widgets.BaseWidgetConfigureActivity
 import io.homeassistant.companion.android.widgets.common.SingleItemArrayAdapter
-import javax.inject.Inject
 import kotlinx.coroutines.launch
 import timber.log.Timber
 
 @AndroidEntryPoint
-class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity() {
-
-    companion object {
-        private const val PIN_WIDGET_CALLBACK =
-            "io.homeassistant.companion.android.widgets.camera.CameraWidgetConfigureActivity.PIN_WIDGET_CALLBACK"
-    }
-
+class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity<CameraWidgetEntity, CameraWidgetDao>() {
     private lateinit var binding: WidgetCameraConfigureBinding
 
     override val serverSelect: View
@@ -51,10 +41,6 @@ class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity() {
     private var entities = mutableMapOf<Int, List<Entity>>()
     private var selectedEntity: Entity? = null
 
-    @Inject
-    lateinit var cameraWidgetDao: CameraWidgetDao
-    override val dao get() = cameraWidgetDao
-
     private var entityAdapter: SingleItemArrayAdapter<Entity>? = null
 
     public override fun onCreate(savedInstanceState: Bundle?) {
@@ -71,24 +57,16 @@ class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         binding.addButton.setOnClickListener {
             if (requestLauncherSetup) {
                 if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O && isValidServerId() && selectedEntity != null) {
-                    getSystemService<AppWidgetManager>()?.requestPinAppWidget(
-                        ComponentName(this, CameraWidget::class.java),
-                        null,
-                        PendingIntent.getActivity(
-                            this,
-                            System.currentTimeMillis().toInt(),
-                            Intent(
-                                this,
-                                CameraWidgetConfigureActivity::class.java,
-                            ).putExtra(PIN_WIDGET_CALLBACK, true).setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP),
-                            PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_MUTABLE,
-                        ),
-                    )
+                    lifecycleScope.launch {
+                        requestWidgetCreation()
+                    }
                 } else {
                     showAddWidgetError()
                 }
             } else {
-                onAddWidget()
+                lifecycleScope.launch {
+                    updateWidget()
+                }
             }
         }
 
@@ -114,7 +92,7 @@ class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         initTapActionsSpinner()
 
         lifecycleScope.launch {
-            val cameraWidget = cameraWidgetDao.get(appWidgetId)
+            val cameraWidget = dao.get(appWidgetId)
             if (cameraWidget != null) {
                 setCurrentTapAction(tapAction = cameraWidget.tapAction)
                 binding.widgetTextConfigEntityId.setText(cameraWidget.entityId)
@@ -164,6 +142,24 @@ class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         setAdapterEntities(serverId)
     }
 
+    override suspend fun getPendingDaoEntity(): CameraWidgetEntity {
+        val serverId = checkNotNull(selectedServerId) { "Selected server ID is null" }
+        val entityId = checkNotNull(selectedEntity?.entityId) { "Selected entity is null" }
+
+        return CameraWidgetEntity(
+            id = appWidgetId,
+            serverId = serverId,
+            entityId = entityId,
+            tapAction = if (binding.tapActionList.selectedItemPosition == 0) {
+                WidgetTapAction.REFRESH
+            } else {
+                WidgetTapAction.OPEN
+            },
+        )
+    }
+
+    override val widgetClass: Class<*> = CameraWidget::class.java
+
     private fun setAdapterEntities(serverId: Int) {
         entityAdapter?.let { adapter ->
             adapter.clearAll()
@@ -186,48 +182,6 @@ class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity() {
             selectedEntity = parent.getItemAtPosition(position) as Entity?
         }
 
-    private fun onAddWidget() {
-        if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
-            showAddWidgetError()
-            return
-        }
-        try {
-            val context = this@CameraWidgetConfigureActivity
-
-            // Set up a broadcast intent and pass the service call data as extras
-            val intent = Intent()
-            intent.action = CameraWidget.RECEIVE_DATA
-            intent.component = ComponentName(context, CameraWidget::class.java)
-
-            intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)
-
-            intent.putExtra(
-                CameraWidget.EXTRA_SERVER_ID,
-                selectedServerId!!,
-            )
-            intent.putExtra(
-                CameraWidget.EXTRA_ENTITY_ID,
-                selectedEntity!!.entityId,
-            )
-            intent.putExtra(
-                CameraWidget.EXTRA_TAP_ACTION,
-                if (binding.tapActionList.selectedItemPosition == 0) WidgetTapAction.REFRESH else WidgetTapAction.OPEN,
-            )
-
-            context.sendBroadcast(intent)
-
-            // Make sure we pass back the original appWidgetId
-            setResult(
-                RESULT_OK,
-                Intent().putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId),
-            )
-            finish()
-        } catch (e: Exception) {
-            Timber.e(e, "Issue configuring widget")
-            showAddWidgetError()
-        }
-    }
-
     private fun initTapActionsSpinner() {
         val tapActionValues =
             listOf(getString(commonR.string.refresh), getString(commonR.string.widget_tap_action_open))
@@ -237,15 +191,4 @@ class CameraWidgetConfigureActivity : BaseWidgetConfigureActivity() {
     private fun setCurrentTapAction(tapAction: WidgetTapAction) {
         binding.tapActionList.setSelection(if (tapAction == WidgetTapAction.REFRESH) 0 else 1)
     }
-
-    override fun onNewIntent(intent: Intent) {
-        super.onNewIntent(intent)
-        if (intent.extras != null && intent.hasExtra(PIN_WIDGET_CALLBACK)) {
-            appWidgetId = intent.extras!!.getInt(
-                AppWidgetManager.EXTRA_APPWIDGET_ID,
-                AppWidgetManager.INVALID_APPWIDGET_ID,
-            )
-            onAddWidget()
-        }
-    }
 }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt
index 0ee2f26e797..4e98f4e3ecc 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidget.kt
@@ -6,14 +6,12 @@ import android.content.ComponentName
 import android.content.Context
 import android.content.Intent
 import android.graphics.Color
-import android.os.Bundle
 import android.util.TypedValue
 import android.view.View
 import android.widget.RemoteViews
 import android.widget.Toast
 import androidx.core.content.ContextCompat
 import androidx.core.graphics.toColorInt
-import androidx.core.os.BundleCompat
 import com.google.android.material.color.DynamicColors
 import dagger.hilt.android.AndroidEntryPoint
 import io.homeassistant.companion.android.R
@@ -28,34 +26,19 @@ import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import io.homeassistant.companion.android.database.widget.WidgetTapAction
 import io.homeassistant.companion.android.util.getAttribute
 import io.homeassistant.companion.android.widgets.BaseWidgetProvider
-import javax.inject.Inject
 import kotlinx.coroutines.launch
 import timber.log.Timber
 
 @AndroidEntryPoint
-class EntityWidget : BaseWidgetProvider() {
+class EntityWidget : BaseWidgetProvider<StaticWidgetEntity, StaticWidgetDao>() {
 
     companion object {
         internal const val TOGGLE_ENTITY =
             "io.homeassistant.companion.android.widgets.entity.EntityWidget.TOGGLE_ENTITY"
 
-        internal const val EXTRA_SERVER_ID = "EXTRA_SERVER_ID"
-        internal const val EXTRA_ENTITY_ID = "EXTRA_ENTITY_ID"
-        internal const val EXTRA_ATTRIBUTE_IDS = "EXTRA_ATTRIBUTE_IDS"
-        internal const val EXTRA_LABEL = "EXTRA_LABEL"
-        internal const val EXTRA_TEXT_SIZE = "EXTRA_TEXT_SIZE"
-        internal const val EXTRA_STATE_SEPARATOR = "EXTRA_STATE_SEPARATOR"
-        internal const val EXTRA_ATTRIBUTE_SEPARATOR = "EXTRA_ATTRIBUTE_SEPARATOR"
-        internal const val EXTRA_TAP_ACTION = "EXTRA_TAP_ACTION"
-        internal const val EXTRA_BACKGROUND_TYPE = "EXTRA_BACKGROUND_TYPE"
-        internal const val EXTRA_TEXT_COLOR = "EXTRA_TEXT_COLOR"
-
         private data class ResolvedText(val text: CharSequence?, val exception: Boolean = false)
     }
 
-    @Inject
-    lateinit var staticWidgetDao: StaticWidgetDao
-
     override fun getWidgetProvider(context: Context): ComponentName = ComponentName(context, EntityWidget::class.java)
 
     override suspend fun getWidgetRemoteViews(
@@ -63,7 +46,7 @@ class EntityWidget : BaseWidgetProvider() {
         appWidgetId: Int,
         suggestedEntity: Entity?,
     ): RemoteViews {
-        val widget = staticWidgetDao.get(appWidgetId)
+        val widget = dao.get(appWidgetId)
 
         val intent = Intent(context, EntityWidget::class.java).apply {
             action = if (widget?.tapAction == WidgetTapAction.TOGGLE) TOGGLE_ENTITY else UPDATE_VIEW
@@ -157,7 +140,7 @@ class EntityWidget : BaseWidgetProvider() {
     }
 
     override suspend fun getAllWidgetIdsWithEntities(context: Context): Map<Int, Pair<Int, List<String>>> =
-        staticWidgetDao.getAll().associate { it.id to (it.serverId to listOf(it.entityId)) }
+        dao.getAll().associate { it.id to (it.serverId to listOf(it.entityId)) }
 
     private suspend fun resolveTextToShow(
         context: Context,
@@ -190,11 +173,11 @@ class EntityWidget : BaseWidgetProvider() {
             null
         }
         if (attributeIds == null) {
-            staticWidgetDao.updateWidgetLastUpdate(
+            dao.updateWidgetLastUpdate(
                 appWidgetId,
-                entity?.friendlyState(context, entityOptions) ?: staticWidgetDao.get(appWidgetId)?.lastUpdate ?: "",
+                entity?.friendlyState(context, entityOptions) ?: dao.get(appWidgetId)?.lastUpdate ?: "",
             )
-            return ResolvedText(staticWidgetDao.get(appWidgetId)?.lastUpdate, entityCaughtException)
+            return ResolvedText(dao.get(appWidgetId)?.lastUpdate, entityCaughtException)
         }
 
         try {
@@ -207,61 +190,12 @@ class EntityWidget : BaseWidgetProvider() {
                     entityOptions,
                 ).plus(if (attributeValues.isNotEmpty()) stateSeparator else "")
                     .plus(attributeValues.joinToString(attributeSeparator))
-            staticWidgetDao.updateWidgetLastUpdate(appWidgetId, lastUpdate)
+            dao.updateWidgetLastUpdate(appWidgetId, lastUpdate)
             return ResolvedText(lastUpdate)
         } catch (e: Exception) {
             Timber.e(e, "Unable to fetch entity state and attributes")
         }
-        return ResolvedText(staticWidgetDao.get(appWidgetId)?.lastUpdate, true)
-    }
-
-    override fun saveEntityConfiguration(context: Context, extras: Bundle?, appWidgetId: Int) {
-        if (extras == null) return
-
-        val serverId = if (extras.containsKey(EXTRA_SERVER_ID)) extras.getInt(EXTRA_SERVER_ID) else null
-        val entitySelection: String? = extras.getString(EXTRA_ENTITY_ID)
-        val attributeSelection: ArrayList<String>? = extras.getStringArrayList(EXTRA_ATTRIBUTE_IDS)
-        val labelSelection: String? = extras.getString(EXTRA_LABEL)
-        val textSizeSelection: String? = extras.getString(EXTRA_TEXT_SIZE)
-        val stateSeparatorSelection: String? = extras.getString(EXTRA_STATE_SEPARATOR)
-        val attributeSeparatorSelection: String? = extras.getString(EXTRA_ATTRIBUTE_SEPARATOR)
-        val tapActionSelection = BundleCompat.getSerializable(extras, EXTRA_TAP_ACTION, WidgetTapAction::class.java)
-            ?: WidgetTapAction.REFRESH
-        val backgroundTypeSelection =
-            BundleCompat.getSerializable(extras, EXTRA_BACKGROUND_TYPE, WidgetBackgroundType::class.java)
-                ?: WidgetBackgroundType.DAYNIGHT
-        val textColorSelection: String? = extras.getString(EXTRA_TEXT_COLOR)
-
-        if (serverId == null || entitySelection == null) {
-            Timber.e("Did not receive complete service call data")
-            return
-        }
-
-        widgetScope?.launch {
-            Timber.d(
-                "Saving entity state config data:" + System.lineSeparator() +
-                    "entity id: " + entitySelection + System.lineSeparator() +
-                    "attribute: " + (attributeSelection ?: "N/A"),
-            )
-            staticWidgetDao.add(
-                StaticWidgetEntity(
-                    appWidgetId,
-                    serverId,
-                    entitySelection,
-                    attributeSelection?.joinToString(","),
-                    labelSelection,
-                    textSizeSelection?.toFloatOrNull() ?: 30F,
-                    stateSeparatorSelection ?: "",
-                    attributeSeparatorSelection ?: "",
-                    tapActionSelection,
-                    staticWidgetDao.get(appWidgetId)?.lastUpdate ?: "",
-                    backgroundTypeSelection,
-                    textColorSelection,
-                ),
-            )
-
-            onUpdate(context, AppWidgetManager.getInstance(context), intArrayOf(appWidgetId))
-        }
+        return ResolvedText(dao.get(appWidgetId)?.lastUpdate, true)
     }
 
     override suspend fun onEntityStateChanged(context: Context, appWidgetId: Int, entity: Entity) {
@@ -281,7 +215,7 @@ class EntityWidget : BaseWidgetProvider() {
             appWidgetManager.partiallyUpdateAppWidget(appWidgetId, loadingViews)
 
             var success = false
-            staticWidgetDao.get(appWidgetId)?.let {
+            dao.get(appWidgetId)?.let {
                 try {
                     onEntityPressedWithoutState(
                         it.entityId,
@@ -312,7 +246,7 @@ class EntityWidget : BaseWidgetProvider() {
 
     override fun onDeleted(context: Context, appWidgetIds: IntArray) {
         widgetScope?.launch {
-            staticWidgetDao.deleteAll(appWidgetIds)
+            dao.deleteAll(appWidgetIds)
             appWidgetIds.forEach { removeSubscription(it) }
         }
     }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidgetConfigureActivity.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidgetConfigureActivity.kt
index 98b19de6d07..54ccf0edc43 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidgetConfigureActivity.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/entity/EntityWidgetConfigureActivity.kt
@@ -1,9 +1,6 @@
 package io.homeassistant.companion.android.widgets.entity
 
-import android.app.PendingIntent
 import android.appwidget.AppWidgetManager
-import android.content.ComponentName
-import android.content.Intent
 import android.os.Build
 import android.os.Bundle
 import android.text.Editable
@@ -17,7 +14,6 @@ import android.widget.MultiAutoCompleteTextView.CommaTokenizer
 import android.widget.Spinner
 import android.widget.Toast
 import androidx.core.content.ContextCompat
-import androidx.core.content.getSystemService
 import androidx.core.graphics.toColorInt
 import androidx.core.view.isVisible
 import androidx.lifecycle.lifecycleScope
@@ -28,6 +24,7 @@ import io.homeassistant.companion.android.common.data.integration.EntityExt
 import io.homeassistant.companion.android.common.data.integration.domain
 import io.homeassistant.companion.android.common.data.integration.friendlyName
 import io.homeassistant.companion.android.database.widget.StaticWidgetDao
+import io.homeassistant.companion.android.database.widget.StaticWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import io.homeassistant.companion.android.database.widget.WidgetTapAction
 import io.homeassistant.companion.android.databinding.WidgetStaticConfigureBinding
@@ -35,24 +32,13 @@ import io.homeassistant.companion.android.settings.widgets.ManageWidgetsViewMode
 import io.homeassistant.companion.android.util.applySafeDrawingInsets
 import io.homeassistant.companion.android.util.getHexForColor
 import io.homeassistant.companion.android.widgets.BaseWidgetConfigureActivity
-import io.homeassistant.companion.android.widgets.BaseWidgetProvider
 import io.homeassistant.companion.android.widgets.common.SingleItemArrayAdapter
 import io.homeassistant.companion.android.widgets.common.WidgetUtils
-import javax.inject.Inject
 import kotlinx.coroutines.launch
 import timber.log.Timber
 
 @AndroidEntryPoint
-class EntityWidgetConfigureActivity : BaseWidgetConfigureActivity() {
-
-    companion object {
-        private const val PIN_WIDGET_CALLBACK =
-            "io.homeassistant.companion.android.widgets.entity.EntityWidgetConfigureActivity.PIN_WIDGET_CALLBACK"
-    }
-
-    @Inject
-    lateinit var staticWidgetDao: StaticWidgetDao
-    override val dao get() = staticWidgetDao
+class EntityWidgetConfigureActivity : BaseWidgetConfigureActivity<StaticWidgetEntity, StaticWidgetDao>() {
 
     private var entities = mutableMapOf<Int, List<Entity>>()
 
@@ -90,24 +76,16 @@ class EntityWidgetConfigureActivity : BaseWidgetConfigureActivity() {
                     Build.VERSION.SDK_INT >= Build.VERSION_CODES.O &&
                     isValidServerId()
                 ) {
-                    getSystemService<AppWidgetManager>()?.requestPinAppWidget(
-                        ComponentName(this, EntityWidget::class.java),
-                        null,
-                        PendingIntent.getActivity(
-                            this,
-                            System.currentTimeMillis().toInt(),
-                            Intent(
-                                this,
-                                EntityWidgetConfigureActivity::class.java,
-                            ).putExtra(PIN_WIDGET_CALLBACK, true).setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP),
-                            PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_MUTABLE,
-                        ),
-                    )
+                    lifecycleScope.launch {
+                        requestWidgetCreation()
+                    }
                 } else {
                     showAddWidgetError()
                 }
             } else {
-                onAddWidget()
+                lifecycleScope.launch {
+                    updateWidget()
+                }
             }
         }
 
@@ -132,7 +110,7 @@ class EntityWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         }
 
         lifecycleScope.launch {
-            val staticWidget = staticWidgetDao.get(appWidgetId)
+            val staticWidget = dao.get(appWidgetId)
 
             if (staticWidget != null) {
                 binding.widgetTextConfigEntityId.setText(staticWidget.entityId)
@@ -268,6 +246,8 @@ class EntityWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         setAdapterEntities(serverId)
     }
 
+    override val widgetClass: Class<*> = EntityWidget::class.java
+
     private fun setAdapterEntities(serverId: Int) {
         entityAdapter?.let { adapter ->
             adapter.clearAll()
@@ -332,128 +312,59 @@ class EntityWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         }
     }
 
-    private fun onAddWidget() {
-        if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
-            showAddWidgetError()
-            return
-        }
-        try {
-            val context = this@EntityWidgetConfigureActivity
-
-            // Set up a broadcast intent and pass the service call data as extras
-            val intent = Intent()
-            intent.action = BaseWidgetProvider.RECEIVE_DATA
-            intent.component = ComponentName(context, EntityWidget::class.java)
-
-            intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)
+    override suspend fun getPendingDaoEntity(): StaticWidgetEntity {
+        val serverId = checkNotNull(selectedServerId) { "Selected server ID is null" }
 
-            intent.putExtra(
-                EntityWidget.EXTRA_SERVER_ID,
-                selectedServerId!!,
-            )
-
-            val entity = if (selectedEntity == null) {
-                binding.widgetTextConfigEntityId.text.toString()
-            } else {
-                selectedEntity!!.entityId
-            }
-            if (entity !in entities[selectedServerId].orEmpty().map { it.entityId }) {
-                showAddWidgetError()
-                return
-            }
-            intent.putExtra(
-                EntityWidget.EXTRA_ENTITY_ID,
-                entity,
-            )
-
-            intent.putExtra(
-                EntityWidget.EXTRA_LABEL,
-                binding.label.text.toString(),
-            )
-
-            intent.putExtra(
-                EntityWidget.EXTRA_TEXT_SIZE,
-                binding.textSize.text.toString(),
-            )
+        val entity = if (selectedEntity == null) {
+            binding.widgetTextConfigEntityId.text.toString()
+        } else {
+            checkNotNull(selectedEntity?.entityId) { "Selected entity is null" }
+        }
 
-            intent.putExtra(
-                EntityWidget.EXTRA_STATE_SEPARATOR,
-                binding.stateSeparator.text.toString(),
-            )
+        if (entity !in entities[serverId].orEmpty().map { it.entityId }) {
+            throw IllegalStateException("Selected entity is unknown on server")
+        }
 
-            if (appendAttributes) {
-                val attributes = if (selectedAttributeIds.isEmpty()) {
+        return StaticWidgetEntity(
+            id = appWidgetId,
+            serverId = serverId,
+            entityId = entity,
+            label = binding.label.text?.toString(),
+            textSize = binding.textSize.text?.toString()?.toFloatOrNull() ?: 30F,
+            stateSeparator = binding.stateSeparator.text?.toString() ?: "",
+            attributeIds = if (appendAttributes) {
+                if (selectedAttributeIds.isEmpty()) {
                     binding.widgetTextConfigAttribute.text.toString()
                 } else {
-                    selectedAttributeIds
+                    selectedAttributeIds.joinToString(",")
                 }
-                intent.putExtra(
-                    EntityWidget.EXTRA_ATTRIBUTE_IDS,
-                    attributes,
-                )
-
-                intent.putExtra(
-                    EntityWidget.EXTRA_ATTRIBUTE_SEPARATOR,
-                    binding.attributeSeparator.text.toString(),
+            } else {
+                null
+            },
+            attributeSeparator = if (appendAttributes) binding.attributeSeparator.text?.toString() ?: "" else "",
+            tapAction = when (binding.tapActionList.selectedItemPosition) {
+                0 -> WidgetTapAction.TOGGLE
+                else -> WidgetTapAction.REFRESH
+            },
+            backgroundType = when (binding.backgroundType.selectedItem as String?) {
+                getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
+                getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
+                else -> WidgetBackgroundType.DAYNIGHT
+            },
+            textColor = if (binding.backgroundType.selectedItem as String? ==
+                getString(commonR.string.widget_background_type_transparent)
+            ) {
+                getHexForColor(
+                    if (binding.textColorWhite.isChecked) {
+                        android.R.color.white
+                    } else {
+                        commonR.color.colorWidgetButtonLabelBlack
+                    },
                 )
-            }
-
-            intent.putExtra(
-                EntityWidget.EXTRA_TAP_ACTION,
-                when (binding.tapActionList.selectedItemPosition) {
-                    0 -> WidgetTapAction.TOGGLE
-                    else -> WidgetTapAction.REFRESH
-                },
-            )
-
-            intent.putExtra(
-                EntityWidget.EXTRA_BACKGROUND_TYPE,
-                when (binding.backgroundType.selectedItem as String?) {
-                    getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
-                    getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
-                    else -> WidgetBackgroundType.DAYNIGHT
-                },
-            )
-
-            intent.putExtra(
-                EntityWidget.EXTRA_TEXT_COLOR,
-                if (binding.backgroundType.selectedItem as String? ==
-                    getString(commonR.string.widget_background_type_transparent)
-                ) {
-                    getHexForColor(
-                        if (binding.textColorWhite.isChecked) {
-                            android.R.color.white
-                        } else {
-                            commonR.color.colorWidgetButtonLabelBlack
-                        },
-                    )
-                } else {
-                    null
-                },
-            )
-
-            context.sendBroadcast(intent)
-
-            // Make sure we pass back the original appWidgetId
-            setResult(
-                RESULT_OK,
-                Intent().putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId),
-            )
-            finish()
-        } catch (e: Exception) {
-            Timber.e(e, "Issue configuring widget")
-            showAddWidgetError()
-        }
-    }
-
-    override fun onNewIntent(intent: Intent) {
-        super.onNewIntent(intent)
-        if (intent.extras != null && intent.hasExtra(PIN_WIDGET_CALLBACK)) {
-            appWidgetId = intent.extras!!.getInt(
-                AppWidgetManager.EXTRA_APPWIDGET_ID,
-                AppWidgetManager.INVALID_APPWIDGET_ID,
-            )
-            onAddWidget()
-        }
+            } else {
+                null
+            },
+            lastUpdate = dao.get(appWidgetId)?.lastUpdate ?: "",
+        )
     }
 }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidget.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidget.kt
index a89b64bcde7..eae1ed5fb47 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidget.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidget.kt
@@ -6,13 +6,11 @@ import android.content.ComponentName
 import android.content.Context
 import android.content.Intent
 import android.graphics.Color
-import android.os.Bundle
 import android.os.Handler
 import android.os.Looper
 import android.view.View
 import android.widget.RemoteViews
 import android.widget.Toast
-import androidx.core.os.BundleCompat
 import coil3.imageLoader
 import coil3.request.ImageRequest
 import com.google.android.material.color.DynamicColors
@@ -29,17 +27,13 @@ import io.homeassistant.companion.android.util.hasActiveConnection
 import io.homeassistant.companion.android.widgets.BaseWidgetProvider
 import io.homeassistant.companion.android.widgets.common.RemoteViewsTarget
 import java.util.LinkedList
-import javax.inject.Inject
-import kotlin.collections.HashMap
 import kotlinx.coroutines.launch
 import timber.log.Timber
 
 @AndroidEntryPoint
-class MediaPlayerControlsWidget : BaseWidgetProvider() {
+class MediaPlayerControlsWidget : BaseWidgetProvider<MediaPlayerControlsWidgetEntity, MediaPlayerControlsWidgetDao>() {
 
     companion object {
-        internal const val RECEIVE_DATA =
-            "io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.RECEIVE_DATA"
         internal const val UPDATE_MEDIA_IMAGE =
             "io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.UPDATE_MEDIA_IMAGE"
         internal const val CALL_PREV_TRACK =
@@ -56,20 +50,8 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
             "io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.CALL_VOLUME_DOWN"
         internal const val CALL_VOLUME_UP =
             "io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.CALL_VOLUME_UP"
-
-        internal const val EXTRA_SERVER_ID = "EXTRA_SERVER_ID"
-        internal const val EXTRA_ENTITY_ID = "EXTRA_ENTITY_ID"
-        internal const val EXTRA_LABEL = "EXTRA_LABEL"
-        internal const val EXTRA_SHOW_VOLUME = "EXTRA_SHOW_VOLUME"
-        internal const val EXTRA_SHOW_SOURCE = "EXTRA_SHOW_VOLUME_SOURCE"
-        internal const val EXTRA_SHOW_SKIP = "EXTRA_INCLUDE_SKIP"
-        internal const val EXTRA_SHOW_SEEK = "EXTRA_INCLUDE_SEEK"
-        internal const val EXTRA_BACKGROUND_TYPE = "EXTRA_BACKGROUND_TYPE"
     }
 
-    @Inject
-    lateinit var mediaPlayCtrlWidgetDao: MediaPlayerControlsWidgetDao
-
     override fun getWidgetProvider(context: Context): ComponentName =
         ComponentName(context, MediaPlayerControlsWidget::class.java)
 
@@ -145,7 +127,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
             putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)
         }
 
-        val widget = mediaPlayCtrlWidgetDao.get(appWidgetId)
+        val widget = dao.get(appWidgetId)
         val useDynamicColors =
             widget?.backgroundType == WidgetBackgroundType.DYNAMICCOLOR && DynamicColors.isDynamicColorAvailable()
         return RemoteViews(
@@ -421,7 +403,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     }
 
     override suspend fun getAllWidgetIdsWithEntities(context: Context): Map<Int, Pair<Int, List<String>>> =
-        mediaPlayCtrlWidgetDao.getAll().associate { it.id to (it.serverId to it.entityId.split(",")) }
+        dao.getAll().associate { it.id to (it.serverId to it.entityId.split(",")) }
 
     private suspend fun getEntity(
         context: Context,
@@ -469,8 +451,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
                 context,
                 appWidgetId,
             )
-            RECEIVE_DATA -> {
-                saveEntityConfiguration(context, intent.extras, appWidgetId)
+            UPDATE_WIDGETS -> {
                 super.onScreenOn(context)
             }
             UPDATE_MEDIA_IMAGE -> updateView(context, appWidgetId)
@@ -484,50 +465,8 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
         }
     }
 
-    override fun saveEntityConfiguration(context: Context, extras: Bundle?, appWidgetId: Int) {
-        if (extras == null) return
-
-        val serverId = if (extras.containsKey(EXTRA_SERVER_ID)) extras.getInt(EXTRA_SERVER_ID) else null
-        val entitySelection: String? = extras.getString(EXTRA_ENTITY_ID)
-        val labelSelection: String? = extras.getString(EXTRA_LABEL)
-        val showSkip: Boolean = extras.getBoolean(EXTRA_SHOW_SKIP)
-        val showSeek: Boolean = extras.getBoolean(EXTRA_SHOW_SEEK)
-        val showVolume: Boolean = extras.getBoolean(EXTRA_SHOW_VOLUME)
-        val showSource: Boolean = extras.getBoolean(EXTRA_SHOW_SOURCE)
-        val backgroundType =
-            BundleCompat.getSerializable(extras, EXTRA_BACKGROUND_TYPE, WidgetBackgroundType::class.java)
-                ?: WidgetBackgroundType.DAYNIGHT
-
-        if (serverId == null || entitySelection == null) {
-            Timber.e("Did not receive complete configuration data")
-            return
-        }
-
-        widgetScope?.launch {
-            Timber.d(
-                "Saving action call config data:" + System.lineSeparator() +
-                    "entity id: " + entitySelection + System.lineSeparator(),
-            )
-            mediaPlayCtrlWidgetDao.add(
-                MediaPlayerControlsWidgetEntity(
-                    appWidgetId,
-                    serverId,
-                    entitySelection,
-                    labelSelection,
-                    showSkip,
-                    showSeek,
-                    showVolume,
-                    showSource,
-                    backgroundType,
-                ),
-            )
-
-            onUpdate(context, AppWidgetManager.getInstance(context), intArrayOf(appWidgetId))
-        }
-    }
-
     override suspend fun onEntityStateChanged(context: Context, appWidgetId: Int, entity: Entity) {
-        mediaPlayCtrlWidgetDao.get(appWidgetId)?.let {
+        dao.get(appWidgetId)?.let {
             widgetScope?.launch {
                 val views =
                     getWidgetRemoteViews(
@@ -543,7 +482,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     private fun callPreviousTrackAction(context: Context, appWidgetId: Int) {
         widgetScope?.launch {
             Timber.d("Retrieving media player entity for app widget $appWidgetId")
-            val entity: MediaPlayerControlsWidgetEntity? = mediaPlayCtrlWidgetDao.get(appWidgetId)
+            val entity: MediaPlayerControlsWidgetEntity? = dao.get(appWidgetId)
 
             if (entity == null) {
                 Timber.d("Failed to retrieve media player entity")
@@ -573,7 +512,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     private fun callRewindAction(context: Context, appWidgetId: Int) {
         widgetScope?.launch {
             Timber.d("Retrieving media player entity for app widget $appWidgetId")
-            val entity: MediaPlayerControlsWidgetEntity? = mediaPlayCtrlWidgetDao.get(appWidgetId)
+            val entity: MediaPlayerControlsWidgetEntity? = dao.get(appWidgetId)
 
             if (entity == null) {
                 Timber.d("Failed to retrieve media player entity")
@@ -631,7 +570,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     private fun callPlayPauseAction(context: Context, appWidgetId: Int) {
         widgetScope?.launch {
             Timber.d("Retrieving media player entity for app widget $appWidgetId")
-            val entity: MediaPlayerControlsWidgetEntity? = mediaPlayCtrlWidgetDao.get(appWidgetId)
+            val entity: MediaPlayerControlsWidgetEntity? = dao.get(appWidgetId)
 
             if (entity == null) {
                 Timber.d("Failed to retrieve media player entity")
@@ -665,7 +604,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     private fun callFastForwardAction(context: Context, appWidgetId: Int) {
         widgetScope?.launch {
             Timber.d("Retrieving media player entity for app widget $appWidgetId")
-            val entity: MediaPlayerControlsWidgetEntity? = mediaPlayCtrlWidgetDao.get(appWidgetId)
+            val entity: MediaPlayerControlsWidgetEntity? = dao.get(appWidgetId)
 
             if (entity == null) {
                 Timber.d("Failed to retrieve media player entity")
@@ -723,7 +662,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     private fun callNextTrackAction(context: Context, appWidgetId: Int) {
         widgetScope?.launch {
             Timber.d("Retrieving media player entity for app widget $appWidgetId")
-            val entity: MediaPlayerControlsWidgetEntity? = mediaPlayCtrlWidgetDao.get(appWidgetId)
+            val entity: MediaPlayerControlsWidgetEntity? = dao.get(appWidgetId)
 
             if (entity == null) {
                 Timber.d("Failed to retrieve media player entity")
@@ -757,7 +696,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     private fun callVolumeDownAction(context: Context, appWidgetId: Int) {
         widgetScope?.launch {
             Timber.d("Retrieving media player entity for app widget $appWidgetId")
-            val entity: MediaPlayerControlsWidgetEntity? = mediaPlayCtrlWidgetDao.get(appWidgetId)
+            val entity: MediaPlayerControlsWidgetEntity? = dao.get(appWidgetId)
 
             if (entity == null) {
                 Timber.d("Failed to retrieve media player entity")
@@ -791,7 +730,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
     private fun callVolumeUpAction(context: Context, appWidgetId: Int) {
         widgetScope?.launch {
             Timber.d("Retrieving media player entity for app widget $appWidgetId")
-            val entity: MediaPlayerControlsWidgetEntity? = mediaPlayCtrlWidgetDao.get(appWidgetId)
+            val entity: MediaPlayerControlsWidgetEntity? = dao.get(appWidgetId)
 
             if (entity == null) {
                 Timber.d("Failed to retrieve media player entity")
@@ -824,7 +763,7 @@ class MediaPlayerControlsWidget : BaseWidgetProvider() {
 
     override fun onDeleted(context: Context, appWidgetIds: IntArray) {
         widgetScope?.launch {
-            mediaPlayCtrlWidgetDao.deleteAll(appWidgetIds)
+            dao.deleteAll(appWidgetIds)
             appWidgetIds.forEach { removeSubscription(it) }
         }
     }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidgetConfigureActivity.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidgetConfigureActivity.kt
index 5d8ad26b464..f1b4c3573d2 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidgetConfigureActivity.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidgetConfigureActivity.kt
@@ -1,9 +1,6 @@
 package io.homeassistant.companion.android.widgets.mediaplayer
 
-import android.app.PendingIntent
 import android.appwidget.AppWidgetManager
-import android.content.ComponentName
-import android.content.Intent
 import android.os.Build
 import android.os.Bundle
 import android.view.View
@@ -12,13 +9,13 @@ import android.widget.AutoCompleteTextView
 import android.widget.MultiAutoCompleteTextView
 import android.widget.Spinner
 import android.widget.Toast
-import androidx.core.content.getSystemService
 import androidx.lifecycle.lifecycleScope
 import dagger.hilt.android.AndroidEntryPoint
 import io.homeassistant.companion.android.common.R as commonR
 import io.homeassistant.companion.android.common.data.integration.Entity
 import io.homeassistant.companion.android.common.data.integration.domain
 import io.homeassistant.companion.android.database.widget.MediaPlayerControlsWidgetDao
+import io.homeassistant.companion.android.database.widget.MediaPlayerControlsWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import io.homeassistant.companion.android.databinding.WidgetMediaControlsConfigureBinding
 import io.homeassistant.companion.android.settings.widgets.ManageWidgetsViewModel
@@ -27,26 +24,15 @@ import io.homeassistant.companion.android.widgets.BaseWidgetConfigureActivity
 import io.homeassistant.companion.android.widgets.common.SingleItemArrayAdapter
 import io.homeassistant.companion.android.widgets.common.WidgetUtils
 import java.util.LinkedList
-import javax.inject.Inject
 import kotlinx.coroutines.launch
 import kotlinx.coroutines.runBlocking
 import timber.log.Timber
 
 @AndroidEntryPoint
-class MediaPlayerControlsWidgetConfigureActivity : BaseWidgetConfigureActivity() {
-
-    companion object {
-        @Suppress("ktlint:standard:max-line-length")
-        private const val PIN_WIDGET_CALLBACK =
-            "io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidgetConfigureActivity.PIN_WIDGET_CALLBACK"
-    }
-
+class MediaPlayerControlsWidgetConfigureActivity :
+    BaseWidgetConfigureActivity<MediaPlayerControlsWidgetEntity, MediaPlayerControlsWidgetDao>() {
     private var requestLauncherSetup = false
 
-    @Inject
-    lateinit var mediaPlayerControlsWidgetDao: MediaPlayerControlsWidgetDao
-    override val dao get() = mediaPlayerControlsWidgetDao
-
     private lateinit var binding: WidgetMediaControlsConfigureBinding
 
     override val serverSelect: View
@@ -80,24 +66,16 @@ class MediaPlayerControlsWidgetConfigureActivity : BaseWidgetConfigureActivity()
                         entities[selectedServerId!!].orEmpty().any { e -> e.entityId == it.trim() }
                     }
                 ) {
-                    getSystemService<AppWidgetManager>()?.requestPinAppWidget(
-                        ComponentName(this, MediaPlayerControlsWidget::class.java),
-                        null,
-                        PendingIntent.getActivity(
-                            this,
-                            System.currentTimeMillis().toInt(),
-                            Intent(
-                                this,
-                                MediaPlayerControlsWidgetConfigureActivity::class.java,
-                            ).putExtra(PIN_WIDGET_CALLBACK, true).setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP),
-                            PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_MUTABLE,
-                        ),
-                    )
+                    lifecycleScope.launch {
+                        requestWidgetCreation()
+                    }
                 } else {
                     showAddWidgetError()
                 }
             } else {
-                onAddWidget()
+                lifecycleScope.launch {
+                    updateWidget()
+                }
             }
         }
 
@@ -126,7 +104,7 @@ class MediaPlayerControlsWidgetConfigureActivity : BaseWidgetConfigureActivity()
             ArrayAdapter(this, android.R.layout.simple_spinner_dropdown_item, backgroundTypeValues)
 
         lifecycleScope.launch {
-            val mediaPlayerWidget = mediaPlayerControlsWidgetDao.get(appWidgetId)
+            val mediaPlayerWidget = dao.get(appWidgetId)
 
             if (mediaPlayerWidget != null) {
                 binding.label.setText(mediaPlayerWidget.label)
@@ -207,87 +185,37 @@ class MediaPlayerControlsWidgetConfigureActivity : BaseWidgetConfigureActivity()
         }
     }
 
-    private fun onAddWidget() {
-        if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
-            showAddWidgetError()
-            return
+    override suspend fun getPendingDaoEntity(): MediaPlayerControlsWidgetEntity {
+        val serverId = checkNotNull(selectedServerId) { "Selected server ID is null" }
+        selectedEntities = LinkedList()
+        val se = binding.widgetTextConfigEntityId.text.split(",")
+        se.forEach {
+            val entity = entities[serverId]?.firstOrNull { e -> e.entityId == it.trim() }
+            if (entity != null) selectedEntities.add(entity)
         }
-        try {
-            val context = this@MediaPlayerControlsWidgetConfigureActivity
-
-            // Set up a broadcast intent and pass the service call data as extras
-            val intent = Intent()
-            intent.action = MediaPlayerControlsWidget.RECEIVE_DATA
-            intent.component = ComponentName(context, MediaPlayerControlsWidget::class.java)
-
-            intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)
-
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_SERVER_ID,
-                selectedServerId!!,
-            )
-
-            selectedEntities = LinkedList()
-            val se = binding.widgetTextConfigEntityId.text.split(",")
-            se.forEach {
-                val entity = entities[selectedServerId]!!.firstOrNull { e -> e.entityId == it.trim() }
-                if (entity != null) selectedEntities.add(entity)
-            }
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_ENTITY_ID,
-                selectedEntities.map { e -> e?.entityId }.reduce { a, b -> "$a,$b" },
-            )
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_LABEL,
-                binding.label.text.toString(),
-            )
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_SHOW_VOLUME,
-                binding.widgetShowVolumeButtonCheckbox.isChecked,
-            )
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_SHOW_SKIP,
-                binding.widgetShowSkipButtonsCheckbox.isChecked,
-            )
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_SHOW_SEEK,
-                binding.widgetShowSeekButtonsCheckbox.isChecked,
-            )
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_SHOW_SOURCE,
-                binding.widgetShowMediaPlayerSource.isChecked,
-            )
-            intent.putExtra(
-                MediaPlayerControlsWidget.EXTRA_BACKGROUND_TYPE,
-                when (binding.backgroundType.selectedItem as String?) {
-                    getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
-                    getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
-                    else -> WidgetBackgroundType.DAYNIGHT
-                },
-            )
 
-            context.sendBroadcast(intent)
+        val entitySelection = selectedEntities.map { e -> e?.entityId }.reduceOrNull { a, b -> "$a,$b" }
 
-            // Make sure we pass back the original appWidgetId
-            setResult(
-                RESULT_OK,
-                Intent().putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId),
-            )
-            finish()
-        } catch (e: Exception) {
-            Timber.e(e, "Issue configuring widget")
-            showAddWidgetError()
+        if (entitySelection == null) {
+            throw IllegalStateException("No valid entities selected")
         }
-    }
 
-    override fun onNewIntent(intent: Intent) {
-        super.onNewIntent(intent)
-        if (intent.extras != null && intent.hasExtra(PIN_WIDGET_CALLBACK)) {
-            appWidgetId = intent.extras!!.getInt(
-                AppWidgetManager.EXTRA_APPWIDGET_ID,
-                AppWidgetManager.INVALID_APPWIDGET_ID,
-            )
-            onAddWidget()
-        }
+        return MediaPlayerControlsWidgetEntity(
+            id = appWidgetId,
+            serverId = serverId,
+            entityId = entitySelection,
+            label = binding.label.text.toString(),
+            showVolume = binding.widgetShowVolumeButtonCheckbox.isChecked,
+            showSkip = binding.widgetShowSkipButtonsCheckbox.isChecked,
+            showSeek = binding.widgetShowSeekButtonsCheckbox.isChecked,
+            showSource = binding.widgetShowMediaPlayerSource.isChecked,
+            backgroundType = when (binding.backgroundType.selectedItem as String?) {
+                getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
+                getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
+                else -> WidgetBackgroundType.DAYNIGHT
+            },
+        )
     }
+
+    override val widgetClass: Class<*> = MediaPlayerControlsWidget::class.java
 }
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt
index bbd5a0d3ef5..9243f7a7f32 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidget.kt
@@ -8,7 +8,6 @@ import android.content.Context
 import android.content.Intent
 import android.content.IntentFilter
 import android.graphics.Color
-import android.os.Bundle
 import android.util.TypedValue
 import android.view.View
 import android.widget.RemoteViews
@@ -21,10 +20,14 @@ import dagger.hilt.android.AndroidEntryPoint
 import io.homeassistant.companion.android.R
 import io.homeassistant.companion.android.common.R as commonR
 import io.homeassistant.companion.android.common.data.servers.ServerManager
+import io.homeassistant.companion.android.common.util.FailFast
 import io.homeassistant.companion.android.database.widget.TemplateWidgetDao
 import io.homeassistant.companion.android.database.widget.TemplateWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import io.homeassistant.companion.android.util.getAttribute
+import io.homeassistant.companion.android.widgets.ACTION_APPWIDGET_CREATED
+import io.homeassistant.companion.android.widgets.BaseWidgetProvider.Companion.UPDATE_WIDGETS
+import io.homeassistant.companion.android.widgets.EXTRA_WIDGET_ENTITY
 import javax.inject.Inject
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.Dispatchers
@@ -39,15 +42,6 @@ class TemplateWidget : AppWidgetProvider() {
     companion object {
         const val UPDATE_VIEW =
             "io.homeassistant.companion.android.widgets.template.TemplateWidget.UPDATE_VIEW"
-        const val RECEIVE_DATA =
-            "io.homeassistant.companion.android.widgets.template.TemplateWidget.RECEIVE_DATA"
-
-        internal const val EXTRA_SERVER_ID = "EXTRA_SERVER_ID"
-        internal const val EXTRA_TEMPLATE = "extra_template"
-        internal const val EXTRA_TEXT_SIZE = "EXTRA_TEXT_SIZE"
-        internal const val EXTRA_BACKGROUND_TYPE = "EXTRA_BACKGROUND_TYPE"
-        internal const val EXTRA_TEXT_COLOR = "EXTRA_TEXT_COLOR"
-
         private var widgetScope: CoroutineScope? = null
         private val widgetTemplates = mutableMapOf<Int, String>()
         private val widgetJobs = mutableMapOf<Int, Job>()
@@ -102,17 +96,28 @@ class TemplateWidget : AppWidgetProvider() {
         super.onReceive(context, intent)
         when (lastIntent) {
             UPDATE_VIEW -> updateView(context, appWidgetId)
-            RECEIVE_DATA -> {
-                saveEntityConfiguration(
-                    context,
-                    intent.extras,
-                    appWidgetId,
-                )
-                onScreenOn(context)
-            }
-
+            UPDATE_WIDGETS -> onScreenOn(context)
             Intent.ACTION_SCREEN_ON -> onScreenOn(context)
             Intent.ACTION_SCREEN_OFF -> onScreenOff()
+            ACTION_APPWIDGET_CREATED -> {
+                if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
+                    FailFast.fail { "Missing appWidgetId in intent to add widget in DAO" }
+                } else {
+                    widgetScope?.launch {
+                        val entity = intent.extras?.let {
+                            BundleCompat.getSerializable(
+                                it,
+                                EXTRA_WIDGET_ENTITY,
+                                TemplateWidgetEntity::class.java,
+                            )
+                        }
+                        entity?.let {
+                            templateWidgetDao.add(entity.copyWithWidgetId(appWidgetId))
+                        } ?: FailFast.fail { "Missing $EXTRA_WIDGET_ENTITY or it's of the wrong type in intent." }
+                    }
+                }
+                onScreenOn(context)
+            }
         }
     }
 
@@ -281,38 +286,6 @@ class TemplateWidget : AppWidgetProvider() {
         }
     }
 
-    private fun saveEntityConfiguration(context: Context, extras: Bundle?, appWidgetId: Int) {
-        if (extras == null) return
-
-        val serverId = if (extras.containsKey(EXTRA_SERVER_ID)) extras.getInt(EXTRA_SERVER_ID) else null
-        val template: String? = extras.getString(EXTRA_TEMPLATE)
-        val textSize: Float = extras.getFloat(EXTRA_TEXT_SIZE)
-        val backgroundTypeSelection =
-            BundleCompat.getSerializable(extras, EXTRA_BACKGROUND_TYPE, WidgetBackgroundType::class.java)
-                ?: WidgetBackgroundType.DAYNIGHT
-        val textColorSelection: String? = extras.getString(EXTRA_TEXT_COLOR)
-
-        if (serverId == null || template == null) {
-            Timber.e("Did not receive complete widget data")
-            return
-        }
-
-        widgetScope?.launch {
-            templateWidgetDao.add(
-                TemplateWidgetEntity(
-                    appWidgetId,
-                    serverId,
-                    template,
-                    textSize,
-                    templateWidgetDao.get(appWidgetId)?.lastUpdate ?: "Loading",
-                    backgroundTypeSelection,
-                    textColorSelection,
-                ),
-            )
-            onUpdate(context, AppWidgetManager.getInstance(context), intArrayOf(appWidgetId))
-        }
-    }
-
     private fun onTemplateChanged(context: Context, appWidgetId: Int, template: String?) {
         widgetScope?.launch {
             val views = getWidgetRemoteViews(context, appWidgetId, template)
diff --git a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidgetConfigureActivity.kt b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidgetConfigureActivity.kt
index 3a460b04386..b9d44b15698 100644
--- a/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidgetConfigureActivity.kt
+++ b/app/src/main/kotlin/io/homeassistant/companion/android/widgets/template/TemplateWidgetConfigureActivity.kt
@@ -1,9 +1,6 @@
 package io.homeassistant.companion.android.widgets.template
 
-import android.app.PendingIntent
 import android.appwidget.AppWidgetManager
-import android.content.ComponentName
-import android.content.Intent
 import android.os.Build
 import android.os.Bundle
 import android.view.View
@@ -11,7 +8,6 @@ import android.widget.AdapterView
 import android.widget.ArrayAdapter
 import android.widget.Spinner
 import androidx.core.content.ContextCompat
-import androidx.core.content.getSystemService
 import androidx.core.graphics.toColorInt
 import androidx.core.text.HtmlCompat
 import androidx.core.view.isVisible
@@ -20,6 +16,7 @@ import androidx.lifecycle.lifecycleScope
 import dagger.hilt.android.AndroidEntryPoint
 import io.homeassistant.companion.android.common.R as commonR
 import io.homeassistant.companion.android.database.widget.TemplateWidgetDao
+import io.homeassistant.companion.android.database.widget.TemplateWidgetEntity
 import io.homeassistant.companion.android.database.widget.WidgetBackgroundType
 import io.homeassistant.companion.android.databinding.WidgetTemplateConfigureBinding
 import io.homeassistant.companion.android.settings.widgets.ManageWidgetsViewModel
@@ -27,7 +24,6 @@ import io.homeassistant.companion.android.util.applySafeDrawingInsets
 import io.homeassistant.companion.android.util.getHexForColor
 import io.homeassistant.companion.android.widgets.BaseWidgetConfigureActivity
 import io.homeassistant.companion.android.widgets.common.WidgetUtils
-import javax.inject.Inject
 import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.launch
 import kotlinx.coroutines.withContext
@@ -35,16 +31,7 @@ import kotlinx.serialization.SerializationException
 import timber.log.Timber
 
 @AndroidEntryPoint
-class TemplateWidgetConfigureActivity : BaseWidgetConfigureActivity() {
-    companion object {
-        private const val PIN_WIDGET_CALLBACK =
-            "io.homeassistant.companion.android.widgets.template.TemplateWidgetConfigureActivity.PIN_WIDGET_CALLBACK"
-    }
-
-    @Inject
-    lateinit var templateWidgetDao: TemplateWidgetDao
-    override val dao get() = templateWidgetDao
-
+class TemplateWidgetConfigureActivity : BaseWidgetConfigureActivity<TemplateWidgetEntity, TemplateWidgetDao>() {
     private lateinit var binding: WidgetTemplateConfigureBinding
 
     override val serverSelect: View
@@ -95,7 +82,7 @@ class TemplateWidgetConfigureActivity : BaseWidgetConfigureActivity() {
             )
 
         lifecycleScope.launch {
-            val templateWidget = templateWidgetDao.get(appWidgetId)
+            val templateWidget = dao.get(appWidgetId)
 
             setupServerSelect(templateWidget?.serverId)
 
@@ -155,30 +142,55 @@ class TemplateWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         binding.addButton.setOnClickListener {
             if (requestLauncherSetup) {
                 if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
-                    getSystemService<AppWidgetManager>()?.requestPinAppWidget(
-                        ComponentName(this, TemplateWidget::class.java),
-                        null,
-                        PendingIntent.getActivity(
-                            this,
-                            System.currentTimeMillis().toInt(),
-                            Intent(
-                                this,
-                                TemplateWidgetConfigureActivity::class.java,
-                            ).putExtra(PIN_WIDGET_CALLBACK, true).setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP),
-                            PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_MUTABLE,
-                        ),
-                    )
+                    lifecycleScope.launch {
+                        requestWidgetCreation()
+                    }
                 } else {
                     showAddWidgetError() // this shouldn't be possible
                 }
             } else {
-                onAddWidget()
+                lifecycleScope.launch {
+                    updateWidget()
+                }
             }
         }
     }
 
     override fun onServerSelected(serverId: Int) = renderTemplateText()
 
+    override suspend fun getPendingDaoEntity(): TemplateWidgetEntity {
+        val serverId = checkNotNull(selectedServerId) { "Selected server ID is null" }
+        val template = checkNotNull(binding.templateText.text?.toString()) { "Template text is null" }
+
+        return TemplateWidgetEntity(
+            id = appWidgetId,
+            serverId = serverId,
+            template = template,
+            textSize = binding.textSize.text.toString().toFloat(),
+            backgroundType = when (binding.backgroundType.selectedItem as String?) {
+                getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
+                getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
+                else -> WidgetBackgroundType.DAYNIGHT
+            },
+            textColor = if (binding.backgroundType.selectedItem as String? ==
+                getString(commonR.string.widget_background_type_transparent)
+            ) {
+                getHexForColor(
+                    if (binding.textColorWhite.isChecked) {
+                        android.R.color.white
+                    } else {
+                        commonR.color.colorWidgetButtonLabelBlack
+                    },
+                )
+            } else {
+                null
+            },
+            lastUpdate = dao.get(appWidgetId)?.lastUpdate ?: "Loading",
+        )
+    }
+
+    override val widgetClass: Class<*> = TemplateWidget::class.java
+
     private fun renderTemplateText() {
         val editableText = binding.templateText.text ?: return
         if (editableText.isNotEmpty()) {
@@ -189,64 +201,6 @@ class TemplateWidgetConfigureActivity : BaseWidgetConfigureActivity() {
         }
     }
 
-    private fun onAddWidget() {
-        if (appWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
-            showAddWidgetError()
-            return
-        }
-
-        val createIntent = Intent().apply {
-            action = TemplateWidget.RECEIVE_DATA
-            component = ComponentName(applicationContext, TemplateWidget::class.java)
-            putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)
-            putExtra(TemplateWidget.EXTRA_SERVER_ID, selectedServerId)
-            putExtra(TemplateWidget.EXTRA_TEMPLATE, binding.templateText.text.toString())
-            putExtra(TemplateWidget.EXTRA_TEXT_SIZE, binding.textSize.text.toString().toFloat())
-            putExtra(
-                TemplateWidget.EXTRA_BACKGROUND_TYPE,
-                when (binding.backgroundType.selectedItem as String?) {
-                    getString(commonR.string.widget_background_type_dynamiccolor) -> WidgetBackgroundType.DYNAMICCOLOR
-                    getString(commonR.string.widget_background_type_transparent) -> WidgetBackgroundType.TRANSPARENT
-                    else -> WidgetBackgroundType.DAYNIGHT
-                },
-            )
-            putExtra(
-                TemplateWidget.EXTRA_TEXT_COLOR,
-                if (binding.backgroundType.selectedItem as String? ==
-                    getString(commonR.string.widget_background_type_transparent)
-                ) {
-                    getHexForColor(
-                        if (binding.textColorWhite.isChecked) {
-                            android.R.color.white
-                        } else {
-                            commonR.color.colorWidgetButtonLabelBlack
-                        },
-                    )
-                } else {
-                    null
-                },
-            )
-        }
-        applicationContext.sendBroadcast(createIntent)
-
-        setResult(
-            RESULT_OK,
-            Intent().putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId),
-        )
-        finish()
-    }
-
-    override fun onNewIntent(intent: Intent) {
-        super.onNewIntent(intent)
-        if (intent.extras != null && intent.hasExtra(PIN_WIDGET_CALLBACK)) {
-            appWidgetId = intent.extras!!.getInt(
-                AppWidgetManager.EXTRA_APPWIDGET_ID,
-                AppWidgetManager.INVALID_APPWIDGET_ID,
-            )
-            onAddWidget()
-        }
-    }
-
     private fun renderTemplateText(template: String) {
         lifecycleScope.launch {
             var templateText: String?
diff --git a/automotive/lint-baseline.xml b/automotive/lint-baseline.xml
index 960527f2bd8..6245ebedf3e 100644
--- a/automotive/lint-baseline.xml
+++ b/automotive/lint-baseline.xml
@@ -107,7 +107,7 @@
         errorLine2="                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="src/main/AndroidManifest.xml"
-            line="922"
+            line="917"
             column="27"/>
     </issue>
 
@@ -349,7 +349,7 @@
         errorLine2="      ~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/launch/LaunchActivity.kt"
-            line="49"
+            line="51"
             column="7"/>
     </issue>
 
@@ -371,7 +371,7 @@
         errorLine2="            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="src/main/AndroidManifest.xml"
-            line="439"
+            line="434"
             column="13"/>
     </issue>
 
@@ -562,6 +562,17 @@
             column="29"/>
     </issue>
 
+    <issue
+        id="ObsoleteSdkInt"
+        message="Unnecessary; `SDK_INT` is always >= 26"
+        errorLine1="    @RequiresApi(Build.VERSION_CODES.O)"
+        errorLine2="    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
+        <location
+            file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/BaseWidgetConfigureActivity.kt"
+            line="116"
+            column="5"/>
+    </issue>
+
     <issue
         id="ObsoleteSdkInt"
         message="Unnecessary; `SDK_INT` is always >= 29"
@@ -569,7 +580,7 @@
         errorLine2="                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt"
-            line="371"
+            line="358"
             column="21"/>
     </issue>
 
@@ -580,7 +591,7 @@
         errorLine2="                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/camera/CameraWidgetConfigureActivity.kt"
-            line="73"
+            line="59"
             column="21"/>
     </issue>
 
@@ -690,7 +701,7 @@
         errorLine2="                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/entity/EntityWidgetConfigureActivity.kt"
-            line="90"
+            line="76"
             column="21"/>
     </issue>
 
@@ -1163,7 +1174,7 @@
         errorLine2="                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/mediaplayer/MediaPlayerControlsWidgetConfigureActivity.kt"
-            line="77"
+            line="63"
             column="21"/>
     </issue>
 
@@ -1867,7 +1878,7 @@
         errorLine2="                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/template/TemplateWidgetConfigureActivity.kt"
-            line="157"
+            line="144"
             column="21"/>
     </issue>
 
@@ -2373,7 +2384,7 @@
         errorLine2="                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/qs/TileExtensions.kt"
-            line="285"
+            line="284"
             column="17"/>
     </issue>
 
@@ -2960,7 +2971,7 @@
         errorLine2="                        ~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/button/ButtonWidget.kt"
-            line="306"
+            line="317"
             column="25"/>
     </issue>
 
@@ -2971,19 +2982,19 @@
         errorLine2="                                ~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt"
-            line="163"
+            line="150"
             column="33"/>
     </issue>
 
     <issue
         id="AvoidAnySerializer"
         message="Prefer polymorphic serializer over AnySerializer."
-        errorLine1="                kotlinJsonMapper.encodeToString(MapAnySerializer, actionDataMap),"
-        errorLine2="                                                ~~~~~~~~~~~~~~~~">
+        errorLine1="            serviceData = kotlinJsonMapper.encodeToString(MapAnySerializer, actionDataMap),"
+        errorLine2="                                                          ~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/button/ButtonWidgetConfigureActivity.kt"
-            line="510"
-            column="49"/>
+            line="415"
+            column="59"/>
     </issue>
 
     <issue
@@ -3224,7 +3235,7 @@
         errorLine2="                                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/entity/EntityWidgetConfigureActivity.kt"
-            line="140"
+            line="118"
             column="42"/>
     </issue>
 
@@ -3235,7 +3246,7 @@
         errorLine2="                                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~">
         <location
             file="${:automotive*fullDebug*MAIN*sourceProvider*0*javaDir*5}/io/homeassistant/companion/android/widgets/template/TemplateWidgetConfigureActivity.kt"
-            line="104"
+            line="91"
             column="42"/>
     </issue>
 
diff --git a/automotive/src/main/AndroidManifest.xml b/automotive/src/main/AndroidManifest.xml
index 721777c6208..b8191f7eafd 100644
--- a/automotive/src/main/AndroidManifest.xml
+++ b/automotive/src/main/AndroidManifest.xml
@@ -121,7 +121,6 @@
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
                 <action android:name="io.homeassistant.companion.android.widgets.ButtonWidget.CALL_SERVICE" />
                 <action android:name="io.homeassistant.companion.android.widgets.ButtonWidget.CALL_SERVICE_AUTH" />
-                <action android:name="io.homeassistant.companion.android.widgets.ButtonWidget.RECEIVE_DATA" />
             </intent-filter>
 
             <meta-data
@@ -133,7 +132,6 @@
             android:exported="false">
             <intent-filter>
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.camera.CameraWidget.RECEIVE_DATA" />
                 <action android:name="io.homeassistant.companion.android.widgets.camera.CameraWidget.UPDATE_IMAGE" />
             </intent-filter>
 
@@ -146,7 +144,6 @@
             android:exported="false">
             <intent-filter>
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.StaticWidget.RECEIVE_DATA" />
             </intent-filter>
 
             <meta-data
@@ -158,7 +155,6 @@
             android:exported="false">
             <intent-filter>
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.RECEIVE_DATA" />
                 <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.UPDATE_MEDIA_IMAGE" />
                 <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.CALL_PREV_TRACK" />
                 <action android:name="io.homeassistant.companion.android.widgets.media_player_controls.MediaPlayerControlsWidget.CALL_REWIND" />
@@ -183,7 +179,6 @@
                 <action android:name="android.bluetooth.device.action.ACL_DISCONNECTED" />
                 <action android:name="io.homeassistant.companion.android.background.REQUEST_SENSORS_UPDATE" />
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
-                <action android:name="io.homeassistant.companion.android.widgets.template.TemplateWidget.RECEIVE_DATA" />
             </intent-filter>
 
             <meta-data
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt
index 890d679e03d..f64f8ab43c4 100644
--- a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/ButtonWidgetDao.kt
@@ -25,4 +25,7 @@ interface ButtonWidgetDao : WidgetDao<ButtonWidgetEntity> {
 
     @Query("SELECT * FROM button_widgets")
     fun getAllFlow(): Flow<List<ButtonWidgetEntity>>
+
+    @Query("SELECT COUNT(*) FROM button_widgets")
+    override fun getWidgetCountFlow(): Flow<Int>
 }
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt
index b42c0e801aa..0a678d24c70 100755
--- a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/CameraWidgetDao.kt
@@ -26,4 +26,7 @@ interface CameraWidgetDao : WidgetDao<CameraWidgetEntity> {
 
     @Query("SELECT * FROM camera_widgets")
     fun getAllFlow(): Flow<List<CameraWidgetEntity>>
+
+    @Query("SELECT COUNT(*) FROM camera_widgets")
+    override fun getWidgetCountFlow(): Flow<Int>
 }
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt
index 823919c9bb3..89a0528ffa8 100644
--- a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/MediaPlayerControlsWidgetDao.kt
@@ -25,4 +25,7 @@ interface MediaPlayerControlsWidgetDao : WidgetDao<MediaPlayerControlsWidgetEnti
 
     @Query("SELECT * FROM media_player_controls_widgets")
     fun getAllFlow(): Flow<List<MediaPlayerControlsWidgetEntity>>
+
+    @Query("SELECT COUNT(*) FROM media_player_controls_widgets")
+    override fun getWidgetCountFlow(): Flow<Int>
 }
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt
index cfee7d24c3f..f2a9608414c 100644
--- a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/StaticWidgetDao.kt
@@ -29,4 +29,7 @@ interface StaticWidgetDao : WidgetDao<StaticWidgetEntity> {
 
     @Query("UPDATE static_widget SET last_update = :lastUpdate WHERE id = :widgetId")
     suspend fun updateWidgetLastUpdate(widgetId: Int, lastUpdate: String)
+
+    @Query("SELECT COUNT(*) FROM static_widget")
+    override fun getWidgetCountFlow(): Flow<Int>
 }
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt
index 8b8c4536d01..975a89b1b5e 100644
--- a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TemplateWidgetDao.kt
@@ -29,4 +29,7 @@ interface TemplateWidgetDao : WidgetDao<TemplateWidgetEntity> {
 
     @Query("UPDATE template_widgets SET last_update = :lastUpdate WHERE id = :widgetId")
     suspend fun updateTemplateWidgetLastUpdate(widgetId: Int, lastUpdate: String)
+
+    @Query("SELECT COUNT(*) FROM template_widgets")
+    override fun getWidgetCountFlow(): Flow<Int>
 }
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TodoWidgetDao.kt b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TodoWidgetDao.kt
index 3c362eaf15a..38de3d75292 100644
--- a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TodoWidgetDao.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/TodoWidgetDao.kt
@@ -37,5 +37,5 @@ interface TodoWidgetDao : WidgetDao<TodoWidgetEntity> {
     suspend fun updateWidgetLastUpdate(widgetId: Int, lastUpdateData: TodoWidgetEntity.LastUpdateData)
 
     @Query("SELECT COUNT(*) FROM todo_widget")
-    fun getWidgetCountFlow(): Flow<Int>
+    override fun getWidgetCountFlow(): Flow<Int>
 }
diff --git a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/WidgetDao.kt b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/WidgetDao.kt
index 1ec027dab92..7fe082b5cfd 100644
--- a/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/WidgetDao.kt
+++ b/common/src/main/kotlin/io/homeassistant/companion/android/database/widget/WidgetDao.kt
@@ -1,7 +1,10 @@
 package io.homeassistant.companion.android.database.widget
 
+import kotlinx.coroutines.flow.Flow
+
 interface WidgetDao<T : WidgetEntity<T>> {
     suspend fun add(entity: T)
     suspend fun delete(id: Int)
     suspend fun deleteAll(ids: IntArray)
+    fun getWidgetCountFlow(): Flow<Int>
 }
