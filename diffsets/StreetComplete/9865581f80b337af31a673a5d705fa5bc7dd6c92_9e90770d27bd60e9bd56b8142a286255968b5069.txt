diff --git a/app/src/main/java/de/westnordost/streetcomplete/controls/NotificationButtonFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/controls/NotificationButtonFragment.kt
index ae9efedcac5..60b42d6cbdb 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/controls/NotificationButtonFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/controls/NotificationButtonFragment.kt
@@ -30,14 +30,7 @@ class NotificationButtonFragment : Fragment(R.layout.fragment_notification_butto
 
     private var notificationsSourceUpdateListener = object : NotificationsSource.UpdateListener {
         override fun onNumberOfNotificationsUpdated(numberOfNotifications: Int) {
-            lifecycleScope.launch {
-                notificationButton.notificationsCount = numberOfNotifications
-                if (notificationButton.isVisible && numberOfNotifications == 0) {
-                    notificationButton.popOut()
-                } else if(!notificationButton.isVisible && numberOfNotifications > 0) {
-                    notificationButton.popIn()
-                }
-            }
+            lifecycleScope.launch { updateButtonStateAnimated(numberOfNotifications) }
         }
     }
 
@@ -47,26 +40,39 @@ class NotificationButtonFragment : Fragment(R.layout.fragment_notification_butto
 
     override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         super.onViewCreated(view, savedInstanceState)
-        notificationButton.setOnClickListener {
-            val notification = notificationsSource.popNextNotification()
-            if (notification != null) {
-                listener?.onClickShowNotification(notification)
-            }
-        }
+        notificationButton.setOnClickListener { lifecycleScope.launch { onClickButton() } }
     }
 
     override fun onStart() {
         super.onStart()
         notificationsSource.addListener(notificationsSourceUpdateListener)
-        lifecycleScope.launch {
-            val numberOfNotifications = withContext(Dispatchers.IO) { notificationsSource.getNumberOfNotifications() }
-            notificationButton.notificationsCount = numberOfNotifications
-            notificationButton.isGone = numberOfNotifications <= 0
-        }
+        lifecycleScope.launch { initializeButtonState() }
     }
 
     override fun onStop() {
         super.onStop()
         notificationsSource.removeListener(notificationsSourceUpdateListener)
     }
+
+    private suspend fun initializeButtonState() {
+        val numberOfNotifications = withContext(Dispatchers.IO) { notificationsSource.getNumberOfNotifications() }
+        notificationButton.notificationsCount = numberOfNotifications
+        notificationButton.isGone = numberOfNotifications <= 0
+    }
+
+    private fun updateButtonStateAnimated(numberOfNotifications: Int) {
+        notificationButton.notificationsCount = numberOfNotifications
+        if (notificationButton.isVisible && numberOfNotifications == 0) {
+            notificationButton.popOut()
+        } else if(!notificationButton.isVisible && numberOfNotifications > 0) {
+            notificationButton.popIn()
+        }
+    }
+
+    private suspend fun onClickButton() {
+        val notification = withContext(Dispatchers.IO) { notificationsSource.popNextNotification() }
+        if (notification != null) {
+            listener?.onClickShowNotification(notification)
+        }
+    }
 }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/controls/UndoButtonFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/controls/UndoButtonFragment.kt
index f14a4820b5e..516967c02fb 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/controls/UndoButtonFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/controls/UndoButtonFragment.kt
@@ -64,18 +64,13 @@ class UndoButtonFragment : Fragment(R.layout.fragment_undo_button) {
 
         undoButton.setOnClickListener {
             undoButton.isEnabled = false
-            lifecycleScope.launch {
-                val change = getMostRecentUndoableEdit()
-                if (change != null) confirmUndo(change)
-            }
+            lifecycleScope.launch { confirmUndo() }
         }
     }
 
     override fun onStart() {
         super.onStart()
-        lifecycleScope.launch {
-            updateUndoButtonVisibility()
-        }
+        lifecycleScope.launch { updateUndoButtonVisibility() }
         updateUndoButtonEnablement(true)
         elementEditsController.addListener(osmElementChangesListener)
         uploadProgressSource.addUploadProgressListener(uploadProgressListener)
@@ -89,8 +84,9 @@ class UndoButtonFragment : Fragment(R.layout.fragment_undo_button) {
 
     /* ------------------------------------------------------------------------------------------ */
 
-    private fun confirmUndo(edit: ElementEdit) {
+    private suspend fun confirmUndo() {
         val ctx = context ?: return
+        val edit = getMostRecentUndoableEdit() ?: return
         val element = mapDataSource.get(edit.elementType, edit.elementId)
 
         val inner = LayoutInflater.from(ctx).inflate(R.layout.dialog_undo, null, false)
@@ -103,7 +99,7 @@ class UndoButtonFragment : Fragment(R.layout.fragment_undo_button) {
             .setTitle(R.string.undo_confirm_title)
             .setView(inner)
             .setPositiveButton(R.string.undo_confirm_positive) { _, _ ->
-                lifecycleScope.launch { withContext(Dispatchers.IO) { elementEditsController.undo(edit.id) } }
+                lifecycleScope.launch { undo(edit) }
                 updateUndoButtonEnablement(true)
             }
             .setNegativeButton(R.string.undo_confirm_negative) { _, _ -> updateUndoButtonEnablement(true) }
@@ -134,4 +130,8 @@ class UndoButtonFragment : Fragment(R.layout.fragment_undo_button) {
     private suspend fun getMostRecentUndoableEdit() = withContext(Dispatchers.IO) {
         elementEditsController.getMostRecentUndoableEdit()
     }
+
+    private suspend fun undo(edit: ElementEdit) = withContext(Dispatchers.IO) {
+        elementEditsController.undo(edit.id)
+    }
 }
