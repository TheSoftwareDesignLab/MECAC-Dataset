diff --git a/app/src/main/java/de/westnordost/streetcomplete/ktx/View.kt b/app/src/main/java/de/westnordost/streetcomplete/ktx/View.kt
index 1985ac5a450..736302e5a71 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/ktx/View.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/ktx/View.kt
@@ -3,12 +3,14 @@ package de.westnordost.streetcomplete.ktx
 import android.graphics.Point
 import android.os.Build
 import android.view.View
+import android.view.ViewGroup
 import android.view.ViewPropertyAnimator
 import android.view.animation.AccelerateInterpolator
 import android.view.animation.DecelerateInterpolator
 import androidx.core.os.postDelayed
 import androidx.core.view.doOnLayout
 import androidx.core.view.doOnPreDraw
+import androidx.core.view.updateLayoutParams
 import kotlin.coroutines.resume
 import kotlin.coroutines.suspendCoroutine
 
@@ -55,3 +57,18 @@ fun View.showTapHint(initialDelay: Long = 300, pressedDelay: Long = 600) {
         }
     }
 }
+
+fun View.setMargins(left: Int, top: Int, right: Int, bottom: Int) {
+    updateLayoutParams<ViewGroup.MarginLayoutParams> { setMargins(left, top, right, bottom) }
+}
+
+fun View.updateMargins(left: Int? = null, top: Int? = null, right: Int? = null, bottom: Int? = null) {
+    updateLayoutParams<ViewGroup.MarginLayoutParams> {
+        setMargins(
+            left ?: leftMargin,
+            top ?: topMargin,
+            right ?: rightMargin,
+            bottom ?: bottomMargin
+        )
+    }
+}
diff --git a/app/src/main/java/de/westnordost/streetcomplete/map/MainFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/map/MainFragment.kt
index 2f5302d84e9..a8322278f8b 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/map/MainFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/map/MainFragment.kt
@@ -10,7 +10,6 @@ import android.graphics.RectF
 import android.location.Location
 import android.location.LocationManager
 import android.net.ConnectivityManager
-import android.os.Build
 import android.os.Bundle
 import android.os.Handler
 import android.os.Looper
@@ -31,7 +30,6 @@ import androidx.core.graphics.minus
 import androidx.core.graphics.toPointF
 import androidx.core.graphics.toRectF
 import androidx.core.view.isGone
-import androidx.core.view.updateLayoutParams
 import androidx.fragment.app.Fragment
 import androidx.fragment.app.FragmentManager.POP_BACK_STACK_INCLUSIVE
 import androidx.fragment.app.commit
@@ -50,10 +48,7 @@ import de.westnordost.streetcomplete.data.osm.elementgeometry.ElementPolylinesGe
 import de.westnordost.streetcomplete.data.osm.osmquest.OsmQuest
 import de.westnordost.streetcomplete.data.osm.splitway.SplitPolylineAtPosition
 import de.westnordost.streetcomplete.data.quest.*
-import de.westnordost.streetcomplete.ktx.childFragmentManagerOrNull
-import de.westnordost.streetcomplete.ktx.getLocationInWindow
-import de.westnordost.streetcomplete.ktx.toPx
-import de.westnordost.streetcomplete.ktx.toast
+import de.westnordost.streetcomplete.ktx.*
 import de.westnordost.streetcomplete.location.FineLocationManager
 import de.westnordost.streetcomplete.location.LocationRequestFragment
 import de.westnordost.streetcomplete.location.LocationState
@@ -61,7 +56,7 @@ import de.westnordost.streetcomplete.location.LocationUtil
 import de.westnordost.streetcomplete.map.tangram.CameraPosition
 import de.westnordost.streetcomplete.quests.*
 import de.westnordost.streetcomplete.util.*
-import de.westnordost.streetcomplete.view.insets_animation.enableSmoothImeAnimation
+import de.westnordost.streetcomplete.view.insets_animation.respectSystemInsets
 import kotlinx.android.synthetic.main.fragment_main.*
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.Dispatchers
@@ -142,7 +137,10 @@ class MainFragment : Fragment(R.layout.fragment_main),
     override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         super.onViewCreated(view, savedInstanceState)
 
-        setupFittingToSystemWindowInsets()
+        mapControls.respectSystemInsets(View::setMargins)
+        view.respectSystemInsets { left, top, right, bottom ->
+            windowInsets = Rect(left, top, right, bottom)
+        }
 
         locationPointerPin.setOnClickListener { onClickLocationPointer() }
 
@@ -155,30 +153,6 @@ class MainFragment : Fragment(R.layout.fragment_main),
         updateMapQuestOffsets()
     }
 
-    private fun setupFittingToSystemWindowInsets() {
-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
-            view?.findViewById<View>(R.id.map_bottom_sheet_container)?.enableSmoothImeAnimation()
-
-            view?.setOnApplyWindowInsetsListener { _, insets ->
-                mapControls.updateLayoutParams<ViewGroup.MarginLayoutParams> {
-                    setMargins(
-                        insets.systemWindowInsetLeft,
-                        insets.systemWindowInsetTop,
-                        insets.systemWindowInsetRight,
-                        insets.systemWindowInsetBottom
-                    )
-                }
-                windowInsets = Rect(
-                    insets.systemWindowInsetLeft,
-                    insets.systemWindowInsetTop,
-                    insets.systemWindowInsetRight,
-                    insets.systemWindowInsetBottom
-                )
-                insets
-            }
-        }
-    }
-
     override fun onAttachFragment(childFragment: Fragment) {
         super.onAttachFragment(childFragment)
         if (childFragment is QuestsMapFragment) {
diff --git a/app/src/main/java/de/westnordost/streetcomplete/map/MapFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/map/MapFragment.kt
index 5daa4a8e203..bca5861f044 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/map/MapFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/map/MapFragment.kt
@@ -17,7 +17,6 @@ import androidx.annotation.CallSuper
 import androidx.appcompat.app.AlertDialog
 import androidx.core.content.edit
 import androidx.core.net.toUri
-import androidx.core.view.updateLayoutParams
 import androidx.fragment.app.Fragment
 import androidx.preference.PreferenceManager
 import com.mapzen.tangram.MapView
@@ -34,8 +33,10 @@ import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.ktx.awaitLayout
 import de.westnordost.streetcomplete.ktx.containsAll
+import de.westnordost.streetcomplete.ktx.setMargins
 import de.westnordost.streetcomplete.ktx.tryStartActivity
 import de.westnordost.streetcomplete.map.tangram.*
+import de.westnordost.streetcomplete.view.insets_animation.respectSystemInsets
 import kotlinx.android.synthetic.main.fragment_map.*
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.Dispatchers
@@ -103,7 +104,7 @@ open class MapFragment : Fragment(),
         mapTileProviderLink.text = vectorTileProvider.copyrightText
         mapTileProviderLink.setOnClickListener { showOpenUrlDialog(vectorTileProvider.copyrightLink) }
 
-        setupFittingToSystemWindowInsets()
+        attributionContainer.respectSystemInsets(View::setMargins)
 
         launch { initMap() }
     }
@@ -124,22 +125,6 @@ open class MapFragment : Fragment(),
         return tryStartActivity(intent)
     }
 
-    private fun setupFittingToSystemWindowInsets() {
-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
-            view?.setOnApplyWindowInsetsListener { _, insets ->
-                attributionContainer.updateLayoutParams<ViewGroup.MarginLayoutParams> {
-                    setMargins(
-                        insets.systemWindowInsetLeft,
-                        insets.systemWindowInsetTop,
-                        insets.systemWindowInsetRight,
-                        insets.systemWindowInsetBottom
-                    )
-                }
-                insets
-            }
-        }
-    }
-
     override fun onStart() {
         super.onStart()
         launch { reinitializeMapIfNecessary() }
@@ -362,7 +347,7 @@ open class MapFragment : Fragment(),
 
     /* ------------------------------- Controlling the map -------------------------------------- */
 
-    public fun adjustToOffsets(oldOffset: RectF, newOffset: RectF) {
+    fun adjustToOffsets(oldOffset: RectF, newOffset: RectF) {
         controller?.screenCenterToLatLon(oldOffset)?.let { pos ->
             controller?.updateCameraPosition {
                 position = controller?.getLatLonThatCentersLatLon(pos, newOffset)
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/AbstractBottomSheetFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/AbstractBottomSheetFragment.kt
index eae21ac1090..598b6847bbb 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/AbstractBottomSheetFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/AbstractBottomSheetFragment.kt
@@ -7,8 +7,6 @@ import android.os.Bundle
 import android.os.Handler
 import android.os.Looper
 import android.view.View
-import android.view.ViewGroup
-import android.view.WindowInsets
 import android.view.animation.AnimationUtils
 import androidx.annotation.UiThread
 import androidx.appcompat.app.AlertDialog
@@ -21,7 +19,9 @@ import de.westnordost.osmapi.map.data.LatLon
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.ktx.toDp
 import de.westnordost.streetcomplete.ktx.toPx
+import de.westnordost.streetcomplete.ktx.updateMargins
 import de.westnordost.streetcomplete.view.RoundRectOutlineProvider
+import de.westnordost.streetcomplete.view.insets_animation.respectSystemInsets
 import kotlinx.android.synthetic.main.fragment_quest_answer.*
 
 /** Abstract base class for (quest) bottom sheets
@@ -56,7 +56,11 @@ abstract class AbstractBottomSheetFragment : Fragment(), IsCloseableBottomSheet
 
         closeButton.setOnClickListener { activity?.onBackPressed() }
 
-        setupFittingToSystemWindowInsets()
+        view.respectSystemInsets { left, top, right, bottom ->
+            scrollViewChild.updatePadding(bottom = bottom)
+            bottomSheetContainer.updateMargins(top = top, left = left, right = right)
+            okButton.updateMargins(bottom = bottom + 8f.toPx(context).toInt())
+        }
 
         bottomSheetBehavior = BottomSheetBehavior.from(bottomSheet)
 
@@ -123,30 +127,6 @@ abstract class AbstractBottomSheetFragment : Fragment(), IsCloseableBottomSheet
         }
     }
 
-    private fun setupFittingToSystemWindowInsets() {
-        if (Build.VERSION.SDK_INT >= 21) {
-            view?.setOnApplyWindowInsetsListener { v: View, insets: WindowInsets ->
-
-                scrollViewChild.updatePadding(bottom = insets.systemWindowInsetBottom)
-
-                okButton.updateLayoutParams<ViewGroup.MarginLayoutParams> {
-                    val defaultMargin = 8f.toPx(v.context).toInt()
-                    updateMargins(bottom = insets.systemWindowInsetBottom + defaultMargin)
-                }
-
-                bottomSheetContainer.updateLayoutParams<ViewGroup.MarginLayoutParams> {
-                    updateMargins(
-                        top = insets.systemWindowInsetTop,
-                        left = insets.systemWindowInsetLeft,
-                        right = insets.systemWindowInsetRight
-                    )
-                }
-
-                insets
-            }
-        }
-    }
-
     protected fun expand() {
         bottomSheetBehavior.state = STATE_EXPANDED
     }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/SplitWayFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/SplitWayFragment.kt
index c8e0ee24ea5..d78144bc587 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/SplitWayFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/SplitWayFragment.kt
@@ -8,8 +8,6 @@ import android.graphics.drawable.Animatable
 import android.os.Build
 import android.os.Bundle
 import android.view.View
-import android.view.ViewGroup
-import android.view.WindowInsets
 import android.view.animation.AnimationUtils
 import android.widget.RelativeLayout
 import androidx.annotation.UiThread
@@ -35,6 +33,7 @@ import de.westnordost.streetcomplete.util.alongTrackDistanceTo
 import de.westnordost.streetcomplete.util.crossTrackDistanceTo
 import de.westnordost.streetcomplete.util.distanceTo
 import de.westnordost.streetcomplete.view.RoundRectOutlineProvider
+import de.westnordost.streetcomplete.view.insets_animation.respectSystemInsets
 import kotlinx.android.synthetic.main.fragment_split_way.*
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.Dispatchers
@@ -87,7 +86,7 @@ class SplitWayFragment : Fragment(R.layout.fragment_split_way),
     override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         super.onViewCreated(view, savedInstanceState)
 
-        setupFittingToSystemWindowInsets()
+        bottomSheetContainer.respectSystemInsets(View::setMargins)
 
         splitWayRoot.setOnTouchListener { _, event ->
             clickPos = PointF(event.x, event.y)
@@ -116,24 +115,6 @@ class SplitWayFragment : Fragment(R.layout.fragment_split_way),
         }
     }
 
-    private fun setupFittingToSystemWindowInsets() {
-        if (Build.VERSION.SDK_INT >= 21) {
-            view?.setOnApplyWindowInsetsListener { v: View, insets: WindowInsets ->
-
-                bottomSheetContainer.updateLayoutParams<ViewGroup.MarginLayoutParams> {
-                    setMargins(
-                        insets.systemWindowInsetLeft,
-                        insets.systemWindowInsetTop,
-                        insets.systemWindowInsetRight,
-                        insets.systemWindowInsetBottom
-                    )
-                }
-
-                insets
-            }
-        }
-    }
-
     override fun onConfigurationChanged(newConfig: Configuration) {
         super.onConfigurationChanged(newConfig)
         // see rant comment in AbstractBottomSheetFragment
diff --git a/app/src/main/java/de/westnordost/streetcomplete/tutorial/TutorialFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/tutorial/TutorialFragment.kt
index 65031a1f639..0ae58225601 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/tutorial/TutorialFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/tutorial/TutorialFragment.kt
@@ -8,7 +8,6 @@ import android.os.Bundle
 import android.os.Handler
 import android.os.Looper
 import android.view.View
-import android.view.WindowInsets
 import android.view.animation.AccelerateDecelerateInterpolator
 import android.view.animation.AccelerateInterpolator
 import android.view.animation.BounceInterpolator
@@ -17,6 +16,7 @@ import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.ktx.toDp
 import de.westnordost.streetcomplete.ktx.toPx
 import de.westnordost.streetcomplete.location.LocationState
+import de.westnordost.streetcomplete.view.insets_animation.respectSystemInsets
 import kotlinx.android.synthetic.main.fragment_tutorial.*
 
 /** Shows a short tutorial for first-time users */
@@ -34,13 +34,13 @@ class TutorialFragment : Fragment(R.layout.fragment_tutorial) {
     override fun onCreate(savedInstanceState: Bundle?) {
         super.onCreate(savedInstanceState)
         activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT
-
     }
 
     override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         super.onViewCreated(view, savedInstanceState)
 
-        setupFittingToSystemWindowInsets()
+        view.respectSystemInsets(View::setPadding)
+
         updateIndicatorDots()
 
         nextButton.setOnClickListener {
@@ -67,20 +67,6 @@ class TutorialFragment : Fragment(R.layout.fragment_tutorial) {
         activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED
     }
 
-    private fun setupFittingToSystemWindowInsets() {
-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
-            view?.setOnApplyWindowInsetsListener { v: View?, insets: WindowInsets ->
-                view?.setPadding(
-                    insets.systemWindowInsetLeft,
-                    insets.systemWindowInsetTop,
-                    insets.systemWindowInsetRight,
-                    insets.systemWindowInsetBottom
-                )
-                insets
-            }
-        }
-    }
-
     private fun step1Transition() {
         val ctx = requireContext()
 
@@ -223,4 +209,4 @@ class TutorialFragment : Fragment(R.layout.fragment_tutorial) {
     companion object {
         private const val MAX_PAGE_INDEX = 2
     }
-}
\ No newline at end of file
+}
diff --git a/app/src/main/java/de/westnordost/streetcomplete/view/insets_animation/ImeInsetsAnimationCallback.kt b/app/src/main/java/de/westnordost/streetcomplete/view/insets_animation/ImeInsetsAnimationCallback.kt
index 753387b190f..92c6c4c3cc9 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/view/insets_animation/ImeInsetsAnimationCallback.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/view/insets_animation/ImeInsetsAnimationCallback.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.view.insets_animation
 
-import android.graphics.Insets
 import android.os.Build
 import android.view.View
 import android.view.WindowInsets
@@ -10,20 +9,23 @@ import androidx.annotation.RequiresApi
 /** Make the keyboard appear and disappear smoothly. Must be set on both
  *  setOnApplyWindowInsetsListener and setWindowInsetsAnimationCallback */
 @RequiresApi(Build.VERSION_CODES.R)
-class ImeInsetsAnimationCallback(private val view: View)
-    : WindowInsetsAnimation.Callback(DISPATCH_MODE_STOP), View.OnApplyWindowInsetsListener {
+class ImeInsetsAnimationCallback(
+    private val view: View,
+    private val onNewInsets: View.(left: Int, top: Int, right: Int, bottom: Int) -> Unit
+) : WindowInsetsAnimation.Callback(DISPATCH_MODE_CONTINUE_ON_SUBTREE), View.OnApplyWindowInsetsListener {
 
     private var isAnimating = false
     private var prevInsets: WindowInsets? = null
 
+
     override fun onApplyWindowInsets(v: View, windowInsets: WindowInsets): WindowInsets {
         prevInsets = windowInsets
 
         val imeTypeIfNotAnimated = if (!isAnimating) WindowInsets.Type.ime() else 0
         val typeInsets = windowInsets.getInsets(WindowInsets.Type.systemBars() or imeTypeIfNotAnimated)
-        v.setPadding(typeInsets.left, typeInsets.top, typeInsets.right, typeInsets.bottom)
+        onNewInsets(view, typeInsets.left, typeInsets.top, typeInsets.right, typeInsets.bottom)
 
-        return WindowInsets.CONSUMED
+        return windowInsets
     }
 
     override fun onPrepare(animation: WindowInsetsAnimation) {
@@ -33,21 +35,12 @@ class ImeInsetsAnimationCallback(private val view: View)
     }
 
     override fun onProgress(insets: WindowInsets, runningAnims: List<WindowInsetsAnimation>): WindowInsets {
-        val diff = Insets.max(Insets.subtract(
-            insets.getInsets(WindowInsets.Type.ime()),
-            insets.getInsets(WindowInsets.Type.systemBars())
-        ), Insets.NONE)
-
-        view.translationX = (diff.left - diff.right).toFloat()
-        view.translationY = (diff.top - diff.bottom).toFloat()
-
+        val typeInsets = insets.getInsets(WindowInsets.Type.systemBars() or WindowInsets.Type.ime())
+        onNewInsets(view, typeInsets.left, typeInsets.top, typeInsets.right, typeInsets.bottom)
         return insets
     }
 
     override fun onEnd(animation: WindowInsetsAnimation) {
-        view.translationX = 0f
-        view.translationY = 0f
-
         if (isAnimating && (animation.typeMask and WindowInsets.Type.ime()) != 0) {
             isAnimating = false
             prevInsets?.let { view.dispatchApplyWindowInsets(it) }
@@ -55,10 +48,20 @@ class ImeInsetsAnimationCallback(private val view: View)
     }
 }
 
-fun View.enableSmoothImeAnimation() {
+fun View.respectSystemInsets(onNewInsets: View.(left: Int, top: Int, right: Int, bottom: Int) -> Unit = View::setPadding) {
     if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R) {
-        val imeAnimationCallback = ImeInsetsAnimationCallback(this)
+        val imeAnimationCallback = ImeInsetsAnimationCallback(this, onNewInsets)
         setOnApplyWindowInsetsListener(imeAnimationCallback)
         setWindowInsetsAnimationCallback(imeAnimationCallback)
+    } else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
+        setOnApplyWindowInsetsListener { v, windowInsets ->
+            onNewInsets(v,
+                windowInsets.systemWindowInsetLeft,
+                windowInsets.systemWindowInsetTop,
+                windowInsets.systemWindowInsetRight,
+                windowInsets.systemWindowInsetBottom
+            )
+            windowInsets
+        }
     }
 }
