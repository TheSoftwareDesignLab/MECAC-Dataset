diff --git a/app/src/main/java/de/westnordost/streetcomplete/ApplicationModule.kt b/app/src/main/java/de/westnordost/streetcomplete/ApplicationModule.kt
index 4f16b00b8b6..311efa1a8dd 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/ApplicationModule.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/ApplicationModule.kt
@@ -1,9 +1,7 @@
 package de.westnordost.streetcomplete
 
-import android.content.SharedPreferences
 import android.content.res.AssetManager
 import android.content.res.Resources
-import androidx.preference.PreferenceManager
 import de.westnordost.streetcomplete.util.CrashReportExceptionHandler
 import de.westnordost.streetcomplete.util.SoundFx
 import org.koin.android.ext.koin.androidContext
@@ -12,7 +10,6 @@ import org.koin.dsl.module
 val appModule = module {
     factory<AssetManager> { androidContext().assets }
     factory<Resources> { androidContext().resources }
-    factory<SharedPreferences> { PreferenceManager.getDefaultSharedPreferences(androidContext()) }
 
     single { CrashReportExceptionHandler(androidContext(), "streetcomplete_errors@westnordost.de", "crashreport.txt") }
     single { SoundFx(androidContext()) }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/Prefs.kt b/app/src/main/java/de/westnordost/streetcomplete/Prefs.kt
index 1ad5e982846..da7fa8ce4a6 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/Prefs.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/Prefs.kt
@@ -34,8 +34,6 @@ object Prefs {
     // not shown anywhere directly
     const val SELECTED_QUESTS_PRESET = "selectedQuestsPreset"
     const val LAST_EDIT_TIME = "changesets.lastChangeTime"
-    const val MAP_LATITUDE = "map.latitude"
-    const val MAP_LONGITUDE = "map.longitude"
     const val LAST_PICKED_PREFIX = "imageListLastPicked."
     const val LAST_VERSION = "lastVersion"
     const val LAST_VERSION_DATA = "lastVersion_data"
@@ -44,6 +42,14 @@ object Prefs {
     const val SELECTED_OVERLAY = "selectedOverlay"
     const val HAS_SHOWN_OVERLAYS_TUTORIAL = "hasShownOverlaysTutorial"
 
+    const val MAP_LATITUDE = "map.latitude"
+    const val MAP_LONGITUDE = "map.longitude"
+    const val MAP_ROTATION = "map.rotation"
+    const val MAP_TILT = "map.tilt"
+    const val MAP_ZOOM = "map.zoom"
+    const val MAP_FOLLOWING = "map.following"
+    const val MAP_NAVIGATION_MODE = "map.navigation_mode"
+
     const val PIN_SPRITES_VERSION = "TangramPinsSpriteSheet.version"
     const val PIN_SPRITES = "TangramPinsSpriteSheet.sprites"
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/StreetCompleteApplication.kt b/app/src/main/java/de/westnordost/streetcomplete/StreetCompleteApplication.kt
index 5ea8e74f7c5..51d33300762 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/StreetCompleteApplication.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/StreetCompleteApplication.kt
@@ -2,9 +2,7 @@ package de.westnordost.streetcomplete
 
 import android.app.Application
 import android.content.ComponentCallbacks2
-import android.content.SharedPreferences
 import androidx.appcompat.app.AppCompatDelegate
-import androidx.core.content.edit
 import androidx.work.ExistingPeriodicWorkPolicy
 import androidx.work.PeriodicWorkRequest
 import androidx.work.WorkManager
@@ -51,6 +49,8 @@ import de.westnordost.streetcomplete.util.getSelectedLocale
 import de.westnordost.streetcomplete.util.getSystemLocales
 import de.westnordost.streetcomplete.util.ktx.addedToFront
 import de.westnordost.streetcomplete.util.ktx.nowAsEpochMilliseconds
+import de.westnordost.streetcomplete.util.prefs.Preferences
+import de.westnordost.streetcomplete.util.prefs.preferencesModule
 import de.westnordost.streetcomplete.util.setDefaultLocales
 import kotlinx.coroutines.CoroutineName
 import kotlinx.coroutines.CoroutineScope
@@ -69,7 +69,7 @@ class StreetCompleteApplication : Application() {
     private val crashReportExceptionHandler: CrashReportExceptionHandler by inject()
     private val resurveyIntervalsUpdater: ResurveyIntervalsUpdater by inject()
     private val downloadedTilesController: DownloadedTilesController by inject()
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
     private val editHistoryController: EditHistoryController by inject()
     private val userLoginStatusController: UserLoginStatusController by inject()
     private val cacheTrimmer: CacheTrimmer by inject()
@@ -104,6 +104,7 @@ class StreetCompleteApplication : Application() {
                 osmApiModule,
                 osmNoteQuestModule,
                 osmQuestModule,
+                preferencesModule,
                 questModule,
                 questPresetsModule,
                 questsModule,
@@ -145,7 +146,7 @@ class StreetCompleteApplication : Application() {
 
         val lastVersion = prefs.getString(Prefs.LAST_VERSION_DATA, null)
         if (BuildConfig.VERSION_NAME != lastVersion) {
-            prefs.edit { putString(Prefs.LAST_VERSION_DATA, BuildConfig.VERSION_NAME) }
+            prefs.putString(Prefs.LAST_VERSION_DATA, BuildConfig.VERSION_NAME)
             if (lastVersion != null) {
                 onNewVersion()
             }
@@ -177,7 +178,7 @@ class StreetCompleteApplication : Application() {
     }
 
     private fun setDefaultLocales() {
-        val locale = getSelectedLocale(this)
+        val locale = getSelectedLocale(prefs)
         if (locale != null) {
             setDefaultLocales(getSystemLocales().addedToFront(locale))
         }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MapTilesDownloadCacheConfig.kt b/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MapTilesDownloadCacheConfig.kt
index 44a26d4841c..4e51eafd7ec 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MapTilesDownloadCacheConfig.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MapTilesDownloadCacheConfig.kt
@@ -1,9 +1,9 @@
 package de.westnordost.streetcomplete.data.maptiles
 
 import android.content.Context
-import androidx.preference.PreferenceManager
 import de.westnordost.streetcomplete.ApplicationConstants.DELETE_OLD_DATA_AFTER
 import de.westnordost.streetcomplete.Prefs
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import okhttp3.Cache
 import okhttp3.CacheControl
 import java.io.File
@@ -11,7 +11,7 @@ import java.util.concurrent.TimeUnit
 
 /** Configuration for the common cache shared by tangram-es and the map tile ("pre"-)downloader
  *  integrated into the normal map download process */
-class MapTilesDownloadCacheConfig(context: Context) {
+class MapTilesDownloadCacheConfig(context: Context, prefs: Preferences) {
 
     val cacheControl: CacheControl = CacheControl.Builder()
         .maxAge(12, TimeUnit.HOURS)
@@ -38,7 +38,7 @@ class MapTilesDownloadCacheConfig(context: Context) {
         }
 
         cache = if (tileCacheDir?.exists() == true) {
-            val mbs = PreferenceManager.getDefaultSharedPreferences(context).getInt(Prefs.MAP_TILECACHE_IN_MB, 50)
+            val mbs = prefs.getInt(Prefs.MAP_TILECACHE_IN_MB, 50)
             Cache(tileCacheDir, mbs * 1000L * 1000L)
         } else {
             null
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MaptilesModule.kt b/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MaptilesModule.kt
index 9a36c9fba9d..127ce21d3e2 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MaptilesModule.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/maptiles/MaptilesModule.kt
@@ -5,5 +5,5 @@ import org.koin.dsl.module
 val maptilesModule = module {
     factory { MapTilesDownloader(get(), get()) }
 
-    single { MapTilesDownloadCacheConfig(get()) }
+    single { MapTilesDownloadCacheConfig(get(), get()) }
 }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/messages/MessagesSource.kt b/app/src/main/java/de/westnordost/streetcomplete/data/messages/MessagesSource.kt
index 06851d39df6..43171e3a88d 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/messages/MessagesSource.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/messages/MessagesSource.kt
@@ -1,7 +1,5 @@
 package de.westnordost.streetcomplete.data.messages
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.BuildConfig
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.data.user.UserDataController
@@ -9,6 +7,7 @@ import de.westnordost.streetcomplete.data.user.UserDataSource
 import de.westnordost.streetcomplete.data.user.achievements.Achievement
 import de.westnordost.streetcomplete.data.user.achievements.AchievementsSource
 import de.westnordost.streetcomplete.util.Listeners
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
 /** This class is to access user messages, which are basically dialogs that pop up when
  *  clicking on the mail icon, such as "you have a new OSM message in your inbox" etc. */
@@ -16,7 +15,7 @@ class MessagesSource(
     private val userDataController: UserDataController,
     private val achievementsSource: AchievementsSource,
     private val questSelectionHintController: QuestSelectionHintController,
-    private val prefs: SharedPreferences
+    private val prefs: Preferences
 ) {
     /* Must be a singleton because there is a listener that should respond to a change in the
     *  database table*/
@@ -66,7 +65,7 @@ class MessagesSource(
         val lastVersion = prefs.getString(Prefs.LAST_VERSION, null)
         val hasNewVersion = lastVersion != null && BuildConfig.VERSION_NAME != lastVersion
         if (lastVersion == null) {
-            prefs.edit { putString(Prefs.LAST_VERSION, BuildConfig.VERSION_NAME) }
+            prefs.putString(Prefs.LAST_VERSION, BuildConfig.VERSION_NAME)
         }
 
         var messages = 0
@@ -81,7 +80,7 @@ class MessagesSource(
 
         val lastVersion = prefs.getString(Prefs.LAST_VERSION, null)
         if (BuildConfig.VERSION_NAME != lastVersion) {
-            prefs.edit { putString(Prefs.LAST_VERSION, BuildConfig.VERSION_NAME) }
+            prefs.putString(Prefs.LAST_VERSION, BuildConfig.VERSION_NAME)
             if (lastVersion != null) {
                 onNumberOfMessagesUpdated()
                 return NewVersionMessage("v$lastVersion")
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/messages/QuestSelectionHintController.kt b/app/src/main/java/de/westnordost/streetcomplete/data/messages/QuestSelectionHintController.kt
index 5adc80c16ea..2dad25384a1 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/messages/QuestSelectionHintController.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/messages/QuestSelectionHintController.kt
@@ -1,7 +1,5 @@
 package de.westnordost.streetcomplete.data.messages
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.ApplicationConstants.QUEST_COUNT_AT_WHICH_TO_SHOW_QUEST_SELECTION_HINT
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.data.messages.QuestSelectionHintState.NOT_SHOWN
@@ -10,10 +8,11 @@ import de.westnordost.streetcomplete.data.quest.Quest
 import de.westnordost.streetcomplete.data.quest.QuestKey
 import de.westnordost.streetcomplete.data.quest.VisibleQuestsSource
 import de.westnordost.streetcomplete.util.Listeners
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
 class QuestSelectionHintController(
     private val visibleQuestsSource: VisibleQuestsSource,
-    private val prefs: SharedPreferences
+    private val prefs: Preferences
 ) {
 
     interface Listener {
@@ -23,7 +22,7 @@ class QuestSelectionHintController(
 
     var state: QuestSelectionHintState
         set(value) {
-            prefs.edit { putString(Prefs.QUEST_SELECTION_HINT_STATE, value.toString()) }
+            prefs.putString(Prefs.QUEST_SELECTION_HINT_STATE, value.toString())
             listeners.forEach { it.onQuestSelectionHintStateChanged() }
         }
         get() {
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/osm/edits/upload/LastEditTimeStore.kt b/app/src/main/java/de/westnordost/streetcomplete/data/osm/edits/upload/LastEditTimeStore.kt
index be03d213de0..de5006d6eee 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/osm/edits/upload/LastEditTimeStore.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/osm/edits/upload/LastEditTimeStore.kt
@@ -1,14 +1,13 @@
 package de.westnordost.streetcomplete.data.osm.edits.upload
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.util.ktx.nowAsEpochMilliseconds
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
-class LastEditTimeStore(private val prefs: SharedPreferences) {
+class LastEditTimeStore(private val prefs: Preferences) {
 
     fun touch() {
-        prefs.edit { putLong(Prefs.LAST_EDIT_TIME, nowAsEpochMilliseconds()) }
+        prefs.putLong(Prefs.LAST_EDIT_TIME, nowAsEpochMilliseconds())
     }
 
     fun get(): Long =
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/osmnotes/notequests/NotesPreferences.kt b/app/src/main/java/de/westnordost/streetcomplete/data/osmnotes/notequests/NotesPreferences.kt
index 672325222f7..be7c07dc027 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/osmnotes/notequests/NotesPreferences.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/osmnotes/notequests/NotesPreferences.kt
@@ -1,9 +1,9 @@
 package de.westnordost.streetcomplete.data.osmnotes.notequests
 
-import android.content.SharedPreferences
 import de.westnordost.streetcomplete.Prefs
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
-class NotesPreferences(private val prefs: SharedPreferences) {
+class NotesPreferences(private val prefs: Preferences) {
 
     interface Listener {
         fun onNotesPreferencesChanged()
@@ -11,14 +11,16 @@ class NotesPreferences(private val prefs: SharedPreferences) {
 
     var listener: Listener? = null
 
-    private val sharedPreferencesListener = SharedPreferences.OnSharedPreferenceChangeListener { _, key ->
-        if (key == Prefs.SHOW_NOTES_NOT_PHRASED_AS_QUESTIONS) {
-            listener?.onNotesPreferencesChanged()
+    private val preferencesListener = object : Preferences.Listener {
+        override fun onPreferencesChanged(key: String) {
+            if (key == Prefs.SHOW_NOTES_NOT_PHRASED_AS_QUESTIONS) {
+                listener?.onNotesPreferencesChanged()
+            }
         }
     }
 
     init {
-        prefs.registerOnSharedPreferenceChangeListener(sharedPreferencesListener)
+        prefs.addListener(preferencesListener)
     }
 
     val showOnlyNotesPhrasedAsQuestions: Boolean get() =
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/overlays/SelectedOverlayStore.kt b/app/src/main/java/de/westnordost/streetcomplete/data/overlays/SelectedOverlayStore.kt
index 5adec2e6537..98bd9982b34 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/overlays/SelectedOverlayStore.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/overlays/SelectedOverlayStore.kt
@@ -1,14 +1,13 @@
 package de.westnordost.streetcomplete.data.overlays
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.Prefs
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
-class SelectedOverlayStore(private val prefs: SharedPreferences) {
+class SelectedOverlayStore(private val prefs: Preferences) {
 
     fun get(): String? = prefs.getString(Prefs.SELECTED_OVERLAY, null)
 
     fun set(value: String?) {
-        prefs.edit { putString(Prefs.SELECTED_OVERLAY, value) }
+        prefs.putString(Prefs.SELECTED_OVERLAY, value)
     }
 }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/quest/QuestAutoSyncer.kt b/app/src/main/java/de/westnordost/streetcomplete/data/quest/QuestAutoSyncer.kt
index e58a0ddd2fc..b4f2b2ceb13 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/quest/QuestAutoSyncer.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/quest/QuestAutoSyncer.kt
@@ -5,7 +5,6 @@ import android.content.BroadcastReceiver
 import android.content.Context
 import android.content.Intent
 import android.content.IntentFilter
-import android.content.SharedPreferences
 import android.net.ConnectivityManager
 import android.util.Log
 import androidx.core.content.getSystemService
@@ -26,6 +25,7 @@ import de.westnordost.streetcomplete.data.visiblequests.TeamModeQuestFilter
 import de.westnordost.streetcomplete.util.ktx.format
 import de.westnordost.streetcomplete.util.ktx.toLatLon
 import de.westnordost.streetcomplete.util.location.FineLocationManager
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlinx.coroutines.CoroutineName
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.SupervisorJob
@@ -45,7 +45,7 @@ class QuestAutoSyncer(
     private val unsyncedChangesCountSource: UnsyncedChangesCountSource,
     private val downloadProgressSource: DownloadProgressSource,
     private val userLoginStatusSource: UserLoginStatusSource,
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
     private val teamModeQuestFilter: TeamModeQuestFilter,
     private val downloadedTilesController: DownloadedTilesController
 ) : DefaultLifecycleObserver {
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/user/OAuthStore.kt b/app/src/main/java/de/westnordost/streetcomplete/data/user/OAuthStore.kt
index aa2639253a8..9c71b40aa25 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/user/OAuthStore.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/user/OAuthStore.kt
@@ -1,15 +1,14 @@
 package de.westnordost.streetcomplete.data.user
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.Prefs
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import oauth.signpost.OAuthConsumer
 import org.koin.core.component.KoinComponent
 import org.koin.core.component.get
 
 /** Manages saving and loading OAuthConsumer persistently  */
 class OAuthStore(
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
 ) : KoinComponent {
     var oAuthConsumer: OAuthConsumer?
         get() {
@@ -22,15 +21,11 @@ class OAuthStore(
         }
         set(value) {
             if (value != null && value.token != null && value.tokenSecret != null) {
-                prefs.edit {
-                    putString(Prefs.OAUTH_ACCESS_TOKEN, value.token)
-                    putString(Prefs.OAUTH_ACCESS_TOKEN_SECRET, value.tokenSecret)
-                }
+                prefs.putString(Prefs.OAUTH_ACCESS_TOKEN, value.token)
+                prefs.putString(Prefs.OAUTH_ACCESS_TOKEN_SECRET, value.tokenSecret)
             } else {
-                prefs.edit {
-                    remove(Prefs.OAUTH_ACCESS_TOKEN)
-                    remove(Prefs.OAUTH_ACCESS_TOKEN_SECRET)
-                }
+                prefs.remove(Prefs.OAUTH_ACCESS_TOKEN)
+                prefs.remove(Prefs.OAUTH_ACCESS_TOKEN_SECRET)
             }
         }
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/user/UserDataController.kt b/app/src/main/java/de/westnordost/streetcomplete/data/user/UserDataController.kt
index 20f0647761c..2527cd1d8f4 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/user/UserDataController.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/user/UserDataController.kt
@@ -1,14 +1,13 @@
 package de.westnordost.streetcomplete.data.user
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.osmapi.user.UserDetails
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.util.Listeners
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
 /** Controller that handles user login, logout, auth and updated data */
 class UserDataController(
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
     private val userLoginStatusSource: UserLoginStatusSource
 ) : UserDataSource {
 
@@ -27,7 +26,7 @@ class UserDataController(
     override var unreadMessagesCount: Int
         get() = prefs.getInt(Prefs.OSM_UNREAD_MESSAGES, 0)
         set(value) {
-            prefs.edit(true) { putInt(Prefs.OSM_UNREAD_MESSAGES, value) }
+            prefs.putInt(Prefs.OSM_UNREAD_MESSAGES, value)
             listeners.forEach { it.onUpdated() }
         }
 
@@ -36,20 +35,16 @@ class UserDataController(
     }
 
     fun setDetails(userDetails: UserDetails) {
-        prefs.edit(true) {
-            putLong(Prefs.OSM_USER_ID, userDetails.id)
-            putString(Prefs.OSM_USER_NAME, userDetails.displayName)
-            putInt(Prefs.OSM_UNREAD_MESSAGES, userDetails.unreadMessagesCount)
-        }
+        prefs.putLong(Prefs.OSM_USER_ID, userDetails.id)
+        prefs.putString(Prefs.OSM_USER_NAME, userDetails.displayName)
+        prefs.putInt(Prefs.OSM_UNREAD_MESSAGES, userDetails.unreadMessagesCount)
         listeners.forEach { it.onUpdated() }
     }
 
     private fun clear() {
-        prefs.edit(true) {
-            remove(Prefs.OSM_USER_ID)
-            remove(Prefs.OSM_USER_NAME)
-            remove(Prefs.OSM_UNREAD_MESSAGES)
-        }
+        prefs.remove(Prefs.OSM_USER_ID)
+        prefs.remove(Prefs.OSM_USER_NAME)
+        prefs.remove(Prefs.OSM_UNREAD_MESSAGES)
         listeners.forEach { it.onUpdated() }
     }
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/user/UserLoginStatusController.kt b/app/src/main/java/de/westnordost/streetcomplete/data/user/UserLoginStatusController.kt
index 220f8b6330a..b72a9cbae1c 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/user/UserLoginStatusController.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/user/UserLoginStatusController.kt
@@ -1,16 +1,15 @@
 package de.westnordost.streetcomplete.data.user
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.osmapi.OsmConnection
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.util.Listeners
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import oauth.signpost.OAuthConsumer
 
 class UserLoginStatusController(
     private val oAuthStore: OAuthStore,
     private val osmConnection: OsmConnection,
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
 ) : UserLoginStatusSource {
 
     private val listeners = Listeners<UserLoginStatusSource.Listener>()
@@ -20,14 +19,14 @@ class UserLoginStatusController(
     fun logIn(consumer: OAuthConsumer) {
         oAuthStore.oAuthConsumer = consumer
         osmConnection.oAuth = consumer
-        prefs.edit { putBoolean(Prefs.OSM_LOGGED_IN_AFTER_OAUTH_FUCKUP, true) }
+        prefs.putBoolean(Prefs.OSM_LOGGED_IN_AFTER_OAUTH_FUCKUP, true)
         listeners.forEach { it.onLoggedIn() }
     }
 
     fun logOut() {
         oAuthStore.oAuthConsumer = null
         osmConnection.oAuth = null
-        prefs.edit { putBoolean(Prefs.OSM_LOGGED_IN_AFTER_OAUTH_FUCKUP, false) }
+        prefs.putBoolean(Prefs.OSM_LOGGED_IN_AFTER_OAUTH_FUCKUP, false)
         listeners.forEach { it.onLoggedOut() }
     }
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsController.kt b/app/src/main/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsController.kt
index ce80d898f85..ed670483dde 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsController.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsController.kt
@@ -1,8 +1,6 @@
 package de.westnordost.streetcomplete.data.user.statistics
 
-import android.content.SharedPreferences
 import android.util.Log
-import androidx.core.content.edit
 import de.westnordost.countryboundaries.CountryBoundaries
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.data.osm.mapdata.LatLon
@@ -12,6 +10,7 @@ import de.westnordost.streetcomplete.util.ktx.getIds
 import de.westnordost.streetcomplete.util.ktx.nowAsEpochMilliseconds
 import de.westnordost.streetcomplete.util.ktx.systemTimeNow
 import de.westnordost.streetcomplete.util.ktx.toLocalDate
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlinx.datetime.Instant
 import kotlinx.datetime.LocalDate
 import java.util.concurrent.FutureTask
@@ -24,7 +23,7 @@ class StatisticsController(
     private val currentWeekCountryStatisticsDao: CountryStatisticsDao,
     private val activeDatesDao: ActiveDatesDao,
     private val countryBoundaries: FutureTask<CountryBoundaries>,
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
     userLoginStatusSource: UserLoginStatusSource
 ) : StatisticsSource {
 
@@ -40,38 +39,38 @@ class StatisticsController(
     override var rank: Int
         get() = prefs.getInt(Prefs.USER_GLOBAL_RANK, -1)
         private set(value) {
-            prefs.edit(true) { putInt(Prefs.USER_GLOBAL_RANK, value) }
+            prefs.putInt(Prefs.USER_GLOBAL_RANK, value)
         }
 
     override var daysActive: Int
         get() = prefs.getInt(Prefs.USER_DAYS_ACTIVE, 0)
         private set(value) {
-            prefs.edit(true) { putInt(Prefs.USER_DAYS_ACTIVE, value) }
+            prefs.putInt(Prefs.USER_DAYS_ACTIVE, value)
         }
 
     override var currentWeekRank: Int
         get() = prefs.getInt(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK, -1)
         private set(value) {
-            prefs.edit(true) { putInt(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK, value) }
+            prefs.putInt(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK, value)
         }
 
     override var activeDatesRange: Int
         get() = prefs.getInt(Prefs.ACTIVE_DATES_RANGE, 100)
         private set(value) {
-            prefs.edit(true) { putInt(Prefs.ACTIVE_DATES_RANGE, value) }
+            prefs.putInt(Prefs.ACTIVE_DATES_RANGE, value)
         }
 
     override var isSynchronizing: Boolean
         // default true because if it is not set yet, the first thing that is done is to synchronize it
         get() = prefs.getBoolean(Prefs.IS_SYNCHRONIZING_STATISTICS, true)
         private set(value) {
-            prefs.edit(true) { putBoolean(Prefs.IS_SYNCHRONIZING_STATISTICS, value) }
+            prefs.putBoolean(Prefs.IS_SYNCHRONIZING_STATISTICS, value)
         }
 
     private var lastUpdate: Long
         get() = prefs.getLong(Prefs.USER_LAST_TIMESTAMP_ACTIVE, 0)
         set(value) {
-            prefs.edit(true) { putLong(Prefs.USER_LAST_TIMESTAMP_ACTIVE, value) }
+            prefs.putLong(Prefs.USER_LAST_TIMESTAMP_ACTIVE, value)
         }
 
     init {
@@ -166,14 +165,12 @@ class StatisticsController(
         currentWeekEditTypeStatisticsDao.clear()
         currentWeekCountryStatisticsDao.clear()
         activeDatesDao.clear()
-        prefs.edit(true) {
-            remove(Prefs.USER_DAYS_ACTIVE)
-            remove(Prefs.ACTIVE_DATES_RANGE)
-            remove(Prefs.IS_SYNCHRONIZING_STATISTICS)
-            remove(Prefs.USER_GLOBAL_RANK)
-            remove(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK)
-            remove(Prefs.USER_LAST_TIMESTAMP_ACTIVE)
-        }
+        prefs.remove(Prefs.USER_DAYS_ACTIVE)
+        prefs.remove(Prefs.ACTIVE_DATES_RANGE)
+        prefs.remove(Prefs.IS_SYNCHRONIZING_STATISTICS)
+        prefs.remove(Prefs.USER_GLOBAL_RANK)
+        prefs.remove(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK)
+        prefs.remove(Prefs.USER_LAST_TIMESTAMP_ACTIVE)
 
         listeners.forEach { it.onCleared() }
     }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/SelectedQuestPresetStore.kt b/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/SelectedQuestPresetStore.kt
index 099276e4f0f..f3d31247144 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/SelectedQuestPresetStore.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/SelectedQuestPresetStore.kt
@@ -1,14 +1,13 @@
 package de.westnordost.streetcomplete.data.visiblequests
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.Prefs
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
-class SelectedQuestPresetStore(private val prefs: SharedPreferences) {
+class SelectedQuestPresetStore(private val prefs: Preferences) {
 
     fun get(): Long = prefs.getLong(Prefs.SELECTED_QUESTS_PRESET, 0)
 
     fun set(value: Long) {
-        prefs.edit { putLong(Prefs.SELECTED_QUESTS_PRESET, value) }
+        prefs.putLong(Prefs.SELECTED_QUESTS_PRESET, value)
     }
 }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/TeamModeQuestFilter.kt b/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/TeamModeQuestFilter.kt
index 815cfc4e8ae..cf79b64326d 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/TeamModeQuestFilter.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/visiblequests/TeamModeQuestFilter.kt
@@ -1,19 +1,18 @@
 package de.westnordost.streetcomplete.data.visiblequests
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.data.osm.created_elements.CreatedElementsSource
 import de.westnordost.streetcomplete.data.osm.osmquests.OsmQuest
 import de.westnordost.streetcomplete.data.osmnotes.notequests.OsmNoteQuest
 import de.westnordost.streetcomplete.data.quest.Quest
 import de.westnordost.streetcomplete.util.Listeners
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
 /** Controller for filtering all quests that are hidden because they are shown to other users in
  *  team mode. Takes care of persisting team mode settings and notifying listeners about changes */
 class TeamModeQuestFilter internal constructor(
     private val createdElementsSource: CreatedElementsSource,
-    private val prefs: SharedPreferences
+    private val prefs: Preferences
 ) {
     /* Must be a singleton because there is a listener that should respond to a change in the
      *  shared preferences */
@@ -41,15 +40,13 @@ class TeamModeQuestFilter internal constructor(
     }
 
     fun enableTeamMode(teamSize: Int, indexInTeam: Int) {
-        prefs.edit {
-            putInt(Prefs.TEAM_MODE_TEAM_SIZE, teamSize)
-            putInt(Prefs.TEAM_MODE_INDEX_IN_TEAM, indexInTeam)
-        }
+        prefs.putInt(Prefs.TEAM_MODE_TEAM_SIZE, teamSize)
+        prefs.putInt(Prefs.TEAM_MODE_INDEX_IN_TEAM, indexInTeam)
         listeners.forEach { it.onTeamModeChanged(true) }
     }
 
     fun disableTeamMode() {
-        prefs.edit { putInt(Prefs.TEAM_MODE_TEAM_SIZE, -1) }
+        prefs.putInt(Prefs.TEAM_MODE_TEAM_SIZE, -1)
         listeners.forEach { it.onTeamModeChanged(false) }
     }
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/overlays/AStreetSideSelectOverlayForm.kt b/app/src/main/java/de/westnordost/streetcomplete/overlays/AStreetSideSelectOverlayForm.kt
index 70a951db977..db8864d54e4 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/overlays/AStreetSideSelectOverlayForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/overlays/AStreetSideSelectOverlayForm.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.overlays
 
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.view.View
 import de.westnordost.streetcomplete.Prefs
@@ -8,6 +7,7 @@ import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.data.osm.geometry.ElementPolylinesGeometry
 import de.westnordost.streetcomplete.databinding.FragmentOverlayStreetSidePuzzleWithLastAnswerButtonBinding
 import de.westnordost.streetcomplete.util.math.getOrientationAtCenterLineInDegrees
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.ResImage
 import de.westnordost.streetcomplete.view.controller.StreetSideDisplayItem
 import de.westnordost.streetcomplete.view.controller.StreetSideSelectWithLastAnswerButtonViewController
@@ -20,7 +20,7 @@ abstract class AStreetSideSelectOverlayForm<I> : AbstractOverlayForm() {
     override val contentLayoutResId = R.layout.fragment_overlay_street_side_puzzle_with_last_answer_button
     protected val binding by contentViewBinding(FragmentOverlayStreetSidePuzzleWithLastAnswerButtonBinding::bind)
 
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     override val contentPadding = false
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/overlays/shops/ShopsOverlayForm.kt b/app/src/main/java/de/westnordost/streetcomplete/overlays/shops/ShopsOverlayForm.kt
index e8af01c2211..b1b8ef2bc0e 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/overlays/shops/ShopsOverlayForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/overlays/shops/ShopsOverlayForm.kt
@@ -1,10 +1,8 @@
 package de.westnordost.streetcomplete.overlays.shops
 
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.view.View
 import androidx.appcompat.app.AlertDialog
-import androidx.core.content.edit
 import androidx.core.view.isGone
 import de.westnordost.osmfeatures.Feature
 import de.westnordost.streetcomplete.Prefs.PREFERRED_LANGUAGE_FOR_NAMES
@@ -31,12 +29,12 @@ import de.westnordost.streetcomplete.util.getLocalesForFeatureDictionary
 import de.westnordost.streetcomplete.util.getLocationLabel
 import de.westnordost.streetcomplete.util.ktx.geometryType
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.AdapterDataChangedWatcher
 import de.westnordost.streetcomplete.view.controller.FeatureViewController
 import de.westnordost.streetcomplete.view.dialogs.SearchFeaturesDialog
 import kotlinx.coroutines.launch
 import kotlinx.coroutines.suspendCancellableCoroutine
-import kotlinx.serialization.decodeFromString
 import kotlinx.serialization.encodeToString
 import kotlinx.serialization.json.Json
 import org.koin.android.ext.android.inject
@@ -47,7 +45,7 @@ class ShopsOverlayForm : AbstractOverlayForm() {
     override val contentLayoutResId = R.layout.fragment_overlay_shops
     private val binding by contentViewBinding(FragmentOverlayShopsBinding::bind)
 
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private var originalFeature: Feature? = null
     private var originalNoName: Boolean = false
@@ -208,7 +206,7 @@ class ShopsOverlayForm : AbstractOverlayForm() {
 
     override fun onClickOk() {
         val firstLanguage = namesAdapter?.names?.firstOrNull()?.languageTag?.takeIf { it.isNotBlank() }
-        if (firstLanguage != null) prefs.edit { putString(PREFERRED_LANGUAGE_FOR_NAMES, firstLanguage) }
+        if (firstLanguage != null) prefs.putString(PREFERRED_LANGUAGE_FOR_NAMES, firstLanguage)
 
         viewLifecycleScope.launch {
             applyEdit(createEditAction(
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/AAddLocalizedNameForm.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/AAddLocalizedNameForm.kt
index cdb9fda61ba..0a963aaeb39 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/AAddLocalizedNameForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/AAddLocalizedNameForm.kt
@@ -1,21 +1,19 @@
 package de.westnordost.streetcomplete.quests
 
 import android.content.Intent
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.provider.Settings
 import android.text.Html
 import android.view.View
 import androidx.appcompat.app.AlertDialog
-import androidx.core.content.edit
 import androidx.core.text.parseAsHtml
 import androidx.recyclerview.widget.RecyclerView
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.data.meta.AbbreviationsByLocale
 import de.westnordost.streetcomplete.osm.LocalizedName
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.AdapterDataChangedWatcher
-import kotlinx.serialization.decodeFromString
 import kotlinx.serialization.encodeToString
 import kotlinx.serialization.json.Json
 import org.koin.android.ext.android.inject
@@ -26,7 +24,7 @@ abstract class AAddLocalizedNameForm<T> : AbstractOsmQuestForm<T>() {
     protected abstract val addLanguageButton: View
     protected abstract val namesList: RecyclerView
 
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     open val adapterRowLayoutResId = R.layout.row_localizedname
 
@@ -83,7 +81,7 @@ abstract class AAddLocalizedNameForm<T> : AbstractOsmQuestForm<T>() {
         onClickOk(adapter?.names.orEmpty())
 
         val firstLanguage = adapter?.names?.firstOrNull()?.languageTag?.takeIf { it.isNotBlank() }
-        if (firstLanguage != null) prefs.edit { putString(Prefs.PREFERRED_LANGUAGE_FOR_NAMES, firstLanguage) }
+        if (firstLanguage != null) prefs.putString(Prefs.PREFERRED_LANGUAGE_FOR_NAMES, firstLanguage)
     }
 
     abstract fun onClickOk(names: List<LocalizedName>)
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/AGroupedImageListQuestForm.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/AGroupedImageListQuestForm.kt
index dca609d163a..5bed6fa0c07 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/AGroupedImageListQuestForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/AGroupedImageListQuestForm.kt
@@ -5,7 +5,6 @@ import android.os.Bundle
 import android.view.View
 import androidx.appcompat.app.AlertDialog
 import androidx.core.view.postDelayed
-import androidx.preference.PreferenceManager
 import androidx.recyclerview.widget.GridLayoutManager
 import androidx.recyclerview.widget.RecyclerView
 import de.westnordost.streetcomplete.R
@@ -13,8 +12,10 @@ import de.westnordost.streetcomplete.databinding.QuestGenericListBinding
 import de.westnordost.streetcomplete.util.LastPickedValuesStore
 import de.westnordost.streetcomplete.util.mostCommonWithin
 import de.westnordost.streetcomplete.util.padWith
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.image_select.GroupableDisplayItem
 import de.westnordost.streetcomplete.view.image_select.GroupedImageSelectAdapter
+import org.koin.android.ext.android.inject
 
 /**
  * Abstract class for quests with a grouped list of images and one to select.
@@ -26,6 +27,8 @@ abstract class AGroupedImageListQuestForm<I, T> : AbstractOsmQuestForm<T>() {
     final override val contentLayoutResId = R.layout.quest_generic_list
     private val binding by contentViewBinding(QuestGenericListBinding::bind)
 
+    private val prefs: Preferences by inject()
+
     override val defaultExpanded = false
 
     protected lateinit var imageSelector: GroupedImageSelectAdapter<I>
@@ -46,7 +49,7 @@ abstract class AGroupedImageListQuestForm<I, T> : AbstractOsmQuestForm<T>() {
     override fun onAttach(ctx: Context) {
         super.onAttach(ctx)
         favs = LastPickedValuesStore(
-            PreferenceManager.getDefaultSharedPreferences(ctx.applicationContext),
+            prefs,
             key = javaClass.simpleName,
             serialize = { it.value.toString() },
             deserialize = { itemsByString[it] }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/AImageListQuestForm.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/AImageListQuestForm.kt
index 9704f4eadeb..fd9381fb8b3 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/AImageListQuestForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/AImageListQuestForm.kt
@@ -4,15 +4,15 @@ import android.content.Context
 import android.os.Bundle
 import android.view.View
 import androidx.core.view.isGone
-import androidx.preference.PreferenceManager
 import androidx.recyclerview.widget.GridLayoutManager
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.databinding.QuestGenericListBinding
 import de.westnordost.streetcomplete.util.LastPickedValuesStore
 import de.westnordost.streetcomplete.util.padWith
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.image_select.DisplayItem
 import de.westnordost.streetcomplete.view.image_select.ImageSelectAdapter
-import kotlin.collections.ArrayList
+import org.koin.android.ext.android.inject
 
 /**
  * Abstract class for quests with a list of images and one or several to select.
@@ -28,6 +28,8 @@ abstract class AImageListQuestForm<I, T> : AbstractOsmQuestForm<T>() {
     final override val contentLayoutResId = R.layout.quest_generic_list
     private val binding by contentViewBinding(QuestGenericListBinding::bind)
 
+    private val prefs: Preferences by inject()
+
     override val defaultExpanded = false
 
     protected open val descriptionResId: Int? = null
@@ -56,7 +58,7 @@ abstract class AImageListQuestForm<I, T> : AbstractOsmQuestForm<T>() {
     override fun onAttach(ctx: Context) {
         super.onAttach(ctx)
         favs = LastPickedValuesStore(
-            PreferenceManager.getDefaultSharedPreferences(ctx.applicationContext),
+            prefs,
             key = javaClass.simpleName,
             serialize = { it.value.toString() },
             deserialize = { itemsByString[it] }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/AStreetSideSelectForm.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/AStreetSideSelectForm.kt
index 49d4b8a4a8d..a0556fd570e 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/AStreetSideSelectForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/AStreetSideSelectForm.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.quests
 
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.view.View
 import de.westnordost.streetcomplete.Prefs
@@ -8,6 +7,7 @@ import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.data.osm.geometry.ElementPolylinesGeometry
 import de.westnordost.streetcomplete.databinding.QuestStreetSidePuzzleWithLastAnswerButtonBinding
 import de.westnordost.streetcomplete.util.math.getOrientationAtCenterLineInDegrees
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.ResImage
 import de.westnordost.streetcomplete.view.controller.StreetSideDisplayItem
 import de.westnordost.streetcomplete.view.controller.StreetSideSelectWithLastAnswerButtonViewController
@@ -20,7 +20,7 @@ abstract class AStreetSideSelectForm<I, T> : AbstractOsmQuestForm<T>() {
     override val contentLayoutResId = R.layout.quest_street_side_puzzle_with_last_answer_button
     private val binding by contentViewBinding(QuestStreetSidePuzzleWithLastAnswerButtonBinding::bind)
 
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     override val contentPadding = false
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/building_levels/AddBuildingLevelsForm.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/building_levels/AddBuildingLevelsForm.kt
index 2ebf71562b6..f061f4258c8 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/building_levels/AddBuildingLevelsForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/building_levels/AddBuildingLevelsForm.kt
@@ -7,7 +7,6 @@ import android.view.View
 import android.view.ViewGroup
 import androidx.appcompat.app.AlertDialog
 import androidx.core.widget.doAfterTextChanged
-import androidx.preference.PreferenceManager
 import androidx.recyclerview.widget.RecyclerView
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.databinding.QuestBuildingLevelsBinding
@@ -17,12 +16,16 @@ import de.westnordost.streetcomplete.quests.AnswerItem
 import de.westnordost.streetcomplete.util.LastPickedValuesStore
 import de.westnordost.streetcomplete.util.ktx.intOrNull
 import de.westnordost.streetcomplete.util.mostCommonWithin
+import de.westnordost.streetcomplete.util.prefs.Preferences
+import org.koin.android.ext.android.inject
 
 class AddBuildingLevelsForm : AbstractOsmQuestForm<BuildingLevelsAnswer>() {
 
     override val contentLayoutResId = R.layout.quest_building_levels
     private val binding by contentViewBinding(QuestBuildingLevelsBinding::bind)
 
+    private val prefs: Preferences by inject()
+
     override val otherAnswers = listOf(
         AnswerItem(R.string.quest_buildingLevels_answer_multipleLevels) { showMultipleLevelsHint() }
     )
@@ -42,7 +45,7 @@ class AddBuildingLevelsForm : AbstractOsmQuestForm<BuildingLevelsAnswer>() {
     override fun onAttach(ctx: Context) {
         super.onAttach(ctx)
         favs = LastPickedValuesStore(
-            PreferenceManager.getDefaultSharedPreferences(ctx.applicationContext),
+            prefs,
             key = javaClass.simpleName,
             serialize = { listOfNotNull(it.levels, it.roofLevels).joinToString("#") },
             deserialize = { value ->
diff --git a/app/src/main/java/de/westnordost/streetcomplete/quests/fire_hydrant_diameter/AddFireHydrantDiameterForm.kt b/app/src/main/java/de/westnordost/streetcomplete/quests/fire_hydrant_diameter/AddFireHydrantDiameterForm.kt
index 760287cc61d..feb7c1cbc03 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/quests/fire_hydrant_diameter/AddFireHydrantDiameterForm.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/quests/fire_hydrant_diameter/AddFireHydrantDiameterForm.kt
@@ -8,7 +8,6 @@ import androidx.appcompat.app.AlertDialog
 import androidx.appcompat.widget.PopupMenu
 import androidx.core.view.isGone
 import androidx.core.widget.doAfterTextChanged
-import androidx.preference.PreferenceManager
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.quests.AbstractOsmQuestForm
 import de.westnordost.streetcomplete.quests.AnswerItem
@@ -17,9 +16,13 @@ import de.westnordost.streetcomplete.quests.fire_hydrant_diameter.FireHydrantDia
 import de.westnordost.streetcomplete.util.LastPickedValuesStore
 import de.westnordost.streetcomplete.util.ktx.intOrNull
 import de.westnordost.streetcomplete.util.mostCommonWithin
+import de.westnordost.streetcomplete.util.prefs.Preferences
+import org.koin.android.ext.android.inject
 
 class AddFireHydrantDiameterForm : AbstractOsmQuestForm<FireHydrantDiameterAnswer>() {
 
+    private val prefs: Preferences by inject()
+
     override val otherAnswers = listOf(
         AnswerItem(R.string.quest_generic_answer_noSign) { confirmNoSign() }
     )
@@ -42,7 +45,7 @@ class AddFireHydrantDiameterForm : AbstractOsmQuestForm<FireHydrantDiameterAnswe
     override fun onAttach(ctx: Context) {
         super.onAttach(ctx)
         favs = LastPickedValuesStore(
-            PreferenceManager.getDefaultSharedPreferences(ctx.applicationContext),
+            prefs,
             key = javaClass.simpleName,
             serialize = { it.toString() },
             deserialize = { it.toInt() }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/BaseActivity.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/BaseActivity.kt
index 07f5a657cba..455d4f863ee 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/BaseActivity.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/BaseActivity.kt
@@ -8,18 +8,22 @@ import androidx.core.app.ActivityCompat
 import de.westnordost.streetcomplete.util.getSelectedLocale
 import de.westnordost.streetcomplete.util.getSystemLocales
 import de.westnordost.streetcomplete.util.ktx.addedToFront
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.util.setDefaultLocales
 import de.westnordost.streetcomplete.util.setLocales
+import org.koin.android.ext.android.inject
 import java.util.Locale
 
 open class BaseActivity : AppCompatActivity {
     constructor() : super()
     constructor(@LayoutRes contentLayoutId: Int) : super(contentLayoutId)
 
+    private val prefs: Preferences by inject()
+
     private var locale: Locale? = null
 
     override fun attachBaseContext(base: Context) {
-        val locale = getSelectedLocale(base)
+        val locale = getSelectedLocale(prefs)
         this.locale = locale
 
         var newBase = base
@@ -36,7 +40,7 @@ open class BaseActivity : AppCompatActivity {
     override fun onRestart() {
         super.onRestart()
         // force restart if the locale changed while the activity was in background
-        if (locale != getSelectedLocale(this)) {
+        if (locale != getSelectedLocale(prefs)) {
             ActivityCompat.recreate(this)
         }
     }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/MainActivity.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/MainActivity.kt
index e49ccf4cf7a..7b8cc686e97 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/MainActivity.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/MainActivity.kt
@@ -4,7 +4,6 @@ import android.content.BroadcastReceiver
 import android.content.Context
 import android.content.Intent
 import android.content.IntentFilter
-import android.content.SharedPreferences
 import android.content.res.Configuration
 import android.net.ConnectivityManager
 import android.os.Bundle
@@ -18,7 +17,6 @@ import android.widget.TextView
 import android.widget.Toast
 import androidx.annotation.AnyThread
 import androidx.appcompat.app.AlertDialog
-import androidx.core.content.edit
 import androidx.core.content.getSystemService
 import androidx.core.text.parseAsHtml
 import androidx.fragment.app.commit
@@ -56,11 +54,11 @@ import de.westnordost.streetcomplete.screens.tutorial.TutorialFragment
 import de.westnordost.streetcomplete.util.CrashReportExceptionHandler
 import de.westnordost.streetcomplete.util.ktx.hasLocationPermission
 import de.westnordost.streetcomplete.util.ktx.isLocationEnabled
-import de.westnordost.streetcomplete.util.ktx.putDouble
 import de.westnordost.streetcomplete.util.ktx.toast
 import de.westnordost.streetcomplete.util.location.LocationAvailabilityReceiver
 import de.westnordost.streetcomplete.util.location.LocationRequestFragment
 import de.westnordost.streetcomplete.util.parseGeoUri
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.dialogs.RequestLoginDialog
 import kotlinx.coroutines.launch
 import org.koin.android.ext.android.inject
@@ -85,7 +83,7 @@ class MainActivity :
     private val userLoginStatusController: UserLoginStatusController by inject()
     private val urlConfigController: UrlConfigController by inject()
     private val questPresetsSource: QuestPresetsSource by inject()
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private var mainFragment: MainFragment? = null
 
@@ -218,10 +216,8 @@ class MainActivity :
     public override fun onPause() {
         super.onPause()
         val pos = mainFragment?.getCameraPosition()?.position ?: return
-        prefs.edit {
-            putDouble(Prefs.MAP_LATITUDE, pos.latitude)
-            putDouble(Prefs.MAP_LONGITUDE, pos.longitude)
-        }
+        prefs.putDouble(Prefs.MAP_LATITUDE, pos.latitude)
+        prefs.putDouble(Prefs.MAP_LONGITUDE, pos.longitude)
         downloadController.showNotification = true
         uploadController.showNotification = true
     }
@@ -344,7 +340,7 @@ class MainActivity :
     override fun onTutorialFinished() {
         requestLocation()
 
-        prefs.edit { putBoolean(Prefs.HAS_SHOWN_TUTORIAL, true) }
+        prefs.putBoolean(Prefs.HAS_SHOWN_TUTORIAL, true)
         removeTutorialFragment()
     }
 
@@ -374,7 +370,7 @@ class MainActivity :
     /* --------------------------- OverlaysTutorialFragment.Listener ---------------------------- */
 
     override fun onOverlaysTutorialFinished() {
-        prefs.edit { putBoolean(Prefs.HAS_SHOWN_OVERLAYS_TUTORIAL, true) }
+        prefs.putBoolean(Prefs.HAS_SHOWN_OVERLAYS_TUTORIAL, true)
         removeTutorialFragment()
     }
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/MainFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/MainFragment.kt
index c434990ed81..b81941fb0fd 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/MainFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/MainFragment.kt
@@ -3,7 +3,6 @@ package de.westnordost.streetcomplete.screens.main
 import android.annotation.SuppressLint
 import android.content.Context
 import android.content.Intent
-import android.content.SharedPreferences
 import android.content.pm.PackageManager
 import android.content.res.Configuration
 import android.graphics.PointF
@@ -113,6 +112,7 @@ import de.westnordost.streetcomplete.util.math.area
 import de.westnordost.streetcomplete.util.math.enclosingBoundingBox
 import de.westnordost.streetcomplete.util.math.enlargedBy
 import de.westnordost.streetcomplete.util.math.initialBearingTo
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.util.viewBinding
 import de.westnordost.streetcomplete.view.insets_animation.respectSystemInsets
 import kotlinx.coroutines.Dispatchers
@@ -176,7 +176,7 @@ class MainFragment :
     private val selectedOverlaySource: SelectedOverlaySource by inject()
     private val featureDictionaryFuture: FutureTask<FeatureDictionary> by inject(named("FeatureDictionaryFuture"))
     private val soundFx: SoundFx by inject()
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private lateinit var locationManager: FineLocationManager
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/AnswersCounterFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/AnswersCounterFragment.kt
index fd597104a38..45741bed5e0 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/AnswersCounterFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/AnswersCounterFragment.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.screens.main.controls
 
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.view.View
 import androidx.fragment.app.Fragment
@@ -13,6 +12,7 @@ import de.westnordost.streetcomplete.data.upload.UploadProgressListener
 import de.westnordost.streetcomplete.data.upload.UploadProgressSource
 import de.westnordost.streetcomplete.data.user.statistics.StatisticsSource
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.launch
 import kotlinx.coroutines.withContext
@@ -24,7 +24,7 @@ class AnswersCounterFragment : Fragment(R.layout.fragment_answers_counter) {
     private val uploadProgressSource: UploadProgressSource by inject()
     private val downloadProgressSource: DownloadProgressSource by inject()
 
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
     private val statisticsSource: StatisticsSource by inject()
     private val unsyncedChangesCountSource: UnsyncedChangesCountSource by inject()
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/OverlaysButtonFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/OverlaysButtonFragment.kt
index de3445e16b6..a57e116d396 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/OverlaysButtonFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/OverlaysButtonFragment.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.screens.main.controls
 
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.view.View
 import android.widget.ImageView
@@ -14,6 +13,7 @@ import de.westnordost.streetcomplete.data.overlays.SelectedOverlaySource
 import de.westnordost.streetcomplete.screens.main.overlays.OverlaySelectionAdapter
 import de.westnordost.streetcomplete.util.ktx.dpToPx
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlinx.coroutines.launch
 import org.koin.android.ext.android.inject
 
@@ -21,7 +21,7 @@ class OverlaysButtonFragment : Fragment(R.layout.fragment_overlays_button) {
 
     private val selectedOverlayController: SelectedOverlayController by inject()
     private val overlayRegistry: OverlayRegistry by inject()
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private val selectedOverlaylistener = object : SelectedOverlaySource.Listener {
         override fun onSelectedOverlayChanged() {
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/UploadButtonFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/UploadButtonFragment.kt
index 1e038d8e522..74798b58d89 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/UploadButtonFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/controls/UploadButtonFragment.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.screens.main.controls
 
-import android.content.SharedPreferences
 import android.net.ConnectivityManager
 import android.os.Bundle
 import android.view.View
@@ -15,6 +14,7 @@ import de.westnordost.streetcomplete.data.upload.UploadProgressListener
 import de.westnordost.streetcomplete.data.user.UserLoginStatusSource
 import de.westnordost.streetcomplete.util.ktx.toast
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.dialogs.RequestLoginDialog
 import kotlinx.coroutines.launch
 import org.koin.android.ext.android.inject
@@ -25,7 +25,7 @@ class UploadButtonFragment : Fragment(R.layout.fragment_upload_button) {
     private val uploadController: UploadController by inject()
     private val userLoginStatusSource: UserLoginStatusSource by inject()
     private val unsyncedChangesCountSource: UnsyncedChangesCountSource by inject()
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private val uploadButton get() = view as UploadButton
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/LocationAwareMapFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/LocationAwareMapFragment.kt
index d3b6c91b6bb..f1b21814407 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/LocationAwareMapFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/LocationAwareMapFragment.kt
@@ -9,6 +9,7 @@ import android.os.Bundle
 import android.view.WindowManager
 import androidx.core.content.edit
 import androidx.core.content.getSystemService
+import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.data.location.RecentLocationStore
 import de.westnordost.streetcomplete.data.osm.mapdata.LatLon
 import de.westnordost.streetcomplete.data.osmtracks.Trackpoint
@@ -22,6 +23,7 @@ import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
 import de.westnordost.streetcomplete.util.location.FineLocationManager
 import de.westnordost.streetcomplete.util.location.LocationAvailabilityReceiver
 import de.westnordost.streetcomplete.util.math.translate
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlinx.coroutines.delay
 import kotlinx.coroutines.launch
 import kotlinx.serialization.encodeToString
@@ -35,6 +37,7 @@ open class LocationAwareMapFragment : MapFragment() {
 
     private val locationAvailabilityReceiver: LocationAvailabilityReceiver by inject()
     private val recentLocationStore: RecentLocationStore by inject()
+    private val prefs: Preferences by inject()
 
     private lateinit var compass: Compass
     private lateinit var locationManager: FineLocationManager
@@ -282,16 +285,13 @@ open class LocationAwareMapFragment : MapFragment() {
     /* -------------------------------- Save and Restore State ---------------------------------- */
 
     private fun restoreMapState() {
-        val prefs = activity?.getPreferences(Activity.MODE_PRIVATE) ?: return
-        isFollowingPosition = prefs.getBoolean(PREF_FOLLOWING, true)
-        isNavigationMode = prefs.getBoolean(PREF_NAVIGATION_MODE, false)
+        isFollowingPosition = prefs.getBoolean(Prefs.MAP_FOLLOWING, true)
+        isNavigationMode = prefs.getBoolean(Prefs.MAP_NAVIGATION_MODE, false)
     }
 
     private fun saveMapState() {
-        activity?.getPreferences(Activity.MODE_PRIVATE)?.edit {
-            putBoolean(PREF_FOLLOWING, isFollowingPosition)
-            putBoolean(PREF_NAVIGATION_MODE, isNavigationMode)
-        }
+        prefs.putBoolean(Prefs.MAP_FOLLOWING, isFollowingPosition)
+        prefs.putBoolean(Prefs.MAP_NAVIGATION_MODE, isNavigationMode)
     }
 
     override fun onSaveInstanceState(outState: Bundle) {
@@ -306,9 +306,6 @@ open class LocationAwareMapFragment : MapFragment() {
     }
 
     companion object {
-        private const val PREF_FOLLOWING = "map_following"
-        private const val PREF_NAVIGATION_MODE = "map_compass_mode"
-
         private const val DISPLAYED_LOCATION = "displayed_location"
         private const val TRACKS = "tracks"
         private const val TRACKS_IS_RECORDING = "tracks_is_recording"
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/MapFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/MapFragment.kt
index b504dbbd059..932b8bd8a28 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/MapFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/MapFragment.kt
@@ -1,7 +1,5 @@
 package de.westnordost.streetcomplete.screens.main.map
 
-import android.app.Activity
-import android.content.SharedPreferences
 import android.graphics.PointF
 import android.graphics.RectF
 import android.os.Bundle
@@ -12,7 +10,6 @@ import android.view.animation.AccelerateDecelerateInterpolator
 import android.view.animation.Interpolator
 import androidx.annotation.CallSuper
 import androidx.appcompat.app.AlertDialog
-import androidx.core.content.edit
 import androidx.fragment.app.Fragment
 import com.mapzen.tangram.TouchInput.DoubleTapResponder
 import com.mapzen.tangram.TouchInput.LongPressResponder
@@ -37,12 +34,12 @@ import de.westnordost.streetcomplete.screens.main.map.tangram.KtMapController
 import de.westnordost.streetcomplete.screens.main.map.tangram.MapChangingListener
 import de.westnordost.streetcomplete.screens.main.map.tangram.initMap
 import de.westnordost.streetcomplete.util.ktx.awaitLayout
-import de.westnordost.streetcomplete.util.ktx.containsAll
 import de.westnordost.streetcomplete.util.ktx.openUri
-import de.westnordost.streetcomplete.util.ktx.putDouble
 import de.westnordost.streetcomplete.util.ktx.setMargins
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
 import de.westnordost.streetcomplete.util.math.distanceTo
+import de.westnordost.streetcomplete.util.prefs.Preferences
+import de.westnordost.streetcomplete.util.prefs.containsAll
 import de.westnordost.streetcomplete.util.viewBinding
 import de.westnordost.streetcomplete.view.insets_animation.respectSystemInsets
 import kotlinx.coroutines.delay
@@ -62,8 +59,7 @@ open class MapFragment :
     PanResponder,
     ScaleResponder,
     ShoveResponder,
-    RotateResponder,
-    SharedPreferences.OnSharedPreferenceChangeListener {
+    RotateResponder {
 
     private val binding by viewBinding(FragmentMapBinding::bind)
 
@@ -98,7 +94,7 @@ open class MapFragment :
 
     private val vectorTileProvider: VectorTileProvider by inject()
     private val cacheConfig: MapTilesDownloadCacheConfig by inject()
-    private val sharedPrefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     interface Listener {
         /** Called when the map has been completely initialized */
@@ -114,11 +110,20 @@ open class MapFragment :
     }
     private val listener: Listener? get() = parentFragment as? Listener ?: activity as? Listener
 
+    private val prefsListener = object : Preferences.Listener {
+        override fun onPreferencesChanged(key: String) {
+            if (key == Prefs.THEME_BACKGROUND) {
+                sceneMapComponent?.isAerialView =
+                    prefs.getString(Prefs.THEME_BACKGROUND, "MAP") == "AERIAL"
+            }
+        }
+    }
+
     /* ------------------------------------ Lifecycle ------------------------------------------- */
 
     override fun onCreate(savedInstanceState: Bundle?) {
         super.onCreate(savedInstanceState)
-        sharedPrefs.registerOnSharedPreferenceChangeListener(this)
+        prefs.addListener(prefsListener)
     }
 
     override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {
@@ -148,12 +153,6 @@ open class MapFragment :
             .show()
     }
 
-    override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences?, key: String?) {
-        if (key == Prefs.THEME_BACKGROUND) {
-            sceneMapComponent?.isAerialView = sharedPrefs.getString(Prefs.THEME_BACKGROUND, "MAP") == "AERIAL"
-        }
-    }
-
     override fun onStart() {
         super.onStart()
         viewLifecycleScope.launch {
@@ -180,7 +179,7 @@ open class MapFragment :
 
     override fun onDestroy() {
         super.onDestroy()
-        sharedPrefs.unregisterOnSharedPreferenceChangeListener(this)
+        prefs.removeListener(prefsListener)
     }
 
     override fun onLowMemory() {
@@ -202,7 +201,7 @@ open class MapFragment :
         registerResponders(ctrl)
 
         sceneMapComponent = SceneMapComponent(resources, ctrl, vectorTileProvider)
-        sceneMapComponent?.isAerialView = sharedPrefs.getString(Prefs.THEME_BACKGROUND, "MAP") == "AERIAL"
+        sceneMapComponent?.isAerialView = prefs.getString(Prefs.THEME_BACKGROUND, "MAP") == "AERIAL"
 
         onBeforeLoadScene()
 
@@ -318,32 +317,35 @@ open class MapFragment :
 
     private fun saveMapState() {
         val camera = controller?.cameraPosition ?: return
-        saveCameraPosition(camera, false)
+        saveCameraPosition(camera)
     }
 
     private fun loadCameraPosition(): CameraPosition? {
-        val prefs = activity?.getPreferences(Activity.MODE_PRIVATE) ?: return null
-        if (!prefs.containsAll(listOf(PREF_LAT, PREF_LON, PREF_ROTATION, PREF_TILT, PREF_ZOOM))) return null
+        if (!prefs.containsAll(listOf(
+                Prefs.MAP_LATITUDE,
+                Prefs.MAP_LONGITUDE,
+                Prefs.MAP_ROTATION,
+                Prefs.MAP_TILT,
+                Prefs.MAP_ZOOM,
+        ))) return null
 
         return CameraPosition(
             LatLon(
-                java.lang.Double.longBitsToDouble(prefs.getLong(PREF_LAT, 0)),
-                java.lang.Double.longBitsToDouble(prefs.getLong(PREF_LON, 0))
+                java.lang.Double.longBitsToDouble(prefs.getLong(Prefs.MAP_LATITUDE, 0)),
+                java.lang.Double.longBitsToDouble(prefs.getLong(Prefs.MAP_LONGITUDE, 0))
             ),
-            prefs.getFloat(PREF_ROTATION, 0f),
-            prefs.getFloat(PREF_TILT, 0f),
-            prefs.getFloat(PREF_ZOOM, 0f)
+            prefs.getFloat(Prefs.MAP_ROTATION, 0f),
+            prefs.getFloat(Prefs.MAP_TILT, 0f),
+            prefs.getFloat(Prefs.MAP_ZOOM, 0f)
         )
     }
 
-    private fun saveCameraPosition(camera: CameraPosition, saveNow: Boolean) {
-        activity?.getPreferences(Activity.MODE_PRIVATE)?.edit(saveNow) {
-            putFloat(PREF_ROTATION, camera.rotation)
-            putFloat(PREF_TILT, camera.tilt)
-            putFloat(PREF_ZOOM, camera.zoom)
-            putDouble(PREF_LAT, camera.position.latitude)
-            putDouble(PREF_LON, camera.position.longitude)
-        }
+    private fun saveCameraPosition(camera: CameraPosition) {
+        prefs.putFloat(Prefs.MAP_ROTATION, camera.rotation)
+        prefs.putFloat(Prefs.MAP_TILT, camera.tilt)
+        prefs.putFloat(Prefs.MAP_ZOOM, camera.zoom)
+        prefs.putDouble(Prefs.MAP_LATITUDE, camera.position.latitude)
+        prefs.putDouble(Prefs.MAP_LONGITUDE, camera.position.longitude)
     }
 
     /* ------------------------------- Controlling the map -------------------------------------- */
@@ -383,7 +385,7 @@ open class MapFragment :
         if (controller != null) {
             controller.setCameraPosition(camera)
         } else {
-            saveCameraPosition(camera, true)
+            saveCameraPosition(camera)
         }
     }
 
@@ -401,12 +403,4 @@ open class MapFragment :
         val pos2 = controller?.screenPositionToLatLon(PointF(x + 1, y)) ?: return null
         return pos1.distanceTo(pos2)
     }
-
-    companion object {
-        private const val PREF_ROTATION = "map_rotation"
-        private const val PREF_TILT = "map_tilt"
-        private const val PREF_ZOOM = "map_zoom"
-        private const val PREF_LAT = "map_lat"
-        private const val PREF_LON = "map_lon"
-    }
 }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramIconsSpriteSheet.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramIconsSpriteSheet.kt
index 2cad015ed9c..5d6702e504b 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramIconsSpriteSheet.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramIconsSpriteSheet.kt
@@ -1,15 +1,14 @@
 package de.westnordost.streetcomplete.screens.main.map
 
 import android.content.Context
-import android.content.SharedPreferences
 import android.graphics.Bitmap
 import android.graphics.Canvas
 import android.graphics.Color
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.BuildConfig
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.util.ktx.createBitmapWithWhiteBorder
 import de.westnordost.streetcomplete.util.ktx.dpToPx
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.presetIconIndex
 import java.lang.Integer.max
 import kotlin.math.ceil
@@ -19,7 +18,7 @@ import kotlin.math.sqrt
  *  the scene updates for tangram to access this sprite sheet  */
 class TangramIconsSpriteSheet(
     private val context: Context,
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
 ) {
     val sceneUpdates: List<Pair<String, String>> by lazy {
         val isSpriteSheetCurrent = prefs.getInt(Prefs.ICON_SPRITES_VERSION, 0) == BuildConfig.VERSION_CODE
@@ -69,10 +68,8 @@ class TangramIconsSpriteSheet(
 
         val sprites = "{${spriteSheetEntries.joinToString(",")}}"
 
-        prefs.edit {
-            putInt(Prefs.ICON_SPRITES_VERSION, BuildConfig.VERSION_CODE)
-            putString(Prefs.ICON_SPRITES, sprites)
-        }
+        prefs.putInt(Prefs.ICON_SPRITES_VERSION, BuildConfig.VERSION_CODE)
+        prefs.putString(Prefs.ICON_SPRITES, sprites)
 
         return sprites
     }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramPinsSpriteSheet.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramPinsSpriteSheet.kt
index ec0007e4d13..390a0a44ec8 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramPinsSpriteSheet.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/main/map/TangramPinsSpriteSheet.kt
@@ -1,17 +1,15 @@
 package de.westnordost.streetcomplete.screens.main.map
 
 import android.content.Context
-import android.content.SharedPreferences
 import android.graphics.Bitmap
 import android.graphics.Canvas
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.BuildConfig
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.data.overlays.OverlayRegistry
 import de.westnordost.streetcomplete.data.quest.QuestTypeRegistry
-import de.westnordost.streetcomplete.util.ktx.getDouble
 import de.westnordost.streetcomplete.util.ktx.isApril1st
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlin.math.ceil
 import kotlin.math.sqrt
 
@@ -21,7 +19,7 @@ class TangramPinsSpriteSheet(
     private val context: Context,
     private val questTypeRegistry: QuestTypeRegistry,
     private val overlayRegistry: OverlayRegistry,
-    private val prefs: SharedPreferences
+    private val prefs: Preferences
 ) {
     val sceneUpdates: List<Pair<String, String>> by lazy {
         val isSpriteSheetCurrent = prefs.getInt(Prefs.PIN_SPRITES_VERSION, 0) == BuildConfig.VERSION_CODE
@@ -80,16 +78,14 @@ class TangramPinsSpriteSheet(
 
         val questSprites = "{${spriteSheetEntries.joinToString(",")}}"
 
-        prefs.edit {
-            putInt(Prefs.PIN_SPRITES_VERSION, if (shouldBeUpsideDown()) -1 else BuildConfig.VERSION_CODE)
-            putString(Prefs.PIN_SPRITES, questSprites)
-        }
+        prefs.putInt(Prefs.PIN_SPRITES_VERSION, if (shouldBeUpsideDown()) -1 else BuildConfig.VERSION_CODE)
+        prefs.putString(Prefs.PIN_SPRITES, questSprites)
 
         return questSprites
     }
 
     private fun shouldBeUpsideDown(): Boolean {
-        val isBelowEquator = prefs.getDouble(Prefs.MAP_LATITUDE) < 0.0
+        val isBelowEquator = prefs.getDouble(Prefs.MAP_LATITUDE, 0.0) < 0.0
         return isBelowEquator && isApril1st()
     }
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/ResurveyIntervalsUpdater.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/ResurveyIntervalsUpdater.kt
index 68e012a2d95..101b562831d 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/ResurveyIntervalsUpdater.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/ResurveyIntervalsUpdater.kt
@@ -1,16 +1,16 @@
 package de.westnordost.streetcomplete.screens.settings
 
-import android.content.SharedPreferences
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.Prefs.ResurveyIntervals.DEFAULT
 import de.westnordost.streetcomplete.Prefs.ResurveyIntervals.LESS_OFTEN
 import de.westnordost.streetcomplete.Prefs.ResurveyIntervals.MORE_OFTEN
 import de.westnordost.streetcomplete.Prefs.ResurveyIntervals.valueOf
 import de.westnordost.streetcomplete.data.elementfilter.filters.RelativeDate
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
 /** This class is just to access the user's preference about which multiplier for the resurvey
  *  intervals to use */
-class ResurveyIntervalsUpdater(private val prefs: SharedPreferences) {
+class ResurveyIntervalsUpdater(private val prefs: Preferences) {
     fun update() {
         RelativeDate.MULTIPLIER = multiplier
     }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/SettingsFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/SettingsFragment.kt
index 1f29621abf4..55e65de03c7 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/SettingsFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/SettingsFragment.kt
@@ -1,8 +1,6 @@
 package de.westnordost.streetcomplete.screens.settings
 
-import android.annotation.SuppressLint
 import android.content.Intent
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.view.View
 import android.widget.Toast
@@ -42,6 +40,7 @@ import de.westnordost.streetcomplete.util.ktx.purge
 import de.westnordost.streetcomplete.util.ktx.setUpToolbarTitleAndIcon
 import de.westnordost.streetcomplete.util.ktx.toast
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.util.setDefaultLocales
 import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.launch
@@ -50,12 +49,9 @@ import org.koin.android.ext.android.inject
 import java.util.Locale
 
 /** Shows the settings lists */
-class SettingsFragment :
-    TwoPaneListFragment(),
-    HasTitle,
-    SharedPreferences.OnSharedPreferenceChangeListener {
+class SettingsFragment : TwoPaneListFragment(), HasTitle {
 
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
     private val downloadedTilesController: DownloadedTilesController by inject()
     private val noteController: NoteController by inject()
     private val mapDataController: MapDataController by inject()
@@ -96,6 +92,33 @@ class SettingsFragment :
         }
     }
 
+    private val prefsListener = object : Preferences.Listener {
+        override fun onPreferencesChanged(key: String) {
+            when (key) {
+                Prefs.AUTOSYNC -> {
+                    if (Prefs.Autosync.valueOf(prefs.getString(Prefs.AUTOSYNC, "ON")!!) != Prefs.Autosync.ON) {
+                        AlertDialog.Builder(requireContext())
+                            .setView(layoutInflater.inflate(R.layout.dialog_tutorial_upload, null))
+                            .setPositiveButton(android.R.string.ok, null)
+                            .show()
+                    }
+                }
+                Prefs.THEME_SELECT -> {
+                    val theme = Prefs.Theme.valueOf(prefs.getString(Prefs.THEME_SELECT, getDefaultTheme())!!)
+                    AppCompatDelegate.setDefaultNightMode(theme.appCompatNightMode)
+                    activity?.let { ActivityCompat.recreate(it) }
+                }
+                Prefs.LANGUAGE_SELECT -> {
+                    setDefaultLocales(getSelectedLocales(prefs))
+                    activity?.let { ActivityCompat.recreate(it) }
+                }
+                Prefs.RESURVEY_INTERVALS -> {
+                    resurveyIntervalsUpdater.update()
+                }
+            }
+        }
+    }
+
     override fun onCreatePreferences(savedInstanceState: Bundle?, rootKey: String?) {
         PreferenceManager.setDefaultValues(requireContext(), R.xml.preferences, false)
         addPreferencesFromResource(R.xml.preferences)
@@ -189,38 +212,12 @@ class SettingsFragment :
 
     override fun onResume() {
         super.onResume()
-        prefs.registerOnSharedPreferenceChangeListener(this)
+        prefs.addListener(prefsListener)
     }
 
     override fun onPause() {
         super.onPause()
-        prefs.unregisterOnSharedPreferenceChangeListener(this)
-    }
-
-    @SuppressLint("InflateParams")
-    override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences, key: String) {
-        when (key) {
-            Prefs.AUTOSYNC -> {
-                if (Prefs.Autosync.valueOf(prefs.getString(Prefs.AUTOSYNC, "ON")!!) != Prefs.Autosync.ON) {
-                    AlertDialog.Builder(requireContext())
-                        .setView(layoutInflater.inflate(R.layout.dialog_tutorial_upload, null))
-                        .setPositiveButton(android.R.string.ok, null)
-                        .show()
-                }
-            }
-            Prefs.THEME_SELECT -> {
-                val theme = Prefs.Theme.valueOf(prefs.getString(Prefs.THEME_SELECT, getDefaultTheme())!!)
-                AppCompatDelegate.setDefaultNightMode(theme.appCompatNightMode)
-                activity?.let { ActivityCompat.recreate(it) }
-            }
-            Prefs.LANGUAGE_SELECT -> {
-                setDefaultLocales(getSelectedLocales(requireContext()))
-                activity?.let { ActivityCompat.recreate(it) }
-            }
-            Prefs.RESURVEY_INTERVALS -> {
-                resurveyIntervalsUpdater.update()
-            }
-        }
+        prefs.removeListener(prefsListener)
     }
 
     override fun onDisplayPreferenceDialog(preference: Preference) {
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/debug/ShowQuestFormsActivity.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/debug/ShowQuestFormsActivity.kt
index bb52580fc18..fcb664a0a39 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/debug/ShowQuestFormsActivity.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/debug/ShowQuestFormsActivity.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.screens.settings.debug
 
-import android.content.SharedPreferences
 import android.content.res.Configuration
 import android.location.Location
 import android.location.LocationManager
@@ -41,8 +40,8 @@ import de.westnordost.streetcomplete.quests.AbstractQuestForm
 import de.westnordost.streetcomplete.screens.BaseActivity
 import de.westnordost.streetcomplete.screens.settings.genericQuestTitle
 import de.westnordost.streetcomplete.util.ktx.containsAll
-import de.westnordost.streetcomplete.util.ktx.getDouble
 import de.westnordost.streetcomplete.util.math.translate
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.util.viewBinding
 import de.westnordost.streetcomplete.view.ListAdapter
 import org.koin.android.ext.android.inject
@@ -52,7 +51,7 @@ import java.util.Locale
 class ShowQuestFormsActivity : BaseActivity(), AbstractOsmQuestForm.Listener {
 
     private val questTypeRegistry: QuestTypeRegistry by inject()
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private val binding by viewBinding(FragmentShowQuestFormsBinding::inflate)
 
@@ -101,7 +100,10 @@ class ShowQuestFormsActivity : BaseActivity(), AbstractOsmQuestForm.Listener {
 
     override fun onStart() {
         super.onStart()
-        pos = LatLon(prefs.getDouble(Prefs.MAP_LATITUDE), prefs.getDouble(Prefs.MAP_LONGITUDE))
+        pos = LatLon(
+            prefs.getDouble(Prefs.MAP_LATITUDE, 0.0),
+            prefs.getDouble(Prefs.MAP_LONGITUDE, 0.0)
+        )
     }
 
     private fun popQuestForm() {
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionAdapter.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionAdapter.kt
index 9305e264404..0d2b9b46b46 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionAdapter.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionAdapter.kt
@@ -1,7 +1,6 @@
 package de.westnordost.streetcomplete.screens.settings.questselection
 
 import android.content.Context
-import android.content.SharedPreferences
 import android.content.res.Configuration
 import android.view.LayoutInflater
 import android.view.MotionEvent
@@ -38,7 +37,7 @@ import de.westnordost.streetcomplete.databinding.RowQuestSelectionBinding
 import de.westnordost.streetcomplete.screens.settings.genericQuestTitle
 import de.westnordost.streetcomplete.util.ktx.containsAll
 import de.westnordost.streetcomplete.util.ktx.containsAny
-import de.westnordost.streetcomplete.util.ktx.getDouble
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.SupervisorJob
@@ -57,11 +56,11 @@ class QuestSelectionAdapter(
     private val questTypeRegistry: QuestTypeRegistry,
     private val onListSizeChanged: (Int) -> Unit,
     countryBoundaries: FutureTask<CountryBoundaries>,
-    prefs: SharedPreferences
+    prefs: Preferences
 ) : ListAdapter<QuestVisibility, QuestSelectionAdapter.QuestVisibilityViewHolder>(QuestDiffUtil), DefaultLifecycleObserver {
 
     private val currentCountryCodes = countryBoundaries.get()
-        .getIds(prefs.getDouble(Prefs.MAP_LONGITUDE), prefs.getDouble(Prefs.MAP_LATITUDE))
+        .getIds(prefs.getDouble(Prefs.MAP_LONGITUDE, 0.0), prefs.getDouble(Prefs.MAP_LATITUDE, 0.0))
     private val itemTouchHelper by lazy { ItemTouchHelper(TouchHelperCallback()) }
 
     private val englishResources by lazy {
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionFragment.kt
index a7526e7dd26..4a570dfea2b 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/settings/questselection/QuestSelectionFragment.kt
@@ -1,7 +1,6 @@
 package de.westnordost.streetcomplete.screens.settings.questselection
 
 import android.content.Context
-import android.content.SharedPreferences
 import android.os.Bundle
 import android.view.View
 import androidx.appcompat.app.AlertDialog
@@ -21,6 +20,7 @@ import de.westnordost.streetcomplete.databinding.FragmentQuestSelectionBinding
 import de.westnordost.streetcomplete.screens.HasTitle
 import de.westnordost.streetcomplete.screens.TwoPaneDetailFragment
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.util.viewBinding
 import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.launch
@@ -36,7 +36,7 @@ class QuestSelectionFragment : TwoPaneDetailFragment(R.layout.fragment_quest_sel
     private val visibleQuestTypeController: VisibleQuestTypeController by inject()
     private val questTypeOrderController: QuestTypeOrderController by inject()
     private val countryBoundaries: FutureTask<CountryBoundaries> by inject(named("CountryBoundariesFuture"))
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private val binding by viewBinding(FragmentQuestSelectionBinding::bind)
 
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/user/profile/ProfileFragment.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/user/profile/ProfileFragment.kt
index 4a396da3d81..a29b790e385 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/user/profile/ProfileFragment.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/user/profile/ProfileFragment.kt
@@ -3,14 +3,12 @@ package de.westnordost.streetcomplete.screens.user.profile
 import android.animation.Animator
 import android.animation.ValueAnimator
 import android.content.Context
-import android.content.SharedPreferences
 import android.graphics.Bitmap
 import android.graphics.BitmapFactory
 import android.os.Bundle
 import android.view.View
 import android.view.animation.AccelerateDecelerateInterpolator
 import android.widget.TextView
-import androidx.core.content.edit
 import androidx.core.view.isGone
 import androidx.fragment.app.Fragment
 import de.westnordost.streetcomplete.Prefs
@@ -30,6 +28,7 @@ import de.westnordost.streetcomplete.util.ktx.getLocationInWindow
 import de.westnordost.streetcomplete.util.ktx.openUri
 import de.westnordost.streetcomplete.util.ktx.pxToDp
 import de.westnordost.streetcomplete.util.ktx.viewLifecycleScope
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.util.viewBinding
 import de.westnordost.streetcomplete.view.LaurelWreathDrawable
 import kotlinx.coroutines.Dispatchers
@@ -55,7 +54,7 @@ class ProfileFragment : Fragment(R.layout.fragment_profile) {
     private val unsyncedChangesCountSource: UnsyncedChangesCountSource by inject()
     private val avatarsCacheDirectory: File by inject(named("AvatarsCacheDirectory"))
 
-    private val prefs: SharedPreferences by inject()
+    private val prefs: Preferences by inject()
 
     private lateinit var anonAvatar: Bitmap
 
@@ -225,7 +224,7 @@ class ProfileFragment : Fragment(R.layout.fragment_profile) {
             binding.globalRankContainer,
             binding.globalRankText
         )
-        prefs.edit { putInt(Prefs.LAST_SHOWN_USER_GLOBAL_RANK, rank) }
+        prefs.putInt(Prefs.LAST_SHOWN_USER_GLOBAL_RANK, rank)
 
         val rankCurrentWeek = statisticsSource.currentWeekRank
         updateGlobalRankText(
@@ -234,7 +233,7 @@ class ProfileFragment : Fragment(R.layout.fragment_profile) {
             binding.currentWeekGlobalRankContainer,
             binding.currentWeekGlobalRankText
         )
-        prefs.edit { putInt(Prefs.LAST_SHOWN_USER_GLOBAL_RANK_CURRENT_WEEK, rankCurrentWeek) }
+        prefs.putInt(Prefs.LAST_SHOWN_USER_GLOBAL_RANK_CURRENT_WEEK, rankCurrentWeek)
     }
 
     private fun updateGlobalRankText(rank: Int, previousRank: Int, container: View, circle: TextView ) {
@@ -283,7 +282,7 @@ class ProfileFragment : Fragment(R.layout.fragment_profile) {
             binding.localRankLabel,
             binding.localRankText
         )
-        prefs.edit { putString(Prefs.LAST_SHOWN_USER_LOCAL_RANK, Json.encodeToString(localRank)) }
+        prefs.putString(Prefs.LAST_SHOWN_USER_LOCAL_RANK, Json.encodeToString(localRank))
 
         val localRankCurrentWeek = withContext(Dispatchers.IO) { statisticsSource.getCurrentWeekCountryStatisticsOfCountryWithBiggestSolvedCount() }
         updateLocalRankText(
@@ -294,7 +293,7 @@ class ProfileFragment : Fragment(R.layout.fragment_profile) {
             binding.currentWeekLocalRankLabel,
             binding.currentWeekLocalRankText
         )
-        prefs.edit { putString(Prefs.LAST_SHOWN_USER_LOCAL_RANK_CURRENT_WEEK, Json.encodeToString(localRankCurrentWeek)) }
+        prefs.putString(Prefs.LAST_SHOWN_USER_LOCAL_RANK_CURRENT_WEEK, Json.encodeToString(localRankCurrentWeek))
     }
 
     private fun updateLocalRankText(
diff --git a/app/src/main/java/de/westnordost/streetcomplete/util/LastPickedValuesStore.kt b/app/src/main/java/de/westnordost/streetcomplete/util/LastPickedValuesStore.kt
index cbd7732c5ff..d0b9972740b 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/util/LastPickedValuesStore.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/util/LastPickedValuesStore.kt
@@ -1,11 +1,10 @@
 package de.westnordost.streetcomplete.util
 
-import android.content.SharedPreferences
-import androidx.core.content.edit
 import de.westnordost.streetcomplete.Prefs
+import de.westnordost.streetcomplete.util.prefs.Preferences
 
 class LastPickedValuesStore<T : Any>(
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
     private val key: String,
     private val serialize: (T) -> String,
     private val deserialize: (String) -> T?, // null = unwanted value, see mostCommonWithin
@@ -13,9 +12,7 @@ class LastPickedValuesStore<T : Any>(
 ) {
     fun add(newValues: Iterable<T>) {
         val lastValues = newValues.asSequence().map(serialize) + getRaw()
-        prefs.edit {
-            putString(getKey(), lastValues.take(maxEntries).joinToString(","))
-        }
+        prefs.putString(getKey(), lastValues.take(maxEntries).joinToString(","))
     }
 
     fun add(value: T) = add(listOf(value))
diff --git a/app/src/main/java/de/westnordost/streetcomplete/util/LocaleListCompatUtils.kt b/app/src/main/java/de/westnordost/streetcomplete/util/LocaleListCompatUtils.kt
index d23ee5327c5..7413812ddea 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/util/LocaleListCompatUtils.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/util/LocaleListCompatUtils.kt
@@ -1,27 +1,25 @@
 package de.westnordost.streetcomplete.util
 
-import android.content.Context
 import android.content.res.Configuration
 import android.content.res.Resources
 import android.os.Build
 import android.os.LocaleList
 import androidx.core.os.ConfigurationCompat
 import androidx.core.os.LocaleListCompat
-import androidx.preference.PreferenceManager
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.util.ktx.addedToFront
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import java.util.Locale
 
 /** Get the override-locale selected in this app or null if there is no override */
-fun getSelectedLocale(context: Context): Locale? {
-    val prefs = PreferenceManager.getDefaultSharedPreferences(context)
+fun getSelectedLocale(prefs: Preferences): Locale? {
     val languageTag = prefs.getString(Prefs.LANGUAGE_SELECT, "") ?: ""
     return if (languageTag.isEmpty()) null else Locale.forLanguageTag(languageTag)
 }
 
 /** Get the locale selected in this app (if any) appended by the system locales */
-fun getSelectedLocales(context: Context): LocaleListCompat {
-    val locale = getSelectedLocale(context)
+fun getSelectedLocales(prefs: Preferences): LocaleListCompat {
+    val locale = getSelectedLocale(prefs)
     val systemLocales = getSystemLocales()
     return if (locale == null) systemLocales else systemLocales.addedToFront(locale)
 }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/util/ktx/SharedPreferences.kt b/app/src/main/java/de/westnordost/streetcomplete/util/ktx/SharedPreferences.kt
deleted file mode 100644
index 6e734d50157..00000000000
--- a/app/src/main/java/de/westnordost/streetcomplete/util/ktx/SharedPreferences.kt
+++ /dev/null
@@ -1,13 +0,0 @@
-package de.westnordost.streetcomplete.util.ktx
-
-import android.content.SharedPreferences
-
-fun SharedPreferences.containsAll(keys: List<String>): Boolean = keys.all { contains(it) }
-
-fun SharedPreferences.Editor.putDouble(key: String, value: Double): SharedPreferences.Editor {
-    return putLong(key, value.toRawBits())
-}
-
-fun SharedPreferences.getDouble(key: String, defValue: Double = 0.0): Double {
-    return Double.fromBits(getLong(key, defValue.toRawBits()))
-}
diff --git a/app/src/main/java/de/westnordost/streetcomplete/util/prefs/AndroidPreferences.kt b/app/src/main/java/de/westnordost/streetcomplete/util/prefs/AndroidPreferences.kt
new file mode 100644
index 00000000000..0ea5631f4eb
--- /dev/null
+++ b/app/src/main/java/de/westnordost/streetcomplete/util/prefs/AndroidPreferences.kt
@@ -0,0 +1,84 @@
+package de.westnordost.streetcomplete.util.prefs
+
+import android.content.SharedPreferences
+import androidx.core.content.edit
+import de.westnordost.streetcomplete.util.Listeners
+
+class AndroidPreferences(private val prefs: SharedPreferences) :
+    Preferences,
+    SharedPreferences.OnSharedPreferenceChangeListener {
+
+    private val listeners = Listeners<Preferences.Listener>()
+
+    init {
+        prefs.registerOnSharedPreferenceChangeListener(this)
+    }
+
+    override fun putBoolean(key: String, boolean: Boolean) {
+        prefs.edit { putBoolean(key, boolean) }
+    }
+
+    override fun putInt(key: String, int: Int) {
+        prefs.edit { putInt(key, int) }
+    }
+
+    override fun putLong(key: String, long: Long) {
+        prefs.edit { putLong(key, long) }
+    }
+
+    override fun putFloat(key: String, float: Float) {
+        prefs.edit { putFloat(key, float) }
+    }
+
+    override fun putDouble(key: String, double: Double) {
+        prefs.edit { putLong(key, double.toRawBits()) }
+    }
+
+    override fun putString(key: String, string: String?) {
+        prefs.edit { putString(key, string) }
+    }
+
+    override fun getBoolean(key: String, defaultValue: Boolean): Boolean {
+        return prefs.getBoolean(key, defaultValue)
+    }
+
+    override fun getInt(key: String, defaultValue: Int): Int {
+        return prefs.getInt(key, defaultValue)
+    }
+
+    override fun getLong(key: String, defaultValue: Long): Long {
+        return prefs.getLong(key, defaultValue)
+    }
+
+    override fun getFloat(key: String, defaultValue: Float): Float {
+        return prefs.getFloat(key, defaultValue)
+    }
+
+    override fun getDouble(key: String, defaultValue: Double): Double {
+        return Double.fromBits(prefs.getLong(key, defaultValue.toRawBits()))
+    }
+
+    override fun getString(key: String, defaultValue: String?): String? {
+        return prefs.getString(key, defaultValue)
+    }
+
+    override fun contains(key: String): Boolean {
+        return prefs.contains(key)
+    }
+
+    override fun remove(key: String) {
+        prefs.edit { remove(key) }
+    }
+
+    override fun addListener(listener: Preferences.Listener) {
+        listeners.add(listener)
+    }
+
+    override fun removeListener(listener: Preferences.Listener) {
+        listeners.remove(listener)
+    }
+
+    override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences, key: String) {
+        listeners.forEach { it.onPreferencesChanged(key) }
+    }
+}
diff --git a/app/src/main/java/de/westnordost/streetcomplete/util/prefs/Preferences.kt b/app/src/main/java/de/westnordost/streetcomplete/util/prefs/Preferences.kt
new file mode 100644
index 00000000000..5fcb3747a9c
--- /dev/null
+++ b/app/src/main/java/de/westnordost/streetcomplete/util/prefs/Preferences.kt
@@ -0,0 +1,29 @@
+package de.westnordost.streetcomplete.util.prefs
+
+interface Preferences {
+    interface Listener {
+        fun onPreferencesChanged(key: String)
+    }
+
+    fun putBoolean(key: String, boolean: Boolean)
+    fun putInt(key: String, int: Int)
+    fun putLong(key: String, long: Long)
+    fun putFloat(key: String, float: Float)
+    fun putDouble(key: String, double: Double)
+    fun putString(key: String, string: String?)
+
+    fun getBoolean(key: String, defaultValue: Boolean): Boolean
+    fun getInt(key: String, defaultValue: Int): Int
+    fun getLong(key: String, defaultValue: Long): Long
+    fun getFloat(key: String, defaultValue: Float): Float
+    fun getDouble(key: String, defaultValue: Double): Double
+    fun getString(key: String, defaultValue: String?): String?
+
+    fun contains(key: String): Boolean
+    fun remove(key: String)
+
+    fun addListener(listener: Listener)
+    fun removeListener(listener: Listener)
+}
+
+fun Preferences.containsAll(keys: List<String>): Boolean = keys.all { contains(it) }
diff --git a/app/src/main/java/de/westnordost/streetcomplete/util/prefs/PreferencesModule.kt b/app/src/main/java/de/westnordost/streetcomplete/util/prefs/PreferencesModule.kt
new file mode 100644
index 00000000000..317c35018d3
--- /dev/null
+++ b/app/src/main/java/de/westnordost/streetcomplete/util/prefs/PreferencesModule.kt
@@ -0,0 +1,12 @@
+package de.westnordost.streetcomplete.util.prefs
+
+import android.content.SharedPreferences
+import androidx.preference.PreferenceManager
+import org.koin.android.ext.koin.androidContext
+import org.koin.dsl.module
+
+val preferencesModule = module {
+    factory<SharedPreferences> { PreferenceManager.getDefaultSharedPreferences(androidContext()) }
+
+    single<Preferences> { AndroidPreferences(get()) }
+}
diff --git a/app/src/main/java/de/westnordost/streetcomplete/view/controller/StreetSideSelectWithLastAnswerButtonViewController.kt b/app/src/main/java/de/westnordost/streetcomplete/view/controller/StreetSideSelectWithLastAnswerButtonViewController.kt
index 1bee6ea6acf..db252adb1eb 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/view/controller/StreetSideSelectWithLastAnswerButtonViewController.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/view/controller/StreetSideSelectWithLastAnswerButtonViewController.kt
@@ -1,14 +1,13 @@
 package de.westnordost.streetcomplete.view.controller
 
-import android.content.SharedPreferences
 import android.view.View
 import androidx.annotation.DrawableRes
 import androidx.annotation.StringRes
-import androidx.core.content.edit
 import androidx.core.view.isGone
 import de.westnordost.streetcomplete.R
 import de.westnordost.streetcomplete.databinding.ViewStreetSideLastAnswerButtonBinding
 import de.westnordost.streetcomplete.util.math.normalizeDegrees
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import de.westnordost.streetcomplete.view.Image
 import de.westnordost.streetcomplete.view.ResImage
 import de.westnordost.streetcomplete.view.ResText
@@ -24,7 +23,7 @@ class StreetSideSelectWithLastAnswerButtonViewController<I>(
     private val puzzleView: StreetSideSelectPuzzle,
     private val compassView: View,
     private val lastAnswerButtonBinding: ViewStreetSideLastAnswerButtonBinding,
-    private val prefs: SharedPreferences,
+    private val prefs: Preferences,
     private val lastSelectionPreferencePrefix: String,
     private val serializeLastSelection: (item: I) -> String,
     private val deserializeLastSelection: (str: String) -> I,
@@ -187,13 +186,11 @@ class StreetSideSelectWithLastAnswerButtonViewController<I>(
         val l = if (isUpsideDown) right else left
         val r = if (isUpsideDown) left else right
 
-        prefs.edit {
-            if (showSides == Sides.BOTH) {
-                putString("$lastSelectionPreferencePrefix.left", l?.let { serializeLastSelection(it.value) })
-                putString("$lastSelectionPreferencePrefix.right", r?.let { serializeLastSelection(it.value) })
-            } else {
-                (l ?: r)?.let { putString("$lastSelectionPreferencePrefix.oneSide", serializeLastSelection(it.value)) }
-            }
+        if (showSides == Sides.BOTH) {
+            prefs.putString("$lastSelectionPreferencePrefix.left", l?.let { serializeLastSelection(it.value) })
+            prefs.putString("$lastSelectionPreferencePrefix.right", r?.let { serializeLastSelection(it.value) })
+        } else {
+            (l ?: r)?.let { prefs.putString("$lastSelectionPreferencePrefix.oneSide", serializeLastSelection(it.value)) }
         }
     }
 
diff --git a/app/src/test/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsControllerTest.kt b/app/src/test/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsControllerTest.kt
index 3f2b948b295..f7b1a1c927c 100644
--- a/app/src/test/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsControllerTest.kt
+++ b/app/src/test/java/de/westnordost/streetcomplete/data/user/statistics/StatisticsControllerTest.kt
@@ -1,6 +1,5 @@
 package de.westnordost.streetcomplete.data.user.statistics
 
-import android.content.SharedPreferences
 import de.westnordost.countryboundaries.CountryBoundaries
 import de.westnordost.streetcomplete.Prefs
 import de.westnordost.streetcomplete.data.user.UserLoginStatusSource
@@ -8,6 +7,7 @@ import de.westnordost.streetcomplete.testutils.any
 import de.westnordost.streetcomplete.testutils.mock
 import de.westnordost.streetcomplete.testutils.on
 import de.westnordost.streetcomplete.testutils.p
+import de.westnordost.streetcomplete.util.prefs.Preferences
 import kotlinx.datetime.LocalDate
 import org.mockito.ArgumentMatchers.anyDouble
 import org.mockito.Mockito.verify
@@ -24,7 +24,7 @@ class StatisticsControllerTest {
     private lateinit var currentWeekCountryStatisticsDao: CountryStatisticsDao
     private lateinit var activeDatesDao: ActiveDatesDao
     private lateinit var countryBoundaries: CountryBoundaries
-    private lateinit var prefs: SharedPreferences
+    private lateinit var prefs: Preferences
     private lateinit var loginStatusSource: UserLoginStatusSource
     private lateinit var loginStatusListener: UserLoginStatusSource.Listener
 
@@ -42,7 +42,6 @@ class StatisticsControllerTest {
         activeDatesDao = mock()
         countryBoundaries = mock()
         prefs = mock()
-        on(prefs.edit()).thenReturn(mock())
         listener = mock()
         loginStatusSource = mock()
 
@@ -120,9 +119,6 @@ class StatisticsControllerTest {
     }
 
     @Test fun `clear all`() {
-        val editor: SharedPreferences.Editor = mock()
-        on(prefs.edit()).thenReturn(editor)
-
         loginStatusListener.onLoggedOut()
 
         verify(editTypeStatisticsDao).clear()
@@ -130,18 +126,15 @@ class StatisticsControllerTest {
         verify(currentWeekCountryStatisticsDao).clear()
         verify(currentWeekEditTypeStatisticsDao).clear()
         verify(activeDatesDao).clear()
-        verify(editor).remove(Prefs.USER_DAYS_ACTIVE)
-        verify(editor).remove(Prefs.IS_SYNCHRONIZING_STATISTICS)
-        verify(editor).remove(Prefs.USER_GLOBAL_RANK)
-        verify(editor).remove(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK)
-        verify(editor).remove(Prefs.USER_LAST_TIMESTAMP_ACTIVE)
+        verify(prefs).remove(Prefs.USER_DAYS_ACTIVE)
+        verify(prefs).remove(Prefs.IS_SYNCHRONIZING_STATISTICS)
+        verify(prefs).remove(Prefs.USER_GLOBAL_RANK)
+        verify(prefs).remove(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK)
+        verify(prefs).remove(Prefs.USER_LAST_TIMESTAMP_ACTIVE)
         verify(listener).onCleared()
     }
 
     @Test fun `update all`() {
-        val editor: SharedPreferences.Editor = mock()
-        on(prefs.edit()).thenReturn(editor)
-
         statisticsController.updateAll(Statistics(
             types = listOf(
                 EditTypeStatistics(questA, 123),
@@ -190,12 +183,12 @@ class StatisticsControllerTest {
             LocalDate.parse("1999-04-08"),
             LocalDate.parse("1888-01-02")
         ))
-        verify(editor).putInt(Prefs.ACTIVE_DATES_RANGE, 12)
-        verify(editor).putInt(Prefs.USER_DAYS_ACTIVE, 333)
-        verify(editor).putBoolean(Prefs.IS_SYNCHRONIZING_STATISTICS, false)
-        verify(editor).putInt(Prefs.USER_GLOBAL_RANK, 999)
-        verify(editor).putInt(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK, 111)
-        verify(editor).putLong(Prefs.USER_LAST_TIMESTAMP_ACTIVE, 9999999)
+        verify(prefs).putInt(Prefs.ACTIVE_DATES_RANGE, 12)
+        verify(prefs).putInt(Prefs.USER_DAYS_ACTIVE, 333)
+        verify(prefs).putBoolean(Prefs.IS_SYNCHRONIZING_STATISTICS, false)
+        verify(prefs).putInt(Prefs.USER_GLOBAL_RANK, 999)
+        verify(prefs).putInt(Prefs.USER_GLOBAL_RANK_CURRENT_WEEK, 111)
+        verify(prefs).putLong(Prefs.USER_LAST_TIMESTAMP_ACTIVE, 9999999)
         verify(listener).onUpdatedAll()
     }
 }
