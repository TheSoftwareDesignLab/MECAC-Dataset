diff --git a/app/src/main/java/de/westnordost/streetcomplete/data/user/oauth/OAuthService.kt b/app/src/main/java/de/westnordost/streetcomplete/data/user/oauth/OAuthService.kt
index c19e1d7cb11..91535d92285 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/data/user/oauth/OAuthService.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/data/user/oauth/OAuthService.kt
@@ -28,20 +28,23 @@ import kotlin.io.encoding.ExperimentalEncodingApi
  * 2. Let user accept or deny the permission request in the browser (or web view). Authorization
  *    endpoint will call the redirect URI (aka callback URI) with parameters in either case.
  * 3. Check if the URI received is matches the OAuthAuthorizationParams instance with itsForMe(uri)
- *    and then extractAuthorizationCode(uri) from that URI
- * 4. OAuthService.retrieveAccessToken(authorizationCode) with the retrieved authorizationCode
+ *    and feed the received uri to OAuthService.retrieveAccessToken(uri)
  */
 class OAuthService(private val httpClient: HttpClient) {
     private val json = Json { ignoreUnknownKeys = true }
 
     /**
-     * Retrieves the access token, using the previously retrieved [authorizationCode]
+     * Retrieves the access token, given the [authorizationResponseUrl]
      *
      * @throws OAuthException if there has been an OAuth authorization error
      * @throws OAuthConnectionException if the server reply is malformed or there is an issue with
      *                                   the connection
      */
-    suspend fun retrieveAccessToken(request: OAuthAuthorizationParams, authorizationCode: String): AccessTokenResponse {
+    suspend fun retrieveAccessToken(
+        request: OAuthAuthorizationParams,
+        authorizationResponseUrl: String
+    ): AccessTokenResponse {
+        val authorizationCode = extractAuthorizationCode(authorizationResponseUrl)
         try {
             val response = httpClient.post(request.accessTokenUrl) {
                 url {
@@ -144,7 +147,7 @@ class OAuthService(private val httpClient: HttpClient) {
  *                        the user did not accept the requested permissions
  * @throws OAuthConnectionException if the server reply is malformed
  */
-fun extractAuthorizationCode(uri: String): String {
+private fun extractAuthorizationCode(uri: String): String {
     val parameters = Url(uri).parameters
     val authorizationCode = parameters["code"]
     if (authorizationCode != null) return authorizationCode
diff --git a/app/src/main/java/de/westnordost/streetcomplete/screens/user/login/LoginViewModel.kt b/app/src/main/java/de/westnordost/streetcomplete/screens/user/login/LoginViewModel.kt
index 3c444ba212f..9fde30650e5 100644
--- a/app/src/main/java/de/westnordost/streetcomplete/screens/user/login/LoginViewModel.kt
+++ b/app/src/main/java/de/westnordost/streetcomplete/screens/user/login/LoginViewModel.kt
@@ -13,7 +13,6 @@ import de.westnordost.streetcomplete.data.user.UserUpdater
 import de.westnordost.streetcomplete.data.user.oauth.OAuthAuthorizationParams
 import de.westnordost.streetcomplete.data.user.oauth.OAuthException
 import de.westnordost.streetcomplete.data.user.oauth.OAuthService
-import de.westnordost.streetcomplete.data.user.oauth.extractAuthorizationCode
 import de.westnordost.streetcomplete.util.ktx.launch
 import de.westnordost.streetcomplete.util.logs.Log
 import kotlinx.coroutines.Dispatchers
@@ -104,9 +103,8 @@ class LoginViewModelImpl(
     private suspend fun retrieveAccessToken(authorizationResponseUrl: String): String? {
         try {
             loginState.value = RetrievingAccessToken
-            val authorizationCode = extractAuthorizationCode(authorizationResponseUrl)
             val accessTokenResponse = withContext(Dispatchers.IO) {
-                oAuthService.retrieveAccessToken(oAuth, authorizationCode)
+                oAuthService.retrieveAccessToken(oAuth, authorizationResponseUrl)
             }
             if (accessTokenResponse.grantedScopes?.containsAll(OAUTH2_REQUIRED_SCOPES) == false) {
                 loginState.value = LoginError.RequiredPermissionsNotGranted
diff --git a/app/src/test/java/de/westnordost/streetcomplete/data/user/oauth/OAuthAuthorizationTest.kt b/app/src/test/java/de/westnordost/streetcomplete/data/user/oauth/OAuthAuthorizationTest.kt
index 243ea1c5674..a9bd639ffda 100644
--- a/app/src/test/java/de/westnordost/streetcomplete/data/user/oauth/OAuthAuthorizationTest.kt
+++ b/app/src/test/java/de/westnordost/streetcomplete/data/user/oauth/OAuthAuthorizationTest.kt
@@ -2,6 +2,7 @@ package de.westnordost.streetcomplete.data.user.oauth
 
 import io.ktor.client.HttpClient
 import io.ktor.client.engine.mock.MockEngine
+import io.ktor.client.engine.mock.MockEngineConfig
 import io.ktor.client.engine.mock.respondError
 import io.ktor.client.engine.mock.respondOk
 import io.ktor.http.HeadersBuilder
@@ -80,83 +81,89 @@ class OAuthAuthorizationTest {
         assertFalse(oauth.itsForMe("localboost://oauth"))
     }
 
-    @Test fun `extractAuthorizationCode fails with useful error messages`() {
+    @Test fun `extractAuthorizationCode fails with useful error messages`(): Unit = runBlocking {
+        val oauth = createOAuth()
+        val service = OAuthService(HttpClient(MockEngine { respondOk() }))
+
         // server did not respond correctly with "error"
         assertFailsWith<OAuthConnectionException> {
-            extractAuthorizationCode("localhost://oauth?e=something")
+            service.retrieveAccessToken(oauth, "localhost://oauth?e=something")
         }
 
         try {
-            extractAuthorizationCode("localhost://oauth?error=hey%2Bwhat%27s%2Bup")
+            service.retrieveAccessToken(oauth, "localhost://oauth?error=hey%2Bwhat%27s%2Bup")
         } catch (e: OAuthException) {
             assertEquals("hey what's up", e.message)
         }
 
         try {
-            extractAuthorizationCode("localhost://oauth?error=A%21&error_description=B%21")
+            service.retrieveAccessToken(oauth, "localhost://oauth?error=A%21&error_description=B%21")
         } catch (e: OAuthException) {
             assertEquals("A!: B!", e.message)
         }
 
         try {
-            extractAuthorizationCode("localhost://oauth?error=A%21&error_uri=http%3A%2F%2Fabc.de")
+            service.retrieveAccessToken(oauth, "localhost://oauth?error=A%21&error_uri=http%3A%2F%2Fabc.de")
         } catch (e: OAuthException) {
             assertEquals("A! (see http://abc.de)", e.message)
         }
 
         try {
-            extractAuthorizationCode("localhost://oauth?error=A%21&error_description=B%21&error_uri=http%3A%2F%2Fabc.de")
+            service.retrieveAccessToken(oauth, "localhost://oauth?error=A%21&error_description=B%21&error_uri=http%3A%2F%2Fabc.de")
         } catch (e: OAuthException) {
             assertEquals("A!: B! (see http://abc.de)", e.message)
         }
     }
 
-    @Test fun extractAuthorizationCode() {
-        assertEquals(
-            "my code",
-            extractAuthorizationCode("localhost://oauth?code=my%20code")
-        )
-    }
-
-    @Test fun `retrieveAccessToken generates valid access token`() = runBlocking {
-        val service = OAuthService(HttpClient(MockEngine { _ -> respondOk("""{
-            "access_token": "TOKEN",
-            "token_type": "bearer",
-            "scope": "A B C"
-        }""")
+    @Test fun extractAuthorizationCode() = runBlocking {
+        val service = OAuthService(HttpClient(MockEngine { request ->
+            if (request.url.parameters["code"] == "my code") {
+                respondOk("""{
+                    "access_token": "TOKEN",
+                    "token_type": "bearer",
+                    "scope": "A B C"
+                }""")
+            } else {
+                respondError(HttpStatusCode.BadRequest)
+            }
         }))
+        val oauth = createOAuth()
 
-        val tokenResponse = service.retrieveAccessToken(dummyOAuthAuthorization(), "")
-
-        assertEquals(AccessTokenResponse("TOKEN", listOf("A", "B", "C")), tokenResponse)
+        assertEquals(
+            AccessTokenResponse("TOKEN", listOf("A", "B", "C")),
+            service.retrieveAccessToken(oauth, "localhost://oauth?code=my%20code")
+        )
     }
 
     @Test fun `retrieveAccessToken throws OAuthConnectionException with invalid response token_type`(): Unit = runBlocking {
-        val service = OAuthService(HttpClient(MockEngine { _ -> respondOk("""{
+        val service = OAuthService(HttpClient(MockEngine { respondOk("""{
             "access_token": "TOKEN",
             "token_type": "an_unusual_token_type",
             "scope": "A B C"
         }""")
         }))
 
-        val exception = assertFailsWith<OAuthConnectionException> { service.retrieveAccessToken(dummyOAuthAuthorization(), "") }
+        val exception = assertFailsWith<OAuthConnectionException> {
+            service.retrieveAccessToken(dummyOAuthAuthorization(), "localhost://oauth?code=code")
+        }
 
-        assertEquals("OAuth 2 token endpoint returned an unknown token type (an_unusual_token_type)", exception.message)
+        assertEquals(
+            "OAuth 2 token endpoint returned an unknown token type (an_unusual_token_type)",
+            exception.message
+        )
     }
 
     @Test fun `retrieveAccessToken throws OAuthException when error response`(): Unit = runBlocking {
-        val service = OAuthService(HttpClient(MockEngine { _ ->
-            respondError(
-                HttpStatusCode.BadRequest, """{
-                    "error": "Missing auth code",
-                    "error_description": "Please specify a code",
-                    "error_uri": "code"
-                }"""
-            )
-        }))
+        val service = OAuthService(HttpClient(MockEngine { respondError(
+            HttpStatusCode.BadRequest, """{
+                "error": "Missing auth code",
+                "error_description": "Please specify a code",
+                "error_uri": "code"
+            }"""
+        ) }))
 
         val exception = assertFailsWith<OAuthException> {
-            service.retrieveAccessToken(dummyOAuthAuthorization(), "")
+            service.retrieveAccessToken(dummyOAuthAuthorization(), "localhost://oauth?code=code")
         }
 
         assertEquals("Missing auth code", exception.error)
@@ -166,7 +173,7 @@ class OAuthAuthorizationTest {
     }
 
     @Test fun `retrieveAccessToken generates correct request URL`(): Unit = runBlocking {
-        val mockEngine = MockEngine { _ -> respondOk() }
+        val mockEngine = MockEngine { respondOk() }
         val auth = OAuthAuthorizationParams(
             "",
             "https://www.openstreetmap.org",
@@ -175,7 +182,7 @@ class OAuthAuthorizationTest {
             "scheme://there"
         )
 
-        assertFails { OAuthService(HttpClient(mockEngine)).retrieveAccessToken(auth, "C0D3") }
+        assertFails { OAuthService(HttpClient(mockEngine)).retrieveAccessToken(auth, "scheme://there?code=C0D3") }
 
         val expectedParams = ParametersBuilder()
         expectedParams.append("grant_type", "authorization_code")
@@ -190,9 +197,11 @@ class OAuthAuthorizationTest {
     }
 
     @Test fun `retrieveAccessToken generates request headers`(): Unit = runBlocking {
-        val mockEngine = MockEngine { _ -> respondOk() }
+        val mockEngine = MockEngine { respondOk() }
 
-        assertFails { OAuthService(HttpClient(mockEngine)).retrieveAccessToken(dummyOAuthAuthorization(), "") }
+        assertFails {
+            OAuthService(HttpClient(mockEngine)).retrieveAccessToken(dummyOAuthAuthorization(), "localhost://oauth?code=code")
+        }
 
         val expectedHeaders = HeadersBuilder()
         expectedHeaders.append("Content-Type", "application/x-www-form-urlencoded")
