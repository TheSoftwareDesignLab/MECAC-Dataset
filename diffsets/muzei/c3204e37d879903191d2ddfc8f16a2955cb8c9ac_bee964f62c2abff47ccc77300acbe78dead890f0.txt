diff --git a/source-gallery/build.gradle b/source-gallery/build.gradle
index b32dc1019..112f13a87 100644
--- a/source-gallery/build.gradle
+++ b/source-gallery/build.gradle
@@ -37,7 +37,7 @@ dependencies {
     debugImplementation libs.compose.ui.tooling.runtime
     implementation libs.core
     implementation libs.exifInterface
-    implementation libs.lifecycle.common
+    implementation libs.lifecycle.viewmodel
     implementation libs.paging.compose
     implementation libs.room.ktx
     implementation libs.room.paging
diff --git a/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/settings/GallerySettingsActivity.kt b/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/settings/GallerySettingsActivity.kt
index 671d96095..de71f3290 100644
--- a/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/settings/GallerySettingsActivity.kt
+++ b/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/settings/GallerySettingsActivity.kt
@@ -71,6 +71,7 @@ import androidx.compose.ui.unit.dp
 import androidx.core.content.edit
 import androidx.core.view.WindowCompat
 import androidx.lifecycle.lifecycleScope
+import androidx.lifecycle.viewmodel.compose.viewModel
 import androidx.paging.compose.collectAsLazyPagingItems
 import androidx.savedstate.compose.serialization.serializers.MutableStateSerializer
 import androidx.savedstate.serialization.saved
@@ -133,8 +134,6 @@ class GallerySettingsActivity : ComponentActivity() {
         private const val SHOW_INTERNAL_STORAGE_MESSAGE = "show_internal_storage_message"
     }
 
-    private val viewModel: GallerySettingsViewModel by viewModels()
-
     private var chosenPhotosCount = 0
     private val permissionStateFlow by lazy {
         MutableStateFlow(checkRequestPermissionState(this))
@@ -159,6 +158,7 @@ class GallerySettingsActivity : ComponentActivity() {
             GalleryTheme(
                 dynamicColor = false
             ) {
+                val viewModel: GallerySettingsViewModel = viewModel()
                 val photos = viewModel.chosenPhotos.collectAsLazyPagingItems()
                 val selectedPhotoIds = rememberSerializable(
                     serializer = SnapshotStateSetSerializer()
