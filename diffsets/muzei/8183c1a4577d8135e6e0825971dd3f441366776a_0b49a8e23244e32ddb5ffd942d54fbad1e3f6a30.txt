diff --git a/build.gradle b/build.gradle
index 8a7e82a81..e39deb1cf 100644
--- a/build.gradle
+++ b/build.gradle
@@ -19,13 +19,13 @@ buildscript {
         compileSdkVersion = 31
         targetSdkVersion = 30
 
-        activityVersion = '1.4.0-alpha02'
-        appCompatVersion = '1.4.0-alpha03'
+        activityVersion = '1.4.0-beta01'
+        appCompatVersion = '1.4.0-beta01'
         archCoreVersion = '2.1.0'
-        browserVersion = '1.4.0-alpha01'
+        browserVersion = '1.4.0-beta01'
         coilVersion = '1.3.2'
         constraintLayoutVersion = '2.0.4'
-        coreVersion = '1.7.0-beta01'
+        coreVersion = '1.7.0-beta02'
         coroutinesVersion = '1.5.1'
         dokkaVersion = '1.4.20'
         drawerLayoutVersion = '1.1.1'
@@ -33,28 +33,28 @@ buildscript {
         firebaseAnalyticsVersion = '19.0.1'
         firebaseCrashlyticsVersion = '18.2.0'
         firebasePerfVersion = '20.0.2'
-        fragmentVersion = '1.4.0-alpha09'
+        fragmentVersion = '1.4.0-alpha10'
         kotlinVersion = '1.5.30'
         kspVersion = '1.5.30-1.0.0'
-        lifecycleVersion = '2.4.0-beta01'
+        lifecycleVersion = '2.4.0-rc01'
         materialVersion = '1.5.0-alpha03'
         multidexVersion = '2.0.1'
-        navigationVersion = '2.4.0-alpha09'
+        navigationVersion = '2.4.0-alpha10'
         okhttpVersion = '3.12.12'
         okhttpCoroutinesVersion = '1.0'
-        pagingVersion = '3.1.0-alpha03'
+        pagingVersion = '3.1.0-alpha04'
         playServicesWearableVersion = '17.1.0'
         preferenceVersion = '1.1.1'
         recyclerViewVersion = '1.3.0-alpha01'
         retrofitVersion = '2.9.0'
-        roomVersion = '2.4.0-alpha04'
+        roomVersion = '2.4.0-alpha05'
         subsamplingVersion = '3.10.0'
         swipeRefreshLayoutVersion = '1.1.0'
         taskerVersion = '0.4.1'
         viewPager2Version = '1.1.0-beta01'
         wearableVersion = '2.8.1'
         wearVersion = '1.1.0'
-        workManagerVersion = '2.7.0-beta01'
+        workManagerVersion = '2.7.0-rc01'
     }
 
     repositories {
diff --git a/extensions/src/main/java/com/google/android/apps/muzei/util/MenuHostExt.kt b/extensions/src/main/java/com/google/android/apps/muzei/util/MenuHostExt.kt
new file mode 100644
index 000000000..96b16c600
--- /dev/null
+++ b/extensions/src/main/java/com/google/android/apps/muzei/util/MenuHostExt.kt
@@ -0,0 +1,45 @@
+/*
+ * Copyright 2021 Google Inc.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.google.android.apps.muzei.util
+
+import android.view.Menu
+import android.view.MenuInflater
+import android.view.MenuItem
+import androidx.annotation.MenuRes
+import androidx.core.view.MenuHost
+import androidx.core.view.MenuProvider
+
+/**
+ * Add a [MenuProvider] created from the [menuRes] and
+ * [onSelected].
+ *
+ * @return The newly created [MenuProvider].
+ */
+fun MenuHost.addMenuProvider(
+    @MenuRes menuRes: Int,
+    onSelected: (menuItem: MenuItem) -> Boolean
+): MenuProvider = object : MenuProvider {
+    override fun onCreateMenu(menu: Menu, menuInflater: MenuInflater) {
+        menuInflater.inflate(menuRes, menu)
+    }
+
+    override fun onMenuItemSelected(menuItem: MenuItem): Boolean {
+        return onSelected(menuItem)
+    }
+}.also {
+    addMenuProvider(it)
+}
diff --git a/main/src/main/java/com/google/android/apps/muzei/browse/BrowseProviderFragment.kt b/main/src/main/java/com/google/android/apps/muzei/browse/BrowseProviderFragment.kt
index 983dc9a2d..6ccbb39ed 100644
--- a/main/src/main/java/com/google/android/apps/muzei/browse/BrowseProviderFragment.kt
+++ b/main/src/main/java/com/google/android/apps/muzei/browse/BrowseProviderFragment.kt
@@ -39,6 +39,7 @@ import com.google.android.apps.muzei.room.MuzeiDatabase
 import com.google.android.apps.muzei.room.getCommands
 import com.google.android.apps.muzei.sync.ProviderManager
 import com.google.android.apps.muzei.util.ContentProviderClientCompat
+import com.google.android.apps.muzei.util.addMenuProvider
 import com.google.android.apps.muzei.util.collectIn
 import com.google.android.apps.muzei.util.toast
 import com.google.firebase.analytics.FirebaseAnalytics
@@ -87,8 +88,7 @@ class BrowseProviderFragment: Fragment(R.layout.browse_provider_fragment) {
                     navController.popBackStack()
                 }
             }
-            inflateMenu(R.menu.browse_provider_fragment)
-            setOnMenuItemClickListener {
+            addMenuProvider(R.menu.browse_provider_fragment) {
                 refresh(binding.swipeRefresh)
                 true
             }
diff --git a/main/src/main/java/com/google/android/apps/muzei/legacy/LegacySourceInfoFragment.kt b/main/src/main/java/com/google/android/apps/muzei/legacy/LegacySourceInfoFragment.kt
index 6dc778154..5ea28900c 100644
--- a/main/src/main/java/com/google/android/apps/muzei/legacy/LegacySourceInfoFragment.kt
+++ b/main/src/main/java/com/google/android/apps/muzei/legacy/LegacySourceInfoFragment.kt
@@ -32,6 +32,7 @@ import androidx.navigation.fragment.findNavController
 import androidx.recyclerview.widget.DiffUtil
 import androidx.recyclerview.widget.ListAdapter
 import androidx.recyclerview.widget.RecyclerView
+import com.google.android.apps.muzei.util.addMenuProvider
 import com.google.android.apps.muzei.util.collectIn
 import com.google.android.apps.muzei.util.toast
 import com.google.firebase.analytics.FirebaseAnalytics
@@ -66,8 +67,7 @@ class LegacySourceInfoFragment : Fragment(R.layout.legacy_source_info_fragment)
                 startActivity(Intent(Intent.ACTION_VIEW, LegacySourceManager.LEARN_MORE_LINK))
             }
         } else {
-            binding.toolbar.inflateMenu(R.menu.legacy_source_info_fragment)
-            binding.toolbar.setOnMenuItemClickListener {
+            binding.toolbar.addMenuProvider(R.menu.legacy_source_info_fragment) {
                 startActivity(Intent(Intent.ACTION_VIEW, LegacySourceManager.LEARN_MORE_LINK))
                 true
             }
diff --git a/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt b/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt
index bd878970e..6dcf348da 100644
--- a/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt
+++ b/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt
@@ -69,6 +69,7 @@ import coil.load
 import com.google.android.apps.muzei.gallery.databinding.GalleryActivityBinding
 import com.google.android.apps.muzei.gallery.databinding.GalleryChosenPhotoItemBinding
 import com.google.android.apps.muzei.util.MultiSelectionController
+import com.google.android.apps.muzei.util.addMenuProvider
 import com.google.android.apps.muzei.util.collectIn
 import com.google.android.apps.muzei.util.getString
 import com.google.android.apps.muzei.util.getStringOrNull
@@ -388,24 +389,22 @@ class GallerySettingsActivity : AppCompatActivity(),
             multiSelectionController.reset(true)
         }
 
-        binding.selectionToolbar.inflateMenu(R.menu.gallery_selection)
-        binding.selectionToolbar.setOnMenuItemClickListener { item ->
+        binding.selectionToolbar.addMenuProvider(R.menu.gallery_selection) { item ->
             when (item.itemId) {
                 R.id.action_remove -> {
-                    val removePhotos = ArrayList(
-                            multiSelectionController.selection)
+                    val removePhotos = ArrayList(multiSelectionController.selection)
 
                     lifecycleScope.launch(NonCancellable) {
                         // Remove chosen URIs
                         GalleryDatabase.getInstance(this@GallerySettingsActivity)
-                                .chosenPhotoDao()
-                                .delete(this@GallerySettingsActivity, removePhotos)
+                            .chosenPhotoDao()
+                            .delete(this@GallerySettingsActivity, removePhotos)
                     }
 
                     multiSelectionController.reset(true)
-                    return@setOnMenuItemClickListener true
+                    true
                 }
-                else -> return@setOnMenuItemClickListener false
+                else -> false
             }
         }
 
