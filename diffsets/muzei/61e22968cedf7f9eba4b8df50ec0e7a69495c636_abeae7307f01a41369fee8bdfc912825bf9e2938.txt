diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml
index 02e94ee31..152cad3e5 100644
--- a/gradle/libs.versions.toml
+++ b/gradle/libs.versions.toml
@@ -16,31 +16,31 @@
 
 [versions]
 
-compileSdk = "33"
+compileSdk = "34"
 targetSdk = "33"
 agp = "8.1.2"
 
 # AndroidX
-activity = "1.7.2"
-appCompat = "1.7.0-alpha02"
-browser = "1.5.0"
+activity = "1.8.0"
+appCompat = "1.7.0-alpha03"
+browser = "1.6.0"
 constraintLayout = "2.1.4"
-core = "1.10.1"
+core = "1.12.0"
 drawerLayout = "1.2.0"
 exifInterface = "1.3.6"
-fragment = "1.6.0"
-lifecycle = "2.6.1"
+fragment = "1.6.1"
+lifecycle = "2.6.2"
 multidex = "2.0.1"
-navigation = "2.7.0-beta01"
-paging = "3.2.0-beta01"
-preference = "1.2.0"
-recyclerView = "1.3.1-rc01"
-room = "2.6.0-alpha01"
+navigation = "2.7.4"
+paging = "3.2.1"
+preference = "1.2.1"
+recyclerView = "1.3.1"
+room = "2.6.0-rc01"
 swipeRefreshLayout = "1.1.0"
 viewPager2 = "1.1.0-beta02"
 watchface = "1.1.1"
 wear = "1.2.0"
-workManager = "2.9.0-alpha01"
+workManager = "2.9.0-beta01"
 
 # Firebase
 firebaseAnalytics = "21.3.0"
diff --git a/main/src/main/java/com/google/android/apps/muzei/MuzeiApplication.kt b/main/src/main/java/com/google/android/apps/muzei/MuzeiApplication.kt
index 595c28381..0cb06a582 100644
--- a/main/src/main/java/com/google/android/apps/muzei/MuzeiApplication.kt
+++ b/main/src/main/java/com/google/android/apps/muzei/MuzeiApplication.kt
@@ -75,7 +75,7 @@ class MuzeiApplication : MultiDexApplication(), SharedPreferences.OnSharedPrefer
         sharedPreferences.registerOnSharedPreferenceChangeListener(this)
     }
 
-    override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences, key: String) {
+    override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences?, key: String?) {
         if (key == ALWAYS_DARK_KEY) {
             updateNightMode()
         }
diff --git a/main/src/main/java/com/google/android/apps/muzei/quicksettings/NextArtworkTileService.kt b/main/src/main/java/com/google/android/apps/muzei/quicksettings/NextArtworkTileService.kt
index 558b39868..07f08ab03 100644
--- a/main/src/main/java/com/google/android/apps/muzei/quicksettings/NextArtworkTileService.kt
+++ b/main/src/main/java/com/google/android/apps/muzei/quicksettings/NextArtworkTileService.kt
@@ -16,6 +16,7 @@
 
 package com.google.android.apps.muzei.quicksettings
 
+import android.app.PendingIntent
 import android.app.WallpaperManager
 import android.content.ActivityNotFoundException
 import android.content.ComponentName
@@ -26,6 +27,8 @@ import android.service.quicksettings.Tile
 import android.service.quicksettings.TileService
 import android.widget.Toast
 import androidx.annotation.RequiresApi
+import androidx.core.service.quicksettings.PendingIntentActivityWrapper
+import androidx.core.service.quicksettings.TileServiceCompat
 import androidx.lifecycle.Lifecycle
 import androidx.lifecycle.LifecycleOwner
 import androidx.lifecycle.LifecycleRegistry
@@ -123,15 +126,28 @@ class NextArtworkTileService : TileService(), LifecycleOwner {
                     // Inactive means we attempt to activate Muzei
                     Firebase.analytics.logEvent("tile_next_artwork_activate", null)
                     try {
-                        startActivityAndCollapse(Intent(WallpaperManager.ACTION_CHANGE_LIVE_WALLPAPER)
+                        val wrapper = PendingIntentActivityWrapper(
+                            context,
+                            0,
+                            Intent(WallpaperManager.ACTION_CHANGE_LIVE_WALLPAPER)
                                 .putExtra(WallpaperManager.EXTRA_LIVE_WALLPAPER_COMPONENT,
-                                        ComponentName(context,
-                                                MuzeiWallpaperService::class.java))
-                                .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK))
+                                    ComponentName(context, MuzeiWallpaperService::class.java))
+                                .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK),
+                            0,
+                            false
+                        )
+                        TileServiceCompat.startActivityAndCollapse(context, wrapper)
                     } catch (_: ActivityNotFoundException) {
                         try {
-                            startActivityAndCollapse(Intent(WallpaperManager.ACTION_LIVE_WALLPAPER_CHOOSER)
-                                    .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK))
+                            val wrapper = PendingIntentActivityWrapper(
+                                context,
+                                0,
+                                Intent(WallpaperManager.ACTION_LIVE_WALLPAPER_CHOOSER)
+                                    .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK),
+                                0,
+                                false
+                            )
+                            TileServiceCompat.startActivityAndCollapse(context, wrapper)
                         } catch (e: ActivityNotFoundException) {
                             context.toast(R.string.error_wallpaper_chooser, Toast.LENGTH_LONG)
                         }
diff --git a/main/src/main/java/com/google/android/apps/muzei/util/PanScaleProxyView.kt b/main/src/main/java/com/google/android/apps/muzei/util/PanScaleProxyView.kt
index 00dbe653f..8d46f5c68 100644
--- a/main/src/main/java/com/google/android/apps/muzei/util/PanScaleProxyView.kt
+++ b/main/src/main/java/com/google/android/apps/muzei/util/PanScaleProxyView.kt
@@ -163,7 +163,7 @@ class PanScaleProxyView @JvmOverloads constructor(context: Context, attrs: Attri
             return true
         }
 
-        override fun onScroll(e1: MotionEvent, e2: MotionEvent, distanceX: Float, distanceY: Float): Boolean {
+        override fun onScroll(e1: MotionEvent?, e2: MotionEvent, distanceX: Float, distanceY: Float): Boolean {
             if (!panScaleEnabled) {
                 return false
             }
@@ -185,7 +185,7 @@ class PanScaleProxyView @JvmOverloads constructor(context: Context, attrs: Attri
             return true
         }
 
-        override fun onFling(e1: MotionEvent, e2: MotionEvent, velocityX: Float, velocityY: Float): Boolean {
+        override fun onFling(e1: MotionEvent?, e2: MotionEvent, velocityX: Float, velocityY: Float): Boolean {
             if (!panScaleEnabled) {
                 return false
             }
diff --git a/wearable/src/main/java/com/google/android/apps/muzei/util/PanView.kt b/wearable/src/main/java/com/google/android/apps/muzei/util/PanView.kt
index 26d703ab9..f6b1d763d 100644
--- a/wearable/src/main/java/com/google/android/apps/muzei/util/PanView.kt
+++ b/wearable/src/main/java/com/google/android/apps/muzei/util/PanView.kt
@@ -300,7 +300,7 @@ class PanView @JvmOverloads constructor(context: Context, attrs: AttributeSet? =
             return true
         }
 
-        override fun onScroll(e1: MotionEvent, e2: MotionEvent, distanceX: Float, distanceY: Float): Boolean {
+        override fun onScroll(e1: MotionEvent?, e2: MotionEvent, distanceX: Float, distanceY: Float): Boolean {
             val scaledImage = scaledImage ?: return true
 
             val oldOffsetX = offsetX
@@ -341,7 +341,7 @@ class PanView @JvmOverloads constructor(context: Context, attrs: AttributeSet? =
             return true
         }
 
-        override fun onFling(e1: MotionEvent, e2: MotionEvent, velocityX: Float, velocityY: Float): Boolean {
+        override fun onFling(e1: MotionEvent?, e2: MotionEvent, velocityX: Float, velocityY: Float): Boolean {
             val scaledImage = scaledImage ?: return true
 
             releaseEdgeEffects()
