diff --git a/example-unsplash/src/main/java/com/example/muzei/unsplash/UnsplashService.kt b/example-unsplash/src/main/java/com/example/muzei/unsplash/UnsplashService.kt
index 0ef77884a..c9db0bde3 100644
--- a/example-unsplash/src/main/java/com/example/muzei/unsplash/UnsplashService.kt
+++ b/example-unsplash/src/main/java/com/example/muzei/unsplash/UnsplashService.kt
@@ -34,7 +34,7 @@ internal interface UnsplashService {
             val okHttpClient = OkHttpClient.Builder()
                     .addInterceptor { chain ->
                         var request = chain.request()
-                        val url = request.url().newBuilder()
+                        val url = request.url.newBuilder()
                                 .addQueryParameter("client_id", CONSUMER_KEY).build()
                         request = request.newBuilder().url(url).build()
                         chain.proceed(request)
@@ -84,4 +84,4 @@ internal interface UnsplashService {
     data class User(
             val name: String,
             val links: Links)
-}
+}
\ No newline at end of file
diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml
index ef2a9244b..14c313716 100644
--- a/gradle/libs.versions.toml
+++ b/gradle/libs.versions.toml
@@ -64,12 +64,11 @@ kotlin = "2.1.21"
 ksp = "2.1.21-2.0.1"
 
 # Other
-coil = "1.3.2"
+coil = "2.7.0"
 material = "1.12.0"
-#noinspection GradleDependency
-okhttp = "3.12.12"
+okhttp = "5.1.0"
 okhttpCoroutines = "1.0"
-retrofit = "2.9.0"
+retrofit = "3.0.0"
 subsampling = "3.10.0"
 tasker = "0.4.1"
 
diff --git a/legacy-standalone/src/main/java/com/google/android/apps/muzei/legacy/SourceArtProvider.kt b/legacy-standalone/src/main/java/com/google/android/apps/muzei/legacy/SourceArtProvider.kt
index 9102c2f83..0cbfc5609 100644
--- a/legacy-standalone/src/main/java/com/google/android/apps/muzei/legacy/SourceArtProvider.kt
+++ b/legacy-standalone/src/main/java/com/google/android/apps/muzei/legacy/SourceArtProvider.kt
@@ -156,12 +156,10 @@ class SourceArtProvider : MuzeiArtProvider() {
             }?.run {
                 val request = Request.Builder().url(URL(toString())).build()
                 val response = client.newCall(request).execute()
-                val responseCode = response.code()
+                val responseCode = response.code
                 if (responseCode !in 200..299) {
                     throw IOException("HTTP error response $responseCode")
                 }
-                val body = response.body()
-                return body?.byteStream()
-                        ?: throw IOException("Unable to open stream for $this")
+                response.body.byteStream()
             } ?: super.openFile(artwork)
 }
\ No newline at end of file
diff --git a/main/src/main/java/com/google/android/apps/muzei/render/MuzeiRendererFragment.kt b/main/src/main/java/com/google/android/apps/muzei/render/MuzeiRendererFragment.kt
index c12c160f0..391988456 100644
--- a/main/src/main/java/com/google/android/apps/muzei/render/MuzeiRendererFragment.kt
+++ b/main/src/main/java/com/google/android/apps/muzei/render/MuzeiRendererFragment.kt
@@ -29,7 +29,6 @@ import android.view.ViewGroup
 import android.widget.ImageView
 import androidx.core.os.bundleOf
 import androidx.fragment.app.Fragment
-import coil.bitmap.BitmapPool
 import coil.load
 import coil.size.Size
 import coil.transform.Transformation
@@ -66,23 +65,23 @@ class MuzeiRendererFragment : Fragment(), RenderController.Callbacks, MuzeiBlurR
 
     private val simpleDemoModeTransformation = object : Transformation {
         override suspend fun transform(
-                pool: BitmapPool,
-                input: Bitmap,
-                size: Size
+            input: Bitmap,
+            size: Size
         ) = if (!demoFocus) {
             withContext(Dispatchers.IO) {
                 input.blur(requireContext())?.apply {
                     // Dim
                     val c = Canvas(this)
                     c.drawColor(Color.argb(255 - MuzeiBlurRenderer.DEFAULT_MAX_DIM,
-                            0, 0, 0))
+                        0, 0, 0))
                 }
             } ?: input
         } else {
             input
         }
 
-        override fun key() = TRANSFORMATION_ID
+        override val cacheKey: String
+            get() = TRANSFORMATION_ID
     }
 
     override fun onCreate(savedInstanceState: Bundle?) {
@@ -190,4 +189,4 @@ class MuzeiRendererFragment : Fragment(), RenderController.Callbacks, MuzeiBlurR
             super.onDetachedFromWindow()
         }
     }
-}
+}
\ No newline at end of file
diff --git a/source-featured-art/src/main/java/com/google/android/apps/muzei/featuredart/FeaturedArtWorker.kt b/source-featured-art/src/main/java/com/google/android/apps/muzei/featuredart/FeaturedArtWorker.kt
index 7c8a7565c..3474a09a6 100644
--- a/source-featured-art/src/main/java/com/google/android/apps/muzei/featuredart/FeaturedArtWorker.kt
+++ b/source-featured-art/src/main/java/com/google/android/apps/muzei/featuredart/FeaturedArtWorker.kt
@@ -175,7 +175,7 @@ class FeaturedArtWorker(
         val request = Request.Builder()
                 .url(url)
                 .build()
-        val json = client.newCall(request).await().body()?.string()
+        val json = client.newCall(request).await().body.string()
         val tokener = JSONTokener(json)
         return tokener.nextValue() as? JSONObject ?: throw JSONException("Expected JSON object.")
     }
diff --git a/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt b/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt
index a1ef9261d..e798510c3 100644
--- a/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt
+++ b/source-gallery/src/main/java/com/google/android/apps/muzei/gallery/GallerySettingsActivity.kt
@@ -50,16 +50,18 @@ import androidx.appcompat.app.AppCompatActivity
 import androidx.core.content.ContextCompat
 import androidx.core.content.edit
 import androidx.core.graphics.Insets
+import androidx.core.graphics.drawable.toDrawable
 import androidx.core.view.MenuProvider
 import androidx.core.view.ViewCompat
 import androidx.core.view.WindowInsetsCompat
+import androidx.core.view.isVisible
 import androidx.lifecycle.lifecycleScope
 import androidx.paging.PagingDataAdapter
 import androidx.recyclerview.widget.DefaultItemAnimator
 import androidx.recyclerview.widget.DiffUtil
 import androidx.recyclerview.widget.GridLayoutManager
 import androidx.recyclerview.widget.RecyclerView
-import coil.clear
+import coil.dispose
 import coil.load
 import com.google.android.apps.muzei.gallery.databinding.GalleryActivityBinding
 import com.google.android.apps.muzei.gallery.databinding.GalleryChosenPhotoItemBinding
@@ -78,8 +80,6 @@ import kotlinx.coroutines.launch
 import java.util.LinkedList
 import kotlin.math.hypot
 import kotlin.math.max
-import androidx.core.graphics.drawable.toDrawable
-import androidx.core.view.isVisible
 
 private class GetContentsFromActivityInfo : ActivityResultContract<ActivityInfo, List<Uri>>() {
     private val getMultipleContents = ActivityResultContracts.GetMultipleContents()
@@ -661,7 +661,7 @@ class GallerySettingsActivity : AppCompatActivity(),
                 // Show either just the one image or all the images even if
                 // they are just placeholders
                 thumbView.visibility = if (numImages <= 1) View.GONE else View.VISIBLE
-                thumbView.clear()
+                thumbView.dispose()
                 thumbView.setImageDrawable(placeholderDrawable)
             }
             val checked = multiSelectionController.isSelected(chosenPhoto.id)
