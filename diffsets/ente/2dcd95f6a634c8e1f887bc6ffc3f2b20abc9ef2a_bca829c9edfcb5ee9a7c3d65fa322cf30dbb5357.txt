diff --git a/src/pages/gallery/components/Upload.tsx b/src/pages/gallery/components/Upload.tsx
new file mode 100644
index 00000000000..026d2adcc1a
--- /dev/null
+++ b/src/pages/gallery/components/Upload.tsx
@@ -0,0 +1,21 @@
+import React, { useState } from "react"
+import CollectionSelector from "./CollectionSelector"
+import UploadProgress from "./UploadProgress"
+
+export default function Upload({ uploadModalView, closeUploadModal, collectionLatestFile, setData }) {
+    const [progressView, setProgressView] = useState(false);
+    return (<>
+        <CollectionSelector
+            uploadModalView={uploadModalView}
+            closeUploadModal={closeUploadModal}
+            collectionLatestFile={collectionLatestFile}
+            showProgress={() => setProgressView(true)}
+            setData={setData}
+        />
+        <UploadProgress
+            show={progressView}
+            onHide={() => setProgressView(false)}
+        />
+    </>
+    )
+}
\ No newline at end of file
diff --git a/src/pages/gallery/index.tsx b/src/pages/gallery/index.tsx
index e47b778831d..96c19581d0a 100644
--- a/src/pages/gallery/index.tsx
+++ b/src/pages/gallery/index.tsx
@@ -11,6 +11,7 @@ import {
   getFiles,
   getPreview,
   collectionLatestFile,
+  fetchData,
 } from 'services/fileService';
 import { getData, LS_KEYS } from 'utils/storage/localStorage';
 import PreviewCard from './components/PreviewCard';
@@ -22,8 +23,7 @@ import AutoSizer from 'react-virtualized-auto-sizer';
 import { VariableSizeList as List } from 'react-window';
 import Collections from './components/Collections';
 import SadFace from 'components/SadFace';
-import CollectionSelector from './components/CollectionSelector';
-import UploadProgress from './components/UploadProgress';
+import Upload from './components/Upload';
 
 enum ITEM_TYPE {
   TIME = 'TIME',
@@ -106,7 +106,6 @@ export default function Gallery(props) {
   const fetching: { [k: number]: boolean } = {};
 
 
-  const [progressView, setProgressView] = useState(false);
 
   useEffect(() => {
     const key = getKey(SESSION_KEYS.ENCRYPTION_KEY);
@@ -118,25 +117,13 @@ export default function Gallery(props) {
       setLoading(true);
       const encryptionKey = await getActualKey();
       const collections = await fetchCollections(token, encryptionKey);
-      const resp = await getFiles(
-        '0',
-        token,
-        '100',
-        encryptionKey,
-        collections
-      );
+      const data= await fetchData(token,encryptionKey,collections);
       setLoading(false);
       setCollections(collections);
-      setData(
-        resp.map((item) => ({
-          ...item,
-          w: window.innerWidth,
-          h: window.innerHeight,
-        }))
-      );
+      setData(data);
       const collectionLatestFile = await getCollectionLatestFile(
         collections,
-        resp
+        data
       );
       setCollectionLatestFile(collectionLatestFile);
     };
@@ -301,16 +288,12 @@ export default function Gallery(props) {
         selected={router.query.collection?.toString()}
         selectCollection={selectCollection}
       />
-      <CollectionSelector
-        modalView={props.modalView}
-        closeModal={props.closeModal}
-        collectionLatestFile={collectionLatestFile}
-        showProgress={() => setProgressView(true)}
-      />
-      <UploadProgress
-        show={progressView}
-        onHide={() => setProgressView(false)}
-      />
+      <Upload
+       uploadModalView={props.uploadModalView}
+       closeUploadModal={props.closeUploadModal}
+       collectionLatestFile={collectionLatestFile}
+       setData={setData}/>
+
       {filteredData.length ? (
         <Container>
           <AutoSizer>
diff --git a/src/services/fileService.ts b/src/services/fileService.ts
index aad8b9c4082..4079333a81f 100644
--- a/src/services/fileService.ts
+++ b/src/services/fileService.ts
@@ -32,7 +32,7 @@ export interface user {
 export interface collection {
     id: string;
     owner: user;
-    key: string;
+    key: Uint8Array;
     name: string;
     type: string;
     creationTime: number;
@@ -114,6 +114,24 @@ export const fetchCollections = async (token: string, key: string) => {
     return getCollections(token, '0', await worker.fromB64(key));
 };
 
+export const fetchData = async (token, encryptionKey,collections) => {
+    const resp = await getFiles(
+        '0',
+        token,
+        '100',
+        encryptionKey,
+        collections
+    );
+
+    return (
+        resp.map((item) => ({
+            ...item,
+            w: window.innerWidth,
+            h: window.innerHeight,
+        }))
+    );
+}
+
 export const getFiles = async (
     sinceTime: string,
     token: string,
@@ -139,7 +157,7 @@ export const getFiles = async (
                 token,
                 limit,
             });
-            const promises: Promise<file>[] = resp.data.diff.map(
+            const promises: Promise<file>[] = resp.data.diff.filter(file => !file.isDeleted).map(
                 async (file: file) => {
                     file.key = await worker.decrypt(
                         await worker.fromB64(file.encryptedKey),
@@ -160,7 +178,6 @@ export const getFiles = async (
         } while (resp.data.diff.length);
         await localForage.setItem(`${collection.id}-time`, time);
     }
-    files = files.filter((item) => !item.isDeleted);
     await localForage.setItem('files', files);
     return files;
 };
