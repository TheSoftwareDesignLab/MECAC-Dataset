diff --git a/OsmAnd/res/layout/fragment_plan_route_warning.xml b/OsmAnd/res/layout/fragment_plan_route_warning.xml
index 3b7019dd9e6..60c1eb6858a 100644
--- a/OsmAnd/res/layout/fragment_plan_route_warning.xml
+++ b/OsmAnd/res/layout/fragment_plan_route_warning.xml
@@ -1,9 +1,9 @@
 <?xml version="1.0" encoding="utf-8"?>
 <FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:osmand="http://schemas.android.com/apk/res-auto"
 	xmlns:tools="http://schemas.android.com/tools"
 	android:layout_width="match_parent"
 	android:layout_height="match_parent"
-	xmlns:osmand="http://schemas.android.com/apk/res-auto"
 	android:background="@color/color_transparent">
 
 	<LinearLayout
@@ -17,8 +17,8 @@
 			android:id="@+id/map_controls_container"
 			android:layout_width="match_parent"
 			android:layout_height="wrap_content"
-			android:visibility="gone"
-			android:layout_gravity="bottom">
+			android:layout_gravity="bottom"
+			android:visibility="gone">
 
 			<include
 				layout="@layout/map_ruler"
@@ -56,16 +56,15 @@
 			android:layout_width="match_parent"
 			android:layout_height="wrap_content"
 			android:background="?attr/list_background_color"
+			android:clickable="true"
+			android:focusable="true"
 			android:minHeight="@dimen/bottom_sheet_selected_item_title_height"
+			android:orientation="vertical"
+			android:paddingStart="@dimen/content_padding"
 			android:paddingLeft="@dimen/content_padding"
-			android:paddingRight="@dimen/content_padding"
 			android:paddingTop="@dimen/measurement_tool_menu_title_padding_top"
-			android:orientation="vertical"
 			android:paddingEnd="@dimen/content_padding"
-			android:paddingStart="@dimen/content_padding"
-			android:paddingBottom="@dimen/dialog_button_ex_height"
-			android:clickable="true"
-			android:focusable="true">
+			android:paddingRight="@dimen/content_padding">
 
 			<net.osmand.plus.widgets.TextViewEx
 				android:id="@+id/title"
@@ -75,26 +74,33 @@
 				android:gravity="center_vertical"
 				android:maxLines="1"
 				android:paddingBottom="@dimen/measurement_tool_menu_title_padding_bottom"
+				android:text="@string/route_between_points"
 				android:textColor="?android:textColorPrimary"
 				android:textSize="@dimen/default_list_text_size"
 				osmand:typeface="@string/font_roboto_medium"
-				android:text="@string/route_between_points"
 				tools:text="@string/route_between_points" />
 
 			<net.osmand.plus.widgets.TextViewEx
 				android:id="@+id/description"
 				android:layout_width="match_parent"
 				android:layout_height="wrap_content"
-				android:paddingBottom="@dimen/content_padding_half"
 				android:lineSpacingMultiplier="@dimen/bottom_sheet_text_spacing_multiplier"
+				android:paddingBottom="@dimen/content_padding_half"
+				android:text="@string/route_between_points_warning_desc"
 				android:textColor="?android:textColorPrimary"
 				android:textSize="@dimen/default_desc_text_size"
 				osmand:typeface="@string/font_roboto_regular"
-				android:text="@string/route_between_points_warning_desc"
 				tools:text="@string/route_between_points_warning_desc" />
 
 		</LinearLayout>
 
+		<LinearLayout
+			android:id="@+id/buttons_container"
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:background="?attr/list_background_color"
+			android:orientation="vertical"
+			android:paddingBottom="@dimen/dialog_button_ex_height" />
 
 	</LinearLayout>
 
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index d5d0116f1b5..1670970c0b9 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -11,6 +11,9 @@
 	Thx - Hardy
 -->
 
+    <string name="connect_with_straight_line">Connect with straight line</string>
+    <string name="attach_roads_descr">Do you want to approximate your track with a valid route attached to offline maps. In that case you will have corrected road altitude, road information and turns that could be used later in navigation.</string>
+    <string name="attach_roads_warning">You can attach to the roads only a recorded track</string>
     <string name="without_profiles_changing">Without profiles changing</string>
     <string name="shared_string_only_missing">Only missing</string>
     <string name="download_tiles">Download tiles</string>
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
index 36f696d3f33..fa193f7fff9 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
@@ -4,6 +4,8 @@
 import static net.osmand.IndexConstants.GPX_FILE_EXT;
 import static net.osmand.IndexConstants.GPX_INDEX_DIR;
 import static net.osmand.plus.backup.BackupHelper.SERVER_URL;
+import static net.osmand.plus.measurementtool.MeasurementEditingContext.DEFAULT_APP_MODE;
+import static net.osmand.plus.measurementtool.RouteBetweenPointsBottomSheetDialogFragment.RouteBetweenPointsDialogType.WHOLE_ROUTE_CALCULATION;
 import static net.osmand.plus.measurementtool.SaveAsNewTrackBottomSheetDialogFragment.SaveAsNewTrackFragmentListener;
 import static net.osmand.plus.measurementtool.SelectFileBottomSheet.Mode.ADD_TO_TRACK;
 import static net.osmand.plus.measurementtool.SelectFileBottomSheet.SelectFileListener;
@@ -901,7 +903,7 @@ public void startSnapToRoad(boolean rememberPreviousTitle) {
 				enterApproximationMode(mapActivity);
 			} else {
 				RouteBetweenPointsBottomSheetDialogFragment.showInstance(mapActivity.getSupportFragmentManager(),
-						this, RouteBetweenPointsDialogType.WHOLE_ROUTE_CALCULATION,
+						this, WHOLE_ROUTE_CALCULATION,
 						editingCtx.getLastCalculationMode() == CalculationMode.NEXT_SEGMENT
 								? RouteBetweenPointsDialogMode.SINGLE
 								: RouteBetweenPointsDialogMode.ALL,
@@ -981,6 +983,8 @@ private void onSnapTrackWarningResult(int resultCode) {
 				FragmentManager fragmentManager = mapActivity.getSupportFragmentManager();
 				GpxApproximationFragment.showInstance(fragmentManager, this, pointsSegments, mode);
 			}
+		} else if (resultCode == SnapTrackWarningFragment.CONNECT_STRAIT_LINE_RESULT_CODE) {
+			onChangeApplicationMode(DEFAULT_APP_MODE, WHOLE_ROUTE_CALCULATION, RouteBetweenPointsDialogMode.ALL);
 		}
 	}
 
@@ -1143,11 +1147,10 @@ public void reverseRouteOnClick() {
 	public void attachToRoadsClick() {
 		MapActivity mapActivity = getMapActivity();
 		if (mapActivity != null) {
-			boolean plainTrack = editingCtx.getPointsCount() > 0 && !editingCtx.hasRoutePoints() && !editingCtx.hasRoute();
-			if (plainTrack) {
+			if (editingCtx.isApproximationNeeded()) {
 				enterApproximationMode(mapActivity);
 			} else {
-				editingCtx.recalculateRouteSegments(null);
+				app.showToastMessage(R.string.attach_roads_warning);
 			}
 		}
 	}
@@ -1540,7 +1543,7 @@ private void updateSnapToRoadControls() {
 			LinearLayout profileWithConfig = mapActivity.findViewById(R.id.profile_with_config_btn);
 			ImageButton configBtn = profileWithConfig.findViewById(R.id.profile);
 			if (isTrackReadyToCalculate()) {
-				if (appMode == MeasurementEditingContext.DEFAULT_APP_MODE) {
+				if (appMode == DEFAULT_APP_MODE) {
 					icon = getActiveIcon(R.drawable.ic_action_split_interval);
 					snapToRoadBtn.setVisibility(View.VISIBLE);
 					profileWithConfig.setVisibility(View.GONE);
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/SnapTrackWarningFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/SnapTrackWarningFragment.java
index 575db713cb6..ab0dba99216 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/SnapTrackWarningFragment.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/SnapTrackWarningFragment.java
@@ -1,5 +1,13 @@
 package net.osmand.plus.measurementtool;
 
+import static android.view.Gravity.TOP;
+import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.BACK_TO_LOC_HUD_ID;
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.ZOOM_IN_HUD_ID;
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.ZOOM_OUT_HUD_ID;
+import static net.osmand.plus.utils.UiUtilities.DialogButtonType.PRIMARY;
+import static net.osmand.plus.utils.UiUtilities.DialogButtonType.SECONDARY;
+
 import android.app.Activity;
 import android.os.Bundle;
 import android.util.TypedValue;
@@ -9,6 +17,14 @@
 import android.widget.FrameLayout;
 import android.widget.ImageView;
 import android.widget.LinearLayout;
+import android.widget.TextView;
+
+import androidx.activity.OnBackPressedCallback;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentActivity;
+import androidx.fragment.app.FragmentManager;
 
 import net.osmand.PlatformUtil;
 import net.osmand.plus.OsmandApplication;
@@ -27,26 +43,12 @@
 
 import org.apache.commons.logging.Log;
 
-import androidx.activity.OnBackPressedCallback;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.fragment.app.Fragment;
-import androidx.fragment.app.FragmentActivity;
-import androidx.fragment.app.FragmentManager;
-
-import static android.view.Gravity.TOP;
-import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.BACK_TO_LOC_HUD_ID;
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.ZOOM_IN_HUD_ID;
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.ZOOM_OUT_HUD_ID;
-import static net.osmand.plus.utils.UiUtilities.DialogButtonType.PRIMARY;
-import static net.osmand.plus.utils.UiUtilities.DialogButtonType.SECONDARY;
-
 public class SnapTrackWarningFragment extends BaseOsmAndFragment {
 
 	public static final int REQUEST_CODE = 1000;
 	public static final int CANCEL_RESULT_CODE = 2;
 	public static final int CONTINUE_RESULT_CODE = 3;
+	public static final int CONNECT_STRAIT_LINE_RESULT_CODE = 4;
 
 	public static final String TAG = SnapTrackWarningFragment.class.getSimpleName();
 	private static final Log LOG = PlatformUtil.getLog(SnapTrackWarningFragment.class);
@@ -55,15 +57,29 @@ public class SnapTrackWarningFragment extends BaseOsmAndFragment {
 	private static final String ZOOM_OUT_BUTTON_ID = ZOOM_OUT_HUD_ID + TAG;
 	private static final String BACK_TO_LOC_BUTTON_ID = BACK_TO_LOC_HUD_ID + TAG;
 
-	private boolean continued = false;
+	private OsmandApplication app;
+
 	private View cancelButton;
 	private View applyButton;
+
+	private boolean editMode;
+	private boolean continued;
+
 	private boolean nightMode;
 	private boolean portrait;
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
+		app = requireMyApplication();
+		nightMode = app.getDaynightHelper().isNightModeForMapControls();
+		portrait = AndroidUiHelper.isOrientationPortrait(getMapActivity());
+
+		Fragment targetFragment = getTargetFragment();
+		if (targetFragment instanceof MeasurementToolFragment) {
+			MeasurementToolFragment fragment = (MeasurementToolFragment) targetFragment;
+			editMode = fragment.isPlanRouteMode() && !fragment.getEditingCtx().isNewData();
+		}
 		requireMyActivity().getOnBackPressedDispatcher().addCallback(this, new OnBackPressedCallback(true) {
 			public void handleOnBackPressed() {
 				dismissImmediate();
@@ -72,20 +88,19 @@ public void handleOnBackPressed() {
 	}
 
 	public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
-		OsmandApplication app = getMyApplication();
-		if (app != null) {
-			nightMode = app.getDaynightHelper().isNightModeForMapControls();
-			portrait = AndroidUiHelper.isOrientationPortrait(getMapActivity());
-		}
-		View rootView = UiUtilities.getInflater(getContext(), nightMode)
-				.inflate(R.layout.fragment_plan_route_warning, container, false);
-		if (rootView == null) {
-			return null;
-		}
+		LayoutInflater themeInflater = UiUtilities.getInflater(requireContext(), nightMode);
+		View rootView = themeInflater.inflate(R.layout.fragment_plan_route_warning, container, false);
+
 		applyButton = rootView.findViewById(R.id.right_bottom_button);
 		cancelButton = rootView.findViewById(R.id.dismiss_button);
 		View mapControlsContainer = rootView.findViewById(R.id.map_controls_container);
 		updateButtons(rootView);
+
+		if (editMode) {
+			TextView textView = rootView.findViewById(R.id.description);
+			textView.setText(R.string.attach_roads_descr);
+			setupActionButtons(rootView);
+		}
 		if (portrait) {
 			setupControlButtons(rootView);
 			mapControlsContainer.setVisibility(View.VISIBLE);
@@ -123,33 +138,67 @@ private void setupControlButtons(@NonNull View view) {
 		mapInfoLayer.setupRulerWidget(mapRulerView);
 	}
 
+	private void setupActionButtons(@NonNull View view) {
+		ViewGroup container = view.findViewById(R.id.buttons_container);
+		LayoutInflater inflater = UiUtilities.getInflater(view.getContext(), nightMode);
+		setupAttachRoadsButton(container, inflater);
+		container.addView(inflater.inflate(R.layout.divider_half_item_with_background, container, false));
+		setupStraitLineButton(container, inflater);
+	}
+
+	private void setupAttachRoadsButton(@NonNull ViewGroup container, @NonNull LayoutInflater inflater) {
+		View view = inflater.inflate(R.layout.bottom_sheet_item_with_descr_pad_32dp, container, false);
+		TextView textView = view.findViewById(R.id.title);
+		ImageView imageView = view.findViewById(R.id.icon);
+		textView.setText(R.string.attach_to_the_roads);
+		imageView.setImageDrawable(app.getUIUtilities().getThemedIcon(R.drawable.ic_action_attach_track));
+		view.setOnClickListener(v -> openApproximation());
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.description), false);
+		container.addView(view);
+	}
+
+	private void setupStraitLineButton(@NonNull ViewGroup container, @NonNull LayoutInflater inflater) {
+		View view = inflater.inflate(R.layout.bottom_sheet_item_with_descr_pad_32dp, container, false);
+		TextView textView = view.findViewById(R.id.title);
+		ImageView imageView = view.findViewById(R.id.icon);
+		textView.setText(R.string.connect_with_straight_line);
+		imageView.setImageDrawable(app.getUIUtilities().getThemedIcon(R.drawable.ic_action_split_interval));
+		view.setOnClickListener(v -> connectStraitLine());
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.description), false);
+		container.addView(view);
+	}
+
 	private void updateButtons(View view) {
 		View buttonsContainer = view.findViewById(R.id.buttons_container);
 		buttonsContainer.setBackgroundColor(AndroidUtils.getColorFromAttr(view.getContext(), R.attr.list_background_color));
-		applyButton.setOnClickListener(new View.OnClickListener() {
-			@Override
-			public void onClick(View v) {
-				Fragment fragment = getTargetFragment();
-				if (fragment != null) {
-					continued = true;
-					dismissImmediate();
-					fragment.onActivityResult(REQUEST_CODE, CONTINUE_RESULT_CODE, null);
-				}
-			}
-		});
-		cancelButton.setOnClickListener(new View.OnClickListener() {
-			@Override
-			public void onClick(View v) {
-				FragmentActivity activity = getActivity();
-				if (activity != null) {
-					activity.onBackPressed();
-				}
+		applyButton.setOnClickListener(v -> openApproximation());
+		cancelButton.setOnClickListener(v -> {
+			FragmentActivity activity = getActivity();
+			if (activity != null) {
+				activity.onBackPressed();
 			}
 		});
 		UiUtilities.setupDialogButton(nightMode, cancelButton, SECONDARY, R.string.shared_string_cancel);
 		UiUtilities.setupDialogButton(nightMode, applyButton, PRIMARY, R.string.shared_string_continue);
-		AndroidUiHelper.updateVisibility(applyButton, true);
-		AndroidUiHelper.updateVisibility(view.findViewById(R.id.buttons_divider), true);
+		AndroidUiHelper.updateVisibility(applyButton, !editMode);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.buttons_divider), !editMode);
+	}
+
+	private void connectStraitLine() {
+		Fragment fragment = getTargetFragment();
+		if (fragment != null) {
+			dismissImmediate();
+			fragment.onActivityResult(REQUEST_CODE, CONNECT_STRAIT_LINE_RESULT_CODE, null);
+		}
+	}
+
+	private void openApproximation() {
+		Fragment fragment = getTargetFragment();
+		if (fragment != null) {
+			continued = true;
+			dismissImmediate();
+			fragment.onActivityResult(REQUEST_CODE, CONTINUE_RESULT_CODE, null);
+		}
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/routepreparationmenu/FollowTrackFragment.java b/OsmAnd/src/net/osmand/plus/routepreparationmenu/FollowTrackFragment.java
index e3711b4da90..dde4845d226 100644
--- a/OsmAnd/src/net/osmand/plus/routepreparationmenu/FollowTrackFragment.java
+++ b/OsmAnd/src/net/osmand/plus/routepreparationmenu/FollowTrackFragment.java
@@ -374,10 +374,8 @@ public void onCardPressed(@NonNull BaseCard card) {
 				importTrack();
 			} else if (card instanceof AttachTrackToRoadsCard) {
 				openPlanRoute(true);
-				close();
 			} else if (card instanceof TrackEditCard) {
 				openPlanRoute(false);
-				close();
 			} else if (card instanceof SelectTrackCard) {
 				updateSelectionMode(true);
 			} else if (card instanceof ReverseTrackCard
@@ -489,6 +487,7 @@ public void openPlanRoute(boolean showSnapWarning) {
 			editingContext.setAppMode(app.getRoutingHelper().getAppMode());
 			editingContext.setSelectedSegment(app.getSettings().GPX_SEGMENT_INDEX.get());
 			MeasurementToolFragment.showInstance(mapActivity.getSupportFragmentManager(), editingContext, FOLLOW_TRACK_MODE, showSnapWarning);
+			close();
 		}
 	}
 
