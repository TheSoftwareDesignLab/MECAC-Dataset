diff --git a/OsmAnd/res/layout/map_marker_side_widget_settings_fragment.xml b/OsmAnd/res/layout/map_marker_side_widget_settings_fragment.xml
new file mode 100644
index 00000000000..fd3ef3ade84
--- /dev/null
+++ b/OsmAnd/res/layout/map_marker_side_widget_settings_fragment.xml
@@ -0,0 +1,125 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:layout_width="match_parent"
+	android:layout_height="match_parent"
+	android:orientation="vertical">
+
+	<net.osmand.plus.widgets.TextViewEx
+		style="@style/DescStyle"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:layout_marginHorizontal="@dimen/content_padding"
+		android:layout_marginVertical="@dimen/content_padding_small"
+		android:text="@string/switch_widget_mode_desc"
+		android:textColor="?android:textColorSecondary" />
+
+	<View
+		android:layout_width="match_parent"
+		android:layout_height="1dp"
+		android:background="?divider_color_basic" />
+
+	<net.osmand.plus.widgets.TextViewEx
+		style="@style/TitleStyle.Medium"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:layout_marginHorizontal="@dimen/content_padding"
+		android:layout_marginVertical="@dimen/content_padding_small"
+		android:text="@string/shared_string_mode"
+		android:textColor="?android:textColorPrimary" />
+
+	<include
+		android:id="@+id/distance_mode_container"
+		layout="@layout/widget_settings_radio_item" />
+
+	<include
+		android:id="@+id/eta_mode"
+		layout="@layout/widget_settings_radio_item" />
+
+	<LinearLayout
+		android:id="@+id/average_speed_container"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:orientation="vertical">
+
+		<View
+			android:layout_width="match_parent"
+			android:layout_height="1dp"
+			android:layout_marginStart="@dimen/content_padding"
+			android:background="?divider_color_basic" />
+
+		<net.osmand.plus.widgets.TextViewEx
+			style="@style/DescStyle"
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:layout_marginHorizontal="@dimen/content_padding"
+			android:layout_marginVertical="@dimen/content_padding_small"
+			android:text="@string/map_marker_average_speed_desc"
+			android:textColor="?android:textColorSecondary" />
+
+		<LinearLayout
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:layout_marginStart="@dimen/content_padding"
+			android:layout_marginTop="@dimen/content_padding_small"
+			android:layout_marginEnd="@dimen/content_padding"
+			android:orientation="horizontal"
+			android:gravity="center_vertical">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/interval"
+				style="@style/TitleStyle.Medium"
+				android:layout_width="0dp"
+				android:layout_height="wrap_content"
+				android:layout_weight="1"
+				android:textColor="?android:textColorPrimary"
+				tools:text="Interval: " />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/selected_interval"
+				style="@style/TitleStyle.Medium"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:textColor="?android:textColorPrimary"
+				tools:text="30 m" />
+
+		</LinearLayout>
+
+		<com.google.android.material.slider.Slider
+			android:id="@+id/interval_slider"
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:layout_marginHorizontal="@dimen/content_padding"
+			android:stepSize="1"
+			android:saveEnabled="false" />
+
+		<LinearLayout
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:layout_marginStart="@dimen/content_padding"
+			android:layout_marginEnd="@dimen/content_padding"
+			android:layout_marginBottom="@dimen/content_padding"
+			android:orientation="horizontal">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/min_interval"
+				style="@style/DescStyle"
+				android:layout_width="0dp"
+				android:layout_height="wrap_content"
+				android:layout_weight="1"
+				android:textColor="?android:textColorSecondary"
+				tools:text="15 sec" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/max_interval"
+				style="@style/DescStyle"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:textColor="?android:textColorSecondary"
+				tools:text="60 min" />
+
+		</LinearLayout>
+
+	</LinearLayout>
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/widget_settings_radio_item.xml b/OsmAnd/res/layout/widget_settings_radio_item.xml
index 296ac75b992..a449659d3e1 100644
--- a/OsmAnd/res/layout/widget_settings_radio_item.xml
+++ b/OsmAnd/res/layout/widget_settings_radio_item.xml
@@ -3,38 +3,53 @@
 	xmlns:tools="http://schemas.android.com/tools"
 	android:layout_width="match_parent"
 	android:layout_height="wrap_content"
-	android:orientation="horizontal"
-	android:gravity="center_vertical"
-	android:paddingHorizontal="@dimen/content_padding"
-	android:paddingVertical="@dimen/content_padding_small">
+	android:orientation="vertical">
 
-	<androidx.appcompat.widget.AppCompatImageView
-		android:id="@+id/icon"
-		android:layout_width="@dimen/dialog_content_margin"
-		android:layout_height="@dimen/dialog_content_margin"
-		tools:src="@drawable/ic_action_hide" />
-
-	<net.osmand.plus.widgets.TextViewEx
-		android:id="@+id/title"
-		style="@style/TitleStyle"
-		android:layout_width="0dp"
+	<LinearLayout
+		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
-		android:layout_weight="1"
-		android:layout_marginStart="@dimen/list_content_padding_large"
-		android:maxLines="1"
-		android:ellipsize="end"
-		android:textColor="?android:textColorPrimary"
-		tools:text="@string/shared_string_hide" />
+		android:layout_marginHorizontal="@dimen/content_padding"
+		android:layout_marginVertical="@dimen/content_padding_small"
+		android:orientation="horizontal"
+		android:gravity="center_vertical">
 
-	<androidx.appcompat.widget.AppCompatRadioButton
-		android:id="@+id/compound_button"
-		android:layout_width="wrap_content"
-		android:layout_height="wrap_content"
-		android:layout_marginStart="@dimen/list_content_padding_large"
-		android:background="@null"
-		android:clickable="false"
-		android:focusable="false"
-		android:focusableInTouchMode="false"
-		android:saveEnabled="false" />
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/icon"
+			android:layout_width="@dimen/dialog_content_margin"
+			android:layout_height="@dimen/dialog_content_margin"
+			tools:src="@drawable/ic_action_hide" />
+
+		<net.osmand.plus.widgets.TextViewEx
+			android:id="@+id/title"
+			style="@style/TitleStyle"
+			android:layout_width="0dp"
+			android:layout_height="wrap_content"
+			android:layout_weight="1"
+			android:layout_marginStart="@dimen/list_content_padding_large"
+			android:maxLines="1"
+			android:ellipsize="end"
+			android:textColor="?android:textColorPrimary"
+			tools:text="@string/shared_string_hide" />
+
+		<androidx.appcompat.widget.AppCompatRadioButton
+			android:id="@+id/compound_button"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_marginStart="@dimen/list_content_padding_large"
+			android:background="@null"
+			android:clickable="false"
+			android:focusable="false"
+			android:focusableInTouchMode="false"
+			android:saveEnabled="false" />
+
+	</LinearLayout>
+
+	<View
+		android:id="@+id/bottom_divider"
+		android:layout_width="match_parent"
+		android:layout_height="1dp"
+		android:background="?divider_color_basic"
+		android:visibility="gone"
+		tools:visibility="visible" />
 
 </LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index c323fce423f..4f32841dd2a 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -11,6 +11,9 @@
 	Thx - Hardy
 -->
 
+    <string name="map_marker_average_speed_desc">Specify the time interval for which the average speed will be measured to calculate estimated time of arrival.</string>
+    <string name="switch_widget_mode_desc">You can switch mode by taping on widget.</string>
+    <string name="side_marker_eta">Estimated time of arrival</string>
     <string name="goods_delivery_desc_4">If your vehicle weight is more than 3.5 tonnes you need to use Truck profile.</string>
     <string name="goods_delivery_desc_3">Applies only for vehicles carrying goods that have at least four wheels and weigh no more than 3.5 tonnes.</string>
     <string name="goods_delivery_desc_2">Roads that closed for goods delivery will be avoided. </string>
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/AverageSpeedComputer.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/AverageSpeedComputer.java
index f08c6390a96..1e93d09419b 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/AverageSpeedComputer.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/AverageSpeedComputer.java
@@ -128,12 +128,10 @@ private float getSpeedToSkipInMetersPerSecond() {
 	/**
 	 * @return average speed in meters/second or {@link Float#NaN} if average speed cannot be calculated
 	 */
-	public float getAverageSpeed() {
-		long measuredInterval = settings.AVERAGE_SPEED_MEASURED_INTERVAL_MILLIS.get();
+	public float getAverageSpeed(long measuredInterval, boolean skipLowSpeed) {
 		long intervalStart = System.currentTimeMillis() - measuredInterval;
 		List<Segment> segments = segmentsList.getSegments(intervalStart, MISSING_POINT_TIME_THRESHOLD);
 
-		boolean skipLowSpeed = settings.AVERAGE_SPEED_SKIP_STOPS.get();
 		double totalDistance = 0;
 		double totalTimeMillis = 0;
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java
index 2c733e62e06..0d6a34bed7c 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java
@@ -28,6 +28,7 @@
 import net.osmand.plus.views.mapwidgets.widgets.SecondNextTurnWidget;
 import net.osmand.plus.views.mapwidgets.widgets.StreetNameWidget;
 import net.osmand.plus.views.mapwidgets.widgets.TimeToNavigationPointWidget;
+import net.osmand.plus.views.mapwidgets.widgetstates.MapMarkerSideWidgetState;
 import net.osmand.plus.views.mapwidgets.widgetstates.TimeToNavigationPointWidgetState;
 
 public class MapWidgetsFactory {
@@ -72,9 +73,11 @@ public MapWidget createMapWidget(@Nullable String customId, @NonNull WidgetType
 				TimeToNavigationPointWidgetState widgetState = new TimeToNavigationPointWidgetState(app, customId, false);
 				return new TimeToNavigationPointWidget(mapActivity, widgetState);
 			case SIDE_MARKER_1:
-				return new MapMarkerSideWidget(mapActivity, true);
+				MapMarkerSideWidgetState firstMarkerState = new MapMarkerSideWidgetState(app, customId, true);
+				return new MapMarkerSideWidget(mapActivity, firstMarkerState);
 			case SIDE_MARKER_2:
-				return new MapMarkerSideWidget(mapActivity, false);
+				MapMarkerSideWidgetState secondMarkerState = new MapMarkerSideWidgetState(app, customId, false);
+				return new MapMarkerSideWidget(mapActivity, secondMarkerState);
 			case RELATIVE_BEARING:
 				return new BearingWidget(mapActivity, BearingType.RELATIVE_BEARING);
 			case MAGNETIC_BEARING:
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
index 45f38d5f450..a4c69b3dccb 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
@@ -12,6 +12,7 @@
 import net.osmand.plus.views.mapwidgets.configure.settings.ElevationProfileWidgetSettingsFragment;
 import net.osmand.plus.views.mapwidgets.configure.settings.MapMarkersBarWidgetSettingFragment;
 import net.osmand.plus.views.mapwidgets.configure.settings.RadiusRulerWidgetSettingsFragment;
+import net.osmand.plus.views.mapwidgets.configure.settings.MapMarkerSideWidgetSettingsFragment;
 import net.osmand.plus.views.mapwidgets.configure.settings.TimeToNavigationPointSettingsFragment;
 import net.osmand.plus.views.mapwidgets.configure.settings.WidgetSettingsBaseFragment;
 
@@ -184,6 +185,8 @@ public WidgetSettingsBaseFragment getSettingsFragment() {
 			return new RadiusRulerWidgetSettingsFragment();
 		} else if (this == TIME_TO_INTERMEDIATE || this == TIME_TO_DESTINATION) {
 			return new TimeToNavigationPointSettingsFragment();
+		} else if (this == SIDE_MARKER_1 || this == SIDE_MARKER_2) {
+			return new MapMarkerSideWidgetSettingsFragment();
 		} else if (this == AVERAGE_SPEED) {
 			return new AverageSpeedWidgetSettingFragment();
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/AverageSpeedWidgetSettingFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/AverageSpeedWidgetSettingFragment.java
index 66200e577ca..bcee3d56918 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/AverageSpeedWidgetSettingFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/AverageSpeedWidgetSettingFragment.java
@@ -7,29 +7,18 @@
 import android.widget.CompoundButton;
 import android.widget.TextView;
 
-import com.google.android.material.slider.Slider;
-
 import net.osmand.plus.R;
 import net.osmand.plus.settings.enums.SpeedConstants;
-import net.osmand.plus.utils.ColorUtilities;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.mapwidgets.AverageSpeedComputer;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 
-import java.util.ArrayList;
-import java.util.LinkedHashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.Map.Entry;
-
 import androidx.annotation.NonNull;
 
-public class AverageSpeedWidgetSettingFragment extends WidgetSettingsBaseFragment {
+public class AverageSpeedWidgetSettingFragment extends BaseAverageSpeedSettingFragment {
 
 	private static final String KEY_TIME_INTERVAL = "time_interval";
 	private static final String KEY_SKIP_STOPS = "skip_stops";
 
-	private long selectedIntervalMillis;
 	private boolean skipStops;
 
 	@NonNull
@@ -53,75 +42,11 @@ protected void initParams(@NonNull Bundle bundle) {
 	protected void setupContent(@NonNull LayoutInflater themedInflater, @NonNull ViewGroup container) {
 		themedInflater.inflate(R.layout.average_speed_widget_settings_fragment, container);
 
-		setupIntervalsSlider();
+		setupIntervalSlider();
 		setupMinMaxIntervals();
 		setupSkipStopsSetting();
 	}
 
-	private void setupIntervalsSlider() {
-		TextView interval = view.findViewById(R.id.interval);
-		TextView selectedIntervalText = view.findViewById(R.id.selected_interval);
-		Slider slider = view.findViewById(R.id.interval_slider);
-
-		Map<Long, String> intervals = getAvailableIntervals();
-		List<Entry<Long, String>> intervalsList = new ArrayList<>(intervals.entrySet());
-		int initialIntervalIndex = getInitialIntervalIndex();
-
-		slider.setValueFrom(0);
-		slider.setValueTo(intervals.size() - 1);
-		slider.setValue(initialIntervalIndex);
-		slider.clearOnChangeListeners();
-		slider.addOnChangeListener((slider1, intervalIndex, fromUser) -> {
-			Entry<Long, String> newInterval = intervalsList.get((int) intervalIndex);
-			selectedIntervalMillis = newInterval.getKey();
-			selectedIntervalText.setText(newInterval.getValue());
-		});
-		UiUtilities.setupSlider(slider, nightMode, ColorUtilities.getActiveColor(app, nightMode), true);
-
-		interval.setText(getString(R.string.ltr_or_rtl_combine_via_colon, getString(R.string.shared_string_interval), ""));
-		selectedIntervalText.setText(intervalsList.get(initialIntervalIndex).getValue());
-	}
-
-	private int getInitialIntervalIndex() {
-		List<Long> intervals = new ArrayList<>(getAvailableIntervals().keySet());
-		for (int i = 0; i < intervals.size(); i++) {
-			long interval = intervals.get(i);
-			if (selectedIntervalMillis == interval) {
-				return i;
-			}
-		}
-
-		return 0;
-	}
-
-	private void setupMinMaxIntervals() {
-		List<String> intervals = new ArrayList<>(getAvailableIntervals().values());
-		String minIntervalValue = intervals.get(0);
-		String maxIntervalValue = intervals.get(intervals.size() - 1);
-
-		TextView minInterval = view.findViewById(R.id.min_interval);
-		TextView maxInterval = view.findViewById(R.id.max_interval);
-
-		minInterval.setText(minIntervalValue);
-		maxInterval.setText(maxIntervalValue);
-	}
-
-	@NonNull
-	private Map<Long, String> getAvailableIntervals() {
-		Map<Long, String> intervals = new LinkedHashMap<>();
-		for (long interval : AverageSpeedComputer.MEASURED_INTERVALS) {
-			boolean seconds = interval < 60 * 1000;
-			String timeInterval = seconds
-					? String.valueOf(interval / 1000)
-					: String.valueOf(interval / 1000 / 60);
-			String timeUnit = interval < 60 * 1000
-					? getString(R.string.shared_string_sec)
-					: getString(R.string.shared_string_minute_lowercase);
-			intervals.put(interval, getString(R.string.ltr_or_rtl_combine_via_space, timeInterval, timeUnit));
-		}
-		return intervals;
-	}
-
 	private void setupSkipStopsSetting() {
 		View skipStopsContainer = view.findViewById(R.id.skip_stops_container);
 		TextView skipStopsDesc = view.findViewById(R.id.skip_stops_desc);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/BaseAverageSpeedSettingFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/BaseAverageSpeedSettingFragment.java
new file mode 100644
index 00000000000..dc38998df1d
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/BaseAverageSpeedSettingFragment.java
@@ -0,0 +1,88 @@
+package net.osmand.plus.views.mapwidgets.configure.settings;
+
+import android.widget.TextView;
+
+import com.google.android.material.slider.Slider;
+
+import net.osmand.plus.R;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.views.mapwidgets.AverageSpeedComputer;
+
+import java.util.ArrayList;
+import java.util.LinkedHashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.Map.Entry;
+
+import androidx.annotation.NonNull;
+
+public abstract class BaseAverageSpeedSettingFragment extends WidgetSettingsBaseFragment {
+
+	protected long selectedIntervalMillis;
+
+	protected void setupIntervalSlider() {
+		TextView interval = view.findViewById(R.id.interval);
+		TextView selectedIntervalText = view.findViewById(R.id.selected_interval);
+		Slider slider = view.findViewById(R.id.interval_slider);
+
+		Map<Long, String> intervals = getAvailableIntervals();
+		List<Entry<Long, String>> intervalsList = new ArrayList<>(intervals.entrySet());
+		int initialIntervalIndex = getInitialIntervalIndex();
+
+		slider.setValueFrom(0);
+		slider.setValueTo(intervals.size() - 1);
+		slider.setValue(initialIntervalIndex);
+		slider.clearOnChangeListeners();
+		slider.addOnChangeListener((slider1, intervalIndex, fromUser) -> {
+			Entry<Long, String> newInterval = intervalsList.get((int) intervalIndex);
+			selectedIntervalMillis = newInterval.getKey();
+			selectedIntervalText.setText(newInterval.getValue());
+		});
+		UiUtilities.setupSlider(slider, nightMode, ColorUtilities.getActiveColor(app, nightMode), true);
+
+		interval.setText(getString(R.string.ltr_or_rtl_combine_via_colon, getString(R.string.shared_string_interval), ""));
+		selectedIntervalText.setText(intervalsList.get(initialIntervalIndex).getValue());
+
+	}
+
+	private int getInitialIntervalIndex() {
+		List<Long> intervals = new ArrayList<>(getAvailableIntervals().keySet());
+		for (int i = 0; i < intervals.size(); i++) {
+			long interval = intervals.get(i);
+			if (selectedIntervalMillis == interval) {
+				return i;
+			}
+		}
+
+		return 0;
+	}
+
+	@NonNull
+	private Map<Long, String> getAvailableIntervals() {
+		Map<Long, String> intervals = new LinkedHashMap<>();
+		for (long interval : AverageSpeedComputer.MEASURED_INTERVALS) {
+			boolean seconds = interval < 60 * 1000;
+			String timeInterval = seconds
+					? String.valueOf(interval / 1000)
+					: String.valueOf(interval / 1000 / 60);
+			String timeUnit = interval < 60 * 1000
+					? getString(R.string.shared_string_sec)
+					: getString(R.string.shared_string_minute_lowercase);
+			intervals.put(interval, getString(R.string.ltr_or_rtl_combine_via_space, timeInterval, timeUnit));
+		}
+		return intervals;
+	}
+
+	protected void setupMinMaxIntervals() {
+		List<String> intervals = new ArrayList<>(getAvailableIntervals().values());
+		String minIntervalValue = intervals.get(0);
+		String maxIntervalValue = intervals.get(intervals.size() - 1);
+
+		TextView minInterval = view.findViewById(R.id.min_interval);
+		TextView maxInterval = view.findViewById(R.id.max_interval);
+
+		minInterval.setText(minIntervalValue);
+		maxInterval.setText(maxIntervalValue);
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/MapMarkerSideWidgetSettingsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/MapMarkerSideWidgetSettingsFragment.java
new file mode 100644
index 00000000000..f51cbfd38cd
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/MapMarkerSideWidgetSettingsFragment.java
@@ -0,0 +1,158 @@
+package net.osmand.plus.views.mapwidgets.configure.settings;
+
+import android.os.Bundle;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.CompoundButton;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import net.osmand.plus.R;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.settings.backend.preferences.OsmandPreference;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.utils.UiUtilities.CompoundButtonType;
+import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
+import net.osmand.plus.views.mapwidgets.WidgetType;
+import net.osmand.plus.views.mapwidgets.widgets.MapMarkerSideWidget;
+import net.osmand.plus.views.mapwidgets.widgetstates.MapMarkerSideWidgetState;
+import net.osmand.plus.views.mapwidgets.widgetstates.MapMarkerSideWidgetState.SideMarkerMode;
+
+import androidx.annotation.NonNull;
+
+public class MapMarkerSideWidgetSettingsFragment extends BaseAverageSpeedSettingFragment {
+
+	private static final String MARKER_MODE_KEY = "marker_mode";
+	private static final String AVERAGE_SPEED_INTERVAL_KEY = "average_speed_interval";
+
+	private boolean firstMarker = true;
+	private OsmandPreference<SideMarkerMode> markerModePref;
+	private OsmandPreference<Long> averageSpeedIntervalPref;
+
+	private SideMarkerMode selectedMarkerMode;
+
+	@NonNull
+	@Override
+	public WidgetType getWidget() {
+		return firstMarker ? WidgetType.SIDE_MARKER_1 : WidgetType.SIDE_MARKER_2;
+	}
+
+	@Override
+	protected void initParams(@NonNull Bundle bundle) {
+		super.initParams(bundle);
+		MapWidgetInfo widgetInfo = widgetRegistry.getWidgetInfoById(widgetId);
+		if (widgetInfo != null) {
+			MapMarkerSideWidget widget = ((MapMarkerSideWidget) widgetInfo.widget);
+			MapMarkerSideWidgetState widgetState = widget.getWidgetState();
+
+			firstMarker = widgetState.isFirstMarker();
+			markerModePref = widgetState.getMapMarkerModePref();
+			averageSpeedIntervalPref = widgetState.getAverageSpeedIntervalPref();
+
+			SideMarkerMode defaultMode = markerModePref.getModeValue(appMode);
+			long defaultAverageSpeedInterval = averageSpeedIntervalPref.getModeValue(appMode);
+
+			selectedMarkerMode = SideMarkerMode.valueOf(bundle.getString(MARKER_MODE_KEY, defaultMode.name()));
+			selectedIntervalMillis = bundle.getLong(AVERAGE_SPEED_INTERVAL_KEY, defaultAverageSpeedInterval);
+		} else {
+			dismiss();
+		}
+	}
+
+	@Override
+	protected void setupContent(@NonNull LayoutInflater themedInflater, @NonNull ViewGroup container) {
+		themedInflater.inflate(R.layout.map_marker_side_widget_settings_fragment, container);
+		updateToolbarIcon();
+		setupMapMarkerModeSetting();
+		setupAverageSpeedIntervalSetting();
+	}
+
+	private void setupMapMarkerModeSetting() {
+		View distanceModeContainer = view.findViewById(R.id.distance_mode_container);
+		View estimatedTimeOfArrivalModeContainer = view.findViewById(R.id.eta_mode);
+		CompoundButton distanceButton = distanceModeContainer.findViewById(R.id.compound_button);
+		CompoundButton estimatedTimeOfArrivalButton = estimatedTimeOfArrivalModeContainer.findViewById(R.id.compound_button);
+
+		MarkerModeSelectionCallback callback = mode -> {
+			selectedMarkerMode = mode;
+			if (selectedMarkerMode == SideMarkerMode.DISTANCE) {
+				estimatedTimeOfArrivalButton.setChecked(false);
+			} else if (selectedMarkerMode == SideMarkerMode.ESTIMATED_ARRIVAL_TIME) {
+				distanceButton.setChecked(false);
+			} else {
+				throw new IllegalStateException("Unsupported side map marker mode");
+			}
+
+			updateToolbarIcon();
+
+			View averageSpeedContainer = view.findViewById(R.id.average_speed_container);
+			boolean showAverageSpeedSetting = mode == SideMarkerMode.ESTIMATED_ARRIVAL_TIME;
+			AndroidUiHelper.updateVisibility(averageSpeedContainer, showAverageSpeedSetting);
+		};
+
+		setupMapMarkerModeItem(SideMarkerMode.DISTANCE, distanceModeContainer, callback);
+		setupMapMarkerModeItem(SideMarkerMode.ESTIMATED_ARRIVAL_TIME, estimatedTimeOfArrivalModeContainer, callback);
+	}
+
+	private void updateToolbarIcon() {
+		ImageView icon = view.findViewById(R.id.icon);
+		int iconId = selectedMarkerMode.getIconId(nightMode);
+		icon.setImageDrawable(getIcon(iconId));
+	}
+
+	private void setupMapMarkerModeItem(@NonNull SideMarkerMode mode,
+	                                    @NonNull View container,
+	                                    @NonNull MarkerModeSelectionCallback callback) {
+		ImageView icon = container.findViewById(R.id.icon);
+		TextView title = container.findViewById(R.id.title);
+		CompoundButton compoundButton = container.findViewById(R.id.compound_button);
+
+		icon.setImageDrawable(getIcon(mode.getIconId(nightMode)));
+		title.setText(mode.titleId);
+
+		UiUtilities.setupCompoundButton(compoundButton, nightMode, CompoundButtonType.GLOBAL);
+		compoundButton.setChecked(selectedMarkerMode == mode);
+		compoundButton.setOnCheckedChangeListener((buttonView, isChecked) -> {
+			if (isChecked) {
+				callback.onModeSelected(mode);
+			}
+		});
+
+		boolean lastMode = mode.ordinal() + 1 == SideMarkerMode.values().length;
+		if (!lastMode) {
+			View bottomDivider = view.findViewById(R.id.bottom_divider);
+			AndroidUiHelper.updateVisibility(bottomDivider, true);
+		}
+
+		container.setOnClickListener(v -> compoundButton.setChecked(true));
+		container.setBackground(getPressedStateDrawable());
+	}
+
+	private void setupAverageSpeedIntervalSetting() {
+		setupIntervalSlider();
+		setupMinMaxIntervals();
+		View container = view.findViewById(R.id.average_speed_container);
+		AndroidUiHelper.updateVisibility(container, selectedMarkerMode == SideMarkerMode.ESTIMATED_ARRIVAL_TIME);
+	}
+
+	@Override
+	public void onSaveInstanceState(@NonNull Bundle outState) {
+		super.onSaveInstanceState(outState);
+		outState.putString(MARKER_MODE_KEY, selectedMarkerMode.name());
+		outState.putLong(AVERAGE_SPEED_INTERVAL_KEY, selectedIntervalMillis);
+	}
+
+	@Override
+	protected void applySettings() {
+		markerModePref.setModeValue(appMode, selectedMarkerMode);
+		if (selectedMarkerMode == SideMarkerMode.ESTIMATED_ARRIVAL_TIME) {
+			averageSpeedIntervalPref.setModeValue(appMode, selectedIntervalMillis);
+		}
+	}
+
+	private interface MarkerModeSelectionCallback {
+
+		void onModeSelected(@NonNull SideMarkerMode mode);
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/TimeToNavigationPointSettingsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/TimeToNavigationPointSettingsFragment.java
index 86e0d754152..ba9c95e1e5a 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/TimeToNavigationPointSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/TimeToNavigationPointSettingsFragment.java
@@ -42,7 +42,6 @@ public WidgetType getWidget() {
 	@Override
 	protected void initParams(@NonNull Bundle bundle) {
 		super.initParams(bundle);
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
 		MapWidgetInfo widgetInfo = widgetRegistry.getWidgetInfoById(widgetId);
 		if (widgetInfo != null) {
 			TimeToNavigationPointWidget navigationPointWidget = (TimeToNavigationPointWidget) widgetInfo.widget;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/WidgetSettingsBaseFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/WidgetSettingsBaseFragment.java
index 3944a0c10a2..8863a3d6bb0 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/WidgetSettingsBaseFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/settings/WidgetSettingsBaseFragment.java
@@ -29,6 +29,7 @@
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.utils.UiUtilities.DialogButtonType;
 import net.osmand.plus.views.layers.MapInfoLayer;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.configure.panel.WidgetsConfigurationChangeListener;
 
@@ -39,6 +40,7 @@ public abstract class WidgetSettingsBaseFragment extends BaseOsmAndFragment {
 
 	protected OsmandApplication app;
 	protected OsmandSettings settings;
+	protected MapWidgetRegistry widgetRegistry;
 	protected ApplicationMode appMode;
 	protected String widgetId;
 	protected boolean nightMode;
@@ -53,14 +55,8 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = requireMyApplication();
 		settings = app.getSettings();
+		widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
 		nightMode = !settings.isLightContent();
-
-		Bundle args = getArguments();
-		if (savedInstanceState != null) {
-			initParams(savedInstanceState);
-		} else if (args != null) {
-			initParams(args);
-		}
 	}
 
 	protected void initParams(@NonNull Bundle bundle) {
@@ -71,6 +67,14 @@ protected void initParams(@NonNull Bundle bundle) {
 	@Nullable
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+		Bundle args = getArguments();
+		if (savedInstanceState != null) {
+			initParams(savedInstanceState);
+		} else if (args != null) {
+			initParams(args);
+		}
+
+
 		Context context = requireContext();
 		LayoutInflater themedInflater = UiUtilities.getInflater(context, nightMode);
 		view = themedInflater.inflate(R.layout.base_widget_fragment_layout, container, false);
@@ -134,7 +138,7 @@ private void setupApplyButton() {
 
 	protected abstract void applySettings();
 
-	private void dismiss() {
+	protected void dismiss() {
 		Activity activity = getActivity();
 		if (activity != null) {
 			activity.onBackPressed();
@@ -145,6 +149,7 @@ private void dismiss() {
 	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		outState.putString(KEY_APP_MODE, appMode.getStringKey());
+		outState.putString(KEY_WIDGET_ID, widgetId);
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/AverageSpeedWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/AverageSpeedWidget.java
index a275e3a9735..682e8e9bc73 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/AverageSpeedWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/AverageSpeedWidget.java
@@ -35,7 +35,9 @@ public void updateInfo(@Nullable DrawSettings drawSettings) {
 	}
 
 	private void updateAverageSpeed() {
-		float averageSpeed = averageSpeedComputer.getAverageSpeed();
+		long measuredInterval = settings.AVERAGE_SPEED_MEASURED_INTERVAL_MILLIS.get();
+		boolean skipLowSpeed = settings.AVERAGE_SPEED_SKIP_STOPS.get();
+		float averageSpeed = averageSpeedComputer.getAverageSpeed(measuredInterval, skipLowSpeed);
 		if (Float.isNaN(averageSpeed)) {
 			setText(DASH, null);
 		} else {
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CurrentTimeWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CurrentTimeWidget.java
index 339d6f1f95a..ba432957482 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CurrentTimeWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CurrentTimeWidget.java
@@ -27,12 +27,7 @@ public void updateInfo(@Nullable DrawSettings drawSettings) {
 		long time = System.currentTimeMillis();
 		if (isUpdateNeeded() || time - cachedTime > UPDATE_INTERVAL_MILLIS) {
 			cachedTime = time;
-			if (DateFormat.is24HourFormat(app)) {
-				setText(DateFormat.format("k:mm", time).toString(), null);
-			} else {
-				setText(DateFormat.format("h:mm", time).toString(),
-						DateFormat.format("aa", time).toString());
-			}
+			setTimeText(time);
 		}
 	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java
index fa65ca3ef2e..5ef5328cf8d 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java
@@ -1,51 +1,72 @@
 package net.osmand.plus.views.mapwidgets.widgets;
 
-import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_1;
-import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_2;
-
 import android.graphics.drawable.Drawable;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-
 import net.osmand.Location;
 import net.osmand.data.LatLon;
-import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.mapmarkers.MapMarker;
 import net.osmand.plus.mapmarkers.MapMarkersHelper;
 import net.osmand.plus.routing.RoutingHelper;
+import net.osmand.plus.settings.backend.preferences.OsmandPreference;
 import net.osmand.plus.settings.enums.MetricsConstants;
 import net.osmand.plus.utils.OsmAndFormatter;
 import net.osmand.plus.utils.OsmAndFormatter.FormattedValue;
 import net.osmand.plus.views.layers.base.OsmandMapLayer.DrawSettings;
+import net.osmand.plus.views.mapwidgets.AverageSpeedComputer;
 import net.osmand.plus.views.mapwidgets.MarkersWidgetsHelper;
 import net.osmand.plus.views.mapwidgets.MarkersWidgetsHelper.CustomLatLonListener;
+import net.osmand.plus.views.mapwidgets.widgetstates.MapMarkerSideWidgetState;
+import net.osmand.plus.views.mapwidgets.widgetstates.MapMarkerSideWidgetState.SideMarkerMode;
 
 import java.util.List;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
+import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_1;
+import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_2;
+
 public class MapMarkerSideWidget extends TextInfoWidget implements CustomLatLonListener {
 
-	private final MapMarkersHelper mapMarkersHelper;
+	private static final String DASH = "â€”";
+	private static final int UPDATE_INTERVAL_MILLIS = 1000;
 
-	private final boolean firstMarker;
+	private final MapMarkersHelper mapMarkersHelper;
+	private final MapMarkerSideWidgetState widgetState;
+	private final OsmandPreference<SideMarkerMode> markerModePref;
 
+	private SideMarkerMode cachedMode;
 	private int cachedMeters;
+	private long lastUpdatedTime;
 	private int cachedMarkerColorIndex = -1;
 	private boolean cachedNightMode;
 
 	private LatLon customLatLon;
 
-	public MapMarkerSideWidget(@NonNull MapActivity mapActivity, boolean firstMarker) {
-		super(mapActivity, firstMarker ? SIDE_MARKER_1 : SIDE_MARKER_2);
-		this.firstMarker = firstMarker;
+	public MapMarkerSideWidget(@NonNull MapActivity mapActivity, @NonNull MapMarkerSideWidgetState widgetState) {
+		super(mapActivity, widgetState.isFirstMarker() ? SIDE_MARKER_1 : SIDE_MARKER_2);
+		this.widgetState = widgetState;
 		this.mapMarkersHelper = app.getMapMarkersHelper();
+		this.markerModePref = widgetState.getMapMarkerModePref();
 
 		cachedNightMode = isNightMode();
 
 		setText(null, null);
-		setIcons(SIDE_MARKER_1);
-		setOnClickListener(v -> MarkersWidgetsHelper.showMarkerOnMap(mapActivity, firstMarker ? 0 : 1));
+		setOnClickListener(v -> {
+			widgetState.changeToNextState();
+			updateInfo(null);
+		});
+		view.setOnLongClickListener(v -> {
+			MarkersWidgetsHelper.showMarkerOnMap(mapActivity, widgetState.isFirstMarker() ? 0 : 1);
+			return true;
+		});
+	}
+
+	@NonNull
+	@Override
+	public MapMarkerSideWidgetState getWidgetState() {
+		return widgetState;
 	}
 
 	@Override
@@ -63,37 +84,78 @@ public void updateInfo(@Nullable DrawSettings drawSettings) {
 				|| routingHelper.isFollowingMode();
 		if (hideWidget) {
 			cachedMeters = 0;
+			lastUpdatedTime = 0;
 			setText(null, null);
 			return;
 		}
 
-		updateTextIfNeeded();
-		updateIconIfNeeded(marker);
+		SideMarkerMode newMode = markerModePref.get();
+		boolean modeChanged = cachedMode != newMode;
+		if (modeChanged) {
+			cachedMode = newMode;
+		}
+
+		updateTextIfNeeded(newMode, modeChanged);
+		updateIconIfNeeded(marker, newMode, modeChanged);
 	}
 
-	private void updateTextIfNeeded() {
+	private void updateTextIfNeeded(@NonNull SideMarkerMode mode, boolean modeChanged) {
 		int distance = getDistance();
-		if (isUpdateNeeded() || cachedMeters != distance) {
-			cachedMeters = distance;
-			MetricsConstants metricsConstants = settings.METRIC_SYSTEM.get();
-			FormattedValue formattedDistance = OsmAndFormatter.getFormattedDistanceValue(cachedMeters,
-					app, false, metricsConstants);
-			setText(formattedDistance.value, formattedDistance.unit);
+		long time = System.currentTimeMillis();
+
+		boolean distanceChanged = cachedMeters != distance;
+		boolean timePassed = time - lastUpdatedTime > UPDATE_INTERVAL_MILLIS;
+		boolean updateDistance = mode == SideMarkerMode.DISTANCE && distanceChanged;
+		boolean updateArrivalTime = mode == SideMarkerMode.ESTIMATED_ARRIVAL_TIME && (distanceChanged || timePassed);
+
+		if (isUpdateNeeded() || modeChanged || updateDistance || updateArrivalTime) {
+			if (mode == SideMarkerMode.DISTANCE) {
+				updateDistance(distance);
+			} else if (mode == SideMarkerMode.ESTIMATED_ARRIVAL_TIME) {
+				updateArrivalTime(distance, time);
+			}
+		}
+	}
+
+	private void updateDistance(int distance) {
+		cachedMeters = distance;
+		MetricsConstants metricsConstants = settings.METRIC_SYSTEM.get();
+		FormattedValue formattedDistance = OsmAndFormatter.getFormattedDistanceValue(distance,
+				app, false, metricsConstants);
+		setText(formattedDistance.value, formattedDistance.unit);
+	}
+
+	private void updateArrivalTime(int distance, long currentTime) {
+		cachedMeters = distance;
+		lastUpdatedTime = currentTime;
+
+		AverageSpeedComputer averageSpeedComputer = app.getAverageSpeedComputer();
+		long interval = widgetState.getAverageSpeedIntervalPref().get();
+		float averageSpeed = averageSpeedComputer.getAverageSpeed(interval, false);
+
+		if (Float.isNaN(averageSpeed) || averageSpeed == 0) {
+			setText(DASH, null);
+			return;
 		}
+
+		int estimatedLeftSeconds = (int) (distance / averageSpeed);
+		long estimatedArrivalTime = currentTime + estimatedLeftSeconds * 1000L;
+		setTimeText(estimatedArrivalTime);
 	}
 
-	private void updateIconIfNeeded(@NonNull MapMarker marker) {
+	private void updateIconIfNeeded(@NonNull MapMarker marker, @NonNull SideMarkerMode mode, boolean modeChanged) {
 		int colorIndex = marker.colorIndex;
-		boolean updateIcon = colorIndex != -1
+		boolean colorChanged = colorIndex != -1
 				&& (colorIndex != cachedMarkerColorIndex || cachedNightMode != isNightMode());
-		if (updateIcon) {
-			int backgroundIconId = getIconId();
-			int foregroundColorId = MapMarker.getColorId(marker.colorIndex);
+		if (colorChanged || modeChanged) {
+			cachedMarkerColorIndex = colorIndex;
+			cachedNightMode = isNightMode();
+
+			int backgroundIconId = widgetState.getSettingsIconId(cachedNightMode);
+			int foregroundColorId = MapMarker.getColorId(colorIndex);
 			Drawable drawable = iconsCache.getLayeredIcon(backgroundIconId,
-					R.drawable.widget_marker_triangle, 0, foregroundColorId);
+					mode.foregroundIconId, 0, foregroundColorId);
 			setImageDrawable(drawable);
-			cachedMarkerColorIndex = marker.colorIndex;
-			cachedNightMode = isNightMode();
 		}
 	}
 
@@ -119,7 +181,7 @@ private LatLon getPointToNavigate() {
 	private MapMarker getMarker() {
 		List<MapMarker> markers = mapMarkersHelper.getMapMarkers();
 		if (markers.size() > 0) {
-			if (firstMarker) {
+			if (widgetState.isFirstMarker()) {
 				return markers.get(0);
 			} else if (markers.size() > 1) {
 				return markers.get(1);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java
index 12e6014b008..b571b9d8a27 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java
@@ -3,6 +3,7 @@
 import android.graphics.drawable.AnimationDrawable;
 import android.graphics.drawable.Drawable;
 import android.text.TextUtils;
+import android.text.format.DateFormat;
 import android.view.View;
 import android.view.View.OnClickListener;
 import android.widget.ImageView;
@@ -191,6 +192,15 @@ protected int getIconId() {
 		return getIconId(isNightMode());
 	}
 
+	protected void setTimeText(long time) {
+		if (DateFormat.is24HourFormat(app)) {
+			setText(DateFormat.format("k:mm", time).toString(), null);
+		} else {
+			setText(DateFormat.format("h:mm", time).toString(),
+					DateFormat.format("aa", time).toString());
+		}
+	}
+
 	@DrawableRes
 	public int getIconId(boolean nightMode) {
 		return nightMode ? nightIconId : dayIconId;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TimeToNavigationPointWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TimeToNavigationPointWidget.java
index 0eebf4195c8..57aff288101 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TimeToNavigationPointWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TimeToNavigationPointWidget.java
@@ -39,7 +39,7 @@ public TimeToNavigationPointWidget(@NonNull MapActivity mapActivity, @NonNull Ti
 		updateIcons();
 		updateContentTitle();
 		setOnClickListener(v -> {
-			arrivalTimeOtherwiseTimeToGoPref.set(!arrivalTimeOtherwiseTimeToGoPref.get());
+			widgetState.changeToNextState();
 			updateInfo(null);
 			mapActivity.refreshMap();
 		});
@@ -102,12 +102,7 @@ private void updateContentTitle() {
 
 	private void updateArrivalTime(int leftSeconds) {
 		long arrivalTime = System.currentTimeMillis() + leftSeconds * 1000L;
-		if (DateFormat.is24HourFormat(app)) {
-			setText(DateFormat.format("k:mm", arrivalTime).toString(), null);
-		} else {
-			setText(DateFormat.format("h:mm", arrivalTime).toString(),
-					DateFormat.format("aa", arrivalTime).toString());
-		}
+		setTimeText(arrivalTime);
 	}
 
 	private void updateTimeToGo(int leftSeconds) {
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/MapMarkerSideWidgetState.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/MapMarkerSideWidgetState.java
new file mode 100644
index 00000000000..4c56fb6338c
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/MapMarkerSideWidgetState.java
@@ -0,0 +1,121 @@
+package net.osmand.plus.views.mapwidgets.widgetstates;
+
+import android.content.Context;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.settings.backend.preferences.OsmandPreference;
+import net.osmand.plus.views.mapwidgets.AverageSpeedComputer;
+import net.osmand.plus.views.mapwidgets.WidgetType;
+import net.osmand.util.Algorithms;
+
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.annotation.StringRes;
+
+public class MapMarkerSideWidgetState extends WidgetState {
+
+	private final OsmandPreference<SideMarkerMode> mapMarkerModePref;
+	private final OsmandPreference<Long> averageSpeedIntervalPref;
+	private final boolean firstMarker;
+
+	public MapMarkerSideWidgetState(@NonNull OsmandApplication app, @Nullable String customId, boolean firstMarker) {
+		super(app);
+		this.firstMarker = firstMarker;
+		this.mapMarkerModePref = getModePref(customId);
+		this.averageSpeedIntervalPref = getAverageSpeedIntervalPref(customId);
+	}
+
+	@NonNull
+	private OsmandPreference<SideMarkerMode> getModePref(@Nullable String customId) {
+		String prefId = firstMarker ? "first_map_marker_mode" : "second_map_marker_mode";
+		if (!Algorithms.isEmpty(customId)) {
+			prefId += customId;
+		}
+		return settings.registerEnumIntPreference(prefId, SideMarkerMode.DISTANCE, SideMarkerMode.values(), SideMarkerMode.class);
+	}
+
+	@NonNull
+	private OsmandPreference<Long> getAverageSpeedIntervalPref(@Nullable String customId) {
+		String prefId = firstMarker ? "first_map_marker_interval" : "second_map_marker_interval";
+		if (!Algorithms.isEmpty(customId)) {
+			prefId += customId;
+		}
+		return settings.registerLongPreference(prefId, AverageSpeedComputer.DEFAULT_INTERVAL_MILLIS);
+	}
+
+	@NonNull
+	public OsmandPreference<SideMarkerMode> getMapMarkerModePref() {
+		return mapMarkerModePref;
+	}
+
+	@NonNull
+	public OsmandPreference<Long> getAverageSpeedIntervalPref() {
+		return averageSpeedIntervalPref;
+	}
+
+	@NonNull
+	@Override
+	public String getTitle() {
+		WidgetType widgetType = firstMarker ? WidgetType.SIDE_MARKER_1 : WidgetType.SIDE_MARKER_2;
+		String title = app.getString(widgetType.titleId);
+		String subtitle = mapMarkerModePref.get().getTitle(app);
+		return app.getString(R.string.ltr_or_rtl_combine_via_colon, title, subtitle);
+	}
+
+	@Override
+	public int getSettingsIconId(boolean nightMode) {
+		return mapMarkerModePref.get().getIconId(nightMode);
+	}
+
+	@Override
+	public void changeToNextState() {
+		mapMarkerModePref.set(mapMarkerModePref.get().next());
+	}
+
+	public boolean isFirstMarker() {
+		return firstMarker;
+	}
+
+	public enum SideMarkerMode {
+
+		DISTANCE(R.string.distance, R.drawable.widget_marker_day, R.drawable.widget_marker_night, R.drawable.widget_marker_triangle),
+		ESTIMATED_ARRIVAL_TIME(R.string.side_marker_eta, R.drawable.widget_marker_eta_day, R.drawable.widget_marker_eta_night, R.drawable.widget_marker_eta_triangle);
+
+		@StringRes
+		public final int titleId;
+		@DrawableRes
+		public final int dayIconId;
+		@DrawableRes
+		public final int nightIconId;
+		@DrawableRes
+		public final int foregroundIconId;
+
+		SideMarkerMode(@StringRes int titleId,
+		               @DrawableRes int dayIconId,
+		               @DrawableRes int nightIconId,
+		               @DrawableRes int foregroundIconId) {
+			this.titleId = titleId;
+			this.dayIconId = dayIconId;
+			this.nightIconId = nightIconId;
+			this.foregroundIconId = foregroundIconId;
+		}
+
+		@NonNull
+		public String getTitle(@NonNull Context context) {
+			return context.getString(titleId);
+		}
+
+		@DrawableRes
+		public int getIconId(boolean nightMode) {
+			return nightMode ? nightIconId : dayIconId;
+		}
+
+		@NonNull
+		public SideMarkerMode next() {
+			int nextItemIndex = (ordinal() + 1) % SideMarkerMode.values().length;
+			return values()[nextItemIndex];
+		}
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/TimeToNavigationPointWidgetState.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/TimeToNavigationPointWidgetState.java
index 50b10fb8eab..5db95eaf719 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/TimeToNavigationPointWidgetState.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/TimeToNavigationPointWidgetState.java
@@ -27,7 +27,7 @@ public TimeToNavigationPointWidgetState(@NonNull OsmandApplication app, @Nullabl
 		if (!Algorithms.isEmpty(customId)) {
 			prefId += customId;
 		}
-		this.arrivalTimeOrTimeToGo = app.getSettings().registerBooleanPreference(prefId, true).makeProfile();
+		this.arrivalTimeOrTimeToGo = settings.registerBooleanPreference(prefId, true).makeProfile();
 	}
 
 	public boolean isIntermediate() {
@@ -55,8 +55,8 @@ public int getSettingsIconId(boolean nightMode) {
 	}
 
 	@Override
-	public void changeState(int stateId) {
-		arrivalTimeOrTimeToGo.set(stateId == TIME_CONTROL_WIDGET_STATE_ARRIVAL_TIME);
+	public void changeToNextState() {
+		arrivalTimeOrTimeToGo.set(!arrivalTimeOrTimeToGo.get());
 	}
 
 	public enum TimeToNavigationPointState {
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/WidgetState.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/WidgetState.java
index 26ae44ab126..53744707ed0 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/WidgetState.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgetstates/WidgetState.java
@@ -1,15 +1,18 @@
 package net.osmand.plus.views.mapwidgets.widgetstates;
 
 import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.settings.backend.OsmandSettings;
 
 import androidx.annotation.NonNull;
 
 public abstract class WidgetState {
 
 	protected final OsmandApplication app;
+	protected final OsmandSettings settings;
 
 	public WidgetState(@NonNull OsmandApplication app) {
 		this.app = app;
+		this.settings = app.getSettings();
 	}
 
 	@NonNull
@@ -22,5 +25,5 @@ public OsmandApplication getApp() {
 
 	public abstract int getSettingsIconId(boolean nightMode);
 
-	public abstract void changeState(int stateId);
+	public abstract void changeToNextState();
 }
\ No newline at end of file
