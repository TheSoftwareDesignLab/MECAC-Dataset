diff --git a/OsmAnd/res/layout-land/map_hud_top.xml b/OsmAnd/res/layout-land/map_hud_top.xml
index 7b5798fd4cd..3606d5b08b7 100644
--- a/OsmAnd/res/layout-land/map_hud_top.xml
+++ b/OsmAnd/res/layout-land/map_hud_top.xml
@@ -237,184 +237,9 @@
 
 			<!-- Street name widget (default position) -->
 			<FrameLayout
-				android:id="@+id/map_top_bar"
-				android:layout_width="fill_parent"
-				android:layout_height="wrap_content"
-				android:background="@drawable/btn_round"
-				android:minHeight="@dimen/map_address_height">
-
-				<LinearLayout
-					android:layout_width="wrap_content"
-					android:layout_height="wrap_content"
-					android:layout_gravity="center"
-					android:layout_marginLeft="5dp"
-					android:layout_marginRight="5dp"
-					android:gravity="center"
-					android:orientation="horizontal"
-					android:layout_marginStart="5dp"
-					android:layout_marginEnd="5dp">
-
-					<TextView
-						android:id="@+id/map_exit_ref"
-						android:layout_width="wrap_content"
-						android:layout_height="wrap_content"
-						android:background="@drawable/bg_topbar_shield_exit_ref"
-						android:gravity="center"
-						android:minWidth="@dimen/map_widget_height"
-						android:textColor="@color/color_white"
-						android:textSize="@dimen/map_widget_text_size"
-						android:visibility="gone"
-						tools:text="8"
-						tools:visibility="visible" />
-
-					<androidx.appcompat.widget.AppCompatImageView
-						android:id="@+id/map_turn_icon"
-						android:layout_width="@dimen/map_widget_height"
-						android:layout_height="@dimen/map_widget_height"
-						android:scaleType="fitCenter"/>
-
-					<androidx.appcompat.widget.AppCompatImageView
-						android:id="@+id/map_shield_icon"
-						android:layout_width="60dp"
-						android:layout_height="match_parent"
-						android:scaleType="fitCenter"
-						tools:src="@drawable/h_white_pillow_2_road_shield" />
-
-					<FrameLayout
-						android:layout_width="wrap_content"
-						android:layout_height="wrap_content">
-
-						<TextView
-							android:id="@+id/map_address_text_shadow"
-							android:layout_width="wrap_content"
-							android:layout_height="wrap_content"
-							android:layout_gravity="center"
-							android:ellipsize="end"
-							android:importantForAccessibility="no"
-							android:maxLines="1"
-							android:singleLine="true"
-							android:textColor="@color/color_black"
-							android:textSize="@dimen/map_widget_text_size"
-							tools:text="Long Street Name" />
-
-						<TextView
-							android:id="@+id/map_address_text"
-							android:layout_width="wrap_content"
-							android:layout_height="wrap_content"
-							android:layout_gravity="center"
-							android:ellipsize="end"
-							android:maxLines="1"
-							android:singleLine="true"
-							android:textColor="@color/color_black"
-							android:textSize="@dimen/map_widget_text_size"
-							tools:text="Long Street Name" />
-
-					</FrameLayout>
-
-				</LinearLayout>
-
-				<LinearLayout
-					android:id="@+id/waypoint_info_bar"
-					android:layout_width="fill_parent"
-					android:layout_height="wrap_content"
-					android:orientation="horizontal">
-
-					<androidx.appcompat.widget.AppCompatImageView
-						android:id="@+id/waypoint_icon"
-						android:layout_width="wrap_content"
-						android:layout_height="wrap_content"
-						android:layout_gravity="center_vertical"
-						android:layout_marginLeft="@dimen/map_button_margin"
-						android:layout_marginRight="@dimen/map_button_margin"
-						osmand:srcCompat="@drawable/ic_action_remove_dark"
-						android:layout_marginStart="@dimen/map_button_margin"
-						android:layout_marginEnd="@dimen/map_button_margin" />
-
-					<LinearLayout
-						android:layout_width="wrap_content"
-						android:layout_height="wrap_content"
-						android:layout_gravity="center"
-						android:orientation="vertical">
-
-						<TextView
-							android:id="@+id/waypoint_dist"
-							android:layout_width="64dp"
-							android:layout_height="wrap_content"
-							android:layout_gravity="center_vertical"
-							android:layout_marginLeft="2dp"
-							android:layout_marginStart="2dp"
-							android:maxLines="2"
-							android:textColor="@color/osmand_orange"
-							android:textSize="@dimen/default_list_text_size"
-							android:textStyle="bold"/>
-
-						<TextView
-							android:id="@+id/waypoint_deviation"
-							android:layout_width="64dp"
-							android:layout_height="wrap_content"
-							android:layout_gravity="bottom"
-							android:layout_marginLeft="2dp"
-							android:layout_marginStart="2dp"
-							android:drawablePadding="2dp"
-							android:maxLines="1"
-							android:textColor="@color/osmand_orange"
-							android:textSize="@dimen/default_list_text_size"
-							android:textStyle="bold"
-							android:visibility="gone"/>
-
-					</LinearLayout>
-
-					<FrameLayout
-						android:layout_width="0dp"
-						android:layout_height="wrap_content"
-						android:layout_gravity="center_vertical"
-						android:layout_marginLeft="4dp"
-						android:layout_marginStart="4dp"
-						android:layout_weight="1">
-
-
-						<TextView
-							android:id="@+id/waypoint_text_shadow"
-							android:importantForAccessibility="no"
-							android:layout_width="wrap_content"
-							android:layout_height="wrap_content"
-							android:ellipsize="end"
-							android:maxLines="2"
-							android:textColor="@color/color_black"
-							android:textSize="@dimen/map_button_text_size"
-							tools:text="Waypoint"/>
-
-						<TextView
-							android:id="@+id/waypoint_text"
-							android:layout_width="wrap_content"
-							android:layout_height="wrap_content"
-							android:ellipsize="end"
-							android:maxLines="2"
-							android:textColor="@color/color_black"
-							android:textSize="@dimen/map_button_text_size"
-							tools:text="Waypoint"/>
-
-					</FrameLayout>
-
-					<ImageButton
-						android:id="@+id/waypoint_more"
-						android:contentDescription="@string/shared_string_more"
-						android:layout_width="@dimen/map_address_height"
-						android:layout_height="@dimen/map_address_height"
-						android:background="@drawable/btn_circle_transparent"
-						android:layout_gravity="center_vertical"
-						osmand:srcCompat="@drawable/ic_overflow_menu_white"/>
-
-					<ImageButton
-						android:id="@+id/waypoint_close"
-						android:contentDescription="@string/shared_string_close"
-						android:layout_width="@dimen/map_address_height"
-						android:layout_height="@dimen/map_address_height"
-						android:background="@drawable/btn_circle_transparent"
-						android:layout_gravity="center_vertical"
-						osmand:srcCompat="@drawable/ic_action_remove_dark"/>
-				</LinearLayout>
-			</FrameLayout>
+				android:id="@+id/street_name_widget_default_container"
+				android:layout_width="match_parent"
+				android:layout_height="wrap_content" />
 
 			<!-- Toolbar -->
 			<FrameLayout
diff --git a/OsmAnd/res/layout-land/street_name_widget.xml b/OsmAnd/res/layout-land/street_name_widget.xml
new file mode 100644
index 00000000000..efb3f39e816
--- /dev/null
+++ b/OsmAnd/res/layout-land/street_name_widget.xml
@@ -0,0 +1,175 @@
+<?xml version="1.0" encoding="utf-8"?>
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:osmand="http://schemas.android.com/apk/res-auto"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:id="@+id/street_name_widget"
+	android:layout_width="match_parent"
+	android:layout_height="wrap_content"
+	android:minHeight="@dimen/map_address_height"
+	android:background="@drawable/btn_round">
+
+	<LinearLayout
+		android:layout_width="wrap_content"
+		android:layout_height="wrap_content"
+		android:layout_gravity="center"
+		android:layout_marginHorizontal="@dimen/measurement_tool_menu_title_padding_bottom"
+		android:orientation="horizontal"
+		android:gravity="center">
+
+		<net.osmand.plus.widgets.TextViewEx
+			android:id="@+id/map_exit_ref"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:minWidth="@dimen/map_widget_height"
+			android:gravity="center"
+			android:background="@drawable/bg_topbar_shield_exit_ref"
+			android:textColor="@color/color_white"
+			android:textSize="@dimen/map_widget_text_size"
+			android:visibility="gone"
+			tools:text="8"
+			tools:visibility="visible" />
+
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/map_turn_icon"
+			android:layout_width="@dimen/map_widget_height"
+			android:layout_height="@dimen/map_widget_height"
+			android:scaleType="fitCenter" />
+
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/map_shield_icon"
+			android:layout_width="@dimen/dialog_button_ex_height"
+			android:layout_height="match_parent"
+			android:scaleType="fitCenter"
+			tools:src="@drawable/h_white_pillow_2_road_shield" />
+
+		<FrameLayout
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/map_address_text_shadow"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center"
+				android:ellipsize="end"
+				android:importantForAccessibility="no"
+				android:maxLines="1"
+				android:singleLine="true"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_widget_text_size"
+				tools:text="Long Street Name" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/map_address_text"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center"
+				android:ellipsize="end"
+				android:maxLines="1"
+				android:singleLine="true"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_widget_text_size"
+				tools:text="Long Street Name" />
+
+		</FrameLayout>
+
+	</LinearLayout>
+
+	<LinearLayout
+		android:id="@+id/waypoint_info_bar"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:orientation="horizontal">
+
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/waypoint_icon"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_marginHorizontal="@dimen/map_button_margin"
+			android:layout_gravity="center_vertical"
+			osmand:srcCompat="@drawable/ic_action_remove_dark" />
+
+		<LinearLayout
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_gravity="center"
+			android:orientation="vertical">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_dist"
+				android:layout_width="@dimen/card_title_row_min_height"
+				android:layout_height="wrap_content"
+				android:layout_marginStart="@dimen/favorites_icon_padding"
+				android:layout_gravity="center_vertical"
+				android:maxLines="2"
+				android:textColor="@color/osmand_orange"
+				android:textSize="@dimen/default_list_text_size"
+				android:textStyle="bold" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_deviation"
+				android:layout_width="@dimen/card_title_row_min_height"
+				android:layout_height="wrap_content"
+				android:layout_marginStart="@dimen/favorites_icon_padding"
+				android:layout_gravity="bottom"
+				android:drawablePadding="@dimen/favorites_icon_padding"
+				android:maxLines="1"
+				android:textColor="@color/osmand_orange"
+				android:textSize="@dimen/default_list_text_size"
+				android:textStyle="bold"
+				android:visibility="gone" />
+
+		</LinearLayout>
+
+		<FrameLayout
+			android:layout_width="0dp"
+			android:layout_height="wrap_content"
+			android:layout_marginStart="@dimen/list_item_button_padding"
+			android:layout_gravity="center_vertical"
+			android:layout_weight="1">
+
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_text_shadow"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:ellipsize="end"
+				android:maxLines="2"
+				android:importantForAccessibility="no"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_button_text_size"
+				tools:text="Waypoint" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_text"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:ellipsize="end"
+				android:maxLines="2"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_button_text_size"
+				tools:text="Waypoint" />
+
+		</FrameLayout>
+
+		<ImageButton
+			android:id="@+id/waypoint_more"
+			android:contentDescription="@string/shared_string_more"
+			android:layout_width="@dimen/map_address_height"
+			android:layout_height="@dimen/map_address_height"
+			android:layout_gravity="center_vertical"
+			android:background="@drawable/btn_circle_transparent"
+			osmand:srcCompat="@drawable/ic_overflow_menu_white" />
+
+		<ImageButton
+			android:id="@+id/waypoint_close"
+			android:contentDescription="@string/shared_string_close"
+			android:layout_width="@dimen/map_address_height"
+			android:layout_height="@dimen/map_address_height"
+			android:layout_gravity="center_vertical"
+			android:background="@drawable/btn_circle_transparent"
+			osmand:srcCompat="@drawable/ic_action_remove_dark" />
+
+	</LinearLayout>
+
+</FrameLayout>
diff --git a/OsmAnd/res/layout/map_hud_top.xml b/OsmAnd/res/layout/map_hud_top.xml
index 5923c15de02..733d87e471e 100644
--- a/OsmAnd/res/layout/map_hud_top.xml
+++ b/OsmAnd/res/layout/map_hud_top.xml
@@ -6,196 +6,7 @@
 	android:layout_height="match_parent"
 	android:orientation="vertical">
 
-	<!-- TOP ROW -->
-
-	<FrameLayout
-		android:id="@+id/map_top_bar"
-		android:layout_width="fill_parent"
-		android:layout_height="wrap_content"
-		android:background="@drawable/btn_flat"
-		android:minHeight="@dimen/map_address_height">
-
-		<!-- android:layout_weight="1" to show properly next turn -->
-		<LinearLayout
-			android:layout_width="match_parent"
-			android:layout_height="wrap_content"
-			android:layout_gravity="center"
-			android:layout_marginLeft="5dp"
-			android:layout_marginRight="5dp"
-			android:gravity="center"
-			android:orientation="horizontal"
-			android:layout_marginStart="5dp"
-			android:layout_marginEnd="5dp">
-
-			<TextView
-				android:id="@+id/map_exit_ref"
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content"
-				android:background="@drawable/bg_topbar_shield_exit_ref"
-				android:gravity="center"
-				android:minWidth="@dimen/map_widget_height"
-				android:textColor="@color/color_white"
-				android:textSize="@dimen/map_widget_text_size"
-				android:visibility="gone"
-				android:paddingLeft="@dimen/text_margin_small"
-				android:paddingRight="@dimen/text_margin_small"
-				android:textStyle="bold"
-				tools:text="8"
-
-				tools:visibility="visible"
-				android:paddingStart="@dimen/text_margin_small"
-				android:paddingEnd="@dimen/text_margin_small" />
-
-			<androidx.appcompat.widget.AppCompatImageView
-				android:id="@+id/map_turn_icon"
-				android:layout_width="@dimen/map_widget_height"
-				android:layout_height="@dimen/map_widget_height"
-				android:scaleType="fitCenter"
-				android:visibility="gone"/>
-
-			<androidx.appcompat.widget.AppCompatImageView
-				android:id="@+id/map_shield_icon"
-				android:layout_width="@dimen/map_widget_height"
-				android:layout_height="@dimen/map_widget_height"
-				android:scaleType="fitCenter"
-				android:visibility="gone"
-				tools:src="@drawable/h_white_pillow_2_road_shield" />
-
-			<FrameLayout
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content">
-
-				<TextView
-					android:id="@+id/map_address_text_shadow"
-					android:layout_width="wrap_content"
-					android:layout_height="wrap_content"
-					android:layout_gravity="center"
-					android:ellipsize="end"
-					android:importantForAccessibility="no"
-					android:maxLines="1"
-					android:singleLine="true"
-					android:textColor="@color/color_black"
-					android:textSize="@dimen/map_widget_text_size"
-					tools:text="Long Street Name" />
-
-				<TextView
-					android:id="@+id/map_address_text"
-					android:layout_width="wrap_content"
-					android:layout_height="wrap_content"
-					android:layout_gravity="center"
-					android:ellipsize="end"
-					android:maxLines="1"
-					android:singleLine="true"
-					android:textColor="@color/color_black"
-					android:textSize="@dimen/map_widget_text_size"
-					tools:text="Long Street Name" />
-
-			</FrameLayout>
-
-		</LinearLayout>
-
-		<LinearLayout
-			android:id="@+id/waypoint_info_bar"
-			android:layout_width="fill_parent"
-			android:layout_height="wrap_content"
-			android:orientation="horizontal"
-			android:visibility="gone">
-
-			<androidx.appcompat.widget.AppCompatImageView
-				android:id="@+id/waypoint_icon"
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content"
-				android:layout_gravity="center_vertical"
-				android:layout_marginLeft="@dimen/map_button_margin"
-				android:layout_marginRight="@dimen/map_button_margin"
-				tools:src="@drawable/ic_action_remove_dark"
-				android:layout_marginStart="@dimen/map_button_margin"
-				android:layout_marginEnd="@dimen/map_button_margin" />
-
-			<LinearLayout
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content"
-				android:layout_gravity="center"
-				android:orientation="vertical">
-
-				<TextView
-					android:id="@+id/waypoint_dist"
-					android:layout_width="64dp"
-					android:layout_height="wrap_content"
-					android:layout_gravity="center_vertical"
-					android:layout_marginStart="@dimen/favorites_icon_padding"
-					android:maxLines="2"
-					android:textColor="@color/osmand_orange"
-					android:textSize="@dimen/default_list_text_size"
-					android:textStyle="bold"/>
-
-				<TextView
-					android:id="@+id/waypoint_deviation"
-					android:layout_width="64dp"
-					android:layout_height="wrap_content"
-					android:layout_gravity="bottom"
-					android:layout_marginStart="@dimen/favorites_icon_padding"
-					android:drawablePadding="2dp"
-					android:maxLines="1"
-					android:textColor="@color/osmand_orange"
-					android:textSize="@dimen/default_list_text_size"
-					android:textStyle="bold"
-					android:visibility="gone"/>
-
-			</LinearLayout>
-
-			<FrameLayout
-				android:layout_width="0dp"
-				android:layout_height="wrap_content"
-				android:layout_gravity="center_vertical"
-				android:layout_marginStart="@dimen/list_item_button_padding"
-				android:layout_weight="1">
-
-				<TextView
-					android:id="@+id/waypoint_text_shadow"
-					android:importantForAccessibility="no"
-					android:layout_width="wrap_content"
-					android:layout_height="wrap_content"
-					android:ellipsize="end"
-					android:maxLines="2"
-					android:textColor="@color/color_black"
-					android:textSize="@dimen/map_button_text_size"
-					tools:text="Waypoint"/>
-
-				<TextView
-					android:id="@+id/waypoint_text"
-					android:layout_width="wrap_content"
-					android:layout_height="wrap_content"
-					android:ellipsize="end"
-					android:maxLines="2"
-					android:textColor="@color/color_black"
-					android:textSize="@dimen/map_button_text_size"
-					tools:text="Waypoint"/>
-
-			</FrameLayout>
-
-			<ImageButton
-				android:id="@+id/waypoint_more"
-				android:contentDescription="@string/shared_string_more"
-				android:layout_width="@dimen/map_address_height"
-				android:layout_height="@dimen/map_address_height"
-				android:background="@drawable/btn_circle_transparent"
-				android:layout_gravity="center_vertical"
-				tools:src="@drawable/ic_action_remove_dark"/>
-
-			<ImageButton
-				android:id="@+id/waypoint_close"
-				android:contentDescription="@string/shared_string_close"
-				android:layout_width="@dimen/map_address_height"
-				android:layout_height="@dimen/map_address_height"
-				android:background="@drawable/bottom_shadow"
-				android:layout_gravity="center_vertical"
-				tools:src="@drawable/ic_action_remove_dark"/>
-
-		</LinearLayout>
-
-	</FrameLayout>
-
+	<!-- Toolbar -->
 	<FrameLayout
 		android:id="@+id/widget_top_bar"
 		android:layout_width="match_parent"
diff --git a/OsmAnd/res/layout/street_name_widget.xml b/OsmAnd/res/layout/street_name_widget.xml
new file mode 100644
index 00000000000..61b040e3d44
--- /dev/null
+++ b/OsmAnd/res/layout/street_name_widget.xml
@@ -0,0 +1,178 @@
+<?xml version="1.0" encoding="utf-8"?>
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:id="@+id/street_name_widget"
+	android:layout_width="match_parent"
+	android:layout_height="wrap_content"
+	android:minHeight="@dimen/map_address_height"
+	android:background="@drawable/btn_flat">
+
+	<LinearLayout
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:orientation="horizontal"
+		android:layout_marginHorizontal="@dimen/measurement_tool_menu_title_padding_bottom"
+		android:layout_gravity="center"
+		android:gravity="center">
+
+		<net.osmand.plus.widgets.TextViewEx
+			android:id="@+id/map_exit_ref"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:minWidth="@dimen/map_widget_height"
+			android:gravity="center"
+			android:paddingHorizontal="@dimen/text_margin_small"
+			android:background="@drawable/bg_topbar_shield_exit_ref"
+			android:visibility="gone"
+			android:textColor="@color/color_white"
+			android:textSize="@dimen/map_widget_text_size"
+			android:textStyle="bold"
+			tools:text="8"
+			tools:visibility="visible" />
+
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/map_turn_icon"
+			android:layout_width="@dimen/map_widget_height"
+			android:layout_height="@dimen/map_widget_height"
+			android:scaleType="fitCenter"
+			android:visibility="gone" />
+
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/map_shield_icon"
+			android:layout_width="@dimen/map_widget_height"
+			android:layout_height="@dimen/map_widget_height"
+			android:scaleType="fitCenter"
+			android:visibility="gone"
+			tools:src="@drawable/h_white_pillow_2_road_shield" />
+
+		<FrameLayout
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/map_address_text_shadow"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center"
+				android:ellipsize="end"
+				android:importantForAccessibility="no"
+				android:maxLines="1"
+				android:singleLine="true"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_widget_text_size"
+				tools:text="Long Street Name" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/map_address_text"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center"
+				android:ellipsize="end"
+				android:maxLines="1"
+				android:singleLine="true"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_widget_text_size"
+				tools:text="Long Street Name" />
+
+		</FrameLayout>
+
+	</LinearLayout>
+
+	<LinearLayout
+		android:id="@+id/waypoint_info_bar"
+		android:layout_width="fill_parent"
+		android:layout_height="wrap_content"
+		android:orientation="horizontal"
+		android:visibility="gone">
+
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/waypoint_icon"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_gravity="center_vertical"
+			android:layout_marginHorizontal="@dimen/map_button_margin"
+			tools:src="@drawable/ic_action_remove_dark" />
+
+		<LinearLayout
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_gravity="center"
+			android:orientation="vertical">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_dist"
+				android:layout_width="@dimen/card_title_row_min_height"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center_vertical"
+				android:layout_marginStart="@dimen/favorites_icon_padding"
+				android:maxLines="2"
+				android:textColor="@color/osmand_orange"
+				android:textSize="@dimen/default_list_text_size"
+				android:textStyle="bold" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_deviation"
+				android:layout_width="64dp"
+				android:layout_height="wrap_content"
+				android:layout_gravity="bottom"
+				android:layout_marginStart="@dimen/favorites_icon_padding"
+				android:drawablePadding="@dimen/favorites_icon_padding"
+				android:maxLines="1"
+				android:textColor="@color/osmand_orange"
+				android:textSize="@dimen/default_list_text_size"
+				android:textStyle="bold"
+				android:visibility="gone" />
+
+		</LinearLayout>
+
+		<FrameLayout
+			android:layout_width="0dp"
+			android:layout_height="wrap_content"
+			android:layout_gravity="center_vertical"
+			android:layout_marginStart="@dimen/list_item_button_padding"
+			android:layout_weight="1">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_text_shadow"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:ellipsize="end"
+				android:maxLines="2"
+				android:importantForAccessibility="no"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_button_text_size"
+				tools:text="Waypoint" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/waypoint_text"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:ellipsize="end"
+				android:maxLines="2"
+				android:textColor="@color/color_black"
+				android:textSize="@dimen/map_button_text_size"
+				tools:text="Waypoint" />
+
+		</FrameLayout>
+
+		<ImageButton
+			android:id="@+id/waypoint_more"
+			android:layout_width="@dimen/map_address_height"
+			android:layout_height="@dimen/map_address_height"
+			android:layout_gravity="center_vertical"
+			android:background="@drawable/btn_circle_transparent"
+			android:contentDescription="@string/shared_string_more"
+			tools:src="@drawable/ic_action_remove_dark" />
+
+		<ImageButton
+			android:id="@+id/waypoint_close"
+			android:layout_width="@dimen/map_address_height"
+			android:layout_height="@dimen/map_address_height"
+			android:layout_gravity="center_vertical"
+			android:background="@drawable/bottom_shadow"
+			android:contentDescription="@string/shared_string_close"
+			tools:src="@drawable/ic_action_remove_dark" />
+
+	</LinearLayout>
+
+</FrameLayout>
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
index c2bd0b418d8..2d39e015f63 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
@@ -937,12 +937,13 @@ public void updateStatusBarColor() {
 			color = toolbarController.getStatusBarColor(this, night);
 		}
 		if (color == TopToolbarController.NO_COLOR) {
-			boolean mapTopBar = findViewById(R.id.map_top_bar).getVisibility() == View.VISIBLE;
+			View streetNameWidget = findViewById(R.id.street_name_widget);
+			boolean streetNameVisible = streetNameWidget != null && streetNameWidget.getVisibility() == View.VISIBLE;
 			boolean markerTopBar = findViewById(R.id.map_markers_top_bar).getVisibility() == View.VISIBLE;
 			boolean coordinatesWidgetVisible = mapWidgetsVisibilityHelper.shouldShowTopCoordinatesWidget();
 			if (coordinatesWidgetVisible && mapControlsVisible) {
 				colorId = night ? R.color.status_bar_main_dark : R.color.status_bar_main_dark;
-			} else if (mapTopBar && mapControlsVisible) {
+			} else if (streetNameVisible && mapControlsVisible) {
 				colorId = night ? R.color.status_bar_route_dark : R.color.status_bar_route_light;
 			} else if (markerTopBar && mapControlsVisible) {
 				colorId = R.color.status_bar_color_dark;
diff --git a/OsmAnd/src/net/osmand/plus/render/TextRenderer.java b/OsmAnd/src/net/osmand/plus/render/TextRenderer.java
index 1f3b450c43a..fe57beb1267 100644
--- a/OsmAnd/src/net/osmand/plus/render/TextRenderer.java
+++ b/OsmAnd/src/net/osmand/plus/render/TextRenderer.java
@@ -33,6 +33,8 @@
 
 public class TextRenderer {
 
+	public static final String DROID_SERIF = "Droid Serif";
+
 	private Paint paintText;
 	private final Context context;
 	private Paint paintIcon;
@@ -126,11 +128,11 @@ public TextRenderer(Context context) {
 		paintText.setStrokeWidth(1);
 		paintText.setColor(Color.BLACK);
 		paintText.setTextAlign(Align.CENTER);
-		defaultTypeface = Typeface.create("Droid Serif", Typeface.NORMAL);
-		boldItalicTypeface = Typeface.create("Droid Serif", Typeface.BOLD_ITALIC);
-		italicTypeface = Typeface.create("Droid Serif", Typeface.ITALIC);
-		boldTypeface = Typeface.create("Droid Serif", Typeface.BOLD);
-		paintText.setTypeface(defaultTypeface); //$NON-NLS-1$
+		defaultTypeface = Typeface.create(DROID_SERIF, Typeface.NORMAL);
+		boldItalicTypeface = Typeface.create(DROID_SERIF, Typeface.BOLD_ITALIC);
+		italicTypeface = Typeface.create(DROID_SERIF, Typeface.ITALIC);
+		boldTypeface = Typeface.create(DROID_SERIF, Typeface.BOLD);
+		paintText.setTypeface(defaultTypeface);
 		paintText.setAntiAlias(true);
 
 		paintIcon = new Paint();
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
index 4d68899c4b6..1fb21eac8a1 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
@@ -13,7 +13,6 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
-import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.mapcontextmenu.other.TrackChartPoints;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.ColorUtilities;
@@ -22,7 +21,6 @@
 import net.osmand.plus.views.layers.base.OsmandMapLayer;
 import net.osmand.plus.views.mapwidgets.LanesControl;
 import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory;
-import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory.TopTextView;
 import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory.TopToolbarController;
 import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory.TopToolbarControllerType;
 import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory.TopToolbarView;
@@ -35,6 +33,7 @@
 import net.osmand.plus.views.mapwidgets.widgets.ElevationProfileWidget;
 import net.osmand.plus.views.mapwidgets.widgets.NextTurnWidget;
 import net.osmand.plus.views.mapwidgets.widgets.RulerWidget;
+import net.osmand.plus.views.mapwidgets.widgets.StreetNameWidget;
 import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
 import net.osmand.plus.views.mapwidgets.widgetstates.BearingWidgetState;
 import net.osmand.plus.views.mapwidgets.widgetstates.CompassRulerWidgetState;
@@ -85,10 +84,11 @@ public class MapInfoLayer extends OsmandMapLayer {
 	private List<RulerWidget> rulerWidgets;
 	private MapWidgetRegistry mapInfoControls;
 
-	private CoordinatesWidget topCoordinatesView;
 	private TopToolbarView topToolbarView;
+
+	private CoordinatesWidget topCoordinatesView;
+	private StreetNameWidget streetNameWidget;
 	private LanesControl lanesControl;
-	private TopTextView streetNameView;
 	private ElevationProfileWidget elevationProfileWidget;
 
 	public MapInfoLayer(@NonNull Context context, @NonNull RouteLayer layer) {
@@ -136,7 +136,7 @@ public void setMapActivity(@Nullable MapActivity mapActivity) {
 			alarmControl = null;
 			rulerWidgets = null;
 
-			streetNameView = null;
+			streetNameWidget = null;
 			topToolbarView = null;
 			topCoordinatesView = null;
 		}
@@ -226,12 +226,19 @@ private void registerAllControls(@NonNull MapActivity mapActivity) {
 		lanesControl = RouteInfoWidgetsFactory.createLanesControl(mapActivity, view);
 
 		TextState ts = calculateTextState();
-		streetNameView = new TopTextView(app, mapActivity);
-		updateStreetName(false, ts);
 
 		topCoordinatesView = new CoordinatesWidget(mapActivity, ts);
 		((ViewGroup) mapActivity.findViewById(R.id.MapHudButtonsOverlayTop)).addView(topCoordinatesView.getView(), 0);
 
+		streetNameWidget = new StreetNameWidget(mapActivity, ts);
+		ViewGroup defaultStreetNamePosition = mapActivity.findViewById(R.id.street_name_widget_default_container);
+		if (defaultStreetNamePosition != null) {
+			defaultStreetNamePosition.removeAllViews();
+			defaultStreetNamePosition.addView(streetNameWidget.getView());
+		} else {
+			((ViewGroup) mapActivity.findViewById(R.id.MapHudButtonsOverlayTop)).addView(streetNameWidget.getView(), 1);
+		}
+
 		topToolbarView = new TopToolbarView(mapActivity);
 		updateTopToolbar(false);
 
@@ -399,10 +406,7 @@ public void updateColorShadowsOfText() {
 	}
 
 	private void updateStreetName(boolean nightMode, TextState ts) {
-		MapActivity mapActivity = getMapActivity();
-		boolean portrait = mapActivity != null && AndroidUiHelper.isOrientationPortrait(mapActivity);
-		streetNameView.setBackgroundResource(portrait ? ts.boxTop : ts.boxFree);
-		streetNameView.updateTextColor(nightMode, ts.textColor, ts.textShadowColor, ts.textBold, ts.textShadowRadius);
+		streetNameWidget.updateColors(nightMode, ts);
 	}
 
 	private void updateTopToolbar(boolean nightMode) {
@@ -469,7 +473,7 @@ public void onDraw(Canvas canvas, RotatedTileBox tileBox, DrawSettings drawSetti
 			if (mapInfoControls != null) {
 				mapInfoControls.updateInfo(settings.getApplicationMode(), drawSettings, WIDGETS_EXPANDED);
 			}
-			streetNameView.updateInfo(drawSettings);
+			streetNameWidget.updateInfo(drawSettings);
 			topToolbarView.updateInfo();
 			topCoordinatesView.updateInfo(drawSettings);
 			elevationProfileWidget.updateInfo();
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapInfoWidgetsFactory.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapInfoWidgetsFactory.java
index 0ede4fc3d59..776312ab617 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapInfoWidgetsFactory.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapInfoWidgetsFactory.java
@@ -1,36 +1,16 @@
 package net.osmand.plus.views.mapwidgets;
 
-import android.annotation.SuppressLint;
 import android.content.Context;
-import android.content.Intent;
-import android.graphics.Bitmap;
-import android.graphics.Canvas;
-import android.graphics.Paint;
-import android.graphics.Typeface;
 import android.graphics.drawable.Drawable;
-import android.os.Bundle;
-import android.util.TypedValue;
 import android.view.View;
 import android.view.View.OnClickListener;
-import android.view.ViewGroup;
 import android.widget.CompoundButton.OnCheckedChangeListener;
 import android.widget.ImageButton;
-import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
-import com.google.android.material.snackbar.Snackbar;
-import com.jwetherell.openmap.common.LatLonPoint;
-import com.jwetherell.openmap.common.MGRSPoint;
-import com.jwetherell.openmap.common.UTMPoint;
-
 import net.osmand.Location;
-import net.osmand.LocationConvert;
-import net.osmand.PlatformUtil;
-import net.osmand.binary.BinaryMapRouteReaderAdapter;
-import net.osmand.binary.RouteDataObject;
 import net.osmand.data.LatLon;
-import net.osmand.data.PointDescription;
 import net.osmand.plus.OsmAndLocationProvider;
 import net.osmand.plus.OsmAndLocationProvider.GPSInfo;
 import net.osmand.plus.OsmandApplication;
@@ -38,35 +18,14 @@
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.activities.actions.StartGPSStatus;
 import net.osmand.plus.helpers.AndroidUiHelper;
-import net.osmand.plus.helpers.CurrentPositionHelper;
-import net.osmand.plus.helpers.WaypointDialogHelper;
-import net.osmand.plus.helpers.WaypointHelper;
-import net.osmand.plus.helpers.WaypointHelper.LocationPointWrapper;
-import net.osmand.plus.mapcontextmenu.other.ShareMenu;
-import net.osmand.plus.render.OsmandRenderer;
-import net.osmand.plus.render.TextRenderer;
 import net.osmand.plus.routepreparationmenu.MapRouteInfoMenu;
-import net.osmand.plus.routepreparationmenu.ShowAlongTheRouteBottomSheet;
-import net.osmand.plus.routing.CurrentStreetName;
-import net.osmand.plus.routing.RouteCalculationResult;
-import net.osmand.plus.routing.RouteDirectionInfo;
-import net.osmand.plus.routing.RoutingHelper;
-import net.osmand.plus.routing.RoutingHelperUtils;
-import net.osmand.plus.settings.backend.OsmandSettings;
-import net.osmand.plus.utils.AndroidUtils;
-import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.OsmAndFormatter;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.layers.RadiusRulerControlLayer.RadiusRulerMode;
 import net.osmand.plus.views.layers.base.OsmandMapLayer.DrawSettings;
 import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
-import net.osmand.render.RenderingRuleSearchRequest;
-import net.osmand.render.RenderingRulesStorage;
-import net.osmand.util.Algorithms;
 import net.osmand.util.MapUtils;
 
-import org.apache.commons.logging.Log;
-
 import java.util.Iterator;
 import java.util.LinkedList;
 
@@ -75,7 +34,6 @@
 import androidx.annotation.DrawableRes;
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
-import androidx.appcompat.content.res.AppCompatResources;
 import androidx.appcompat.widget.SwitchCompat;
 import androidx.core.content.ContextCompat;
 import androidx.core.graphics.drawable.DrawableCompat;
@@ -836,321 +794,4 @@ public void updateColors(boolean nightMode) {
 			updateColors();
 		}
 	}
-
-	public static class TopTextView {
-		private final RoutingHelper routingHelper;
-		private final MapActivity map;
-		private final View topBar;
-		private final TextView addressText;
-		private final TextView addressTextShadow;
-		private final TextView exitRefText;
-		private final ImageView shieldIcon;
-		private final ImageView turnIcon;
-		private final OsmAndLocationProvider locationProvider;
-		private WaypointHelper waypointHelper;
-		private OsmandSettings settings;
-		private View waypointInfoBar;
-		private LocationPointWrapper lastPoint;
-		private TurnDrawable turnDrawable;
-		private int shadowRad;
-		RouteCalculationResult.NextDirectionInfo calc1;
-
-		private static final Log LOG = PlatformUtil.getLog(TopTextView.class);
-		private boolean showMarker;
-
-		public TopTextView(OsmandApplication app, MapActivity map) {
-			turnDrawable = new TurnDrawable(map, true);
-			topBar = map.findViewById(R.id.map_top_bar);
-			addressText = (TextView) map.findViewById(R.id.map_address_text);
-			addressTextShadow = (TextView) map.findViewById(R.id.map_address_text_shadow);
-			waypointInfoBar = map.findViewById(R.id.waypoint_info_bar);
-			exitRefText = map.findViewById(R.id.map_exit_ref);
-			shieldIcon = map.findViewById(R.id.map_shield_icon);
-			turnIcon = map.findViewById(R.id.map_turn_icon);
-			this.routingHelper = app.getRoutingHelper();
-			locationProvider = app.getLocationProvider();
-			this.map = map;
-			settings = app.getSettings();
-			waypointHelper = app.getWaypointHelper();
-			updateVisibility(false);
-			calc1 = new RouteCalculationResult.NextDirectionInfo();
-		}
-
-		public boolean updateVisibility(boolean visible) {
-			boolean res = AndroidUiHelper.updateVisibility(topBar, visible);
-			if (res) {
-				map.updateStatusBarColor();
-			}
-			return res;
-		}
-
-		public void updateTextColor(boolean nightMode, int textColor, int textShadowColor, boolean bold, int rad) {
-			this.shadowRad = rad;
-			TextInfoWidget.updateTextColor(addressText, addressTextShadow, textColor, textShadowColor, bold, rad);
-			TextInfoWidget.updateTextColor((TextView) waypointInfoBar.findViewById(R.id.waypoint_text),
-					(TextView) waypointInfoBar.findViewById(R.id.waypoint_text_shadow),
-					textColor, textShadowColor, bold, rad / 2);
-			exitRefText.setTextColor(nightMode ?
-					map.getResources().getColor(R.color.text_color_primary_dark) :
-					map.getResources().getColor(R.color.color_white));
-
-			ImageView all = (ImageView) waypointInfoBar.findViewById(R.id.waypoint_more);
-			ImageView remove = (ImageView) waypointInfoBar.findViewById(R.id.waypoint_close);
-			all.setImageDrawable(map.getMyApplication().getUIUtilities()
-					.getIcon(R.drawable.ic_overflow_menu_white, !nightMode));
-			remove.setImageDrawable(map.getMyApplication().getUIUtilities()
-					.getIcon(R.drawable.ic_action_remove_dark, !nightMode));
-		}
-
-
-		public boolean updateInfo(DrawSettings d) {
-			CurrentStreetName streetName = null;
-			boolean showClosestWaypointFirstInAddress = true;
-			if (routingHelper != null && routingHelper.isRouteCalculated() && !routingHelper.isDeviatedFromRoute()) {
-				if (routingHelper.isFollowingMode()) {
-					if (settings.SHOW_STREET_NAME.get()) {
-						RouteCalculationResult.NextDirectionInfo nextDirInfo = routingHelper.getNextRouteDirectionInfo(calc1, true);
-						streetName = routingHelper.getCurrentName(nextDirInfo);
-						turnDrawable.setColor(R.color.nav_arrow);
-					}
-				} else {
-					int di = MapRouteInfoMenu.getDirectionInfo();
-					if (di >= 0 && map.getMapRouteInfoMenu().isVisible() && di < routingHelper.getRouteDirections().size()) {
-						showClosestWaypointFirstInAddress = false;
-						RouteDirectionInfo next = routingHelper.getRouteDirections().get(di);
-						streetName = routingHelper.getCurrentName(routingHelper.getNextRouteDirectionInfo(calc1, true));
-						turnDrawable.setColor(R.color.nav_arrow_distant);
-					}
-				}
-			} else if (map.getMapViewTrackingUtilities().isMapLinkedToLocation() &&
-					settings.SHOW_STREET_NAME.get()) {
-				streetName = new CurrentStreetName();
-				RouteDataObject rt = locationProvider.getLastKnownRouteSegment();
-				if (rt != null) {
-					Location lastKnownLocation = locationProvider.getLastKnownLocation();
-					streetName.text = RoutingHelperUtils.formatStreetName(
-							rt.getName(settings.MAP_PREFERRED_LOCALE.get(), settings.MAP_TRANSLITERATE_NAMES.get()),
-							rt.getRef(settings.MAP_PREFERRED_LOCALE.get(), settings.MAP_TRANSLITERATE_NAMES.get(), rt.bearingVsRouteDirection(lastKnownLocation)),
-							rt.getDestinationName(settings.MAP_PREFERRED_LOCALE.get(), settings.MAP_TRANSLITERATE_NAMES.get(), rt.bearingVsRouteDirection(lastKnownLocation)),
-							"»");
-					if (!Algorithms.isEmpty(streetName.text) && lastKnownLocation != null) {
-						double dist = CurrentPositionHelper.getOrthogonalDistance(rt, lastKnownLocation);
-						if (dist < 50) {
-							streetName.showMarker = true;
-						} else {
-							streetName.text = map.getResources().getString(R.string.shared_string_near) + " " + streetName.text;
-						}
-					}
-				}
-			}
-			if (map.isTopToolbarActive() || map.shouldHideTopControls() || MapRouteInfoMenu.chooseRoutesVisible || MapRouteInfoMenu.waypointsVisible) {
-				updateVisibility(false);
-			} else if (showClosestWaypointFirstInAddress && updateWaypoint()) {
-				updateVisibility(true);
-				AndroidUiHelper.updateVisibility(addressText, false);
-				AndroidUiHelper.updateVisibility(addressTextShadow, false);
-				AndroidUiHelper.updateVisibility(turnIcon, false);
-				AndroidUiHelper.updateVisibility(shieldIcon, false);
-				AndroidUiHelper.updateVisibility(exitRefText, false);
-			} else if (streetName == null) {
-				updateVisibility(false);
-			} else {
-				updateVisibility(true);
-				AndroidUiHelper.updateVisibility(waypointInfoBar, false);
-				AndroidUiHelper.updateVisibility(addressText, true);
-				AndroidUiHelper.updateVisibility(addressTextShadow, shadowRad > 0);
-
-				if (streetName.shieldObject != null && streetName.shieldObject.nameIds != null
-						&& setRoadShield(shieldIcon, streetName.shieldObject)) {
-					AndroidUiHelper.updateVisibility(shieldIcon, true);
-					int indexOf = streetName.text.indexOf("»");
-					if (indexOf > 0) {
-						streetName.text = streetName.text.substring(indexOf);
-					}
-				} else {
-					AndroidUiHelper.updateVisibility(shieldIcon, false);
-				}
-
-				if (!Algorithms.isEmpty(streetName.exitRef)) {
-					exitRefText.setText(streetName.exitRef);
-					AndroidUiHelper.updateVisibility(exitRefText, true);
-				} else {
-					AndroidUiHelper.updateVisibility(exitRefText, false);
-				}
-				if (turnDrawable.setTurnType(streetName.turnType) || streetName.showMarker != this.showMarker) {
-					this.showMarker = streetName.showMarker;
-					if (streetName.turnType != null) {
-						turnIcon.invalidateDrawable(turnDrawable);
-						turnIcon.setImageDrawable(turnDrawable);
-						AndroidUiHelper.updateVisibility(turnIcon, true);
-					} else if (streetName.showMarker) {
-						Drawable marker = map.getMyApplication().getUIUtilities().getIcon(R.drawable.ic_action_start_navigation, R.color.color_myloc_distance);
-						turnIcon.setImageDrawable(marker);
-						AndroidUiHelper.updateVisibility(turnIcon, true);
-					} else {
-						AndroidUiHelper.updateVisibility(turnIcon, false);
-					}
-				}
-				if (streetName.text == null || streetName.text.isEmpty()) {
-					addressTextShadow.setText("");
-					addressText.setText("");
-				} else if (!streetName.text.equals(addressText.getText().toString())) {
-					addressTextShadow.setText(streetName.text);
-					addressText.setText(streetName.text);
-					return true;
-				}
-			}
-			return false;
-		}
-
-		private boolean setRoadShield(ImageView view, RouteDataObject object) {
-			StringBuilder additional = new StringBuilder();
-			for (int i = 0; i < object.nameIds.length; i++) {
-				String key = object.region.routeEncodingRules.get(object.nameIds[i]).getTag();
-				String val = object.names.get(object.nameIds[i]);
-				if (!key.endsWith("_ref") && !key.startsWith("route_road")) {
-					additional.append(key).append("=").append(val).append(";");
-				}
-			}
-			for (int i = 0; i < object.nameIds.length; i++) {
-				String key = object.region.routeEncodingRules.get(object.nameIds[i]).getTag();
-				String val = object.names.get(object.nameIds[i]);
-				if (key.startsWith("route_road") && key.endsWith("_ref")) {
-					boolean visible = setRoadShield(view, object, key, val, additional);
-					if (visible) {
-						return true;
-					}
-				}
-			}
-			return false;
-		}
-
-		private boolean setRoadShield(ImageView view, RouteDataObject object, String nameTag, String name, StringBuilder additional) {
-
-			Context context = topBar.getContext();
-			int[] tps = object.getTypes();
-			OsmandApplication app = ((OsmandApplication) context.getApplicationContext());
-			RenderingRulesStorage storage = app.getRendererRegistry().getCurrentSelectedRenderer();
-			boolean nightMode = app.getDaynightHelper().isNightMode();
-			RenderingRuleSearchRequest rreq = map.getMyApplication().getResourceManager()
-					.getRenderer().getSearchRequestWithAppliedCustomRules(storage, nightMode);
-
-			for (int i : tps) {
-				BinaryMapRouteReaderAdapter.RouteTypeRule tp = object.region.quickGetEncodingRule(i);
-				if (tp.getTag().equals("highway") || tp.getTag().equals("route")) {
-					rreq.setInitialTagValueZoom(tp.getTag(), tp.getValue(), 13, null);
-				} else {
-					additional.append(tp.getTag()).append("=").append(tp.getValue()).append(";");
-				}
-			}
-
-			rreq.setIntFilter(rreq.ALL.R_TEXT_LENGTH, name.length());
-			rreq.setStringFilter(rreq.ALL.R_NAME_TAG, nameTag);
-			rreq.setStringFilter(rreq.ALL.R_ADDITIONAL, additional.toString());
-			rreq.search(RenderingRulesStorage.TEXT_RULES);
-
-			OsmandRenderer.RenderingContext rc = new OsmandRenderer.RenderingContext(context);
-
-			TextRenderer textRenderer = new TextRenderer(context);
-			TextRenderer.TextDrawInfo text = new TextRenderer.TextDrawInfo(name);
-
-
-			Paint p = textRenderer.getPaintText();
-			p.setTypeface(Typeface.create("Droid Serif", Typeface.BOLD));
-
-			int shieldRes = -1;
-
-			if (rreq.isSpecified(rreq.ALL.R_TEXT_SHIELD)) {
-				text.setShieldResIcon(rreq.getStringPropertyValue(rreq.ALL.R_TEXT_SHIELD));
-				shieldRes = app.getResources().getIdentifier("h_" + text.getShieldResIcon(),
-						"drawable", app.getPackageName());
-			}
-
-			if (rreq.isSpecified(rreq.ALL.R_TEXT_COLOR)) {
-				p.setColor(rreq.getIntPropertyValue(rreq.ALL.R_TEXT_COLOR));
-			}
-
-			if (rreq.isSpecified(rreq.ALL.R_TEXT_SIZE)) {
-				float ts = rreq.getFloatPropertyValue(rreq.ALL.R_TEXT_SIZE);
-				textRenderer.getPaintText().setTextSize(
-						TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, ts,
-								app.getResources().getDisplayMetrics()));
-			}
-
-			if (shieldRes != -1) {
-				Drawable shield = AppCompatResources.getDrawable(view.getContext(), shieldRes);
-				if (shield == null) {
-					return false;
-				}
-				float xSize = shield.getIntrinsicWidth();
-				float ySize = shield.getIntrinsicHeight();
-				float xyRatio = xSize / ySize;
-				//setting view propotions (height is fixed by toolbar size - 48dp);
-				int viewHeightPx = AndroidUtils.dpToPx(context, 48);
-				int viewWidthPx = (int) (viewHeightPx * xyRatio);
-
-				ViewGroup.LayoutParams params = view.getLayoutParams();
-				params.width = viewWidthPx;
-				view.setLayoutParams(params);
-
-				//creating bitmap according to size of resource
-				Bitmap bitmap = Bitmap.createBitmap((int) xSize, (int) ySize, Bitmap.Config.ARGB_8888);
-				Canvas canvas = new Canvas(bitmap);
-				text.fillProperties(rc, rreq, xSize / 2f, ySize / 2f - p.getFontMetrics().ascent / 2f);
-				textRenderer.drawShieldIcon(rc, canvas, text, text.getShieldResIcon());
-				textRenderer.drawWrappedText(canvas, text, 20f);
-
-				view.setImageBitmap(bitmap);
-				return true;
-			}
-			return false;
-		}
-
-		public boolean updateWaypoint() {
-			final LocationPointWrapper pnt = waypointHelper.getMostImportantLocationPoint(null);
-			boolean changed = this.lastPoint != pnt;
-			this.lastPoint = pnt;
-			if (pnt == null) {
-				topBar.setOnClickListener(null);
-				AndroidUiHelper.updateVisibility(waypointInfoBar, false);
-				return false;
-			} else {
-				AndroidUiHelper.updateVisibility(addressText, false);
-				AndroidUiHelper.updateVisibility(addressTextShadow, false);
-				boolean updated = AndroidUiHelper.updateVisibility(waypointInfoBar, true);
-				// pass top bar to make it clickable
-				WaypointDialogHelper.updatePointInfoView(map.getMyApplication(), map, topBar, pnt, true,
-						map.getMyApplication().getDaynightHelper().isNightModeForMapControls(), false, true);
-				if (updated || changed) {
-					ImageView all = (ImageView) waypointInfoBar.findViewById(R.id.waypoint_more);
-					ImageView remove = (ImageView) waypointInfoBar.findViewById(R.id.waypoint_close);
-					all.setOnClickListener(new OnClickListener() {
-						@Override
-						public void onClick(View view) {
-							map.hideContextAndRouteInfoMenues();
-							ShowAlongTheRouteBottomSheet fragment = new ShowAlongTheRouteBottomSheet();
-							Bundle args = new Bundle();
-							args.putInt(ShowAlongTheRouteBottomSheet.EXPAND_TYPE_KEY, pnt.type);
-							fragment.setArguments(args);
-							fragment.setUsedOnMap(true);
-							fragment.show(map.getSupportFragmentManager(), ShowAlongTheRouteBottomSheet.TAG);
-						}
-					});
-					remove.setOnClickListener(new OnClickListener() {
-						@Override
-						public void onClick(View view) {
-							waypointHelper.removeVisibleLocationPoint(pnt);
-							map.refreshMap();
-						}
-					});
-				}
-				return true;
-			}
-		}
-
-		public void setBackgroundResource(int boxTop) {
-			topBar.setBackgroundResource(boxTop);
-		}
-
-	}
-}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java
index 4ab6abb9d3a..45c83d1d221 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java
@@ -71,10 +71,10 @@ public boolean shouldShowTopCoordinatesWidget() {
 	}
 
 	public boolean shouldHideMapMarkersWidget() {
-		View addressTopBar = mapActivity.findViewById(R.id.map_top_bar);
+		View streetName = mapActivity.findViewById(R.id.street_name_widget);
 		return !settings.MARKERS_DISTANCE_INDICATION_ENABLED.get()
 				|| !settings.MAP_MARKERS_MODE.get().isToolbar()
-				|| addressTopBar != null && addressTopBar.getVisibility() == View.VISIBLE
+				|| streetName != null && streetName.getVisibility() == View.VISIBLE
 				|| routingHelper.isFollowingMode()
 				|| routingHelper.isRoutePlanningMode()
 				|| isMapRouteInfoMenuVisible()
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
index cf11d3fe21f..ab1a3800a33 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
@@ -5,6 +5,7 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.layers.base.OsmandMapLayer.DrawSettings;
 
@@ -16,6 +17,7 @@
 public abstract class MapWidget {
 
 	protected final OsmandApplication app;
+	protected final OsmandSettings settings;
 	protected final MapActivity mapActivity;
 	protected final UiUtilities iconsCache;
 
@@ -25,6 +27,7 @@ public abstract class MapWidget {
 
 	public MapWidget(@NonNull MapActivity mapActivity) {
 		this.app = mapActivity.getMyApplication();
+		this.settings = app.getSettings();
 		this.mapActivity = mapActivity;
 		this.iconsCache = app.getUIUtilities();
 		this.nightMode = app.getDaynightHelper().isNightMode();
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/StreetNameWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/StreetNameWidget.java
new file mode 100644
index 00000000000..e53970c5e0d
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/StreetNameWidget.java
@@ -0,0 +1,421 @@
+package net.osmand.plus.views.mapwidgets.widgets;
+
+import android.graphics.Bitmap;
+import android.graphics.Canvas;
+import android.graphics.Paint;
+import android.graphics.Typeface;
+import android.graphics.drawable.Drawable;
+import android.os.Bundle;
+import android.util.DisplayMetrics;
+import android.util.TypedValue;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import net.osmand.Location;
+import net.osmand.binary.BinaryMapRouteReaderAdapter.RouteTypeRule;
+import net.osmand.binary.RouteDataObject;
+import net.osmand.plus.OsmAndLocationProvider;
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.helpers.CurrentPositionHelper;
+import net.osmand.plus.helpers.WaypointDialogHelper;
+import net.osmand.plus.helpers.WaypointHelper;
+import net.osmand.plus.helpers.WaypointHelper.LocationPointWrapper;
+import net.osmand.plus.render.TextRenderer;
+import net.osmand.plus.routepreparationmenu.MapRouteInfoMenu;
+import net.osmand.plus.routepreparationmenu.ShowAlongTheRouteBottomSheet;
+import net.osmand.plus.routing.CurrentStreetName;
+import net.osmand.plus.routing.RouteCalculationResult.NextDirectionInfo;
+import net.osmand.plus.routing.RoutingHelper;
+import net.osmand.plus.routing.RoutingHelperUtils;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.views.layers.MapInfoLayer.TextState;
+import net.osmand.plus.views.layers.base.OsmandMapLayer.DrawSettings;
+import net.osmand.plus.views.mapwidgets.TurnDrawable;
+import net.osmand.render.RenderingRuleSearchRequest;
+import net.osmand.render.RenderingRulesStorage;
+import net.osmand.util.Algorithms;
+
+import androidx.annotation.ColorRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.appcompat.content.res.AppCompatResources;
+import androidx.core.content.ContextCompat;
+
+import static net.osmand.plus.render.OsmandRenderer.RenderingContext;
+import static net.osmand.plus.render.TextRenderer.TextDrawInfo;
+
+public class StreetNameWidget extends MapWidget {
+
+	private static final int MAX_MARKER_DISTANCE = 50;
+
+	private final WaypointHelper waypointHelper;
+	private LocationPointWrapper lastPoint;
+
+	private final TextView addressText;
+	private final TextView addressTextShadow;
+	private final TextView exitRefText;
+	private final ImageView shieldImage;
+	private final ImageView turnIcon;
+	private final View waypointInfoBar;
+
+	private final TurnDrawable turnDrawable;
+	private int shadowRadius;
+	private boolean showMarker;
+
+
+	@Override
+	protected int getLayoutId() {
+		return R.layout.street_name_widget;
+	}
+
+	public StreetNameWidget(@NonNull MapActivity mapActivity, @NonNull TextState textState) {
+		super(mapActivity);
+
+		waypointHelper = app.getWaypointHelper();
+
+		addressText = view.findViewById(R.id.map_address_text);
+		addressTextShadow = view.findViewById(R.id.map_address_text_shadow);
+		waypointInfoBar = view.findViewById(R.id.waypoint_info_bar);
+		exitRefText = view.findViewById(R.id.map_exit_ref);
+		shieldImage = view.findViewById(R.id.map_shield_icon);
+		turnIcon = view.findViewById(R.id.map_turn_icon);
+
+		turnDrawable = new TurnDrawable(mapActivity, true);
+
+		updateVisibility(false);
+		updateColors(isNightMode(), textState);
+	}
+
+	@Override
+	public void updateInfo(@Nullable DrawSettings drawSettings) {
+		StreetNameWidgetParams params = new StreetNameWidgetParams(mapActivity);
+		CurrentStreetName streetName = params.streetName;
+		int turnArrowColorId = params.turnArrowColorId;
+		boolean showClosestWaypointFirstInAddress = params.showClosestWaypointFirstInAddress;
+
+		if (turnArrowColorId != 0) {
+			turnDrawable.setColor(turnArrowColorId);
+		}
+
+		boolean hideStreetName = mapActivity.isTopToolbarActive()
+				|| mapActivity.shouldHideTopControls()
+				|| MapRouteInfoMenu.chooseRoutesVisible
+				|| MapRouteInfoMenu.waypointsVisible;
+		if (hideStreetName) {
+			updateVisibility(false);
+		} else if (showClosestWaypointFirstInAddress && updateWaypoint()) {
+			updateVisibility(true);
+			AndroidUiHelper.updateVisibility(addressText, false);
+			AndroidUiHelper.updateVisibility(addressTextShadow, false);
+			AndroidUiHelper.updateVisibility(turnIcon, false);
+			AndroidUiHelper.updateVisibility(shieldImage, false);
+			AndroidUiHelper.updateVisibility(exitRefText, false);
+		} else if (streetName == null) {
+			updateVisibility(false);
+		} else {
+			updateVisibility(true);
+			AndroidUiHelper.updateVisibility(waypointInfoBar, false);
+			AndroidUiHelper.updateVisibility(addressText, true);
+			AndroidUiHelper.updateVisibility(addressTextShadow, shadowRadius > 0);
+
+			RouteDataObject shieldObject = streetName.shieldObject;
+			if (shieldObject != null && shieldObject.nameIds != null && setRoadShield(shieldObject)) {
+				AndroidUiHelper.updateVisibility(shieldImage, true);
+				int indexOf = streetName.text.indexOf("»");
+				if (indexOf > 0) {
+					streetName.text = streetName.text.substring(indexOf);
+				}
+			} else {
+				AndroidUiHelper.updateVisibility(shieldImage, false);
+			}
+
+			if (Algorithms.isEmpty(streetName.exitRef)) {
+				AndroidUiHelper.updateVisibility(exitRefText, false);
+			} else {
+				exitRefText.setText(streetName.exitRef);
+				AndroidUiHelper.updateVisibility(exitRefText, true);
+			}
+
+			if (turnDrawable.setTurnType(streetName.turnType) || streetName.showMarker != showMarker) {
+				showMarker = streetName.showMarker;
+				if (streetName.turnType != null) {
+					turnIcon.invalidateDrawable(turnDrawable);
+					turnIcon.setImageDrawable(turnDrawable);
+					AndroidUiHelper.updateVisibility(turnIcon, true);
+				} else if (streetName.showMarker) {
+					Drawable marker = iconsCache.getIcon(R.drawable.ic_action_start_navigation, R.color.color_myloc_distance);
+					turnIcon.setImageDrawable(marker);
+					AndroidUiHelper.updateVisibility(turnIcon, true);
+				} else {
+					AndroidUiHelper.updateVisibility(turnIcon, false);
+				}
+			}
+			if (Algorithms.isEmpty(streetName.text)) {
+				addressTextShadow.setText("");
+				addressText.setText("");
+			} else if (!streetName.text.equals(addressText.getText().toString())) {
+				addressTextShadow.setText(streetName.text);
+				addressText.setText(streetName.text);
+			}
+		}
+	}
+
+	public boolean updateWaypoint() {
+		LocationPointWrapper point = waypointHelper.getMostImportantLocationPoint(null);
+		boolean changed = lastPoint != point;
+		lastPoint = point;
+		if (point == null) {
+			view.setOnClickListener(null);
+			AndroidUiHelper.updateVisibility(waypointInfoBar, false);
+			return false;
+		} else {
+			AndroidUiHelper.updateVisibility(addressText, false);
+			AndroidUiHelper.updateVisibility(addressTextShadow, false);
+			boolean updated = AndroidUiHelper.updateVisibility(waypointInfoBar, true);
+			// pass top bar to make it clickable
+			WaypointDialogHelper.updatePointInfoView(app, mapActivity, view, point, true,
+					isNightMode(), false, true);
+			if (updated || changed) {
+				ImageView moreButton = waypointInfoBar.findViewById(R.id.waypoint_more);
+				ImageView closeButton = waypointInfoBar.findViewById(R.id.waypoint_close);
+				moreButton.setOnClickListener(view -> {
+					mapActivity.hideContextAndRouteInfoMenues();
+					ShowAlongTheRouteBottomSheet fragment = new ShowAlongTheRouteBottomSheet();
+					Bundle args = new Bundle();
+					args.putInt(ShowAlongTheRouteBottomSheet.EXPAND_TYPE_KEY, point.type);
+					fragment.setArguments(args);
+					fragment.setUsedOnMap(true);
+					fragment.show(mapActivity.getSupportFragmentManager(), ShowAlongTheRouteBottomSheet.TAG);
+				});
+				closeButton.setOnClickListener(view -> {
+					waypointHelper.removeVisibleLocationPoint(point);
+					mapActivity.refreshMap();
+				});
+			}
+			return true;
+		}
+	}
+
+	private boolean setRoadShield(@NonNull RouteDataObject object) {
+		StringBuilder additional = new StringBuilder();
+		for (int i = 0; i < object.nameIds.length; i++) {
+			String key = object.region.routeEncodingRules.get(object.nameIds[i]).getTag();
+			String val = object.names.get(object.nameIds[i]);
+			if (!key.endsWith("_ref") && !key.startsWith("route_road")) {
+				additional.append(key).append("=").append(val).append(";");
+			}
+		}
+		for (int i = 0; i < object.nameIds.length; i++) {
+			String key = object.region.routeEncodingRules.get(object.nameIds[i]).getTag();
+			String val = object.names.get(object.nameIds[i]);
+			if (key.startsWith("route_road") && key.endsWith("_ref")) {
+				boolean visible = setRoadShield(object, key, val, additional);
+				if (visible) {
+					return true;
+				}
+			}
+		}
+		return false;
+	}
+
+	private boolean setRoadShield(@NonNull RouteDataObject object, @NonNull String nameTag,
+	                              @NonNull String name, @NonNull StringBuilder additional) {
+		int[] types = object.getTypes();
+		RenderingRulesStorage storage = app.getRendererRegistry().getCurrentSelectedRenderer();
+		RenderingRuleSearchRequest rreq = app.getResourceManager().getRenderer()
+				.getSearchRequestWithAppliedCustomRules(storage, isNightMode());
+
+		for (int type : types) {
+			RouteTypeRule routeTypeRule = object.region.quickGetEncodingRule(type);
+			String tag = routeTypeRule.getTag();
+			String value = routeTypeRule.getValue();
+			if (tag.equals("highway") || tag.equals("route")) {
+				rreq.setInitialTagValueZoom(tag, value, 13, null);
+			} else {
+				additional.append(tag).append("=").append(value).append(";");
+			}
+		}
+
+		rreq.setIntFilter(rreq.ALL.R_TEXT_LENGTH, name.length());
+		rreq.setStringFilter(rreq.ALL.R_NAME_TAG, nameTag);
+		rreq.setStringFilter(rreq.ALL.R_ADDITIONAL, additional.toString());
+		rreq.search(RenderingRulesStorage.TEXT_RULES);
+
+		RenderingContext rc = new RenderingContext(app);
+		TextRenderer textRenderer = new TextRenderer(app);
+		TextDrawInfo text = new TextDrawInfo(name);
+
+		int shieldRes = -1;
+		if (rreq.isSpecified(rreq.ALL.R_TEXT_SHIELD)) {
+			text.setShieldResIcon(rreq.getStringPropertyValue(rreq.ALL.R_TEXT_SHIELD));
+			shieldRes = app.getResources().getIdentifier("h_" + text.getShieldResIcon(),
+					"drawable", app.getPackageName());
+		}
+		if (shieldRes == -1) {
+			return false;
+		}
+
+		Drawable shield = AppCompatResources.getDrawable(mapActivity, shieldRes);
+		if (shield == null) {
+			return false;
+		}
+
+		float xSize = shield.getIntrinsicWidth();
+		float ySize = shield.getIntrinsicHeight();
+		float xyRatio = xSize / ySize;
+		//setting view propotions (height is fixed by toolbar size - 48dp);
+		int viewHeightPx = AndroidUtils.dpToPx(app, 48);
+		int viewWidthPx = (int) (viewHeightPx * xyRatio);
+
+		ViewGroup.LayoutParams params = shieldImage.getLayoutParams();
+		params.width = viewWidthPx;
+		shieldImage.setLayoutParams(params);
+
+		Bitmap bitmap = Bitmap.createBitmap((int) xSize, (int) ySize, Bitmap.Config.ARGB_8888);
+		Canvas canvas = new Canvas(bitmap);
+		Paint paint = setupTextPaint(textRenderer.getPaintText(), rreq);
+
+		float centerX = xSize / 2f;
+		float centerY = ySize / 2f - paint.getFontMetrics().ascent / 2f;
+		text.fillProperties(rc, rreq, centerX, centerY);
+		textRenderer.drawShieldIcon(rc, canvas, text, text.getShieldResIcon());
+		textRenderer.drawWrappedText(canvas, text, 20f);
+
+		shieldImage.setImageBitmap(bitmap);
+		return true;
+	}
+
+	@NonNull
+	private Paint setupTextPaint(@NonNull Paint paint, @NonNull RenderingRuleSearchRequest request) {
+		paint.setTypeface(Typeface.create(TextRenderer.DROID_SERIF, Typeface.BOLD));
+
+		if (request.isSpecified(request.ALL.R_TEXT_COLOR)) {
+			paint.setColor(request.getIntPropertyValue(request.ALL.R_TEXT_COLOR));
+		}
+
+		if (request.isSpecified(request.ALL.R_TEXT_SIZE)) {
+			float textSize = request.getFloatPropertyValue(request.ALL.R_TEXT_SIZE);
+			DisplayMetrics displayMetrics = app.getResources().getDisplayMetrics();
+			paint.setTextSize(TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, textSize, displayMetrics));
+		}
+
+		return paint;
+	}
+
+	public void updateColors(boolean nightMode, @NonNull TextState textState) {
+		setNightMode(nightMode);
+		shadowRadius = textState.textShadowRadius;
+
+		boolean portrait = AndroidUiHelper.isOrientationPortrait(mapActivity);
+		view.setBackgroundResource(portrait ? textState.boxTop : textState.boxFree);
+
+		TextView waypointText = view.findViewById(R.id.waypoint_text);
+		TextView waypointTextShadow = view.findViewById(R.id.waypoint_text_shadow);
+		TextInfoWidget.updateTextColor(addressText, addressTextShadow, textState.textColor,
+				textState.textShadowColor, textState.textBold, shadowRadius);
+		TextInfoWidget.updateTextColor(waypointText, waypointTextShadow, textState.textColor,
+				textState.textShadowColor, textState.textBold, shadowRadius / 2);
+
+		int exitRefTextColorId = nightMode
+				? R.color.text_color_primary_dark
+				: R.color.color_white;
+		exitRefText.setTextColor(ContextCompat.getColor(app, exitRefTextColorId));
+
+		ImageView moreImage = waypointInfoBar.findViewById(R.id.waypoint_more);
+		ImageView removeImage = waypointInfoBar.findViewById(R.id.waypoint_close);
+		moreImage.setImageDrawable(iconsCache.getIcon(R.drawable.ic_overflow_menu_white, nightMode));
+		removeImage.setImageDrawable(iconsCache.getIcon(R.drawable.ic_action_remove_dark, nightMode));
+	}
+
+	@Override
+	protected boolean updateVisibility(boolean visible) {
+		boolean updatedVisibility = super.updateVisibility(visible);
+		if (updatedVisibility) {
+			mapActivity.updateStatusBarColor();
+		}
+		return updatedVisibility;
+	}
+
+	private static class StreetNameWidgetParams {
+
+		private final OsmandApplication app;
+		private final OsmandSettings settings;
+		private final MapActivity mapActivity;
+		private final RoutingHelper routingHelper;
+
+		public CurrentStreetName streetName;
+		@ColorRes
+		public int turnArrowColorId;
+		public boolean showClosestWaypointFirstInAddress = true;
+
+		public StreetNameWidgetParams(@NonNull MapActivity mapActivity) {
+			this.app = mapActivity.getMyApplication();
+			this.mapActivity = mapActivity;
+			this.settings = app.getSettings();
+			this.routingHelper = app.getRoutingHelper();
+
+			computeParams();
+		}
+
+		private void computeParams() {
+			boolean widgetEnabled = settings.SHOW_STREET_NAME.get();
+			boolean onRoute = routingHelper.isRouteCalculated() && !routingHelper.isDeviatedFromRoute();
+			boolean mapLinkedToLocation = app.getMapViewTrackingUtilities().isMapLinkedToLocation();
+			if (onRoute) {
+				if (routingHelper.isFollowingMode()) {
+					if (widgetEnabled) {
+						NextDirectionInfo nextDirInfo =
+								routingHelper.getNextRouteDirectionInfo(new NextDirectionInfo(), true);
+						streetName = routingHelper.getCurrentName(nextDirInfo);
+						turnArrowColorId = R.color.nav_arrow;
+					}
+				} else {
+					int di = MapRouteInfoMenu.getDirectionInfo();
+					boolean routeMenuVisible = mapActivity.getMapRouteInfoMenu().isVisible();
+					if (di >= 0 && routeMenuVisible && di < routingHelper.getRouteDirections().size()) {
+						NextDirectionInfo nextDirectionInfo =
+								routingHelper.getNextRouteDirectionInfo(new NextDirectionInfo(), true);
+						streetName = routingHelper.getCurrentName(nextDirectionInfo);
+						turnArrowColorId = R.color.nav_arrow_distant;
+						showClosestWaypointFirstInAddress = false;
+					}
+				}
+			} else if (mapLinkedToLocation && widgetEnabled) {
+				streetName = new CurrentStreetName();
+				OsmAndLocationProvider locationProvider = app.getLocationProvider();
+				RouteDataObject lastKnownSegment = locationProvider.getLastKnownRouteSegment();
+				Location lastKnownLocation = locationProvider.getLastKnownLocation();
+				if (lastKnownSegment != null && lastKnownLocation != null) {
+					updateParamsByLastKnown(lastKnownSegment, lastKnownLocation);
+				}
+			}
+		}
+
+		private void updateParamsByLastKnown(@NonNull RouteDataObject lastKnownSegment,
+		                                     @NonNull Location lastKnownLocation) {
+			String preferredLocale = settings.MAP_PREFERRED_LOCALE.get();
+			boolean transliterateNames = settings.MAP_TRANSLITERATE_NAMES.get();
+			boolean direction = lastKnownSegment.bearingVsRouteDirection(lastKnownLocation);
+
+			String name = lastKnownSegment.getName(preferredLocale, transliterateNames);
+			String ref = lastKnownSegment.getRef(preferredLocale, transliterateNames, direction);
+			String destination = lastKnownSegment.getDestinationName(preferredLocale, transliterateNames, direction);
+
+			streetName.text = RoutingHelperUtils.formatStreetName(name, ref, destination, "»");
+			if (!Algorithms.isEmpty(streetName.text)) {
+				double dist = CurrentPositionHelper.getOrthogonalDistance(lastKnownSegment, lastKnownLocation);
+				if (dist < MAX_MARKER_DISTANCE) {
+					streetName.showMarker = true;
+				} else {
+					streetName.text = app.getString(R.string.shared_string_near) + " " + streetName.text;
+				}
+			}
+		}
+	}
+}
\ No newline at end of file
