diff --git a/OsmAnd/res/layout/default_map_button_fragment.xml b/OsmAnd/res/layout/default_map_button_fragment.xml
new file mode 100644
index 00000000000..3cc3bac631a
--- /dev/null
+++ b/OsmAnd/res/layout/default_map_button_fragment.xml
@@ -0,0 +1,24 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	android:layout_width="match_parent"
+	android:layout_height="match_parent"
+	android:clickable="true"
+	android:focusable="true"
+	android:orientation="vertical">
+
+	<include layout="@layout/simple_toolbar" />
+
+	<ScrollView
+		android:layout_width="match_parent"
+		android:layout_height="match_parent"
+		android:background="?attr/activity_background_basic">
+
+		<LinearLayout
+			android:id="@+id/cards_container"
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:orientation="vertical" />
+
+	</ScrollView>
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/fragment_map_context_menu.xml b/OsmAnd/res/layout/fragment_map_context_menu.xml
index 9da64feb614..b7f51aab25c 100644
--- a/OsmAnd/res/layout/fragment_map_context_menu.xml
+++ b/OsmAnd/res/layout/fragment_map_context_menu.xml
@@ -622,21 +622,21 @@
 			android:visibility="gone"
 			tools:visibility="visible">
 
-			<ImageButton
+			<net.osmand.plus.views.controls.maphudbuttons.ZoomInButton
 				android:id="@+id/context_menu_zoom_in_button"
 				android:layout_width="@dimen/map_button_size"
 				android:layout_height="@dimen/map_button_size"
-				android:background="@drawable/btn_circle"
 				android:contentDescription="@string/zoomIn"
+				tools:background="@drawable/btn_circle"
 				tools:src="@drawable/ic_action_remove_dark" />
 
-			<ImageButton
+			<net.osmand.plus.views.controls.maphudbuttons.ZoomOutButton
 				android:id="@+id/context_menu_zoom_out_button"
 				android:layout_width="@dimen/map_button_size"
 				android:layout_height="@dimen/map_button_size"
 				android:layout_marginTop="@dimen/map_button_spacing"
-				android:background="@drawable/btn_circle"
 				android:contentDescription="@string/zoomOut"
+				tools:background="@drawable/btn_circle"
 				tools:src="@drawable/ic_action_remove_dark" />
 
 		</LinearLayout>
diff --git a/OsmAnd/res/layout/map_button_appearance_fragment.xml b/OsmAnd/res/layout/map_button_appearance_fragment.xml
index ea24ff26ea1..3e6d852269f 100644
--- a/OsmAnd/res/layout/map_button_appearance_fragment.xml
+++ b/OsmAnd/res/layout/map_button_appearance_fragment.xml
@@ -1,7 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
 	xmlns:app="http://schemas.android.com/apk/res-auto"
-	xmlns:tools="http://schemas.android.com/tools"
 	android:layout_width="match_parent"
 	android:layout_height="match_parent"
 	android:clickable="true"
@@ -25,26 +24,11 @@
 				android:orientation="vertical"
 				android:paddingBottom="@dimen/dialog_button_ex_height">
 
-				<FrameLayout
-					android:id="@+id/button_container"
-					android:layout_width="match_parent"
-					android:layout_height="@dimen/map_button_appearance_image_height"
-					android:paddingHorizontal="@dimen/map_alarm_text_top_padding"
-					android:paddingVertical="@dimen/content_padding"
-					tools:background="#103866">
-
-					<include
-						layout="@layout/map_quick_actions_button"
-						android:layout_width="wrap_content"
-						android:layout_height="wrap_content"
-						android:layout_gravity="center" />
-
-				</FrameLayout>
-
 				<LinearLayout
 					android:id="@+id/cards_container"
 					android:layout_width="match_parent"
 					android:layout_height="wrap_content"
+					android:background="?attr/card_and_list_background_basic"
 					android:orientation="vertical" />
 
 				<include layout="@layout/card_bottom_divider" />
diff --git a/OsmAnd/res/layout/map_button_card.xml b/OsmAnd/res/layout/map_button_card.xml
new file mode 100644
index 00000000000..5ac5e23fb5f
--- /dev/null
+++ b/OsmAnd/res/layout/map_button_card.xml
@@ -0,0 +1,10 @@
+<?xml version="1.0" encoding="utf-8"?>
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:id="@+id/map_button_container"
+	android:layout_width="match_parent"
+	android:layout_height="@dimen/map_button_appearance_image_height"
+	android:minHeight="@dimen/map_button_appearance_image_height"
+	android:paddingHorizontal="@dimen/map_alarm_text_top_padding"
+	android:paddingVertical="@dimen/content_padding"
+	tools:background="#103866" />
\ No newline at end of file
diff --git a/OsmAnd/res/layout/map_button_visibility_card.xml b/OsmAnd/res/layout/map_button_visibility_card.xml
new file mode 100644
index 00000000000..66adb89c497
--- /dev/null
+++ b/OsmAnd/res/layout/map_button_visibility_card.xml
@@ -0,0 +1,30 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:layout_width="match_parent"
+	android:layout_height="match_parent"
+	android:background="?attr/card_and_list_background_basic"
+	android:orientation="vertical">
+
+	<net.osmand.plus.widgets.TextViewEx
+		android:id="@+id/title"
+		style="@style/TitleStyle"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:gravity="center_vertical"
+		android:minHeight="@dimen/bottom_sheet_selected_item_title_height"
+		android:paddingHorizontal="@dimen/content_padding"
+		android:paddingVertical="@dimen/content_padding_small"
+		tools:text="@string/key_event_action_change_map_orientation" />
+
+	<View
+		android:layout_width="match_parent"
+		android:layout_height="1dp"
+		android:layout_marginStart="@dimen/content_padding"
+		android:background="?attr/divider_color_basic" />
+
+	<include
+		android:id="@+id/visibility_button"
+		layout="@layout/configure_screen_list_item" />
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index 37eb7f4566c..1d8a8454f80 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -10,6 +10,15 @@
 	- For wording and consistency, please note https://docs.osmand.net/docs/technical/contributions/translating-osmand
 	Thx - Hardy
 -->
+    <string name="raster_layers_action_descr">Change raster layers</string>
+    <string name="contour_layers_action_descr">Change contour layers</string>
+    <string name="change_zoom_action_descr">Change map zoom.</string>
+    <string name="search_action_descr">Opens Search.</string>
+    <string name="navigation_action_descr">Opens Navigation.</string>
+    <string name="my_location_action_descr">Centers map on your current location.</string>
+    <string name="map_3d_mode_action_descr">Change map tilt.</string>
+    <string name="drawer_button_description">Opens the main menu.</string>
+    <string name="configure_map_description">Change map style, layers, or other settings.</string>
     <string name="background_opacity">Background opacity</string>
     <string name="corner_radius">Corner radius</string>
     <string name="shared_string_dp">dp</string>
diff --git a/OsmAnd/src/net/osmand/plus/quickaction/MapButtonAppearanceFragment.java b/OsmAnd/src/net/osmand/plus/quickaction/MapButtonAppearanceFragment.java
index 7d66c3c4ee7..5ca177ff33b 100644
--- a/OsmAnd/src/net/osmand/plus/quickaction/MapButtonAppearanceFragment.java
+++ b/OsmAnd/src/net/osmand/plus/quickaction/MapButtonAppearanceFragment.java
@@ -1,7 +1,5 @@
 package net.osmand.plus.quickaction;
 
-import static net.osmand.plus.quickaction.AddQuickActionFragment.QUICK_ACTION_BUTTON_KEY;
-
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -19,32 +17,31 @@
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.base.BaseOsmAndFragment;
+import net.osmand.plus.card.icon.OnIconsPaletteListener;
 import net.osmand.plus.helpers.AndroidUiHelper;
-import net.osmand.plus.render.MapRenderRepositories;
 import net.osmand.plus.routepreparationmenu.cards.BaseCard;
 import net.osmand.plus.routepreparationmenu.cards.BaseCard.CardListener;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
-import net.osmand.plus.views.controls.maphudbuttons.QuickActionButton;
-import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;
+import net.osmand.plus.views.mapwidgets.configure.buttons.MapButtonCard;
+import net.osmand.plus.views.mapwidgets.configure.buttons.MapButtonState;
 import net.osmand.plus.widgets.dialogbutton.DialogButton;
-import net.osmand.render.RenderingRuleSearchRequest;
-import net.osmand.render.RenderingRulesStorage;
 import net.osmand.util.Algorithms;
 
-import org.jetbrains.annotations.NotNull;
-
 import java.util.ArrayList;
 import java.util.List;
 
-public class MapButtonAppearanceFragment extends BaseOsmAndFragment implements CardListener {
+public class MapButtonAppearanceFragment extends BaseOsmAndFragment implements CardListener, OnIconsPaletteListener<String> {
 
 	public static final String TAG = MapButtonAppearanceFragment.class.getSimpleName();
 
+	public static final String MAP_BUTTON_KEY = "map_button_key";
+
 	private List<BaseCard> cards;
 	private DialogButton applyButton;
-	private QuickActionButton actionButton;
-	private QuickActionButtonState buttonState;
+	private MapButtonState buttonState;
+	private MapButtonCard mapButtonCard;
+	private MapButtonIconController iconController;
 
 	private ButtonAppearanceParams appearanceParams;
 	private ButtonAppearanceParams originalAppearanceParams;
@@ -64,9 +61,9 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 
 		Bundle args = requireArguments();
-		String key = args.getString(QUICK_ACTION_BUTTON_KEY);
+		String key = args.getString(MAP_BUTTON_KEY);
 		if (key != null) {
-			buttonState = app.getMapButtonsHelper().getButtonStateById(key);
+			buttonState = app.getMapButtonsHelper().getMapButtonStateById(key);
 		}
 		if (buttonState != null) {
 			appearanceParams = buttonState.createAppearanceParams();
@@ -75,6 +72,7 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 			if (savedInstanceState != null) {
 				appearanceParams.readBundle(savedInstanceState);
 			}
+			iconController = MapButtonIconController.getInstance(app, buttonState, appearanceParams, this);
 		}
 	}
 
@@ -86,7 +84,6 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c
 		AndroidUtils.addStatusBarPadding21v(requireMyActivity(), view);
 
 		setupToolbar(view);
-		setupActionButton(view);
 		setupCards(view);
 		setupApplyButton(view);
 
@@ -119,48 +116,25 @@ private void setupToolbar(@NonNull View view) {
 		AndroidUiHelper.updateVisibility(resetButton, true);
 	}
 
-	private void setupActionButton(@NonNull View view) {
-		ViewGroup container = view.findViewById(R.id.button_container);
-		actionButton = container.findViewById(R.id.map_quick_actions_button);
-		actionButton.setButtonState(buttonState);
-		actionButton.setCustomAppearanceParams(appearanceParams);
-		setupButtonBackground(container);
-	}
-
-	private void setupButtonBackground(@NonNull View view) {
-		RenderingRulesStorage renderer = app.getRendererRegistry().getCurrentSelectedRenderer();
-		if (renderer != null) {
-			MapRenderRepositories maps = app.getResourceManager().getRenderer();
-			RenderingRuleSearchRequest request = maps.getSearchRequestWithAppliedCustomRules(renderer, nightMode);
-			if (request.searchRenderingAttribute("waterColor")) {
-				int color = request.getIntPropertyValue(renderer.PROPS.R_ATTR_COLOR_VALUE);
-				if (color != -1) {
-					view.setBackgroundColor(color);
-				}
-			}
-		}
-	}
-
 	private void setupCards(@NonNull View view) {
 		cards = new ArrayList<>();
 		MapActivity activity = requireMapActivity();
 		ViewGroup container = view.findViewById(R.id.cards_container);
 		container.removeAllViews();
 
-		addCard(container, new ButtonIconsCard(activity, buttonState, appearanceParams), false);
-		addCard(container, new CornerRadiusCard(activity, appearanceParams), false);
-		addCard(container, new ButtonSizeCard(activity, appearanceParams), false);
-		addCard(container, new OpacitySliderCard(activity, appearanceParams), true);
+		mapButtonCard = new MapButtonCard(activity, buttonState, appearanceParams);
+		addCard(container, mapButtonCard);
+		addCard(container, new CornerRadiusCard(activity, appearanceParams));
+		container.addView(themedInflater.inflate(R.layout.simple_divider_item, container, false));
+		addCard(container, new ButtonSizeCard(activity, appearanceParams));
+		container.addView(themedInflater.inflate(R.layout.simple_divider_item, container, false));
+		addCard(container, new OpacitySliderCard(activity, appearanceParams));
 	}
 
-	private void addCard(@NonNull ViewGroup container, @NonNull BaseCard card, boolean lastItem) {
+	private void addCard(@NonNull ViewGroup container, @NonNull BaseCard card) {
 		cards.add(card);
 		card.setListener(this);
 		container.addView(card.build());
-
-		if (!lastItem) {
-			container.addView(themedInflater.inflate(R.layout.simple_divider_item, container, false));
-		}
 	}
 
 	private void setupApplyButton(@NonNull View view) {
@@ -194,15 +168,17 @@ private void updateCards() {
 	}
 
 	private void updateButtons() {
-		actionButton.update(nightMode, true);
+		mapButtonCard.updateButton();
 		applyButton.setEnabled(!Algorithms.objectEquals(originalAppearanceParams, appearanceParams));
 	}
 
 	private void resetAppearance() {
-		appearanceParams.setIconName(buttonState.getIconPref().getDefaultValue());
-		appearanceParams.setSize(buttonState.getSizePref().getDefaultValue());
-		appearanceParams.setOpacity(buttonState.getOpacityPref().getDefaultValue());
-		appearanceParams.setCornerRadius(buttonState.getCornerRadiusPref().getDefaultValue());
+		ButtonAppearanceParams defaultParams = buttonState.createDefaultAppearanceParams();
+		appearanceParams.setIconName(defaultParams.getIconName());
+		appearanceParams.setSize(defaultParams.getSize());
+		appearanceParams.setOpacity(defaultParams.getOpacity());
+		appearanceParams.setCornerRadius(defaultParams.getCornerRadius());
+		iconController.update();
 		updateContent();
 	}
 
@@ -211,6 +187,18 @@ public void onCardPressed(@NonNull BaseCard card) {
 		updateButtons();
 	}
 
+	@Override
+	public void onIconSelectedFromPalette(@NonNull String iconName) {
+		appearanceParams.setIconName(iconName);
+		updateButtons();
+	}
+
+	@Override
+	public void onSaveInstanceState(@NonNull Bundle outState) {
+		super.onSaveInstanceState(outState);
+		appearanceParams.saveToBundle(outState);
+	}
+
 	@Override
 	public void onResume() {
 		super.onResume();
@@ -232,9 +220,13 @@ public void onPause() {
 	}
 
 	@Override
-	public void onSaveInstanceState(@NonNull @NotNull Bundle outState) {
-		super.onSaveInstanceState(outState);
-		appearanceParams.saveToBundle(outState);
+	public void onDestroy() {
+		super.onDestroy();
+
+		FragmentActivity activity = getActivity();
+		if (activity != null && !activity.isChangingConfigurations()) {
+			MapButtonIconController.onDestroy(app);
+		}
 	}
 
 	@Nullable
@@ -252,17 +244,14 @@ public MapActivity requireMapActivity() {
 		return (MapActivity) activity;
 	}
 
-	public static void showInstance(@NonNull FragmentManager manager, @NonNull QuickActionButtonState buttonState) {
+	public static void showInstance(@NonNull FragmentManager manager, @NonNull MapButtonState buttonState) {
 		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 			Bundle args = new Bundle();
-			args.putString(QUICK_ACTION_BUTTON_KEY, buttonState.getId());
+			args.putString(MAP_BUTTON_KEY, buttonState.getId());
 
 			MapButtonAppearanceFragment fragment = new MapButtonAppearanceFragment();
 			fragment.setArguments(args);
-			manager.beginTransaction()
-					.add(R.id.fragmentContainer, fragment, TAG)
-					.addToBackStack(TAG)
-					.commitAllowingStateLoss();
+			manager.beginTransaction().replace(R.id.fragmentContainer, fragment, TAG).addToBackStack(TAG).commitAllowingStateLoss();
 		}
 	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/quickaction/MapButtonsHelper.java b/OsmAnd/src/net/osmand/plus/quickaction/MapButtonsHelper.java
index 79325e53ef0..aec40ca2590 100644
--- a/OsmAnd/src/net/osmand/plus/quickaction/MapButtonsHelper.java
+++ b/OsmAnd/src/net/osmand/plus/quickaction/MapButtonsHelper.java
@@ -14,39 +14,20 @@
 import net.osmand.OsmAndCollator;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
-import net.osmand.plus.configmap.routes.actions.ShowHideCycleRoutesAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideDifficultyClassificationAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideFitnessTrailsAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideHikingRoutesAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideHorseRoutesAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideMtbRoutesAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideRunningRoutesAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideSkiSlopesAction;
-import net.osmand.plus.configmap.routes.actions.ShowHideWhitewaterSportsAction;
+import net.osmand.plus.configmap.routes.actions.*;
 import net.osmand.plus.plugins.PluginsHelper;
 import net.osmand.plus.plugins.mapillary.ShowHideMapillaryAction;
 import net.osmand.plus.quickaction.actions.*;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
-import net.osmand.plus.views.mapwidgets.configure.buttons.CompassButtonState;
-import net.osmand.plus.views.mapwidgets.configure.buttons.Map3DButtonState;
-import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;
+import net.osmand.plus.views.mapwidgets.configure.buttons.*;
 import net.osmand.util.Algorithms;
 
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
 import java.lang.reflect.Field;
 import java.lang.reflect.Type;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.HashMap;
-import java.util.HashSet;
-import java.util.LinkedHashSet;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-import java.util.TreeMap;
-import java.util.TreeSet;
+import java.util.*;
 
 /**
  * Created by rosty on 12/27/16.
@@ -106,8 +87,8 @@ public static List<QuickActionType> collectQuickActionCategoryType(Class<?> type
 	}
 
 	@Nullable
-	public QuickActionType getCategoryActionTypeFromId(int typeId) {
-		for (QuickActionType type : collectQuickActionCategoryType(this.getClass())) {
+	public static QuickActionType getCategoryActionTypeFromId(int typeId) {
+		for (QuickActionType type : collectQuickActionCategoryType(MapButtonsHelper.class)) {
 			if (type.getCategory() == typeId) {
 				return type;
 			}
@@ -121,8 +102,15 @@ public QuickActionType getCategoryActionTypeFromId(int typeId) {
 	private final Gson gson = new GsonBuilder().registerTypeAdapter(QuickAction.class, serializer).create();
 
 	private Map3DButtonState map3DButtonState;
+	private MyLocationButtonState myLocationButtonState;
+	private NavigationMenuButtonState navigationMenuButtonState;
+	private QuickSearchButtonState quickSearchButtonState;
+	private ZoomInButtonState zoomInButtonState;
+	private ZoomOutButtonState zoomOutButtonState;
+	private ConfigureMapButtonState configureMapButtonState;
+	private DrawerMenuButtonState drawerMenuButtonState;
 	private CompassButtonState compassButtonState;
-	private List<QuickActionButtonState> mapButtonStates = new ArrayList<>();
+	private List<QuickActionButtonState> quickActionStates = new ArrayList<>();
 
 	private List<QuickActionType> enabledTypes = new ArrayList<>();
 	private Map<Integer, QuickActionType> quickActionTypesInt = new TreeMap<>();
@@ -138,8 +126,15 @@ public MapButtonsHelper(@NonNull OsmandApplication app) {
 	}
 
 	private void initDefaultButtons() {
-		map3DButtonState = new Map3DButtonState(app);
 		compassButtonState = new CompassButtonState(app);
+		configureMapButtonState = new ConfigureMapButtonState(app);
+		drawerMenuButtonState = new DrawerMenuButtonState(app);
+		map3DButtonState = new Map3DButtonState(app);
+		myLocationButtonState = new MyLocationButtonState(app);
+		navigationMenuButtonState = new NavigationMenuButtonState(app);
+		quickSearchButtonState = new QuickSearchButtonState(app);
+		zoomInButtonState = new ZoomInButtonState(app);
+		zoomOutButtonState = new ZoomOutButtonState(app);
 	}
 
 	public void addUpdatesListener(@NonNull QuickActionUpdatesListener listener) {
@@ -170,15 +165,58 @@ public CompassButtonState getCompassButtonState() {
 		return compassButtonState;
 	}
 
+	@NonNull
+	public MyLocationButtonState getMyLocationButtonState() {
+		return myLocationButtonState;
+	}
+
+	@NonNull
+	public NavigationMenuButtonState getNavigationMenuButtonState() {
+		return navigationMenuButtonState;
+	}
+
+	@NonNull
+	public QuickSearchButtonState getQuickSearchButtonState() {
+		return quickSearchButtonState;
+	}
+
+	@NonNull
+	public ZoomInButtonState getZoomInButtonState() {
+		return zoomInButtonState;
+	}
+
+	@NonNull
+	public ZoomOutButtonState getZoomOutButtonState() {
+		return zoomOutButtonState;
+	}
+
+	@NonNull
+	public ConfigureMapButtonState getConfigureMapButtonState() {
+		return configureMapButtonState;
+	}
+
+	@NonNull
+	public DrawerMenuButtonState getDrawerMenuButtonState() {
+		return drawerMenuButtonState;
+	}
+
 	@NonNull
 	public List<QuickActionButtonState> getButtonsStates() {
-		return mapButtonStates;
+		return quickActionStates;
+	}
+
+	@NonNull
+	public List<MapButtonState> getDefaultButtonsStates() {
+		return Arrays.asList(configureMapButtonState, quickSearchButtonState,
+				compassButtonState, drawerMenuButtonState, navigationMenuButtonState,
+				map3DButtonState, myLocationButtonState, zoomInButtonState, zoomOutButtonState
+		);
 	}
 
 	@NonNull
 	public List<QuickAction> getFlattenedQuickActions() {
 		List<QuickAction> actions = new ArrayList<>();
-		for (QuickActionButtonState buttonState : mapButtonStates) {
+		for (QuickActionButtonState buttonState : quickActionStates) {
 			actions.addAll(buttonState.getQuickActions());
 		}
 		return actions;
@@ -187,7 +225,7 @@ public List<QuickAction> getFlattenedQuickActions() {
 	@NonNull
 	public List<QuickActionButtonState> getEnabledButtonsStates() {
 		List<QuickActionButtonState> list = new ArrayList<>();
-		for (QuickActionButtonState buttonState : mapButtonStates) {
+		for (QuickActionButtonState buttonState : quickActionStates) {
 			if (buttonState.isEnabled()) {
 				list.add(buttonState);
 			}
@@ -294,7 +332,7 @@ public String generateUniqueButtonName(@NonNull String name) {
 	}
 
 	public boolean hasEnabledButtons() {
-		for (QuickActionButtonState buttonState : mapButtonStates) {
+		for (QuickActionButtonState buttonState : quickActionStates) {
 			if (buttonState.isEnabled()) {
 				return true;
 			}
@@ -374,7 +412,7 @@ public void updateActionTypes() {
 	}
 
 	public void updateActiveActions() {
-		mapButtonStates = createButtonsStates();
+		quickActionStates = createButtonsStates();
 	}
 
 	@NonNull
@@ -453,8 +491,8 @@ public void filterQuickActions(@Nullable QuickActionButtonState buttonState,
 	}
 
 	private void filterQuickActions(@Nullable QuickActionButtonState buttonState,
-									@NonNull QuickActionType filter,
-									@NonNull Map<QuickActionType, List<QuickActionType>> actionTypes) {
+	                                @NonNull QuickActionType filter,
+	                                @NonNull Map<QuickActionType, List<QuickActionType>> actionTypes) {
 		List<QuickActionType> categoryActions = actionTypes.get(filter);
 		if (categoryActions == null) {
 			categoryActions = new ArrayList<>();
@@ -508,7 +546,7 @@ public boolean isActionButtonNameUnique(@NonNull String name) {
 
 	@Nullable
 	public QuickActionButtonState getButtonStateByName(@NonNull String name) {
-		for (QuickActionButtonState buttonState : mapButtonStates) {
+		for (QuickActionButtonState buttonState : quickActionStates) {
 			if (Algorithms.stringsEqual(buttonState.getName(), name)) {
 				return buttonState;
 			}
@@ -517,8 +555,8 @@ public QuickActionButtonState getButtonStateByName(@NonNull String name) {
 	}
 
 	@Nullable
-	public QuickActionButtonState getButtonStateById(@NonNull String id) {
-		for (QuickActionButtonState buttonState : mapButtonStates) {
+	public QuickActionButtonState getActionButtonStateById(@NonNull String id) {
+		for (QuickActionButtonState buttonState : quickActionStates) {
 			if (Algorithms.stringsEqual(buttonState.getId(), id)) {
 				return buttonState;
 			}
@@ -526,10 +564,20 @@ public QuickActionButtonState getButtonStateById(@NonNull String id) {
 		return null;
 	}
 
+	@Nullable
+	public MapButtonState getMapButtonStateById(@NonNull String id) {
+		for (MapButtonState buttonState : getDefaultButtonsStates()) {
+			if (Algorithms.stringsEqual(buttonState.getId(), id)) {
+				return buttonState;
+			}
+		}
+		return getActionButtonStateById(id);
+	}
+
 	@Nullable
 	public QuickActionButtonState getButtonStateByAction(@NonNull QuickAction action) {
 		long id = action.getId();
-		for (QuickActionButtonState buttonState : mapButtonStates) {
+		for (QuickActionButtonState buttonState : quickActionStates) {
 			if (buttonState.getQuickAction(id) != null) {
 				return buttonState;
 			}
@@ -555,7 +603,7 @@ public void removeQuickActionButtonState(@NonNull QuickActionButtonState buttonS
 		notifyUpdates();
 	}
 
-	public void setQuickActionButtonStates(@NonNull Collection<QuickActionButtonState> buttonStates) {
+	public void setQuickActionStates(@NonNull Collection<QuickActionButtonState> buttonStates) {
 		settings.QUICK_ACTION_BUTTONS.clearAll();
 		for (QuickActionButtonState state : buttonStates) {
 			settings.QUICK_ACTION_BUTTONS.addValue(state.getId());
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/DefaultMapButtonFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/DefaultMapButtonFragment.java
new file mode 100644
index 00000000000..383cb2de33a
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/DefaultMapButtonFragment.java
@@ -0,0 +1,237 @@
+package net.osmand.plus.views.mapwidgets.configure.buttons;
+
+import static net.osmand.plus.quickaction.MapButtonAppearanceFragment.MAP_BUTTON_KEY;
+
+import android.content.Context;
+import android.os.Bundle;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.appcompat.widget.Toolbar;
+import androidx.core.view.ViewCompat;
+import androidx.fragment.app.FragmentActivity;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.base.BaseOsmAndFragment;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet;
+import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet.CopyAppModePrefsListener;
+import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+import net.osmand.plus.routepreparationmenu.cards.BaseCard.CardListener;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.enums.CompassVisibility;
+import net.osmand.plus.settings.enums.Map3DModeVisibility;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.CompassVisibilityBottomSheet.CompassVisibilityUpdateListener;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.Map3DModeBottomSheet.Map3DModeUpdateListener;
+import net.osmand.plus.widgets.popup.PopUpMenu;
+import net.osmand.plus.widgets.popup.PopUpMenuDisplayData;
+import net.osmand.plus.widgets.popup.PopUpMenuItem;
+
+import org.jetbrains.annotations.NotNull;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class DefaultMapButtonFragment extends BaseOsmAndFragment implements CopyAppModePrefsListener,
+		Map3DModeUpdateListener, CompassVisibilityUpdateListener, CardListener {
+
+	public static final String TAG = DefaultMapButtonFragment.class.getSimpleName();
+
+	private List<BaseCard> cards;
+	private MapButtonState buttonState;
+
+	public boolean getContentStatusBarNightMode() {
+		return nightMode;
+	}
+
+	@Override
+	public int getStatusBarColorId() {
+		AndroidUiHelper.setStatusBarContentColor(getView(), nightMode);
+		return ColorUtilities.getListBgColorId(nightMode);
+	}
+
+	@Override
+	public void onCreate(@Nullable Bundle savedInstanceState) {
+		super.onCreate(savedInstanceState);
+
+		Bundle args = requireArguments();
+		String key = args.getString(MAP_BUTTON_KEY);
+		if (key != null) {
+			buttonState = app.getMapButtonsHelper().getMapButtonStateById(key);
+		}
+	}
+
+	@Nullable
+	@Override
+	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+		updateNightMode();
+		View view = themedInflater.inflate(R.layout.default_map_button_fragment, container, false);
+		AndroidUtils.addStatusBarPadding21v(requireMyActivity(), view);
+
+		setupToolbar(view);
+		setupCards(view);
+
+		return view;
+	}
+
+	private void setupToolbar(@NonNull View view) {
+		Toolbar toolbar = view.findViewById(R.id.toolbar);
+		ViewCompat.setElevation(view.findViewById(R.id.appbar), 5.0f);
+		toolbar.setBackgroundColor(ColorUtilities.getAppBarSecondaryColor(view.getContext(), nightMode));
+
+		TextView title = toolbar.findViewById(R.id.toolbar_title);
+		title.setText(buttonState.getName());
+		title.setTextColor(ColorUtilities.getPrimaryTextColor(view.getContext(), nightMode));
+
+		ImageView closeButton = toolbar.findViewById(R.id.close_button);
+		closeButton.setImageDrawable(getContentIcon(AndroidUtils.getNavigationIconResId(view.getContext())));
+		closeButton.setOnClickListener(v -> {
+			FragmentActivity activity = getActivity();
+			if (activity != null) {
+				activity.onBackPressed();
+			}
+		});
+		ImageView resetButton = toolbar.findViewById(R.id.action_button);
+		resetButton.setOnClickListener(this::showOptionsMenu);
+		resetButton.setImageDrawable(getContentIcon(R.drawable.ic_overflow_menu_white));
+		resetButton.setContentDescription(getString(R.string.shared_string_more));
+		AndroidUiHelper.updateVisibility(resetButton, true);
+	}
+
+	private void setupCards(@NonNull View view) {
+		cards = new ArrayList<>();
+		MapActivity activity = requireMapActivity();
+		ViewGroup container = view.findViewById(R.id.cards_container);
+		container.removeAllViews();
+
+		addCard(container, new MapButtonCard(activity, buttonState, null));
+		addCard(container, new MapButtonVisibilityCard(activity, buttonState, this));
+		container.addView(themedInflater.inflate(R.layout.list_item_divider, container, false));
+		addCard(container, new MapButtonAppearanceCard(activity, buttonState));
+		container.addView(themedInflater.inflate(R.layout.card_bottom_divider, container, false));
+	}
+
+	private void addCard(@NonNull ViewGroup container, @NonNull BaseCard card) {
+		cards.add(card);
+		card.setListener(this);
+		container.addView(card.build());
+	}
+
+	private void updateCards() {
+		for (BaseCard card : cards) {
+			card.update();
+		}
+	}
+
+	private void showOptionsMenu(@NonNull View view) {
+		Context context = view.getContext();
+		List<PopUpMenuItem> items = new ArrayList<>();
+
+		items.add(new PopUpMenuItem.Builder(context)
+				.setTitleId(R.string.reset_to_default)
+				.setIcon(getContentIcon(R.drawable.ic_action_reset))
+				.setOnClickListener(v -> resetToDefault()).create());
+
+		items.add(new PopUpMenuItem.Builder(context)
+				.setTitleId(R.string.copy_from_other_profile)
+				.setIcon(getContentIcon(R.drawable.ic_action_copy))
+				.setOnClickListener(v -> {
+					FragmentActivity activity = getActivity();
+					if (activity != null) {
+						ApplicationMode appMode = settings.getApplicationMode();
+						FragmentManager manager = activity.getSupportFragmentManager();
+						SelectCopyAppModeBottomSheet.showInstance(manager, this, appMode);
+					}
+				}).create());
+
+		PopUpMenuDisplayData displayData = new PopUpMenuDisplayData();
+		displayData.anchorView = view;
+		displayData.menuItems = items;
+		displayData.nightMode = nightMode;
+		PopUpMenu.show(displayData);
+	}
+
+	private void resetToDefault() {
+		buttonState.resetToDefault(settings.getApplicationMode());
+		updateCards();
+	}
+
+	@Override
+	public void copyAppModePrefs(@NonNull ApplicationMode fromMode) {
+		buttonState.copyForMode(fromMode, settings.getApplicationMode());
+		updateCards();
+	}
+
+	@Override
+	public void onMap3DModeUpdated(@NonNull Map3DModeVisibility visibility) {
+		updateCards();
+	}
+
+	@Override
+	public void onCompassVisibilityUpdated(@NonNull CompassVisibility visibility) {
+		updateCards();
+	}
+
+	@Override
+	public void onCardPressed(@NonNull @NotNull BaseCard card) {
+		updateCards();
+	}
+
+	@Override
+	public void onResume() {
+		super.onResume();
+
+		MapActivity activity = getMapActivity();
+		if (activity != null) {
+			activity.disableDrawer();
+		}
+	}
+
+	@Override
+	public void onPause() {
+		super.onPause();
+
+		MapActivity activity = getMapActivity();
+		if (activity != null) {
+			activity.enableDrawer();
+		}
+	}
+
+	@Nullable
+	public MapActivity getMapActivity() {
+		FragmentActivity activity = getActivity();
+		return activity instanceof MapActivity ? ((MapActivity) activity) : null;
+	}
+
+	@NonNull
+	public MapActivity requireMapActivity() {
+		FragmentActivity activity = getActivity();
+		if (!(activity instanceof MapActivity)) {
+			throw new IllegalStateException("Fragment " + this + " not attached to an activity.");
+		}
+		return (MapActivity) activity;
+	}
+
+	public static void showInstance(@NonNull FragmentManager manager, @NonNull MapButtonState buttonState) {
+		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
+			Bundle args = new Bundle();
+			args.putString(MAP_BUTTON_KEY, buttonState.getId());
+
+			DefaultMapButtonFragment fragment = new DefaultMapButtonFragment();
+			fragment.setArguments(args);
+			manager.beginTransaction()
+					.replace(R.id.fragmentContainer, fragment, TAG)
+					.addToBackStack(TAG)
+					.commitAllowingStateLoss();
+		}
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/DefaultMapButtonsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/DefaultMapButtonsFragment.java
index 3f988336ee7..66a8b29b750 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/DefaultMapButtonsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/DefaultMapButtonsFragment.java
@@ -14,17 +14,10 @@
 import net.osmand.plus.R;
 import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet;
-import net.osmand.plus.quickaction.MapButtonsHelper;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.bottomsheets.ConfirmationBottomSheet;
 import net.osmand.plus.settings.bottomsheets.ConfirmationBottomSheet.ConfirmationDialogListener;
-import net.osmand.plus.settings.enums.CompassVisibility;
-import net.osmand.plus.settings.enums.Map3DModeVisibility;
 import net.osmand.plus.utils.AndroidUtils;
-import net.osmand.plus.views.mapwidgets.configure.dialogs.CompassVisibilityBottomSheet;
-import net.osmand.plus.views.mapwidgets.configure.dialogs.CompassVisibilityBottomSheet.CompassVisibilityUpdateListener;
-import net.osmand.plus.views.mapwidgets.configure.dialogs.Map3DModeBottomSheet;
-import net.osmand.plus.views.mapwidgets.configure.dialogs.Map3DModeBottomSheet.Map3DModeUpdateListener;
 import net.osmand.plus.widgets.popup.PopUpMenu;
 import net.osmand.plus.widgets.popup.PopUpMenuDisplayData;
 import net.osmand.plus.widgets.popup.PopUpMenuItem;
@@ -32,21 +25,16 @@
 import java.util.ArrayList;
 import java.util.List;
 
-public class DefaultMapButtonsFragment extends BaseMapButtonsFragment implements Map3DModeUpdateListener,
-		CompassVisibilityUpdateListener, ConfirmationDialogListener {
+public class DefaultMapButtonsFragment extends BaseMapButtonsFragment implements ConfirmationDialogListener {
 
 	public static final String TAG = DefaultMapButtonsFragment.class.getSimpleName();
 
-	private Map3DButtonState map3DButtonState;
-	private CompassButtonState compassButtonState;
+	private List<MapButtonState> buttonStates;
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-
-		MapButtonsHelper mapButtonsHelper = app.getMapButtonsHelper();
-		map3DButtonState = mapButtonsHelper.getMap3DButtonState();
-		compassButtonState = mapButtonsHelper.getCompassButtonState();
+		buttonStates = app.getMapButtonsHelper().getDefaultButtonsStates();
 	}
 
 	@Override
@@ -67,26 +55,14 @@ protected void setupToolbar(@NonNull View view) {
 	@NonNull
 	@Override
 	protected List<MapButtonState> getAdapterItems() {
-		List<MapButtonState> items = new ArrayList<>();
-
-		items.add(map3DButtonState);
-		items.add(compassButtonState);
-
-		return items;
+		return new ArrayList<>(buttonStates);
 	}
 
 	@Override
 	public void onItemClick(@NonNull MapButtonState buttonState) {
 		FragmentActivity activity = getActivity();
 		if (activity != null) {
-			ApplicationMode mode = settings.getApplicationMode();
-			FragmentManager manager = activity.getSupportFragmentManager();
-
-			if (buttonState instanceof Map3DButtonState) {
-				Map3DModeBottomSheet.showInstance(manager, this, mode);
-			} else if (buttonState instanceof CompassButtonState) {
-				CompassVisibilityBottomSheet.showInstance(manager, this, mode);
-			}
+			DefaultMapButtonFragment.showInstance(activity.getSupportFragmentManager(), buttonState);
 		}
 	}
 
@@ -124,31 +100,21 @@ protected void showOptionsMenu(@NonNull View view) {
 		PopUpMenu.show(displayData);
 	}
 
-	@Override
-	public void onMap3DModeUpdated(@NonNull Map3DModeVisibility visibility) {
-		updateAdapter();
-	}
-
-	@Override
-	public void onCompassVisibilityUpdated(@NonNull CompassVisibility visibility) {
-		updateAdapter();
-	}
-
 	@Override
 	public void onActionConfirmed(int actionId) {
 		ApplicationMode appMode = settings.getApplicationMode();
-		map3DButtonState.getVisibilityPref().resetModeToDefault(appMode);
-		compassButtonState.getVisibilityPref().resetModeToDefault(appMode);
-
+		for (MapButtonState buttonState : buttonStates) {
+			buttonState.resetToDefault(appMode);
+		}
 		updateAdapter();
 	}
 
 	@Override
 	public void copyAppModePrefs(@NonNull ApplicationMode fromAppMode) {
 		ApplicationMode appMode = settings.getApplicationMode();
-		map3DButtonState.getVisibilityPref().setModeValue(appMode, map3DButtonState.getVisibility(fromAppMode));
-		compassButtonState.getVisibilityPref().setModeValue(appMode, compassButtonState.getModeVisibility(fromAppMode));
-
+		for (MapButtonState buttonState : buttonStates) {
+			buttonState.copyForMode(fromAppMode, appMode);
+		}
 		updateAdapter();
 	}
 
@@ -157,7 +123,7 @@ public static void showInstance(@NonNull FragmentManager manager, @NonNull Fragm
 			DefaultMapButtonsFragment fragment = new DefaultMapButtonsFragment();
 			fragment.setTargetFragment(target, 0);
 			manager.beginTransaction()
-					.add(R.id.fragmentContainer, fragment, TAG)
+					.replace(R.id.fragmentContainer, fragment, TAG)
 					.addToBackStack(TAG)
 					.commitAllowingStateLoss();
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonAppearanceCard.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonAppearanceCard.java
new file mode 100644
index 00000000000..42a8c0d78f4
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonAppearanceCard.java
@@ -0,0 +1,54 @@
+package net.osmand.plus.views.mapwidgets.configure.buttons;
+
+import android.view.View;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import androidx.annotation.NonNull;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.quickaction.MapButtonAppearanceFragment;
+import net.osmand.plus.routepreparationmenu.cards.MapBaseCard;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
+
+public class MapButtonAppearanceCard extends MapBaseCard {
+
+	private final MapButtonState buttonState;
+
+	public MapButtonAppearanceCard(@NonNull MapActivity mapActivity, @NonNull MapButtonState buttonState) {
+		super(mapActivity);
+		this.buttonState = buttonState;
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.configure_screen_list_item;
+	}
+
+	@Override
+	protected void updateContent() {
+		ImageView icon = view.findViewById(R.id.icon);
+		TextView title = view.findViewById(R.id.title);
+		TextView description = view.findViewById(R.id.description);
+
+		title.setText(R.string.shared_string_appearance);
+		icon.setImageDrawable(getContentIcon(R.drawable.ic_action_appearance));
+		description.setText(buttonState.hasCustomAppearance() ? R.string.shared_string_custom : R.string.shared_string_default);
+
+		View container = view.findViewById(R.id.button_container);
+		container.setOnClickListener(v -> showAppearanceDialog());
+
+		AndroidUiHelper.updateVisibility(description, true);
+		view.setBackgroundColor(ColorUtilities.getCardAndListBackgroundColor(app, nightMode));
+		UiUtilities.setupListItemBackground(view.getContext(), container, settings.getApplicationMode().getProfileColor(nightMode));
+	}
+
+	private void showAppearanceDialog() {
+		FragmentManager manager = activity.getSupportFragmentManager();
+		MapButtonAppearanceFragment.showInstance(manager, buttonState);
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonCard.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonCard.java
new file mode 100644
index 00000000000..f14f4fbd545
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonCard.java
@@ -0,0 +1,83 @@
+package net.osmand.plus.views.mapwidgets.configure.buttons;
+
+import static android.view.Gravity.CENTER;
+import static android.view.ViewGroup.LayoutParams.WRAP_CONTENT;
+
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.FrameLayout;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.quickaction.ButtonAppearanceParams;
+import net.osmand.plus.render.MapRenderRepositories;
+import net.osmand.plus.routepreparationmenu.cards.MapBaseCard;
+import net.osmand.plus.views.controls.maphudbuttons.MapButton;
+import net.osmand.plus.views.controls.maphudbuttons.QuickActionButton;
+import net.osmand.render.RenderingRuleSearchRequest;
+import net.osmand.render.RenderingRulesStorage;
+
+public class MapButtonCard extends MapBaseCard {
+
+	private final MapButtonState buttonState;
+	private final ButtonAppearanceParams customAppearanceParams;
+
+	private MapButton mapButton;
+
+	public MapButtonCard(@NonNull MapActivity mapActivity, @NonNull MapButtonState buttonState,
+	                     @Nullable ButtonAppearanceParams customAppearanceParams) {
+		super(mapActivity);
+		this.buttonState = buttonState;
+		this.customAppearanceParams = customAppearanceParams;
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.map_button_card;
+	}
+
+	@Override
+	protected void updateContent() {
+		ViewGroup container = view.findViewById(R.id.map_button_container);
+		container.removeAllViews();
+
+		setupButton(container);
+		setupButtonBackground(container);
+	}
+
+	public void setupButton(@NonNull ViewGroup container) {
+		mapButton = (MapButton) themedInflater.inflate(buttonState.getDefaultLayoutId(), container, false);
+		mapButton.setClickable(false);
+		mapButton.setAlwaysVisible(true);
+		mapButton.setNightMode(nightMode);
+		mapButton.setMapActivity(mapActivity);
+		mapButton.setCustomAppearanceParams(customAppearanceParams);
+		if (mapButton instanceof QuickActionButton actionButton) {
+			actionButton.setButtonState((QuickActionButtonState) buttonState);
+		}
+		container.addView(mapButton, new FrameLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT, CENTER));
+	}
+
+	public void updateButton() {
+		if (mapButton != null) {
+			mapButton.update();
+		}
+	}
+
+	private void setupButtonBackground(@NonNull View view) {
+		RenderingRulesStorage renderer = app.getRendererRegistry().getCurrentSelectedRenderer();
+		if (renderer != null) {
+			MapRenderRepositories maps = app.getResourceManager().getRenderer();
+			RenderingRuleSearchRequest request = maps.getSearchRequestWithAppliedCustomRules(renderer, nightMode);
+			if (request.searchRenderingAttribute("waterColor")) {
+				int color = request.getIntPropertyValue(renderer.PROPS.R_ATTR_COLOR_VALUE);
+				if (color != -1) {
+					view.setBackgroundColor(color);
+				}
+			}
+		}
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonViewHolder.java
index 344dfbab1be..7ff45b18085 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonViewHolder.java
@@ -49,7 +49,7 @@ public void bindView(@NonNull MapButtonState buttonState, boolean lastItem) {
 
 		ApplicationMode appMode = settings.getApplicationMode();
 		int color = enabled ? appMode.getProfileColor(nightMode) : ColorUtilities.getDefaultIconColor(app, nightMode);
-		icon.setImageDrawable(buttonState.getIcon(nightMode, false, color));
+		icon.setImageDrawable(buttonState.getIcon(color, nightMode, false));
 
 		setupListItemBackground(appMode, nightMode);
 		AndroidUiHelper.updateVisibility(description, true);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonVisibilityCard.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonVisibilityCard.java
new file mode 100644
index 00000000000..e7d260d671b
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonVisibilityCard.java
@@ -0,0 +1,111 @@
+package net.osmand.plus.views.mapwidgets.configure.buttons;
+
+import android.view.View;
+import android.widget.CompoundButton;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import androidx.annotation.NonNull;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.routepreparationmenu.cards.MapBaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.preferences.CommonPreference;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.utils.UiUtilities.CompoundButtonType;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.CompassVisibilityBottomSheet;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.Map3DModeBottomSheet;
+
+public class MapButtonVisibilityCard extends MapBaseCard {
+
+	private final Fragment fragment;
+	private final ApplicationMode appMode;
+	private final MapButtonState buttonState;
+
+	public MapButtonVisibilityCard(@NonNull MapActivity activity, @NonNull MapButtonState buttonState, @NonNull Fragment fragment) {
+		super(activity);
+		this.fragment = fragment;
+		this.buttonState = buttonState;
+		this.appMode = settings.getApplicationMode();
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.map_button_visibility_card;
+	}
+
+	@Override
+	protected void updateContent() {
+		TextView title = view.findViewById(R.id.title);
+		title.setText(buttonState.getDescription());
+
+		setupVisibilityButton(view.findViewById(R.id.button_container));
+		view.setBackgroundColor(ColorUtilities.getCardAndListBackgroundColor(app, nightMode));
+	}
+
+	public void setupVisibilityButton(@NonNull View view) {
+		TextView title = view.findViewById(R.id.title);
+		title.setText(R.string.gpx_visibility_txt);
+
+		ImageView icon = view.findViewById(R.id.icon);
+		if (buttonState.isEnabled()) {
+			icon.setImageDrawable(getActiveIcon(R.drawable.ic_action_show_16));
+		} else {
+			icon.setImageDrawable(getContentIcon(R.drawable.ic_action_show_16));
+		}
+		if (buttonState instanceof Map3DButtonState) {
+			setup3DVisibility(view, (Map3DButtonState) buttonState);
+		} else if (buttonState instanceof CompassButtonState) {
+			setupCompassVisibility(view, (CompassButtonState) buttonState);
+		} else {
+			setupBooleanVisibility(view);
+		}
+		UiUtilities.setupListItemBackground(view.getContext(), view, appMode.getProfileColor(nightMode));
+	}
+
+	public void setup3DVisibility(@NonNull View view, @NonNull Map3DButtonState buttonState) {
+		TextView description = view.findViewById(R.id.description);
+		description.setText(buttonState.getVisibility(appMode).getTitleId());
+
+		view.setOnClickListener(v -> {
+			FragmentManager manager = activity.getSupportFragmentManager();
+			Map3DModeBottomSheet.showInstance(manager, fragment, appMode);
+		});
+		AndroidUiHelper.updateVisibility(description, true);
+	}
+
+	public void setupCompassVisibility(@NonNull View view, @NonNull CompassButtonState buttonState) {
+		TextView description = view.findViewById(R.id.description);
+		description.setText(buttonState.getModeVisibility(appMode).getTitleId());
+
+		view.setOnClickListener(v -> {
+			FragmentManager manager = activity.getSupportFragmentManager();
+			CompassVisibilityBottomSheet.showInstance(manager, fragment, appMode);
+		});
+		AndroidUiHelper.updateVisibility(description, true);
+	}
+
+	public void setupBooleanVisibility(@NonNull View view) {
+		CommonPreference<Boolean> preference = (CommonPreference<Boolean>) buttonState.getVisibilityPref();
+
+		CompoundButton compoundButton = view.findViewById(R.id.compound_button);
+		compoundButton.setClickable(false);
+		compoundButton.setFocusable(false);
+		compoundButton.setChecked(preference.getModeValue(appMode));
+		UiUtilities.setupCompoundButton(compoundButton, nightMode, CompoundButtonType.GLOBAL);
+
+		view.setOnClickListener(v -> {
+			boolean visible = !compoundButton.isChecked();
+			compoundButton.setChecked(visible);
+			preference.setModeValue(appMode, visible);
+			notifyCardPressed();
+		});
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.description), false);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.compound_button), true);
+	}
+}
\ No newline at end of file
