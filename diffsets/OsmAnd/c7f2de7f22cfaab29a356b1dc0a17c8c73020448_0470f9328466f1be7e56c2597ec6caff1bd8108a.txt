diff --git a/OsmAnd-java/src/main/java/net/osmand/map/ITileSource.java b/OsmAnd-java/src/main/java/net/osmand/map/ITileSource.java
index 503467b93be..9def1de6c49 100644
--- a/OsmAnd-java/src/main/java/net/osmand/map/ITileSource.java
+++ b/OsmAnd-java/src/main/java/net/osmand/map/ITileSource.java
@@ -8,6 +8,8 @@ public interface ITileSource {
 
 	public String getName();
 
+	public void setName(String name);
+
 	public int getTileSize();
 
 	public String getUrlToLoad(int x, int y, int zoom);
@@ -29,7 +31,7 @@ public interface ITileSource {
 	public long getExpirationTimeMillis();
 
 	public int getExpirationTimeMinutes();
-	
+
 	public String getReferer();
 
 	public void deleteTiles(String path);
diff --git a/OsmAnd/res/layout/fragment_import.xml b/OsmAnd/res/layout/fragment_import.xml
index 3a5a25728be..71810a5fd9b 100644
--- a/OsmAnd/res/layout/fragment_import.xml
+++ b/OsmAnd/res/layout/fragment_import.xml
@@ -59,11 +59,14 @@
 		android:layout_below="@+id/description" />
 
 	<ExpandableListView
-		android:id="@android:id/list"
+		android:id="@+id/list"
 		android:layout_width="match_parent"
-		android:layout_height="wrap_content"
+		android:layout_height="match_parent"
 		android:layout_below="@+id/description_divider"
 		android:layout_marginBottom="@dimen/dialog_button_ex_height"
+		android:divider="@null"
+		android:dividerHeight="0dp"
+		android:drawSelectorOnTop="false"
 		android:groupIndicator="@android:color/transparent"
 		android:listSelector="@android:color/transparent" />
 
diff --git a/OsmAnd/res/layout/profile_data_list_item_child.xml b/OsmAnd/res/layout/profile_data_list_item_child.xml
index 231c8060d0e..f6471514ed1 100644
--- a/OsmAnd/res/layout/profile_data_list_item_child.xml
+++ b/OsmAnd/res/layout/profile_data_list_item_child.xml
@@ -6,56 +6,63 @@
 	android:gravity="center_vertical"
 	android:orientation="vertical">
 
-	<LinearLayout
+	<FrameLayout
 		android:layout_width="match_parent"
 		android:layout_height="match_parent"
-		android:background="?attr/bg_color"
-		android:gravity="center_vertical"
-		android:minHeight="66dp">
-
-		<ImageView
-			android:id="@+id/icon"
-			android:layout_width="wrap_content"
-			android:layout_height="wrap_content"
-			android:layout_margin="@dimen/content_padding"
-			tools:src="@drawable/ic_action_info_dark" />
+		android:background="?attr/bg_color">
 
 		<LinearLayout
-			android:layout_width="0dp"
-			android:layout_height="wrap_content"
-			android:layout_gravity="center_vertical"
-			android:layout_weight="1"
-			android:orientation="vertical">
+			android:layout_width="match_parent"
+			android:layout_height="match_parent"
+			android:background="?attr/selectableItemBackground"
+			android:gravity="center_vertical"
+			android:minHeight="66dp">
+
+			<ImageView
+				android:id="@+id/icon"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:layout_margin="@dimen/content_padding"
+				tools:src="@drawable/ic_action_info_dark" />
 
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/title_tv"
-				android:layout_width="match_parent"
+			<LinearLayout
+				android:layout_width="0dp"
 				android:layout_height="wrap_content"
-				android:textColor="?android:textColorPrimary"
-				android:textSize="@dimen/default_list_text_size"
-				tools:text="Quick actions" />
+				android:layout_gravity="center_vertical"
+				android:layout_weight="1"
+				android:orientation="vertical">
 
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/sub_title_tv"
+				<net.osmand.plus.widgets.TextViewEx
+					android:id="@+id/title_tv"
+					android:layout_width="match_parent"
+					android:layout_height="wrap_content"
+					android:textColor="?android:textColorPrimary"
+					android:textSize="@dimen/default_list_text_size"
+					tools:text="Quick actions" />
+
+				<net.osmand.plus.widgets.TextViewEx
+					android:id="@+id/sub_title_tv"
+					android:layout_width="wrap_content"
+					android:layout_height="wrap_content"
+					android:textColor="?android:textColorSecondary"
+					android:textSize="@dimen/default_desc_text_size"
+					android:visibility="gone"
+					tools:text="description"
+					tools:visibility="visible" />
+
+			</LinearLayout>
+
+			<android.support.v7.widget.AppCompatCheckBox
+				android:id="@+id/check_box"
 				android:layout_width="wrap_content"
 				android:layout_height="wrap_content"
-				android:textColor="?android:textColorSecondary"
-				android:textSize="@dimen/default_desc_text_size"
-				android:visibility="gone"
-				tools:text="description"
-				tools:visibility="visible" />
+				android:layout_marginStart="@dimen/content_padding"
+				android:layout_marginEnd="@dimen/content_padding"
+				android:focusable="false" />
 
 		</LinearLayout>
 
-		<android.support.v7.widget.AppCompatCheckBox
-			android:id="@+id/check_box"
-			android:layout_width="wrap_content"
-			android:layout_height="wrap_content"
-			android:layout_marginStart="@dimen/content_padding"
-			android:layout_marginEnd="@dimen/content_padding"
-			android:focusable="false" />
-
-	</LinearLayout>
+	</FrameLayout>
 
 	<View
 		android:id="@+id/divider"
diff --git a/OsmAnd/res/layout/profile_data_list_item_group.xml b/OsmAnd/res/layout/profile_data_list_item_group.xml
index e4ca55f9342..75bf9b87d7c 100644
--- a/OsmAnd/res/layout/profile_data_list_item_group.xml
+++ b/OsmAnd/res/layout/profile_data_list_item_group.xml
@@ -11,62 +11,69 @@
 		android:visibility="gone"
 		tools:visibility="visible" />
 
-	<LinearLayout
+	<FrameLayout
 		android:layout_width="match_parent"
 		android:layout_height="match_parent"
-		android:background="?attr/bg_color"
-		android:gravity="center_vertical"
-		android:minHeight="66dp"
-		android:orientation="horizontal">
-
-		<ImageView
-			android:id="@+id/explist_indicator"
-			android:layout_width="wrap_content"
-			android:layout_height="wrap_content"
-			android:layout_margin="@dimen/content_padding"
-			android:src="@drawable/ic_action_arrow_down" />
+		android:background="?attr/bg_color">
 
 		<LinearLayout
-			android:layout_width="0dp"
+			android:layout_width="match_parent"
 			android:layout_height="match_parent"
-			android:layout_weight="1"
+			android:background="?attr/selectableItemBackground"
 			android:gravity="center_vertical"
-			android:orientation="vertical">
+			android:minHeight="66dp"
+			android:orientation="horizontal">
 
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/title_tv"
+			<ImageView
+				android:id="@+id/explist_indicator"
 				android:layout_width="wrap_content"
 				android:layout_height="wrap_content"
-				android:textColor="?android:textColorPrimary"
-				android:textSize="@dimen/default_list_text_size"
-				tools:text="Quick actions" />
+				android:layout_margin="@dimen/content_padding"
+				android:src="@drawable/ic_action_arrow_down" />
+
+			<LinearLayout
+				android:layout_width="0dp"
+				android:layout_height="match_parent"
+				android:layout_weight="1"
+				android:gravity="center_vertical"
+				android:orientation="vertical">
+
+				<net.osmand.plus.widgets.TextViewEx
+					android:id="@+id/title_tv"
+					android:layout_width="wrap_content"
+					android:layout_height="wrap_content"
+					android:textColor="?android:textColorPrimary"
+					android:textSize="@dimen/default_list_text_size"
+					tools:text="Quick actions" />
+
+				<net.osmand.plus.widgets.TextViewEx
+					android:id="@+id/sub_text_tv"
+					android:layout_width="wrap_content"
+					android:layout_height="wrap_content"
+					android:textColor="?android:textColorSecondary"
+					android:textSize="@dimen/default_desc_text_size"
+					tools:text="8 of 4" />
+
+			</LinearLayout>
 
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/sub_text_tv"
+			<View
+				android:id="@+id/vertical_divider"
+				android:layout_width="1dp"
+				android:layout_height="match_parent"
+				android:layout_marginTop="@dimen/content_padding"
+				android:layout_marginBottom="@dimen/content_padding"
+				android:background="?attr/list_divider" />
+
+			<android.support.v7.widget.AppCompatCheckBox
+				android:id="@+id/check_box"
 				android:layout_width="wrap_content"
 				android:layout_height="wrap_content"
-				android:textColor="?android:textColorSecondary"
-				android:textSize="@dimen/default_desc_text_size"
-				tools:text="8 of 4" />
+				android:layout_margin="@dimen/content_padding"
+				android:focusable="false" />
 
 		</LinearLayout>
 
-		<View
-			android:id="@+id/vertical_divider"
-			android:layout_width="1dp"
-			android:layout_height="match_parent"
-			android:layout_marginTop="@dimen/content_padding"
-			android:layout_marginBottom="@dimen/content_padding"
-			android:background="?attr/list_divider" />
-
-		<android.support.v7.widget.AppCompatCheckBox
-			android:id="@+id/check_box"
-			android:layout_width="wrap_content"
-			android:layout_height="wrap_content"
-			android:layout_margin="@dimen/content_padding"
-			android:focusable="false" />
-
-	</LinearLayout>
+	</FrameLayout>
 
 	<View
 		android:id="@+id/divider"
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index 2b0d4e3b70f..8a38a38ea47 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -11,6 +11,7 @@
 	Thx - Hardy
 
 -->
+    <string name="shared_sting_poi_types">POI types</string>
     <string name="shared_sting_nothing_selected">Nothing selected</string>
     <string name="shared_sting_quick_actions">Quick actions</string>
     <string name="shared_sting_profiles">Profiles</string>
diff --git a/OsmAnd/src/net/osmand/plus/SQLiteTileSource.java b/OsmAnd/src/net/osmand/plus/SQLiteTileSource.java
index e057c7fd3a0..1a677c10f43 100644
--- a/OsmAnd/src/net/osmand/plus/SQLiteTileSource.java
+++ b/OsmAnd/src/net/osmand/plus/SQLiteTileSource.java
@@ -111,10 +111,10 @@ public void createDataBase() {
 		db = ctx.getSQLiteAPI().getOrCreateDatabase(
 				ctx.getAppPath(TILES_INDEX_DIR).getAbsolutePath() + "/" + name + SQLITE_EXT, true);
 
-		db.execSQL("CREATE TABLE tiles (x int, y int, z int, s int, image blob, time long, PRIMARY KEY (x,y,z,s))");
+		db.execSQL("CREATE TABLE IF NOT EXIST tiles (x int, y int, z int, s int, image blob, time long, PRIMARY KEY (x,y,z,s))");
 		db.execSQL("CREATE INDEX IND on tiles (x,y,z,s)");
-		db.execSQL("CREATE TABLE info(tilenumbering,minzoom,maxzoom)");
-		db.execSQL("CREATE TABLE android_metadata (locale TEXT)");
+		db.execSQL("CREATE TABLE IF NOT EXIST info(tilenumbering,minzoom,maxzoom)");
+		db.execSQL("CREATE TABLE IF NOT EXIST android_metadata (locale TEXT)");
 		db.execSQL("INSERT INTO info (tilenumbering,minzoom,maxzoom) VALUES ('simple','" + minZoom + "','" + maxZoom + "');");
 
 		addInfoColumn(URL, urlTemplate);
@@ -149,6 +149,11 @@ public String getName() {
 		return name;
 	}
 
+	@Override
+	public void setName(String name) {
+		this.name = name;
+	}
+
 	@Override
 	public String getTileFormat() {
 		return base != null ? base.getTileFormat() : ".png"; //$NON-NLS-1$
diff --git a/OsmAnd/src/net/osmand/plus/SettingsHelper.java b/OsmAnd/src/net/osmand/plus/SettingsHelper.java
index 0f29edd37f1..e709b73c655 100644
--- a/OsmAnd/src/net/osmand/plus/SettingsHelper.java
+++ b/OsmAnd/src/net/osmand/plus/SettingsHelper.java
@@ -12,6 +12,7 @@
 import com.google.gson.Gson;
 import com.google.gson.reflect.TypeToken;
 
+import net.osmand.IndexConstants;
 import net.osmand.PlatformUtil;
 import net.osmand.map.ITileSource;
 import net.osmand.map.TileSourceManager;
@@ -61,6 +62,7 @@
 
 import static net.osmand.IndexConstants.OSMAND_SETTINGS_FILE_EXT;
 import static net.osmand.IndexConstants.TILES_INDEX_DIR;
+import static net.osmand.plus.ApplicationMode.allPossibleValues;
 
 /*
 	Usage:
@@ -90,6 +92,7 @@ public class SettingsHelper {
 	public static final String SETTINGS_LATEST_CHANGES_KEY = "settings_latest_changes";
 	public static final String SETTINGS_VERSION_KEY = "settings_version";
 
+	private static final String COPY_PREFIX = "copy_";
 	private static final Log LOG = PlatformUtil.getLog(SettingsHelper.class);
 	private static final int BUFFER = 1024;
 
@@ -488,12 +491,21 @@ void readFromJson(@NonNull OsmandApplication app, @NonNull JSONObject json) thro
 
 		@Override
 		public boolean exists() {
+			List<ApplicationMode> profiles = ApplicationMode.allPossibleValues();
+			for (ApplicationMode profile : profiles) {
+				if (appMode.toHumanString().equals(profile.toHumanString())) {
+					return true;
+				}
+			}
 			return builder != null && ApplicationMode.valueOfStringKey(getName(), null) != null;
 		}
 
 		@Override
 		public void apply() {
 			if (appMode.isCustomProfile()) {
+				if (!shouldReplace) {
+					appMode.setUserProfileName(COPY_PREFIX + appMode.getUserProfileName());
+				}
 				appMode = ApplicationMode.saveProfile(builder, getSettings().getContext());
 			}
 		}
@@ -710,7 +722,15 @@ SettingsItemReader getReader() {
 			return new StreamSettingsItemReader(this) {
 				@Override
 				public void readFromStream(@NonNull InputStream inputStream) throws IOException, IllegalArgumentException {
-					OutputStream output = new FileOutputStream(file);
+					OutputStream output;
+					if (shouldReplace) {
+						output = new FileOutputStream(file);
+					} else {
+						String path = file.getAbsolutePath();
+						String copyName = path.replaceAll(file.getName(), COPY_PREFIX + file.getName());
+						File copyFile = new File(copyName);
+						output = new FileOutputStream(copyFile);
+					}
 					byte[] buffer = new byte[BUFFER];
 					int count;
 					try {
@@ -740,6 +760,7 @@ public SettingsItemWriter getWriter() {
 	public static class QuickActionSettingsItem extends OsmandSettingsItem {
 
 		private List<QuickAction> quickActions;
+		private List<QuickAction> duplicates;
 
 		private OsmandApplication app;
 
@@ -748,6 +769,7 @@ public QuickActionSettingsItem(@NonNull OsmandApplication app,
 			super(SettingsItemType.QUICK_ACTION, app.getSettings());
 			this.app = app;
 			this.quickActions = quickActions;
+			this.duplicates = new ArrayList<>();
 		}
 
 		public QuickActionSettingsItem(@NonNull OsmandApplication app,
@@ -762,22 +784,25 @@ public List<QuickAction> getQuickActions() {
 
 		@Override
 		public void apply() {
-			if (!quickActions.isEmpty()) {
+			if (!quickActions.isEmpty() || !duplicates.isEmpty()) {
 				QuickActionFactory factory = new QuickActionFactory();
 				List<QuickAction> savedActions = factory.parseActiveActionsList(getSettings().QUICK_ACTION_LIST.get());
 				List<QuickAction> newActions = new ArrayList<>(savedActions);
-				if (shouldReplace) {
-					for (QuickAction action : quickActions) {
-						for (QuickAction savedAction : savedActions) {
-							if (action.getName(app).equals(savedAction.getName(app))) {
-								newActions.remove(savedAction);
+				if (!duplicates.isEmpty()) {
+					if (shouldReplace) {
+						for (QuickAction action : duplicates) {
+							for (QuickAction savedAction : savedActions) {
+								if (action.getName(app).equals(savedAction.getName(app))) {
+									newActions.remove(savedAction);
+								}
 							}
 						}
+					} else {
+						for (QuickAction action : duplicates) {
+							action.setName(COPY_PREFIX + action.getName(app));
+						}
 					}
-				} else {
-					for (QuickAction action : quickActions) {
-						action.setName("new_" + action.getName(app));
-					}
+					newActions.addAll(duplicates);
 				}
 				newActions.addAll(quickActions);
 				((MapActivity) app.getSettingsHelper().getActivity()).getMapLayers().getQuickActionRegistry().updateQuickActions(newActions);
@@ -797,6 +822,8 @@ public List<QuickAction> getDuplicates() {
 					}
 				}
 			}
+			this.duplicates = duplicates;
+			this.quickActions.removeAll(duplicates);
 			return duplicates;
 		}
 
@@ -903,6 +930,7 @@ protected void writePreferenceToJson(@NonNull OsmandPreference<?> preference, @N
 	public static class PoiUiFilterSettingsItem extends OsmandSettingsItem {
 
 		private List<PoiUIFilter> poiUIFilters;
+		private List<PoiUIFilter> duplicates;
 
 		private OsmandApplication app;
 
@@ -910,6 +938,7 @@ public PoiUiFilterSettingsItem(OsmandApplication app, List<PoiUIFilter> poiUIFil
 			super(SettingsItemType.POI_UI_FILTERS, app.getSettings());
 			this.app = app;
 			this.poiUIFilters = poiUIFilters;
+			this.duplicates = new ArrayList<>();
 		}
 
 		public PoiUiFilterSettingsItem(OsmandApplication app, JSONObject jsonObject) throws JSONException {
@@ -923,7 +952,13 @@ public List<PoiUIFilter> getPoiUIFilters() {
 
 		@Override
 		public void apply() {
-			if (!poiUIFilters.isEmpty()) {
+			if (!poiUIFilters.isEmpty() || !duplicates.isEmpty()) {
+				for (PoiUIFilter duplicate : duplicates) {
+					if (!shouldReplace) {
+						duplicate.setName(COPY_PREFIX + duplicate.getName());
+					}
+					poiUIFilters.add(duplicate);
+				}
 				for (PoiUIFilter filter : poiUIFilters) {
 					app.getPoiFilters().createPoiFilter(filter, false);
 				}
@@ -931,6 +966,23 @@ public void apply() {
 			}
 		}
 
+		public List<PoiUIFilter> getDuplicates() {
+			List<PoiUIFilter> duplicates = new ArrayList<>();
+			List<PoiUIFilter> userPoiList = app.getPoiFilters().getUserDefinedPoiFilters(false);
+			if (!poiUIFilters.isEmpty()) {
+				for (PoiUIFilter filter : poiUIFilters) {
+					for (PoiUIFilter userFilter : userPoiList) {
+						if (filter.getName().equals(userFilter.getName())) {
+							duplicates.add(filter);
+						}
+					}
+				}
+			}
+			this.duplicates = duplicates;
+			this.poiUIFilters.removeAll(duplicates);
+			return duplicates;
+		}
+
 		@NonNull
 		@Override
 		public String getName() {
@@ -1039,11 +1091,13 @@ public static class MapSourcesSettingsItem extends OsmandSettingsItem {
 		private OsmandApplication app;
 
 		private List<ITileSource> mapSources;
+		private List<ITileSource> duplicates;
 
 		public MapSourcesSettingsItem(OsmandApplication app, List<ITileSource> mapSources) {
 			super(SettingsItemType.MAP_SOURCES, app.getSettings());
 			this.app = app;
 			this.mapSources = mapSources;
+			this.duplicates = new ArrayList<>();
 		}
 
 		public MapSourcesSettingsItem(OsmandApplication app, JSONObject jsonObject) throws JSONException {
@@ -1057,7 +1111,22 @@ public List<ITileSource> getMapSources() {
 
 		@Override
 		public void apply() {
-			if (!mapSources.isEmpty()) {
+			if (!mapSources.isEmpty() || !duplicates.isEmpty()) {
+				if (shouldReplace) {
+					for (ITileSource tileSource : duplicates) {
+						File f = app.getAppPath(IndexConstants.TILES_INDEX_DIR + tileSource.getName());
+						if (f != null && f.exists()) {
+							if (f.delete()) {
+								mapSources.add(tileSource);
+							}
+						}
+					}
+				} else {
+					for (ITileSource tileSource : duplicates) {
+						tileSource.setName(COPY_PREFIX + tileSource.getName());
+					}
+				}
+				mapSources.addAll(duplicates);
 				for (ITileSource template : mapSources) {
 					if (template instanceof TileSourceManager.TileSourceTemplate) {
 						getSettings().installTileSource((TileSourceManager.TileSourceTemplate) template);
@@ -1068,6 +1137,21 @@ public void apply() {
 			}
 		}
 
+		public List<ITileSource> getDuplicates() {
+			List<ITileSource> duplicates = new ArrayList<>();
+			final LinkedHashMap<String, String> tileSourceEntries = new LinkedHashMap<>(app.getSettings().getTileSourceEntries(true));
+			for (Map.Entry<String, String> entry : tileSourceEntries.entrySet()) {
+				for (ITileSource tileSource : mapSources) {
+					if (entry.getValue().equals(tileSource.getName())) {
+						duplicates.add(tileSource);
+					}
+				}
+			}
+			this.duplicates = duplicates;
+			this.mapSources.removeAll(duplicates);
+			return duplicates;
+		}
+
 		@NonNull
 		@Override
 		public String getName() {
@@ -1498,29 +1582,30 @@ private void processNextItem() {
 			}
 			importSuspended = false;
 			if (item != null) {
-				if (item.exists()) {
-					switch (item.getType()) {
-						case PROFILE: {
-							String title = activity.getString(R.string.overwrite_profile_q, item.getPublicName(app));
-							dialog = showConfirmDialog(item, title, latestChanges);
-							break;
-						}
-						case FILE:
-							// overwrite now
-							acceptItem(item);
-							break;
-						default:
-							acceptItem(item);
-							break;
-					}
-				} else {
-					if (item.getType() == SettingsItemType.PROFILE && askBeforeImport) {
-						String title = activity.getString(R.string.add_new_profile_q, item.getPublicName(app));
-						dialog = showConfirmDialog(item, title, latestChanges);
-					} else {
-						acceptItem(item);
-					}
-				}
+				acceptItem(item);
+//				if (item.exists()) {
+//					switch (item.getType()) {
+//						case PROFILE: {
+//							String title = activity.getString(R.string.overwrite_profile_q, item.getPublicName(app));
+//							dialog = showConfirmDialog(item, title, latestChanges);
+//							break;
+//						}
+//						case FILE:
+//							 overwrite now
+//							acceptItem(item);
+//							break;
+//						default:
+//							acceptItem(item);
+//							break;
+//					}
+//				} else {
+//					if (item.getType() == SettingsItemType.PROFILE && askBeforeImport) {
+//						String title = activity.getString(R.string.add_new_profile_q, item.getPublicName(app));
+//						dialog = showConfirmDialog(item, title, latestChanges);
+//					} else {
+//						acceptItem(item);
+//					}
+//				}
 			} else {
 				processNextItem();
 			}
diff --git a/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java b/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java
index 5f4a479dd35..1a24bef98d5 100644
--- a/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java
+++ b/OsmAnd/src/net/osmand/plus/helpers/ImportHelper.java
@@ -34,7 +34,6 @@
 import net.osmand.plus.AppInitializer;
 import net.osmand.plus.AppInitializer.AppInitializeListener;
 import net.osmand.plus.AppInitializer.InitEvents;
-import net.osmand.plus.ApplicationMode;
 import net.osmand.plus.FavouritesDbHelper;
 import net.osmand.plus.GPXDatabase;
 import net.osmand.plus.OsmandApplication;
@@ -51,18 +50,12 @@
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerHalfItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.ShortDescriptionItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
-import net.osmand.plus.profiles.AdditionalDataWrapper;
-import net.osmand.plus.profiles.ExportImportProfileBottomSheet;
-import net.osmand.plus.quickaction.QuickAction;
 import net.osmand.plus.rastermaps.OsmandRasterMapsPlugin;
-import net.osmand.plus.settings.ImportDuplicatesFragment;
 import net.osmand.plus.settings.ImportSettingsFragment;
 import net.osmand.plus.views.OsmandMapTileView;
-import net.osmand.router.RoutingConfiguration;
 import net.osmand.util.Algorithms;
 
 import org.apache.commons.logging.Log;
-import org.xmlpull.v1.XmlPullParserException;
 
 import java.io.ByteArrayInputStream;
 import java.io.File;
diff --git a/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java b/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java
index 15cd26df7b4..0808f1e5401 100644
--- a/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java
@@ -28,20 +28,16 @@
 import android.widget.Toast;
 
 import net.osmand.AndroidUtils;
-import net.osmand.IndexConstants;
 import net.osmand.PlatformUtil;
 import net.osmand.plus.ApplicationMode;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.OsmandPlugin;
 import net.osmand.plus.R;
-import net.osmand.plus.SettingsHelper;
-import net.osmand.plus.SettingsHelper.ProfileSettingsItem;
 import net.osmand.plus.UiUtilities;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.helpers.FontCache;
 import net.osmand.plus.openseamapsplugin.NauticalMapsPlugin;
-import net.osmand.plus.profiles.ExportImportProfileBottomSheet;
 import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet;
 import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet.CopyAppModePrefsListener;
 import net.osmand.plus.settings.bottomsheets.ResetProfilePrefsBottomSheet;
diff --git a/OsmAnd/src/net/osmand/plus/settings/DuplicatesSettingsAdapter.java b/OsmAnd/src/net/osmand/plus/settings/DuplicatesSettingsAdapter.java
index 5bf37050844..704863fa49d 100644
--- a/OsmAnd/src/net/osmand/plus/settings/DuplicatesSettingsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/settings/DuplicatesSettingsAdapter.java
@@ -9,12 +9,16 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import net.osmand.map.ITileSource;
 import net.osmand.plus.ApplicationMode;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
+import net.osmand.plus.poi.PoiUIFilter;
 import net.osmand.plus.quickaction.QuickAction;
+import net.osmand.plus.render.RenderingIcons;
 
 
+import java.io.File;
 import java.util.List;
 
 public class DuplicatesSettingsAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder> {
@@ -23,9 +27,7 @@ public class DuplicatesSettingsAdapter extends RecyclerView.Adapter<RecyclerView
 	private static final int ITEM_TYPE = 1;
 
 	private boolean nightMode;
-
 	private OsmandApplication app;
-
 	private List<? super Object> items;
 
 	DuplicatesSettingsAdapter(OsmandApplication app, List<? super Object> items, boolean nightMode) {
@@ -70,6 +72,18 @@ public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int positi
 			} else if (currentItem instanceof QuickAction) {
 				title = ((QuickAction) currentItem).getName(app);
 				drawable = app.getUIUtilities().getIcon(((QuickAction) currentItem).getIconRes(), nightMode);
+			} else if (currentItem instanceof PoiUIFilter) {
+				title = ((PoiUIFilter) currentItem).getName();
+				int iconRes = RenderingIcons.getBigIconResourceId(((PoiUIFilter) currentItem).getIconId());
+				drawable = app.getUIUtilities().getIcon(iconRes != 0 ? iconRes : R.drawable.ic_person, nightMode);
+			} else if (currentItem instanceof ITileSource) {
+				title = ((ITileSource) currentItem).getName();
+				drawable = app.getUIUtilities().getIcon(R.drawable.ic_action_info_dark, nightMode);
+			} else if (currentItem instanceof File) {
+				title = ((File) currentItem).getName();
+				if (((File) currentItem).getName().contains("/rendering/")) {
+					drawable = app.getUIUtilities().getIcon(R.drawable.ic_action_map_style, nightMode);
+				}
 			}
 			((ItemViewHolder) holder).title.setText(title != null ? title : "");
 			if (subTitle != null) {
diff --git a/OsmAnd/src/net/osmand/plus/profiles/ExportImportProfileBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/ExportImportProfileBottomSheet.java
similarity index 61%
rename from OsmAnd/src/net/osmand/plus/profiles/ExportImportProfileBottomSheet.java
rename to OsmAnd/src/net/osmand/plus/settings/ExportImportProfileBottomSheet.java
index 8a14422a58e..9c429040efe 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/ExportImportProfileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/ExportImportProfileBottomSheet.java
@@ -1,4 +1,4 @@
-package net.osmand.plus.profiles;
+package net.osmand.plus.settings;
 
 import android.content.Context;
 import android.content.Intent;
@@ -11,15 +11,10 @@
 import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.content.ContextCompat;
-import android.support.v4.widget.CompoundButtonCompat;
 import android.support.v7.widget.SwitchCompat;
 import android.view.LayoutInflater;
 import android.view.View;
-import android.view.ViewGroup;
-import android.widget.CheckBox;
 import android.widget.ExpandableListView;
-import android.widget.ImageView;
-import android.widget.TextView;
 import android.widget.Toast;
 
 import net.osmand.AndroidUtils;
@@ -33,17 +28,15 @@
 import net.osmand.plus.SQLiteTileSource;
 import net.osmand.plus.SettingsHelper;
 import net.osmand.plus.UiUtilities;
-import net.osmand.plus.activities.OsmandBaseExpandableListAdapter;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithCompoundButton;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithDescription;
 import net.osmand.plus.base.bottomsheetmenu.SimpleBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
 import net.osmand.plus.poi.PoiUIFilter;
+import net.osmand.plus.profiles.AdditionalDataWrapper;
 import net.osmand.plus.quickaction.QuickAction;
 import net.osmand.plus.quickaction.QuickActionFactory;
-import net.osmand.plus.render.RenderingIcons;
-import net.osmand.plus.settings.BaseSettingsFragment;
 import net.osmand.plus.settings.bottomsheets.BasePreferenceBottomSheet;
 
 import org.apache.commons.logging.Log;
@@ -77,13 +70,11 @@ public class ExportImportProfileBottomSheet extends BasePreferenceBottomSheet {
 
 	private List<AdditionalDataWrapper> dataList = new ArrayList<>();
 
-	private List<? super Object> dataToOperate = new ArrayList<>();
-
 	private List<SettingsHelper.SettingsItem> settingsItems;
 
 	private ExpandableListView listView;
 
-	private ProfileAdditionalDataAdapter adapter;
+	private ExportImportSettingsAdapter adapter;
 
 	private SettingsHelper.ProfileSettingsItem profileSettingsItem;
 
@@ -110,9 +101,9 @@ public void onCreate(Bundle savedInstanceState) {
 			containsAdditionalData = checkAdditionalDataContains();
 		} else {
 			dataList = getAdditionalData();
-			for (AdditionalDataWrapper dataWrapper : dataList) {
-				dataToOperate.addAll(dataWrapper.getItems());
-			}
+//			for (AdditionalDataWrapper dataWrapper : dataList) {
+//				dataToOperate.addAll(dataWrapper.getItems());
+//			}
 		}
 	}
 
@@ -174,14 +165,14 @@ public void onClick(View view) {
 					includeAdditionalData = !includeAdditionalData;
 					listView.setVisibility(includeAdditionalData ?
 							View.VISIBLE : View.GONE);
-					if (includeAdditionalData && state == State.IMPORT) {
-						updateDataToOperateFromSettingsItems();
-					}
+//					if (includeAdditionalData && state == State.IMPORT) {
+//						updateDataToOperateFromSettingsItems();
+//					}
 					setupHeightAndBackground(getView());
 				}
 			});
 			listView.setVisibility(includeAdditionalData ? View.VISIBLE : View.GONE);
-			adapter = new ProfileAdditionalDataAdapter(app, dataList, profileColor);
+			adapter = new ExportImportSettingsAdapter(app, dataList, nightMode, false);
 			listView.setOnGroupExpandListener(new ExpandableListView.OnGroupExpandListener() {
 				@Override
 				public void onGroupExpand(int i) {
@@ -308,7 +299,7 @@ private List<SettingsHelper.SettingsItem> prepareAdditionalSettingsItems() {
 		List<QuickAction> quickActions = new ArrayList<>();
 		List<PoiUIFilter> poiUIFilters = new ArrayList<>();
 		List<ITileSource> tileSourceTemplates = new ArrayList<>();
-		for (Object object : dataToOperate) {
+		for (Object object : adapter.getDataToOperate()) {
 			if (object instanceof QuickAction) {
 				quickActions.add((QuickAction) object);
 			} else if (object instanceof PoiUIFilter) {
@@ -346,66 +337,6 @@ private Boolean checkAdditionalDataContains() {
 		return containsData;
 	}
 
-	private void updateDataToOperateFromSettingsItems() {
-		List<AdditionalDataWrapper> dataList = new ArrayList<>();
-		List<QuickAction> quickActions = new ArrayList<>();
-		List<PoiUIFilter> poiUIFilters = new ArrayList<>();
-		List<ITileSource> tileSourceTemplates = new ArrayList<>();
-		List<File> routingFilesList = new ArrayList<>();
-		List<File> renderFilesList = new ArrayList<>();
-
-		for (SettingsHelper.SettingsItem item : settingsItems) {
-			if (item.getType().equals(SettingsHelper.SettingsItemType.QUICK_ACTION)) {
-				quickActions.addAll(((SettingsHelper.QuickActionSettingsItem) item).getQuickActions());
-			} else if (item.getType().equals(SettingsHelper.SettingsItemType.POI_UI_FILTERS)) {
-				poiUIFilters.addAll(((SettingsHelper.PoiUiFilterSettingsItem) item).getPoiUIFilters());
-			} else if (item.getType().equals(SettingsHelper.SettingsItemType.MAP_SOURCES)) {
-				tileSourceTemplates.addAll(((SettingsHelper.MapSourcesSettingsItem) item).getMapSources());
-			} else if (item.getType().equals(SettingsHelper.SettingsItemType.FILE)) {
-				if (item.getName().startsWith("/rendering/")) {
-					renderFilesList.add(((SettingsHelper.FileSettingsItem) item).getFile());
-				} else if (item.getName().startsWith("/routing/")) {
-					routingFilesList.add(((SettingsHelper.FileSettingsItem) item).getFile());
-				}
-			}
-		}
-
-		if (!quickActions.isEmpty()) {
-			dataList.add(new AdditionalDataWrapper(
-					AdditionalDataWrapper.Type.QUICK_ACTIONS,
-					quickActions));
-			dataToOperate.addAll(quickActions);
-		}
-		if (!poiUIFilters.isEmpty()) {
-			dataList.add(new AdditionalDataWrapper(
-					AdditionalDataWrapper.Type.POI_TYPES,
-					poiUIFilters));
-			dataToOperate.addAll(poiUIFilters);
-		}
-		if (!tileSourceTemplates.isEmpty()) {
-			dataList.add(new AdditionalDataWrapper(
-					AdditionalDataWrapper.Type.MAP_SOURCES,
-					tileSourceTemplates
-			));
-			dataToOperate.addAll(tileSourceTemplates);
-		}
-		if (!renderFilesList.isEmpty()) {
-			dataList.add(new AdditionalDataWrapper(
-					AdditionalDataWrapper.Type.CUSTOM_RENDER_STYLE,
-					renderFilesList
-			));
-			dataToOperate.addAll(renderFilesList);
-		}
-		if (!routingFilesList.isEmpty()) {
-			dataList.add(new AdditionalDataWrapper(
-					AdditionalDataWrapper.Type.CUSTOM_ROUTING,
-					routingFilesList
-			));
-			dataToOperate.addAll(routingFilesList);
-		}
-		adapter.updateList(dataList);
-	}
-
 	private void importSettings() {
 		List<SettingsHelper.SettingsItem> list = new ArrayList<>();
 		list.add(profileSettingsItem);
@@ -513,199 +444,4 @@ public enum State {
 		EXPORT,
 		IMPORT
 	}
-
-	class ProfileAdditionalDataAdapter extends OsmandBaseExpandableListAdapter {
-
-		private OsmandApplication app;
-
-		private List<AdditionalDataWrapper> list;
-
-		private int profileColor;
-
-		ProfileAdditionalDataAdapter(OsmandApplication app, List<AdditionalDataWrapper> list, int profileColor) {
-			this.app = app;
-			this.list = list;
-			this.profileColor = profileColor;
-		}
-
-		public void updateList(List<AdditionalDataWrapper> list) {
-			this.list = list;
-			notifyDataSetChanged();
-		}
-
-		@Override
-		public int getGroupCount() {
-			return list.size();
-		}
-
-		@Override
-		public int getChildrenCount(int i) {
-			return list.get(i).getItems().size();
-		}
-
-		@Override
-		public Object getGroup(int i) {
-			return list.get(i);
-		}
-
-		@Override
-		public Object getChild(int groupPosition, int childPosition) {
-			return list.get(groupPosition).getItems().get(childPosition);
-		}
-
-		@Override
-		public long getGroupId(int i) {
-			return i;
-		}
-
-		@Override
-		public long getChildId(int groupPosition, int childPosition) {
-			return groupPosition * 10000 + childPosition;
-		}
-
-		@Override
-		public boolean hasStableIds() {
-			return false;
-		}
-
-		@Override
-		public View getGroupView(int groupPosition, boolean isExpanded, View convertView, ViewGroup parent) {
-			View group = convertView;
-			if (group == null) {
-				LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
-				group = inflater.inflate(R.layout.profile_data_list_item_group, parent, false);
-			}
-
-			boolean isLastGroup = groupPosition == getGroupCount() - 1;
-			final AdditionalDataWrapper.Type type = list.get(groupPosition).getType();
-
-			TextView titleTv = group.findViewById(R.id.title_tv);
-			TextView subTextTv = group.findViewById(R.id.sub_text_tv);
-			final CheckBox checkBox = group.findViewById(R.id.check_box);
-			ImageView expandIv = group.findViewById(R.id.explist_indicator);
-			View divider = group.findViewById(R.id.divider);
-
-			titleTv.setText(getGroupTitle(type));
-			divider.setVisibility(isExpanded || isLastGroup ? View.GONE : View.VISIBLE);
-			CompoundButtonCompat.setButtonTintList(checkBox, ColorStateList.valueOf(ContextCompat.getColor(app, profileColor)));
-
-			final List<?> listItems = list.get(groupPosition).getItems();
-			subTextTv.setText(String.valueOf(listItems.size()));
-
-			checkBox.setChecked(dataToOperate.containsAll(listItems));
-			checkBox.setOnClickListener(new View.OnClickListener() {
-				@Override
-				public void onClick(View view) {
-
-					if (checkBox.isChecked()) {
-						for (Object object : listItems) {
-							if (!dataToOperate.contains(object)) {
-								dataToOperate.add(object);
-							}
-						}
-					} else {
-						dataToOperate.removeAll(listItems);
-					}
-					notifyDataSetInvalidated();
-				}
-			});
-
-			adjustIndicator(app, groupPosition, isExpanded, group, true);
-
-			return group;
-		}
-
-		@Override
-		public View getChildView(int groupPosition, final int childPosition, boolean isLastChild, View convertView, ViewGroup parent) {
-			View child = convertView;
-			if (child == null) {
-				LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
-				child = inflater.inflate(R.layout.profile_data_list_item_child, parent, false);
-			}
-			final Object currentItem = list.get(groupPosition).getItems().get(childPosition);
-
-
-			boolean isLastGroup = groupPosition == getGroupCount() - 1;
-			final AdditionalDataWrapper.Type type = list.get(groupPosition).getType();
-
-			TextView title = child.findViewById(R.id.title_tv);
-			final CheckBox checkBox = child.findViewById(R.id.check_box);
-			ImageView icon = child.findViewById(R.id.icon);
-			View divider = child.findViewById(R.id.divider);
-
-			divider.setVisibility(isLastChild && !isLastGroup ? View.VISIBLE : View.GONE);
-			CompoundButtonCompat.setButtonTintList(checkBox, ColorStateList.valueOf(ContextCompat.getColor(app, profileColor)));
-
-			checkBox.setChecked(dataToOperate.contains(currentItem));
-			checkBox.setOnClickListener(new View.OnClickListener() {
-				@Override
-				public void onClick(View view) {
-					if (checkBox.isChecked()) {
-						dataToOperate.add(currentItem);
-					} else {
-						dataToOperate.remove(currentItem);
-					}
-					notifyDataSetInvalidated();
-				}
-			});
-
-			switch (type) {
-				case QUICK_ACTIONS:
-					title.setText(((QuickAction) currentItem).getName(app.getApplicationContext()));
-					icon.setVisibility(View.INVISIBLE);
-					icon.setImageResource(R.drawable.ic_action_info_dark);
-					break;
-				case POI_TYPES:
-					title.setText(((PoiUIFilter) currentItem).getName());
-					icon.setVisibility(View.VISIBLE);
-					int iconRes = RenderingIcons.getBigIconResourceId(((PoiUIFilter) currentItem).getIconId());
-					icon.setImageDrawable(app.getUIUtilities().getIcon(iconRes != 0 ? iconRes : R.drawable.ic_person, profileColor));
-					break;
-				case MAP_SOURCES:
-					title.setText(((ITileSource) currentItem).getName());
-					icon.setVisibility(View.INVISIBLE);
-					icon.setImageResource(R.drawable.ic_action_info_dark);
-					break;
-				case CUSTOM_RENDER_STYLE:
-					String renderName = ((File) currentItem).getName();
-					renderName = renderName.replace('_', ' ').replaceAll(".render.xml", "");
-					title.setText(renderName);
-					icon.setVisibility(View.INVISIBLE);
-					icon.setImageResource(R.drawable.ic_action_info_dark);
-					break;
-				case CUSTOM_ROUTING:
-					String routingName = ((File) currentItem).getName();
-					routingName = routingName.replace('_', ' ').replaceAll(".xml", "");
-					title.setText(routingName);
-					icon.setVisibility(View.INVISIBLE);
-					icon.setImageResource(R.drawable.ic_action_info_dark);
-					break;
-				default:
-					return child;
-			}
-			return child;
-		}
-
-		@Override
-		public boolean isChildSelectable(int i, int i1) {
-			return false;
-		}
-
-		private int getGroupTitle(AdditionalDataWrapper.Type type) {
-			switch (type) {
-				case QUICK_ACTIONS:
-					return R.string.configure_screen_quick_action;
-				case POI_TYPES:
-					return R.string.poi_dialog_poi_type;
-				case MAP_SOURCES:
-					return R.string.quick_action_map_source_title;
-				case CUSTOM_RENDER_STYLE:
-					return R.string.shared_string_custom_rendering_style;
-				case CUSTOM_ROUTING:
-					return R.string.shared_string_routing;
-				default:
-					return R.string.access_empty_list;
-			}
-		}
-	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/settings/ExportImportSettingsAdapter.java b/OsmAnd/src/net/osmand/plus/settings/ExportImportSettingsAdapter.java
index 2a9d82f0e64..f28f3e08e55 100644
--- a/OsmAnd/src/net/osmand/plus/settings/ExportImportSettingsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/settings/ExportImportSettingsAdapter.java
@@ -1,16 +1,21 @@
 package net.osmand.plus.settings;
 
+import android.content.res.ColorStateList;
+import android.support.v4.content.ContextCompat;
+import android.support.v4.widget.CompoundButtonCompat;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.CheckBox;
 import android.widget.ImageView;
 import android.widget.TextView;
+import android.widget.Toast;
 
 import net.osmand.map.ITileSource;
 import net.osmand.plus.ApplicationMode;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
+import net.osmand.plus.UiUtilities;
 import net.osmand.plus.activities.OsmandBaseExpandableListAdapter;
 import net.osmand.plus.poi.PoiUIFilter;
 import net.osmand.plus.profiles.AdditionalDataWrapper;
@@ -24,131 +29,71 @@
 class ExportImportSettingsAdapter extends OsmandBaseExpandableListAdapter {
 
 	private OsmandApplication app;
-
-	private List<? super Object> settingsToOperate;
-
-	private List<AdditionalDataWrapper> settingsList;
-
+	private List<? super Object> dataToOperate;
+	private List<AdditionalDataWrapper> dataList;
 	private boolean nightMode;
-
 	private boolean importState;
+	private int profileColor;
 
-	ExportImportSettingsAdapter(OsmandApplication app, List<AdditionalDataWrapper> settingsList, boolean nightMode, boolean importState) {
+	ExportImportSettingsAdapter(OsmandApplication app, List<AdditionalDataWrapper> dataList, boolean nightMode, boolean importState) {
 		this.app = app;
-		this.settingsList = settingsList;
+		this.dataList = dataList;
 		this.nightMode = nightMode;
 		this.importState = importState;
-		this.settingsToOperate = new ArrayList<>();
-	}
-
-	public void updateSettingsList(List<AdditionalDataWrapper> settingsList) {
-		this.settingsList = settingsList;
-		notifyDataSetChanged();
-	}
-
-	public List<? super Object> getSettingsToOperate() {
-		return this.settingsToOperate;
-	}
-
-	public void selectAll(boolean selectAll) {
-		settingsToOperate.clear();
-		if (selectAll) {
-			for (AdditionalDataWrapper item : settingsList) {
-				settingsToOperate.addAll(item.getItems());
+		this.dataToOperate = new ArrayList<>();
+		this.profileColor = app.getSettings().getApplicationMode().getIconColorInfo().getColor(nightMode);
+		if (!importState) {
+			for (AdditionalDataWrapper dataWrapper : dataList) {
+				dataToOperate.addAll(dataWrapper.getItems());
 			}
 		}
-		notifyDataSetChanged();
-	}
-
-	@Override
-	public int getGroupCount() {
-		return settingsList.size();
-	}
-
-	@Override
-	public int getChildrenCount(int i) {
-		return settingsList.get(i).getItems().size();
-	}
-
-	@Override
-	public Object getGroup(int i) {
-		return settingsList.get(i);
-	}
-
-	@Override
-	public Object getChild(int groupPosition, int childPosition) {
-		return settingsList.get(groupPosition).getItems().get(childPosition);
-	}
-
-	@Override
-	public long getGroupId(int i) {
-		return i;
-	}
-
-	@Override
-	public long getChildId(int groupPosition, int childPosition) {
-		return groupPosition * 10000 + childPosition;
-	}
-
-	@Override
-	public boolean hasStableIds() {
-		return false;
 	}
 
 	@Override
 	public View getGroupView(int groupPosition, boolean isExpanded, View convertView, ViewGroup parent) {
 		View group = convertView;
 		if (group == null) {
-//			LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
-			LayoutInflater inflater = LayoutInflater.from(app);
+			LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
 			group = inflater.inflate(R.layout.profile_data_list_item_group, parent, false);
 		}
 
 		boolean isLastGroup = groupPosition == getGroupCount() - 1;
-		final AdditionalDataWrapper.Type type = settingsList.get(groupPosition).getType();
+		final AdditionalDataWrapper.Type type = dataList.get(groupPosition).getType();
 
 		TextView titleTv = group.findViewById(R.id.title_tv);
 		TextView subTextTv = group.findViewById(R.id.sub_text_tv);
 		final CheckBox checkBox = group.findViewById(R.id.check_box);
 		ImageView expandIv = group.findViewById(R.id.explist_indicator);
-		View divider = group.findViewById(R.id.divider);
+		View lineDivider = group.findViewById(R.id.divider);
 		View cardTopDivider = group.findViewById(R.id.card_top_divider);
 		View cardBottomDivider = group.findViewById(R.id.card_bottom_divider);
 
 		titleTv.setText(getGroupTitle(type));
+		lineDivider.setVisibility(importState || isExpanded || isLastGroup ? View.GONE : View.VISIBLE);
 		cardTopDivider.setVisibility(importState ? View.VISIBLE : View.GONE);
-		if (importState) {
-			cardBottomDivider.setVisibility(isExpanded ? View.GONE : View.VISIBLE);
-			divider.setVisibility(View.GONE);
-		} else {
-			cardBottomDivider.setVisibility(View.GONE);
-			divider.setVisibility(isExpanded || isLastGroup ? View.GONE : View.VISIBLE);
-		}
-//		CompoundButtonCompat.setButtonTintList(checkBox, ColorStateList.valueOf(ContextCompat.getColor(app, profileColor)));
+		cardBottomDivider.setVisibility(importState && !isExpanded ? View.VISIBLE : View.GONE);
+		CompoundButtonCompat.setButtonTintList(checkBox, ColorStateList.valueOf(ContextCompat.getColor(app, profileColor)));
 
-		final List<?> listItems = settingsList.get(groupPosition).getItems();
+		final List<?> listItems = dataList.get(groupPosition).getItems();
 		subTextTv.setText(String.valueOf(listItems.size()));
 
-		checkBox.setChecked(settingsToOperate.containsAll(listItems));
+		checkBox.setChecked(dataToOperate.containsAll(listItems));
 		checkBox.setOnClickListener(new View.OnClickListener() {
 			@Override
 			public void onClick(View view) {
-
 				if (checkBox.isChecked()) {
 					for (Object object : listItems) {
-						if (!settingsToOperate.contains(object)) {
-							settingsToOperate.add(object);
+						if (!dataToOperate.contains(object)) {
+							dataToOperate.add(object);
 						}
 					}
 				} else {
-					settingsToOperate.removeAll(listItems);
+					dataToOperate.removeAll(listItems);
 				}
-				notifyDataSetInvalidated();
+				notifyDataSetChanged();
 			}
 		});
-
 		adjustIndicator(app, groupPosition, isExpanded, group, true);
-
 		return group;
 	}
 
@@ -156,76 +101,81 @@ public void onClick(View view) {
 	public View getChildView(int groupPosition, final int childPosition, boolean isLastChild, View convertView, ViewGroup parent) {
 		View child = convertView;
 		if (child == null) {
-//			LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
-			LayoutInflater inflater = LayoutInflater.from(app);
+			LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
 			child = inflater.inflate(R.layout.profile_data_list_item_child, parent, false);
 		}
-		final Object currentItem = settingsList.get(groupPosition).getItems().get(childPosition);
-
+		final Object currentItem = dataList.get(groupPosition).getItems().get(childPosition);
 
 		boolean isLastGroup = groupPosition == getGroupCount() - 1;
-		final AdditionalDataWrapper.Type type = settingsList.get(groupPosition).getType();
+		final AdditionalDataWrapper.Type type = dataList.get(groupPosition).getType();
 
 		TextView title = child.findViewById(R.id.title_tv);
-//		TextView subText = child.findViewById(R.id.sub_text_tv);
+		TextView subText = child.findViewById(R.id.sub_title_tv);
 		final CheckBox checkBox = child.findViewById(R.id.check_box);
 		ImageView icon = child.findViewById(R.id.icon);
-		View divider = child.findViewById(R.id.divider);
+		View lineDivider = child.findViewById(R.id.divider);
 		View cardBottomDivider = child.findViewById(R.id.card_bottom_divider);
 
-		divider.setVisibility(isLastChild && !isLastGroup && !importState ? View.VISIBLE : View.GONE);
-		cardBottomDivider.setVisibility(isLastChild && importState ? View.VISIBLE : View.GONE);
-//		CompoundButtonCompat.setButtonTintList(checkBox, ColorStateList.valueOf(ContextCompat.getColor(app, profileColor)));
+		lineDivider.setVisibility(!importState && isLastChild && !isLastGroup ? View.VISIBLE : View.GONE);
+		cardBottomDivider.setVisibility(importState && isLastChild ? View.VISIBLE : View.GONE);
+		CompoundButtonCompat.setButtonTintList(checkBox, ColorStateList.valueOf(ContextCompat.getColor(app, profileColor)));
 
-		checkBox.setChecked(settingsToOperate.contains(currentItem));
-		checkBox.setOnClickListener(new View.OnClickListener() {
+		checkBox.setChecked(dataToOperate.contains(currentItem));
+		checkBox.setClickable(false);
+		child.setOnClickListener(new View.OnClickListener() {
 			@Override
 			public void onClick(View view) {
-				if (checkBox.isChecked()) {
-					settingsToOperate.add(currentItem);
+				if (dataToOperate.contains(currentItem)) {
+					dataToOperate.remove(currentItem);
 				} else {
-					settingsToOperate.remove(currentItem);
+					dataToOperate.add(currentItem);
 				}
-				notifyDataSetInvalidated();
+				notifyDataSetChanged();
 			}
 		});
 
 		switch (type) {
 			case PROFILE:
 				title.setText(((ApplicationMode) currentItem).toHumanString());
-//				subText.setText(((ApplicationMode) currentItem));
-				icon.setVisibility(View.INVISIBLE);
-				icon.setImageResource(((ApplicationMode) currentItem).getIconRes());
+				subText.setText(((ApplicationMode) currentItem).getDescription());
+				icon.setImageDrawable(app.getUIUtilities().getIcon(((ApplicationMode) currentItem).getIconRes(), profileColor));
+				subText.setVisibility(View.VISIBLE);
+				icon.setVisibility(View.VISIBLE);
 				break;
 			case QUICK_ACTIONS:
 				title.setText(((QuickAction) currentItem).getName(app.getApplicationContext()));
-				icon.setVisibility(View.INVISIBLE);
-				icon.setImageResource(R.drawable.ic_action_info_dark);
+				icon.setImageDrawable(app.getUIUtilities().getIcon(((QuickAction) currentItem).getIconRes(), nightMode));
+				subText.setVisibility(View.GONE);
+				icon.setVisibility(View.VISIBLE);
 				break;
 			case POI_TYPES:
 				title.setText(((PoiUIFilter) currentItem).getName());
-				icon.setVisibility(View.VISIBLE);
 				int iconRes = RenderingIcons.getBigIconResourceId(((PoiUIFilter) currentItem).getIconId());
-//				icon.setImageDrawable(app.getUIUtilities().getIcon(iconRes != 0 ? iconRes : R.drawable.ic_person, profileColor));
+				icon.setImageDrawable(app.getUIUtilities().getIcon(iconRes != 0 ? iconRes : R.drawable.ic_person, profileColor));
+				subText.setVisibility(View.GONE);
+				icon.setVisibility(View.VISIBLE);
 				break;
 			case MAP_SOURCES:
 				title.setText(((ITileSource) currentItem).getName());
-				icon.setVisibility(View.INVISIBLE);
 				icon.setImageResource(R.drawable.ic_action_info_dark);
+				subText.setVisibility(View.GONE);
+				icon.setVisibility(View.INVISIBLE);
 				break;
 			case CUSTOM_RENDER_STYLE:
 				String renderName = ((File) currentItem).getName();
 				renderName = renderName.replace('_', ' ').replaceAll(".render.xml", "");
 				title.setText(renderName);
-				icon.setVisibility(View.INVISIBLE);
 				icon.setImageResource(R.drawable.ic_action_info_dark);
+				icon.setVisibility(View.INVISIBLE);
+				subText.setVisibility(View.GONE);
 				break;
 			case CUSTOM_ROUTING:
 				String routingName = ((File) currentItem).getName();
 				routingName = routingName.replace('_', ' ').replaceAll(".xml", "");
 				title.setText(routingName);
-				icon.setVisibility(View.INVISIBLE);
-				icon.setImageResource(R.drawable.ic_action_info_dark);
+				icon.setImageResource(R.drawable.ic_action_map_style);
+				icon.setVisibility(View.VISIBLE);
+				subText.setVisibility(View.GONE);
 				break;
 			default:
 				return child;
@@ -234,10 +184,45 @@ public void onClick(View view) {
 	}
 
 	@Override
-	public boolean isChildSelectable(int i, int i1) {
+	public int getGroupCount() {
+		return dataList.size();
+	}
+
+	@Override
+	public int getChildrenCount(int i) {
+		return dataList.get(i).getItems().size();
+	}
+
+	@Override
+	public Object getGroup(int i) {
+		return dataList.get(i);
+	}
+
+	@Override
+	public Object getChild(int groupPosition, int childPosition) {
+		return dataList.get(groupPosition).getItems().get(childPosition);
+	}
+
+	@Override
+	public long getGroupId(int i) {
+		return i;
+	}
+
+	@Override
+	public long getChildId(int groupPosition, int childPosition) {
+		return groupPosition * 10000 + childPosition;
+	}
+
+	@Override
+	public boolean hasStableIds() {
 		return false;
 	}
 
+	@Override
+	public boolean isChildSelectable(int i, int i1) {
+		return true;
+	}
+
 	private int getGroupTitle(AdditionalDataWrapper.Type type) {
 		switch (type) {
 			case PROFILE:
@@ -256,5 +241,23 @@ private int getGroupTitle(AdditionalDataWrapper.Type type) {
 				return R.string.access_empty_list;
 		}
 	}
-}
 
+	public void updateSettingsList(List<AdditionalDataWrapper> settingsList) {
+		this.dataList = settingsList;
+		notifyDataSetChanged();
+	}
+
+	public void selectAll(boolean selectAll) {
+		dataToOperate.clear();
+		if (selectAll) {
+			for (AdditionalDataWrapper item : dataList) {
+				dataToOperate.addAll(item.getItems());
+			}
+		}
+		notifyDataSetChanged();
+	}
+
+	List<? super Object> getDataToOperate() {
+		return this.dataToOperate;
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/ImportDuplicatesFragment.java b/OsmAnd/src/net/osmand/plus/settings/ImportDuplicatesFragment.java
index 25e0ecd6247..8fe5428767f 100644
--- a/OsmAnd/src/net/osmand/plus/settings/ImportDuplicatesFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/ImportDuplicatesFragment.java
@@ -11,12 +11,15 @@
 import android.view.View;
 import android.view.ViewGroup;
 
+import net.osmand.map.ITileSource;
 import net.osmand.plus.ApplicationMode;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.SettingsHelper;
 import net.osmand.plus.SettingsHelper.SettingsItem;
+import net.osmand.plus.UiUtilities;
 import net.osmand.plus.base.BaseOsmAndDialogFragment;
+import net.osmand.plus.poi.PoiUIFilter;
 import net.osmand.plus.quickaction.QuickAction;
 import net.osmand.view.ComplexButton;
 
@@ -34,6 +37,7 @@ public class ImportDuplicatesFragment extends BaseOsmAndDialogFragment implement
 	private List<SettingsItem> settingsItems;
 	private DuplicatesSettingsAdapter adapter;
 	private File file;
+	private boolean nightMode;
 
 	public static void showInstance(@NonNull FragmentManager fm, List<? super Object> duplicatesList,
 									List<SettingsItem> settingsItems, File file) {
@@ -48,24 +52,26 @@ public static void showInstance(@NonNull FragmentManager fm, List<? super Object
 	public void onCreate(Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = getMyApplication();
+		nightMode = !getSettings().isLightContent();
 	}
 
 	@Nullable
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+		inflater = UiUtilities.getInflater(app, nightMode);
 		View root = inflater.inflate(R.layout.fragment_import_duplicates, container, false);
 		setupToolbar((Toolbar) root.findViewById(R.id.toolbar));
 		ComplexButton replaceAllBtn = root.findViewById(R.id.replace_all_btn);
 		ComplexButton keepBothBtn = root.findViewById(R.id.keep_both_btn);
 		keepBothBtn.setIcon(getPaintedContentIcon(R.drawable.ic_action_keep_both,
-				getSettings().isLightContent()
-						? getResources().getColor(R.color.icon_color_active_light)
-						: getResources().getColor(R.color.icon_color_active_dark))
+				nightMode
+						? getResources().getColor(R.color.icon_color_active_dark)
+						: getResources().getColor(R.color.icon_color_active_light))
 		);
 		replaceAllBtn.setIcon(getPaintedContentIcon(R.drawable.ic_action_replace,
-				getSettings().isLightContent()
-						? getResources().getColor(R.color.active_buttons_and_links_text_light)
-						: getResources().getColor(R.color.active_buttons_and_links_text_dark))
+				nightMode
+						? getResources().getColor(R.color.active_buttons_and_links_text_dark)
+						: getResources().getColor(R.color.active_buttons_and_links_text_light))
 		);
 		keepBothBtn.setOnClickListener(this);
 		replaceAllBtn.setOnClickListener(this);
@@ -77,33 +83,61 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c
 	@Override
 	public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
 		super.onViewCreated(view, savedInstanceState);
-		adapter = new DuplicatesSettingsAdapter(getMyApplication(), prepareDuplicates(), getSettings().isLightContent());
+		adapter = new DuplicatesSettingsAdapter(getMyApplication(), prepareDuplicates(), nightMode);
 		list.setLayoutManager(new LinearLayoutManager(getMyApplication()));
 		list.setAdapter(adapter);
 	}
 
 	private List<Object> prepareDuplicates() {
-		List<Object> duplicates = new ArrayList<>();
+		List<? super Object> duplicates = new ArrayList<>();
 		List<ApplicationMode> profiles = new ArrayList<>();
 		List<QuickAction> actions = new ArrayList<>();
+		List<PoiUIFilter> filters = new ArrayList<>();
+		List<ITileSource> tileSources = new ArrayList<>();
+		List<File> renderFilesList = new ArrayList<>();
+		List<File> routingFilesList = new ArrayList<>();
 
 		for (Object object : duplicatesList) {
 			if (object instanceof ApplicationMode) {
 				profiles.add((ApplicationMode) object);
 			} else if (object instanceof QuickAction) {
 				actions.add((QuickAction) object);
+			} else if (object instanceof PoiUIFilter) {
+				filters.add((PoiUIFilter) object);
+			} else if (object instanceof ITileSource) {
+				tileSources.add((ITileSource) object);
+			} else if (object instanceof File) {
+				if (((File) object).getAbsolutePath().contains("files/rendering")) {
+					renderFilesList.add((File) object);
+				} else if (((File) object).getAbsolutePath().contains("files/routing")) {
+					routingFilesList.add((File) object);
+				}
 			}
 		}
-
 		if (!profiles.isEmpty()) {
 			duplicates.add(getString(R.string.shared_sting_profiles));
 			duplicates.addAll(profiles);
 		}
-
 		if (!actions.isEmpty()) {
 			duplicates.add(getString(R.string.shared_sting_quick_actions));
 			duplicates.addAll(actions);
 		}
+		if (!filters.isEmpty()) {
+			duplicates.add(getString(R.string.shared_sting_poi_types));
+			duplicates.addAll(filters);
+		}
+		if (!tileSources.isEmpty()) {
+			duplicates.add(getString(R.string.quick_action_map_source_title));
+			duplicates.addAll(tileSources);
+		}
+		if (!routingFilesList.isEmpty()) {
+			duplicates.add(getString(R.string.shared_string_routing));
+			duplicates.addAll(routingFilesList);
+		}
+		if (!renderFilesList.isEmpty()) {
+			duplicates.add(getString(R.string.shared_string_custom_rendering_style));
+			duplicates.addAll(renderFilesList);
+		}
 		return duplicates;
 	}
 
@@ -140,9 +174,9 @@ public void onSettingsImportFinished(boolean succeed, boolean empty, @NonNull Li
 
 	private void setupToolbar(Toolbar toolbar) {
 		toolbar.setNavigationIcon(getPaintedContentIcon(R.drawable.ic_arrow_back,
-				getSettings().isLightContent()
-						? getResources().getColor(R.color.active_buttons_and_links_text_light)
-						: getResources().getColor(R.color.active_buttons_and_links_text_dark)));
+				nightMode
+						? getResources().getColor(R.color.active_buttons_and_links_text_dark)
+						: getResources().getColor(R.color.active_buttons_and_links_text_light)));
 		toolbar.setNavigationContentDescription(R.string.access_shared_string_navigate_up);
 		toolbar.setNavigationOnClickListener(new View.OnClickListener() {
 			@Override
diff --git a/OsmAnd/src/net/osmand/plus/settings/ImportSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/ImportSettingsFragment.java
index b3a5931e258..26e52fd610f 100644
--- a/OsmAnd/src/net/osmand/plus/settings/ImportSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/ImportSettingsFragment.java
@@ -1 +1 @@
-package net.osmand.plus.settings;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.annotation.Nullable;import android.support.v4.app.FragmentManager;import android.support.v7.widget.Toolbar;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ExpandableListView;import net.osmand.map.ITileSource;import net.osmand.map.TileSourceManager;import net.osmand.plus.ApplicationMode;import net.osmand.plus.OsmandApplication;import net.osmand.plus.R;import net.osmand.plus.SQLiteTileSource;import net.osmand.plus.SettingsHelper;import net.osmand.plus.SettingsHelper.SettingsItem;import net.osmand.plus.base.BaseOsmAndDialogFragment;import net.osmand.plus.poi.PoiUIFilter;import net.osmand.plus.profiles.AdditionalDataWrapper;import net.osmand.plus.quickaction.QuickAction;import net.osmand.plus.widgets.TextViewEx;import java.io.File;import java.util.ArrayList;import java.util.List;public class ImportSettingsFragment extends BaseOsmAndDialogFragment		implements View.OnClickListener {	public static final String TAG = ImportSettingsFragment.class.getSimpleName();	private OsmandApplication app;	private ExportImportSettingsAdapter adapter;	private ExpandableListView expandableList;	private TextViewEx selectBtn;	private List<SettingsItem> settingsItems;	private File file;	private boolean allSelected;	public static void showInstance(@NonNull FragmentManager fm, @NonNull List<SettingsItem> settingsItems, @NonNull File file) {		ImportSettingsFragment fragment = new ImportSettingsFragment();		fragment.setSettingsItems(settingsItems);		fragment.setFile(file);		fragment.show(fm, TAG);	}	@Override	public void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		app = getMyApplication();		if (settingsItems == null) {			settingsItems = app.getSettingsHelper().getSettingsItems();		}		if (file == null) {			file = app.getSettingsHelper().getSettingsFile();		}	}	@Nullable	@Override	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {		View root = inflater.inflate(R.layout.fragment_import, container, false);		setupToolbar((Toolbar) root.findViewById(R.id.toolbar));		TextViewEx continueBtn = root.findViewById(R.id.continue_button);		selectBtn = root.findViewById(R.id.select_button);		expandableList = root.findViewById(android.R.id.list);		continueBtn.setOnClickListener(this);		selectBtn.setOnClickListener(this);		expandableList.findViewById(R.id.list);		return root;	}	@Override	public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {		super.onViewCreated(view, savedInstanceState);		adapter = new ExportImportSettingsAdapter(getMyApplication(), getSettingsToOperate(), getSettings().isLightContent(), true);		expandableList.setAdapter(adapter);	}	@Override	public void onClick(View view) {		switch (view.getId()) {			case R.id.select_button: {				allSelected = !allSelected;				selectBtn.setText(allSelected ? R.string.shared_string_deselect_all : R.string.shared_string_select_all);				adapter.selectAll(allSelected);				break;			}			case R.id.continue_button: {				if (adapter.getSettingsToOperate().isEmpty()) {					app.showShortToastMessage(getString(R.string.shared_sting_nothing_selected));				} else {					importItems();				}				break;			}		}	}	private void importItems() {		List<SettingsItem> settingsItems = getSettingsItemsFromData(adapter.getSettingsToOperate());		List<Object> duplicateItems = getDuplicatesData(settingsItems);		if (duplicateItems.isEmpty()) {			app.getSettingsHelper().importSettings(file, settingsItems, "", 1, new SettingsHelper.SettingsImportListener() {				@Override				public void onSettingsImportFinished(boolean succeed, boolean empty, @NonNull List<SettingsHelper.SettingsItem> items) {					if (succeed) {						app.showShortToastMessage(app.getString(R.string.file_imported_successfully, file.getName()));					} else if (empty) {						app.showShortToastMessage(app.getString(R.string.file_import_error, file.getName(), app.getString(R.string.shared_string_unexpected_error)));					}				}			});			dismiss();		} else {			ImportDuplicatesFragment.showInstance(getChildFragmentManager(), duplicateItems, settingsItems, file);		}	}	private List<Object> getDuplicatesData(List<SettingsItem> items) {		List<Object> duplicateItems = new ArrayList<>();		for (SettingsItem item : items) {			if (item instanceof SettingsHelper.ProfileSettingsItem) {				if (((SettingsHelper.ProfileSettingsItem) item).exists()) {					duplicateItems.add(((SettingsHelper.ProfileSettingsItem) item).getAppMode());				}			} else if (item instanceof SettingsHelper.QuickActionSettingsItem) {				List<QuickAction> duplicates = ((SettingsHelper.QuickActionSettingsItem) item).getDuplicates();				if (!duplicates.isEmpty()) {					duplicateItems.addAll(duplicates);				}			}		}		return duplicateItems;	}	public void setSettingsItems(List<SettingsItem> settingsItems) {		this.settingsItems = settingsItems;	}	private List<SettingsItem> getSettingsItemsFromData(List<Object> dataToOperate) {		List<SettingsItem> settingsItems = new ArrayList<>();		List<QuickAction> quickActions = new ArrayList<>();		List<PoiUIFilter> poiUIFilters = new ArrayList<>();		List<ITileSource> tileSourceTemplates = new ArrayList<>();		for (Object object : dataToOperate) {			if (object instanceof ApplicationMode) {				settingsItems.add(new SettingsHelper.ProfileSettingsItem(getSettings(), (ApplicationMode) object));			}			if (object instanceof QuickAction) {				quickActions.add((QuickAction) object);			} else if (object instanceof PoiUIFilter) {				poiUIFilters.add((PoiUIFilter) object);			} else if (object instanceof TileSourceManager.TileSourceTemplate					|| object instanceof SQLiteTileSource) {				tileSourceTemplates.add((ITileSource) object);			} else if (object instanceof File) {				settingsItems.add(new SettingsHelper.FileSettingsItem(getMyApplication(), (File) object));			}		}		if (!quickActions.isEmpty()) {			settingsItems.add(new SettingsHelper.QuickActionSettingsItem(getMyApplication(), quickActions));		}		if (!poiUIFilters.isEmpty()) {			settingsItems.add(new SettingsHelper.PoiUiFilterSettingsItem(getMyApplication(), poiUIFilters));		}		if (!tileSourceTemplates.isEmpty()) {			settingsItems.add(new SettingsHelper.MapSourcesSettingsItem(getMyApplication(), tileSourceTemplates));		}		return settingsItems;	}	private List<AdditionalDataWrapper> getSettingsToOperate() {		List<AdditionalDataWrapper> settingsToOperate = new ArrayList<>();		List<ApplicationMode> profiles = new ArrayList<>();		List<QuickAction> quickActions = new ArrayList<>();		List<PoiUIFilter> poiUIFilters = new ArrayList<>();		List<ITileSource> tileSourceTemplates = new ArrayList<>();		List<File> routingFilesList = new ArrayList<>();		List<File> renderFilesList = new ArrayList<>();		for (SettingsHelper.SettingsItem item : settingsItems) {			if (item.getType().equals(SettingsHelper.SettingsItemType.PROFILE)) {				profiles.add(((SettingsHelper.ProfileSettingsItem) item).getAppMode());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.QUICK_ACTION)) {				quickActions.addAll(((SettingsHelper.QuickActionSettingsItem) item).getQuickActions());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.POI_UI_FILTERS)) {				poiUIFilters.addAll(((SettingsHelper.PoiUiFilterSettingsItem) item).getPoiUIFilters());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.MAP_SOURCES)) {				tileSourceTemplates.addAll(((SettingsHelper.MapSourcesSettingsItem) item).getMapSources());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.FILE)) {				if (item.getName().startsWith("/rendering/")) {					renderFilesList.add(((SettingsHelper.FileSettingsItem) item).getFile());				} else if (item.getName().startsWith("/routing/")) {					routingFilesList.add(((SettingsHelper.FileSettingsItem) item).getFile());				}			}		}		if (!profiles.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.PROFILE,					profiles));		}		if (!quickActions.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.QUICK_ACTIONS,					quickActions));		}		if (!poiUIFilters.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.POI_TYPES,					poiUIFilters));		}		if (!tileSourceTemplates.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.MAP_SOURCES,					tileSourceTemplates			));		}		if (!renderFilesList.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.CUSTOM_RENDER_STYLE,					renderFilesList			));		}		if (!routingFilesList.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.CUSTOM_ROUTING,					routingFilesList			));		}		return settingsToOperate;	}	private void setupToolbar(Toolbar toolbar) {		toolbar.setNavigationIcon(getPaintedContentIcon(R.drawable.headline_close_button,				getSettings().isLightContent()						? getResources().getColor(R.color.active_buttons_and_links_text_light)						: getResources().getColor(R.color.active_buttons_and_links_text_dark)));		toolbar.setNavigationContentDescription(R.string.shared_string_close);		toolbar.setNavigationOnClickListener(new View.OnClickListener() {			@Override			public void onClick(View v) {				dismiss();			}		});	}	public void setFile(File file) {		this.file = file;	}}
\ No newline at end of file
+package net.osmand.plus.settings;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.annotation.Nullable;import android.support.v4.app.FragmentManager;import android.support.v7.widget.Toolbar;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ExpandableListView;import net.osmand.map.ITileSource;import net.osmand.map.TileSourceManager;import net.osmand.plus.ApplicationMode;import net.osmand.plus.OsmandApplication;import net.osmand.plus.R;import net.osmand.plus.SQLiteTileSource;import net.osmand.plus.SettingsHelper;import net.osmand.plus.SettingsHelper.SettingsItem;import net.osmand.plus.UiUtilities;import net.osmand.plus.base.BaseOsmAndDialogFragment;import net.osmand.plus.poi.PoiUIFilter;import net.osmand.plus.profiles.AdditionalDataWrapper;import net.osmand.plus.quickaction.QuickAction;import net.osmand.plus.widgets.TextViewEx;import java.io.File;import java.util.ArrayList;import java.util.List;public class ImportSettingsFragment extends BaseOsmAndDialogFragment		implements View.OnClickListener {	public static final String TAG = ImportSettingsFragment.class.getSimpleName();	private OsmandApplication app;	private ExportImportSettingsAdapter adapter;	private ExpandableListView expandableList;	private TextViewEx selectBtn;	private List<SettingsItem> settingsItems;	private File file;	private boolean allSelected;	private boolean nightMode;	public static void showInstance(@NonNull FragmentManager fm, @NonNull List<SettingsItem> settingsItems, @NonNull File file) {		ImportSettingsFragment fragment = new ImportSettingsFragment();		fragment.setSettingsItems(settingsItems);		fragment.setFile(file);		fragment.show(fm, TAG);	}	@Override	public void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		app = getMyApplication();		nightMode = !getSettings().isLightContent();		if (settingsItems == null) {			settingsItems = app.getSettingsHelper().getSettingsItems();		}		if (file == null) {			file = app.getSettingsHelper().getSettingsFile();		}	}	@Nullable	@Override	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {		inflater = UiUtilities.getInflater(app, nightMode);		View root = inflater.inflate(R.layout.fragment_import, container, false);		setupToolbar((Toolbar) root.findViewById(R.id.toolbar));		TextViewEx continueBtn = root.findViewById(R.id.continue_button);		selectBtn = root.findViewById(R.id.select_button);		expandableList = root.findViewById(R.id.list);		continueBtn.setOnClickListener(this);		selectBtn.setOnClickListener(this);		return root;	}	@Override	public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {		super.onViewCreated(view, savedInstanceState);		adapter = new ExportImportSettingsAdapter(getMyApplication(), getSettingsToOperate(), nightMode, true);		expandableList.setAdapter(adapter);	}	@Override	public void onClick(View view) {		switch (view.getId()) {			case R.id.select_button: {				allSelected = !allSelected;				selectBtn.setText(allSelected ? R.string.shared_string_deselect_all : R.string.shared_string_select_all);				adapter.selectAll(allSelected);				break;			}			case R.id.continue_button: {				if (adapter.getDataToOperate().isEmpty()) {					app.showShortToastMessage(getString(R.string.shared_sting_nothing_selected));				} else {					importItems();				}				break;			}		}	}	private void importItems() {		List<SettingsItem> settingsItems = getSettingsItemsFromData(adapter.getDataToOperate());		List<Object> duplicateItems = getDuplicatesData(settingsItems);		if (duplicateItems.isEmpty()) {			app.getSettingsHelper().importSettings(file, settingsItems, "", 1, new SettingsHelper.SettingsImportListener() {				@Override				public void onSettingsImportFinished(boolean succeed, boolean empty, @NonNull List<SettingsHelper.SettingsItem> items) {					if (succeed) {						app.showShortToastMessage(app.getString(R.string.file_imported_successfully, file.getName()));					} else if (empty) {						app.showShortToastMessage(app.getString(R.string.file_import_error, file.getName(), app.getString(R.string.shared_string_unexpected_error)));					}				}			});			dismiss();		} else {			ImportDuplicatesFragment.showInstance(getChildFragmentManager(), duplicateItems, settingsItems, file);		}	}	private List<Object> getDuplicatesData(List<SettingsItem> items) {		List<Object> duplicateItems = new ArrayList<>();		for (SettingsItem item : items) {			if (item instanceof SettingsHelper.ProfileSettingsItem) {				if (((SettingsHelper.ProfileSettingsItem) item).exists()) {					duplicateItems.add(((SettingsHelper.ProfileSettingsItem) item).getAppMode());				}			} else if (item instanceof SettingsHelper.QuickActionSettingsItem) {				List<QuickAction> duplicates = ((SettingsHelper.QuickActionSettingsItem) item).getDuplicates();				if (!duplicates.isEmpty()) {					duplicateItems.addAll(duplicates);				}			} else if (item instanceof SettingsHelper.PoiUiFilterSettingsItem) {				List<PoiUIFilter> duplicates = ((SettingsHelper.PoiUiFilterSettingsItem) item).getDuplicates();				if (!duplicates.isEmpty()) {					duplicateItems.addAll(duplicates);				}			} else if (item instanceof SettingsHelper.MapSourcesSettingsItem) {				List<ITileSource> duplicates = ((SettingsHelper.MapSourcesSettingsItem) item).getDuplicates();				if (!duplicates.isEmpty()) {					duplicateItems.addAll(duplicates);				}			} else if (item instanceof SettingsHelper.FileSettingsItem) {				if (item.exists()) {					duplicateItems.add(((SettingsHelper.FileSettingsItem) item).getFile());				}			}		}		return duplicateItems;	}	public void setSettingsItems(List<SettingsItem> settingsItems) {		this.settingsItems = settingsItems;	}	private List<SettingsItem> getSettingsItemsFromData(List<Object> dataToOperate) {		List<SettingsItem> settingsItems = new ArrayList<>();		List<QuickAction> quickActions = new ArrayList<>();		List<PoiUIFilter> poiUIFilters = new ArrayList<>();		List<ITileSource> tileSourceTemplates = new ArrayList<>();		for (Object object : dataToOperate) {			if (object instanceof ApplicationMode) {				settingsItems.add(new SettingsHelper.ProfileSettingsItem(getSettings(), (ApplicationMode) object));			}			if (object instanceof QuickAction) {				quickActions.add((QuickAction) object);			} else if (object instanceof PoiUIFilter) {				poiUIFilters.add((PoiUIFilter) object);			} else if (object instanceof TileSourceManager.TileSourceTemplate					|| object instanceof SQLiteTileSource) {				tileSourceTemplates.add((ITileSource) object);			} else if (object instanceof File) {				settingsItems.add(new SettingsHelper.FileSettingsItem(getMyApplication(), (File) object));			}		}		if (!quickActions.isEmpty()) {			settingsItems.add(new SettingsHelper.QuickActionSettingsItem(getMyApplication(), quickActions));		}		if (!poiUIFilters.isEmpty()) {			settingsItems.add(new SettingsHelper.PoiUiFilterSettingsItem(getMyApplication(), poiUIFilters));		}		if (!tileSourceTemplates.isEmpty()) {			settingsItems.add(new SettingsHelper.MapSourcesSettingsItem(getMyApplication(), tileSourceTemplates));		}		return settingsItems;	}	private List<AdditionalDataWrapper> getSettingsToOperate() {		List<AdditionalDataWrapper> settingsToOperate = new ArrayList<>();		List<ApplicationMode> profiles = new ArrayList<>();		List<QuickAction> quickActions = new ArrayList<>();		List<PoiUIFilter> poiUIFilters = new ArrayList<>();		List<ITileSource> tileSourceTemplates = new ArrayList<>();		List<File> routingFilesList = new ArrayList<>();		List<File> renderFilesList = new ArrayList<>();		for (SettingsHelper.SettingsItem item : settingsItems) {			if (item.getType().equals(SettingsHelper.SettingsItemType.PROFILE)) {				profiles.add(((SettingsHelper.ProfileSettingsItem) item).getAppMode());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.QUICK_ACTION)) {				quickActions.addAll(((SettingsHelper.QuickActionSettingsItem) item).getQuickActions());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.POI_UI_FILTERS)) {				poiUIFilters.addAll(((SettingsHelper.PoiUiFilterSettingsItem) item).getPoiUIFilters());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.MAP_SOURCES)) {				tileSourceTemplates.addAll(((SettingsHelper.MapSourcesSettingsItem) item).getMapSources());			} else if (item.getType().equals(SettingsHelper.SettingsItemType.FILE)) {				if (item.getName().startsWith("/rendering/")) {					renderFilesList.add(((SettingsHelper.FileSettingsItem) item).getFile());				} else if (item.getName().startsWith("/routing/")) {					routingFilesList.add(((SettingsHelper.FileSettingsItem) item).getFile());				}			}		}		if (!profiles.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.PROFILE,					profiles));		}		if (!quickActions.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.QUICK_ACTIONS,					quickActions));		}		if (!poiUIFilters.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.POI_TYPES,					poiUIFilters));		}		if (!tileSourceTemplates.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.MAP_SOURCES,					tileSourceTemplates			));		}		if (!renderFilesList.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.CUSTOM_RENDER_STYLE,					renderFilesList			));		}		if (!routingFilesList.isEmpty()) {			settingsToOperate.add(new AdditionalDataWrapper(					AdditionalDataWrapper.Type.CUSTOM_ROUTING,					routingFilesList			));		}		return settingsToOperate;	}	private void setupToolbar(Toolbar toolbar) {		toolbar.setNavigationIcon(getPaintedContentIcon(R.drawable.headline_close_button, nightMode				? getResources().getColor(R.color.active_buttons_and_links_text_dark)				: getResources().getColor(R.color.active_buttons_and_links_text_light)));		toolbar.setNavigationContentDescription(R.string.shared_string_close);		toolbar.setNavigationOnClickListener(new View.OnClickListener() {			@Override			public void onClick(View v) {				dismiss();			}		});	}	public void setFile(File file) {		this.file = file;	}}
\ No newline at end of file
