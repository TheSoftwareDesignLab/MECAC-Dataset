diff --git a/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java b/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java
index 79c2e0a1dc3..108d81cdeb3 100644
--- a/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java
+++ b/OsmAnd-java/src/main/java/net/osmand/GPXUtilities.java
@@ -972,6 +972,7 @@ public void calculateElevationDiffs() {
 				if (pointsCount > 1) {
 					calcAvg(eleSumm, pointsCount, eleAvg);
 				}
+				diffElevationUp = Math.round(diffElevationUp + 0.3f);
 			}
 
 			private double calcAvg(double eleSumm, int pointsCount, double eleAvg) {
@@ -981,7 +982,7 @@ private double calcAvg(double eleSumm, int pointsCount, double eleAvg) {
 					if (diff > 0) {
 						diffElevationUp += diff;
 					} else {
-						diffElevationDown += diff;
+						diffElevationDown -= diff;
 					}
 				}
 				return avg;
diff --git a/OsmAnd/res/layout/main.xml b/OsmAnd/res/layout/main.xml
index 707ca4b2ff3..c66910e9255 100644
--- a/OsmAnd/res/layout/main.xml
+++ b/OsmAnd/res/layout/main.xml
@@ -1,6 +1,5 @@
 <?xml version="1.0" encoding="utf-8"?>
 <androidx.drawerlayout.widget.DrawerLayout xmlns:android="http://schemas.android.com/apk/res/android"
-	xmlns:tools="http://schemas.android.com/tools"
 	android:id="@+id/drawer_layout"
 	android:layout_width="match_parent"
 	android:layout_height="match_parent"
@@ -86,26 +85,6 @@
 
 			</FrameLayout>
 
-			<FrameLayout
-				android:id="@+id/topFragmentContainer"
-				android:layout_width="match_parent"
-				android:layout_height="match_parent" />
-
-			<FrameLayout
-				android:id="@+id/routeMenuContainer"
-				android:layout_width="match_parent"
-				android:layout_height="match_parent" />
-
-			<include
-				layout="@layout/dashboard_over_map"
-				android:layout_width="match_parent"
-				android:layout_height="match_parent" />
-
-			<FrameLayout
-				android:id="@+id/fragmentContainer"
-				android:layout_width="match_parent"
-				android:layout_height="match_parent" />
-
 			<View
 				android:layout_width="match_parent"
 				android:layout_height="match_parent" />
@@ -119,10 +98,42 @@
 
 		</FrameLayout>
 
-		<include layout="@layout/map_bottom" />
+		<include
+			android:id="@+id/MapBottomContainer"
+			layout="@layout/map_bottom" />
 
 	</LinearLayout>
 
+	<FrameLayout
+		android:layout_width="match_parent"
+		android:layout_height="match_parent">
+
+		<FrameLayout
+			android:id="@+id/topFragmentContainer"
+			android:layout_width="match_parent"
+			android:layout_height="match_parent" />
+
+		<FrameLayout
+			android:id="@+id/routeMenuContainer"
+			android:layout_width="match_parent"
+			android:layout_height="match_parent" />
+
+		<include
+			layout="@layout/dashboard_over_map"
+			android:layout_width="match_parent"
+			android:layout_height="match_parent" />
+
+		<FrameLayout
+			android:id="@+id/fragmentContainer"
+			android:layout_width="match_parent"
+			android:layout_height="match_parent" />
+
+		<View
+			android:layout_width="match_parent"
+			android:layout_height="match_parent" />
+
+	</FrameLayout>
+
 	<RelativeLayout
 		android:id="@+id/drawer_relative_layout"
 		android:layout_width="280dp"
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
index 13589573efa..54e306eb0a7 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
@@ -1951,17 +1951,19 @@ public void newRouteIsCalculated(boolean newRoute, ValueHolder<Boolean> showToas
 	private void fitCurrentRouteToMap() {
 		boolean portrait = true;
 		int leftBottomPaddingPx = 0;
-		WeakReference fragmentRef = mapRouteInfoMenu.findMenuFragment();
+		WeakReference<?> fragmentRef = mapRouteInfoMenu.findMenuFragment();
 		if (fragmentRef == null) {
 			fragmentRef = mapRouteInfoMenu.findFollowTrackFragment();
 		}
+		View mapBottomView = findViewById(R.id.MapBottomContainer);
+		int mapBottomViewHeight = mapBottomView.getHeight();
 		if (fragmentRef != null) {
 			ContextMenuFragment f = (ContextMenuFragment) fragmentRef.get();
 			portrait = f.isPortrait();
 			if (!portrait) {
 				leftBottomPaddingPx = f.getWidth();
 			} else {
-				leftBottomPaddingPx = f.getHeight();
+				leftBottomPaddingPx = Math.max(0, f.getHeight() - mapBottomViewHeight);
 			}
 		}
 		app.getOsmandMap().fitCurrentRouteToMap(portrait, leftBottomPaddingPx);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java
index 98504414902..7b052209baa 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsVisibilityHelper.java
@@ -150,21 +150,23 @@ public boolean shouldShowBackToLocationButton() {
 
 	public boolean shouldShowElevationProfileWidget() {
 		return proVersionAvailable && settings.SHOW_ELEVATION_PROFILE_WIDGET.get()
-				&& isRouteCalculated()
-				&& !isDashboardVisible()
 				&& !isInChangeMarkerPositionMode()
-				&& !isInGpxDetailsMode()
 				&& !isInMeasurementToolMode()
+				&& !isInChoosingRoutesMode()
+				&& !isInWaypointsChoosingMode()
 				&& !isInPlanRouteMode()
+				&& isRouteCalculated();
+		/*
+				&& !isDashboardVisible()
+				&& !isInGpxDetailsMode()
 				&& !isInTrackAppearanceMode()
 				&& !isInTrackMenuMode()
-				&& !isInRouteLineAppearanceMode()
 				&& !isMapRouteInfoMenuVisible()
-				&& !isInChoosingRoutesMode()
-				&& !isInWaypointsChoosingMode()
+				&& !isInRouteLineAppearanceMode()
 				&& !isInFollowTrackMode()
 				&& !isContextMenuFragmentVisible()
 				&& !isMultiSelectionMenuFragmentVisible();
+		 */
 	}
 
 	public boolean shouldShowDownloadMapWidget() {
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/ElevationProfileWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/ElevationProfileWidget.java
index af275db3c52..3dc40cc7f60 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/ElevationProfileWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/ElevationProfileWidget.java
@@ -28,6 +28,7 @@
 import net.osmand.GPXUtilities.TrkSegment;
 import net.osmand.GPXUtilities.WptPt;
 import net.osmand.Location;
+import net.osmand.StateChangedListener;
 import net.osmand.plus.GpxSelectionHelper.GpxDisplayItem;
 import net.osmand.plus.OsmAndFormatter;
 import net.osmand.plus.OsmandApplication;
@@ -78,11 +79,20 @@ public class ElevationProfileWidget {
 	private int lastVisiblePointIndex = -1;
 	private OrderedLineDataSet slopeDataSet;
 
+	private boolean movedToLocation = false;
+
+	private final StateChangedListener<Boolean> linkedToLocationListener = change -> {
+		if (change) {
+			movedToLocation = true;
+		}
+	};
+
 	public ElevationProfileWidget(MapActivity map) {
 		this.map = map;
 		app = map.getMyApplication();
 		settings = app.getSettings();
 		initView();
+		settings.MAP_LINKED_TO_LOCATION.addListener(linkedToLocationListener);
 	}
 
 	private void initView() {
@@ -90,6 +100,8 @@ private void initView() {
 		setupStatisticBlocks();
 	}
 
+
+
 	private void setupStatisticBlocks() {
 		uphillView = setupStatisticBlock(R.id.uphill_widget,
 				R.string.shared_string_uphill,
@@ -295,10 +307,16 @@ private boolean updateChart(boolean forceUpdate) {
 		float startMoveChartPosition = minVisibleX + twentyPercent;
 		float pos = distanceFromStart / ((OrderedLineDataSet) ds.get(0)).getDivX();
 
-		if (pos >= minVisibleX && pos <= maxVisibleX) {
+		boolean movedToLocation = this.movedToLocation;
+		if (pos >= minVisibleX && pos <= maxVisibleX || movedToLocation) {
 			if (pos >= startMoveChartPosition) {
 				float nextVisibleX = pos - twentyPercent;
 				moveViewToX(chart, nextVisibleX);
+			} else if (movedToLocation) {
+				moveViewToX(chart, Math.max(pos - twentyPercent, chart.getXChartMin()));
+			}
+			if (movedToLocation) {
+				this.movedToLocation = false;
 			}
 			gpxItem.chartHighlightPos = pos;
 			Highlight newLocationHighlight = createHighlight(pos, true);
@@ -368,7 +386,8 @@ private boolean updateWidgets() {
 		firstVisiblePointIndex = firstPointIndex;
 		lastVisiblePointIndex = lastPointIndex;
 		if (firstPointIndex >= 0 && lastPointIndex > firstPointIndex) {
-			ElevationDiffsCalculator elevationDiffsCalc = new ElevationDiffsCalculator(firstPointIndex, lastPointIndex - firstPointIndex + 1) {
+			ElevationDiffsCalculator elevationDiffsCalc =
+					new ElevationDiffsCalculator(10d, firstPointIndex, lastPointIndex - firstPointIndex + 1) {
 				@Override
 				public WptPt getPoint(int index) {
 					return points.get(index);
