diff --git a/OsmAnd/src/net/osmand/plus/utils/NativeUtilities.java b/OsmAnd/src/net/osmand/plus/utils/NativeUtilities.java
index 18d008fc79e..91bc280300c 100644
--- a/OsmAnd/src/net/osmand/plus/utils/NativeUtilities.java
+++ b/OsmAnd/src/net/osmand/plus/utils/NativeUtilities.java
@@ -199,4 +199,10 @@ public static boolean containsLatLon(@Nullable MapRendererView mapRenderer, @Non
 			return tileBox.containsLatLon(latitude, longitude);
 		}
 	}
+
+	public static PointI getPointI31FromLatLon(double lat, double lon) {
+		int x31 = MapUtils.get31TileNumberX(lon);
+		int y31 = MapUtils.get31TileNumberY(lat);
+		return new PointI(x31, y31);
+	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/DownloadedRegionsLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/DownloadedRegionsLayer.java
index 360b2d047a3..ee40a9984b0 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/DownloadedRegionsLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/DownloadedRegionsLayer.java
@@ -110,6 +110,8 @@ public class DownloadedRegionsLayer extends OsmandMapLayer implements IContextMe
 	private boolean needRedrawOpenGL = false;
 	private boolean indexRegionBoundaries = false;
 	private boolean onMapsChanged = false;
+	List<WorldRegion> downloadedRegions = null;
+	List<WorldRegion> backupedRegions = null;
 
 	public static class DownloadMapObject {
 		private final BinaryMapDataObject dataObject;
@@ -677,33 +679,44 @@ private void drawMapPolygons(int zoom) {
 		if (onMapsChanged) {
 			clearPolygonsCollections();
 			onMapsChanged = false;
+			downloadedRegions = null;
+			backupedRegions = null;
 		}
 		if (polygonsCollection != null && selectedSize == selectedObjects.size()) {
 			return;
 		}
-		List<WorldRegion> downloadedRegions = new ArrayList<>();
-		List<WorldRegion> backupedRegions = new ArrayList<>();
-		List<WorldRegion> selectedRegions = new ArrayList<>();
-		if (selectedObjects.size() > 0) {
-			for (BinaryMapDataObject o : selectedObjects) {
-				String fullName = osmandRegions.getFullName(o);
-				WorldRegion wr = osmandRegions.getRegionData(fullName);
-				if (wr != null) {
-					selectedRegions.add(wr);
+		if (zoom >= ZOOM_TO_SHOW_BORDERS_ST && zoom < ZOOM_TO_SHOW_BORDERS) {
+			if (this.downloadedRegions == null && this.backupedRegions == null) {
+				this.downloadedRegions = new ArrayList<>();
+				this.backupedRegions = new ArrayList<>();
+				List<WorldRegion> worldRegions = osmandRegions.getAllRegionData();
+				for (WorldRegion wr : worldRegions) {
+					String n = wr.getRegionDownloadName();
+					if (rm.checkIfObjectDownloaded(n)) {
+						this.downloadedRegions.add(wr);
+					} else if (rm.checkIfObjectBackuped(n)) {
+						this.backupedRegions.add(wr);
+					}
 				}
 			}
 		}
-		if (zoom >= ZOOM_TO_SHOW_BORDERS_ST && zoom < ZOOM_TO_SHOW_BORDERS) {
-			List<WorldRegion> worldRegions = osmandRegions.getAllRegionData();
-			for (WorldRegion wr : worldRegions) {
-				if (selectedRegions.contains(wr)) {
-					continue;
-				}
-				String n = wr.getRegionDownloadName();
-				if (rm.checkIfObjectDownloaded(n)) {
-					downloadedRegions.add(wr);
-				} else if (rm.checkIfObjectBackuped(n)) {
-					backupedRegions.add(wr);
+		List<WorldRegion> downloadedRegions = getCopyOfList(this.downloadedRegions);
+		List<WorldRegion> backupedRegions = getCopyOfList(this.backupedRegions);
+		List<WorldRegion> selectedRegions = new ArrayList<>();
+		if (zoom >= ZOOM_TO_SHOW_SELECTION_ST && zoom < ZOOM_TO_SHOW_SELECTION) {
+			if (selectedObjects.size() > 0) {
+				for (BinaryMapDataObject o : selectedObjects) {
+					String fullName = osmandRegions.getFullName(o);
+					WorldRegion wr = osmandRegions.getRegionData(fullName);
+					if (wr != null) {
+						selectedRegions.add(wr);
+						if (downloadedRegions.contains(wr)) {
+							downloadedRegions.remove(wr);
+						}
+						if (backupedRegions.contains(wr)) {
+							backupedRegions.remove(wr);
+						}
+					}
 				}
 			}
 		}
@@ -715,9 +728,14 @@ private void drawMapPolygons(int zoom) {
 			downloadedSize = downloadedRegions.size();
 			selectedSize = selectedRegions.size();
 		}
-		addToPolygonsCollection(downloadedRegions, paintDownloaded);
-		addToPolygonsCollection(backupedRegions, paintBackuped);
-		addToPolygonsCollection(selectedRegions, paintSelected);
+		int baseOrder = getBaseOrder();
+		if (zoom >= ZOOM_TO_SHOW_BORDERS_ST && zoom < ZOOM_TO_SHOW_BORDERS) {
+			baseOrder = addToPolygonsCollection(downloadedRegions, paintDownloaded, baseOrder);
+			baseOrder = addToPolygonsCollection(backupedRegions, paintBackuped, baseOrder);
+		}
+		if (zoom >= ZOOM_TO_SHOW_SELECTION_ST && zoom < ZOOM_TO_SHOW_SELECTION) {
+			addToPolygonsCollection(selectedRegions, paintSelected, baseOrder);
+		}
 		if (needRedrawOpenGL && polygonsCollection != null) {
 			mapRenderer.addSymbolsProvider(polygonsCollection);
 			needRedrawOpenGL = false;
@@ -725,15 +743,14 @@ private void drawMapPolygons(int zoom) {
 	}
 
 	/**OpenGL*/
-	private void addToPolygonsCollection(List<WorldRegion> regionList, Paint paint) {
+	private int addToPolygonsCollection(List<WorldRegion> regionList, Paint paint, int baseOrder) {
 		MapRendererView mapRenderer = getMapView().getMapRenderer();
 		if (mapRenderer == null || regionList.size() == 0 || !needRedrawOpenGL) {
-			return;
+			return baseOrder;
 		}
 		if (polygonsCollection == null) {
 			polygonsCollection = new PolygonsCollection();
 		}
-		int baseOrder = getBaseOrder();
 		for (WorldRegion wr : regionList) {
 			List<LatLon> polygon = wr.getPolygon();
 			QVectorPointI points = new QVectorPointI();
@@ -751,6 +768,7 @@ private void addToPolygonsCollection(List<WorldRegion> regionList, Paint paint)
 					.setFillColor(colorARGB)
 					.buildAndAddToCollection(polygonsCollection);
 		}
+		return baseOrder;
 	}
 
 	/**OpenGL*/
@@ -801,4 +819,12 @@ public void onMapsIndexed() {
 	public void onMapClosed() {
 		onMapsChanged = true;
 	}
+
+	private List<WorldRegion> getCopyOfList(@Nullable List<WorldRegion> list) {
+		if (list == null) {
+			return new ArrayList<>();
+		} else {
+			return new ArrayList<>(list);
+		}
+	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/MapMarkersLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/MapMarkersLayer.java
index 77c1517a08e..e165f1a61ff 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/MapMarkersLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/MapMarkersLayer.java
@@ -265,14 +265,6 @@ public void onPrepareBufferImage(Canvas canvas, RotatedTileBox tileBox, DrawSett
 			return;
 		}
 
-		Location myLoc;
-		if (useFingerLocation && fingerLocation != null) {
-			myLoc = new Location("");
-			myLoc.setLatitude(fingerLocation.getLatitude());
-			myLoc.setLongitude(fingerLocation.getLongitude());
-		} else {
-			myLoc = app.getLocationProvider().getLastStaleKnownLocation();
-		}
 		MapMarkersHelper markersHelper = app.getMapMarkersHelper();
 		List<MapMarker> activeMapMarkers = markersHelper.getMapMarkers();
 		MapRendererView mapRenderer = getMapRenderer();
@@ -285,7 +277,6 @@ public void onPrepareBufferImage(Canvas canvas, RotatedTileBox tileBox, DrawSett
 			markersCount = activeMapMarkers.size();
 			mapActivityInvalidated = false;
 		}
-		int displayedWidgets = settings.DISPLAYED_MARKERS_WIDGETS_COUNT.get();
 
 		if (route != null && route.points.size() > 0) {
 			planRouteAttrs.updatePaints(app, nightMode, tileBox);
@@ -293,104 +284,8 @@ public void onPrepareBufferImage(Canvas canvas, RotatedTileBox tileBox, DrawSett
 					drawSegment(view.getZoom(), defaultAppMode ? planRouteAttrs.paint : planRouteAttrs.paint2, canvas, tileBox);
 		}
 
-		if (settings.SHOW_LINES_TO_FIRST_MARKERS.get() && myLoc != null) {
-			if (mapRenderer != null) {
-				if (displayedMarkers.size() != displayedWidgets) {
-					clearVectorLinesCollections();
-				}
-				for (int i = 0; i < activeMapMarkers.size() && i < displayedMarkers.size(); i++) {
-					if (displayedMarkers.get(i) != activeMapMarkers.get(i)) {
-						clearVectorLinesCollections();
-						break;
-					}
-				}
-			}
-			displayedMarkers.clear();
-
-			textAttrs.paint.setTextSize(textSize);
-			textAttrs.paint2.setTextSize(textSize);
-			lineAttrs.updatePaints(app, nightMode, tileBox);
-			textAttrs.updatePaints(app, nightMode, tileBox);
-			textAttrs.paint.setStyle(Paint.Style.FILL);
-			textPaint.set(textAttrs.paint);
-
-			boolean drawMarkerName = settings.DISPLAYED_MARKERS_WIDGETS_COUNT.get() == 1;
-
-			float locX;
-			float locY;
-			LatLon loc;
-			MapViewTrackingUtilities mapViewTrackingUtilities = app.getMapViewTrackingUtilities();
-			if (mapViewTrackingUtilities.isMapLinkedToLocation()
-					&& !MapViewTrackingUtilities.isSmallSpeedForAnimation(myLoc)
-					&& !mapViewTrackingUtilities.isMovingToMyLocation()) {
-				loc = new LatLon(tileBox.getLatitude(), tileBox.getLongitude());
-			} else {
-				loc = new LatLon(myLoc.getLatitude(), myLoc.getLongitude());
-			}
-			int[] colors = MapMarker.getColors(getContext());
-			for (int i = 0; i < activeMapMarkers.size() && i < displayedWidgets; i++) {
-				MapMarker marker = activeMapMarkers.get(i);
-				float markerX;
-				float markerY;
-				int color = colors[marker.colorIndex];
-				if (mapRenderer != null) {
-					boolean isLast = (i == activeMapMarkers.size() - 1) || (i == displayedWidgets - 1);
-					initVectorLinesCollection(loc, marker, color, isLast);
-					displayedMarkers.add(marker);
-					PointF[] line = calculateLineInScreenRect(tileBox, marker, loc);
-					if (line != null) {
-						locX = line[0].x;
-						locY = line[0].y;
-						markerX = line[1].x;
-						markerY = line[1].y;
-					} else {
-						continue;
-					}
-				} else {
-					locX = tileBox.getPixXFromLatLon(loc.getLatitude(), loc.getLongitude());
-					locY = tileBox.getPixYFromLatLon(loc.getLatitude(), loc.getLongitude());
-					markerX = tileBox.getPixXFromLatLon(marker.getLatitude(), marker.getLongitude());
-					markerY = tileBox.getPixYFromLatLon(marker.getLatitude(), marker.getLongitude());
-				}
-
-				linePath.reset();
-				tx.clear();
-				ty.clear();
-
-				tx.add(locX);
-				ty.add(locY);
-				tx.add(markerX);
-				ty.add(markerY);
-
-				GeometryWay.calculatePath(tileBox, tx, ty, linePath);
-				PathMeasure pm = new PathMeasure(linePath, false);
-				float[] pos = new float[2];
-				pm.getPosTan(pm.getLength() / 2, pos, null);
-
-				float dist = (float) MapUtils.getDistance(myLoc.getLatitude(), myLoc.getLongitude(), marker.getLatitude(), marker.getLongitude());
-				String distSt = OsmAndFormatter.getFormattedDistance(dist, view.getApplication());
-				String text = distSt + (drawMarkerName ? " • " + marker.getName(getContext()) : "");
-				text = TextUtils.ellipsize(text, textPaint, pm.getLength(), TextUtils.TruncateAt.END).toString();
-				Rect bounds = new Rect();
-				textAttrs.paint.getTextBounds(text, 0, text.length(), bounds);
-				float hOffset = pm.getLength() / 2 - bounds.width() / 2f;
-				lineAttrs.paint.setColor(color);
-
-				if (mapRenderer == null) {
-					canvas.rotate(-tileBox.getRotate(), tileBox.getCenterPixelX(), tileBox.getCenterPixelY());
-					canvas.drawPath(linePath, lineAttrs.paint);
-				}
-				if (locX >= markerX) {
-					canvas.rotate(180, pos[0], pos[1]);
-					canvas.drawTextOnPath(text, linePath, hOffset, bounds.height() + verticalOffset, textAttrs.paint2);
-					canvas.drawTextOnPath(text, linePath, hOffset, bounds.height() + verticalOffset, textAttrs.paint);
-					canvas.rotate(-180, pos[0], pos[1]);
-				} else {
-					canvas.drawTextOnPath(text, linePath, hOffset, -verticalOffset, textAttrs.paint2);
-					canvas.drawTextOnPath(text, linePath, hOffset, -verticalOffset, textAttrs.paint);
-				}
-				canvas.rotate(tileBox.getRotate(), tileBox.getCenterPixelX(), tileBox.getCenterPixelY());
-			}
+		if (settings.SHOW_LINES_TO_FIRST_MARKERS.get() && mapRenderer == null) {
+			drawLineAndText(canvas, tileBox, nightMode);
 		}
 	}
 
@@ -428,6 +323,10 @@ public void onDraw(Canvas canvas, RotatedTileBox tileBox, DrawSettings nightMode
 			}
 		}
 
+		if (settings.SHOW_LINES_TO_FIRST_MARKERS.get() && mapRenderer != null) {
+			drawLineAndText(canvas, tileBox, nightMode);
+		}
+
 		if (settings.SHOW_ARROWS_TO_FIRST_MARKERS.get()) {
 			LatLon loc = tileBox.getCenterLatLon();
 			int i = 0;
@@ -439,15 +338,30 @@ public void onDraw(Canvas canvas, RotatedTileBox tileBox, DrawSettings nightMode
 					float cx;
 					float cy;
 					if (mapRenderer != null) {
-						LatLon cp = tileBox.getCenterLatLon();
-						PointF centerPixels = NativeUtilities.getPixelFromLatLon(mapRenderer, tileBox, cp.getLatitude(), cp.getLongitude());
-						PointF[] line = calculateLineInScreenRect(tileBox, marker, cp);
+						PointF[] line;
+						PointF centerPixels;
+						if (tileBox.isCenterShifted()) {
+							PointI marker31 = NativeUtilities.getPointI31FromLatLon(marker.getLatitude(), marker.getLongitude());
+							PointI windowSize = mapRenderer.getState().getWindowSize();
+							int sx = windowSize.getX() / 2;
+							int sy = windowSize.getY() / 2;
+							PointI center31 = NativeUtilities.get31FromPixel(mapRenderer, tileBox, sx, sy,true);
+							if (center31 == null) {
+								continue;
+							}
+							line = calculateLineInScreenRect(tileBox, marker31, center31);
+							centerPixels = NativeUtilities.getPixelFrom31(mapRenderer, tileBox, center31);
+						} else {
+							LatLon center = tileBox.getCenterLatLon();
+							line = calculateLineInScreenRect(tileBox, marker, center);
+							centerPixels = NativeUtilities.getPixelFromLatLon(mapRenderer, tileBox, center.getLatitude(), center.getLongitude());
+						}
 						if (line == null) {
 							continue;
 						}
 						cx = centerPixels.x;
 						cy = centerPixels.y;
-						bearing = (float) getAngleBetween(centerPixels, line[1]);
+						bearing = (float) getAngleBetween(centerPixels, line[1]) - tileBox.getRotate();
 					} else {
 						final QuadPoint cp = tileBox.getCenterPixelPoint();
 						cx = cp.x;
@@ -809,10 +723,8 @@ private void initMarkersCollection() {
 		for (MapMarker marker : markersHelper.getMapMarkers()) {
 			if (!overlappedByWaypoint(marker) && !isSynced(marker)) {
 				Bitmap bmp = getMapMarkerBitmap(marker.colorIndex);
-				int x = MapUtils.get31TileNumberX(marker.getLongitude());
-				int y = MapUtils.get31TileNumberY(marker.getLatitude());
 				MapMarkerBuilder mapMarkerBuilder = new MapMarkerBuilder();
-				PointI pointI = new PointI(x, y);
+				PointI pointI = NativeUtilities.getPointI31FromLatLon(marker.getLatitude(), marker.getLongitude());
 				int color = getColorByIndex(marker.colorIndex);
 				boolean isMoveable = isInMotion(marker);
 
@@ -838,12 +750,8 @@ private void initVectorLinesCollection(LatLon loc, MapMarker marker, int color,
 			return;
 		}
 
-		int locX = MapUtils.get31TileNumberX(loc.getLongitude());
-		int locY = MapUtils.get31TileNumberY(loc.getLatitude());
-		PointI start = new PointI(locX, locY);
-		int markerX = MapUtils.get31TileNumberX(marker.getLongitude());
-		int markerY = MapUtils.get31TileNumberY(marker.getLatitude());
-		PointI end = new PointI(markerX, markerY);
+		PointI start = NativeUtilities.getPointI31FromLatLon(loc.getLatitude(), loc.getLongitude());
+		PointI end = NativeUtilities.getPointI31FromLatLon(marker.getLatitude(), marker.getLongitude());
 
 		if (vectorLinesCollection == null) {
 			vectorLinesCollection = new VectorLinesCollection();
@@ -899,21 +807,20 @@ protected void clearVectorLinesCollections() {
 		}
 	}
 
+	private PointF[] calculateLineInScreenRect(RotatedTileBox tileBox, MapMarker marker, LatLon loc) {
+		PointI locPointI = NativeUtilities.getPointI31FromLatLon(loc.getLatitude(), loc.getLongitude());
+		PointI markerPointI = NativeUtilities.getPointI31FromLatLon(marker.getLatitude(), marker.getLongitude());
+		return calculateLineInScreenRect(tileBox, markerPointI, locPointI);
+	}
+
 	/**OpenGL*/
 	@Nullable
-	private PointF[] calculateLineInScreenRect(RotatedTileBox tileBox, MapMarker marker, LatLon loc) {
+	private PointF[] calculateLineInScreenRect(RotatedTileBox tileBox, PointI markerPointI, PointI locPointI) {
 		MapRendererView mapRenderer = getMapRenderer();
 		if (mapRenderer == null) {
 			return null;
 		}
-		int locX = MapUtils.get31TileNumberX(loc.getLongitude());
-		int locY = MapUtils.get31TileNumberY(loc.getLatitude());
-		PointI locPointI = new PointI(locX, locY);
-		int x = MapUtils.get31TileNumberX(marker.getLongitude());
-		int y = MapUtils.get31TileNumberY(marker.getLatitude());
-		PointI markerPointI = new PointI(x, y);
 		AreaI screenBbox = mapRenderer.getVisibleBBox31();
-
 		PointI firstPoint = null;
 		PointI secondPoint = null;
 		if (screenBbox.contains(locPointI)) {
@@ -982,4 +889,119 @@ private int getColorByIndex(int colorIndex) {
 		}
 		return getContext().getResources().getColor(colorResId, null);
 	}
+
+	private void drawLineAndText(Canvas canvas, RotatedTileBox tileBox, DrawSettings nightMode) {
+		Location myLoc;
+		OsmandApplication app = getApplication();
+		MapRendererView mapRenderer = getMapRenderer();
+		if (useFingerLocation && fingerLocation != null) {
+			myLoc = new Location("");
+			myLoc.setLatitude(fingerLocation.getLatitude());
+			myLoc.setLongitude(fingerLocation.getLongitude());
+		} else {
+			myLoc = app.getLocationProvider().getLastStaleKnownLocation();
+		}
+		if (myLoc == null) {
+			return;
+		}
+
+		OsmandSettings settings = app.getSettings();
+		MapMarkersHelper markersHelper = app.getMapMarkersHelper();
+		List<MapMarker> activeMapMarkers = markersHelper.getMapMarkers();
+		if (mapRenderer != null) {
+			for (int i = 0; i < activeMapMarkers.size() && i < displayedMarkers.size(); i++) {
+				if (displayedMarkers.get(i) != activeMapMarkers.get(i)) {
+					clearVectorLinesCollections();
+					break;
+				}
+			}
+		}
+
+		displayedMarkers.clear();
+		textAttrs.paint.setTextSize(textSize);
+		textAttrs.paint2.setTextSize(textSize);
+		lineAttrs.updatePaints(app, nightMode, tileBox);
+		textAttrs.updatePaints(app, nightMode, tileBox);
+		textAttrs.paint.setStyle(Paint.Style.FILL);
+		textPaint.set(textAttrs.paint);
+
+		int displayedWidgets = settings.DISPLAYED_MARKERS_WIDGETS_COUNT.get();
+		boolean drawMarkerName = settings.DISPLAYED_MARKERS_WIDGETS_COUNT.get() == 1;
+		float locX;
+		float locY;
+		LatLon loc;
+		MapViewTrackingUtilities mapViewTrackingUtilities = app.getMapViewTrackingUtilities();
+		if (mapViewTrackingUtilities.isMapLinkedToLocation()
+				&& !MapViewTrackingUtilities.isSmallSpeedForAnimation(myLoc)
+				&& !mapViewTrackingUtilities.isMovingToMyLocation()) {
+			loc = new LatLon(tileBox.getLatitude(), tileBox.getLongitude());
+		} else {
+			loc = new LatLon(myLoc.getLatitude(), myLoc.getLongitude());
+		}
+		int[] colors = MapMarker.getColors(getContext());
+		for (int i = 0; i < activeMapMarkers.size() && i < displayedWidgets; i++) {
+			MapMarker marker = activeMapMarkers.get(i);
+			float markerX;
+			float markerY;
+			int color = colors[marker.colorIndex];
+			if (mapRenderer != null) {
+				boolean isLast = (i == activeMapMarkers.size() - 1) || (i == displayedWidgets - 1);
+				//draw line in OpenGL
+				initVectorLinesCollection(loc, marker, color, isLast);
+				displayedMarkers.add(marker);
+				PointF[] line = calculateLineInScreenRect(tileBox, marker, loc);
+				if (line != null) {
+					locX = line[0].x;
+					locY = line[0].y;
+					markerX = line[1].x;
+					markerY = line[1].y;
+				} else {
+					continue;
+				}
+			} else {
+				locX = tileBox.getPixXFromLatLon(loc.getLatitude(), loc.getLongitude());
+				locY = tileBox.getPixYFromLatLon(loc.getLatitude(), loc.getLongitude());
+				markerX = tileBox.getPixXFromLatLon(marker.getLatitude(), marker.getLongitude());
+				markerY = tileBox.getPixYFromLatLon(marker.getLatitude(), marker.getLongitude());
+			}
+
+			linePath.reset();
+			tx.clear();
+			ty.clear();
+
+			tx.add(locX);
+			ty.add(locY);
+			tx.add(markerX);
+			ty.add(markerY);
+
+			GeometryWay.calculatePath(tileBox, tx, ty, linePath);
+			PathMeasure pm = new PathMeasure(linePath, false);
+			float[] pos = new float[2];
+			pm.getPosTan(pm.getLength() / 2, pos, null);
+
+			float dist = (float) MapUtils.getDistance(myLoc.getLatitude(), myLoc.getLongitude(), marker.getLatitude(), marker.getLongitude());
+			String distSt = OsmAndFormatter.getFormattedDistance(dist, view.getApplication());
+			String text = distSt + (drawMarkerName ? " • " + marker.getName(getContext()) : "");
+			text = TextUtils.ellipsize(text, textPaint, pm.getLength(), TextUtils.TruncateAt.END).toString();
+			Rect bounds = new Rect();
+			textAttrs.paint.getTextBounds(text, 0, text.length(), bounds);
+			float hOffset = pm.getLength() / 2 - bounds.width() / 2f;
+			lineAttrs.paint.setColor(color);
+
+			canvas.rotate(-tileBox.getRotate(), tileBox.getCenterPixelX(), tileBox.getCenterPixelY());
+			if (mapRenderer == null) {
+				canvas.drawPath(linePath, lineAttrs.paint);
+			}
+			if (locX >= markerX) {
+				canvas.rotate(180, pos[0], pos[1]);
+				canvas.drawTextOnPath(text, linePath, hOffset, bounds.height() + verticalOffset, textAttrs.paint2);
+				canvas.drawTextOnPath(text, linePath, hOffset, bounds.height() + verticalOffset, textAttrs.paint);
+				canvas.rotate(-180, pos[0], pos[1]);
+			} else {
+				canvas.drawTextOnPath(text, linePath, hOffset, -verticalOffset, textAttrs.paint2);
+				canvas.drawTextOnPath(text, linePath, hOffset, -verticalOffset, textAttrs.paint);
+			}
+			canvas.rotate(tileBox.getRotate(), tileBox.getCenterPixelX(), tileBox.getCenterPixelY());
+		}
+	}
 }
