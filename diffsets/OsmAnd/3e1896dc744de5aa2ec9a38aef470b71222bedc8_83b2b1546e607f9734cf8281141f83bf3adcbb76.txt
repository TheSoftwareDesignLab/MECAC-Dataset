diff --git a/OsmAnd/res/xml/general_profile_settings.xml b/OsmAnd/res/xml/general_profile_settings.xml
index 89784245ec0..03ba3c22490 100644
--- a/OsmAnd/res/xml/general_profile_settings.xml
+++ b/OsmAnd/res/xml/general_profile_settings.xml
@@ -14,7 +14,7 @@
 		android:layout="@layout/preference_with_descr"
 		android:title="@string/choose_osmand_theme" />
 
-	<net.osmand.plus.settings.preferences.ListPreferenceEx
+	<Preference
 		android:key="rotate_map"
 		android:layout="@layout/preference_with_descr"
 		android:title="@string/rotate_map_to" />
diff --git a/OsmAnd/src/net/osmand/plus/base/MapViewTrackingUtilities.java b/OsmAnd/src/net/osmand/plus/base/MapViewTrackingUtilities.java
index 764efb03c3b..5d23905f710 100644
--- a/OsmAnd/src/net/osmand/plus/base/MapViewTrackingUtilities.java
+++ b/OsmAnd/src/net/osmand/plus/base/MapViewTrackingUtilities.java
@@ -33,6 +33,7 @@
 import net.osmand.plus.routing.RoutingHelperUtils;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.enums.CompassMode;
 import net.osmand.plus.settings.enums.DrivingRegion;
 import net.osmand.plus.utils.NativeUtilities;
 import net.osmand.plus.views.AnimateDraggingMapThread;
@@ -110,8 +111,7 @@ private void addMapMarkersListener(OsmandApplication app) {
 	}
 
 	@Override
-	public void onMapMarkerChanged(MapMarker mapMarker) {
-	}
+	public void onMapMarkerChanged(MapMarker mapMarker) {}
 
 	@Override
 	public void onMapMarkersChanged() {
@@ -526,25 +526,22 @@ public void switchRotateMapMode() {
 
 	private void switchRotateMapModeImpl() {
 		if (mapView != null) {
-			String rotMode = app.getString(R.string.rotate_map_manual_opt);
 			int vl = (settings.ROTATE_MAP.get() + 1) % 4;
 			settings.ROTATE_MAP.set(vl);
+			onRotateMapModeChanged();
+		}
+	}
 
-			if (settings.ROTATE_MAP.get() == OsmandSettings.ROTATE_MAP_BEARING) {
-				rotMode = app.getString(R.string.rotate_map_bearing_opt);
-			} else if (settings.ROTATE_MAP.get() == OsmandSettings.ROTATE_MAP_COMPASS) {
-				rotMode = app.getString(R.string.rotate_map_compass_opt);
-			} else if (settings.ROTATE_MAP.get() == OsmandSettings.ROTATE_MAP_NONE) {
-				mapView.resetManualRotation();
-				rotMode = app.getString(R.string.rotate_map_north_opt);
-			}
-			rotMode = app.getString(R.string.rotate_map_to) + ":\n" + rotMode;
-			app.showShortToastMessage(rotMode);
-			updateSettings();
-			mapView.refreshMap();
-			if (mapView.isCarView()) {
-				app.refreshCarScreen();
-			}
+	public void onRotateMapModeChanged() {
+		CompassMode compassMode = CompassMode.getByValue(settings.ROTATE_MAP.get());
+		String title = app.getString(compassMode.getTitleId());
+		String message = app.getString(R.string.rotate_map_to) + ":\n" + title;
+		app.showShortToastMessage(message);
+
+		updateSettings();
+		mapView.refreshMap();
+		if (mapView.isCarView()) {
+			app.refreshCarScreen();
 		}
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/base/containers/ThemedIconId.java b/OsmAnd/src/net/osmand/plus/base/containers/ThemedIconId.java
index 67d70fbdc2b..e4ec732e7e0 100644
--- a/OsmAnd/src/net/osmand/plus/base/containers/ThemedIconId.java
+++ b/OsmAnd/src/net/osmand/plus/base/containers/ThemedIconId.java
@@ -16,4 +16,20 @@ public ThemedIconId(@DrawableRes int iconDayId, @DrawableRes int iconNightId) {
 	public int getIconId(boolean nightMode) {
 		return nightMode ? iconNightId : iconDayId;
 	}
+
+	@Override
+	public boolean equals(Object o) {
+		if (this == o) return true;
+		if (o instanceof ThemedIconId) {
+			ThemedIconId that = (ThemedIconId) o;
+			return iconDayId == that.iconDayId
+					&& iconNightId == that.iconNightId;
+		}
+		return false;
+	}
+
+	@Override
+	public int hashCode() {
+		return 31 * iconDayId + iconNightId;
+	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeDialogController.java b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeDialogController.java
new file mode 100644
index 00000000000..360ecdfc5a4
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeDialogController.java
@@ -0,0 +1,55 @@
+package net.osmand.plus.settings.controllers;
+
+import static net.osmand.plus.settings.fragments.ApplyQueryType.SNACK_BAR;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayData;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayItem;
+import net.osmand.plus.base.dialog.interfaces.IDialogDisplayDataProvider;
+import net.osmand.plus.base.dialog.interfaces.IDialogItemSelected;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.enums.CompassMode;
+import net.osmand.plus.settings.fragments.OnConfirmPreferenceChange;
+
+public class CompassModeDialogController implements IDialogDisplayDataProvider, IDialogItemSelected {
+
+	public static final String PROCESS_ID = "select_compass_mode_on_preferences_screen";
+
+	private final OsmandApplication app;
+	private final CompassModeDisplayDataCreator displayDataCreator;
+	private OnConfirmPreferenceChange preferenceChangeCallback;
+
+	public CompassModeDialogController(@NonNull OsmandApplication app,
+									   @NonNull ApplicationMode appMode) {
+		this.app = app;
+		this.displayDataCreator = new CompassModeDisplayDataCreator(app, appMode, false);
+	}
+
+	public void setCallback(@NonNull OnConfirmPreferenceChange preferenceChangeCallback) {
+		this.preferenceChangeCallback = preferenceChangeCallback;
+	}
+
+	@Nullable
+	@Override
+	public DialogDisplayData getDialogDisplayData(@NonNull String processId) {
+		return displayDataCreator.createDisplayData();
+	}
+
+	@Override
+	public void onDialogItemSelected(@NonNull String processId,
+	                                 @NonNull DialogDisplayItem selected) {
+		Object newValue = selected.tag;
+		if (newValue instanceof CompassMode) {
+			OsmandSettings settings = app.getSettings();
+			String prefId = settings.ROTATE_MAP.getId();
+			CompassMode compassMode = (CompassMode) newValue;
+			Object value = compassMode.getValue();
+			preferenceChangeCallback.onConfirmPreferenceChange(prefId, value, SNACK_BAR);
+		}
+	}
+
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeDisplayDataCreator.java b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeDisplayDataCreator.java
new file mode 100644
index 00000000000..5f2e7dbdbb5
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeDisplayDataCreator.java
@@ -0,0 +1,72 @@
+package net.osmand.plus.settings.controllers;
+
+import androidx.annotation.NonNull;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayData;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayItem;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.backend.preferences.CommonPreference;
+import net.osmand.plus.settings.enums.CompassMode;
+import net.osmand.plus.utils.UiUtilities;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class CompassModeDisplayDataCreator {
+
+	private final OsmandApplication app;
+	private final OsmandSettings settings;
+	private final ApplicationMode appMode;
+	private final boolean usedOnMap;
+
+	public CompassModeDisplayDataCreator(@NonNull OsmandApplication app,
+	                                     @NonNull ApplicationMode appMode,
+	                                     boolean usedOnMap) {
+		this.app = app;
+		this.appMode = appMode;
+		this.usedOnMap = usedOnMap;
+		this.settings = app.getSettings();
+	}
+
+	@NonNull
+	public DialogDisplayData createDisplayData() {
+		OsmandSettings settings = app.getSettings();
+		boolean nightMode = isNightMode();
+		int controlsColor = appMode.getProfileColor(nightMode);
+		UiUtilities iconsCache = app.getUIUtilities();
+		DialogDisplayData displayData = new DialogDisplayData();
+		List<DialogDisplayItem> items = new ArrayList<>();
+
+		displayData.setTitle(getString(R.string.rotate_map_to));
+		displayData.setDescription(getString(R.string.compass_click_desc));
+		for (CompassMode compassMode : CompassMode.values()) {
+			DialogDisplayItem item = new DialogDisplayItem();
+			item.title = getString(compassMode.getTitleId());
+			item.layoutId = R.layout.bottom_sheet_item_with_descr_and_radio_btn;
+			item.normalIcon = item.selectedIcon = iconsCache.getIcon(compassMode.getIconId(nightMode));
+			item.customControlsColor = controlsColor;
+			item.tag = compassMode;
+			items.add(item);
+		}
+		displayData.setDisplayItems(items);
+
+		CommonPreference<Integer> preference = settings.ROTATE_MAP;
+		int selectedValue = preference.getModeValue(appMode);
+		displayData.setSelectedItemIndex(CompassMode.getByValue(selectedValue).ordinal());
+		return displayData;
+	}
+
+	private String getString(int stringId) {
+		return app.getString(stringId);
+	}
+
+	private boolean isNightMode() {
+		return usedOnMap ?
+				app.getDaynightHelper().isNightModeForMapControlsForProfile(appMode) :
+				!settings.isLightContentForMode(appMode);
+	}
+
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeWidgetDialogController.java b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeWidgetDialogController.java
new file mode 100644
index 00000000000..607e9cbb9d9
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeWidgetDialogController.java
@@ -0,0 +1,58 @@
+package net.osmand.plus.settings.controllers;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.base.dialog.DialogManager;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayData;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayItem;
+import net.osmand.plus.base.dialog.interfaces.IDialogDisplayDataProvider;
+import net.osmand.plus.base.dialog.interfaces.IDialogItemSelected;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.bottomsheets.CustomizableSingleSelectionBottomSheet;
+import net.osmand.plus.settings.enums.CompassMode;
+
+public class CompassModeWidgetDialogController implements IDialogDisplayDataProvider, IDialogItemSelected {
+
+	public static final String PROCESS_ID = "select_compass_mode_on_map";
+
+	private final OsmandApplication app;
+	private final OsmandSettings settings;
+
+	public CompassModeWidgetDialogController(OsmandApplication app) {
+		this.app = app;
+		this.settings = app.getSettings();
+	}
+
+	@Nullable
+	@Override
+	public DialogDisplayData getDialogDisplayData(@NonNull String processId) {
+		if (processId.equals(PROCESS_ID)) {
+			ApplicationMode appMode = settings.getApplicationMode();
+			return new CompassModeDisplayDataCreator(app, appMode, true).createDisplayData();
+		}
+		return null;
+	}
+
+	@Override
+	public void onDialogItemSelected(@NonNull String processId, @NonNull DialogDisplayItem selected) {
+		CompassMode compassMode = (CompassMode) selected.tag;
+		settings.ROTATE_MAP.set(compassMode.getValue());
+		app.getMapViewTrackingUtilities().onRotateMapModeChanged();
+	}
+
+	public static void showDialog(@NonNull MapActivity mapActivity) {
+		OsmandApplication app = mapActivity.getMyApplication();
+		CompassModeWidgetDialogController controller = new CompassModeWidgetDialogController(app);
+
+		DialogManager dialogManager = app.getDialogManager();
+		dialogManager.register(PROCESS_ID, controller);
+
+		FragmentManager manager = mapActivity.getSupportFragmentManager();
+		CustomizableSingleSelectionBottomSheet.showInstance(manager, PROCESS_ID, true);
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/controllers/MapFocusDialogController.java b/OsmAnd/src/net/osmand/plus/settings/controllers/MapFocusDialogController.java
new file mode 100644
index 00000000000..fe4f51abb5c
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/settings/controllers/MapFocusDialogController.java
@@ -0,0 +1,86 @@
+package net.osmand.plus.settings.controllers;
+
+import static net.osmand.plus.settings.fragments.ApplyQueryType.BOTTOM_SHEET;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayData;
+import net.osmand.plus.base.dialog.uidata.DialogDisplayItem;
+import net.osmand.plus.base.dialog.interfaces.IDialogDisplayDataProvider;
+import net.osmand.plus.base.dialog.interfaces.IDialogItemSelected;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.enums.MapFocus;
+import net.osmand.plus.settings.fragments.OnConfirmPreferenceChange;
+import net.osmand.plus.utils.UiUtilities;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class MapFocusDialogController implements IDialogDisplayDataProvider, IDialogItemSelected {
+
+	public static final String PROCESS_ID = "select_map_focus";
+
+	private final OsmandApplication app;
+	private final ApplicationMode appMode;
+	private final OsmandSettings settings;
+	private OnConfirmPreferenceChange preferenceChangeCallback;
+
+	public MapFocusDialogController(@NonNull OsmandApplication app,
+	                                @NonNull ApplicationMode appMode) {
+		this.app = app;
+		this.appMode = appMode;
+		this.settings = app.getSettings();
+	}
+
+	public void setCallback(@NonNull OnConfirmPreferenceChange preferenceChangeCallback) {
+		this.preferenceChangeCallback = preferenceChangeCallback;
+	}
+
+	@Nullable
+	@Override
+	public DialogDisplayData getDialogDisplayData(@NonNull String processId) {
+		UiUtilities iconsCache = app.getUIUtilities();
+		boolean nightMode = !settings.isLightContentForMode(appMode);
+
+		DialogDisplayData displayData = new DialogDisplayData();
+		List<DialogDisplayItem> items = new ArrayList<>();
+		displayData.setTitle(app.getString(R.string.display_position));
+		int profileColor = appMode.getProfileColor(nightMode);
+		for (MapFocus mapFocus : MapFocus.values()) {
+			DialogDisplayItem item = new DialogDisplayItem();
+			item.title = app.getString(mapFocus.getTitleId());
+			item.layoutId = R.layout.bottom_sheet_item_with_bottom_descr_and_radio_btn;
+			if (mapFocus == MapFocus.AUTOMATIC) {
+				item.description = app.getString(R.string.display_position_automatic_descr);
+			}
+			item.normalIcon = iconsCache.getThemedIcon(mapFocus.getIconId());
+			item.selectedIcon = iconsCache.getPaintedIcon(mapFocus.getIconId(), profileColor);
+			item.customControlsColor = profileColor;
+			item.addDividerAfter = mapFocus != MapFocus.AUTOMATIC;
+			item.tag = mapFocus;
+			items.add(item);
+		}
+		displayData.setDisplayItems(items);
+
+		int selectedValue = settings.POSITION_PLACEMENT_ON_MAP.getModeValue(appMode);
+		int selectedItemIndex = MapFocus.getByValue(selectedValue).ordinal();
+		displayData.setSelectedItemIndex(selectedItemIndex);
+		return displayData;
+	}
+
+	@Override
+	public void onDialogItemSelected(@NonNull String processId,
+	                                 @NonNull DialogDisplayItem selected) {
+		Object newValue = selected.tag;
+		if (newValue instanceof MapFocus) {
+			String prefId = settings.POSITION_PLACEMENT_ON_MAP.getId();
+			MapFocus mapFocus = (MapFocus) newValue;
+			Object value = mapFocus.getValue();
+			preferenceChangeCallback.onConfirmPreferenceChange(prefId, value, BOTTOM_SHEET);
+		}
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/enums/CompassMode.java b/OsmAnd/src/net/osmand/plus/settings/enums/CompassMode.java
new file mode 100644
index 00000000000..9381e8ae60b
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/settings/enums/CompassMode.java
@@ -0,0 +1,76 @@
+package net.osmand.plus.settings.enums;
+
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.StringRes;
+
+import net.osmand.plus.R;
+import net.osmand.plus.base.containers.ThemedIconId;
+import net.osmand.plus.settings.backend.OsmandSettings;
+
+public enum CompassMode {
+
+	NORTH_IS_UP(
+			OsmandSettings.ROTATE_MAP_NONE,
+			R.string.rotate_map_north_opt,
+			new ThemedIconId(R.drawable.ic_compass_niu, R.drawable.ic_compass_niu_white)
+	),
+
+	MOVEMENT_DIRECTION(
+			OsmandSettings.ROTATE_MAP_BEARING,
+			R.string.rotate_map_bearing_opt,
+			new ThemedIconId(R.drawable.ic_compass_bearing, R.drawable.ic_compass_bearing_white)
+	),
+
+	COMPASS_DIRECTION(
+			OsmandSettings.ROTATE_MAP_COMPASS,
+			R.string.rotate_map_compass_opt,
+			new ThemedIconId(R.drawable.ic_compass, R.drawable.ic_compass_white)
+	),
+
+	MANUALLY_ROTATED(
+			OsmandSettings.ROTATE_MAP_MANUAL,
+			R.string.rotate_map_manual_opt,
+			new ThemedIconId(R.drawable.ic_compass_manual, R.drawable.ic_compass_manual_white)
+	);
+
+	@StringRes
+	private final int titleId;
+	private final ThemedIconId themedIconId;
+	private final int value;
+
+	CompassMode(int value, @StringRes int titleId, @NonNull ThemedIconId themedIconId) {
+		this.value = value;
+		this.titleId = titleId;
+		this.themedIconId = themedIconId;
+	}
+
+	@StringRes
+	public int getTitleId() {
+		return titleId;
+	}
+
+	@NonNull
+	public ThemedIconId getIconId() {
+		return themedIconId;
+	}
+
+	@DrawableRes
+	public int getIconId(boolean nightMode) {
+		return themedIconId.getIconId(nightMode);
+	}
+
+	public int getValue() {
+		return value;
+	}
+
+	@NonNull
+	public static CompassMode getByValue(int value) {
+		for (CompassMode compassMode : values()) {
+			if (compassMode.value == value) {
+				return compassMode;
+			}
+		}
+		return NORTH_IS_UP;
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/enums/MapFocus.java b/OsmAnd/src/net/osmand/plus/settings/enums/MapFocus.java
index 8fd8a05d0d2..f656403b527 100644
--- a/OsmAnd/src/net/osmand/plus/settings/enums/MapFocus.java
+++ b/OsmAnd/src/net/osmand/plus/settings/enums/MapFocus.java
@@ -5,6 +5,7 @@
 import net.osmand.plus.R;
 
 public enum MapFocus {
+
 	CENTER(R.string.position_on_map_center, R.drawable.ic_action_display_position_center, 1),
 	BOTTOM(R.string.position_on_map_bottom, R.drawable.ic_action_display_position_bottom, 2),
 	AUTOMATIC(R.string.shared_string_automatic, R.drawable.ic_action_display_position_auto, 0);
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java
index 4bf9e45f10f..b0304a2bb97 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java
@@ -624,7 +624,7 @@ private SettingsScreenType getCurrentScreenType() {
 	protected int getActiveProfileColor() {
 		return isProfileDependent() ?
 				getSelectedAppMode().getProfileColor(isNightMode()) :
-				ContextCompat.getColor(app, nightMode ? R.color.icon_color_active_dark : R.color.icon_color_active_light);
+				ColorUtilities.getActiveColor(app, nightMode);
 	}
 
 	@ColorRes
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/GeneralProfileSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/GeneralProfileSettingsFragment.java
index b28e1a5add6..ac4c6337ed4 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/GeneralProfileSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/GeneralProfileSettingsFragment.java
@@ -13,7 +13,6 @@
 import android.widget.TextView;
 
 import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
 import androidx.appcompat.app.AlertDialog;
 import androidx.appcompat.widget.AppCompatCheckedTextView;
 import androidx.appcompat.widget.SwitchCompat;
@@ -26,17 +25,18 @@
 import net.osmand.data.PointDescription;
 import net.osmand.plus.R;
 import net.osmand.plus.base.MapViewTrackingUtilities;
+import net.osmand.plus.base.dialog.DialogManager;
+import net.osmand.plus.base.dialog.interfaces.IDialogController;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.backend.preferences.CommonPreference;
 import net.osmand.plus.settings.bottomsheets.CustomizableSingleSelectionBottomSheet;
-import net.osmand.plus.settings.bottomsheets.displaydata.DialogDisplayDataProvider;
-import net.osmand.plus.settings.bottomsheets.displaydata.OnDialogItemSelectedListener;
-import net.osmand.plus.settings.bottomsheets.displaydata.DialogDisplayItem;
-import net.osmand.plus.settings.bottomsheets.displaydata.DialogDisplayData;
+import net.osmand.plus.settings.controllers.CompassModeDialogController;
+import net.osmand.plus.settings.controllers.MapFocusDialogController;
 import net.osmand.plus.settings.enums.AngularConstants;
 import net.osmand.plus.settings.enums.MapFocus;
 import net.osmand.plus.settings.enums.DrivingRegion;
+import net.osmand.plus.settings.enums.CompassMode;
 import net.osmand.plus.settings.enums.MetricsConstants;
 import net.osmand.plus.settings.enums.SpeedConstants;
 import net.osmand.plus.settings.preferences.ListPreferenceEx;
@@ -48,8 +48,7 @@
 import java.util.Arrays;
 import java.util.List;
 
-public class GeneralProfileSettingsFragment extends BaseSettingsFragment
-		implements OnDialogItemSelectedListener, DialogDisplayDataProvider {
+public class GeneralProfileSettingsFragment extends BaseSettingsFragment {
 
 	public static final String TAG = GeneralProfileSettingsFragment.class.getSimpleName();
 
@@ -75,8 +74,24 @@ protected void setupPreferences() {
 		setupAnimatePositionPref();
 		setupExternalInputDevicePref();
 		setupTrackballForMovementsPref();
+
+		updateDialogControllerCallbacks();
 	}
 
+	CompoundButton.OnCheckedChangeListener externalInputDeviceListener = (buttonView, isChecked) -> {
+		ListPreferenceEx externalInputDevice = findPreference(settings.EXTERNAL_INPUT_DEVICE.getId());
+		if (isChecked) {
+			getPreferenceManager().showDialog(externalInputDevice);
+			buttonView.setChecked(false);
+		} else {
+			if (externalInputDevice.callChangeListener(OsmandSettings.NO_EXTERNAL_DEVICE)) {
+				externalInputDevice.setValue(OsmandSettings.NO_EXTERNAL_DEVICE);
+			} else {
+				buttonView.setChecked(true);
+			}
+		}
+	};
+
 	@Override
 	protected void onBindPreferenceViewHolder(Preference preference, PreferenceViewHolder holder) {
 		super.onBindPreferenceViewHolder(preference, holder);
@@ -92,23 +107,6 @@ protected void onBindPreferenceViewHolder(Preference preference, PreferenceViewH
 		}
 	}
 
-	CompoundButton.OnCheckedChangeListener externalInputDeviceListener = new CompoundButton.OnCheckedChangeListener() {
-		@Override
-		public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
-			ListPreferenceEx externalInputDevice = findPreference(settings.EXTERNAL_INPUT_DEVICE.getId());
-			if (isChecked) {
-				getPreferenceManager().showDialog(externalInputDevice);
-				buttonView.setChecked(false);
-			} else {
-				if (externalInputDevice.callChangeListener(OsmandSettings.NO_EXTERNAL_DEVICE)) {
-					externalInputDevice.setValue(OsmandSettings.NO_EXTERNAL_DEVICE);
-				} else {
-					buttonView.setChecked(true);
-				}
-			}
-		}
-	};
-
 	private void setupAppThemePref() {
 		ListPreferenceEx appTheme =
 				findPreference(settings.OSMAND_THEME.getId());
@@ -144,22 +142,16 @@ private Drawable getOsmandThemeIcon() {
 	}
 
 	private void setupRotateMapPref() {
-		ListPreferenceEx rotateMap = findPreference(settings.ROTATE_MAP.getId());
-		rotateMap.setEntries(new String[] {getString(R.string.rotate_map_north_opt), getString(R.string.rotate_map_bearing_opt), getString(R.string.rotate_map_compass_opt), getString(R.string.rotate_map_manual_opt)});
-		rotateMap.setEntryValues(new Integer[] {OsmandSettings.ROTATE_MAP_NONE, OsmandSettings.ROTATE_MAP_BEARING, OsmandSettings.ROTATE_MAP_COMPASS, OsmandSettings.ROTATE_MAP_MANUAL});
-		rotateMap.setIcon(getRotateMapIcon());
-	}
+		ApplicationMode appMode = getSelectedAppMode();
+		CommonPreference<Integer> preference = settings.ROTATE_MAP;
+		int value = preference.getModeValue(appMode);
+		CompassMode compassMode = CompassMode.getByValue(value);
 
-	private Drawable getRotateMapIcon() {
-		switch (settings.ROTATE_MAP.getModeValue(getSelectedAppMode())) {
-			case OsmandSettings.ROTATE_MAP_NONE:
-				return getActiveIcon(R.drawable.ic_action_direction_north);
-			case OsmandSettings.ROTATE_MAP_MANUAL:
-				return getActiveIcon(R.drawable.ic_action_direction_north);
-			case OsmandSettings.ROTATE_MAP_BEARING:
-				return getActiveIcon(R.drawable.ic_action_direction_movement);
-			default:
-				return getActiveIcon(R.drawable.ic_action_direction_compass);
+		Preference uiPreference = findPreference(preference.getId());
+		if (uiPreference != null) {
+			Drawable icon = getActiveIcon(compassMode.getIconId(isNightMode()));
+			uiPreference.setIcon(icon);
+			uiPreference.setSummary(compassMode.getTitleId());
 		}
 	}
 
@@ -174,9 +166,10 @@ private void setup3DViewPref() {
 	}
 
 	private void setupPositionPlacementOnMapPref() {
+		ApplicationMode appMode = getSelectedAppMode();
 		CommonPreference<Integer> preference = settings.POSITION_PLACEMENT_ON_MAP;
-		int selectedDisplayPosition = preference.getModeValue(getSelectedAppMode());
-		MapFocus mapFocus = MapFocus.getByValue(selectedDisplayPosition);
+		int value = preference.getModeValue(appMode);
+		MapFocus mapFocus = MapFocus.getByValue(value);
 
 		Preference uiPreference = findPreference(preference.getId());
 		if (uiPreference != null) {
@@ -398,44 +391,6 @@ public View getView(int position, View convertView, @NonNull ViewGroup parent) {
 		b.show();
 	}
 
-	private void showPositionPlacementDialog() {
-		FragmentActivity activity = getActivity();
-		if (activity != null) {
-			CommonPreference<Integer> preference = settings.POSITION_PLACEMENT_ON_MAP;
-			ApplicationMode appMode = getSelectedAppMode();
-			int selectedValue = preference.getModeValue(appMode);
-			int selectedItemIndex = MapFocus.getByValue(selectedValue).ordinal();
-			FragmentManager fm = activity.getSupportFragmentManager();
-			CustomizableSingleSelectionBottomSheet.showInstance(fm, this, false,
-					preference.getId(), selectedItemIndex, appMode, true);
-		}
-	}
-
-	@Override
-	@Nullable
-	public DialogDisplayData provideDialogDisplayData(@NonNull String dialogId) {
-		if (dialogId.equals(settings.POSITION_PLACEMENT_ON_MAP.getId())) {
-			DialogDisplayData dialogDisplayData = new DialogDisplayData();
-			dialogDisplayData.setTitle(getString(R.string.display_position));
-			List<DialogDisplayItem> displayItems = new ArrayList<>();
-			for (MapFocus mapFocus : MapFocus.values()) {
-				DialogDisplayItem item = new DialogDisplayItem();
-				item.title = getString(mapFocus.getTitleId());
-				item.layoutId = R.layout.bottom_sheet_item_with_bottom_descr_and_radio_btn;
-				if (mapFocus == MapFocus.AUTOMATIC) {
-					item.description = getString(R.string.display_position_automatic_descr);
-				}
-				item.normalIcon = getContentIcon(mapFocus.getIconId());
-				item.selectedIcon = getActiveIcon(mapFocus.getIconId());
-				item.tag = mapFocus;
-				displayItems.add(item);
-			}
-			dialogDisplayData.setDisplayItems(displayItems);
-			return dialogDisplayData;
-		}
-		return null;
-	}
-
 	@Override
 	public void onApplyPreferenceChange(String prefId, boolean applyToAllProfiles, Object newValue) {
 		if (settings.DRIVING_REGION.getId().equals(prefId)) {
@@ -469,36 +424,48 @@ public void onApplyPreferenceChange(String prefId, boolean applyToAllProfiles, O
 	@Override
 	public boolean onPreferenceClick(Preference preference) {
 		String key = preference.getKey();
+		ApplicationMode appMode = getSelectedAppMode();
 		if (key.equals(settings.DRIVING_REGION.getId())) {
 			showDrivingRegionDialog();
 			return true;
+		} else if (key.equals(settings.ROTATE_MAP.getId())) {
+			CompassModeDialogController controller = new CompassModeDialogController(app, appMode);
+			showSingleSelectionDialog(CompassModeDialogController.PROCESS_ID, controller);
+			controller.setCallback(this);
+			return true;
 		} else if (key.equals(settings.POSITION_PLACEMENT_ON_MAP.getId())) {
-			showPositionPlacementDialog();
+			MapFocusDialogController controller = new MapFocusDialogController(app, appMode);
+			showSingleSelectionDialog(MapFocusDialogController.PROCESS_ID, controller);
+			controller.setCallback(this);
 			return true;
 		}
 		return super.onPreferenceClick(preference);
 	}
 
-	@Override
-	public void onDialogItemSelected(@NonNull String dialogId, @NonNull DialogDisplayItem selectedItem) {
-		if (dialogId.equals(settings.POSITION_PLACEMENT_ON_MAP.getId())) {
-			Preference preference = findPreference(dialogId);
-			Object newValue = selectedItem.tag;
-			if (preference != null && newValue instanceof MapFocus) {
-				MapFocus mapFocus = (MapFocus) newValue;
-				onPreferenceChange(preference, mapFocus.getValue());
-			}
+	private void showSingleSelectionDialog(@NonNull String processId,
+	                                       @NonNull IDialogController controller) {
+		FragmentActivity activity = getActivity();
+		if (activity != null) {
+			DialogManager dialogManager = app.getDialogManager();
+			dialogManager.register(processId, controller);
+			FragmentManager fm = activity.getSupportFragmentManager();
+			CustomizableSingleSelectionBottomSheet.showInstance(fm, processId, false);
 		}
 	}
 
-	@Override
-	public boolean onPreferenceChange(Preference preference, Object newValue) {
-		String prefId = preference.getKey();
-		if (settings.ROTATE_MAP.getId().equals(prefId)) {
-			onConfirmPreferenceChange(prefId, newValue, ApplyQueryType.SNACK_BAR);
-			return false;
+	private void updateDialogControllerCallbacks() {
+		IDialogController controller;
+		DialogManager dialogManager = app.getDialogManager();
+
+		controller = dialogManager.findController(CompassModeDialogController.PROCESS_ID);
+		if (controller instanceof CompassModeDialogController) {
+			((CompassModeDialogController) controller).setCallback(this);
+		}
+
+		controller = dialogManager.findController(MapFocusDialogController.PROCESS_ID);
+		if (controller instanceof MapFocusDialogController) {
+			((MapFocusDialogController) controller).setCallback(this);
 		}
-		return super.onPreferenceChange(preference, newValue);
 	}
 
 	@Override
@@ -507,8 +474,6 @@ public void onPreferenceChanged(String prefId) {
 		if (preference != null) {
 			if (settings.OSMAND_THEME.getId().equals(prefId)) {
 				preference.setIcon(getOsmandThemeIcon());
-			} else if (settings.ROTATE_MAP.getId().equals(prefId)) {
-				preference.setIcon(getRotateMapIcon());
 			} else if (settings.MAP_SCREEN_ORIENTATION.getId().equals(prefId)) {
 				preference.setIcon(getMapScreenOrientationIcon());
 			}
diff --git a/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/CompassButton.java b/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/CompassButton.java
index 9c90461cfc2..daac2aaf38e 100644
--- a/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/CompassButton.java
+++ b/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/CompassButton.java
@@ -20,8 +20,9 @@
 
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.settings.controllers.CompassModeWidgetDialogController;
 import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.enums.CompassMode;
 import net.osmand.plus.views.mapwidgets.configure.CompassVisibilityBottomSheetDialogFragment.CompassVisibility;
 
 public class CompassButton extends MapButton {
@@ -39,6 +40,10 @@ public CompassButton(@NonNull MapActivity mapActivity) {
 		setIconColorId(0);
 		setBackground(R.drawable.btn_inset_circle_trans, R.drawable.btn_inset_circle_night);
 		setOnClickListener(v -> app.getMapViewTrackingUtilities().switchRotateMapMode());
+		setOnLongClickListener(v -> {
+			CompassModeWidgetDialogController.showDialog(mapActivity);
+			return true;
+		});
 	}
 
 	@Nullable
@@ -78,20 +83,10 @@ public void updateState(boolean nightMode) {
 			this.mapRotation = mapRotation;
 			view.invalidate();
 		}
-
-		if (settings.ROTATE_MAP.get() == OsmandSettings.ROTATE_MAP_NONE) {
-			setIconId(R.drawable.ic_compass_niu, R.drawable.ic_compass_niu_white);
-			setContentDesc(R.string.rotate_map_north_opt);
-		} else if (settings.ROTATE_MAP.get() == OsmandSettings.ROTATE_MAP_MANUAL) {
-			setIconId(R.drawable.ic_compass_niu, R.drawable.ic_compass_niu_white);
-			setContentDesc(R.string.rotate_map_manual_opt);
-		} else if (settings.ROTATE_MAP.get() == OsmandSettings.ROTATE_MAP_BEARING) {
-			setIconId(R.drawable.ic_compass_bearing, R.drawable.ic_compass_bearing_white);
-			setContentDesc(R.string.rotate_map_bearing_opt);
-		} else {
-			setIconId(R.drawable.ic_compass, R.drawable.ic_compass_white);
-			setContentDesc(R.string.rotate_map_compass_opt);
-		}
+		int selectedValue = settings.ROTATE_MAP.get();
+		CompassMode compassMode = CompassMode.getByValue(selectedValue);
+		setIconId(compassMode.getIconId());
+		setContentDesc(compassMode.getTitleId());
 	}
 
 	@Override
@@ -172,7 +167,6 @@ public void onAnimationCancel(View view) {
 		}
 	}
 
-
 	public void cancelHideAnimation() {
 		if (hideAnimator != null) {
 			hideAnimator.cancel();
diff --git a/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/MapButton.java b/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/MapButton.java
index 25ad7c20f16..7a8d5f317fb 100644
--- a/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/MapButton.java
+++ b/OsmAnd/src/net/osmand/plus/views/controls/maphudbuttons/MapButton.java
@@ -19,6 +19,7 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.base.containers.ThemedIconId;
 import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.UiUtilities;
@@ -41,11 +42,7 @@ public abstract class MapButton {
 	public final ImageView view;
 	public final String id;
 
-	@DrawableRes
-	private int dayIconId;
-	@DrawableRes
-	private int nightIconId;
-
+	private ThemedIconId themedIconId;
 	@DrawableRes
 	private int dayBackgroundId;
 	@DrawableRes
@@ -96,13 +93,12 @@ protected void setBackground(@DrawableRes int dayBackgroundId, @DrawableRes int
 	}
 
 	protected void setIconId(@DrawableRes int iconId) {
-		setIconId(iconId, iconId);
+		setIconId(new ThemedIconId(iconId, iconId));
 	}
 
-	protected void setIconId(@DrawableRes int dayIconId, @DrawableRes int nightIconId) {
-		if (this.dayIconId != dayIconId || this.nightIconId != nightIconId) {
-			this.dayIconId = dayIconId;
-			this.nightIconId = nightIconId;
+	protected void setIconId(@NonNull ThemedIconId themedIconId) {
+		if (!Algorithms.objectEquals(this.themedIconId, themedIconId)) {
+			this.themedIconId = themedIconId;
 			this.forceUpdate = true;
 		}
 	}
@@ -159,7 +155,7 @@ public void update(boolean nightMode, boolean routeDialogOpened, boolean bottomB
 		}
 
 		Drawable drawable = null;
-		int iconId = nightMode ? nightIconId : dayIconId;
+		int iconId = themedIconId.getIconId(nightMode);
 		if (iconId != 0) {
 			if (iconColor != null) {
 				drawable = iconsCache.getPaintedIcon(iconId, iconColor);
