diff --git a/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java b/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java
index ff8a78d5917..c7ab43ec6ae 100644
--- a/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java
+++ b/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java
@@ -14,6 +14,7 @@
 import android.widget.LinearLayout.LayoutParams;
 
 import androidx.annotation.LayoutRes;
+import androidx.annotation.NonNull;
 import androidx.core.content.ContextCompat;
 
 import net.osmand.plus.OsmandApplication;
@@ -62,7 +63,7 @@ public static View prepareAppModeView(Activity a, List<ApplicationMode> values,
 			buttons[k++] = createToggle(a.getLayoutInflater(), app, R.layout.mode_view, ll.findViewById(R.id.app_modes_content), ma, useMapTheme);
 		}
 		for (int i = 0; i < buttons.length; i++) {
-			updateButtonState(app, values, selected, onClickListener, buttons, i, singleSelection, useMapTheme, nightMode);
+			updateButtonState(a, values, selected, onClickListener, buttons, i, singleSelection, useMapTheme, nightMode);
 		}
 
 		ApplicationMode activeMode = app.getSettings().getApplicationMode();
@@ -84,10 +85,11 @@ public void onGlobalLayout() {
 	}
 
 
-	public static void updateButtonState(OsmandApplication app, List<ApplicationMode> visible,
+	public static void updateButtonState(@NonNull Context context, List<ApplicationMode> visible,
 	                                     Set<ApplicationMode> selected, View.OnClickListener onClickListener, View[] buttons,
 	                                     int i, boolean singleChoice, boolean useMapTheme, boolean nightMode) {
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		OsmandApplication app = (OsmandApplication) context.getApplicationContext();
+		Context themedCtx = UiUtilities.getThemedContext(context, nightMode);
 		if (buttons[i] != null) {
 			View tb = buttons[i];
 			ApplicationMode mode = visible.get(i);
@@ -130,7 +132,7 @@ public void onClick(View v) {
 						onClickListener.onClick(null);
 					}
 					for (int i = 0; i < visible.size(); i++) {
-						updateButtonState(app, visible, selected, onClickListener, buttons, i, singleChoice, useMapTheme, nightMode);
+						updateButtonState(context, visible, selected, onClickListener, buttons, i, singleChoice, useMapTheme, nightMode);
 					}
 				}
 			});
diff --git a/OsmAnd/src/net/osmand/plus/backup/ui/BackupTypesAdapter.java b/OsmAnd/src/net/osmand/plus/backup/ui/BackupTypesAdapter.java
index 01ef4d734ff..2f280866f18 100644
--- a/OsmAnd/src/net/osmand/plus/backup/ui/BackupTypesAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/backup/ui/BackupTypesAdapter.java
@@ -1,6 +1,7 @@
 package net.osmand.plus.backup.ui;
 
 
+import android.content.Context;
 import android.graphics.drawable.Drawable;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -55,14 +56,14 @@ public class BackupTypesAdapter extends OsmandBaseExpandableListAdapter {
 	private final boolean nightMode;
 	private final boolean cloudRestore;
 
-	public BackupTypesAdapter(OsmandApplication app, OnItemSelectedListener listener, boolean cloudRestore, boolean nightMode) {
-		this.app = app;
+	public BackupTypesAdapter(@NonNull Context context, OnItemSelectedListener listener, boolean cloudRestore, boolean nightMode) {
+		this.app = (OsmandApplication) context.getApplicationContext();
 		this.listener = listener;
 		this.nightMode = nightMode;
 		this.cloudRestore = cloudRestore;
 		uiUtilities = app.getUIUtilities();
-		themedInflater = UiUtilities.getInflater(app, nightMode);
-		activeColor = ContextCompat.getColor(app, nightMode ? R.color.icon_color_active_dark : R.color.icon_color_active_light);
+		themedInflater = UiUtilities.getInflater(context, nightMode);
+		activeColor = ContextCompat.getColor(context, nightMode ? R.color.icon_color_active_dark : R.color.icon_color_active_light);
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/backup/ui/BaseBackupTypesFragment.java b/OsmAnd/src/net/osmand/plus/backup/ui/BaseBackupTypesFragment.java
index d50451e653f..3fbf977a339 100644
--- a/OsmAnd/src/net/osmand/plus/backup/ui/BaseBackupTypesFragment.java
+++ b/OsmAnd/src/net/osmand/plus/backup/ui/BaseBackupTypesFragment.java
@@ -93,7 +93,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c
 
 		progressBar = view.findViewById(R.id.progress_bar);
 
-		adapter = new BackupTypesAdapter(app, this, cloudRestore, nightMode);
+		adapter = new BackupTypesAdapter(view.getContext(), this, cloudRestore, nightMode);
 		adapter.updateSettingsItems(dataList, selectedItemsMap);
 
 		ExpandableListView expandableList = view.findViewById(R.id.list);
diff --git a/OsmAnd/src/net/osmand/plus/dialogs/EditTrackGroupBottomSheet.java b/OsmAnd/src/net/osmand/plus/dialogs/EditTrackGroupBottomSheet.java
index aa61ca9b3f8..dd57a1384a4 100644
--- a/OsmAnd/src/net/osmand/plus/dialogs/EditTrackGroupBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/dialogs/EditTrackGroupBottomSheet.java
@@ -34,7 +34,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 		app = requiredMyApplication();
 		groupName = Algorithms.isEmpty(group.getName()) ? app.getString(R.string.shared_string_gpx_points) : group.getName();
 
-		View mainView = UiUtilities.getInflater(app, nightMode).inflate(R.layout.track_name_edit_text, null);
+		View mainView = UiUtilities.getInflater(requireContext(), nightMode).inflate(R.layout.track_name_edit_text, null);
 		setupTextBox(mainView);
 		setupEditText(mainView);
 
diff --git a/OsmAnd/src/net/osmand/plus/dialogs/LocationSourceBottomSheet.java b/OsmAnd/src/net/osmand/plus/dialogs/LocationSourceBottomSheet.java
index ea0b0a29768..cd3c2c688b4 100644
--- a/OsmAnd/src/net/osmand/plus/dialogs/LocationSourceBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/dialogs/LocationSourceBottomSheet.java
@@ -66,7 +66,7 @@ private void createSourceItems() {
 		int margin = getDimen(R.dimen.content_padding);
 		int activeColorId = ColorUtilities.getActiveIconColorId(nightMode);
 		int secondaryColorId = ColorUtilities.getSecondaryIconColorId(nightMode);
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 
 		for (LocationSource source : LocationSource.values()) {
 			View view = inflater.inflate(R.layout.bottom_sheet_item_with_radio_btn_left, null);
diff --git a/OsmAnd/src/net/osmand/plus/dialogs/RenameFileBottomSheet.java b/OsmAnd/src/net/osmand/plus/dialogs/RenameFileBottomSheet.java
index 4b0978498e2..47dc6fc7592 100644
--- a/OsmAnd/src/net/osmand/plus/dialogs/RenameFileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/dialogs/RenameFileBottomSheet.java
@@ -66,7 +66,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 		}
 		items.add(new TitleItem(getString(R.string.shared_string_rename)));
 
-		View mainView = UiUtilities.getInflater(app, nightMode).inflate(R.layout.track_name_edit_text, null);
+		View mainView = UiUtilities.getInflater(requireContext(), nightMode).inflate(R.layout.track_name_edit_text, null);
 		nameTextBox = setupTextBox(mainView);
 		editText = setupEditText(mainView);
 		AndroidUtils.softKeyboardDelayed(getActivity(), editText);
diff --git a/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java b/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java
index eb05d021163..806b4bd8b1e 100644
--- a/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java
@@ -41,7 +41,7 @@ public void onCreate(Bundle savedInstanceState) {
 
 	@Override
 	public void createMenuItems(Bundle savedInstanceState) {
-		View root = UiUtilities.getInflater(app, nightMode).inflate(R.layout.bottom_sheet_icon_title_description, null);
+		View root = UiUtilities.getInflater(requireContext(), nightMode).inflate(R.layout.bottom_sheet_icon_title_description, null);
 		((ImageView) root.findViewById(R.id.icon)).setImageDrawable(app.getUIUtilities().getIcon(R.drawable.img_speed_camera_warning));
 		((TextView) root.findViewById(R.id.title)).setText(R.string.speed_camera_pois);
 		((TextView) root.findViewById(R.id.description)).setText(getDescriptionText());
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchAdapter.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchAdapter.java
index 55b5907198f..74a7fc4fab2 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchAdapter.java
@@ -2,6 +2,7 @@
 
 import static net.osmand.plus.download.local.dialogs.LocalItemsAdapter.LIST_ITEM_TYPE;
 
+import android.content.Context;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
@@ -32,7 +33,8 @@ public class LocalSearchAdapter extends RecyclerView.Adapter<ViewHolder> impleme
 	private final LayoutInflater themedInflater;
 	private final boolean nightMode;
 
-	public LocalSearchAdapter(@NonNull OsmandApplication app, @NonNull LocalItemListener listener, boolean nightMode) {
+	public LocalSearchAdapter(@NonNull Context context, @NonNull LocalItemListener listener, boolean nightMode) {
+		OsmandApplication app = (OsmandApplication) context.getApplicationContext();
 		this.listener = listener;
 		this.nightMode = nightMode;
 		this.filter = new LocalSearchFilter(app, result -> {
@@ -42,7 +44,7 @@ public LocalSearchAdapter(@NonNull OsmandApplication app, @NonNull LocalItemList
 			notifyDataSetChanged();
 			return true;
 		});
-		themedInflater = UiUtilities.getInflater(app, nightMode);
+		themedInflater = UiUtilities.getInflater(context, nightMode);
 	}
 
 	public void setItems(@NonNull List<BaseLocalItem> items) {
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchFragment.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchFragment.java
index e10e5d31674..d1d4e4a17d9 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchFragment.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalSearchFragment.java
@@ -118,7 +118,7 @@ private void setupToolbar(@NonNull View view) {
 	}
 
 	private void setupRecyclerView(@NonNull View view) {
-		adapter = new LocalSearchAdapter(app, this, nightMode);
+		adapter = new LocalSearchAdapter(view.getContext(), this, nightMode);
 
 		RecyclerView recyclerView = view.findViewById(R.id.recycler_view);
 		recyclerView.setLayoutManager(new LinearLayoutManager(view.getContext()));
diff --git a/OsmAnd/src/net/osmand/plus/importfiles/ui/SelectPointsFragment.java b/OsmAnd/src/net/osmand/plus/importfiles/ui/SelectPointsFragment.java
index 4e00cf25f33..f2e2672cf27 100644
--- a/OsmAnd/src/net/osmand/plus/importfiles/ui/SelectPointsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/importfiles/ui/SelectPointsFragment.java
@@ -127,7 +127,7 @@ protected void setupListView(@NonNull View view) {
 
 	@NonNull
 	private View getHeaderView() {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		View view = inflater.inflate(R.layout.suggested_points_header, null);
 
 		TextView title = view.findViewById(R.id.title);
diff --git a/OsmAnd/src/net/osmand/plus/importfiles/ui/TrackPointsAdapter.java b/OsmAnd/src/net/osmand/plus/importfiles/ui/TrackPointsAdapter.java
index cf7380413a1..61cb9977c9f 100644
--- a/OsmAnd/src/net/osmand/plus/importfiles/ui/TrackPointsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/importfiles/ui/TrackPointsAdapter.java
@@ -55,7 +55,7 @@ class TrackPointsAdapter extends OsmandBaseExpandableListAdapter {
 		this.app = (OsmandApplication) context.getApplicationContext();
 		this.nightMode = nightMode;
 		this.selectedPoints = selectedPoints;
-		inflater = UiUtilities.getInflater(app, nightMode);
+		inflater = UiUtilities.getInflater(context, nightMode);
 		uiUtilities = app.getUIUtilities();
 		viewCache = UpdateLocationUtils.getUpdateLocationViewCache(context);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesFragment.java b/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesFragment.java
index d752b80ddd3..c3c9f8bc622 100644
--- a/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesFragment.java
+++ b/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesFragment.java
@@ -418,7 +418,7 @@ public View getChildView(int groupPosition, int childPosition,
 		public View getGroupView(int groupPosition, boolean isExpanded, View convertView, ViewGroup parent) {
 			View view = convertView;
 			if (view == null) {
-				LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+				LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 				view = inflater.inflate(R.layout.list_group_title_with_right_descr, parent, false);
 			}
 			view.setOnClickListener(null);
diff --git a/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesSettingsBottomSheet.java b/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesSettingsBottomSheet.java
index d0ec89d6fc2..7bc8875a2c5 100644
--- a/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesSettingsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/liveupdates/LiveUpdatesSettingsBottomSheet.java
@@ -104,7 +104,7 @@ public static void showInstance(@NonNull FragmentManager fragmentManager, Fragme
 	public void createMenuItems(Bundle savedInstanceState) {
 		app = requiredMyApplication();
 		settings = app.getSettings();
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		if (getTargetFragment() instanceof OnLiveUpdatesForLocalChange) {
 			onLiveUpdatesForLocalChange = (OnLiveUpdatesForLocalChange) getTargetFragment();
 		}
@@ -137,7 +137,8 @@ public void createMenuItems(Bundle savedInstanceState) {
 		items.add(itemUpdateTimeInfo);
 		refreshUpdateTimeInfo();
 
-		View itemLiveUpdate = getCustomButtonView(app, null, localUpdatePreference.get(), nightMode);
+		Context context = requireContext();
+		View itemLiveUpdate = getCustomButtonView(context, null, localUpdatePreference.get(), nightMode);
 		View itemLiveUpdateButton = itemLiveUpdate.findViewById(R.id.button_container);
 		CompoundButton button = itemLiveUpdateButton.findViewById(R.id.compound_button);
 		UiUtilities.setupCompoundButton(button, nightMode, TOOLBAR);
@@ -164,7 +165,7 @@ public void onClick(View view) {
 									}
 								})) {
 							item.setTitle(getStateText(!checked));
-							updateCustomButtonView(app, null, item.getView(), !checked, nightMode);
+							updateCustomButtonView(context, null, item.getView(), !checked, nightMode);
 							CommonPreference<Boolean> localUpdatePreference = preferenceForLocalIndex(fileName, settings);
 							frequencyToggleButton.setItemsEnabled(localUpdatePreference.get());
 							timeOfDayToggleButton.setItemsEnabled(localUpdatePreference.get());
diff --git a/OsmAnd/src/net/osmand/plus/mapcontextmenu/MenuBuilder.java b/OsmAnd/src/net/osmand/plus/mapcontextmenu/MenuBuilder.java
index b42423ed732..2ca92c0e00e 100644
--- a/OsmAnd/src/net/osmand/plus/mapcontextmenu/MenuBuilder.java
+++ b/OsmAnd/src/net/osmand/plus/mapcontextmenu/MenuBuilder.java
@@ -1400,7 +1400,7 @@ private void buildGetWikipediaBanner(ViewGroup viewGroup) {
 		OsmAndFeature feature = OsmAndFeature.WIKIPEDIA;
 		LinearLayout view = buildCollapsableContentView(app, false, true);
 
-		View banner = UiUtilities.getInflater(app, !light)
+		View banner = UiUtilities.getInflater(mapActivity, !light)
 				.inflate(R.layout.get_wikipedia_context_menu_banner, view, false);
 
 		ImageView ivIcon = banner.findViewById(R.id.icon);
diff --git a/OsmAnd/src/net/osmand/plus/mapcontextmenu/builders/cards/CardsRowBuilder.java b/OsmAnd/src/net/osmand/plus/mapcontextmenu/builders/cards/CardsRowBuilder.java
index 9ee5e680de1..0888c4e48c0 100644
--- a/OsmAnd/src/net/osmand/plus/mapcontextmenu/builders/cards/CardsRowBuilder.java
+++ b/OsmAnd/src/net/osmand/plus/mapcontextmenu/builders/cards/CardsRowBuilder.java
@@ -86,7 +86,7 @@ public void onLoadingImage(boolean loading) {
 	}
 
 	public void build(@NonNull GalleryController controller, boolean onlinePhotos, boolean nightMode) {
-		LayoutInflater themedInflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater themedInflater = UiUtilities.getInflater(mapActivity, nightMode);
 		galleryView = themedInflater.inflate(R.layout.gallery_card, null);
 		RecyclerView recyclerView = galleryView.findViewById(R.id.recycler_view);
 
diff --git a/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/SelectPointsCategoryBottomSheet.java b/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/SelectPointsCategoryBottomSheet.java
index bd2a45844f7..2457316a724 100644
--- a/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/SelectPointsCategoryBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/SelectPointsCategoryBottomSheet.java
@@ -88,7 +88,7 @@ private BaseBottomSheetItem createTitleItem() {
 	@NonNull
 	private BaseBottomSheetItem createAddNewCategoryItem() {
 		OsmandApplication app = requiredMyApplication();
-		View container = UiUtilities.getInflater(app, nightMode)
+		View container = UiUtilities.getInflater(requireContext(), nightMode)
 				.inflate(R.layout.bottom_sheet_item_with_descr_64dp, null);
 		container.setMinimumHeight(getResources().getDimensionPixelSize(R.dimen.bottom_sheet_list_item_height));
 
diff --git a/OsmAnd/src/net/osmand/plus/mapsource/EditMapSourceDialogFragment.java b/OsmAnd/src/net/osmand/plus/mapsource/EditMapSourceDialogFragment.java
index a07da83e3b7..5ed5c63ef07 100644
--- a/OsmAnd/src/net/osmand/plus/mapsource/EditMapSourceDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/mapsource/EditMapSourceDialogFragment.java
@@ -470,7 +470,7 @@ private OnClickListener getClickListener(ConfigurationItem item) {
 	}
 
 	private void addConfigurationItems(ConfigurationItem... items) {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		for (ConfigurationItem item : items) {
 			View view = inflater.inflate(R.layout.list_item_ui_customization, null);
 			((ImageView) view.findViewById(R.id.icon)).setImageDrawable(app.getUIUtilities().getIcon(item.iconRes, nightMode));
diff --git a/OsmAnd/src/net/osmand/plus/mapsource/InputZoomLevelsBottomSheet.java b/OsmAnd/src/net/osmand/plus/mapsource/InputZoomLevelsBottomSheet.java
index 85fc5591f93..29a9238efcb 100644
--- a/OsmAnd/src/net/osmand/plus/mapsource/InputZoomLevelsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/mapsource/InputZoomLevelsBottomSheet.java
@@ -77,7 +77,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 			sliderDescrRes = savedInstanceState.getInt(SLIDER_DESCR_RES_KEY);
 			newMapSource = savedInstanceState.getBoolean(NEW_MAP_SOURCE);
 		}
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		TitleItem titleItem = new TitleItem(getString(R.string.shared_string_zoom_levels));
 		items.add(titleItem);
 		View sliderView = inflater.inflate(R.layout.zoom_levels_with_descr, null);
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/graph/CommonChartAdapter.java b/OsmAnd/src/net/osmand/plus/measurementtool/graph/CommonChartAdapter.java
index 9c9c3979e4c..115596d7a47 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/graph/CommonChartAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/graph/CommonChartAdapter.java
@@ -178,7 +178,7 @@ private void attachSpeedStatistics(@NonNull GpxTrackAnalysis analysis) {
 	}
 
 	private LayoutInflater createThemedInflater() {
-		return LayoutInflater.from(UiUtilities.getThemedContext(app, isNightMode()));
+		return LayoutInflater.from(UiUtilities.getThemedContext(chart.getContext(), isNightMode()));
 	}
 
 	public void setGpxGraphType(@Nullable GPXTabItemType gpxGraphType) {
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/graph/CustomChartAdapter.java b/OsmAnd/src/net/osmand/plus/measurementtool/graph/CustomChartAdapter.java
index ecfe550d255..200060ba525 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/graph/CustomChartAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/graph/CustomChartAdapter.java
@@ -113,7 +113,7 @@ protected void attachBottomInfo() {
 
 	private void attachLegend(List<RouteSegmentAttribute> list,
 	                          String propertyNameToFullSpan) {
-		Context themedCtx = UiUtilities.getThemedContext(app, isNightMode());
+		Context themedCtx = UiUtilities.getThemedContext(chart.getContext(), isNightMode());
 		LayoutInflater inflater = LayoutInflater.from(themedCtx);
 		for (RouteSegmentAttribute segment : list) {
 			View view = inflater.inflate(R.layout.route_details_legend, bottomInfoContainer, false);
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AddNewTrackFolderBottomSheet.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AddNewTrackFolderBottomSheet.java
index 609329160c3..6824f51159d 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AddNewTrackFolderBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AddNewTrackFolderBottomSheet.java
@@ -66,7 +66,7 @@ public void onCreate(Bundle savedInstanceState) {
 	public void createMenuItems(Bundle savedInstanceState) {
 		items.add(new TitleItem(getString(R.string.add_new_folder)));
 
-		View view = UiUtilities.getInflater(app, nightMode).inflate(R.layout.track_name_edit_text, null);
+		View view = UiUtilities.getInflater(requireContext(), nightMode).inflate(R.layout.track_name_edit_text, null);
 		nameTextBox = view.findViewById(R.id.name_text_box);
 		int textBoxBgColorId = nightMode ? R.color.card_and_list_background_light : R.color.activity_background_color_light;
 		int textBoxBgColor = ContextCompat.getColor(app, textBoxBgColorId);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/PluginInstalledBottomSheetDialog.java b/OsmAnd/src/net/osmand/plus/plugins/PluginInstalledBottomSheetDialog.java
index 5255e10a38e..70a0873e428 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/PluginInstalledBottomSheetDialog.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/PluginInstalledBottomSheetDialog.java
@@ -249,7 +249,7 @@ public void onClick(View v) {
 
 	private void createSuggestedMapsItems(List<IndexItem> suggestedMaps) {
 		OsmandApplication app = requiredMyApplication();
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 
 		items.add(new DividerItem(themedCtx));
 
diff --git a/OsmAnd/src/net/osmand/plus/plugins/audionotes/adapters/NotesAdapter.java b/OsmAnd/src/net/osmand/plus/plugins/audionotes/adapters/NotesAdapter.java
index 6e758affd8d..e24c75cec1a 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/audionotes/adapters/NotesAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/audionotes/adapters/NotesAdapter.java
@@ -78,7 +78,7 @@ public View getView(int position, View row, @NonNull ViewGroup parent) {
 					|| type == TYPE_VIDEO_HEADER;
 
 			if (row == null) {
-				LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+				LayoutInflater inflater = UiUtilities.getInflater(themedCtx, nightMode);
 				if (header) {
 					row = inflater.inflate(R.layout.list_item_header, parent, false);
 					HeaderViewHolder hHolder = new HeaderViewHolder(row);
@@ -101,7 +101,7 @@ public View getView(int position, View row, @NonNull ViewGroup parent) {
 
 			return row;
 		} else {
-			LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+			LayoutInflater inflater = UiUtilities.getInflater(themedCtx, nightMode);
 			boolean lastCard = getCardsCount() == position + 1;
 			int margin = app.getResources().getDimensionPixelSize(R.dimen.content_padding);
 			int sideMargin = app.getResources().getDisplayMetrics().widthPixels / 10;
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingClearDataBottomSheet.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingClearDataBottomSheet.java
index d835f00d499..f57e9be31fb 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingClearDataBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingClearDataBottomSheet.java
@@ -1,5 +1,7 @@
 package net.osmand.plus.plugins.monitoring;
 
+import static net.osmand.plus.plugins.monitoring.TripRecordingOptionsBottomSheet.ACTION_CLEAR_DATA;
+
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -8,18 +10,16 @@
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithDescription;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerSpaceItem;
 import net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.DismissTargetFragment;
 import net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.ItemType;
-
-import static net.osmand.plus.plugins.monitoring.TripRecordingOptionsBottomSheet.ACTION_CLEAR_DATA;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
 
 public class TripRecordingClearDataBottomSheet extends MenuBottomSheetDialogFragment implements DismissTargetFragment {
 
@@ -38,7 +38,7 @@ public static void showInstance(@NonNull FragmentManager fragmentManager, @NonNu
 	@Override
 	public void createMenuItems(Bundle savedInstanceState) {
 		app = requiredMyApplication();
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		int verticalBig = getResources().getDimensionPixelSize(R.dimen.dialog_content_margin);
 		int verticalNormal = getResources().getDimensionPixelSize(R.dimen.content_padding);
 		String description = getString(R.string.clear_recorded_data_warning)
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingDiscardBottomSheet.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingDiscardBottomSheet.java
index 0680f99b67b..34a95d63fc6 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingDiscardBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingDiscardBottomSheet.java
@@ -1,5 +1,7 @@
 package net.osmand.plus.plugins.monitoring;
 
+import static net.osmand.plus.plugins.monitoring.TripRecordingOptionsBottomSheet.ACTION_STOP_AND_DISMISS;
+
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -8,19 +10,17 @@
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.OsmandApplication;
-import net.osmand.plus.plugins.PluginsHelper;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithDescription;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerSpaceItem;
+import net.osmand.plus.plugins.PluginsHelper;
 import net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.DismissTargetFragment;
 import net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.ItemType;
-
-import static net.osmand.plus.plugins.monitoring.TripRecordingOptionsBottomSheet.ACTION_STOP_AND_DISMISS;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
 
 public class TripRecordingDiscardBottomSheet extends MenuBottomSheetDialogFragment implements DismissTargetFragment {
 
@@ -40,7 +40,7 @@ public static void showInstance(@NonNull FragmentManager fragmentManager, @NonNu
 	public void createMenuItems(Bundle savedInstanceState) {
 		app = requiredMyApplication();
 		OsmandMonitoringPlugin plugin = PluginsHelper.getPlugin(OsmandMonitoringPlugin.class);
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		int verticalBig = getResources().getDimensionPixelSize(R.dimen.dialog_content_margin);
 		int verticalNormal = getResources().getDimensionPixelSize(R.dimen.content_padding);
 		View buttonDiscard = createItem(inflater, ItemType.STOP);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingOptionsBottomSheet.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingOptionsBottomSheet.java
index 0fa7c0ab5d8..f145b218259 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingOptionsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/TripRecordingOptionsBottomSheet.java
@@ -1,5 +1,7 @@
 package net.osmand.plus.plugins.monitoring;
 
+import static net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.UPDATE_DYNAMIC_ITEMS;
+
 import android.app.Activity;
 import android.app.Dialog;
 import android.os.Bundle;
@@ -13,26 +15,24 @@
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.shared.gpx.GpxFile;
-import net.osmand.plus.track.helpers.save.SaveGpxHelper;
-import net.osmand.plus.utils.ColorUtilities;
-import net.osmand.plus.track.helpers.SelectedGpxFile;
 import net.osmand.plus.OsmandApplication;
-import net.osmand.plus.plugins.PluginsHelper;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.SimpleBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerSpaceItem;
+import net.osmand.plus.plugins.PluginsHelper;
 import net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.DismissTargetFragment;
 import net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.ItemType;
 import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.track.helpers.SelectedGpxFile;
+import net.osmand.plus.track.helpers.save.SaveGpxHelper;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.shared.gpx.GpxFile;
 import net.osmand.util.Algorithms;
 
-import static net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.UPDATE_DYNAMIC_ITEMS;
-
 public class TripRecordingOptionsBottomSheet extends MenuBottomSheetDialogFragment implements DismissTargetFragment {
 
 	public static final String TAG = TripRecordingOptionsBottomSheet.class.getSimpleName();
@@ -81,7 +81,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 		settings = app.getSettings();
 		helper = app.getSavingTrackHelper();
 		selectedGpxFile = helper.getCurrentTrack();
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		FragmentManager fragmentManager = getFragmentManager();
 		int dp16 = getResources().getDimensionPixelSize(R.dimen.content_padding);
 		int dp36 = getResources().getDimensionPixelSize(R.dimen.context_menu_controller_height);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/BugBottomSheetDialog.java b/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/BugBottomSheetDialog.java
index f2886807b19..1849b25b2a7 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/BugBottomSheetDialog.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/BugBottomSheetDialog.java
@@ -54,7 +54,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 
 		items.add(new TitleItem(getString(titleTextId)));
 
-		View osmNoteView = View.inflate(UiUtilities.getThemedContext(app, nightMode),
+		View osmNoteView = View.inflate(UiUtilities.getThemedContext(requireContext(), nightMode),
 				R.layout.open_osm_note_text, null);
 		osmNoteView.getViewTreeObserver().addOnGlobalLayoutListener(getShadowLayoutListener());
 		TextInputLayout textBox = osmNoteView.findViewById(R.id.name_text_box);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersFragment.java b/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersFragment.java
index 966afc2f81d..2f2dc7abe83 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersFragment.java
@@ -204,7 +204,7 @@ private String getMonthPeriod() {
 	}
 
 	private void updateContributionsList() {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		LinearLayout list = mainView.findViewById(R.id.contributions_list);
 		list.removeAllViews();
 
diff --git a/OsmAnd/src/net/osmand/plus/plugins/rastermaps/SelectTilesDownloadTypeAlertDialog.java b/OsmAnd/src/net/osmand/plus/plugins/rastermaps/SelectTilesDownloadTypeAlertDialog.java
index 8fe6761503a..78ebebbb254 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/rastermaps/SelectTilesDownloadTypeAlertDialog.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/rastermaps/SelectTilesDownloadTypeAlertDialog.java
@@ -11,6 +11,8 @@
 import android.widget.CompoundButton;
 import android.widget.TextView;
 
+import androidx.annotation.NonNull;
+
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.plugins.rastermaps.DownloadTilesHelper.DownloadType;
@@ -22,8 +24,6 @@
 import java.util.ArrayList;
 import java.util.List;
 
-import androidx.annotation.NonNull;
-
 class SelectTilesDownloadTypeAlertDialog {
 
 	private final OsmandApplication app;
@@ -36,12 +36,12 @@ class SelectTilesDownloadTypeAlertDialog {
 
 	private List<Pair<String, String>> items;
 
-	public SelectTilesDownloadTypeAlertDialog(@NonNull OsmandApplication app,
+	public SelectTilesDownloadTypeAlertDialog(@NonNull Context context,
 	                                          boolean nightMode,
 	                                          boolean allSelected,
 	                                          @NonNull DownloadTypeSelectionListener listener) {
-		this.app = app;
-		this.layoutInflater = UiUtilities.getInflater(app, nightMode);
+		this.app = (OsmandApplication) context.getApplicationContext();
+		this.layoutInflater = UiUtilities.getInflater(context, nightMode);
 		this.nightMode = nightMode;
 		this.selectedItem = allSelected ? 0 : 1;
 		this.listener = listener;
diff --git a/OsmAnd/src/net/osmand/plus/poi/RearrangePoiFiltersFragment.java b/OsmAnd/src/net/osmand/plus/poi/RearrangePoiFiltersFragment.java
index d1bf14825ee..1a1ced9c614 100644
--- a/OsmAnd/src/net/osmand/plus/poi/RearrangePoiFiltersFragment.java
+++ b/OsmAnd/src/net/osmand/plus/poi/RearrangePoiFiltersFragment.java
@@ -110,7 +110,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c
 
 		boolean nightMode = isNightMode(app, usedOnMap);
 
-		View mainView = UiUtilities.getInflater(app, nightMode).inflate(R.layout.edit_arrangement_list_fragment, container, false);
+		View mainView = UiUtilities.getInflater(requireContext(), nightMode).inflate(R.layout.edit_arrangement_list_fragment, container, false);
 		createToolbar(mainView, nightMode);
 
 		RecyclerView recyclerView = mainView.findViewById(R.id.profiles_list);
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectMultipleProfilesBottomSheet.java b/OsmAnd/src/net/osmand/plus/profiles/SelectMultipleProfilesBottomSheet.java
index 22a276f0f61..b8e28344a0b 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectMultipleProfilesBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectMultipleProfilesBottomSheet.java
@@ -1,5 +1,6 @@
 package net.osmand.plus.profiles;
 
+import android.content.Context;
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
 import android.view.View;
@@ -13,10 +14,8 @@
 import androidx.fragment.app.Fragment;
 
 import net.osmand.CallbackWithObject;
-import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
@@ -24,6 +23,8 @@
 import net.osmand.plus.profiles.data.ProfileDataUtils;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.bottomsheets.BasePreferenceBottomSheet;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -76,14 +77,15 @@ public void createMenuItems(Bundle savedInstanceState) {
 	}
 
 	private void addProfileItem(ProfileDataObject profile) {
+		Context context = requireContext();
 		OsmandApplication app = requiredMyApplication();
-		View itemView = UiUtilities.getInflater(app, nightMode)
+		View itemView = UiUtilities.getInflater(requireContext(), nightMode)
 				.inflate(R.layout.bottom_sheet_item_with_descr_and_checkbox_56dp, null);
 
 		int profileColor = profile.getIconColor(nightMode);
 		int activeColorId = ColorUtilities.getActiveColorId(nightMode);
 		int disableColorId = ColorUtilities.getDefaultIconColorId(nightMode);
-		int disableColor = ContextCompat.getColor(app, disableColorId);
+		int disableColor = ContextCompat.getColor(context, disableColorId);
 		boolean enable = profile.isEnabled();
 
 		TextView tvTitle = itemView.findViewById(R.id.title);
@@ -95,14 +97,14 @@ private void addProfileItem(ProfileDataObject profile) {
 		tvDescription.setText(profile.getDescription());
 
 		if (!enable) {
-			tvTitle.setTextColor(ContextCompat.getColor(app, disableColorId));
-			tvDescription.setTextColor(ContextCompat.getColor(app, disableColorId));
+			tvTitle.setTextColor(ContextCompat.getColor(context, disableColorId));
+			tvDescription.setTextColor(ContextCompat.getColor(context, disableColorId));
 		}
 
 		Drawable drawableIcon = app.getUIUtilities().getPaintedIcon(
 				profile.getIconRes(), enable ? profileColor : disableColor);
 		ivIcon.setImageDrawable(drawableIcon);
-		UiUtilities.setupCompoundButton(nightMode, ContextCompat.getColor(app,
+		UiUtilities.setupCompoundButton(nightMode, ContextCompat.getColor(context,
 				enable ? activeColorId : disableColorId), compoundButton);
 		compoundButton.setSaveEnabled(false);
 		compoundButton.setChecked(profile.isSelected());
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java b/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java
index 82e560ade2b..8c6dc1f541e 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java
@@ -254,7 +254,7 @@ private void createOnlineFooter() {
 	private void addGroupHeader(ProfilesGroup group) {
 		CharSequence title = group.getTitle();
 		CharSequence description = group.getDescription(app, nightMode);
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		LayoutInflater inflater = UiUtilities.getInflater(themedCtx, nightMode);
 		View view = inflater.inflate(R.layout.group_title_with_desription_and_option, null);
 		View container = view.findViewById(R.id.container);
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java b/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java
index 99638aedbce..6ce109cf3d3 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java
@@ -106,7 +106,7 @@ protected void addProfileItem(ProfileDataObject profile) {
 
 	protected void addToggleButton(TextRadioItem selectedItem, TextRadioItem... radioItems) {
 		int padding = getDimen(R.dimen.content_padding_small);
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		LayoutInflater inflater = UiUtilities.getInflater(themedCtx, nightMode);
 		LinearLayout container = (LinearLayout) inflater.inflate(R.layout.custom_radio_buttons, null);
 		LinearLayout.MarginLayoutParams params = new LinearLayout.MarginLayoutParams(
@@ -149,7 +149,7 @@ protected void addCheckableItem(int titleId,
 	}
 
 	protected void addButtonItem(int titleId, int iconId, OnClickListener listener) {
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		View buttonView = View.inflate(themedCtx, R.layout.bottom_sheet_item_preference_btn, null);
 		TextView tvTitle = buttonView.findViewById(R.id.title);
 		tvTitle.setText(getString(titleId));
@@ -184,7 +184,7 @@ protected void addGroupHeader(CharSequence title) {
 	}
 
 	protected void addGroupHeader(CharSequence title, CharSequence description) {
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		LayoutInflater inflater = UiUtilities.getInflater(themedCtx, nightMode);
 		View view = inflater.inflate(R.layout.bottom_sheet_item_title_with_description_large, null);
 
@@ -205,7 +205,7 @@ protected void addGroupHeader(CharSequence title, CharSequence description) {
 	}
 
 	protected void addMessageWithRoundedBackground(String message, int marginTop, int marginBottom) {
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		LayoutInflater inflater = UiUtilities.getInflater(themedCtx, nightMode);
 		View view = inflater.inflate(R.layout.bottom_sheet_item_description_on_rounded_bg, null);
 
diff --git a/OsmAnd/src/net/osmand/plus/routepreparationmenu/RouteOptionsBottomSheet.java b/OsmAnd/src/net/osmand/plus/routepreparationmenu/RouteOptionsBottomSheet.java
index e6a2b49a1b3..006c7aaf193 100644
--- a/OsmAnd/src/net/osmand/plus/routepreparationmenu/RouteOptionsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/routepreparationmenu/RouteOptionsBottomSheet.java
@@ -293,7 +293,7 @@ public void updateWhenUseHeightChanged() {
 
 	private BaseBottomSheetItem createMuteSoundItem(LocalRoutingParameter optionsItem) {
 		boolean active = !routingHelper.getVoiceRouter().isMuteForMode(applicationMode);
-		View itemView = UiUtilities.getInflater(app, nightMode).inflate(
+		View itemView = UiUtilities.getInflater(requireContext(), nightMode).inflate(
 				R.layout.bottom_sheet_item_with_descr_switch_and_additional_button_56dp, null, false);
 		ImageView icon = itemView.findViewById(R.id.icon);
 		TextView tvTitle = itemView.findViewById(R.id.title);
@@ -353,7 +353,7 @@ public void onClick(View v) {
 	private BaseBottomSheetItem inflateElevationParameter(LocalRoutingParameter parameter) {
 		BottomSheetItemWithCompoundButton[] item = new BottomSheetItemWithCompoundButton[1];
 		boolean active = !useHeightPref.getModeValue(applicationMode);
-		View itemView = UiUtilities.getInflater(app, nightMode).inflate(
+		View itemView = UiUtilities.getInflater(requireContext(), nightMode).inflate(
 				R.layout.bottom_sheet_item_with_switch_and_dialog, null, false);
 		SwitchCompat switchButton = itemView.findViewById(R.id.compound_button);
 		View itemsContainer = itemView.findViewById(R.id.selectable_list_item);
diff --git a/OsmAnd/src/net/osmand/plus/search/dialogs/QuickSearchCustomPoiFragment.java b/OsmAnd/src/net/osmand/plus/search/dialogs/QuickSearchCustomPoiFragment.java
index e6fab6a38c8..e9f057f78d8 100644
--- a/OsmAnd/src/net/osmand/plus/search/dialogs/QuickSearchCustomPoiFragment.java
+++ b/OsmAnd/src/net/osmand/plus/search/dialogs/QuickSearchCustomPoiFragment.java
@@ -113,7 +113,7 @@ public void onCreate(Bundle savedInstanceState) {
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,
 	                         @Nullable Bundle savedInstanceState) {
-		LayoutInflater layoutInflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater layoutInflater = UiUtilities.getInflater(requireContext(), nightMode);
 		helper = app.getPoiFilters();
 		boolean nightMode = !app.getSettings().isLightContent();
 		if (getArguments() != null) {
@@ -449,7 +449,7 @@ private class CategoryListAdapter extends ArrayAdapter<PoiCategory> {
 		@NonNull
 		@Override
 		public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {
-			LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+			LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 			View row = convertView;
 			if (row == null) {
 				row = inflater.inflate(R.layout.list_item_icon24_and_menu, parent, false);
diff --git a/OsmAnd/src/net/osmand/plus/search/dialogs/SubCategoriesAdapter.java b/OsmAnd/src/net/osmand/plus/search/dialogs/SubCategoriesAdapter.java
index 0f2998aef06..20641f3fbd6 100644
--- a/OsmAnd/src/net/osmand/plus/search/dialogs/SubCategoriesAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/search/dialogs/SubCategoriesAdapter.java
@@ -63,7 +63,7 @@ public SubCategoriesAdapter(@NonNull OsmandApplication app,
 	@Override
 	public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {
 		if (convertView == null) {
-			convertView = UiUtilities.getInflater(app, nightMode)
+			convertView = UiUtilities.getInflater(parent.getContext(), nightMode)
 					.inflate(R.layout.profile_data_list_item_child, parent, false);
 		}
 		PoiType poiType = getItem(position);
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanPreferenceBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanPreferenceBottomSheet.java
index 296030764bd..bb8a97fc05a 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanPreferenceBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanPreferenceBottomSheet.java
@@ -56,7 +56,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 		if (!(preference instanceof BooleanPreference)) {
 			return;
 		}
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 
 		String title = switchPreference.getTitle().toString();
 		items.add(new TitleItem(title));
@@ -67,12 +67,13 @@ public void createMenuItems(Bundle savedInstanceState) {
 		int disabledColor = AndroidUtils.resolveAttribute(themedCtx, android.R.attr.textColorSecondary);
 		boolean checked = switchPreference.isChecked();
 
+		Context context = requireContext();
 		BottomSheetItemWithCompoundButton[] preferenceBtn = new BottomSheetItemWithCompoundButton[1];
 		preferenceBtn[0] = (BottomSheetItemWithCompoundButton) new BottomSheetItemWithCompoundButton.Builder()
 				.setChecked(checked)
 				.setTitle(checked ? on : off)
 				.setTitleColorId(checked ? activeColor : disabledColor)
-				.setCustomView(getCustomButtonView(app, getAppMode(), checked, nightMode))
+				.setCustomView(getCustomButtonView(context, getAppMode(), checked, nightMode))
 				.setOnClickListener(v -> {
 					boolean newValue = !switchPreference.isChecked();
 					Fragment targetFragment = getTargetFragment();
@@ -89,7 +90,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 							preferenceBtn[0].setTitle(newValue ? on : off);
 							preferenceBtn[0].setChecked(newValue);
 							preferenceBtn[0].setTitleColorId(newValue ? activeColor : disabledColor);
-							updateCustomButtonView(app, getAppMode(), v, newValue, nightMode);
+							updateCustomButtonView(context, getAppMode(), v, newValue, nightMode);
 
 							if (targetFragment instanceof OnPreferenceChanged) {
 								((OnPreferenceChanged) targetFragment).onPreferenceChanged(switchPreference.getKey());
@@ -129,14 +130,15 @@ protected int getDismissButtonTextId() {
 		return R.string.shared_string_close;
 	}
 
-	public static View getCustomButtonView(OsmandApplication app, ApplicationMode mode, boolean checked, boolean nightMode) {
-		View customView = UiUtilities.getInflater(app, nightMode).inflate(R.layout.bottom_sheet_item_preference_switch, null);
-		updateCustomButtonView(app, mode, customView, checked, nightMode);
+	public static View getCustomButtonView(@NonNull Context context, ApplicationMode mode, boolean checked, boolean nightMode) {
+		View customView = UiUtilities.getInflater(context, nightMode).inflate(R.layout.bottom_sheet_item_preference_switch, null);
+		updateCustomButtonView(context, mode, customView, checked, nightMode);
 		return customView;
 	}
 
-	public static void updateCustomButtonView(OsmandApplication app, ApplicationMode mode, View customView, boolean checked, boolean nightMode) {
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+	public static void updateCustomButtonView(@NonNull Context context, ApplicationMode mode, View customView, boolean checked, boolean nightMode) {
+		OsmandApplication app = (OsmandApplication) context.getApplicationContext();
+		Context themedCtx = UiUtilities.getThemedContext(context, nightMode);
 		boolean isLayoutRtl = AndroidUtils.isLayoutRtl(themedCtx);
 		LinearLayout buttonView = customView.findViewById(R.id.button_container);
 
@@ -147,16 +149,17 @@ public static void updateCustomButtonView(OsmandApplication app, ApplicationMode
 			bgColor = ColorUtilities.getColorWithAlpha(color, checked ? 0.1f : 0.5f);
 			selectedColor = ColorUtilities.getColorWithAlpha(color, checked ? 0.3f : 0.5f);
 		} else {
-			bgColor = ContextCompat.getColor(app, checked
+			bgColor = ContextCompat.getColor(context, checked
 					? getActiveColorId(nightMode) : getSecondaryIconColorId(nightMode));
 			selectedColor = ColorUtilities.getColorWithAlpha(
-					ContextCompat.getColor(app, getActiveColorId(nightMode)), checked ? 0.3f : 0.5f);
+					ContextCompat.getColor(context, getActiveColorId(nightMode)), checked ? 0.3f : 0.5f);
 		}
 
 		int bgResId = isLayoutRtl ? R.drawable.rectangle_rounded_left : R.drawable.rectangle_rounded_right;
 		int selectableResId = isLayoutRtl ? R.drawable.ripple_rectangle_rounded_left : R.drawable.ripple_rectangle_rounded_right;
-		Drawable bgDrawable = app.getUIUtilities().getPaintedIcon(bgResId, bgColor);
-		Drawable selectable = app.getUIUtilities().getPaintedIcon(selectableResId, selectedColor);
+		UiUtilities utilities = app.getUIUtilities();
+		Drawable bgDrawable = utilities.getPaintedIcon(bgResId, bgColor);
+		Drawable selectable = utilities.getPaintedIcon(selectableResId, selectedColor);
 		Drawable[] layers = {bgDrawable, selectable};
 		AndroidUtils.setBackground(buttonView, new LayerDrawable(layers));
 	}
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanRadioButtonsBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanRadioButtonsBottomSheet.java
index d586a08f1c0..c9d63849d2a 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanRadioButtonsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BooleanRadioButtonsBottomSheet.java
@@ -78,7 +78,7 @@ private BaseBottomSheetItem getRadioButtonItem(@NonNull SwitchPreferenceEx prefe
 
 	@NonNull
 	public View getCustomRadioButtonView(@NonNull SwitchPreferenceEx preference, boolean enabled) {
-		View view = UiUtilities.getInflater(app, nightMode).inflate(R.layout.dialog_list_item_with_compound_button, null);
+		View view = UiUtilities.getInflater(requireContext(), nightMode).inflate(R.layout.dialog_list_item_with_compound_button, null);
 		view.setTag(enabled);
 
 		TextView textView = view.findViewById(R.id.text);
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ElevationDateBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ElevationDateBottomSheet.java
index 3a3fa850a44..761cf4c02f6 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ElevationDateBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ElevationDateBottomSheet.java
@@ -1,5 +1,15 @@
 package net.osmand.plus.settings.bottomsheets;
 
+import static net.osmand.plus.settings.bottomsheets.BooleanPreferenceBottomSheet.getCustomButtonView;
+import static net.osmand.plus.settings.bottomsheets.BooleanPreferenceBottomSheet.updateCustomButtonView;
+import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
+import static net.osmand.plus.settings.fragments.RouteParametersFragment.RELIEF_SMOOTHNESS_FACTOR;
+import static net.osmand.plus.settings.fragments.RouteParametersFragment.getRoutingParameterTitle;
+import static net.osmand.plus.settings.fragments.RouteParametersFragment.isRoutingParameterSelected;
+import static net.osmand.plus.settings.fragments.RouteParametersFragment.updateSelectedParameters;
+import static net.osmand.plus.utils.AndroidUtils.createColorStateList;
+import static net.osmand.router.GeneralRouter.USE_HEIGHT_OBSTACLES;
+
 import android.content.Context;
 import android.os.Bundle;
 import android.view.View;
@@ -10,15 +20,9 @@
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.plus.routepreparationmenu.RoutingOptionsHelper;
-import net.osmand.plus.routepreparationmenu.data.parameters.LocalRoutingParameter;
-import net.osmand.plus.routing.RoutingHelperUtils;
-import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.PlatformUtil;
-import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithCompoundButton;
@@ -26,11 +30,17 @@
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.ShortDescriptionItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
 import net.osmand.plus.routepreparationmenu.RouteOptionsBottomSheet;
+import net.osmand.plus.routepreparationmenu.RoutingOptionsHelper;
+import net.osmand.plus.routepreparationmenu.data.parameters.LocalRoutingParameter;
+import net.osmand.plus.routing.RoutingHelperUtils;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.preferences.CommonPreference;
 import net.osmand.plus.settings.fragments.ApplyQueryType;
 import net.osmand.plus.settings.fragments.BaseSettingsFragment;
 import net.osmand.plus.settings.fragments.OnConfirmPreferenceChange;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
 import net.osmand.router.GeneralRouter;
 import net.osmand.router.GeneralRouter.RoutingParameter;
 
@@ -40,16 +50,6 @@
 import java.util.List;
 import java.util.Map;
 
-import static net.osmand.plus.utils.AndroidUtils.createColorStateList;
-import static net.osmand.plus.settings.bottomsheets.BooleanPreferenceBottomSheet.getCustomButtonView;
-import static net.osmand.plus.settings.bottomsheets.BooleanPreferenceBottomSheet.updateCustomButtonView;
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
-import static net.osmand.plus.settings.fragments.RouteParametersFragment.RELIEF_SMOOTHNESS_FACTOR;
-import static net.osmand.plus.settings.fragments.RouteParametersFragment.getRoutingParameterTitle;
-import static net.osmand.plus.settings.fragments.RouteParametersFragment.isRoutingParameterSelected;
-import static net.osmand.plus.settings.fragments.RouteParametersFragment.updateSelectedParameters;
-import static net.osmand.router.GeneralRouter.USE_HEIGHT_OBSTACLES;
-
 public class ElevationDateBottomSheet extends MenuBottomSheetDialogFragment {
 
 	public static final String TAG = ElevationDateBottomSheet.class.getSimpleName();
@@ -142,14 +142,14 @@ private LocalRoutingParameter getHeightObstacleParameter(){
 		return null;
 	}
 
-	private void createUseHeightButton(Context context) {
+	private void createUseHeightButton(@NonNull Context context) {
 		boolean checked = useHeightPref.getModeValue(appMode);
 		useHeightButton = (BottomSheetItemWithCompoundButton) new BottomSheetItemWithCompoundButton.Builder()
 				.setCompoundButtonColor(appModeColor)
 				.setChecked(checked)
 				.setTitle(checked ? on : off)
 				.setTitleColorId(checked ? activeColor : disabledColor)
-				.setCustomView(getCustomButtonView(app, appMode, checked, nightMode))
+				.setCustomView(getCustomButtonView(context, appMode, checked, nightMode))
 				.setOnClickListener(v -> {
 					boolean newValue = !useHeightPref.getModeValue(appMode);
 					Fragment target = getTargetFragment();
@@ -186,7 +186,7 @@ private void updateUseHeightButton(BottomSheetItemWithCompoundButton button, boo
 		button.setTitle(newValue ? on : off);
 		button.setChecked(newValue);
 		button.setTitleColorId(newValue ? activeColor : disabledColor);
-		updateCustomButtonView(app, appMode, button.getView(), newValue, nightMode);
+		updateCustomButtonView(requireContext(), appMode, button.getView(), newValue, nightMode);
 	}
 
 	private void createReliefFactorButtons(Context context) {
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/RecalculateRouteInDeviationBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/RecalculateRouteInDeviationBottomSheet.java
index 7c4ba47c4e9..e3555a52412 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/RecalculateRouteInDeviationBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/RecalculateRouteInDeviationBottomSheet.java
@@ -1,5 +1,8 @@
 package net.osmand.plus.settings.bottomsheets;
 
+import static net.osmand.plus.settings.fragments.RouteParametersFragment.DEFAULT_MODE;
+import static net.osmand.plus.settings.fragments.RouteParametersFragment.DISABLE_MODE;
+
 import android.content.Context;
 import android.os.Bundle;
 import android.view.View;
@@ -13,28 +16,25 @@
 
 import com.google.android.material.slider.Slider;
 
-import net.osmand.plus.utils.AndroidUtils;
-import net.osmand.shared.settings.enums.MetricsConstants;
-import net.osmand.plus.routing.RoutingHelper;
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.utils.OsmAndFormatter;
 import net.osmand.plus.OsmandApplication;
-import net.osmand.plus.settings.backend.preferences.CommonPreference;
-import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithCompoundButton;
-import net.osmand.plus.base.bottomsheetmenu.simpleitems.LongDescriptionItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerSpaceItem;
+import net.osmand.plus.base.bottomsheetmenu.simpleitems.LongDescriptionItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.SubtitmeListDividerItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
+import net.osmand.plus.routing.RoutingHelper;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.backend.preferences.CommonPreference;
 import net.osmand.plus.settings.fragments.ApplyQueryType;
 import net.osmand.plus.settings.fragments.OnConfirmPreferenceChange;
 import net.osmand.plus.settings.preferences.SwitchPreferenceEx;
-
-import static net.osmand.plus.settings.fragments.RouteParametersFragment.DEFAULT_MODE;
-import static net.osmand.plus.settings.fragments.RouteParametersFragment.DISABLE_MODE;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.OsmAndFormatter;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.shared.settings.enums.MetricsConstants;
 
 public class RecalculateRouteInDeviationBottomSheet extends BooleanPreferenceBottomSheet {
 
@@ -62,7 +62,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 		settings = app.getSettings();
 		appMode = getAppMode();
 		preference = settings.ROUTE_RECALCULATION_DISTANCE;
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		getPreferenceStateAndValue();
 
 		SwitchPreferenceEx switchPref = (SwitchPreferenceEx) getPreference();
@@ -104,13 +104,14 @@ public void createMenuItems(Bundle savedInstanceState) {
 
 		String on = getString(R.string.shared_string_enabled);
 		String off = getString(R.string.shared_string_disabled);
+		Context context = requireContext();
 		BottomSheetItemWithCompoundButton[] preferenceBtn = new BottomSheetItemWithCompoundButton[1];
 		preferenceBtn[0] = (BottomSheetItemWithCompoundButton) new BottomSheetItemWithCompoundButton.Builder()
 				.setChecked(enabled)
 				.setCompoundButtonColor(appModeColor)
 				.setTitle(enabled ? on : off)
 				.setTitleColorId(enabled ? activeColor : disabledColor)
-				.setCustomView(getCustomButtonView(app, getAppMode(), enabled, nightMode))
+				.setCustomView(getCustomButtonView(context, getAppMode(), enabled, nightMode))
 				.setOnClickListener(new View.OnClickListener() {
 					@Override
 					public void onClick(View v) {
@@ -122,7 +123,7 @@ public void onClick(View v) {
 						preferenceBtn[0].setChecked(enabled);
 						getDefaultValue();
 						updateSliderView();
-						updateCustomButtonView(app, getAppMode(), v, enabled, nightMode);
+						updateCustomButtonView(context, getAppMode(), v, enabled, nightMode);
 						Fragment target = getTargetFragment();
 						float newValue = enabled ? DEFAULT_MODE : DISABLE_MODE;
 						if (target instanceof OnConfirmPreferenceChange) {
@@ -179,7 +180,7 @@ public void onSaveInstanceState(@NonNull Bundle outState) {
 	}
 
 	private void updateSliderView() {
-		Context themedCtx = UiUtilities.getThemedContext(app, nightMode);
+		Context themedCtx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		int activeColor = AndroidUtils.resolveAttribute(themedCtx, R.attr.active_color_basic);
 		int disabledColor = AndroidUtils.resolveAttribute(themedCtx, android.R.attr.textColorSecondary);
 		int textColorPrimary = AndroidUtils.resolveAttribute(themedCtx, android.R.attr.textColorPrimary);
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsListFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsListFragment.java
index 3dc7c201d70..2e451e01429 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsListFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsListFragment.java
@@ -117,7 +117,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c
 			}
 		});
 
-		adapter = new ExportSettingsAdapter(app, exportMode, this, nightMode);
+		adapter = new ExportSettingsAdapter(requireContext(), exportMode, this, nightMode);
 		adapter.updateSettingsItems(dataList, selectedItemsMap);
 		expandableList.setAdapter(adapter);
 		setupListView(expandableList);
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java b/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java
index 018803ee0da..0dc3a083697 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java
@@ -71,7 +71,7 @@ public class DuplicatesSettingsAdapter extends RecyclerView.Adapter<RecyclerView
 	@NonNull
 	@Override
 	public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(parent.getContext(), nightMode);
 		if (viewType == HEADER_TYPE) {
 			View view = inflater.inflate(R.layout.list_item_header_import, parent, false);
 			return new HeaderViewHolder(view);
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsAdapter.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsAdapter.java
index 5942de5b7c4..eb323d4c773 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsAdapter.java
@@ -4,6 +4,7 @@
 import static net.osmand.view.ThreeStateCheckbox.State.MISC;
 import static net.osmand.view.ThreeStateCheckbox.State.UNCHECKED;
 
+import android.content.Context;
 import android.content.res.ColorStateList;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -61,13 +62,13 @@ public class ExportSettingsAdapter extends OsmandBaseExpandableListAdapter {
 	private final int groupViewHeight;
 	private final int childViewHeight;
 
-	ExportSettingsAdapter(OsmandApplication app, boolean exportMode, OnItemSelectedListener listener, boolean nightMode) {
-		this.app = app;
+	ExportSettingsAdapter(@NonNull Context context, boolean exportMode, OnItemSelectedListener listener, boolean nightMode) {
+		this.app = (OsmandApplication) context.getApplicationContext();
 		this.exportMode = exportMode;
 		this.listener = listener;
 		this.nightMode = nightMode;
 		uiUtilities = app.getUIUtilities();
-		themedInflater = UiUtilities.getInflater(app, nightMode);
+		themedInflater = UiUtilities.getInflater(context, nightMode);
 		activeColorRes = nightMode ? R.color.icon_color_active_dark : R.color.icon_color_active_light;
 		secondaryColorRes = nightMode ? R.color.icon_color_secondary_dark : R.color.icon_color_secondary_light;
 		groupViewHeight = app.getResources().getDimensionPixelSize(R.dimen.setting_list_item_group_height);
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/HistoryAdapter.java b/OsmAnd/src/net/osmand/plus/settings/fragments/HistoryAdapter.java
index deb61d7cf91..a0c7bc94067 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/HistoryAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/HistoryAdapter.java
@@ -77,7 +77,7 @@ public HistoryAdapter(@NonNull MapActivity activity, @Nullable OnItemSelectedLis
 		activeColorId = ColorUtilities.getActiveColorId(nightMode);
 		defaultColorId = ColorUtilities.getDefaultIconColorId(nightMode);
 		uiUtilities = app.getUIUtilities();
-		themedInflater = UiUtilities.getInflater(app, nightMode);
+		themedInflater = UiUtilities.getInflater(activity, nightMode);
 		locationViewCache = UpdateLocationUtils.getUpdateLocationViewCache(activity);
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ImportedSettingsItemsAdapter.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ImportedSettingsItemsAdapter.java
index d6dc56ae3d2..c78b8e87f4b 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ImportedSettingsItemsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ImportedSettingsItemsAdapter.java
@@ -46,7 +46,7 @@ public class ImportedSettingsItemsAdapter extends
 	@NonNull
 	@Override
 	public ItemViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(parent.getContext(), nightMode);
 		View view = inflater.inflate(R.layout.list_item_import, parent, false);
 		return new ItemViewHolder(view);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/EditTrackGroupDialogFragment.java b/OsmAnd/src/net/osmand/plus/track/fragments/EditTrackGroupDialogFragment.java
index 64473466c44..aada54c3fb0 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/EditTrackGroupDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/EditTrackGroupDialogFragment.java
@@ -115,6 +115,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 
 	@NonNull
 	private BaseBottomSheetItem createShowOnMapItem(@NonNull SelectedGpxFile selectedGpxFile) {
+		Context context = requireContext();
 		boolean checked = !selectedGpxFile.isGroupHidden(displayGroup.getName());
 		ApplicationMode mode = app.getSettings().getApplicationMode();
 		BottomSheetItemWithCompoundButton[] showOnMapItem = new BottomSheetItemWithCompoundButton[1];
@@ -122,14 +123,14 @@ private BaseBottomSheetItem createShowOnMapItem(@NonNull SelectedGpxFile selecte
 				.setCompoundButtonColor(mode.getProfileColor(nightMode))
 				.setChecked(checked)
 				.setTitle(getString(R.string.shared_string_show_on_map))
-				.setCustomView(getCustomButtonView(app, mode, checked, nightMode))
+				.setCustomView(getCustomButtonView(context, mode, checked, nightMode))
 				.setOnClickListener(v -> {
 					boolean visible = !showOnMapItem[0].isChecked();
 					if (pointsGroup != null) {
 						pointsGroup.setHidden(!visible);
 					}
 					showOnMapItem[0].setChecked(visible);
-					updateCustomButtonView(app, mode, v, visible, nightMode);
+					updateCustomButtonView(context, mode, v, visible, nightMode);
 
 					Fragment fragment = getTargetFragment();
 					if (fragment instanceof DisplayPointGroupsCallback) {
diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/TrackAltitudeBottomSheet.java b/OsmAnd/src/net/osmand/plus/track/fragments/TrackAltitudeBottomSheet.java
index 1317b097b0d..6d2a1bf719e 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/TrackAltitudeBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/TrackAltitudeBottomSheet.java
@@ -120,7 +120,7 @@ private void createOfflineItem() {
 	}
 
 	private void createOsmAndProItem() {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		View view = inflater.inflate(R.layout.online_srtm_promo_item, itemsContainer, false);
 
 		UiUtilities utilities = app.getUIUtilities();
diff --git a/OsmAnd/src/net/osmand/plus/utils/UiUtilities.java b/OsmAnd/src/net/osmand/plus/utils/UiUtilities.java
index 16f31f1f7a0..010d1be8b10 100644
--- a/OsmAnd/src/net/osmand/plus/utils/UiUtilities.java
+++ b/OsmAnd/src/net/osmand/plus/utils/UiUtilities.java
@@ -602,21 +602,21 @@ public static void setupDialogButton(boolean nightMode, View buttonView, DialogB
 	}
 
 	@NonNull
-	public static LayoutInflater getInflater(Context ctx, boolean nightMode) {
+	public static LayoutInflater getInflater(@NonNull Context ctx, boolean nightMode) {
 		return LayoutInflater.from(getThemedContext(ctx, nightMode));
 	}
 
 	@NonNull
-	public static Context getThemedContext(Context context, boolean nightMode) {
+	public static Context getThemedContext(@NonNull Context context, boolean nightMode) {
 		return getThemedContext(context, nightMode, R.style.OsmandLightTheme, R.style.OsmandDarkTheme);
 	}
 
 	@NonNull
-	public static Context getThemedContext(Context context, boolean nightMode, int lightStyle, int darkStyle) {
+	public static Context getThemedContext(@NonNull Context context, boolean nightMode, int lightStyle, int darkStyle) {
 		return new ContextThemeWrapper(context, nightMode ? darkStyle : lightStyle);
 	}
 
-	public static void setMargins(View v, int s, int t, int e, int b) {
+	public static void setMargins(@NonNull View v, int s, int t, int e, int b) {
 		if (v.getLayoutParams() instanceof ViewGroup.MarginLayoutParams) {
 			ViewGroup.MarginLayoutParams p = (ViewGroup.MarginLayoutParams) v.getLayoutParams();
 			AndroidUtils.setMargins(p, s, t, e, b);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java
index 6c641c15d19..fa26695ec8f 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java
@@ -66,7 +66,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 
 	@NonNull
 	private View createView() {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		View view = inflater.inflate(R.layout.fragment_compass_visibility_bottom_sheet_dialog, null);
 
 		setupVisibilityItem(CompassVisibility.ALWAYS_VISIBLE, view);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
index 86df8305316..b373432d0e6 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
@@ -65,7 +65,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 
 	@NonNull
 	private View createView() {
-		LayoutInflater inflater = UiUtilities.getInflater(app, nightMode);
+		LayoutInflater inflater = UiUtilities.getInflater(requireContext(), nightMode);
 		View view = inflater.inflate(R.layout.fragment_map_3d_mode_bottom_sheet, null);
 		LinearLayout itemsContainer = view.findViewById(R.id.items_container);
 
