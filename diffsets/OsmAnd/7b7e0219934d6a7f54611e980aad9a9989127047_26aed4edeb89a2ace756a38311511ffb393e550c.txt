diff --git a/OsmAnd/src/net/osmand/plus/plugins/accessibility/AccessibilitySettingsFragment.java b/OsmAnd/src/net/osmand/plus/plugins/accessibility/AccessibilitySettingsFragment.java
index 877eabd5a16..2f599ada698 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/accessibility/AccessibilitySettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/accessibility/AccessibilitySettingsFragment.java
@@ -259,7 +259,7 @@ public boolean onPreferenceClick(Preference preference) {
 		} else if (RESET_TO_DEFAULT.equals(prefId)) {
 			FragmentManager fragmentManager = getFragmentManager();
 			if (fragmentManager != null) {
-				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, prefId, this, false, getSelectedAppMode());
+				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, getSelectedAppMode(), this, false);
 			}
 		}
 		return super.onPreferenceClick(preference);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/audionotes/MultimediaNotesFragment.java b/OsmAnd/src/net/osmand/plus/plugins/audionotes/MultimediaNotesFragment.java
index 1b7061f1266..7df69689320 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/audionotes/MultimediaNotesFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/audionotes/MultimediaNotesFragment.java
@@ -1,5 +1,17 @@
 package net.osmand.plus.plugins.audionotes;
 
+import static net.osmand.plus.myplaces.ui.FavoritesActivity.TAB_ID;
+import static net.osmand.plus.plugins.PluginInfoFragment.PLUGIN_INFO;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AUDIO_BITRATE_DEFAULT;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_AUTO;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_CONTINUOUS;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_EDOF;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_HIPERFOCAL;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_INFINITY;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_MACRO;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.NOTES_TAB;
+import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.cameraPictureSizeDefault;
+
 import android.Manifest;
 import android.content.Context;
 import android.content.Intent;
@@ -21,13 +33,12 @@
 import androidx.preference.Preference;
 import androidx.preference.PreferenceViewHolder;
 
-import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.PlatformUtil;
-import net.osmand.plus.plugins.OsmandPlugin;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.helpers.FontCache;
+import net.osmand.plus.plugins.OsmandPlugin;
 import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet;
 import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet.CopyAppModePrefsListener;
 import net.osmand.plus.settings.backend.ApplicationMode;
@@ -37,6 +48,7 @@
 import net.osmand.plus.settings.fragments.BaseSettingsFragment;
 import net.osmand.plus.settings.preferences.ListPreferenceEx;
 import net.osmand.plus.settings.preferences.SwitchPreferenceEx;
+import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.widgets.style.CustomTypefaceSpan;
 
 import org.apache.commons.logging.Log;
@@ -44,18 +56,6 @@
 import java.util.ArrayList;
 import java.util.List;
 
-import static net.osmand.plus.plugins.PluginInfoFragment.PLUGIN_INFO;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AUDIO_BITRATE_DEFAULT;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_AUTO;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_CONTINUOUS;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_EDOF;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_HIPERFOCAL;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_INFINITY;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.AV_CAMERA_FOCUS_MACRO;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.NOTES_TAB;
-import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.cameraPictureSizeDefault;
-import static net.osmand.plus.myplaces.ui.FavoritesActivity.TAB_ID;
-
 public class MultimediaNotesFragment extends BaseSettingsFragment implements CopyAppModePrefsListener, ResetAppModePrefsListener {
 
 	public static final int CAMERA_FOR_PHOTO_PARAMS_REQUEST_CODE = 104;
@@ -467,7 +467,7 @@ public boolean onPreferenceClick(Preference preference) {
 		} else if (RESET_TO_DEFAULT.equals(prefId)) {
 			FragmentManager fragmentManager = getFragmentManager();
 			if (fragmentManager != null) {
-				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, prefId, this, false, getSelectedAppMode());
+				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, getSelectedAppMode(), this, false);
 			}
 		} else if (CAMERA_PERMISSION.equals(prefId)) {
 			requestPermissions(new String[] {Manifest.permission.CAMERA}, CAMERA_FOR_PHOTO_PARAMS_REQUEST_CODE);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java
index 1e597e35b33..895ef58f37d 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java
@@ -330,7 +330,7 @@ public boolean onPreferenceClick(Preference preference) {
 		} else if (RESET_TO_DEFAULT.equals(prefId)) {
 			FragmentManager fragmentManager = getFragmentManager();
 			if (fragmentManager != null) {
-				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, prefId, this, false, getSelectedAppMode());
+				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, getSelectedAppMode(), this, false);
 			}
 		}
 		return super.onPreferenceClick(preference);
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ResetProfilePrefsBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ResetProfilePrefsBottomSheet.java
index 6919d5dc4a2..ec3732f7b31 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ResetProfilePrefsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ResetProfilePrefsBottomSheet.java
@@ -8,18 +8,20 @@
 import android.os.Bundle;
 
 import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.plus.utils.ColorUtilities;
-import net.osmand.plus.profiles.data.ProfileDataUtils;
-import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithCompoundButton;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithDescription;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
+import net.osmand.plus.profiles.data.ProfileDataUtils;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.utils.UiUtilities.DialogButtonType;
 
 public class ResetProfilePrefsBottomSheet extends BasePreferenceBottomSheet {
 
@@ -85,22 +87,20 @@ protected void onRightBottomButtonClick() {
 	}
 
 	@Override
-	protected UiUtilities.DialogButtonType getRightBottomButtonType() {
-		return UiUtilities.DialogButtonType.SECONDARY;
+	protected DialogButtonType getRightBottomButtonType() {
+		return DialogButtonType.SECONDARY;
 	}
 
-	public static boolean showInstance(@NonNull FragmentManager fragmentManager, String key, Fragment target,
-	                                   boolean usedOnMap, @NonNull ApplicationMode appMode) {
+	public static boolean showInstance(@NonNull FragmentManager manager,
+	                                   @NonNull ApplicationMode appMode,
+	                                   @Nullable Fragment target,
+	                                   boolean usedOnMap) {
 		try {
-			Bundle args = new Bundle();
-			args.putString(PREFERENCE_ID, key);
-
 			ResetProfilePrefsBottomSheet fragment = new ResetProfilePrefsBottomSheet();
-			fragment.setArguments(args);
 			fragment.setUsedOnMap(usedOnMap);
 			fragment.setAppMode(appMode);
 			fragment.setTargetFragment(target, 0);
-			fragment.show(fragmentManager, TAG);
+			fragment.show(manager, TAG);
 			return true;
 		} catch (RuntimeException e) {
 			return false;
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
index 88d277fc0a6..b72acb55594 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
@@ -448,7 +448,7 @@ public boolean onPreferenceClick(Preference preference) {
 			} else if (COPY_PROFILE_SETTINGS.equals(prefId)) {
 				SelectCopyAppModeBottomSheet.showInstance(fragmentManager, this, false, selectedMode);
 			} else if (RESET_TO_DEFAULT.equals(prefId)) {
-				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, prefId, this, false, selectedMode);
+				ResetProfilePrefsBottomSheet.showInstance(fragmentManager, getSelectedAppMode(), this, false);
 			} else if (EXPORT_PROFILE.equals(prefId)) {
 				ExportSettingsFragment.showInstance(fragmentManager, selectedMode, null, false);
 			} else if (DELETE_PROFILE.equals(prefId)) {
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
index d0dff335b8f..69fd44c334f 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
@@ -344,11 +344,11 @@ public MapWidgetInfo registerWidget(@NonNull String key, @NonNull MapWidget widg
 	}
 
 	public void registerWidget(@NonNull String key, @NonNull MapWidget widget,
-			                   @NonNull WidgetState widgetState, @NonNull WidgetsPanel widgetPanel) {
+	                           @NonNull WidgetState widgetState, @NonNull WidgetsPanel widgetPanel) {
 		if (mapInfoControls != null) {
 			int order = widgetPanel.getWidgetOrder(key, settings);
-			mapInfoControls.registerWidget(key, widget, widgetState,
-					MapWidgetInfo.INVALID_ID, MapWidgetInfo.INVALID_ID, null, order, widgetPanel);
+			mapInfoControls.registerWidget(key, widget, widgetState, MapWidgetInfo.INVALID_ID,
+					MapWidgetInfo.INVALID_ID, null, order, widgetPanel);
 			widget.updateColors(calculateTextState());
 		}
 	}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
index 7fb8a839a57..8b4445b81ec 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
@@ -1,5 +1,7 @@
 package net.osmand.plus.views.mapwidgets;
 
+import android.content.Context;
+
 import androidx.annotation.DrawableRes;
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
@@ -7,6 +9,7 @@
 
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
+import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
 import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
 
 public abstract class MapWidgetInfo implements Comparable<MapWidgetInfo> {
@@ -55,6 +58,20 @@ public int getSettingsIconId() {
 				: settingsIconId;
 	}
 
+	@DrawableRes
+	public int getMapIconId(boolean nightMode) {
+		if (widget instanceof TextInfoWidget) {
+			TextInfoWidget textInfoWidget = (TextInfoWidget) widget;
+			return textInfoWidget.getIconId(nightMode);
+		}
+		return 0;
+	}
+
+	@NonNull
+	public String getTitle(@NonNull Context ctx) {
+		return message != null ? message : ctx.getString(getMessageId());
+	}
+
 	@Nullable
 	public String getMessage() {
 		return message;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
index 334ec1b638f..02691288ddc 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
@@ -16,25 +16,20 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
-import net.osmand.plus.inapp.InAppPurchaseHelper;
-import net.osmand.plus.mapmarkers.DirectionIndicationDialogFragment;
-import net.osmand.plus.quickaction.QuickActionListFragment;
 import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmAndAppCustomization;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.backend.preferences.OsmandPreference;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.layers.MapInfoLayer;
-import net.osmand.plus.views.layers.MapQuickActionLayer;
 import net.osmand.plus.views.layers.base.OsmandMapLayer.DrawSettings;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
 import net.osmand.plus.views.mapwidgets.widgetstates.ElevationProfileWidgetState;
 import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
 import net.osmand.plus.widgets.cmadapter.ContextMenuAdapter;
-import net.osmand.plus.widgets.cmadapter.callback.ItemClickListener;
 import net.osmand.plus.widgets.cmadapter.callback.OnRowItemClick;
-import net.osmand.plus.widgets.cmadapter.item.ContextMenuCategory;
 import net.osmand.plus.widgets.cmadapter.item.ContextMenuItem;
 import net.osmand.plus.widgets.popup.PopUpMenuHelper;
 import net.osmand.plus.widgets.popup.PopUpMenuHelper.PopUpMenuWidthType;
@@ -274,27 +269,14 @@ public boolean isVisible(String key) {
 		return elements != null && (elements.contains(key) || elements.contains(COLLAPSED_PREFIX + key));
 	}
 
-	private void setVisibility(ArrayAdapter<ContextMenuItem> adapter,
-	                           MapWidgetInfo r,
-	                           int position,
-	                           boolean visible,
-	                           boolean collapsed) {
-		setVisibility(r, visible, collapsed);
-		MapInfoLayer mil = app.getOsmandMap().getMapLayers().getMapInfoLayer();
-		if (mil != null) {
-			mil.recreateControls();
-		}
-
-		ContextMenuItem item = adapter.getItem(position);
-		item.setSelected(visible);
-		item.setColor(app, visible ? R.color.osmand_orange : ContextMenuItem.INVALID_ID);
-		item.setDescription(visible && collapsed ? getString(R.string.shared_string_collapse) : null);
-		adapter.notifyDataSetChanged();
-	}
-
 	public void setVisibility(@NonNull MapWidgetInfo widgetInfo, boolean visible, boolean collapsed) {
 		ApplicationMode mode = settings.APPLICATION_MODE.get();
 		setVisibility(mode, widgetInfo, visible, collapsed);
+
+		MapInfoLayer mapInfoLayer = app.getOsmandMap().getMapLayers().getMapInfoLayer();
+		if (mapInfoLayer != null) {
+			mapInfoLayer.recreateControls();
+		}
 	}
 
 	public void setVisibility(ApplicationMode mode, MapWidgetInfo m, boolean visible, boolean collapsed) {
@@ -414,21 +396,9 @@ public void updateMapMarkersMode(MapActivity mapActivity) {
 						&& settings.DISPLAYED_MARKERS_WIDGETS_COUNT.get() == 2, false);
 			}
 		}
-		MapInfoLayer mil = mapActivity.getMapLayers().getMapInfoLayer();
-		if (mil != null) {
-			mil.recreateControls();
-		}
 		mapActivity.refreshMap();
 	}
 
-	private void addControlId(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter cm,
-	                          @StringRes int stringId, @NonNull OsmandPreference<Boolean> pref) {
-		cm.addItem(new ContextMenuItem(null)
-				.setTitleId(stringId, mapActivity)
-				.setSelected(pref.get())
-				.setListener(new AppearanceItemClickListener(pref, mapActivity)));
-	}
-
 	@NonNull
 	public Set<MapWidgetInfo> getLeftWidgets() {
 		return getWidgetsForPanel(WidgetsPanel.LEFT);
@@ -448,6 +418,19 @@ public List<MapWidgetInfo> getAllWidgets() {
 		return widgets;
 	}
 
+	@NonNull
+	public Set<MapWidgetInfo> getAvailableWidgetsForPanel(@NonNull ApplicationMode appMode, @NonNull WidgetsPanel panel) {
+		Set<MapWidgetInfo> widgets = new TreeSet<>();
+		for (MapWidgetInfo widgetInfo : getWidgetsForPanel(panel)) {
+
+			OsmAndAppCustomization appCustomization = app.getAppCustomization();
+			if (!appCustomization.areWidgetsCustomized() || !appCustomization.isWidgetAvailable(widgetInfo.key, appMode)) {
+				widgets.add(widgetInfo);
+			}
+		}
+		return widgets;
+	}
+
 	@NonNull
 	public Set<MapWidgetInfo> getWidgetsForPanel(@NonNull WidgetsPanel panel) {
 		Set<MapWidgetInfo> widgets = allWidgets.get(panel);
@@ -458,128 +441,6 @@ public Set<MapWidgetInfo> getWidgetsForPanel(@NonNull WidgetsPanel panel) {
 		return widgets;
 	}
 
-	public void addControls(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter cm,
-	                        @NonNull ApplicationMode mode) {
-		addQuickActionControl(mapActivity, cm);
-		// Right panel
-		addHeader(mapActivity, cm, R.string.map_widget_right);
-		addControls(mapActivity, cm, getRightWidgets(), mode);
-		// Left panel
-		addHeader(mapActivity, cm, R.string.map_widget_left);
-		addControls(mapActivity, cm, getRightWidgets(), mode);
-		// Remaining items
-		addHeader(mapActivity, cm, R.string.map_widget_appearance_rem);
-		addControlsAppearance(mapActivity, cm, mode);
-	}
-
-	private void addHeader(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter cm, int titleId) {
-		cm.addItem(new ContextMenuCategory(null)
-				.setTitleId(titleId, mapActivity)
-				.setLayout(R.layout.list_group_title_with_switch));
-	}
-
-	private void addQuickActionControl(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter cm) {
-		cm.addItem(new ContextMenuCategory(null)
-				.setTitleId(R.string.map_widget_right, mapActivity)
-				.setLayout(R.layout.list_group_empty_title_with_switch));
-
-		boolean selected = app.getQuickActionRegistry().isQuickActionOn();
-		cm.addItem(new ContextMenuItem(null)
-				.setTitleId(R.string.configure_screen_quick_action, mapActivity)
-				.setIcon(R.drawable.ic_quick_action)
-				.setSelected(selected)
-				.setColor(app, selected ? R.color.osmand_orange : ContextMenuItem.INVALID_ID)
-				.setSecondaryIcon(R.drawable.ic_action_additional_option)
-				.setListener(new OnRowItemClick() {
-					@Override
-					public boolean onContextMenuClick(ArrayAdapter<ContextMenuItem> adapter, int itemId, int position, boolean isChecked, int[] viewCoordinates) {
-						setVisibility(adapter, position, isChecked);
-						return false;
-					}
-
-					@Override
-					public boolean onRowItemClick(ArrayAdapter<ContextMenuItem> adapter, View view, int itemId, int position) {
-						QuickActionListFragment.showInstance(mapActivity, true);
-						return true;
-					}
-
-					private void setVisibility(ArrayAdapter<ContextMenuItem> adapter,
-					                           int position,
-					                           boolean visible) {
-
-						app.getQuickActionRegistry().setQuickActionFabState(visible);
-
-						MapQuickActionLayer mil = mapActivity.getMapLayers().getMapQuickActionLayer();
-						if (mil != null) {
-							mil.refreshLayer();
-						}
-						ContextMenuItem item = adapter.getItem(position);
-						item.setSelected(visible);
-						item.setColor(app, visible ? R.color.osmand_orange : ContextMenuItem.INVALID_ID);
-						adapter.notifyDataSetChanged();
-
-					}
-				}));
-	}
-
-	private void addControls(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter contextMenuAdapter,
-	                         @NonNull Set<MapWidgetInfo> groupTitle, @NonNull ApplicationMode mode) {
-		for (final MapWidgetInfo r : groupTitle) {
-			if (!mode.isWidgetAvailable(r.key)) {
-				continue;
-			}
-			boolean selected = r.isVisibleCollapsed(mode) || r.isVisible(mode);
-			String desc = mapActivity.getString(R.string.shared_string_collapse);
-			ContextMenuItem item = new ContextMenuItem(null)
-					.setIcon(r.getSettingsIconId())
-					.setSelected(selected)
-					.setColor(app, selected ? R.color.osmand_orange : ContextMenuItem.INVALID_ID)
-					.setSecondaryIcon(r.widget != null ? R.drawable.ic_action_additional_option : ContextMenuItem.INVALID_ID)
-					.setDescription(r.isVisibleCollapsed(mode) ? desc : null)
-					.setListener(new OnRowItemClick() {
-						@Override
-						public boolean onRowItemClick(final ArrayAdapter<ContextMenuItem> adapter,
-						                              final View view,
-						                              final int itemId,
-						                              final int pos) {
-							if (r.widget == null) {
-								setVisibility(adapter, r, pos, !r.isVisible(mode), false);
-								return false;
-							}
-							boolean selected = r.isVisibleCollapsed(mode) || r.isVisible(mode);
-
-							WidgetState widgetState = r.getWidgetState();
-							CallbackWithObject<WidgetState> callback = getWidgetStateCallback(adapter, widgetState, r.getMessage(), pos);
-							showPopUpMenu(view, callback, widgetState, mode,
-									getPopupMenuItemListener(adapter, r, pos, true, false),
-									getPopupMenuItemListener(adapter, r, pos, false, false),
-									getPopupMenuItemListener(adapter, r, pos, true, true),
-									selected);
-
-							return false;
-						}
-
-						@Override
-						public boolean onContextMenuClick(ArrayAdapter<ContextMenuItem> a,
-						                                  int itemId, int pos, boolean isChecked, int[] viewCoordinates) {
-							setVisibility(a, r, pos, isChecked, false);
-							return false;
-						}
-
-					});
-			if (r.getMessage() != null) {
-				item.setTitle(r.getMessage());
-			} else {
-				item.setTitleId(r.getMessageId(), mapActivity);
-			}
-			contextMenuAdapter.addItem(item);
-		}
-	}
-
-	private OnClickListener getPopupMenuItemListener(ArrayAdapter<ContextMenuItem> adapter, MapWidgetInfo r, int pos, boolean visible, boolean collapsed) {
-		return v -> setVisibility(adapter, r, pos, visible, collapsed);
-	}
-
 	private CallbackWithObject<WidgetState> getWidgetStateCallback(ArrayAdapter<ContextMenuItem> adapter, WidgetState widgetState, String message, int pos) {
 		return result -> {
 			ContextMenuItem item = adapter.getItem(pos);
@@ -595,42 +456,6 @@ private CallbackWithObject<WidgetState> getWidgetStateCallback(ArrayAdapter<Cont
 		};
 	}
 
-	public void addControlsAppearance(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter cm, @NonNull ApplicationMode mode) {
-		if (mode != ApplicationMode.DEFAULT) {
-			addControlId(mapActivity, cm, R.string.map_widget_top_text, settings.SHOW_STREET_NAME);
-		}
-		cm.addItem(new ContextMenuItem(null).setTitleId(R.string.coordinates_widget, mapActivity)
-				.setIcon(R.drawable.ic_action_coordinates_widget)
-				.setSelected(settings.SHOW_COORDINATES_WIDGET.get())
-				.setListener(new AppearanceItemClickListener(settings.SHOW_COORDINATES_WIDGET, mapActivity))
-				.setLayout(R.layout.list_item_icon_and_switch));
-
-		cm.addItem(new ContextMenuItem(null).setTitleId(R.string.map_widget_distance_by_tap, mapActivity)
-				.setIcon(R.drawable.ic_action_ruler_line)
-				.setSelected(settings.SHOW_DISTANCE_RULER.get())
-				.setListener(new AppearanceItemClickListener(settings.SHOW_DISTANCE_RULER, mapActivity))
-				.setLayout(R.layout.list_item_icon_and_switch));
-
-		if (InAppPurchaseHelper.isOsmAndProAvailable(app)) {
-			addElevationProfileWidget(mapActivity, cm, mode);
-		}
-
-		cm.addItem(new ContextMenuItem(null).setTitleId(R.string.map_markers, mapActivity)
-				.setDescription(settings.MAP_MARKERS_MODE.get().toHumanString(mapActivity))
-				.setListener((adapter, itemId, position, isChecked, viewCoordinates) -> {
-					DirectionIndicationDialogFragment fragment = new DirectionIndicationDialogFragment();
-					fragment.setListener(showDirectionEnabled -> {
-						updateMapMarkersMode(mapActivity);
-						cm.getItem(position).setDescription(settings.MAP_MARKERS_MODE.get().toHumanString(mapActivity));
-						adapter.notifyDataSetChanged();
-					});
-					fragment.show(mapActivity.getSupportFragmentManager(), DirectionIndicationDialogFragment.TAG);
-					return false;
-				}).setLayout(R.layout.list_item_text_button));
-		addControlId(mapActivity, cm, R.string.map_widget_transparent, settings.TRANSPARENT_MAP_THEME);
-		addControlId(mapActivity, cm, R.string.show_lanes, settings.SHOW_LANES);
-	}
-
 	public void addElevationProfileWidget(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter cm,
 	                                      @NonNull ApplicationMode mode) {
 		final OsmandPreference<Boolean> pref = settings.SHOW_ELEVATION_PROFILE_WIDGET;
@@ -648,11 +473,12 @@ public boolean onRowItemClick(final ArrayAdapter<ContextMenuItem> adapter,
 					                              final int itemId,
 					                              final int pos) {
 						boolean selected = pref.get();
+						boolean nightMode = app.getDaynightHelper().isNightModeForMapControls();
 						CallbackWithObject<WidgetState> callback = getWidgetStateCallback(adapter, widgetState, null, pos);
 						showPopUpMenu(view, callback, widgetState, mode,
 								getElevationPopupMenuItemListener(mapActivity, adapter, pref, pos, true),
 								getElevationPopupMenuItemListener(mapActivity, adapter, pref, pos, false),
-								null, selected);
+								null, selected, nightMode);
 						return false;
 					}
 
@@ -684,8 +510,8 @@ public void showPopUpMenu(@NonNull View view,
 	                          @Nullable OnClickListener showBtnListener,
 	                          @Nullable OnClickListener hideBtnListener,
 	                          @Nullable OnClickListener collapseBtnListener,
-	                          boolean selected) {
-		final boolean nightMode = app.getDaynightHelper().isNightModeForMapControls();
+	                          boolean selected,
+	                          boolean nightMode) {
 		final int currentModeColor = mode.getProfileColor(nightMode);
 		View parentView = view.findViewById(R.id.text_wrapper);
 		List<PopUpMenuItem> items = new ArrayList<>();
@@ -761,22 +587,4 @@ private static void updateAppearancePref(@NonNull MapActivity mapActivity, @NonN
 		mapActivity.updateApplicationModeSettings();
 		a.notifyDataSetChanged();
 	}
-
-	static class AppearanceItemClickListener implements ItemClickListener {
-
-		private final MapActivity mapActivity;
-		private final OsmandPreference<Boolean> pref;
-
-		public AppearanceItemClickListener(OsmandPreference<Boolean> pref, MapActivity mapActivity) {
-			this.pref = pref;
-			this.mapActivity = mapActivity;
-		}
-
-		@Override
-		public boolean onContextMenuClick(ArrayAdapter<ContextMenuItem> a, int itemId, int pos,
-		                                  boolean isChecked, int[] viewCoordinates) {
-			updateAppearancePref(mapActivity, pref, a, !pref.get());
-			return false;
-		}
-	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
index 60b96a0d6e5..ef59966348e 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
@@ -28,9 +28,12 @@
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_STREET_NAME;
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_TIME;
 
+import android.text.TextUtils;
+
 import androidx.annotation.NonNull;
 
 import net.osmand.plus.R;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.backend.preferences.ListStringPreference;
 import net.osmand.util.Algorithms;
@@ -119,6 +122,10 @@ public List<String> getOriginalOrder() {
 	}
 
 	public int getWidgetOrder(@NonNull String widgetId, @NonNull OsmandSettings settings) {
+		return getWidgetOrder(settings.getApplicationMode(), widgetId, settings);
+	}
+
+	public int getWidgetOrder(@NonNull ApplicationMode appMode, @NonNull String widgetId, @NonNull OsmandSettings settings) {
 		ListStringPreference orderPreference;
 		if (this == LEFT) {
 			orderPreference = settings.LEFT_WIDGET_PANEL_ORDER;
@@ -129,7 +136,7 @@ public int getWidgetOrder(@NonNull String widgetId, @NonNull OsmandSettings sett
 		} else {
 			orderPreference = settings.BOTTOM_WIDGET_PANEL_ORDER;
 		}
-		List<String> orderIds = orderPreference.getStringsList();
+		List<String> orderIds = orderPreference.getStringsListForProfile(appMode);
 		if (Algorithms.isEmpty(orderIds)) {
 			return 0;
 		}
@@ -137,4 +144,19 @@ public int getWidgetOrder(@NonNull String widgetId, @NonNull OsmandSettings sett
 		int order = orderIds.indexOf(widgetId);
 		return order == -1 ? orderIds.size() + 1 : order;
 	}
+
+	public boolean setWidgetsOrder(@NonNull ApplicationMode appMode, @NonNull List<String> widgetIds, @NonNull OsmandSettings settings) {
+		ListStringPreference orderPreference;
+		if (this == LEFT) {
+			orderPreference = settings.LEFT_WIDGET_PANEL_ORDER;
+		} else if (this == RIGHT) {
+			orderPreference = settings.RIGHT_WIDGET_PANEL_ORDER;
+		} else if (this == TOP) {
+			orderPreference = settings.TOP_WIDGET_PANEL_ORDER;
+		} else {
+			orderPreference = settings.BOTTOM_WIDGET_PANEL_ORDER;
+		}
+		String widgetsOrder = TextUtils.join(",", widgetIds);
+		return orderPreference.setModeValue(appMode, widgetsOrder);
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
index 8b5c816885d..d18d76b6e7b 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
@@ -51,7 +51,6 @@ public class ConfigureScreenFragment extends BaseOsmAndFragment implements Quick
 
 	private OsmandApplication app;
 	private OsmandSettings settings;
-	private UiUtilities iconsCache;
 	private MapWidgetRegistry widgetRegistry;
 	private ApplicationMode selectedAppMode;
 
@@ -78,7 +77,6 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 	@Nullable
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
-		iconsCache = app.getUIUtilities();
 		nightMode = !settings.isLightContent();
 		themedInflater = UiUtilities.getInflater(getContext(), nightMode);
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetItem.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetItem.java
deleted file mode 100644
index 8083a8d5b8b..00000000000
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetItem.java
+++ /dev/null
@@ -1,14 +0,0 @@
-package net.osmand.plus.views.mapwidgets.configure;
-
-public class WidgetItem {
-
-	public final String title;
-	public final int iconId;
-	public boolean isActive;
-	public int priority;
-
-	public WidgetItem(int iconId, String title) {
-		this.iconId = iconId;
-		this.title = title;
-	}
-}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
index 167ec5af44e..643a359e094 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
@@ -1,7 +1,5 @@
 package net.osmand.plus.views.mapwidgets.configure.panel;
 
-import static net.osmand.plus.utils.ColorUtilities.getDefaultIconColor;
-
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
 import android.view.LayoutInflater;
@@ -26,11 +24,13 @@
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
 import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
 import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsFragment;
+import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.WidgetViewHolder;
 import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
 
 public class WidgetsListFragment extends Fragment implements OnScrollChangedListener {
@@ -38,7 +38,6 @@ public class WidgetsListFragment extends Fragment implements OnScrollChangedList
 	private static final String SELECTED_GROUP_ATTR = "selected_group_key";
 
 	private OsmandApplication app;
-	private UiUtilities uiUtilities;
 	private MapWidgetRegistry widgetRegistry;
 
 	private WidgetsPanel selectedPanel;
@@ -58,7 +57,6 @@ public void setSelectedPanel(@NonNull WidgetsPanel panel) {
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = (OsmandApplication) requireContext().getApplicationContext();
-		uiUtilities = app.getUIUtilities();
 		widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
 
 		OsmandSettings settings = app.getSettings();
@@ -116,7 +114,8 @@ public void setupReorderButton(@NonNull View view) {
 		view.setOnClickListener(v -> {
 			FragmentActivity activity = getActivity();
 			if (activity != null) {
-				ReorderWidgetsFragment.showInstance(this, activity, selectedPanel, selectedAppMode);
+				ReorderWidgetsFragment.showInstance(activity.getSupportFragmentManager(), selectedPanel,
+						selectedAppMode, getParentFragment());
 			}
 		});
 		setupListItemBackground(view);
@@ -126,28 +125,20 @@ public void updateContent() {
 		widgetsContainer.removeAllViews();
 
 		int profileColor = selectedAppMode.getProfileColor(nightMode);
-		int defaultIconColor = getDefaultIconColor(app, nightMode);
+		int defaultIconColor = ColorUtilities.getDefaultIconColor(app, nightMode);
 
 		LayoutInflater inflater = UiUtilities.getInflater(getContext(), nightMode);
-		for (MapWidgetInfo widgetInfo : widgetRegistry.getWidgetsForPanel(selectedPanel)) {
-			if (!selectedAppMode.isWidgetAvailable(widgetInfo.key)) {
-				continue;
-			}
+		for (MapWidgetInfo widgetInfo : widgetRegistry.getAvailableWidgetsForPanel(selectedAppMode, selectedPanel)) {
 			View view = inflater.inflate(R.layout.configure_screen_widget_item, widgetsContainer, false);
 
-			TextView tvTitle = view.findViewById(R.id.title);
-			if (widgetInfo.getMessage() != null) {
-				tvTitle.setText(widgetInfo.getMessage());
-			} else {
-				tvTitle.setText(widgetInfo.getMessageId());
-			}
+			TextView title = view.findViewById(R.id.title);
+			title.setText(widgetInfo.getTitle(app));
 			AndroidUiHelper.updateVisibility(view.findViewById(R.id.description), false);
 
 			boolean selected = widgetInfo.isVisibleCollapsed(selectedAppMode) || widgetInfo.isVisible(selectedAppMode);
 
-			int colorId = selected ? profileColor : defaultIconColor;
 			ImageView imageView = view.findViewById(R.id.icon);
-			imageView.setImageDrawable(uiUtilities.getPaintedIcon(widgetInfo.getSettingsIconId(), colorId));
+			WidgetViewHolder.updateWidgetIcon(imageView, widgetInfo, profileColor, defaultIconColor, selected, nightMode);
 
 			ImageView secondaryIcon = view.findViewById(R.id.secondary_icon);
 			secondaryIcon.setImageResource(R.drawable.ic_action_additional_option);
@@ -161,23 +152,23 @@ public void updateContent() {
 				compoundButton.performClick();
 
 				boolean checked = compoundButton.isChecked();
+				WidgetViewHolder.updateWidgetIcon(imageView, widgetInfo, profileColor, defaultIconColor, checked, nightMode);
 				widgetRegistry.setVisibility(widgetInfo, checked, false);
-				imageView.setImageDrawable(uiUtilities.getPaintedIcon(widgetInfo.getSettingsIconId(), checked ? profileColor : defaultIconColor));
 			});
 
 			view.setOnClickListener(v -> {
 				if (widgetInfo.getWidgetState() == null) {
 					boolean checked = !compoundButton.isChecked();
 					compoundButton.setChecked(checked);
+					WidgetViewHolder.updateWidgetIcon(imageView, widgetInfo, profileColor, defaultIconColor, checked, nightMode);
 					widgetRegistry.setVisibility(widgetInfo, checked, false);
-					imageView.setImageDrawable(uiUtilities.getPaintedIcon(widgetInfo.getSettingsIconId(), checked ? profileColor : defaultIconColor));
 				} else {
 					CallbackWithObject<WidgetState> callback = result -> {
 						updateContent();
 						return true;
 					};
 					widgetRegistry.showPopUpMenu(view, callback, widgetInfo.getWidgetState(), selectedAppMode,
-							null, null, null, compoundButton.isChecked());
+							null, null, null, compoundButton.isChecked(), nightMode);
 				}
 			});
 			setupListItemBackground(view);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/DataHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/DataHolder.java
deleted file mode 100644
index 0fa1b6cc4b4..00000000000
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/DataHolder.java
+++ /dev/null
@@ -1,79 +0,0 @@
-package net.osmand.plus.views.mapwidgets.configure.reorder;
-
-import android.os.Bundle;
-
-import androidx.annotation.NonNull;
-
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-
-import java.util.HashMap;
-
-public class DataHolder {
-
-	private static final String SELECTED_GROUP_ATTR = "selected_group_key";
-	private static final String ORDERS_ATTR = "orders_key";
-	private static final String ORDER_MODIFIED_ATTR = "order_modified_key";
-
-	private HashMap<String, Integer> orders = new HashMap<>();
-	private boolean orderModified = false;
-	private WidgetsPanel selectedPanel;
-
-	public void onSaveInstanceState(@NonNull Bundle outState) {
-		outState.putString(SELECTED_GROUP_ATTR, selectedPanel.name());
-		outState.putSerializable(ORDERS_ATTR, orders);
-		outState.putBoolean(ORDER_MODIFIED_ATTR, orderModified);
-	}
-
-	public void restoreData(@NonNull Bundle bundle) {
-		String groupName = bundle.getString(SELECTED_GROUP_ATTR);
-		selectedPanel = WidgetsPanel.valueOf(groupName);
-		orders = (HashMap<String, Integer>) bundle.getSerializable(ORDERS_ATTR);
-		orderModified = bundle.getBoolean(ORDER_MODIFIED_ATTR);
-	}
-
-	public WidgetsPanel getSelectedPanel() {
-		return selectedPanel;
-	}
-
-	public void setSelectedPanel(WidgetsPanel selectedPanel) {
-		this.selectedPanel = selectedPanel;
-	}
-
-	@NonNull
-	public HashMap<String, Integer> getOrders() {
-		return orders;
-	}
-
-	public int getOrder(@NonNull String key) {
-		Integer order = orders.get(key);
-		return order != null ? order : -1;
-	}
-
-	public boolean isOrderModified() {
-		return orderModified;
-	}
-
-	public void orderModified() {
-		this.orderModified = true;
-	}
-
-	/**
-	 * Clear and fill in the order of widgets.
-	 * Called each time when need to initialize the order data for some profile.
-	 * @param appMode application profile from which to get order.
-	 * @param orderByDefault indicates whether you want to get the default order of widgets for this profile.
-	 */
-	public void initOrders(@NonNull ApplicationMode appMode,
-	                       boolean orderByDefault) {
-		orders.clear();
-		if (orderByDefault) {
-			orderModified();
-		}
-//		List<WidgetItem> widgets = WidgetsRegister.getSortedWidgets(appMode, selectedPanel, orderByDefault);
-//		for (WidgetItem widget : widgets) {
-//			orders.put(widget.title, widget.priority);
-//		}
-	}
-
-}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
index 3361294c1b6..25f94601951 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
@@ -1,48 +1,49 @@
 package net.osmand.plus.views.mapwidgets.configure.reorder;
 
+import static net.osmand.plus.utils.UiUtilities.getColoredSelectableDrawable;
+
 import android.annotation.SuppressLint;
 import android.content.Context;
-import android.graphics.ColorMatrix;
-import android.graphics.ColorMatrixColorFilter;
-import android.graphics.drawable.Drawable;
 import android.view.LayoutInflater;
 import android.view.MotionEvent;
 import android.view.View;
 import android.view.ViewGroup;
-import android.widget.ImageView;
 
 import androidx.annotation.NonNull;
-import androidx.recyclerview.widget.RecyclerView;
+import androidx.annotation.Nullable;
+import androidx.recyclerview.widget.RecyclerView.Adapter;
 import androidx.recyclerview.widget.RecyclerView.ViewHolder;
 
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
-import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
+import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.OnItemMoveCallback;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.ButtonViewHolder;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.ButtonViewHolder.ButtonInfo;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.DividerViewHolder;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.HeaderViewHolder;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.SpaceViewHolder;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.WidgetViewHolder;
-import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.WidgetViewHolder.CheckItemIsMovable;
+import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.WidgetViewHolder.ItemMovableCallback;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.WidgetViewHolder.WidgetUiInfo;
 
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.List;
 
-public class ReorderWidgetsAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder>
-		implements ReorderItemTouchHelperCallback.OnItemMoveCallback, CheckItemIsMovable {
+public class ReorderWidgetsAdapter extends Adapter<ViewHolder> implements OnItemMoveCallback, ItemMovableCallback {
 
 	private final OsmandApplication app;
-	private DataHolder dataHolder;
-	private WidgetAdapterListener listener;
+	private final WidgetsDataHolder dataHolder;
+	private final List<ListItem> items = new ArrayList<>();
 
-	private List<ListItem> items = new ArrayList<>();
+	private WidgetAdapterListener listener;
 	private final boolean nightMode;
+	private final int profileColor;
+	private final int defaultIconColor;
 
 	public enum ItemType {
 		HEADER,
@@ -54,13 +55,30 @@ public enum ItemType {
 		BUTTON
 	}
 
-	public ReorderWidgetsAdapter(@NonNull OsmandApplication app,
-	                             @NonNull DataHolder dataHolder,
-	                             boolean nightMode) {
+	public ReorderWidgetsAdapter(@NonNull OsmandApplication app, @NonNull WidgetsDataHolder dataHolder, boolean nightMode) {
 		setHasStableIds(true);
 		this.app = app;
 		this.nightMode = nightMode;
 		this.dataHolder = dataHolder;
+
+		ApplicationMode mode = app.getSettings().getApplicationMode();
+		profileColor = mode.getProfileColor(nightMode);
+		defaultIconColor = ColorUtilities.getDefaultIconColor(app, nightMode);
+	}
+
+	@NonNull
+	public List<ListItem> getItems() {
+		return items;
+	}
+
+	public void setItems(@NonNull List<ListItem> items) {
+		this.items.clear();
+		this.items.addAll(items);
+		notifyDataSetChanged();
+	}
+
+	public void setListener(@NonNull WidgetAdapterListener listener) {
+		this.listener = listener;
 	}
 
 	@NonNull
@@ -68,32 +86,26 @@ public ReorderWidgetsAdapter(@NonNull OsmandApplication app,
 	public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
 		Context ctx = parent.getContext();
 		LayoutInflater inflater = UiUtilities.getInflater(ctx, nightMode);
-		ItemType type = viewType < ItemType.values().length ? ItemType.values()[viewType] : ItemType.CARD_DIVIDER;
-		View itemView;
-		switch (type) {
+
+		switch (ItemType.values()[viewType]) {
 			case WIDGET:
-				itemView = inflater.inflate(R.layout.configure_screen_list_item_widget_reorder, parent, false);
+				View itemView = inflater.inflate(R.layout.configure_screen_list_item_widget_reorder, parent, false);
 				return new WidgetViewHolder(itemView, ReorderWidgetsAdapter.this);
 			case HEADER:
-				itemView = inflater.inflate(R.layout.configure_screen_list_item_header, parent, false);
-				return new HeaderViewHolder(itemView);
+				return new HeaderViewHolder(inflater.inflate(R.layout.configure_screen_list_item_header, parent, false));
 			case CARD_DIVIDER:
-				itemView = inflater.inflate(R.layout.list_item_divider, parent, false);
-				return new DividerViewHolder(itemView);
+				return new DividerViewHolder(inflater.inflate(R.layout.list_item_divider, parent, false));
 			case CARD_TOP_DIVIDER:
 				itemView = inflater.inflate(R.layout.list_item_divider, parent, false);
 				View bottomShadow = itemView.findViewById(R.id.bottomShadowView);
 				bottomShadow.setVisibility(View.INVISIBLE);
 				return new DividerViewHolder(itemView);
 			case CARD_BOTTOM_DIVIDER:
-				itemView = inflater.inflate(R.layout.card_bottom_divider, parent, false);
-				return new DividerViewHolder(itemView);
+				return new DividerViewHolder(inflater.inflate(R.layout.card_bottom_divider, parent, false));
 			case SPACE:
-				itemView = new View(ctx);
-				return new SpaceViewHolder(itemView);
+				return new SpaceViewHolder(new View(ctx));
 			case BUTTON:
-				itemView = inflater.inflate(R.layout.configure_screen_list_item_button, parent, false);
-				return new ButtonViewHolder(itemView);
+				return new ButtonViewHolder(inflater.inflate(R.layout.configure_screen_list_item_button, parent, false));
 			default:
 				throw new IllegalArgumentException("Unsupported view type");
 		}
@@ -101,74 +113,57 @@ public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
 
 	@SuppressLint("ClickableViewAccessibility")
 	@Override
-	public void onBindViewHolder(@NonNull ViewHolder holder,
-	                             int position) {
+	public void onBindViewHolder(@NonNull ViewHolder viewHolder, int position) {
 		ListItem item = items.get(position);
-		if (holder instanceof WidgetViewHolder) {
-			WidgetViewHolder h = (WidgetViewHolder) holder;
+		if (viewHolder instanceof WidgetViewHolder) {
 			WidgetUiInfo widgetInfo = (WidgetUiInfo) item.value;
-			h.title.setText(widgetInfo.title);
-			h.icon.setImageResource(widgetInfo.iconId);
-			setImageFilter(h.icon, !widgetInfo.isActive);
-			h.moveIcon.setOnTouchListener((view, event) -> {
+			WidgetViewHolder holder = (WidgetViewHolder) viewHolder;
+
+			holder.title.setText(widgetInfo.title);
+			holder.moveIcon.setOnTouchListener((view, event) -> {
 				if (event.getActionMasked() == MotionEvent.ACTION_DOWN) {
-					listener.onDragStarted(holder);
+					listener.onDragStarted(viewHolder);
 				}
 				return false;
 			});
-		} else if (holder instanceof HeaderViewHolder) {
-			HeaderViewHolder h = (HeaderViewHolder) holder;
-			String header = (String) item.value;
-			h.title.setText(header);
-		} else if (holder instanceof ButtonViewHolder) {
+			holder.icon.setImageResource(widgetInfo.iconId);
+			WidgetViewHolder.updateWidgetIcon(holder.icon, widgetInfo.info, profileColor, defaultIconColor, widgetInfo.isActive, nightMode);
+		} else if (viewHolder instanceof HeaderViewHolder) {
+			HeaderViewHolder holder = (HeaderViewHolder) viewHolder;
+			holder.title.setText((String) item.value);
+		} else if (viewHolder instanceof ButtonViewHolder) {
 			ButtonInfo buttonInfo = (ButtonInfo) item.value;
-			ButtonViewHolder h = (ButtonViewHolder) holder;
-			h.buttonView.setOnClickListener(buttonInfo.listener);
-			h.icon.setImageResource(buttonInfo.iconRes);
-			h.title.setText(buttonInfo.title);
+
+			ButtonViewHolder holder = (ButtonViewHolder) viewHolder;
+			holder.buttonView.setOnClickListener(buttonInfo.listener);
+			holder.icon.setImageResource(buttonInfo.iconRes);
+			holder.title.setText(buttonInfo.title);
+
 			ApplicationMode appMode = app.getSettings().getApplicationMode();
 			int profileColor = appMode.getProfileColor(nightMode);
-			Drawable drawable = UiUtilities.getColoredSelectableDrawable(app, profileColor, 0.3f);
-			AndroidUtils.setBackground(h.buttonView, drawable);
-		} else if (holder instanceof SpaceViewHolder) {
-			float space = (float) item.value;
-			((SpaceViewHolder) holder).setHeight((int) space);
+			AndroidUtils.setBackground(holder.buttonView, getColoredSelectableDrawable(app, profileColor, 0.3f));
+		} else if (viewHolder instanceof SpaceViewHolder) {
+			SpaceViewHolder holder = (SpaceViewHolder) viewHolder;
+			holder.setHeight((int) item.value);
 		}
 	}
 
-	public void setItems(List<ListItem> items) {
-		this.items = items;
-		notifyDataSetChanged();
-	}
-
-	@Override
-	public int getItemCount() {
-		return items.size();
-	}
-
-	@Override
-	public int getItemViewType(int position) {
-		ListItem item = items.get(position);
-		return item.type.ordinal();
-	}
-
 	@Override
 	public boolean onItemMove(int from, int to) {
-		Object itemFrom = items.get(from).value;
 		Object itemTo = items.get(to).value;
+		Object itemFrom = items.get(from).value;
 		if (itemFrom instanceof WidgetUiInfo && itemTo instanceof WidgetUiInfo) {
-			dataHolder.orderModified();
-			WidgetUiInfo widgetFrom = (WidgetUiInfo) itemFrom;
 			WidgetUiInfo widgetTo = (WidgetUiInfo) itemTo;
+			WidgetUiInfo widgetFrom = (WidgetUiInfo) itemFrom;
 
-			int orderFrom = widgetFrom.order;
 			int orderTo = widgetTo.order;
+			int orderFrom = widgetFrom.order;
 
-			widgetFrom.order = orderTo;
 			widgetTo.order = orderFrom;
+			widgetFrom.order = orderTo;
 
-			dataHolder.getOrders().put(widgetFrom.title, orderTo);
 			dataHolder.getOrders().put(widgetTo.title, orderFrom);
+			dataHolder.getOrders().put(widgetFrom.title, orderTo);
 
 			Collections.swap(items, from, to);
 			notifyItemMoved(from, to);
@@ -178,16 +173,14 @@ public boolean onItemMove(int from, int to) {
 	}
 
 	@Override
-	public long getItemId(int position) {
+	public int getItemCount() {
+		return items.size();
+	}
+
+	@Override
+	public int getItemViewType(int position) {
 		ListItem item = items.get(position);
-		if (item.value instanceof WidgetUiInfo) {
-			return ((WidgetUiInfo) item.value).title.hashCode();
-		} else if (item.value instanceof ButtonInfo) {
-			return ((ButtonInfo) item.value).title.hashCode();
-		} else if (item.value != null) {
-			return item.value.hashCode();
-		}
-		return item.hashCode();
+		return item.type.ordinal();
 	}
 
 	@Override
@@ -195,19 +188,17 @@ public void onItemDismiss(ViewHolder holder) {
 		listener.onDragOrSwipeEnded(holder);
 	}
 
-	public void setListener(@NonNull WidgetAdapterListener listener) {
-		this.listener = listener;
-	}
-
-	private void setImageFilter(@NonNull ImageView ivImage, boolean applyFilter) {
-		if (applyFilter) {
-			ColorMatrix matrix = new ColorMatrix();
-			matrix.setSaturation(0);
-			ColorMatrixColorFilter filter = new ColorMatrixColorFilter(matrix);
-			ivImage.setColorFilter(filter);
-		} else {
-			ivImage.clearColorFilter();
+	@Override
+	public long getItemId(int position) {
+		ListItem item = items.get(position);
+		if (item.value instanceof WidgetUiInfo) {
+			return ((WidgetUiInfo) item.value).key.hashCode();
+		} else if (item.value instanceof ButtonInfo) {
+			return ((ButtonInfo) item.value).title.hashCode();
+		} else if (item.value != null) {
+			return item.value.hashCode();
 		}
+		return item.hashCode();
 	}
 
 	@Override
@@ -216,20 +207,21 @@ public boolean isListItemMovable(int position) {
 		return item.value instanceof WidgetUiInfo;
 	}
 
-
 	public static class ListItem {
-		ItemType type;
-		Object value;
 
-		public ListItem(@NonNull ItemType type, @NonNull Object value) {
+		public final ItemType type;
+		public final Object value;
+
+		public ListItem(@NonNull ItemType type, @Nullable Object value) {
 			this.type = type;
 			this.value = value;
 		}
 	}
 
 	public interface WidgetAdapterListener {
-		void onDragStarted(RecyclerView.ViewHolder holder);
-		void onDragOrSwipeEnded(RecyclerView.ViewHolder holder);
-	}
 
-}
+		void onDragStarted(ViewHolder holder);
+
+		void onDragOrSwipeEnded(ViewHolder holder);
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
index 9a8042cd770..61b0b5a4392 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
@@ -1,6 +1,5 @@
 package net.osmand.plus.views.mapwidgets.configure.reorder;
 
-import android.content.Context;
 import android.os.Build;
 import android.os.Bundle;
 import android.view.LayoutInflater;
@@ -10,7 +9,6 @@
 
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
-import androidx.appcompat.app.AlertDialog;
 import androidx.appcompat.widget.Toolbar;
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentActivity;
@@ -27,13 +25,17 @@
 import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet.CopyAppModePrefsListener;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.bottomsheets.ResetProfilePrefsBottomSheet;
+import net.osmand.plus.settings.bottomsheets.ResetProfilePrefsBottomSheet.ResetAppModePrefsListener;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.utils.UiUtilities.DialogButtonType;
 import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
+import net.osmand.plus.views.layers.MapInfoLayer;
+import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.configure.WidgetItem;
 import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsAdapter.ItemType;
 import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsAdapter.ListItem;
 import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsAdapter.WidgetAdapterListener;
@@ -45,7 +47,7 @@
 import java.util.List;
 import java.util.Map;
 
-public class ReorderWidgetsFragment extends BaseOsmAndFragment implements CopyAppModePrefsListener {
+public class ReorderWidgetsFragment extends BaseOsmAndFragment implements CopyAppModePrefsListener, ResetAppModePrefsListener {
 
 	public static final String TAG = ReorderWidgetsFragment.class.getSimpleName();
 
@@ -53,84 +55,85 @@ public class ReorderWidgetsFragment extends BaseOsmAndFragment implements CopyAp
 
 	private OsmandApplication app;
 	private OsmandSettings settings;
-	private ApplicationMode appMode;
-	private boolean nightMode;
+	private MapWidgetRegistry widgetRegistry;
+
+	private ApplicationMode selectedAppMode;
+	private final WidgetsDataHolder dataHolder = new WidgetsDataHolder();
 
 	private View view;
 	private Toolbar toolbar;
-	private RecyclerView rvContentList;
+	private RecyclerView recyclerView;
 
-	private final DataHolder dataHolder = new DataHolder();
-	private WidgetsOrderListener callback;
 	private ReorderWidgetsAdapter adapter;
 
+	private boolean nightMode;
+
+	public void setSelectedAppMode(@NonNull ApplicationMode selectedAppMode) {
+		this.selectedAppMode = selectedAppMode;
+	}
+
+	public void setSelectedPanel(@NonNull WidgetsPanel selectedPanel) {
+		dataHolder.setSelectedPanel(selectedPanel);
+	}
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = requireMyApplication();
 		settings = app.getSettings();
-		callback = (WidgetsOrderListener) getTargetFragment();
+		widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+
 		if (savedInstanceState != null) {
-			restoreData(savedInstanceState);
+			String appModeKey = savedInstanceState.getString(APP_MODE_ATTR);
+			selectedAppMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
+			dataHolder.restoreData(savedInstanceState);
 		} else {
-			dataHolder.initOrders(appMode, false);
+			dataHolder.initOrders(app, selectedAppMode, false);
 		}
 	}
 
 	@Nullable
 	@Override
-	public View onCreateView(@NonNull LayoutInflater inflater,
-	                         @Nullable ViewGroup container,
-	                         @Nullable Bundle savedInstanceState) {
+	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
 		nightMode = !settings.isLightContent();
-		inflater = UiUtilities.getInflater(getContext(), nightMode);
 
-		view = inflater.inflate(R.layout.fragment_reorder_widgets, container, false);
+		LayoutInflater themedInflater = UiUtilities.getInflater(getContext(), nightMode);
+		view = themedInflater.inflate(R.layout.fragment_reorder_widgets, container, false);
 		if (Build.VERSION.SDK_INT < 30) {
 			AndroidUtils.addStatusBarPadding21v(app, view);
 		}
 
 		toolbar = view.findViewById(R.id.toolbar);
-		rvContentList = view.findViewById(R.id.content_list);
+		recyclerView = view.findViewById(R.id.content_list);
 
 		setupToolbar();
-		setupApplyButton();
 		setupContent();
+		setupApplyButton();
 
 		return view;
 	}
 
 	private void setupToolbar() {
-		WidgetsPanel selectedGroup = dataHolder.getSelectedPanel();
-		String title = getString(selectedGroup.getTitleId());
-		TextView tvTitle = toolbar.findViewById(R.id.toolbar_title);
-		tvTitle.setText(title);
+		TextView title = toolbar.findViewById(R.id.toolbar_title);
+		TextView subtitle = toolbar.findViewById(R.id.toolbar_subtitle);
 
-		String appModeName = appMode.toHumanString();
-		TextView tvSubtitle = toolbar.findViewById(R.id.toolbar_subtitle);
-		tvSubtitle.setText(appModeName);
+		title.setText(dataHolder.getSelectedPanel().getTitleId());
+		subtitle.setText(selectedAppMode.toHumanString());
 
-		View backBtn = toolbar.findViewById(R.id.back_button);
-		backBtn.setOnClickListener(v -> dismiss());
-
-		View resetBtn = toolbar.findViewById(R.id.reset_button);
-		resetBtn.setOnClickListener(v -> onResetChanges());
-
-		View copyBtn = toolbar.findViewById(R.id.copy_button);
-		copyBtn.setOnClickListener(v -> onCopyFromProfile());
+		toolbar.findViewById(R.id.back_button).setOnClickListener(v -> dismiss());
+		toolbar.findViewById(R.id.reset_button).setOnClickListener(v -> resetChanges());
+		toolbar.findViewById(R.id.copy_button).setOnClickListener(v -> copyFromProfile());
 	}
 
 	private void setupContent() {
-		rvContentList.setLayoutManager(new LinearLayoutManager(app));
+		recyclerView.setLayoutManager(new LinearLayoutManager(app));
 		adapter = new ReorderWidgetsAdapter(app, dataHolder, nightMode);
 
 		ItemTouchHelper touchHelper = new ItemTouchHelper(new ReorderItemTouchHelperCallback(adapter));
-		touchHelper.attachToRecyclerView(rvContentList);
+		touchHelper.attachToRecyclerView(recyclerView);
 
 		adapter.setListener(new WidgetAdapterListener() {
 			private int fromPosition;
-			private int toPosition;
 
 			@Override
 			public void onDragStarted(ViewHolder holder) {
@@ -140,100 +143,93 @@ public void onDragStarted(ViewHolder holder) {
 
 			@Override
 			public void onDragOrSwipeEnded(ViewHolder holder) {
-				toPosition = holder.getAdapterPosition();
+				int toPosition = holder.getAdapterPosition();
 				if (toPosition >= 0 && fromPosition >= 0 && toPosition != fromPosition) {
 					adapter.notifyDataSetChanged();
 				}
 			}
 		});
-		rvContentList.setAdapter(adapter);
+		recyclerView.setAdapter(adapter);
 		updateItems();
 	}
 
 	private void setupApplyButton() {
-		View applyBtn = view.findViewById(R.id.apply_button);
-		UiUtilities.setupDialogButton(nightMode, applyBtn, DialogButtonType.PRIMARY, R.string.shared_string_apply);
-		applyBtn.setOnClickListener(v -> onApplyChanges());
+		View applyButton = view.findViewById(R.id.apply_button);
+		UiUtilities.setupDialogButton(nightMode, applyButton, DialogButtonType.PRIMARY, R.string.shared_string_apply);
+		applyButton.setOnClickListener(v -> onApplyChanges());
 	}
 
-	private void onResetChanges() {
-		Context context = getContext();
-		if (context != null) {
-			AlertDialog.Builder builder = new AlertDialog.Builder(context);
-			builder.setTitle(getString(R.string.reset_to_default));
-			builder.setMessage(R.string.are_you_sure);
-			builder.setNegativeButton(R.string.shared_string_cancel, null);
-			builder.setPositiveButton(R.string.shared_string_ok, (dialog, which) -> {
-				dataHolder.initOrders(appMode, true);
-				updateItems();
-			});
-			builder.show();
+	private void dismiss() {
+		FragmentActivity activity = getActivity();
+		if (activity != null) {
+			activity.onBackPressed();
 		}
 	}
 
-	private void onCopyFromProfile() {
+	private void copyFromProfile() {
 		FragmentActivity activity = getActivity();
 		if (activity != null) {
-			FragmentManager fm = activity.getSupportFragmentManager();
-			SelectCopyAppModeBottomSheet.showInstance(fm, this, false, appMode);
+			SelectCopyAppModeBottomSheet.showInstance(activity.getSupportFragmentManager(), this, false, selectedAppMode);
 		}
 	}
 
 	private void onApplyChanges() {
 		applyOrder();
-		callback.onWidgetsOrderApplied();
-		dismiss();
-	}
 
-	private void applyOrder() {
-		WidgetsPanel selectedPanel = dataHolder.getSelectedPanel();
-//		for (WidgetItem widget : WidgetsRegister.getWidgets(appMode, selectedPanel)) {
-//			String key = widget.title;
-//			widget.priority = dataHolder.getOrder(key);
-//		}
-	}
-
-	@Override
-	public void copyAppModePrefs(ApplicationMode appMode) {
-		dataHolder.initOrders(appMode, false);
-		updateItems();
+		Fragment fragment = getTargetFragment();
+		if (fragment instanceof WidgetsOrderListener) {
+			((WidgetsOrderListener) fragment).onWidgetsOrderApplied();
+		}
+		dismiss();
 	}
 
-	private void dismiss() {
-		FragmentActivity activity = getActivity();
-		if (activity != null) {
-			activity.onBackPressed();
+	private void resetChanges() {
+		FragmentManager fragmentManager = getFragmentManager();
+		if (fragmentManager != null) {
+			ResetProfilePrefsBottomSheet.showInstance(fragmentManager, selectedAppMode, this, false);
 		}
 	}
 
 	private void updateItems() {
 		List<ListItem> items = new ArrayList<>();
-		items.add(new ListItem(ItemType.CARD_TOP_DIVIDER, 0));
+		items.add(new ListItem(ItemType.CARD_TOP_DIVIDER, null));
 		items.add(new ListItem(ItemType.HEADER, getString(R.string.shared_string_visible_widgets)));
 		items.addAll(createWidgetsList());
-		items.add(new ListItem(ItemType.CARD_DIVIDER, 0));
+		items.add(new ListItem(ItemType.CARD_DIVIDER, null));
 		items.add(new ListItem(ItemType.HEADER, getString(R.string.shared_string_actions)));
 		items.add(new ListItem(ItemType.BUTTON, new ButtonInfo(
 				getString(R.string.reset_to_default),
 				R.drawable.ic_action_reset,
-				v -> onResetChanges()
+				v -> resetChanges()
 		)));
 		items.add(new ListItem(ItemType.BUTTON, new ButtonInfo(
 				getString(R.string.copy_from_other_profile),
 				R.drawable.ic_action_copy,
-				v -> onCopyFromProfile()
+				v -> copyFromProfile()
 		)));
-		items.add(new ListItem(ItemType.CARD_BOTTOM_DIVIDER, 0));
-		float bottomSpace = getResources().getDimensionPixelSize(R.dimen.bottom_space_height);
-		items.add(new ListItem(ItemType.SPACE, bottomSpace));
+		items.add(new ListItem(ItemType.CARD_BOTTOM_DIVIDER, null));
+		items.add(new ListItem(ItemType.SPACE, getResources().getDimensionPixelSize(R.dimen.bottom_space_height)));
 		adapter.setItems(items);
 	}
 
 	private List<ListItem> createWidgetsList() {
 		List<ListItem> list = new ArrayList<>();
-		List<WidgetItem> widgets = new ArrayList<>();
-		for (WidgetItem item : widgets) {
-			addWidgetToList(list, item);
+
+		WidgetsPanel selectedPanel = dataHolder.getSelectedPanel();
+		for (MapWidgetInfo widgetInfo : widgetRegistry.getAvailableWidgetsForPanel(selectedAppMode, selectedPanel)) {
+			Map<String, Integer> orders = dataHolder.getOrders();
+			Integer order = orders.get(widgetInfo.key);
+			if (order == null) {
+				order = widgetInfo.priority;
+			}
+			WidgetUiInfo info = new WidgetUiInfo();
+			info.key = widgetInfo.key;
+			info.title = widgetInfo.getTitle(app);
+			info.iconId = widgetInfo.getMapIconId(nightMode);
+			info.isActive = widgetInfo.isVisibleCollapsed(selectedAppMode) || widgetInfo.isVisible(selectedAppMode);
+			info.order = order;
+			info.info = widgetInfo;
+			list.add(new ListItem(ItemType.WIDGET, info));
 		}
 		Collections.sort(list, (o1, o2) -> {
 			int order1 = ((WidgetUiInfo) o1.value).order;
@@ -243,41 +239,42 @@ private List<ListItem> createWidgetsList() {
 		return list;
 	}
 
-	private void addWidgetToList(@NonNull List<ListItem> list,
-	                             @NonNull WidgetItem w) {
-		String key = w.title;
-		Map<String, Integer> orders = dataHolder.getOrders();
-		Integer order = orders.get(key);
-		if (order == null) {
-			order = w.priority;
+	private void applyOrder() {
+		List<ListItem> items = adapter.getItems();
+		List<String> widgetsOrder = new ArrayList<>();
+		for (ListItem item : items) {
+			if (item.value instanceof WidgetUiInfo) {
+				WidgetUiInfo widgetInfo = (WidgetUiInfo) item.value;
+				widgetsOrder.add(widgetInfo.key);
+			}
 		}
-		WidgetUiInfo wi = new WidgetUiInfo();
-		wi.title = w.title;
-		wi.iconId = w.iconId;
-		wi.isActive = w.isActive;
-		wi.order = order;
-		list.add(new ListItem(ItemType.WIDGET, wi));
-	}
+		WidgetsPanel selectedPanel = dataHolder.getSelectedPanel();
+		selectedPanel.setWidgetsOrder(selectedAppMode, widgetsOrder, settings);
+		widgetRegistry.reorderWidgets();
 
-	@Override
-	public void onSaveInstanceState(@NonNull Bundle outState) {
-		super.onSaveInstanceState(outState);
-		outState.putString(APP_MODE_ATTR, appMode.getStringKey());
-		dataHolder.onSaveInstanceState(outState);
+		MapInfoLayer mapInfoLayer = app.getOsmandMap().getMapLayers().getMapInfoLayer();
+		if (mapInfoLayer != null) {
+			mapInfoLayer.recreateControls();
+		}
 	}
 
-	private void restoreData(@NonNull Bundle savedInstanceState) {
-		String appModeKey = savedInstanceState.getString(APP_MODE_ATTR);
-		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
-		dataHolder.restoreData(savedInstanceState);
+	@Override
+	public void copyAppModePrefs(ApplicationMode appMode) {
+		dataHolder.initOrders(app, appMode, false);
+		updateItems();
 	}
 
-	public void setSelectedGroup(WidgetsPanel selectedGroup) {
-		dataHolder.setSelectedPanel(selectedGroup);
+	@Override
+	public void resetAppModePrefs(ApplicationMode appMode) {
+		dataHolder.initOrders(app, selectedAppMode, true);
+		updateItems();
 	}
 
-	public void setAppMode(ApplicationMode appMode) {
-		this.appMode = appMode;
+	@Override
+	public void onSaveInstanceState(@NonNull Bundle outState) {
+		super.onSaveInstanceState(outState);
+		dataHolder.onSaveInstanceState(outState);
+		outState.putString(APP_MODE_ATTR, selectedAppMode.getStringKey());
 	}
 
 	@Override
@@ -289,17 +286,16 @@ public int getStatusBarColorId() {
 		return ColorUtilities.getListBgColorId(nightMode);
 	}
 
-	public static void showInstance(@NonNull Fragment target,
-	                                @NonNull FragmentActivity activity,
-	                                @NonNull WidgetsPanel selectedGroup,
-	                                @NonNull ApplicationMode appMode) {
-		FragmentManager fragmentManager = activity.getSupportFragmentManager();
-		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
+	public static void showInstance(@NonNull FragmentManager manager,
+	                                @NonNull WidgetsPanel panel,
+	                                @NonNull ApplicationMode appMode,
+	                                @NonNull Fragment target) {
+		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 			ReorderWidgetsFragment fragment = new ReorderWidgetsFragment();
 			fragment.setTargetFragment(target, 0);
-			fragment.setSelectedGroup(selectedGroup);
-			fragment.setAppMode(appMode);
-			fragmentManager.beginTransaction()
+			fragment.setSelectedPanel(panel);
+			fragment.setSelectedAppMode(appMode);
+			manager.beginTransaction()
 					.add(R.id.fragmentContainer, fragment, TAG)
 					.addToBackStack(TAG)
 					.commitAllowingStateLoss();
@@ -309,4 +305,4 @@ public static void showInstance(@NonNull Fragment target,
 	public interface WidgetsOrderListener {
 		void onWidgetsOrderApplied();
 	}
-}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/WidgetsDataHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/WidgetsDataHolder.java
new file mode 100644
index 00000000000..a9737bdb7ad
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/WidgetsDataHolder.java
@@ -0,0 +1,72 @@
+package net.osmand.plus.views.mapwidgets.configure.reorder;
+
+import android.os.Bundle;
+
+import androidx.annotation.NonNull;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetsPanel;
+
+import java.util.HashMap;
+import java.util.List;
+
+public class WidgetsDataHolder {
+
+	private static final String ORDERS_ATTR = "orders_key";
+	private static final String SELECTED_PANEL_KEY = "selected_panel_key";
+
+	private WidgetsPanel selectedPanel;
+	private HashMap<String, Integer> orders = new HashMap<>();
+
+	public WidgetsPanel getSelectedPanel() {
+		return selectedPanel;
+	}
+
+	public void setSelectedPanel(@NonNull WidgetsPanel selectedPanel) {
+		this.selectedPanel = selectedPanel;
+	}
+
+	@NonNull
+	public HashMap<String, Integer> getOrders() {
+		return orders;
+	}
+
+	public int getOrder(@NonNull String key) {
+		Integer order = orders.get(key);
+		return order != null ? order : -1;
+	}
+
+	public void initOrders(@NonNull OsmandApplication app, @NonNull ApplicationMode appMode, boolean orderByDefault) {
+		orders.clear();
+		if (orderByDefault) {
+			List<String> orderIds = selectedPanel.getOriginalOrder();
+			MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+			for (MapWidgetInfo widgetInfo : widgetRegistry.getAvailableWidgetsForPanel(appMode, selectedPanel)) {
+				int order = orderIds.indexOf(widgetInfo.key);
+				if (order == -1) {
+					order = orderIds.size() + 1;
+				}
+				orders.put(widgetInfo.key, order);
+			}
+		} else {
+			MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+			for (MapWidgetInfo widgetInfo : widgetRegistry.getAvailableWidgetsForPanel(appMode, selectedPanel)) {
+				int order = selectedPanel.getWidgetOrder(appMode, widgetInfo.key, app.getSettings());
+				orders.put(widgetInfo.key, order);
+			}
+		}
+	}
+
+	public void onSaveInstanceState(@NonNull Bundle outState) {
+		outState.putSerializable(ORDERS_ATTR, orders);
+		outState.putString(SELECTED_PANEL_KEY, selectedPanel.name());
+	}
+
+	public void restoreData(@NonNull Bundle bundle) {
+		orders = (HashMap<String, Integer>) bundle.getSerializable(ORDERS_ATTR);
+		selectedPanel = WidgetsPanel.valueOf(bundle.getString(SELECTED_PANEL_KEY));
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java
index 637492a62e8..a7fa41f2897 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java
@@ -1,14 +1,22 @@
 package net.osmand.plus.views.mapwidgets.configure.reorder.viewholder;
 
+import android.graphics.ColorFilter;
+import android.graphics.ColorMatrix;
+import android.graphics.ColorMatrixColorFilter;
+import android.graphics.drawable.Drawable;
 import android.view.View;
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import androidx.recyclerview.widget.RecyclerView;
 import androidx.recyclerview.widget.RecyclerView.ViewHolder;
 
+import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.UnmovableItem;
+import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
 
 public class WidgetViewHolder extends ViewHolder implements UnmovableItem {
 
@@ -16,11 +24,11 @@ public class WidgetViewHolder extends ViewHolder implements UnmovableItem {
 	public ImageView icon;
 	public ImageView moveIcon;
 
-	private final CheckItemIsMovable checkItemIsMovable;
+	private final ItemMovableCallback itemMovableCallback;
 
-	public WidgetViewHolder(View itemView, CheckItemIsMovable checkItemIsMovable) {
+	public WidgetViewHolder(@NonNull View itemView, @Nullable ItemMovableCallback callback) {
 		super(itemView);
-		this.checkItemIsMovable = checkItemIsMovable;
+		this.itemMovableCallback = callback;
 		title = itemView.findViewById(R.id.title);
 		icon = itemView.findViewById(R.id.icon);
 		moveIcon = itemView.findViewById(R.id.move_icon);
@@ -29,17 +37,44 @@ public WidgetViewHolder(View itemView, CheckItemIsMovable checkItemIsMovable) {
 	@Override
 	public boolean isMovingDisabled() {
 		int position = getAdapterPosition();
-		if (position != RecyclerView.NO_POSITION && checkItemIsMovable != null) {
-			return !checkItemIsMovable.isListItemMovable(position);
+		if (position != RecyclerView.NO_POSITION && itemMovableCallback != null) {
+			return !itemMovableCallback.isListItemMovable(position);
 		}
 		return false;
 	}
 
+	public static void updateWidgetIcon(@NonNull ImageView imageView, @NonNull MapWidgetInfo widgetInfo,
+	                                    int profileColor, int defaultIconColor, boolean selected, boolean nightMode) {
+		int mapIconId = widgetInfo.getMapIconId(nightMode);
+		int settingsIconId = widgetInfo.getSettingsIconId();
+
+		OsmandApplication app = (OsmandApplication) imageView.getContext().getApplicationContext();
+		if (mapIconId != 0) {
+			imageView.setImageResource(mapIconId);
+			WidgetViewHolder.setImageFilter(imageView, !selected);
+		} else {
+			Drawable drawable = app.getUIUtilities().getPaintedIcon(settingsIconId, selected ? profileColor : defaultIconColor);
+			imageView.setImageDrawable(drawable);
+		}
+	}
+
+	public static void setImageFilter(@NonNull ImageView imageView, boolean applyFilter) {
+		ColorFilter colorFilter = null;
+		if (applyFilter) {
+			ColorMatrix matrix = new ColorMatrix();
+			matrix.setSaturation(0);
+			colorFilter = new ColorMatrixColorFilter(matrix);
+		}
+		imageView.setColorFilter(colorFilter);
+	}
 
 	public static class WidgetUiInfo {
+
+		public String key;
 		public String title;
-		public int iconId;
+		public MapWidgetInfo info;
 		public int order;
+		public int iconId;
 		public boolean isActive;
 
 		public void toggleActive() {
@@ -47,7 +82,7 @@ public void toggleActive() {
 		}
 	}
 
-	public interface CheckItemIsMovable {
+	public interface ItemMovableCallback {
 		boolean isListItemMovable(int position);
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java
index 77a458b2b9b..a5c7d8a4d65 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/TextInfoWidget.java
@@ -8,14 +8,14 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
-import net.osmand.plus.R;
-import net.osmand.plus.activities.MapActivity;
-import net.osmand.plus.views.layers.MapInfoLayer.TextState;
-
 import androidx.annotation.DrawableRes;
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.views.layers.MapInfoLayer.TextState;
+
 public class TextInfoWidget extends MapWidget {
 
 	private String contentTitle;
@@ -177,6 +177,11 @@ protected boolean updateVisibility(boolean visible) {
 
 	@DrawableRes
 	protected int getIconId() {
-		return isNightMode() ? nightIconId : dayIconId;
+		return getIconId(isNightMode());
+	}
+
+	@DrawableRes
+	public int getIconId(boolean nightMode) {
+		return nightMode ? nightIconId : dayIconId;
 	}
 }
\ No newline at end of file
