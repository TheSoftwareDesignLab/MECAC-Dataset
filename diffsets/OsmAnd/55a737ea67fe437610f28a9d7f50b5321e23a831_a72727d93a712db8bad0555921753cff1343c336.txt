diff --git a/OsmAnd/res/color-v21/dlg_btn_secondary_text_dark.xml b/OsmAnd/res/color-v21/dlg_btn_secondary_text_dark.xml
new file mode 100644
index 00000000000..40dada9edac
--- /dev/null
+++ b/OsmAnd/res/color-v21/dlg_btn_secondary_text_dark.xml
@@ -0,0 +1,4 @@
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:color="@color/active_buttons_and_links_text_disabled_dark" android:state_enabled="false" />
+	<item android:color="@color/active_buttons_and_links_dark" />
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/color-v21/dlg_btn_secondary_text_light.xml b/OsmAnd/res/color-v21/dlg_btn_secondary_text_light.xml
new file mode 100644
index 00000000000..54854c95fc4
--- /dev/null
+++ b/OsmAnd/res/color-v21/dlg_btn_secondary_text_light.xml
@@ -0,0 +1,4 @@
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:color="@color/active_buttons_and_links_text_disabled_light" android:state_enabled="false" />
+	<item android:color="@color/active_buttons_and_links_light" />
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/color/dlg_btn_primary_text_dark.xml b/OsmAnd/res/color/dlg_btn_primary_text_dark.xml
new file mode 100644
index 00000000000..0950b53f421
--- /dev/null
+++ b/OsmAnd/res/color/dlg_btn_primary_text_dark.xml
@@ -0,0 +1,5 @@
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:color="@color/active_buttons_and_links_text_dark" android:state_pressed="true" />
+	<item android:color="@color/active_buttons_and_links_text_disabled_dark" android:state_enabled="false" />
+	<item android:color="@color/active_buttons_and_links_text_dark" />
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/color/dlg_btn_primary_text_light.xml b/OsmAnd/res/color/dlg_btn_primary_text_light.xml
new file mode 100644
index 00000000000..31df2426cab
--- /dev/null
+++ b/OsmAnd/res/color/dlg_btn_primary_text_light.xml
@@ -0,0 +1,5 @@
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:color="@color/active_buttons_and_links_text_light" android:state_pressed="true" />
+	<item android:color="@color/active_buttons_and_links_text_disabled_light" android:state_enabled="false" />
+	<item android:color="@color/active_buttons_and_links_text_light" />
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/color/dlg_btn_secondary_text_dark.xml b/OsmAnd/res/color/dlg_btn_secondary_text_dark.xml
new file mode 100644
index 00000000000..5622a463ee5
--- /dev/null
+++ b/OsmAnd/res/color/dlg_btn_secondary_text_dark.xml
@@ -0,0 +1,5 @@
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:color="@color/active_buttons_and_links_text_dark" android:state_pressed="true" />
+	<item android:color="@color/active_buttons_and_links_text_disabled_dark" android:state_enabled="false" />
+	<item android:color="@color/active_buttons_and_links_dark" />
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/color/dlg_btn_secondary_text_light.xml b/OsmAnd/res/color/dlg_btn_secondary_text_light.xml
new file mode 100644
index 00000000000..b79bc831361
--- /dev/null
+++ b/OsmAnd/res/color/dlg_btn_secondary_text_light.xml
@@ -0,0 +1,5 @@
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:color="@color/active_buttons_and_links_text_light" android:state_pressed="true" />
+	<item android:color="@color/active_buttons_and_links_text_disabled_light" android:state_enabled="false" />
+	<item android:color="@color/active_buttons_and_links_light" />
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_day.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_day.png
index 6befa0b0760..b6e4ef96834 100644
Binary files a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_day.png and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_day.png differ
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_night.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_night.png
index f9764fd9f0d..25139df9747 100644
Binary files a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_night.png and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_night.png differ
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_day.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_day.png
index 2e803594722..79d7a64351b 100644
Binary files a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_day.png and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_day.png differ
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_night.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_night.png
index dab0477450a..b29f919d22d 100644
Binary files a/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_night.png and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_location_selected_night.png differ
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_day.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_day.png
index c11db9f38c5..c179aba2125 100644
Binary files a/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_day.png and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_day.png differ
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_night.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_night.png
index 56f248faae1..8a7e752361a 100644
Binary files a/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_night.png and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_night.png differ
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_selected_day.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_selected_day.png
new file mode 100644
index 00000000000..3e3edf8c3ae
Binary files /dev/null and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_selected_day.png differ
diff --git a/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_selected_night.png b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_selected_night.png
new file mode 100644
index 00000000000..f8c499cdc25
Binary files /dev/null and b/OsmAnd/res/drawable-large-hdpi/map_pin_user_stale_location_selected_night.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_day.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_day.png
index 9b05ef16a6b..68b7dfdcb1a 100644
Binary files a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_day.png and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_day.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_night.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_night.png
index c045f17835f..d12d548cb36 100644
Binary files a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_night.png and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_night.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_day.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_day.png
index e4e50bf6b78..9fe6be092d7 100644
Binary files a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_day.png and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_day.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_night.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_night.png
index 26c1d066224..24c2c15de69 100644
Binary files a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_night.png and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_location_selected_night.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_day.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_day.png
index a5971c9b8df..40873cefa21 100644
Binary files a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_day.png and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_day.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_night.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_night.png
index 4f3bc9fd259..5e64984e60e 100644
Binary files a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_night.png and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_night.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_selected_day.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_selected_day.png
new file mode 100644
index 00000000000..adb651f06bc
Binary files /dev/null and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_selected_day.png differ
diff --git a/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_selected_night.png b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_selected_night.png
new file mode 100644
index 00000000000..598b79c4649
Binary files /dev/null and b/OsmAnd/res/drawable-large-xhdpi/map_pin_user_stale_location_selected_night.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_location_day.png b/OsmAnd/res/drawable-large/map_pin_user_location_day.png
index b6baec1c928..88fa6fb44b6 100644
Binary files a/OsmAnd/res/drawable-large/map_pin_user_location_day.png and b/OsmAnd/res/drawable-large/map_pin_user_location_day.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_location_night.png b/OsmAnd/res/drawable-large/map_pin_user_location_night.png
index cd39fcfad51..e3dcc60b1cf 100644
Binary files a/OsmAnd/res/drawable-large/map_pin_user_location_night.png and b/OsmAnd/res/drawable-large/map_pin_user_location_night.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_location_selected_day.png b/OsmAnd/res/drawable-large/map_pin_user_location_selected_day.png
index 45ba2db4de0..92f0929a9c5 100644
Binary files a/OsmAnd/res/drawable-large/map_pin_user_location_selected_day.png and b/OsmAnd/res/drawable-large/map_pin_user_location_selected_day.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_location_selected_night.png b/OsmAnd/res/drawable-large/map_pin_user_location_selected_night.png
index 951496e5cec..979ae650772 100644
Binary files a/OsmAnd/res/drawable-large/map_pin_user_location_selected_night.png and b/OsmAnd/res/drawable-large/map_pin_user_location_selected_night.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_stale_location_day.png b/OsmAnd/res/drawable-large/map_pin_user_stale_location_day.png
index 8f75c4498d7..ec5b7d460e8 100644
Binary files a/OsmAnd/res/drawable-large/map_pin_user_stale_location_day.png and b/OsmAnd/res/drawable-large/map_pin_user_stale_location_day.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_stale_location_night.png b/OsmAnd/res/drawable-large/map_pin_user_stale_location_night.png
index 20c38a15925..78156075bf7 100644
Binary files a/OsmAnd/res/drawable-large/map_pin_user_stale_location_night.png and b/OsmAnd/res/drawable-large/map_pin_user_stale_location_night.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_stale_location_selected_day.png b/OsmAnd/res/drawable-large/map_pin_user_stale_location_selected_day.png
new file mode 100644
index 00000000000..b5ccc182489
Binary files /dev/null and b/OsmAnd/res/drawable-large/map_pin_user_stale_location_selected_day.png differ
diff --git a/OsmAnd/res/drawable-large/map_pin_user_stale_location_selected_night.png b/OsmAnd/res/drawable-large/map_pin_user_stale_location_selected_night.png
new file mode 100644
index 00000000000..a376b280ff2
Binary files /dev/null and b/OsmAnd/res/drawable-large/map_pin_user_stale_location_selected_night.png differ
diff --git a/OsmAnd/res/drawable-v21/dlg_btn_primary_dark.xml b/OsmAnd/res/drawable-v21/dlg_btn_primary_dark.xml
new file mode 100644
index 00000000000..e3b2c54f9bc
--- /dev/null
+++ b/OsmAnd/res/drawable-v21/dlg_btn_primary_dark.xml
@@ -0,0 +1,13 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable-v21/dlg_btn_primary_light.xml b/OsmAnd/res/drawable-v21/dlg_btn_primary_light.xml
new file mode 100644
index 00000000000..01bcae29a49
--- /dev/null
+++ b/OsmAnd/res/drawable-v21/dlg_btn_primary_light.xml
@@ -0,0 +1,13 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable-v21/dlg_btn_secondary_dark.xml b/OsmAnd/res/drawable-v21/dlg_btn_secondary_dark.xml
new file mode 100644
index 00000000000..dbaf09646c3
--- /dev/null
+++ b/OsmAnd/res/drawable-v21/dlg_btn_secondary_dark.xml
@@ -0,0 +1,13 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable-v21/dlg_btn_secondary_light.xml b/OsmAnd/res/drawable-v21/dlg_btn_secondary_light.xml
new file mode 100644
index 00000000000..01b73b44e55
--- /dev/null
+++ b/OsmAnd/res/drawable-v21/dlg_btn_secondary_light.xml
@@ -0,0 +1,13 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/profile_button_gray" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable-v21/dlg_btn_stroked_dark.xml b/OsmAnd/res/drawable-v21/dlg_btn_stroked_dark.xml
new file mode 100644
index 00000000000..5aa9278c8ce
--- /dev/null
+++ b/OsmAnd/res/drawable-v21/dlg_btn_stroked_dark.xml
@@ -0,0 +1,24 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_pressed="true">
+		<shape android:shape="rectangle">
+			<stroke android:width="1dp" android:color="@color/active_buttons_and_links_dark" />
+			<corners android:radius="@dimen/dlg_button_rect_rad" />
+		</shape>
+	</item>
+	<item android:state_enabled="false">
+		<shape android:shape="rectangle">
+			<solid android:color="@color/inactive_buttons_and_links_dark" />
+			<corners android:radius="@dimen/dlg_button_rect_rad" />
+		</shape>
+	</item>
+	<item>
+		<shape android:shape="rectangle">
+			<stroke android:width="1dp" android:color="@color/inactive_pages_dark" />
+			<solid android:color="@color/stroked_buttons_and_links_dark" />
+			<corners android:radius="@dimen/dlg_button_rect_rad" />
+		</shape>
+	</item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable-v21/dlg_btn_stroked_light.xml b/OsmAnd/res/drawable-v21/dlg_btn_stroked_light.xml
new file mode 100644
index 00000000000..6c9b38e82cc
--- /dev/null
+++ b/OsmAnd/res/drawable-v21/dlg_btn_stroked_light.xml
@@ -0,0 +1,23 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:state_pressed="true">
+		<shape android:shape="rectangle">
+			<stroke android:width="1dp" android:color="@color/active_buttons_and_links_light" />
+			<corners android:radius="@dimen/dlg_button_rect_rad" />
+		</shape>
+	</item>
+	<item android:state_enabled="false">
+		<shape android:shape="rectangle">
+			<solid android:color="@color/inactive_buttons_and_links_light" />
+			<corners android:radius="@dimen/dlg_button_rect_rad" />
+		</shape>
+	</item>
+	<item>
+		<shape android:shape="rectangle">
+			<stroke android:width="1dp" android:color="@color/profile_button_gray" />
+			<solid android:color="@color/stroked_buttons_and_links_light" />
+			<corners android:radius="@dimen/dlg_button_rect_rad" />
+		</shape>
+	</item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/btn_border_dark.xml b/OsmAnd/res/drawable/btn_border_dark.xml
index c965b828f9a..512e6a5583e 100644
--- a/OsmAnd/res/drawable/btn_border_dark.xml
+++ b/OsmAnd/res/drawable/btn_border_dark.xml
@@ -8,7 +8,7 @@
 	</item>
 	<item android:state_enabled="false">
 		<shape android:shape="rectangle">
-			<solid android:color="@color/activity_background_dark" />
+			<solid android:color="@color/card_and_list_background_dark" />
 			<corners android:radius="4dp" />
 		</shape>
 	</item>
@@ -16,7 +16,7 @@
 		<shape android:shape="rectangle">
 			<solid android:color="@null" />
 			<corners android:radius="4dp" />
-			<stroke android:width="1dp" android:color="@color/divider_dark" />
+			<stroke android:width="1dp" android:color="@color/inactive_pages_dark" />
 		</shape>
 	</item>
 </selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/btn_border_light.xml b/OsmAnd/res/drawable/btn_border_light.xml
index 5c262a9204e..c4d6957187b 100644
--- a/OsmAnd/res/drawable/btn_border_light.xml
+++ b/OsmAnd/res/drawable/btn_border_light.xml
@@ -16,7 +16,7 @@
 		<shape android:shape="rectangle">
 			<solid android:color="@null" />
 			<corners android:radius="4dp" />
-			<stroke android:width="1dp" android:color="@color/divider_light" />
+			<stroke android:width="1dp" android:color="@color/profile_button_gray" />
 		</shape>
 	</item>
 </selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/dlg_btn_primary_dark.xml b/OsmAnd/res/drawable/dlg_btn_primary_dark.xml
new file mode 100644
index 00000000000..2d9f8c6b8ea
--- /dev/null
+++ b/OsmAnd/res/drawable/dlg_btn_primary_dark.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_pressed="true"><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_pressed_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/dlg_btn_primary_light.xml b/OsmAnd/res/drawable/dlg_btn_primary_light.xml
new file mode 100644
index 00000000000..40093d61a6f
--- /dev/null
+++ b/OsmAnd/res/drawable/dlg_btn_primary_light.xml
@@ -0,0 +1,16 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+	<item android:state_pressed="true"><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_pressed_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/dlg_btn_secondary_dark.xml b/OsmAnd/res/drawable/dlg_btn_secondary_dark.xml
new file mode 100644
index 00000000000..205ebb5648d
--- /dev/null
+++ b/OsmAnd/res/drawable/dlg_btn_secondary_dark.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_pressed="true"><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_pressed_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/dlg_btn_secondary_light.xml b/OsmAnd/res/drawable/dlg_btn_secondary_light.xml
new file mode 100644
index 00000000000..c0462bb4997
--- /dev/null
+++ b/OsmAnd/res/drawable/dlg_btn_secondary_light.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_pressed="true"><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_pressed_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<solid android:color="@color/profile_button_gray" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/dlg_btn_stroked_dark.xml b/OsmAnd/res/drawable/dlg_btn_stroked_dark.xml
new file mode 100644
index 00000000000..44e90cce2fe
--- /dev/null
+++ b/OsmAnd/res/drawable/dlg_btn_stroked_dark.xml
@@ -0,0 +1,18 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_pressed="true"><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_pressed_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<stroke android:color="@color/inactive_pages_dark" android:width="1dp" />
+		<solid android:color="@color/stroked_buttons_and_links_dark" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/dlg_btn_stroked_light.xml b/OsmAnd/res/drawable/dlg_btn_stroked_light.xml
new file mode 100644
index 00000000000..296ccb04b8b
--- /dev/null
+++ b/OsmAnd/res/drawable/dlg_btn_stroked_light.xml
@@ -0,0 +1,18 @@
+<?xml version="1.0" encoding="utf-8"?>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+
+	<item android:state_pressed="true"><shape android:shape="rectangle">
+		<solid android:color="@color/active_buttons_and_links_pressed_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item android:state_enabled="false"><shape android:shape="rectangle">
+		<solid android:color="@color/inactive_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+	<item><shape android:shape="rectangle">
+		<stroke android:color="@color/profile_button_gray" android:width="1dp" />
+		<solid android:color="@color/stroked_buttons_and_links_light" />
+		<corners android:radius="@dimen/dlg_button_rect_rad" />
+	</shape></item>
+
+</selector>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/pages_inactive_dark.xml b/OsmAnd/res/drawable/pages_inactive_dark.xml
index 7e245586aad..b7b8b9c887c 100644
--- a/OsmAnd/res/drawable/pages_inactive_dark.xml
+++ b/OsmAnd/res/drawable/pages_inactive_dark.xml
@@ -2,7 +2,7 @@
 <layer-list xmlns:android="http://schemas.android.com/apk/res/android">
 	<item>
 		<shape android:shape="oval">
-			<solid android:color="@color/inactive_buttons_and_links_dark"/>
+			<solid android:color="@color/inactive_pages_dark"/>
 		</shape>
 	</item>
 </layer-list>
diff --git a/OsmAnd/res/drawable/pages_inactive_light.xml b/OsmAnd/res/drawable/pages_inactive_light.xml
index ae481285848..1ea12897b27 100644
--- a/OsmAnd/res/drawable/pages_inactive_light.xml
+++ b/OsmAnd/res/drawable/pages_inactive_light.xml
@@ -2,7 +2,7 @@
 <layer-list xmlns:android="http://schemas.android.com/apk/res/android">
 	<item>
 		<shape android:shape="oval">
-			<solid android:color="@color/inactive_buttons_and_links_light"/>
+			<solid android:color="@color/inactive_pages_light"/>
 		</shape>
 	</item>
 </layer-list>
diff --git a/OsmAnd/res/drawable/ripple_solid_dark.xml b/OsmAnd/res/drawable/ripple_solid_dark.xml
new file mode 100644
index 00000000000..45178468dad
--- /dev/null
+++ b/OsmAnd/res/drawable/ripple_solid_dark.xml
@@ -0,0 +1,9 @@
+<ripple xmlns:android="http://schemas.android.com/apk/res/android"
+	android:color="@color/solid_ripple_color">
+	<item android:id="@android:id/mask">
+		<shape android:shape="rectangle">
+			<solid android:color="@color/active_buttons_and_links_dark" />
+			<corners android:radius="4dp" />
+		</shape>
+	</item>
+</ripple>
\ No newline at end of file
diff --git a/OsmAnd/res/drawable/ripple_solid_light.xml b/OsmAnd/res/drawable/ripple_solid_light.xml
new file mode 100644
index 00000000000..69270d496e0
--- /dev/null
+++ b/OsmAnd/res/drawable/ripple_solid_light.xml
@@ -0,0 +1,9 @@
+<ripple xmlns:android="http://schemas.android.com/apk/res/android"
+	android:color="@color/solid_ripple_color">
+	<item android:id="@android:id/mask">
+		<shape android:shape="rectangle">
+			<solid android:color="@color/active_buttons_and_links_light" />
+			<corners android:radius="4dp" />
+		</shape>
+	</item>
+</ripple>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/bottom_sheet_dialog_button.xml b/OsmAnd/res/layout/bottom_sheet_dialog_button.xml
new file mode 100644
index 00000000000..34dfd832f41
--- /dev/null
+++ b/OsmAnd/res/layout/bottom_sheet_dialog_button.xml
@@ -0,0 +1,29 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:tools="http://schemas.android.com/tools"
+	xmlns:osmand="http://schemas.android.com/apk/res-auto"
+	android:orientation="vertical"
+	android:layout_width="0dp"
+	android:layout_height="36dp"
+	android:layout_weight="1">
+
+	<LinearLayout
+		android:id="@+id/button_container"
+		android:layout_width="match_parent"
+		android:layout_height="match_parent"
+		tools:ignore="UselessParent">
+
+		<net.osmand.plus.widgets.TextViewEx
+			android:id="@+id/button_text"
+			android:layout_width="match_parent"
+			android:layout_height="match_parent"
+			android:paddingLeft="@dimen/content_padding_small"
+			android:paddingRight="@dimen/content_padding_small"
+			android:gravity="center"
+			android:textSize="@dimen/default_desc_text_size"
+			osmand:typeface="@string/font_roboto_medium"
+			tools:text="Button" />
+
+	</LinearLayout>
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/bottom_sheet_menu_base.xml b/OsmAnd/res/layout/bottom_sheet_menu_base.xml
index dc7ec4009f7..19aa0c91b7b 100644
--- a/OsmAnd/res/layout/bottom_sheet_menu_base.xml
+++ b/OsmAnd/res/layout/bottom_sheet_menu_base.xml
@@ -1,7 +1,5 @@
 <?xml version="1.0" encoding="utf-8"?>
-<LinearLayout
-	xmlns:android="http://schemas.android.com/apk/res/android"
-	xmlns:osmand="http://schemas.android.com/apk/res-auto"
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
 	xmlns:tools="http://schemas.android.com/tools"
 	android:layout_width="match_parent"
 	android:layout_height="wrap_content"
@@ -17,8 +15,7 @@
 			android:id="@+id/scrollable_items_container"
 			android:layout_width="match_parent"
 			android:layout_height="wrap_content"
-			android:orientation="vertical"
-			android:paddingBottom="@dimen/bottom_sheet_content_padding_small"/>
+			android:orientation="vertical" />
 
 	</ScrollView>
 
@@ -27,68 +24,33 @@
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
 		android:orientation="vertical"
-		android:visibility="gone"/>
-
-	<View
-		android:id="@+id/bottom_row_divider"
-		android:layout_width="match_parent"
-		android:layout_height="1dp"
-		android:background="?attr/dashboard_divider"/>
+		android:visibility="gone" />
 
 	<LinearLayout
 		android:id="@+id/buttons_container"
 		android:layout_width="match_parent"
-		android:layout_height="@dimen/bottom_sheet_cancel_button_height">
+		android:layout_height="@dimen/dialog_button_ex_height"
+		android:gravity="center"
+		android:orientation="horizontal"
+		android:paddingLeft="@dimen/content_padding"
+		android:paddingRight="@dimen/content_padding">
 
-		<FrameLayout
+		<include
 			android:id="@+id/dismiss_button"
-			android:layout_width="0dp"
-			android:layout_height="match_parent"
-			android:layout_weight="1"
-			android:background="?attr/selectableItemBackground">
-
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/dismiss_button_text"
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content"
-				android:layout_gravity="center"
-				android:textAllCaps="true"
-				android:textColor="?attr/color_dialog_buttons"
-				android:textSize="@dimen/default_desc_text_size"
-				osmand:typeface="@string/font_roboto_medium"
-				tools:text="Cancel"/>
-
-		</FrameLayout>
+			layout="@layout/bottom_sheet_dialog_button" />
 
 		<View
-			android:id="@+id/bottom_buttons_divider"
-			android:layout_width="1dp"
+			android:id="@+id/buttons_divider"
+			android:layout_width="@dimen/content_padding"
 			android:layout_height="match_parent"
-			android:background="?attr/dashboard_divider"
 			android:visibility="gone"
-			tools:visibility="visible"/>
+			tools:visibility="visible" />
 
-		<FrameLayout
+		<include
 			android:id="@+id/right_bottom_button"
-			android:layout_width="0dp"
-			android:layout_height="match_parent"
-			android:layout_weight="1"
-			android:background="?attr/selectableItemBackground"
+			layout="@layout/bottom_sheet_dialog_button"
 			android:visibility="gone"
-			tools:visibility="visible">
-
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/right_bottom_button_text"
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content"
-				android:layout_gravity="center"
-				android:textAllCaps="true"
-				android:textColor="?attr/color_dialog_buttons"
-				android:textSize="@dimen/default_desc_text_size"
-				osmand:typeface="@string/font_roboto_medium"
-				tools:text="Some Action"/>
-
-		</FrameLayout>
+			tools:visibility="visible" />
 
 	</LinearLayout>
 
diff --git a/OsmAnd/res/values/attrs.xml b/OsmAnd/res/values/attrs.xml
index 7bb8eeedbcf..ac66aeab23b 100644
--- a/OsmAnd/res/values/attrs.xml
+++ b/OsmAnd/res/values/attrs.xml
@@ -114,6 +114,11 @@
 		<attr name="card_and_list_background_basic" format="reference" />
 		<attr name="activity_background_basic" format="reference" />
 		<attr name="pages_bg" format="reference"/>
+		<attr name="dlg_btn_primary" format="reference" />
+		<attr name="dlg_btn_primary_text" format="reference" />
+		<attr name="dlg_btn_secondary" format="reference" />
+		<attr name="dlg_btn_secondary_text" format="reference" />
+		<attr name="dlg_btn_stroked" format="reference" />
 	</declare-styleable>
 
     <declare-styleable name="PagerSlidingTabStrip">
diff --git a/OsmAnd/res/values/colors.xml b/OsmAnd/res/values/colors.xml
index ffb81c8b218..e0d24ee9d8a 100644
--- a/OsmAnd/res/values/colors.xml
+++ b/OsmAnd/res/values/colors.xml
@@ -478,12 +478,25 @@
 	<color name="additional_description_light">#b3b3b3</color>
 	<color name="active_buttons_and_links_light">#237bff</color>
 	<color name="active_buttons_and_links_dark">#d28521</color>
-	<color name="inactive_buttons_and_links_light">#cccccc</color>
-	<color name="inactive_buttons_and_links_dark">#505050</color>
+	<color name="active_buttons_and_links_pressed_light">#0F67EB</color>
+	<color name="active_buttons_and_links_pressed_dark">#B87114</color>
+	<color name="inactive_buttons_and_links_light">#F0F0F0</color>
+	<color name="inactive_buttons_and_links_dark">#222526</color>
+	<color name="stroked_buttons_and_links_light">#ffffff</color>
+	<color name="stroked_buttons_and_links_dark">#17181A</color>
+	<color name="inactive_pages_light">#cccccc</color>
+	<color name="inactive_pages_dark">#505050</color>
 	<color name="active_buttons_and_links_trans_light">#66237bff</color>
 	<color name="active_buttons_and_links_trans_dark">#66d28521</color>
 	<color name="settings_divider">#dcdcdc</color>
 	<color name="profile_button_gray">#EFEFEF</color>
 	<color name="profile_button_gray_pressed">#ababab</color>
+	<color name="solid_ripple_color">#505050</color>
+
+	<color name="active_buttons_and_links_text_disabled_light">#727272</color>
+	<color name="active_buttons_and_links_text_disabled_dark">#727272</color>
+	<color name="active_buttons_and_links_text_light">#ffffff</color>
+	<color name="active_buttons_and_links_text_dark">#cccccc</color>
+
 
 </resources>
\ No newline at end of file
diff --git a/OsmAnd/res/values/sizes.xml b/OsmAnd/res/values/sizes.xml
index 23e00b16773..2b6b24f3b33 100644
--- a/OsmAnd/res/values/sizes.xml
+++ b/OsmAnd/res/values/sizes.xml
@@ -18,6 +18,7 @@
 	<dimen name="card_button_progress_size">32dp</dimen>
 	<dimen name="card_button_progress_size_small">24dp</dimen>
 	<dimen name="card_padding">12dp</dimen>
+	<dimen name="dlg_button_rect_rad">3dp</dimen>
 
 	<dimen name="widget_turn_lane_size">36dp</dimen>
 	<dimen name="widget_turn_lane_border">6dp</dimen>
diff --git a/OsmAnd/res/values/styles.xml b/OsmAnd/res/values/styles.xml
index 9e379e9ee59..814e17e0016 100644
--- a/OsmAnd/res/values/styles.xml
+++ b/OsmAnd/res/values/styles.xml
@@ -246,6 +246,11 @@
         <item name="card_and_list_background_basic">@color/card_and_list_background_light</item>
         <item name="activity_background_basic">@color/activity_background_light</item>
         <item name="pages_bg">@drawable/pages_bg_light</item>
+        <item name="dlg_btn_primary">@drawable/dlg_btn_primary_light</item>
+        <item name="dlg_btn_primary_text">@color/dlg_btn_primary_text_light</item>
+        <item name="dlg_btn_secondary">@drawable/dlg_btn_secondary_light</item>
+        <item name="dlg_btn_secondary_text">@color/dlg_btn_secondary_text_light</item>
+        <item name="dlg_btn_stroked">@drawable/dlg_btn_stroked_light</item>
     </style>
 
     <style name="OverflowMenuButton" parent="@style/Widget.AppCompat.ActionButton.Overflow">
@@ -478,6 +483,11 @@
         <item name="card_and_list_background_basic">@color/card_and_list_background_dark</item>
         <item name="activity_background_basic">@color/activity_background_dark</item>
         <item name="pages_bg">@drawable/pages_bg_dark</item>
+        <item name="dlg_btn_primary">@drawable/dlg_btn_primary_dark</item>
+        <item name="dlg_btn_primary_text">@color/dlg_btn_primary_text_dark</item>
+        <item name="dlg_btn_secondary">@drawable/dlg_btn_secondary_dark</item>
+        <item name="dlg_btn_secondary_text">@color/dlg_btn_secondary_text_dark</item>
+        <item name="dlg_btn_stroked">@drawable/dlg_btn_stroked_dark</item>
     </style>
 
     <style name="FreeVersionBanner" parent="OsmandDarkTheme">
diff --git a/OsmAnd/src/net/osmand/plus/base/BottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/base/BottomSheetDialogFragment.java
index 1e8714aec60..8912cf3bebc 100644
--- a/OsmAnd/src/net/osmand/plus/base/BottomSheetDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/base/BottomSheetDialogFragment.java
@@ -75,6 +75,11 @@ protected OsmandApplication getMyApplication() {
 		}
 	}
 
+	@NonNull
+	protected OsmandApplication requiredMyApplication() {
+		return (OsmandApplication) requireActivity().getApplication();
+	}
+
 	@Nullable
 	protected Drawable getIcon(@DrawableRes int drawableRes, @ColorRes int color) {
 		OsmandApplication app = getMyApplication();
diff --git a/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java
index 3d08f869b44..35bd35a3504 100644
--- a/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java
@@ -1,6 +1,7 @@
 package net.osmand.plus.base;
 
 import android.app.Activity;
+import android.content.Context;
 import android.graphics.drawable.Drawable;
 import android.os.Build;
 import android.os.Bundle;
@@ -10,6 +11,7 @@
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 import android.support.annotation.StringRes;
+import android.support.v4.app.FragmentActivity;
 import android.support.v4.content.ContextCompat;
 import android.view.ContextThemeWrapper;
 import android.view.LayoutInflater;
@@ -19,13 +21,13 @@
 import android.view.Window;
 import android.view.WindowManager;
 import android.widget.LinearLayout;
-import android.widget.TextView;
 
 import net.osmand.AndroidUtils;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.widgets.TextViewEx;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -44,6 +46,12 @@ public abstract class MenuBottomSheetDialogFragment extends BottomSheetDialogFra
 
 	private LinearLayout itemsContainer;
 
+	public enum DialogButtonType {
+		PRIMARY,
+		SECONDARY,
+		STROKED
+	}
+
 	@StringRes
 	protected int dismissButtonStringRes = R.string.shared_string_cancel;
 
@@ -57,7 +65,7 @@ public void onCreate(Bundle savedInstanceState) {
 		if (savedInstanceState != null) {
 			usedOnMap = savedInstanceState.getBoolean(USED_ON_MAP_KEY);
 		}
-		nightMode = isNightMode();
+		nightMode = isNightMode(requiredMyApplication());
 		themeRes = nightMode ? R.style.OsmandDarkTheme : R.style.OsmandLightTheme;
 	}
 
@@ -65,10 +73,8 @@ public void onCreate(Bundle savedInstanceState) {
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup parent, Bundle savedInstanceState) {
 		createMenuItems(savedInstanceState);
-
-		OsmandApplication app = getMyApplication();
-
-		View mainView = View.inflate(new ContextThemeWrapper(app, themeRes), R.layout.bottom_sheet_menu_base, null);
+		Context ctx = requireContext();
+		View mainView = View.inflate(new ContextThemeWrapper(ctx, themeRes), R.layout.bottom_sheet_menu_base, null);
 		if (useScrollableItemsContainer()) {
 			itemsContainer = (LinearLayout) mainView.findViewById(R.id.scrollable_items_container);
 		} else {
@@ -79,12 +85,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup parent, Bun
 
 		inflateMenuItems();
 
-		int bottomDividerColorId = getBottomDividerColorId();
-		if (bottomDividerColorId != DEFAULT_VALUE) {
-			mainView.findViewById(R.id.bottom_row_divider).setBackgroundColor(getResolvedColor(bottomDividerColorId));
-		}
-
-		mainView.findViewById(R.id.dismiss_button).setOnClickListener(new View.OnClickListener() {
+		View dismissButton = mainView.findViewById(R.id.dismiss_button);
+		setupDialogButton(dismissButton, DialogButtonType.STROKED, getDismissButtonTextId());
+		dismissButton.setOnClickListener(new View.OnClickListener() {
 			@Override
 			public void onClick(View v) {
 				onDismissButtonClickAction();
@@ -92,19 +95,13 @@ public void onClick(View v) {
 			}
 		});
 		if (hideButtonsContainer()) {
-			mainView.findViewById(R.id.bottom_row_divider).setVisibility(View.GONE);
 			mainView.findViewById(R.id.buttons_container).setVisibility(View.GONE);
 		} else {
-			((TextView) mainView.findViewById(R.id.dismiss_button_text)).setText(getDismissButtonTextId());
-
 			int rightBottomButtonTextId = getRightBottomButtonTextId();
 			if (rightBottomButtonTextId != DEFAULT_VALUE) {
-				View buttonsDivider = mainView.findViewById(R.id.bottom_buttons_divider);
-				buttonsDivider.setVisibility(View.VISIBLE);
-				if (bottomDividerColorId != DEFAULT_VALUE) {
-					buttonsDivider.setBackgroundColor(getResolvedColor(bottomDividerColorId));
-				}
+				mainView.findViewById(R.id.buttons_divider).setVisibility(View.VISIBLE);
 				View rightButton = mainView.findViewById(R.id.right_bottom_button);
+				setupDialogButton(rightButton, DialogButtonType.PRIMARY, rightBottomButtonTextId);
 				rightButton.setVisibility(View.VISIBLE);
 				rightButton.setOnClickListener(new View.OnClickListener() {
 					@Override
@@ -112,23 +109,23 @@ public void onClick(View v) {
 						onRightBottomButtonClick();
 					}
 				});
-				((TextView) rightButton.findViewById(R.id.right_bottom_button_text)).setText(rightBottomButtonTextId);
 			}
 		}
-
 		setupHeightAndBackground(mainView);
-
 		return mainView;
 	}
 
 	@Override
 	public void onStart() {
 		super.onStart();
-		if (!AndroidUiHelper.isOrientationPortrait(getActivity())) {
+		FragmentActivity activity = requireActivity();
+		if (!AndroidUiHelper.isOrientationPortrait(activity)) {
 			final Window window = getDialog().getWindow();
-			WindowManager.LayoutParams params = window.getAttributes();
-			params.width = getActivity().getResources().getDimensionPixelSize(R.dimen.landscape_bottom_sheet_dialog_fragment_width);
-			window.setAttributes(params);
+			if (window != null) {
+				WindowManager.LayoutParams params = window.getAttributes();
+				params.width = activity.getResources().getDimensionPixelSize(R.dimen.landscape_bottom_sheet_dialog_fragment_width);
+				window.setAttributes(params);
+			}
 		}
 	}
 
@@ -147,9 +144,41 @@ public void onDestroyView() {
 		}
 	}
 
+	private void setupDialogButton(View buttonView, DialogButtonType buttonType, @StringRes int buttonTextId) {
+		Context ctx = buttonView.getContext();
+		TextViewEx buttonTextView = (TextViewEx) buttonView.findViewById(R.id.button_text);
+		boolean v21 = Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP;
+		View buttonContainer = buttonView.findViewById(R.id.button_container);
+		switch (buttonType) {
+			case PRIMARY:
+				if (v21) {
+					AndroidUtils.setBackground(ctx, buttonContainer, nightMode, R.drawable.ripple_solid_light, R.drawable.ripple_solid_dark);
+				}
+				AndroidUtils.setBackground(ctx, buttonView, nightMode, R.drawable.dlg_btn_primary_light, R.drawable.dlg_btn_primary_dark);
+				buttonTextView.setTextColor(ContextCompat.getColorStateList(ctx, nightMode ? R.color.dlg_btn_primary_text_dark : R.color.dlg_btn_primary_text_light));
+				break;
+			case SECONDARY:
+				if (v21) {
+					AndroidUtils.setBackground(ctx, buttonContainer, nightMode, R.drawable.ripple_solid_light, R.drawable.ripple_solid_dark);
+				}
+				AndroidUtils.setBackground(ctx, buttonView, nightMode, R.drawable.dlg_btn_secondary_light, R.drawable.dlg_btn_secondary_dark);
+				buttonTextView.setTextColor(ContextCompat.getColorStateList(ctx, nightMode ? R.color.dlg_btn_secondary_text_dark : R.color.dlg_btn_secondary_text_light));
+				break;
+			case STROKED:
+				if (v21) {
+					AndroidUtils.setBackground(ctx, buttonContainer, nightMode, R.drawable.ripple_light, R.drawable.ripple_dark);
+				}
+				AndroidUtils.setBackground(ctx, buttonView, nightMode, R.drawable.dlg_btn_stroked_light, R.drawable.dlg_btn_stroked_dark);
+				buttonTextView.setTextColor(ContextCompat.getColorStateList(ctx, nightMode ? R.color.dlg_btn_secondary_text_dark : R.color.dlg_btn_secondary_text_light));
+				break;
+		}
+		buttonTextView.setText(buttonTextId);
+		buttonTextView.setEnabled(buttonView.isEnabled());
+	}
+
 	public abstract void createMenuItems(Bundle savedInstanceState);
 
-	protected void inflateMenuItems(){
+	protected void inflateMenuItems() {
 		OsmandApplication app = getMyApplication();
 		for (BaseBottomSheetItem item : items) {
 			item.inflate(app, itemsContainer, nightMode);
@@ -172,7 +201,8 @@ protected int getActiveColorId() {
 
 	@ColorInt
 	protected int getResolvedColor(@ColorRes int colorId) {
-		return ContextCompat.getColor(getContext(), colorId);
+		Context ctx = getContext();
+		return ctx != null ? ContextCompat.getColor(ctx, colorId) : 0;
 	}
 
 	protected void setupHeightAndBackground(final View mainView) {
@@ -187,6 +217,13 @@ protected void setupHeightAndBackground(final View mainView) {
 		mainView.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
 			@Override
 			public void onGlobalLayout() {
+				ViewTreeObserver obs = mainView.getViewTreeObserver();
+				if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {
+					obs.removeOnGlobalLayoutListener(this);
+				} else {
+					obs.removeGlobalOnLayoutListener(this);
+				}
+
 				final View contentView = useScrollableItemsContainer() ? mainView.findViewById(R.id.scroll_view) : itemsContainer;
 				if (contentView.getHeight() > contentHeight) {
 					if (useScrollableItemsContainer()) {
@@ -207,22 +244,13 @@ public void onGlobalLayout() {
 				} else {
 					mainView.setBackgroundResource(showTopShadow ? getLandscapeTopsidesBgResId() : getLandscapeSidesBgResId());
 				}
-
-				ViewTreeObserver obs = mainView.getViewTreeObserver();
-				if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {
-					obs.removeOnGlobalLayoutListener(this);
-				} else {
-					obs.removeGlobalOnLayoutListener(this);
-				}
 			}
 		});
 	}
 
 	private int getContentHeight(int availableScreenHeight) {
 		int customHeight = getCustomHeight();
-		int maxHeight = availableScreenHeight
-				- AndroidUtils.dpToPx(getContext(), 1) // divider height
-				- getResources().getDimensionPixelSize(R.dimen.bottom_sheet_cancel_button_height);
+		int maxHeight = availableScreenHeight - getResources().getDimensionPixelSize(R.dimen.dialog_button_ex_height);
 		if (customHeight != DEFAULT_VALUE && customHeight <= maxHeight) {
 			return customHeight;
 		}
@@ -242,7 +270,7 @@ protected boolean hideButtonsContainer() {
 	}
 
 	@ColorRes
-	protected int getBottomDividerColorId() {
+	protected int getDividerColorId() {
 		return DEFAULT_VALUE;
 	}
 
@@ -288,10 +316,10 @@ protected int getLandscapeSidesBgResId() {
 		return nightMode ? R.drawable.bg_bottom_sheet_sides_landscape_dark : R.drawable.bg_bottom_sheet_sides_landscape_light;
 	}
 
-	private boolean isNightMode() {
+	private boolean isNightMode(@NonNull OsmandApplication app) {
 		if (usedOnMap) {
-			return getMyApplication().getDaynightHelper().isNightModeForMapControls();
+			return app.getDaynightHelper().isNightModeForMapControls();
 		}
-		return !getMyApplication().getSettings().isLightContent();
+		return !app.getSettings().isLightContent();
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/dialogs/AddWaypointBottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/dialogs/AddWaypointBottomSheetDialogFragment.java
index e619f9f5314..f5b3935cb41 100644
--- a/OsmAnd/src/net/osmand/plus/dialogs/AddWaypointBottomSheetDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/dialogs/AddWaypointBottomSheetDialogFragment.java
@@ -70,7 +70,7 @@ public void onClick(View v) {
 				.create();
 		items.add(replaceStartItem);
 
-		items.add(new DividerHalfItem(getContext(), getBottomDividerColorId()));
+		items.add(new DividerHalfItem(getContext(), getDividerColorId()));
 
 		BaseBottomSheetItem subsequentDestItem = new BottomSheetItemWithDescription.Builder()
 				.setDescription(getString(R.string.subsequent_dest_description))
@@ -130,7 +130,7 @@ public void onDismiss(DialogInterface dialog) {
 	}
 
 	@Override
-	protected int getBottomDividerColorId() {
+	protected int getDividerColorId() {
 		return nightMode ? R.color.route_info_bottom_view_bg_dark : -1;
 	}
 
