diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/DisplayGroupsBottomSheet.java b/OsmAnd/src/net/osmand/plus/track/fragments/DisplayGroupsBottomSheet.java
index 7034b7a2e60..b3ce1baae8c 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/DisplayGroupsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/DisplayGroupsBottomSheet.java
@@ -111,7 +111,7 @@ private void initSelectableItems() {
 
 	private void updateStateButton() {
 		TextView title = stateButton.findViewById(R.id.state_button_text);
-		if (isAnyVisible()) {
+		if (isAnyGroupVisible()) {
 			title.setText(R.string.shared_string_hide_all);
 		} else {
 			title.setText(R.string.shared_string_show_all);
@@ -148,7 +148,7 @@ private void updateListItems() {
 
 	private void setupStateButton() {
 		stateButton.setOnClickListener(view -> {
-			boolean newState = !isAnyVisible();
+			boolean newState = !isAnyGroupVisible();
 			for (String groupName : getGroupsNames()) {
 				updateGroupVisibility(groupName, newState);
 			}
@@ -178,14 +178,13 @@ private List<String> getGroupsNames() {
 
 	private void fullUpdate() {
 		updateStateButton();
-		updateSizeView();
+		updateGroupsNumberRatio();
 		updateList();
 	}
 
-	private void updateSizeView() {
+	private void updateGroupsNumberRatio() {
+		int visibleCount = getVisibleGroupsNumber();
 		int totalCount = uiItems.size();
-		int hiddenCount = selectedGpxFile.getHiddenGroups().size();
-		int visibleCount = totalCount - hiddenCount;
 		String description = getString(
 				R.string.ltr_or_rtl_combine_via_slash,
 				String.valueOf(visibleCount),
@@ -218,13 +217,21 @@ private void updateList() {
 		}
 	}
 
-	private boolean isAnyVisible() {
-		for (String groupName : getGroupsNames()) {
-			if (!selectedGpxFile.isGroupHidden(groupName)) {
-				return true;
+	private int getVisibleGroupsNumber() {
+		int visibleGroupsCount = 0;
+		for (SelectableItem selectableItem : uiItems) {
+			GpxDisplayGroup group = selectableItem.getObject() instanceof GpxDisplayGroup
+					? ((GpxDisplayGroup) selectableItem.getObject())
+					: null;
+			if (group != null && !selectedGpxFile.isGroupHidden(group.getName())) {
+				visibleGroupsCount++;
 			}
 		}
-		return false;
+		return visibleGroupsCount;
+	}
+
+	private boolean isAnyGroupVisible() {
+		return getVisibleGroupsNumber() > 0;
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/TrackMenuFragment.java b/OsmAnd/src/net/osmand/plus/track/fragments/TrackMenuFragment.java
index dd058c71bd4..3ce6c2f10e8 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/TrackMenuFragment.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/TrackMenuFragment.java
@@ -661,9 +661,8 @@ public void updateDisplayGroupsWidget() {
 		if (widgetVisible) {
 			DisplayGroupsHolder displayGroupsHolder =
 					DisplayPointsGroupsHelper.getGroups(app, displayHelper.getPointsOriginalGroups(), null);
+			int visible = displayGroupsHolder.getVisibleGroupsNumber(selectedGpxFile);
 			int total = displayGroupsHolder.groups.size();
-			int hidden = selectedGpxFile.getHiddenGroups().size();
-			int visible = total - hidden;
 			TextView indication = displayGroupsWidget.findViewById(R.id.visible_display_groups_size);
 			indication.setText(getString(
 					R.string.ltr_or_rtl_combine_via_slash,
diff --git a/OsmAnd/src/net/osmand/plus/track/helpers/DisplayPointsGroupsHelper.java b/OsmAnd/src/net/osmand/plus/track/helpers/DisplayPointsGroupsHelper.java
index 61244eff5c6..b69ea372262 100644
--- a/OsmAnd/src/net/osmand/plus/track/helpers/DisplayPointsGroupsHelper.java
+++ b/OsmAnd/src/net/osmand/plus/track/helpers/DisplayPointsGroupsHelper.java
@@ -9,6 +9,7 @@
 import net.osmand.plus.track.helpers.GpxSelectionHelper.GpxDisplayItemType;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
+import net.osmand.plus.track.helpers.GpxSelectionHelper.SelectedGpxFile;
 import net.osmand.util.Algorithms;
 
 import java.util.ArrayList;
@@ -167,5 +168,15 @@ public List<GpxDisplayItem> getItemsByGroupName(@NonNull String name) {
 			}
 			return null;
 		}
+
+		public int getVisibleGroupsNumber(@NonNull SelectedGpxFile selectedGpxFile) {
+			int visibleGroupsNumber = 0;
+			for (GpxDisplayGroup group : itemGroups.keySet()) {
+				if (!selectedGpxFile.isGroupHidden(group.getName())) {
+					visibleGroupsNumber++;
+				}
+			}
+			return visibleGroupsNumber;
+		}
 	}
 }
