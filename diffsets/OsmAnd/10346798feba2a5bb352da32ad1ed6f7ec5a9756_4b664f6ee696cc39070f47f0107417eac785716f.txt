diff --git a/OsmAnd/res/xml/global_settings.xml b/OsmAnd/res/xml/global_settings.xml
index 0ea38d00190..6edd48ef4d2 100644
--- a/OsmAnd/res/xml/global_settings.xml
+++ b/OsmAnd/res/xml/global_settings.xml
@@ -15,12 +15,12 @@
 		android:layout="@layout/preference_with_descr"
 		android:title="@string/preferred_locale" />
 
-<!--	<Preference-->
-<!--		android:icon="@drawable/ic_action_folder"-->
-<!--		android:key="external_storage_dir"-->
-<!--		android:layout="@layout/preference_with_descr"-->
-<!--		android:persistent="false"-->
-<!--		android:title="@string/application_dir" />-->
+	<Preference
+		android:key="external_storage_dir"
+		android:layout="@layout/preference_with_descr"
+		android:persistent="false"
+		android:title="@string/application_dir"
+		tools:icon="@drawable/ic_action_folder" />
 
 	<PreferenceCategory
 		android:key="privacy_and_security"
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
index 05acbfe3e29..4aed489c703 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
@@ -1944,7 +1944,7 @@ public boolean onPreferenceStartFragment(PreferenceFragmentCompat caller, Prefer
 				Fragment fragment = Fragment.instantiate(this, fragmentName);
 
 				getSupportFragmentManager().beginTransaction()
-						.add(R.id.fragmentContainer, fragment, fragmentName)
+						.replace(R.id.fragmentContainer, fragment, fragmentName)
 						.addToBackStack(fragmentName)
 						.commitAllowingStateLoss();
 
diff --git a/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java
index 286dba097b8..ae57d4fe2bc 100644
--- a/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java
@@ -58,7 +58,6 @@ public abstract class BaseSettingsFragment extends PreferenceFragmentCompat impl
 	protected OsmandApplication app;
 	protected OsmandSettings settings;
 	protected UiUtilities iconsCache;
-	protected List<ApplicationMode> modes = new ArrayList<ApplicationMode>();
 
 	private boolean nightMode;
 	private boolean wasDrawerDisabled;
@@ -67,20 +66,19 @@ public abstract class BaseSettingsFragment extends PreferenceFragmentCompat impl
 	public void onCreate(Bundle savedInstanceState) {
 		app = requireMyApplication();
 		settings = app.getSettings();
-		nightMode = !settings.isLightContent();
 		super.onCreate(savedInstanceState);
-		modes.clear();
-		modes.addAll(ApplicationMode.values(app));
 	}
 
 	@Override
 	public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
-		View view = super.onCreateView(inflater, container, savedInstanceState);
+		nightMode = !settings.isLightContent();
 
+		View view = super.onCreateView(inflater, container, savedInstanceState);
 		if (view != null) {
 			AndroidUtils.addStatusBarPadding21v(getContext(), view);
 			createToolbar(inflater, view);
 			setDivider(null);
+			updateAllSettings();
 		}
 
 		return view;
@@ -89,6 +87,7 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle sa
 	@Override
 	public void onResume() {
 		super.onResume();
+
 		MapActivity mapActivity = getMapActivity();
 		if (mapActivity != null) {
 			wasDrawerDisabled = mapActivity.isDrawerDisabled();
@@ -114,7 +113,7 @@ private void createToolbar(LayoutInflater inflater, View view) {
 		if (toolbarRes != -1) {
 			Context activityContext = getActivity();
 
-			final int themeRes = nightMode ? darkTheme : lightTheme;
+			final int themeRes = nightMode ? R.style.OsmandDarkTheme : R.style.OsmandLightTheme;
 			final Context themedContext = new ContextThemeWrapper(activityContext, themeRes);
 			LayoutInflater themedInflater = LayoutInflater.from(themedContext);
 
@@ -176,22 +175,17 @@ private void updateToolbar(View view) {
 		view.setBackgroundColor(ContextCompat.getColor(app, getBackgroundColor()));
 	}
 
-	int darkTheme = R.style.OsmandDarkTheme;
-	int lightTheme = R.style.OsmandLightTheme;
-
 	@Override
 	public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {
 		getPreferenceManager().setPreferenceDataStore(settings.getDataStore());
-		updatePreferencesScreen();
 	}
 
 	@Override
 	public RecyclerView onCreateRecyclerView(LayoutInflater inflater, ViewGroup parent, Bundle savedInstanceState) {
-		Context activityContext = getActivity();
 
-		final int themeRes = nightMode ? darkTheme : lightTheme;
+		Context activityContext = getActivity();
+		final int themeRes = nightMode ? R.style.OsmandDarkTheme : R.style.OsmandLightTheme;
 		final Context themedContext = new ContextThemeWrapper(activityContext, themeRes);
-
 		LayoutInflater themedInflater = LayoutInflater.from(themedContext);
 
 		return super.onCreateRecyclerView(themedInflater, parent, savedInstanceState);
@@ -253,7 +247,7 @@ public void onClick(DialogInterface dialog, int which) {
 		singleSelectDialogBuilder.setAdapter(modeNames, new DialogInterface.OnClickListener() {
 			@Override
 			public void onClick(DialogInterface dialog, int which) {
-				ApplicationMode selectedAppMode = modes.get(which);
+				ApplicationMode selectedAppMode = ApplicationMode.values(app).get(which);
 				requireSettings().APPLICATION_MODE.set(selectedAppMode);
 				updateAllSettings();
 			}
@@ -278,7 +272,10 @@ private String getAppModeDescription(ApplicationMode mode) {
 
 	public void updateAllSettings() {
 		getListView().getRecycledViewPool().clear();
-		getPreferenceScreen().removeAll();
+		PreferenceScreen screen = getPreferenceScreen();
+		if (screen != null) {
+			getPreferenceScreen().removeAll();
+		}
 		updatePreferencesScreen();
 		updateToolbar(getView());
 	}
diff --git a/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java b/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java
index 3d169e62624..2d07367c01f 100644
--- a/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/ConfigureProfileFragment.java
@@ -125,7 +125,7 @@ private void setupOsmandPluginsPref() {
 
 	private Drawable getPluginIcon(OsmandPlugin plugin) {
 		int iconResId = plugin.getLogoResourceId();
-		return plugin.isActive() ? getActiveIcon(iconResId) : getContentIcon(iconResId);
+		return plugin.isActive() ? getActiveIcon(iconResId) : getIcon(iconResId, isNightMode() ? R.color.icon_color_secondary_dark : R.color.icon_color_secondary_light);
 	}
 
 	private Intent getPluginIntent(OsmandPlugin plugin) {
diff --git a/OsmAnd/src/net/osmand/plus/settings/GlobalSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/GlobalSettingsFragment.java
index f8472e81b8d..04629a829ce 100644
--- a/OsmAnd/src/net/osmand/plus/settings/GlobalSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/GlobalSettingsFragment.java
@@ -9,6 +9,7 @@
 
 import net.osmand.plus.ApplicationMode;
 import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.OsmandSettings;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.SettingsGeneralActivity;
 import net.osmand.plus.dialogs.SendAnalyticsBottomSheetDialogFragment;
@@ -41,7 +42,7 @@ protected String getToolbarTitle() {
 	protected void setupPreferences() {
 		setupDefaultAppModePref();
 		setupPreferredLocalePref();
-//		setupExternalStorageDirPref();
+		setupExternalStorageDirPref();
 
 		setupSendAnonymousDataPref();
 		setupEnableProxyPref();
@@ -147,6 +148,12 @@ private void setupPreferredLocalePref() {
 		}
 	}
 
+	private void setupExternalStorageDirPref() {
+		Preference externalStorageDir = (Preference) findPreference(OsmandSettings.EXTERNAL_STORAGE_DIR);
+		externalStorageDir.setIcon(getContentIcon(R.drawable.ic_action_folder));
+
+	}
+
 	private void setupSendAnonymousDataPref() {
 		boolean enabled = settings.SEND_ANONYMOUS_MAP_DOWNLOADS_DATA.get() || settings.SEND_ANONYMOUS_APP_USAGE_DATA.get();
 
