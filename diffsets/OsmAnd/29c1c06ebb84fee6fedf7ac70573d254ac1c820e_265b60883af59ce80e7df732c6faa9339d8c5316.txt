diff --git a/OsmAnd/res/layout/fragment_configure_map.xml b/OsmAnd/res/layout/fragment_configure_map.xml
index f08a35c8745..2bf55b62542 100644
--- a/OsmAnd/res/layout/fragment_configure_map.xml
+++ b/OsmAnd/res/layout/fragment_configure_map.xml
@@ -16,7 +16,6 @@
 		android:id="@+id/list"
 		android:layout_width="match_parent"
 		android:layout_height="match_parent"
-		android:background="?attr/activity_background_color"
 		android:orientation="vertical" />
 
 </LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
index 06db42e6d03..f52f21dd122 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
@@ -68,6 +68,7 @@
 import net.osmand.plus.base.ContextMenuFragment;
 import net.osmand.plus.base.FailSafeFuntions;
 import net.osmand.plus.base.MapViewTrackingUtilities;
+import net.osmand.plus.configmap.ConfigureMapFragment;
 import net.osmand.plus.dashboard.DashBaseFragment;
 import net.osmand.plus.dashboard.DashboardOnMap;
 import net.osmand.plus.dialogs.CrashBottomSheetDialogFragment;
@@ -1316,7 +1317,7 @@ public void updateApplicationModeSettings() {
 		getMapView().refreshMap(true);
 		applyScreenOrientation();
 		app.getAppCustomization().updateMapMargins(this);
-		dashboardOnMap.onApplicationModeSettingsUpdated();
+		dashboardOnMap.onAppModeChanged();
 	}
 
 	public void updateNavigationBarColor() {
@@ -1332,10 +1333,10 @@ public void updateMapSettings() {
 			UpdateVectorRendererAsyncTask task = new UpdateVectorRendererAsyncTask(app, changed -> {
 				if (changed) {
 					OsmandPlugin.registerRenderingPreferences(app);
-				}
-				DashboardOnMap dashboard = getDashboard();
-				if (dashboard != null) {
-					dashboard.onMapSettingsUpdated();
+					ConfigureMapFragment cm = ConfigureMapFragment.getVisibleInstance(this);
+					if (cm != null) {
+						cm.onMapStyleChanged();
+					}
 				}
 				return true;
 			});
diff --git a/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java b/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java
index 5b257bfd7d0..88acbca8409 100644
--- a/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java
+++ b/OsmAnd/src/net/osmand/plus/activities/actions/AppModeDialog.java
@@ -4,7 +4,6 @@
 import android.content.Context;
 import android.graphics.drawable.Drawable;
 import android.os.Build;
-import android.os.Build.VERSION_CODES;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
@@ -17,12 +16,12 @@
 import androidx.annotation.LayoutRes;
 import androidx.core.content.ContextCompat;
 
-import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.UiUtilities;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -76,11 +75,7 @@ public void onGlobalLayout() {
 				LinearLayout container = ll.findViewById(R.id.app_modes_content);
 				int s = container.getChildAt(idx) != null ? container.getChildAt(idx).getRight() : 0;
 				scrollView.scrollTo(Math.max(s - scrollView.getWidth(), 0), 0);
-				if (Build.VERSION.SDK_INT >= VERSION_CODES.JELLY_BEAN) {
-					ll.getViewTreeObserver().removeOnGlobalLayoutListener(this);
-				} else {
-					ll.getViewTreeObserver().removeGlobalOnLayoutListener(this);
-				}
+				ll.getViewTreeObserver().removeOnGlobalLayoutListener(this);
 			}
 		};
 		ll.getViewTreeObserver().addOnGlobalLayoutListener(globalListener);
diff --git a/OsmAnd/src/net/osmand/plus/configmap/CategoryAnimator.java b/OsmAnd/src/net/osmand/plus/configmap/CategoryAnimator.java
index a0510d5a9c4..ae9b4f5a64c 100644
--- a/OsmAnd/src/net/osmand/plus/configmap/CategoryAnimator.java
+++ b/OsmAnd/src/net/osmand/plus/configmap/CategoryAnimator.java
@@ -153,7 +153,7 @@ private void onMainAnimationFinished() {
 		AndroidUiHelper.updateVisibility(tvDescription, !isExpanding);
 		AndroidUiHelper.updateVisibility(itemsContainer, isExpanding);
 
-		// Items container height to wrap content
+		// Set items container height as WRAP_CONTENT
 		LayoutParams params = itemsContainer.getLayoutParams();
 		params.height = LayoutParams.WRAP_CONTENT;
 		itemsContainer.setLayoutParams(params);
diff --git a/OsmAnd/src/net/osmand/plus/configmap/ConfigureMapFragment.java b/OsmAnd/src/net/osmand/plus/configmap/ConfigureMapFragment.java
index 0aaf690c839..7db3844ca8e 100644
--- a/OsmAnd/src/net/osmand/plus/configmap/ConfigureMapFragment.java
+++ b/OsmAnd/src/net/osmand/plus/configmap/ConfigureMapFragment.java
@@ -24,6 +24,7 @@
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.backend.preferences.ListStringPreference;
 import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.widgets.ctxmenu.ContextMenuAdapter;
 import net.osmand.plus.widgets.ctxmenu.CtxMenuUtils;
@@ -38,6 +39,8 @@
 import java.util.Map;
 import java.util.Objects;
 
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.MAP_STYLE_ID;
+
 public class ConfigureMapFragment extends BaseOsmAndFragment implements OnDataChangeUiAdapter {
 
 	public static final String TAG = ConfigureMapFragment.class.getSimpleName();
@@ -46,15 +49,18 @@ public class ConfigureMapFragment extends BaseOsmAndFragment implements OnDataCh
 	private MapActivity mapActivity;
 	private OsmandSettings settings;
 	private ApplicationMode appMode;
+
+	private ContextMenuAdapter adapter;
+	private Map<ContextMenuItem, List<ContextMenuItem>> menuItems;
 	private ViewCreator viewCreator;
-	private Map<ContextMenuItem, List<ContextMenuItem>> items;
-	private boolean nightMode;
-	private boolean useAnimation;
 
-	private final Map<Integer, View> views = new HashMap<>();
 	private LinearLayout llList;
 	private ListStringPreference collapsedIds;
 	private View.OnClickListener itemsClickListener;
+	private final Map<Integer, View> views = new HashMap<>();
+
+	private boolean nightMode;
+	private boolean useAnimation;
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
@@ -70,39 +76,59 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 	public View onCreateView(@NonNull LayoutInflater inflater,
 	                         @Nullable ViewGroup container,
 	                         @Nullable Bundle savedInstanceState) {
+		View view = inflater.inflate(R.layout.fragment_configure_map, container, false);
+		llList = view.findViewById(R.id.list);
+		onDataSetInvalidated();
+		return view;
+	}
+
+	@Override
+	public void onDataSetChanged() {
+		updateItemsData();
+		updateItemsView();
+	}
+
+	@Override
+	public void onDataSetInvalidated() {
+		recreateView();
+	}
+
+	private void recreateView() {
 		appMode = settings.getApplicationMode();
 		nightMode = app.getDaynightHelper().isNightModeForMapControls();
 		useAnimation = !settings.DO_NOT_USE_ANIMATIONS.getModeValue(appMode);
-		inflater = UiUtilities.getInflater(getContext(), nightMode);
-		View view = inflater.inflate(R.layout.fragment_configure_map, container, false);
 
 		viewCreator = new ViewCreator(requireActivity(), nightMode);
 		viewCreator.setDefaultLayoutId(R.layout.list_item_icon_and_menu);
 		viewCreator.setCustomControlsColor(appMode.getProfileColor(nightMode));
 		viewCreator.setUiAdapter(this);
 
-		llList = view.findViewById(R.id.list);
-		updateList(true);
-		return view;
+		int bgColor = ColorUtilities.getActivityBgColor(app, nightMode);
+		llList.setBackgroundColor(bgColor);
+
+		views.clear();
+		llList.removeAllViews();
+		updateItemsData();
+		updateItemsView();
 	}
 
-	private void updateList(boolean reset) {
-		if (reset) {
-			ConfigureMapMenu menu = new ConfigureMapMenu();
-			ContextMenuAdapter adapter = menu.createListAdapter(mapActivity);
-			CtxMenuUtils.removeHiddenItems(adapter);
-			CtxMenuUtils.hideExtraDividers(adapter);
-			items = CtxMenuUtils.collectItemsByCategories(adapter.getItems());
-			ContextMenuItem bottomShadow = new ContextMenuItem(null).setLayout(R.layout.card_bottom_divider);
-			items.put(bottomShadow, null);
-			views.clear();
-			llList.removeAllViews();
-		}
+	private void updateItemsData() {
+		ConfigureMapMenu menu = new ConfigureMapMenu();
+		adapter = menu.createListAdapter(mapActivity);
+		CtxMenuUtils.removeHiddenItems(adapter);
+		CtxMenuUtils.hideExtraDividers(adapter);
+		menuItems = CtxMenuUtils.collectItemsByCategories(adapter.getItems());
 
-		for (ContextMenuItem topItem : items.keySet()) {
-			List<ContextMenuItem> nestedItems = items.get(topItem);
+		ContextMenuItem bottomShadow = new ContextMenuItem(null);
+		bottomShadow.setLayout(R.layout.card_bottom_divider);
+		menuItems.put(bottomShadow, null);
+	}
+
+	private void updateItemsView() {
+		for (ContextMenuItem topItem : menuItems.keySet()) {
+			List<ContextMenuItem> nestedItems = menuItems.get(topItem);
 			if (topItem.isCategory() && nestedItems != null) {
-				bindCategoryView(topItem, nestedItems, llList);
+				bindCategoryView(topItem, nestedItems);
 			} else {
 				bindItemView(topItem, llList);
 			}
@@ -110,10 +136,10 @@ private void updateList(boolean reset) {
 	}
 
 	private void bindCategoryView(@NonNull ContextMenuItem category,
-	                              @NonNull List<ContextMenuItem> items, @NonNull LinearLayout llList) {
+	                              @NonNull List<ContextMenuItem> nestedItems) {
 		// Use the same layout for all categories views
 		category.setLayout(R.layout.list_item_expandable_category);
-		List<String> titles = CtxMenuUtils.getNames(items);
+		List<String> titles = CtxMenuUtils.getNames(nestedItems);
 		String description = TextUtils.join(", ", titles);
 		category.setDescription(description);
 
@@ -136,13 +162,13 @@ private void bindCategoryView(@NonNull ContextMenuItem category,
 		btnView.setOnClickListener(v -> {
 			boolean isCollapsed = collapsedIds.containsValue(appMode, id);
 			if (isCollapsed) {
-				expandCategory(category);
+				expand(category);
 			} else {
-				collapseCategory(category);
+				collapse(category);
 			}
 		});
 
-		for (ContextMenuItem item : items) {
+		for (ContextMenuItem item : nestedItems) {
 			bindItemView(item, container);
 		}
 	}
@@ -177,7 +203,7 @@ private void updateCategoryView(@NonNull ContextMenuItem category) {
 		}
 	}
 
-	private void expandCategory(@NonNull ContextMenuItem category) {
+	private void expand(@NonNull ContextMenuItem category) {
 		collapsedIds.removeValueForProfile(appMode, category.getId());
 		if (useAnimation) {
 			View view = views.get(category.getTitleId());
@@ -187,7 +213,7 @@ private void expandCategory(@NonNull ContextMenuItem category) {
 		}
 	}
 
-	private void collapseCategory(@NonNull ContextMenuItem category) {
+	private void collapse(@NonNull ContextMenuItem category) {
 		collapsedIds.addModeValue(appMode, category.getId());
 		if (useAnimation) {
 			View view = views.get(category.getTitleId());
@@ -223,25 +249,32 @@ public View.OnClickListener getItemsClickListener() {
 		return itemsClickListener;
 	}
 
+	public void onMapStyleChanged() {
+		ContextMenuItem item = adapter.getItemById(MAP_STYLE_ID);
+		if (item != null) {
+			item.refreshWithActualData();
+			View view = views.get(item.getTitleId());
+			if (view != null) {
+				bindItemView(item, llList);
+			}
+		}
+	}
+
 	private void setupSelectableBg(@NonNull View view) {
 		int profileColor = appMode.getProfileColor(nightMode);
 		Drawable background = UiUtilities.getColoredSelectableDrawable(app, profileColor, 0.3f);
 		AndroidUtils.setBackground(view, background);
 	}
 
-	@Override
-	public void onDataSetChanged() {
-		updateList(false);
-	}
-
-	@Override
-	public void onDataSetInvalidated() {
-		updateList(true);
+	@Nullable
+	public static ConfigureMapFragment getVisibleInstance(@NonNull MapActivity mapActivity) {
+		FragmentManager fm = mapActivity.getSupportFragmentManager();;
+		return (ConfigureMapFragment) fm.findFragmentByTag(TAG);
 	}
 
-	public static void showInstance(@NonNull FragmentManager fragmentManager) {
-		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
-			fragmentManager.beginTransaction()
+	public static void showInstance(@NonNull FragmentManager fm) {
+		if (AndroidUtils.isFragmentCanBeAdded(fm, TAG)) {
+			fm.beginTransaction()
 					.replace(R.id.content, new ConfigureMapFragment(), TAG)
 					.commitAllowingStateLoss();
 		}
diff --git a/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java b/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java
index a30cd13eba2..8b6b90f70a8 100644
--- a/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java
+++ b/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java
@@ -513,6 +513,7 @@ public void setDashboardVisibility(boolean visible, DashboardType type, Dashboar
 		DashboardOnMap.staticVisible = visible;
 		DashboardOnMap.staticVisibleType = type;
 		mapActivity.enableDrawer();
+		removeFragment(ConfigureMapFragment.TAG);
 		removeFragment(MapillaryFiltersFragment.TAG);
 		removeFragment(TerrainFragment.TAG);
 		removeFragment(TransportLinesFragment.TAG);
@@ -727,7 +728,10 @@ public void refreshContent(boolean force) {
 			listView.clearParams();
 			updateListAdapter();
 		} else if (isCurrentType(CONFIGURE_MAP)) {
-			refreshFragment(ConfigureMapFragment.TAG);
+			ConfigureMapFragment cm = ConfigureMapFragment.getVisibleInstance(mapActivity);
+			if (cm != null) {
+				cm.onDataSetInvalidated();
+			}
 		} else if (isCurrentType(ROUTE_PREFERENCES)) {
 			int index = listView.getFirstVisiblePosition();
 			View v = listView.getChildAt(0);
@@ -985,13 +989,7 @@ void onDetach(DashBaseFragment dashBaseFragment) {
 		}
 	}
 
-	public void onMapSettingsUpdated() {
-		if (isCurrentType(CONFIGURE_MAP)) {
-			refreshContent(false);
-		}
-	}
-
-	public void onApplicationModeSettingsUpdated() {
+	public void onAppModeChanged() {
 		if (isCurrentType(CONFIGURE_MAP)) {
 			refreshContent(false);
 		}
diff --git a/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ContextMenuAdapter.java b/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ContextMenuAdapter.java
index 01faf3a067b..f247ce5756e 100644
--- a/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ContextMenuAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ContextMenuAdapter.java
@@ -3,6 +3,7 @@
 import android.app.Activity;
 
 import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.settings.backend.OsmAndAppCustomization;
@@ -48,6 +49,16 @@ public List<ContextMenuItem> getItems() {
 		return items;
 	}
 
+	@Nullable
+	public ContextMenuItem getItemById(@NonNull String id) {
+		for (ContextMenuItem item : items) {
+			if (Algorithms.objectEquals(item.getId(), id)) {
+				return item;
+			}
+		}
+		return null;
+	}
+
 	public void clear() {
 		items.clear();
 	}
diff --git a/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ViewCreator.java b/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ViewCreator.java
index d4e3df8eb8f..ff18b51c0fd 100644
--- a/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ViewCreator.java
+++ b/OsmAnd/src/net/osmand/plus/widgets/ctxmenu/ViewCreator.java
@@ -182,15 +182,12 @@ private View getSpecialView(@LayoutRes int layoutId, @NonNull ContextMenuItem it
 	@NonNull
 	private View getAppModeToggleView() {
 		Set<ApplicationMode> selected = new LinkedHashSet<>();
-		return AppModeDialog.prepareAppModeDrawerView((Activity) ctx,
-				selected, true, view -> {
+		return AppModeDialog.prepareAppModeDrawerView(ctx, selected, true,
+				view -> {
 					if (selected.size() > 0) {
 						OsmandApplication app = (OsmandApplication) ctx.getApplicationContext();
 						OsmandSettings settings = app.getSettings();
 						settings.setApplicationMode(selected.iterator().next());
-						if (uiAdapter != null) {
-							uiAdapter.onDataSetChanged();
-						}
 					}
 				});
 	}
