diff --git a/DataExtractionOSM/src/net/osmand/render/OsmandRenderingRulesParser.java b/DataExtractionOSM/src/net/osmand/render/OsmandRenderingRulesParser.java
deleted file mode 100644
index b2f7115f898..00000000000
--- a/DataExtractionOSM/src/net/osmand/render/OsmandRenderingRulesParser.java
+++ /dev/null
@@ -1,561 +0,0 @@
-package net.osmand.render;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.List;
-import java.util.Stack;
-
-import javax.xml.parsers.ParserConfigurationException;
-import javax.xml.parsers.SAXParser;
-import javax.xml.parsers.SAXParserFactory;
-
-import net.osmand.osm.MapRenderingTypes;
-import net.osmand.LogUtil;
-
-import org.apache.commons.logging.Log;
-import org.xml.sax.Attributes;
-import org.xml.sax.SAXException;
-import org.xml.sax.helpers.DefaultHandler;
-
-public class OsmandRenderingRulesParser {
-
-	
-	private final static Log log = LogUtil.getLog(OsmandRenderingRulesParser.class);
-	
-	public static class EffectAttributes {
-		public int color = 0;
-		public float strokeWidth = 0;
-		public String pathEffect = null;
-		public int shadowColor = 0;
-		public float shadowRadius = 0;
-		public String cap = null;
-		
-	}
-	
-	public static class TextAttributes {
-		public int textColor = 0;
-		public int textOrder = 0;
-		public float textSize = 0;
-		public boolean textBold = false;
-		public String textShield = null;
-		public int textMinDistance = 0;
-		public boolean textOnPath = false;
-		public int textWrapWidth = 0;
-		public float textHaloRadius = 0;
-		public int textDy = 0;
-		public String ref = null;
-	}
-	
-	protected static class SwitchState {
-		List<FilterState> filters = new ArrayList<FilterState>();
-	}
-	
-	public static class FilterState {
-		public int minzoom = -1;
-		public int maxzoom = -1;
-		public String tag = null;
-		public String val = null;
-		public int layer = 0;
-		public int textLength = 0;
-		public float order = 0;
-		public int orderType = -1;
-		public Boolean nightMode = null;
-		
-		public String shader = null;
-		
-		// point
-		public String icon = null;
-		
-		public EffectAttributes main = new EffectAttributes();
-		public TextAttributes text = null;
-		public List<EffectAttributes> effectAttributes = new ArrayList<EffectAttributes>(3);
-		
-		protected EffectAttributes getEffectAttributes(int i) {
-			i -= 2;
-			while (i >= effectAttributes.size()) {
-				effectAttributes.add(new EffectAttributes());
-			}
-			return effectAttributes.get(i);
-		}
-		
-		
-	}
-	
-	public interface RenderingRuleVisitor {
-		
-		/**
-		 * @param state - one of the point, polygon, line, text state
-		 * @param filter
-		 */
-		public void visitRule(int state, FilterState  filter);
-		
-		public void rendering(String name, String depends, int defaultColor, int defaultNightColor);
-	}
-	
-	
-	public final static int POINT_STATE = MapRenderingTypes.POINT_TYPE;
-	public final static int LINE_STATE = MapRenderingTypes.POLYLINE_TYPE;
-	public final static int POLYGON_STATE = MapRenderingTypes.POLYGON_TYPE;
-	public final static int TEXT_STATE = 4;
-	public final static int ORDER_STATE = 5;
-	
-	public void parseRenderingRules(InputStream is, RenderingRuleVisitor visitor) throws IOException, SAXException {
-		try {
-			final SAXParser saxParser = SAXParserFactory.newInstance().newSAXParser();
-			saxParser.parse(is, new RenderingRulesHandler(saxParser, visitor));
-		} catch (ParserConfigurationException e) {
-			throw new SAXException(e);
-		}
-	}
-	
-	private class RenderingRulesHandler extends DefaultHandler {
-		private final SAXParser parser;
-		private final RenderingRuleVisitor visitor;
-		private int state;
-
-		Stack<Object> stack = new Stack<Object>();
-		
-		
-		public RenderingRulesHandler(SAXParser parser, RenderingRuleVisitor visitor){
-			this.parser = parser;
-			this.visitor = visitor;
-		}
-		
-		@Override
-		public void startElement(String uri, String localName, String name, Attributes attributes) throws SAXException {
-			name = parser.isNamespaceAware() ? localName : name;
-			if("filter".equals(name)){ //$NON-NLS-1$
-				FilterState st = parseFilterAttributes(attributes);
-				stack.push(st);
-			} else if("order".equals(name)){ //$NON-NLS-1$
-				state = ORDER_STATE;
-			} else if("text".equals(name)){ //$NON-NLS-1$
-				state = TEXT_STATE;
-			} else if("point".equals(name)){ //$NON-NLS-1$
-				state = POINT_STATE;
-			} else if("line".equals(name)){ //$NON-NLS-1$
-				state = LINE_STATE;
-			} else if("polygon".equals(name)){ //$NON-NLS-1$
-				state = POLYGON_STATE;
-			} else if("switch".equals(name)){ //$NON-NLS-1$
-				SwitchState st = new SwitchState();
-				stack.push(st);
-			} else if("case".equals(name)){ //$NON-NLS-1$
-				FilterState st = parseFilterAttributes(attributes);
-				((SwitchState)stack.peek()).filters.add(st);
-			} else if("renderer".equals(name)){ //$NON-NLS-1$
-				String dc = attributes.getValue("defaultColor");
-				int defaultColor = 0;
-				if(dc != null && dc.length() > 0){
-					defaultColor = parseColor(dc);
-				}
-				String dnc = attributes.getValue("defaultNightColor");
-				int defautNightColor = defaultColor;
-				if(dnc != null && dnc.length() > 0){
-					defautNightColor = parseColor(dnc);
-				}
-				visitor.rendering(attributes.getValue("name"), attributes.getValue("depends"), defaultColor, defautNightColor); //$NON-NLS-1$ //$NON-NLS-2$
-			} else {
-				log.warn("Unknown tag" + name); //$NON-NLS-1$
-			}
-		}
-		
-		@Override
-		public void endElement(String uri, String localName, String name) throws SAXException {
-			name = parser.isNamespaceAware() ? localName : name;
-			if ("filter".equals(name)) { //$NON-NLS-1$
-				List<FilterState> list = popAndAggregateState();
-				for (FilterState pop : list) {
-					if (pop.tag != null && (pop.minzoom != -1 || state == ORDER_STATE)) {
-						visitor.visitRule(state, pop);
-					}
-				}
-			} else if("switch".equals(name)){ //$NON-NLS-1$
-				stack.pop();
-			}
-		}
-		
-		
-		
-		public List<FilterState> popAndAggregateState() {
-			FilterState pop = (FilterState) stack.pop();
-			List<FilterState> res = null;
-			for (int i = stack.size() - 1; i >= 0; i--) {
-				Object o = stack.get(i);
-				if(o instanceof FilterState){
-					if(res == null){
-						mergeStateInto((FilterState) o, pop);
-					} else {
-						for(FilterState f : res){
-							mergeStateInto((FilterState) o, f);
-						}
-					}
-				} else {
-					List<FilterState> filters = ((SwitchState)o).filters;
-					if (res == null) {
-						res = new ArrayList<FilterState>();
-						res.add(pop);
-					}
-					int l = res.size();
-					for (int t = 0; t < filters.size() - 1; t++) {
-						for (int j = 0; j < l; j++) {
-							FilterState n = new FilterState();
-							mergeStateInto(res.get(j), n);
-							res.add(n);
-						}
-					}
-					for (int j = 0; j < res.size(); j++) {
-						mergeStateInto(filters.get(j / l), res.get(j));
-					}
-				}
-				
-			}
-			if(res == null){
-				return Collections.singletonList(pop);
-			} else {
-				return res;
-			}
-		}
-		
-		public void mergeStateInto(FilterState toMerge, FilterState mergeInto){
-			if(toMerge.maxzoom != -1 && mergeInto.maxzoom == -1){
-				mergeInto.maxzoom = toMerge.maxzoom;
-			}
-			
-			if(toMerge.minzoom != -1 && mergeInto.minzoom == -1){
-				mergeInto.minzoom = toMerge.minzoom;
-			}
-			if(toMerge.nightMode != null && mergeInto.nightMode == null){
-				mergeInto.nightMode = toMerge.nightMode;
-			}
-			if(toMerge.icon != null && mergeInto.icon == null){
-				mergeInto.icon = toMerge.icon;
-			}
-			if(toMerge.tag != null && mergeInto.tag == null){
-				mergeInto.tag = toMerge.tag;
-			}
-			if(toMerge.orderType != -1 && mergeInto.orderType == -1){
-				mergeInto.orderType = toMerge.orderType;
-			}
-			if(toMerge.layer != 0 && mergeInto.layer == 0){
-				mergeInto.layer = toMerge.layer;
-			}
-			if(toMerge.order != 0 && mergeInto.order == 0){
-				mergeInto.order = toMerge.order;
-			}
-			if(toMerge.textLength != 0 && mergeInto.textLength == 0){
-				mergeInto.textLength = toMerge.textLength;
-			}
-			if(toMerge.val != null && mergeInto.val == null){
-				mergeInto.val = toMerge.val;
-			}
-			if(toMerge.text != null){
-				if(mergeInto.text == null){
-					mergeInto.text = new TextAttributes();
-				}
-				if(toMerge.text.textColor != 0 && mergeInto.text.textColor == 0){
-					mergeInto.text.textColor = toMerge.text.textColor;
-				}
-				if(toMerge.text.textSize != 0 && mergeInto.text.textSize == 0){
-					mergeInto.text.textSize = toMerge.text.textSize;
-				}
-				if(toMerge.text.textOrder != 0 && mergeInto.text.textOrder == 0){
-					mergeInto.text.textOrder = toMerge.text.textOrder;
-				}
-				if(toMerge.text.textBold && !mergeInto.text.textBold){
-					mergeInto.text.textBold = toMerge.text.textBold;
-				}
-				if(toMerge.text.textShield != null && mergeInto.text.textShield == null){
-					mergeInto.text.textShield = toMerge.text.textShield;
-				}
-				
-				if(toMerge.text.ref != null && mergeInto.text.ref == null){
-					mergeInto.text.ref = toMerge.text.ref;
-				}
-				
-				if(toMerge.text.textMinDistance != 0 && mergeInto.text.textMinDistance == 0){
-					mergeInto.text.textMinDistance = toMerge.text.textMinDistance;
-				}
-				if(toMerge.text.textDy != 0 && mergeInto.text.textDy == 0){
-					mergeInto.text.textDy = toMerge.text.textDy;
-				}
-				if(toMerge.text.textHaloRadius != 0 && mergeInto.text.textHaloRadius == 0){
-					mergeInto.text.textHaloRadius = toMerge.text.textHaloRadius;
-				}
-				if(toMerge.text.textWrapWidth != 0 && mergeInto.text.textWrapWidth == 0){
-					mergeInto.text.textWrapWidth = toMerge.text.textWrapWidth;
-				}
-				if(toMerge.text.textOnPath && !mergeInto.text.textOnPath){
-					mergeInto.text.textOnPath = toMerge.text.textOnPath;
-				}
-			}
-			
-			mergeStateInto(toMerge.main, mergeInto.main);
-			while(mergeInto.effectAttributes.size() < toMerge.effectAttributes.size()){
-				mergeInto.effectAttributes.add(new EffectAttributes());
-			}
-			for(int i=0; i<toMerge.effectAttributes.size(); i++){
-				mergeStateInto(toMerge.effectAttributes.get(i), mergeInto.effectAttributes.get(i));
-			}
-		}
-		
-		public void mergeStateInto(EffectAttributes toMerge, EffectAttributes mergeInto){
-			if(toMerge.color != 0 && mergeInto.color == 0){
-				mergeInto.color = toMerge.color;
-			}
-			
-			if(toMerge.strokeWidth != 0 && mergeInto.strokeWidth == 0){
-				mergeInto.strokeWidth = toMerge.strokeWidth;
-			}
-			
-			if(toMerge.pathEffect != null && mergeInto.pathEffect == null){
-				mergeInto.pathEffect = toMerge.pathEffect;
-			}
-			if(toMerge.shadowRadius != 0 && mergeInto.shadowRadius == 0){
-				mergeInto.shadowRadius = toMerge.shadowRadius;
-			}
-			
-			if(toMerge.shadowColor != 0 && mergeInto.shadowColor == 0){
-				mergeInto.shadowColor = toMerge.shadowColor;
-			}
-			if(toMerge.cap != null && mergeInto.cap == null){
-				mergeInto.cap = toMerge.cap;
-			}
-		}
-		
-		public FilterState parseFilterAttributes(Attributes attributes){
-			FilterState state = new FilterState();
-			if(this.state == TEXT_STATE){
-				state.text = new TextAttributes();
-			}
-			for(int i=0; i<attributes.getLength(); i++){
-				String name = attributes.getLocalName(i);
-				String val = attributes.getValue(i);
-				if(name.equals("tag")){ //$NON-NLS-1$
-					state.tag = val;
-				} else if(name.equals("value")){ //$NON-NLS-1$
-					state.val = val;
-				} else if(name.equals("minzoom")){ //$NON-NLS-1$
-					state.minzoom = Integer.parseInt(val);
-				} else if(name.equals("maxzoom")){ //$NON-NLS-1$
-					state.maxzoom = Integer.parseInt(val);
-				} else if(name.equals("maxzoom")){ //$NON-NLS-1$
-					state.maxzoom = Integer.parseInt(val);
-				} else if(name.equals("layer")){ //$NON-NLS-1$
-					state.layer = Integer.parseInt(val);
-				} else if(name.equals("orderType")){ //$NON-NLS-1$
-					int i1 = val.equals("polygon") ? 3 : (val.equals("line") ? 2 : 1);  //$NON-NLS-1$ //$NON-NLS-2$
-					state.orderType = i1;
-				} else if(name.equals("order")){ //$NON-NLS-1$
-					state.order = Float.parseFloat(val);
-				} else if(name.equals("nightMode")){ //$NON-NLS-1$
-					state.nightMode = Boolean.parseBoolean(val);
-				} else if(name.equals("icon")){ //$NON-NLS-1$
-					state.icon = val;
-				} else if(name.equals("color")){ //$NON-NLS-1$
-					state.main.color = parseColor(val);
-				} else if(name.startsWith("color_")){ //$NON-NLS-1$
-					EffectAttributes ef = state.getEffectAttributes(Integer.parseInt(name.substring(6)));
-					ef.color = parseColor(val);
-				} else if(name.equals("shader")){ //$NON-NLS-1$
-					state.shader = val;
-				} else if(name.equals("strokeWidth")){ //$NON-NLS-1$
-					state.main.strokeWidth = Float.parseFloat(val);
-				} else if(name.startsWith("strokeWidth_")){ //$NON-NLS-1$
-					EffectAttributes ef = state.getEffectAttributes(Integer.parseInt(name.substring(12)));
-					ef.strokeWidth = Float.parseFloat(val);
-				} else if(name.equals("pathEffect")){ //$NON-NLS-1$
-					state.main.pathEffect = val;
-				} else if(name.startsWith("pathEffect_")){ //$NON-NLS-1$
-					EffectAttributes ef = state.getEffectAttributes(Integer.parseInt(name.substring(11)));
-					ef.pathEffect = val;
-				} else if(name.equals("shadowRadius")){ //$NON-NLS-1$
-					state.main.shadowRadius = Float.parseFloat(val);
-				} else if(name.startsWith("shadowRadius_")){ //$NON-NLS-1$
-					EffectAttributes ef = state.getEffectAttributes(Integer.parseInt(name.substring(14)));
-					ef.shadowRadius = Float.parseFloat(val);
-				} else if(name.equals("shadowColor")){ //$NON-NLS-1$
-					state.main.shadowColor = parseColor(val);
-				} else if(name.startsWith("shadowColor_")){ //$NON-NLS-1$
-					EffectAttributes ef = state.getEffectAttributes(Integer.parseInt(name.substring(12)));
-					ef.shadowColor = parseColor(val);
-				} else if(name.equals("cap")){ //$NON-NLS-1$
-					state.main.cap = val;
-				} else if(name.startsWith("cap_")){ //$NON-NLS-1$
-					EffectAttributes ef = state.getEffectAttributes(Integer.parseInt(name.substring(4)));
-					ef.cap = val;
-				} else if(name.equals("ref")){ //$NON-NLS-1$
-					state.text.ref = val;
-				} else if(name.equals("textSize")){ //$NON-NLS-1$
-					state.text.textSize = Float.parseFloat(val);
-				} else if(name.equals("textOrder")){ //$NON-NLS-1$
-					state.text.textOrder = Integer.parseInt(val);
-				} else if(name.equals("textBold")){ //$NON-NLS-1$
-					state.text.textBold = Boolean.parseBoolean(val);
-				} else if(name.equals("textColor")){ //$NON-NLS-1$
-					state.text.textColor = parseColor(val);
-				} else if(name.equals("textLength")){ //$NON-NLS-1$
-					state.textLength = Integer.parseInt(val);
-				} else if(name.equals("textShield")){ //$NON-NLS-1$
-					state.text.textShield = val;
-				} else if(name.equals("textMinDistance")){ //$NON-NLS-1$
-					state.text.textMinDistance = Integer.parseInt(val);
-				} else if(name.equals("textOnPath")){ //$NON-NLS-1$
-					state.text.textOnPath = Boolean.parseBoolean(val);
-				} else if(name.equals("textWrapWidth")){ //$NON-NLS-1$
-					state.text.textWrapWidth = Integer.parseInt(val);
-				} else if(name.equals("textDy")){ //$NON-NLS-1$
-					state.text.textDy = Integer.parseInt(val);
-				} else if(name.equals("textHaloRadius")){ //$NON-NLS-1$
-					state.text.textHaloRadius = Float.parseFloat(val);
-				} else {
-					log.warn("Unknown attribute " + name); //$NON-NLS-1$
-				}
-			}
-			return state;
-		}
-	}
-
-	/**
-     * Parse the color string, and return the corresponding color-int.
-     * If the string cannot be parsed, throws an IllegalArgumentException
-     * exception. Supported formats are:
-     * #RRGGBB
-     * #AARRGGBB
-     * 'red', 'blue', 'green', 'black', 'white', 'gray', 'cyan', 'magenta',
-     * 'yellow', 'lightgray', 'darkgray'
-     */
-    public static int parseColor(String colorString) {
-        if (colorString.charAt(0) == '#') {
-            // Use a long to avoid rollovers on #ffXXXXXX
-            long color = Long.parseLong(colorString.substring(1), 16);
-            if (colorString.length() == 7) {
-                // Set the alpha value
-                color |= 0x00000000ff000000;
-            } else if (colorString.length() != 9) {
-                throw new IllegalArgumentException("Unknown color" + colorString); //$NON-NLS-1$
-            }
-            return (int)color;
-        }
-        throw new IllegalArgumentException("Unknown color" + colorString); //$NON-NLS-1$
-    }
-    
-    
-    // TEST purpose 
-	public static void main(String[] args) throws IOException, SAXException {
-		OsmandRenderingRulesParser parser = new OsmandRenderingRulesParser();
-		parser.parseRenderingRules(OsmandRenderingRulesParser.class.getResourceAsStream("hm.render.xml"),  //$NON-NLS-1$
-				new RenderingRuleVisitor() {
-
-			@Override
-			public void rendering(String name, String depends, int defColor, int defaultNightColor) {
-				System.out.println("Renderer " + name); //$NON-NLS-1$
-			}
-
-			@Override
-			public void visitRule(int state, FilterState filter) {
-				if(filter.nightMode != null){
-					System.out.println(filter.minzoom +" " +filter.tag + " " + filter.val);
-				}
-				String gen = generateAttributes(state, filter);
-				if (gen != null) {
-					String res = ""; //$NON-NLS-1$
-					if (filter.maxzoom != -1) {
-						res += " zoom : " +filter.minzoom + "-" + filter.maxzoom; //$NON-NLS-1$ //$NON-NLS-2$
-					} else {
-						res += " zoom : " +filter.minzoom; //$NON-NLS-1$
-					}
-					res += " tag="+filter.tag; //$NON-NLS-1$
-					res += " val="+filter.val; //$NON-NLS-1$
-					if(filter.layer != 0){
-						res += " layer="+filter.layer; //$NON-NLS-1$
-					}
-					
-					res += gen;
-					System.out.println(res);
-				}
-			}
-
-		});
-	}
-
-    public static String colorToString(int color) {
-		if ((0xFF000000 & color) == 0xFF000000) {
-			return "#" + Integer.toHexString(color & 0x00FFFFFF); //$NON-NLS-1$
-		} else {
-			return "#" + Integer.toHexString(color); //$NON-NLS-1$
-		}
-	}
-	
-	private static String generateAttributes(int state, FilterState s){
-		String res = ""; //$NON-NLS-1$
-		if(s.shader != null){
-			res+=" shader=" + s.shader; //$NON-NLS-1$
-		}
-		
-		if(s.icon != null){
-			res+= " icon="+s.icon; //$NON-NLS-1$
-		}
-		
-		if(s.order != 0){
-			res+= " order="+s.order; //$NON-NLS-1$
-		}
-		
-		if(s.orderType != 0){
-			res+= " orderType="+s.orderType; //$NON-NLS-1$
-		}
-		
-		res = generateAttributes(s.main, res, ""); //$NON-NLS-1$
-		int p = 2;
-		for(EffectAttributes ef : s.effectAttributes){
-			res = generateAttributes(ef, res, "_"+(p++)); //$NON-NLS-1$
-		}
-		if(s.text != null){
-			if(s.text.textSize != 0){
-				res+= " textSize="+s.text.textSize; //$NON-NLS-1$
-			}
-			if(s.text.textOrder != 0){
-				res+= " textOrder="+s.text.textOrder; //$NON-NLS-1$
-			}
-			if(s.text.ref != null){
-				res+= " ref="+s.text.ref; //$NON-NLS-1$
-			}
-			if(s.text.textColor != 0){
-				res+= " textColor="+colorToString(s.text.textColor); //$NON-NLS-1$
-			}
-			if(s.text.textShield != null){
-				res+= " textShield="+s.text.textShield; //$NON-NLS-1$
-			}
-			
-			
-		}
-		if(state == POLYGON_STATE){
-//			return res;
-		} else if(state == LINE_STATE){
-//			return res;
-		} else if(state == POINT_STATE){
-//			return res;
-		} else if(state == TEXT_STATE){
-//			return res;
-		} else if(state == ORDER_STATE){
-			return res;
-		}
-		return null;
-	}
-
-
-	private static String generateAttributes(EffectAttributes s, String res, String prefix) {
-		if(s.color != 0){
-			res +=" color"+prefix+"="+colorToString(s.color); //$NON-NLS-1$ //$NON-NLS-2$
-		}
-		if(s.strokeWidth != 0){
-			res+= " strokeWidth"+prefix+"="+s.strokeWidth; //$NON-NLS-1$ //$NON-NLS-2$
-		}
-		if(s.pathEffect != null){
-			res+= " pathEffect"+prefix+"="+s.pathEffect; //$NON-NLS-1$ //$NON-NLS-2$
-		}
-		return res;
-	}
-}
diff --git a/DataExtractionOSM/src/net/osmand/render/RenderingRuleProperty.java b/DataExtractionOSM/src/net/osmand/render/RenderingRuleProperty.java
index f82ac713277..638349c65fc 100644
--- a/DataExtractionOSM/src/net/osmand/render/RenderingRuleProperty.java
+++ b/DataExtractionOSM/src/net/osmand/render/RenderingRuleProperty.java
@@ -58,6 +58,14 @@ public String getAttrName() {
 		return attrName;
 	}
 	
+	public String getName() {
+		return name;
+	}
+	
+	public String getDescription() {
+		return description;
+	}
+	
 	protected void setName(String name) {
 		this.name = name;
 	}
@@ -70,6 +78,17 @@ protected void setPossibleValues(String[] possibleValues) {
 		this.possibleValues = possibleValues;
 	}
 	
+	public String[] getPossibleValues() {
+		if (isBoolean()) {
+			return new String[] { "true", "false" };
+		}
+		return possibleValues;
+	}
+	
+	public boolean isBoolean() {
+		return type == BOOLEAN_TYPE;
+	}
+	
 	public boolean isFloat() {
 		return type == FLOAT_TYPE;
 	}
diff --git a/DataExtractionOSM/src/net/osmand/render/RenderingRuleSearchRequest.java b/DataExtractionOSM/src/net/osmand/render/RenderingRuleSearchRequest.java
index 888bfb83559..c3c089eb1b8 100644
--- a/DataExtractionOSM/src/net/osmand/render/RenderingRuleSearchRequest.java
+++ b/DataExtractionOSM/src/net/osmand/render/RenderingRuleSearchRequest.java
@@ -1,11 +1,10 @@
 package net.osmand.render;
 
-import java.util.ArrayList;
-import java.util.List;
 
 public class RenderingRuleSearchRequest {
 
 	private final RenderingRulesStorage storage;
+	private final RenderingRuleSearchRequest dependsRequest;
 	RenderingRuleProperty[] props;
 	int[] values;
 	float[] fvalues;
@@ -15,11 +14,17 @@ public class RenderingRuleSearchRequest {
 	
 	boolean searchResult = false;
 	
+	
 	public final RenderingRuleStorageProperties ALL;
 
 	public RenderingRuleSearchRequest(RenderingRulesStorage storage) {
 		this.storage = storage;
 		this.ALL = storage.PROPS;
+		if(storage.getDependsStorage() != null){
+			dependsRequest = new RenderingRuleSearchRequest(storage.getDependsStorage());
+		} else {
+			dependsRequest = null;
+		}
 		props = storage.PROPS.getPoperties();
 		values = new int[props.length];
 		for (int i = 0; i < props.length; i++) {
@@ -93,6 +98,12 @@ public boolean search(int state, boolean loadOutput) {
 			searchResult = true;
 			return true;
 		}
+
+		if(dependsRequest != null){
+			// TODO search depends ?
+			// and copy results to local array
+			dependsRequest.search(state);
+		}
 		return false;
 	}
 
diff --git a/DataExtractionOSM/src/net/osmand/render/RenderingRuleStorageProperties.java b/DataExtractionOSM/src/net/osmand/render/RenderingRuleStorageProperties.java
index b0a1dbe92a0..fc20725f0b1 100644
--- a/DataExtractionOSM/src/net/osmand/render/RenderingRuleStorageProperties.java
+++ b/DataExtractionOSM/src/net/osmand/render/RenderingRuleStorageProperties.java
@@ -2,6 +2,7 @@
 
 import java.util.ArrayList;
 import java.util.LinkedHashMap;
+import java.util.List;
 import java.util.Map;
 
 public class RenderingRuleStorageProperties {
@@ -81,62 +82,63 @@ public class RenderingRuleStorageProperties {
 	public RenderingRuleProperty R_TEXT_WRAP_WIDTH;
 
 	final Map<String, RenderingRuleProperty> properties = new LinkedHashMap<String, RenderingRuleProperty>();
-	final java.util.List<RenderingRuleProperty> rules = new ArrayList<RenderingRuleProperty>();
+	final List<RenderingRuleProperty> rules = new ArrayList<RenderingRuleProperty>();
+	final List<RenderingRuleProperty> customRules = new ArrayList<RenderingRuleProperty>();
 	
 	public RenderingRuleStorageProperties() {
 		createDefaultRenderingRuleProperties();
 	}
 
 	public void createDefaultRenderingRuleProperties() {
-		R_TAG = registerRule(RenderingRuleProperty.createInputStringProperty(TAG));
-		R_VALUE = registerRule(RenderingRuleProperty.createInputStringProperty(VALUE));
-		R_MINZOOM = registerRule(RenderingRuleProperty.createInputGreaterIntProperty(MINZOOM));
-		R_MAXZOOM = registerRule(RenderingRuleProperty.createInputLessIntProperty(MAXZOOM));
-		R_NIGHT_MODE = registerRule(RenderingRuleProperty.createInputBooleanProperty(NIGHT_MODE));
-		R_LAYER = registerRule(RenderingRuleProperty.createInputIntProperty(LAYER));
-		R_ORDER_TYPE = registerRule(RenderingRuleProperty.createInputIntProperty(ORDER_TYPE));
-		R_TEXT_LENGTH = registerRule(RenderingRuleProperty.createInputIntProperty(TEXT_LENGTH));
-		R_REF = registerRule(RenderingRuleProperty.createInputBooleanProperty(REF));
+		R_TAG = registerRuleInternal(RenderingRuleProperty.createInputStringProperty(TAG));
+		R_VALUE = registerRuleInternal(RenderingRuleProperty.createInputStringProperty(VALUE));
+		R_MINZOOM = registerRuleInternal(RenderingRuleProperty.createInputGreaterIntProperty(MINZOOM));
+		R_MAXZOOM = registerRuleInternal(RenderingRuleProperty.createInputLessIntProperty(MAXZOOM));
+		R_NIGHT_MODE = registerRuleInternal(RenderingRuleProperty.createInputBooleanProperty(NIGHT_MODE));
+		R_LAYER = registerRuleInternal(RenderingRuleProperty.createInputIntProperty(LAYER));
+		R_ORDER_TYPE = registerRuleInternal(RenderingRuleProperty.createInputIntProperty(ORDER_TYPE));
+		R_TEXT_LENGTH = registerRuleInternal(RenderingRuleProperty.createInputIntProperty(TEXT_LENGTH));
+		R_REF = registerRuleInternal(RenderingRuleProperty.createInputBooleanProperty(REF));
 
 		// order - no sense to make it float
-		R_ORDER = registerRule(RenderingRuleProperty.createOutputIntProperty(ORDER));
+		R_ORDER = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(ORDER));
 
 		// text properties
-		R_TEXT_WRAP_WIDTH = registerRule(RenderingRuleProperty.createOutputIntProperty(TEXT_WRAP_WIDTH));
-		R_TEXT_DY = registerRule(RenderingRuleProperty.createOutputIntProperty(TEXT_DY));
-		R_TEXT_HALO_RADIUS = registerRule(RenderingRuleProperty.createOutputIntProperty(TEXT_HALO_RADIUS));
-		R_TEXT_SIZE = registerRule(RenderingRuleProperty.createOutputIntProperty(TEXT_SIZE));
-		R_TEXT_ORDER = registerRule(RenderingRuleProperty.createOutputIntProperty(TEXT_ORDER));
-		R_TEXT_MIN_DISTANCE = registerRule(RenderingRuleProperty.createOutputIntProperty(TEXT_MIN_DISTANCE));
-		R_TEXT_SHIELD = registerRule(RenderingRuleProperty.createOutputStringProperty(TEXT_SHIELD));
+		R_TEXT_WRAP_WIDTH = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(TEXT_WRAP_WIDTH));
+		R_TEXT_DY = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(TEXT_DY));
+		R_TEXT_HALO_RADIUS = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(TEXT_HALO_RADIUS));
+		R_TEXT_SIZE = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(TEXT_SIZE));
+		R_TEXT_ORDER = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(TEXT_ORDER));
+		R_TEXT_MIN_DISTANCE = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(TEXT_MIN_DISTANCE));
+		R_TEXT_SHIELD = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(TEXT_SHIELD));
 		
 
-		R_TEXT_COLOR = registerRule(RenderingRuleProperty.createOutputColorProperty(TEXT_COLOR));
+		R_TEXT_COLOR = registerRuleInternal(RenderingRuleProperty.createOutputColorProperty(TEXT_COLOR));
 
-		R_TEXT_BOLD = registerRule(RenderingRuleProperty.createOutputBooleanProperty(TEXT_BOLD));
-		R_TEXT_ON_PATH = registerRule(RenderingRuleProperty.createOutputBooleanProperty(TEXT_ON_PATH));
+		R_TEXT_BOLD = registerRuleInternal(RenderingRuleProperty.createOutputBooleanProperty(TEXT_BOLD));
+		R_TEXT_ON_PATH = registerRuleInternal(RenderingRuleProperty.createOutputBooleanProperty(TEXT_ON_PATH));
 
 		// point
-		R_ICON = registerRule(RenderingRuleProperty.createOutputStringProperty(ICON));
+		R_ICON = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(ICON));
 
 		// polygon/way
-		R_COLOR = registerRule(RenderingRuleProperty.createOutputColorProperty(COLOR));
-		R_COLOR_2 = registerRule(RenderingRuleProperty.createOutputColorProperty(COLOR_2));
-		R_COLOR_3 = registerRule(RenderingRuleProperty.createOutputColorProperty(COLOR_3));
-		R_STROKE_WIDTH = registerRule(RenderingRuleProperty.createOutputFloatProperty(STROKE_WIDTH));
-		R_STROKE_WIDTH_2 = registerRule(RenderingRuleProperty.createOutputFloatProperty(STROKE_WIDTH_2));
-		R_STROKE_WIDTH_3 = registerRule(RenderingRuleProperty.createOutputFloatProperty(STROKE_WIDTH_3));
-
-		R_PATH_EFFECT = registerRule(RenderingRuleProperty.createOutputStringProperty(PATH_EFFECT));
-		R_PATH_EFFECT_2 = registerRule(RenderingRuleProperty.createOutputStringProperty(PATH_EFFECT_2));
-		R_PATH_EFFECT_3 = registerRule(RenderingRuleProperty.createOutputStringProperty(PATH_EFFECT_3));
-		R_CAP = registerRule(RenderingRuleProperty.createOutputStringProperty(CAP));
-		R_CAP_2 = registerRule(RenderingRuleProperty.createOutputStringProperty(CAP_2));
-		R_CAP_3 = registerRule(RenderingRuleProperty.createOutputStringProperty(CAP_3));
-		R_SHADER = registerRule(RenderingRuleProperty.createOutputStringProperty(SHADER));
-
-		R_SHADOW_COLOR = registerRule(RenderingRuleProperty.createOutputColorProperty(SHADOW_COLOR));
-		R_SHADOW_RADIUS = registerRule(RenderingRuleProperty.createOutputIntProperty(SHADOW_RADIUS));
+		R_COLOR = registerRuleInternal(RenderingRuleProperty.createOutputColorProperty(COLOR));
+		R_COLOR_2 = registerRuleInternal(RenderingRuleProperty.createOutputColorProperty(COLOR_2));
+		R_COLOR_3 = registerRuleInternal(RenderingRuleProperty.createOutputColorProperty(COLOR_3));
+		R_STROKE_WIDTH = registerRuleInternal(RenderingRuleProperty.createOutputFloatProperty(STROKE_WIDTH));
+		R_STROKE_WIDTH_2 = registerRuleInternal(RenderingRuleProperty.createOutputFloatProperty(STROKE_WIDTH_2));
+		R_STROKE_WIDTH_3 = registerRuleInternal(RenderingRuleProperty.createOutputFloatProperty(STROKE_WIDTH_3));
+
+		R_PATH_EFFECT = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(PATH_EFFECT));
+		R_PATH_EFFECT_2 = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(PATH_EFFECT_2));
+		R_PATH_EFFECT_3 = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(PATH_EFFECT_3));
+		R_CAP = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(CAP));
+		R_CAP_2 = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(CAP_2));
+		R_CAP_3 = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(CAP_3));
+		R_SHADER = registerRuleInternal(RenderingRuleProperty.createOutputStringProperty(SHADER));
+
+		R_SHADOW_COLOR = registerRuleInternal(RenderingRuleProperty.createOutputColorProperty(SHADOW_COLOR));
+		R_SHADOW_RADIUS = registerRuleInternal(RenderingRuleProperty.createOutputIntProperty(SHADOW_RADIUS));
 	}
 
 	public RenderingRuleProperty get(String name) {
@@ -145,13 +147,22 @@ public RenderingRuleProperty get(String name) {
 	
 	public RenderingRuleProperty[] getPoperties() {
 		return rules.toArray(new RenderingRuleProperty[rules.size()]);
-
 	}
-
-	public RenderingRuleProperty registerRule(RenderingRuleProperty p) {
+	
+	public List<RenderingRuleProperty> getCustomRules() {
+		return customRules;
+	}
+	
+	private RenderingRuleProperty registerRuleInternal(RenderingRuleProperty p) {
 		properties.put(p.getAttrName(), p);
 		p.setId(rules.size());
 		rules.add(p);
 		return p;
 	}
+
+	public RenderingRuleProperty registerRule(RenderingRuleProperty p) {
+		registerRuleInternal(p);
+		customRules.add(p);
+		return p;
+	}
 }
diff --git a/DataExtractionOSM/src/net/osmand/render/RenderingRulesStorage.java b/DataExtractionOSM/src/net/osmand/render/RenderingRulesStorage.java
index 3de5fdb4b9a..bdb98edc6df 100644
--- a/DataExtractionOSM/src/net/osmand/render/RenderingRulesStorage.java
+++ b/DataExtractionOSM/src/net/osmand/render/RenderingRulesStorage.java
@@ -4,6 +4,7 @@
 
 import java.io.IOException;
 import java.io.InputStream;
+import java.io.OutputStream;
 import java.io.PrintStream;
 import java.util.ArrayList;
 import java.util.Collections;
@@ -50,6 +51,7 @@ public class RenderingRulesStorage {
 	private int bgNightColor = 0;
 	private String renderingName;
 	private String depends;
+	private RenderingRulesStorage dependsStorage;
 	
 	
 	public RenderingRulesStorage(){
@@ -93,6 +95,14 @@ public String getDepends() {
 		return depends;
 	}
 	
+	public RenderingRulesStorage getDependsStorage() {
+		return dependsStorage;
+	}
+	
+	public void setDependsStorage(RenderingRulesStorage dependsStorage) {
+		this.dependsStorage = dependsStorage;
+	}
+	
 	
 	public void parseRulesFromXmlInputStream(InputStream is) throws SAXException, IOException {
 		try {
@@ -113,8 +123,6 @@ public static String colorToString(int color) {
 	
 	@SuppressWarnings("unchecked")
 	private void registerGlobalRule(RenderingRule rr, int state, Map<String, String> attrsMap) throws SAXException {
-		
-		
 		int tag = rr.getIntPropertyValue(RenderingRuleStorageProperties.TAG);
 		if(tag == -1){
 			throw new SAXException("Attribute tag should be specified for root filter " + attrsMap.toString());
@@ -278,12 +286,6 @@ public void startElement(String uri, String localName, String name, Attributes a
 			
 		}
 		
-		@Override
-		public void endDocument() throws SAXException {
-			super.endDocument();
-			System.out.println(""+stack);
-		}
-		
 		private Map<String, String> parseAttributes(Attributes attributes, Map<String, String> m) {
 			for (int i = 0; i < attributes.getLength(); i++) {
 				String name = parser.isNamespaceAware() ? attributes.getLocalName(i) : attributes.getQName(i);
@@ -366,19 +368,28 @@ public static void main(String[] args) throws SAXException, IOException {
 		RenderingRulesStorage storage = new RenderingRulesStorage();
 		storage.parseRulesFromXmlInputStream(RenderingRulesStorage.class.getResourceAsStream("new_default.render.xml"));
 //		storage.printDebug(LINE_RULES, System.out);
-		
-		RenderingRuleSearchRequest searchRequest = new RenderingRuleSearchRequest(storage);
-		searchRequest.setStringFilter(storage.PROPS.R_TAG, "place");
-		searchRequest.setStringFilter(storage.PROPS.R_VALUE, "hamlet");
-//		searchRequest.setIntFilter(storage.PROPS.R_LAYER, 1);
-		searchRequest.setIntFilter(storage.PROPS.R_MINZOOM, 14);
-		searchRequest.setIntFilter(storage.PROPS.R_MAXZOOM, 14);
-//		searchRequest.setStringFilter(storage.PROPS.R_ORDER_TYPE, "line");
-//		searchRequest.setBooleanFilter(storage.PROPS.R_NIGHT_MODE, true);
-//		searchRequest.setBooleanFilter(storage.PROPS.get("hmRendered"), true);
-		
-		searchRequest.search(TEXT_RULES);
-		printResult(searchRequest, System.out);
+		long tm = System.nanoTime();
+		int count = 100000;
+		for (int i = 0; i < count; i++) {
+			RenderingRuleSearchRequest searchRequest = new RenderingRuleSearchRequest(storage);
+			searchRequest.setStringFilter(storage.PROPS.R_TAG, "highway");
+			searchRequest.setStringFilter(storage.PROPS.R_VALUE, "motorway");
+			// searchRequest.setIntFilter(storage.PROPS.R_LAYER, 1);
+			searchRequest.setIntFilter(storage.PROPS.R_MINZOOM, 14);
+			searchRequest.setIntFilter(storage.PROPS.R_MAXZOOM, 14);
+			// searchRequest.setStringFilter(storage.PROPS.R_ORDER_TYPE, "line");
+			// searchRequest.setBooleanFilter(storage.PROPS.R_NIGHT_MODE, true);
+			// searchRequest.setBooleanFilter(storage.PROPS.get("hmRendered"), true);
+
+			searchRequest.search(ORDER_RULES);
+			printResult(searchRequest, new PrintStream(new OutputStream() {
+				@Override
+				public void write(int b) throws IOException {
+					
+				}
+			}));
+		}
+		System.out.println((System.nanoTime()- tm)/ (1e6f * count) );
 	}
 
 	private static void printResult(RenderingRuleSearchRequest searchRequest, PrintStream out) {
diff --git a/DataExtractionOSM/src/net/osmand/render/new_default.render.xml b/DataExtractionOSM/src/net/osmand/render/new_default.render.xml
index 31c2cdbb6e7..3ebbbe2f0fd 100644
--- a/DataExtractionOSM/src/net/osmand/render/new_default.render.xml
+++ b/DataExtractionOSM/src/net/osmand/render/new_default.render.xml
@@ -52,10 +52,10 @@
 	-->
 
 	<!-- types : string, int, boolean; possibleValues comma separated possible values for int/string -->
-	<renderingProperty attr="hmRendered" name="All-Purpose Renderer" description="All-Purpose Renderer by Hardy"
+	<renderingProperty attr="hmRendered" name="Show more map details" description="Show some vector map detail (roads etc.) at lower zooms already"
 		type="boolean" possibleValues=""/>
 	<renderingProperty attr="appMode" name="Rendering mode" description="Select rendering specific mode"
-		type="string" possibleValues=",car,bicycle,pedestrian"/>	
+		type="string" possibleValues="default,car,bicycle,pedestrian"/>	
 		
 	<!-- input exact layer, orderType check tag, value -->
 	<!-- point = 1, line = 2, polygon = 3 -->
@@ -115,12 +115,21 @@
 			<filter tag="highway" value="primary_link" order="42" />
 			<filter tag="highway" value="secondary_link" order="41" />
 
+			<filter appMode="pedestrian" tag="highway" value="pedestrian" order="60" />
+			<filter appMode="pedestrian" tag="highway" value="cycleway" order="45" />
+			<filter appMode="pedestrian" tag="highway" value="byway" order="62" />
+			<filter appMode="pedestrian" tag="highway" value="footway" order="65" />
+			<filter appMode="pedestrian" tag="highway" value="steps" order="66" />
+			<filter appMode="pedestrian" tag="highway" value="bridleway" order="59" />
+
 			<filter tag="highway" value="pedestrian" order="40" />
+			<filter appMode="bicycle" tag="highway" value="cycleway" order="59" />
 			<filter tag="highway" value="cycleway" order="39" />
 			<filter tag="highway" value="byway" order="38" />
 			<filter tag="highway" value="footway" order="37" />
 			<filter tag="highway" value="steps" order="36" />
 			<filter tag="highway" value="bridleway" order="35" />
+			
 		</group>
 		
 		<filter tag="" value="" order="128" orderType="1"/>
@@ -256,6 +265,7 @@
 			</groupFilter>
 		</group>
 
+		<filter appMode="car" minzoom="14" textSize="14" textBold="true" textWrapWidth="12" textMinDistance="20" tag="highway" value="motorway_junction" textOrder="12"/>
 		<filter minzoom="15" textSize="14" textBold="true" textWrapWidth="12" textMinDistance="20" tag="highway" value="motorway_junction" textOrder="12"/>
 		
 		<!-- Natural -->
@@ -456,9 +466,11 @@
 
 	<!-- PRIORITY Input to filter : tag, value, zoom [minzoom, maxzoom] -->
 	<point>
+		
 		<filter minzoom="13" icon="highway_ford" tag="highway" value="ford" />
 		<filter minzoom="15" icon="mini_roundabout" tag="highway" value="mini_roundabout" />
 		<filter minzoom="15" icon="helipad" tag="aeroway" value="helipad" />
+		<filter appMode="car" minzoom="16" icon="traffic_light" tag="highway" value="traffic_signals" /> <!-- Default value: 17 -->
 		<filter minzoom="17" icon="traffic_light" tag="highway" value="traffic_signals" />
 		<filter minzoom="16" maxzoom="16" icon="bus_stop_small" tag="highway" value="bus_stop" />
 		<filter minzoom="17" icon="bus_stop" tag="highway" value="bus_stop" />
@@ -523,6 +535,7 @@
 		<filter minzoom="17" icon="bicycle_rental" tag="amenity" value="bicycle_rental" />
 		<filter minzoom="14" icon="bus_station" tag="amenity" value="bus_station" />
 		<filter minzoom="16" icon="car_sharing" tag="amenity" value="car_sharing" />
+		<filter appMode="car" minzoom="16" icon="atm" tag="amenity" value="atm" /> <!-- 17 -->
 		<filter minzoom="17" icon="atm" tag="amenity" value="atm" />
 		<filter minzoom="16" icon="bank" tag="amenity" value="bank" />
 		<filter minzoom="16" icon="pharmacy" tag="amenity" value="pharmacy" />
@@ -543,6 +556,15 @@
 		<filter minzoom="17" icon="telephone" tag="amenity" value="telephone" />
 		<filter minzoom="16" icon="toilets" tag="amenity" value="toilets" />
 		<filter minzoom="16" icon="place_of_worship" tag="amenity" value="place_of_worship" />
+		
+		<filter appMode="car" minzoom="15" icon="shop_bakery" tag="shop" value="bakery" /> <!-- 17 -->
+		<filter appMode="car" minzoom="16" icon="shop_butcher" tag="shop" value="butcher" /> <!-- 17 -->
+		<filter appMode="car" minzoom="15" icon="shop_clothes" tag="shop" value="clothes" /> <!-- 16 -->		
+		<filter appMode="car" minzoom="15" icon="shop_clothes" tag="shop" value="fashion" /> <!-- 16 -->		
+		<filter appMode="car" minzoom="15" icon="shop_convenience" tag="shop" value="convenience" /> <!-- 17 -->
+		<filter appMode="car" minzoom="15" icon="shop_supermarket" tag="shop" value="general" /> <!-- 16 -->			
+		<filter appMode="car" minzoom="15" icon="shop_supermarket" tag="shop" value="supermarket" /> <!-- 16 -->
+		
 		<filter minzoom="17" icon="shop_bakery" tag="shop" value="bakery" />
 		<filter minzoom="17" icon="shop_butcher" tag="shop" value="butcher" />
 		<filter minzoom="16" icon="shop_clothes" tag="shop" value="clothes" />
@@ -1012,11 +1034,11 @@
 			<filter tag="highway" value="road" />
 			<filter tag="highway" value="unclassified" />
 			<filter tag="highway" value="residential" />
-			<groupFilter>
+			<groupFilter color="#ffffff" color_2="#ffffff" shadowColor="#464646">
 				<filter hmRendered="true" minzoom="12" maxzoom="12" strokeWidth="3" /> 
 				<filter minzoom="13" maxzoom="13" strokeWidth="4" />
 				<!-- bridge --> 
-				<filter  layer="1" cap_2="SQUARE" color="#000000" color_2="#ffffff" shadowColor="#464646" >
+				<filter  layer="1" cap_2="SQUARE">
 					<filter minzoom="14" maxzoom="14" strokeWidth="8" strokeWidth_2="6" />
 					<filter minzoom="15" maxzoom="15" strokeWidth="10" strokeWidth_2="8" />
 					<filter minzoom="16" maxzoom="16" strokeWidth="12" strokeWidth_2="10" />
@@ -1024,7 +1046,7 @@
 					<filter minzoom="18" strokeWidth="20" strokeWidth_2="18" />
 					<groupFilter nightMode="true" color="#ffffff" color_2="#9F9F9F" shadowColor="#666666" />
 			 	</filter>
-				<filter shadowRadius="1" color="#ffffff" color_2="#ffffff" shadowColor="#464646">
+				<filter  shadowRadius="1">
 					<filter minzoom="14" maxzoom="14" strokeWidth="6" />
 					<filter minzoom="15" maxzoom="15" strokeWidth="8" />
 					<filter minzoom="16" maxzoom="16" strokeWidth="10" />
@@ -1064,50 +1086,59 @@
 				</filter>
 			</groupFilter>
 		</group>
-
+		
 		<filter tag="highway" value="cycleway">
+			<filter appMode="bicycle" minzoom="14" color="#0000ff" strokeWidth="2" pathEffect="10_3" />
+			<filter appMode="pedestrian" minzoom="14" color="#0000ff" strokeWidth="2" pathEffect="10_3" />
 			<filter layer="1" minzoom="14" maxzoom="15" color="#0000ff" strokeWidth="1" pathEffect="2_2" />
 			<filter layer="1" minzoom="15" color="#88ffffff" strokeWidth="2" color_2="#0000ff" strokeWidth_2="2" pathEffect_2="2_2" />	
 			<filter minzoom="12" maxzoom="12" hmRendered="true" color="#0000ff" strokeWidth="0.5" pathEffect="2_2" />
 			<filter minzoom="13" color="#0000ff" strokeWidth="1" pathEffect="2_2" />
 		</filter>
-
+		
 		<filter tag="highway" value="byway">
 			<filter layer="1" minzoom="14" maxzoom="14" color="#ffcc00" strokeWidth="2" pathEffect="4_3" />
 			<filter layer="1" minzoom="15" color="#88ffffff" strokeWidth="4" color_2="#ffcc00" strokeWidth_2="2" pathEffect_2="4_3" />
+			<filter appMode="pedestrian" minzoom="14" color="#ffcc00" strokeWidth="2" pathEffect="10_3" />
 			<filter minzoom="11" hmRendered="true" color="#ffcc00" strokeWidth="1" pathEffect="4_3" />
 			<filter minzoom="12" color="#ffcc00" strokeWidth="1" pathEffect="4_3" />
 		</filter>
 
 		<filter pathEffect="6_3" tag="highway" value="path" color="#000000">
+			<filter appMode="pedestrian" minzoom="14" color="#000000" strokeWidth="2" pathEffect="10_3" />
 			<filter minzoom="12" maxzoom="12" hmRendered="true" strokeWidth="0.5"  />
 			<filter minzoom="13" strokeWidth="1"/> 
 			<groupFilter nightMode="true" color="#787878"/>
 		</filter>
 
+		<filter appMode="pedestrian" tag="highway" value="track" minzoom="14" color="#996600" strokeWidth="2" pathEffect="10_3" />
 		<filter minzoom="12" maxzoom="12" hmRendered="true" color="#996600" strokeWidth="0.5" pathEffect="4_3" tag="highway" value="track" />
 		<filter minzoom="13" color="#996600" strokeWidth="1" pathEffect="4_3" tag="highway" value="track" />
+		
 
-		<filter layer="1" minzoom="15" color="#88ffffff" strokeWidth="4" color_2="#fa8073" strokeWidth_2="2" pathEffect_2="2_2" tag="highway" value="footway" />
-		<filter minzoom="12" maxzoom="12" hmRendered="true" color="#fa8073" strokeWidth="0.5" pathEffect="2_2" tag="highway" value="footway" />
-		<filter minzoom="13" maxzoom="14" hmRendered="true" color="#fa8073" strokeWidth="1" pathEffect="2_2" tag="highway" value="footway" />
-		<filter minzoom="15" color="#fa8073" strokeWidth="1" pathEffect="2_2" tag="highway" value="footway" />
+		<filter  tag="highway" value="footway">
+			<filter layer="1" minzoom="15" color="#88ffffff" strokeWidth="4" color_2="#fa8073" strokeWidth_2="2" pathEffect_2="2_2" />
+			<filter appMode="pedestrian" minzoom="14" color="#fa8073" strokeWidth="2" pathEffect="10_3" />
+			<filter minzoom="12" maxzoom="12" hmRendered="true" color="#fa8073" strokeWidth="0.5" pathEffect="2_2" />
+			<filter minzoom="13" maxzoom="14" hmRendered="true" color="#fa8073" strokeWidth="1" pathEffect="2_2" />
+			<filter minzoom="15" color="#fa8073" strokeWidth="1" pathEffect="2_2"  />
+		</filter>
 		
 		<filter tag="highway" value="steps">
 			<filter minzoom="15" layer="1" color="#88ffffff" strokeWidth="7" color_2="#fa8073" strokeWidth_2="5" pathEffect_2="1_2"/>
+			<filter appMode="pedestrian" minzoom="14" color="#fa8073" strokeWidth="4" pathEffect="1_2" />
+			<filter hmRendered="true" minzoom="14" color="#fa8073" strokeWidth="4" pathEffect="1_2"/>
 			<filter minzoom="15" color="#fa8073" strokeWidth="4" pathEffect="1_2"/>
-			<filter minzoom="14" hmRendered="true" color="#fa8073" strokeWidth="4" pathEffect="1_2"/>
 		</filter>
 		
 		
 		<filter tag="highway" value="bridleway">
 			<filter layer="1" minzoom="15" color="#88ffffff" strokeWidth="2" color_2="#00ff00" strokeWidth_2="2" pathEffect_2="2_2" />
+			<filter appMode="pedestrian" minzoom="14" color="#00ff00" strokeWidth="2" pathEffect="10_3" />
 			<filter minzoom="12" maxzoom="12"  hmRendered="true" color="#00ff00" strokeWidth="0.5" pathEffect="2_2" />
 			<filter minzoom="13" color="#00ff00" strokeWidth="1" pathEffect="2_2" />
 		</filter>
 		
-		
-
 		<filter minzoom="14" color="#000000" strokeWidth="2" tag="highway" value="services" />
 
 		<filter minzoom="14" color="#000000" strokeWidth="2" tag="highway" value="ford" />
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index 02609f20eec..7a44786ff87 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -1,5 +1,9 @@
 <?xml version="1.0" encoding="utf-8" standalone="no"?>
 <resources>
+	<string name="pref_vector_rendering">Vector rendering</string>
+	<string name="pref_overlay">Overlay/underlay</string>
+	<string name="pref_raster_map">Raster map</string>
+	<string name="pref_vector_map">Vector map</string>
 	<string name="delete_confirmation_title">About to delete</string>
 	<string name="delete_confirmation_msg">Are you sure about deleting %1$s?</string>
 	<string name="city_type_suburb">Suburb</string>
diff --git a/OsmAnd/res/xml/settings_pref.xml b/OsmAnd/res/xml/settings_pref.xml
index 1cc5d366929..c1b0cee004d 100644
--- a/OsmAnd/res/xml/settings_pref.xml
+++ b/OsmAnd/res/xml/settings_pref.xml
@@ -5,27 +5,31 @@
 
 
 	<PreferenceScreen android:key="map_settings" android:title="@string/rendering_settings" android:summary="@string/rendering_settings_descr">
-		<CheckBoxPreference android:summary="@string/map_vector_data_descr" android:title="@string/map_vector_data"
-			android:key="map_vector_data"></CheckBoxPreference>
-		<ListPreference android:title="@string/map_tile_source" android:summary="@string/map_tile_source_descr" android:key="map_tile_sources"></ListPreference>
-		<CheckBoxPreference android:summary="@string/use_english_names_descr" android:title="@string/use_english_names"
-			android:key="use_english_names"></CheckBoxPreference>
-		<CheckBoxPreference android:key="show_more_map_detail" android:title="@string/show_more_map_detail"
-			android:summary="@string/show_more_map_detail_descr"></CheckBoxPreference>
-		<ListPreference android:key="renderer" android:title="@string/renderers" android:summary="@string/renderers_descr"></ListPreference>
-		<ListPreference android:key="daynight_mode" android:title="@string/daynight" android:summary="@string/daynight_descr"></ListPreference>
-		<ListPreference android:title="@string/level_to_switch_vector_raster" android:summary="@string/level_to_switch_vector_raster_descr"
-			android:key="level_to_switch_vector_raster"></ListPreference>
-		<ListPreference android:title="@string/map_overlay" android:summary="@string/map_overlay_descr" android:key="map_overlay"></ListPreference>
-		<net.osmand.plus.views.SeekBarPreference android:key="overlay_transparency" android:defaultValue="0" android:max="255" 
-			android:dialogMessage="@string/modify_transparency" android:title="@string/overlay_transparency" android:summary="@string/overlay_transparency_descr"/>
-		<ListPreference android:title="@string/map_underlay" android:summary="@string/map_underlay_descr" android:key="map_underlay"></ListPreference>
-		<net.osmand.plus.views.SeekBarPreference android:key="map_transparency" android:defaultValue="0" android:max="255" 
-			android:dialogMessage="@string/modify_transparency" android:title="@string/map_transparency" android:summary="@string/map_transparency_descr"/>
-		<CheckBoxPreference android:summary="@string/continuous_rendering_descr" android:title="@string/continuous_rendering"
-			android:key="use_step_by_step_rendering" />
-		<ListPreference android:key="map_text_size" android:title="@string/map_text_size" android:summary="@string/map_text_size_descr"/>
+		<PreferenceCategory android:title="@string/pref_raster_map">
+			<ListPreference android:title="@string/map_tile_source" android:summary="@string/map_tile_source_descr" android:key="map_tile_sources"></ListPreference>
+			<CheckBoxPreference android:key="use_internet_to_download_tiles" android:title="@string/use_internet" android:summary="@string/use_internet_to_download_tile"></CheckBoxPreference>
+			<ListPreference android:title="@string/max_level_download_tile" android:summary="@string/max_level_download_tile_descr"
+				android:key="max_level_download_tile"></ListPreference>
+		</PreferenceCategory>
+		<PreferenceCategory android:title="@string/pref_vector_map">
+			<CheckBoxPreference android:summary="@string/map_vector_data_descr" android:title="@string/map_vector_data"
+				android:key="map_vector_data"></CheckBoxPreference>
+			<ListPreference android:key="renderer" android:title="@string/renderers" android:summary="@string/renderers_descr"></ListPreference>
+			<ListPreference android:title="@string/level_to_switch_vector_raster" android:summary="@string/level_to_switch_vector_raster_descr"
+				android:key="level_to_switch_vector_raster"></ListPreference>
+			<ListPreference android:key="map_text_size" android:title="@string/map_text_size" android:summary="@string/map_text_size_descr"/>
+		</PreferenceCategory>
 		<CheckBoxPreference android:key="use_high_res_maps" android:title="@string/use_high_res_maps" android:summary="@string/use_high_res_maps_descr"></CheckBoxPreference>
+		<PreferenceCategory android:title="@string/pref_overlay">
+			<ListPreference android:title="@string/map_overlay" android:summary="@string/map_overlay_descr" android:key="map_overlay"></ListPreference>
+			<net.osmand.plus.views.SeekBarPreference android:key="overlay_transparency" android:defaultValue="0" android:max="255" 
+				android:dialogMessage="@string/modify_transparency" android:title="@string/overlay_transparency" android:summary="@string/overlay_transparency_descr"/>
+			<ListPreference android:title="@string/map_underlay" android:summary="@string/map_underlay_descr" android:key="map_underlay"></ListPreference>
+			<net.osmand.plus.views.SeekBarPreference android:key="map_transparency" android:defaultValue="0" android:max="255" 
+				android:dialogMessage="@string/modify_transparency" android:title="@string/map_transparency" android:summary="@string/map_transparency_descr"/>
+		</PreferenceCategory>
+		<PreferenceCategory android:title="@string/pref_vector_rendering" android:key="custom_vector_rendering">
+		</PreferenceCategory>
 		
 	</PreferenceScreen>
 
@@ -69,17 +73,17 @@
 
 	
 	<PreferenceScreen android:key="general_settings" android:title="@string/general_settings" android:summary="@string/general_settings_descr">
-		<CheckBoxPreference android:key="use_internet_to_download_tiles" android:title="@string/use_internet" android:summary="@string/use_internet_to_download_tile"></CheckBoxPreference>
-		<ListPreference android:title="@string/max_level_download_tile" android:summary="@string/max_level_download_tile_descr"
-			android:key="max_level_download_tile"></ListPreference>
+		<CheckBoxPreference android:summary="@string/use_english_names_descr" android:title="@string/use_english_names"
+			android:key="use_english_names"></CheckBoxPreference>
+		<ListPreference android:key="map_screen_orientation" android:title="@string/map_screen_orientation" android:summary="@string/map_screen_orientation_descr"></ListPreference>
+		<ListPreference android:key="daynight_mode" android:title="@string/daynight" android:summary="@string/daynight_descr"></ListPreference>
 		<CheckBoxPreference android:title="@string/auto_zoom_map" android:summary="@string/auto_zoom_map_descr" android:key="auto_zoom_map"></CheckBoxPreference>
 		<CheckBoxPreference android:key="show_view_angle" android:title="@string/show_view_angle" android:summary="@string/show_view_angle_descr"></CheckBoxPreference>
 		<ListPreference android:key="rotate_map" android:title="@string/rotate_map_to_bearing" android:summary="@string/rotate_map_to_bearing_descr"></ListPreference>
-		<ListPreference android:key="map_screen_orientation" android:title="@string/map_screen_orientation" android:summary="@string/map_screen_orientation_descr"></ListPreference>
+		<ListPreference android:key="preferred_locale" android:title="@string/preferred_locale" android:summary="@string/preferred_locale_descr"></ListPreference>
 		<ListPreference android:key="default_metric_system" android:title="@string/unit_of_length" android:summary="@string/unit_of_length_descr"></ListPreference>
 		<ListPreference android:key="position_on_map" android:title="@string/position_on_map" android:summary="@string/position_on_map_descr"></ListPreference>
 		<CheckBoxPreference android:key="use_trackball_for_movements" android:title="@string/use_trackball" android:summary="@string/use_trackball_descr"></CheckBoxPreference>
-		<ListPreference android:key="preferred_locale" android:title="@string/preferred_locale" android:summary="@string/preferred_locale_descr"></ListPreference>
 		<EditTextPreference android:title="@string/application_dir" android:key="external_storage_dir"></EditTextPreference>
 	</PreferenceScreen>
 	
diff --git a/OsmAnd/src/net/osmand/plus/OsmandSettings.java b/OsmAnd/src/net/osmand/plus/OsmandSettings.java
index 61d0334fde2..01ff3d924b6 100644
--- a/OsmAnd/src/net/osmand/plus/OsmandSettings.java
+++ b/OsmAnd/src/net/osmand/plus/OsmandSettings.java
@@ -564,18 +564,6 @@ public boolean usingEnglishNames(){
 		return USE_ENGLISH_NAMES.get();
 	}
 	
-	// this value string is synchronized with settings_pref.xml preference name
-	public final OsmandPreference<Boolean> SHOW_MORE_MAP_DETAIL = new BooleanPreference("show_more_map_detail", false, true);
-	
-	// this value string is synchronized with settings_pref.xml preference name
-	public final CommonPreference<Boolean> USE_STEP_BY_STEP_RENDERING = new BooleanPreference("use_step_by_step_rendering",
-			true, false);
-	{
-		USE_STEP_BY_STEP_RENDERING.setModeDefaultValue(ApplicationMode.CAR, true);
-		USE_STEP_BY_STEP_RENDERING.setModeDefaultValue(ApplicationMode.BICYCLE, true);
-		USE_STEP_BY_STEP_RENDERING.setModeDefaultValue(ApplicationMode.PEDESTRIAN, true);
-	}
-	
 	// this value string is synchronized with settings_pref.xml preference name
 	public final CommonPreference<Boolean> MAP_VECTOR_DATA = new BooleanPreference("map_vector_data",
 			false, true);
@@ -1012,14 +1000,20 @@ protected boolean setValue(SharedPreferences prefs, String val) {
 		};
 	};
 	
-	public final CommonPreference<String> RENDERER_APP_NAME = new StringPreference("renderer_appName", "", false);
+	Map<String, CommonPreference<String>> customRendersProps = new LinkedHashMap<String, OsmandSettings.CommonPreference<String>>();
+	public CommonPreference<String> getCustomRenderProperty(String attrName){
+		if(!customRendersProps.containsKey(attrName)){
+			customRendersProps.put(attrName, new StringPreference("renderer_"+attrName, "", false));
+		}
+		return customRendersProps.get(attrName);
+	}
 	{
-		RENDERER.setModeDefaultValue(ApplicationMode.CAR, "car");
-		RENDERER.setModeDefaultValue(ApplicationMode.PEDESTRIAN, "pedestrian");
-		RENDERER.setModeDefaultValue(ApplicationMode.BICYCLE, "bicycle");
+		CommonPreference<String> pref = getCustomRenderProperty("appMode");
+		pref.setModeDefaultValue(ApplicationMode.CAR, "car");
+		pref.setModeDefaultValue(ApplicationMode.PEDESTRIAN, "pedestrian");
+		pref.setModeDefaultValue(ApplicationMode.BICYCLE, "bicycle");
 	}
 	
-	
 	public final OsmandPreference<Boolean> VOICE_MUTE = new BooleanPreference("voice_mute", false, true);
 	
 	// for background service
diff --git a/OsmAnd/src/net/osmand/plus/activities/SettingsActivity.java b/OsmAnd/src/net/osmand/plus/activities/SettingsActivity.java
index f201c1b9246..ab25f7e341c 100644
--- a/OsmAnd/src/net/osmand/plus/activities/SettingsActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/SettingsActivity.java
@@ -15,6 +15,7 @@
 import net.osmand.map.TileSourceManager.TileSourceTemplate;
 import net.osmand.plus.NavigationService;
 import net.osmand.plus.OsmandSettings;
+import net.osmand.plus.OsmandSettings.CommonPreference;
 import net.osmand.plus.OsmandSettings.DayNightMode;
 import net.osmand.plus.OsmandSettings.MetricsConstants;
 import net.osmand.plus.OsmandSettings.OsmandPreference;
@@ -22,8 +23,11 @@
 import net.osmand.plus.R;
 import net.osmand.plus.ResourceManager;
 import net.osmand.plus.render.MapRenderRepositories;
+import net.osmand.plus.render.RendererRegistry;
 import net.osmand.plus.routing.RouteProvider.RouteService;
 import net.osmand.plus.views.SeekBarPreference;
+import net.osmand.render.RenderingRuleProperty;
+import net.osmand.render.RenderingRulesStorage;
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.app.AlertDialog.Builder;
@@ -43,6 +47,7 @@
 import android.preference.EditTextPreference;
 import android.preference.ListPreference;
 import android.preference.Preference;
+import android.preference.PreferenceCategory;
 import android.preference.Preference.OnPreferenceChangeListener;
 import android.preference.Preference.OnPreferenceClickListener;
 import android.preference.PreferenceActivity;
@@ -160,12 +165,10 @@ public void onCreate(Bundle savedInstanceState) {
 	    registerBooleanPreference(osmandSettings.USE_TRACKBALL_FOR_MOVEMENTS,screen); 
 	    registerBooleanPreference(osmandSettings.USE_HIGH_RES_MAPS,screen); 
 	    registerBooleanPreference(osmandSettings.USE_ENGLISH_NAMES,screen); 
-	    registerBooleanPreference(osmandSettings.SHOW_MORE_MAP_DETAIL,screen); 
 	    registerBooleanPreference(osmandSettings.AUTO_ZOOM_MAP,screen); 
 	    registerBooleanPreference(osmandSettings.AUTO_FOLLOW_ROUTE_NAV,screen);
 	    registerBooleanPreference(osmandSettings.SAVE_TRACK_TO_GPX,screen); 
 	    registerBooleanPreference(osmandSettings.DEBUG_RENDERING_INFO,screen); 
-	    registerBooleanPreference(osmandSettings.USE_STEP_BY_STEP_RENDERING,screen); 
 	    registerBooleanPreference(osmandSettings.FAST_ROUTE_MODE,screen);
 	    registerBooleanPreference(osmandSettings.USE_OSMAND_ROUTING_SERVICE_ALWAYS,screen); 
 	    registerBooleanPreference(osmandSettings.USE_INTERNET_TO_DOWNLOAD_TILES,screen);
@@ -284,6 +287,8 @@ public void onCreate(Bundle savedInstanceState) {
 		entries = (String[]) rendererNames.toArray(new String[rendererNames.size()]);
 		registerListPreference(osmandSettings.RENDERER, screen, entries, entries);
 		
+		createCustomRenderingProperties();
+		
 		tileSourcePreference = (ListPreference) screen.findPreference(osmandSettings.MAP_TILE_SOURCES.getId());
 		tileSourcePreference.setOnPreferenceChangeListener(this);
 		overlayPreference = (ListPreference) screen.findPreference(osmandSettings.MAP_OVERLAY.getId());
@@ -304,6 +309,7 @@ public void onCreate(Bundle savedInstanceState) {
 		applicationDir.setOnPreferenceChangeListener(this);
 		
 		
+		
 		broadcastReceiver = new BroadcastReceiver(){
 			@Override
 			public void onReceive(Context context, Intent intent) {
@@ -334,6 +340,35 @@ public void onReceive(Context context, Intent intent) {
 		}
     }
 
+	private void createCustomRenderingProperties() {
+		RenderingRulesStorage renderer = getMyApplication().getRendererRegistry().getCurrentSelectedRenderer();
+		PreferenceCategory cat = (PreferenceCategory) findPreference("custom_vector_rendering");
+		cat.removeAll();
+		if(renderer != null){
+			for(RenderingRuleProperty p : renderer.PROPS.getCustomRules()){
+				CommonPreference<String> custom = getMyApplication().getSettings().getCustomRenderProperty(p.getAttrName());
+				ListPreference lp = new ListPreference(this);
+				lp.setOnPreferenceChangeListener(this);
+				lp.setKey(custom.getId());
+				lp.setTitle(p.getName());
+				lp.setSummary(p.getDescription());
+				cat.addPreference(lp);
+				
+				
+				LinkedHashMap<String, Object> vals = new LinkedHashMap<String, Object>();
+				screenPreferences.put(custom.getId(), lp);
+				listPreferences.put(custom.getId(), custom);
+				listPrefValues.put(custom.getId(), vals);
+				String[] names = p.getPossibleValues();
+				for(int i=0; i<names.length; i++){
+					vals.put(names[i], names[i]);
+				}
+				
+			}
+		}
+		
+	}
+
 	private void reloadVoiceListPreference(PreferenceScreen screen) {
 		String[] entries;
 		String[] entrieValues;
@@ -516,6 +551,7 @@ public boolean onPreferenceChange(Preference preference, Object newValue) {
 				} else {
 					Toast.makeText(this, R.string.renderer_load_exception, Toast.LENGTH_SHORT).show();
 				}
+				createCustomRenderingProperties();
 			}
 		} else if(preference == applicationDir){
 			warnAboutChangingStorage((String) newValue);
diff --git a/OsmAnd/src/net/osmand/plus/render/MapRenderRepositories.java b/OsmAnd/src/net/osmand/plus/render/MapRenderRepositories.java
index 853ffa4795b..6697d7aab3a 100644
--- a/OsmAnd/src/net/osmand/plus/render/MapRenderRepositories.java
+++ b/OsmAnd/src/net/osmand/plus/render/MapRenderRepositories.java
@@ -32,10 +32,12 @@
 import net.osmand.osm.MapUtils;
 import net.osmand.osm.MultyPolygon;
 import net.osmand.plus.OsmandSettings;
+import net.osmand.plus.OsmandSettings.CommonPreference;
 import net.osmand.plus.R;
 import net.osmand.plus.RotatedTileBox;
 import net.osmand.plus.activities.OsmandApplication;
 import net.osmand.plus.render.OsmandRenderer.RenderingContext;
+import net.osmand.render.RenderingRuleProperty;
 import net.osmand.render.RenderingRuleSearchRequest;
 import net.osmand.render.RenderingRulesStorage;
 
@@ -371,10 +373,23 @@ public synchronized void loadMap(RotatedTileBox tileRect, List<IMapDownloaderCal
 			// boolean moreDetail = prefs.SHOW_MORE_MAP_DETAIL.get();
 			RenderingRulesStorage storage = app.getRendererRegistry().getCurrentSelectedRenderer();
 			RenderingRuleSearchRequest renderingReq = new RenderingRuleSearchRequest(storage);
-			// TODO pass all global parameters
 			renderingReq.setBooleanFilter(renderingReq.ALL.R_NIGHT_MODE, nightMode);
-			if (renderingReq.ALL.get("appName") != null && !Algoritms.isEmpty(app.getSettings().RENDERER_APP_NAME.get())) {
-				renderingReq.setStringFilter(renderingReq.ALL.get("appName"), app.getSettings().RENDERER_APP_NAME.get());
+			for (RenderingRuleProperty customProp : storage.PROPS.getCustomRules()) {
+				CommonPreference<String> settings = app.getSettings().getCustomRenderProperty(customProp.getAttrName());
+				String res = settings.get();
+				if (!Algoritms.isEmpty(res)) {
+					if (customProp.isString()) {
+						renderingReq.setStringFilter(customProp, res);
+					} else if (customProp.isBoolean()) {
+						renderingReq.setBooleanFilter(customProp, "true".equalsIgnoreCase(res));
+					} else {
+						try {
+							renderingReq.setIntFilter(customProp, Integer.parseInt(res));
+						} catch (NumberFormatException e) {
+							e.printStackTrace();
+						}
+					}
+				}
 			}
 			renderingReq.saveState();
 
@@ -423,17 +438,14 @@ public synchronized void loadMap(RotatedTileBox tileRect, List<IMapDownloaderCal
 
 			Bitmap bmp = Bitmap.createBitmap(currentRenderingContext.width, currentRenderingContext.height, Config.RGB_565);
 
-			boolean stepByStep = prefs.USE_STEP_BY_STEP_RENDERING.get();
 			// 1. generate image step by step
-			if (stepByStep) {
-				this.prevBmp = this.bmp;
-				this.prevBmpLocation = this.bmpLocation;
-				this.bmp = bmp;
-				this.bmpLocation = tileRect;
-			}
+			this.prevBmp = this.bmp;
+			this.prevBmpLocation = this.bmpLocation;
+			this.bmp = bmp;
+			this.bmpLocation = tileRect;
 
 			renderer.generateNewBitmap(currentRenderingContext, cObjects, bmp, prefs.USE_ENGLISH_NAMES.get(), renderingReq,
-					stepByStep ? notifyList : null, storage.getBgColor(nightMode));
+					notifyList, storage.getBgColor(nightMode));
 			String renderingDebugInfo = currentRenderingContext.renderingDebugInfo;
 			if (checkWhetherInterrupted()) {
 				currentRenderingContext = null;
@@ -442,13 +454,8 @@ public synchronized void loadMap(RotatedTileBox tileRect, List<IMapDownloaderCal
 			currentRenderingContext = null;
 
 			// 2. replace whole image
-			if (!stepByStep) {
-				this.bmp = bmp;
-				this.bmpLocation = tileRect;
-			} else {
-				this.prevBmp = null;
-				this.prevBmpLocation = null;
-			}
+			this.prevBmp = null;
+			this.prevBmpLocation = null;
 			if (prefs.DEBUG_RENDERING_INFO.get()) {
 				String timeInfo = "Search done in " + searchTime + " ms"; //$NON-NLS-1$//$NON-NLS-2$//$NON-NLS-3$
 				if (renderingDebugInfo != null) {
diff --git a/OsmAnd/src/net/osmand/plus/render/RendererRegistry.java b/OsmAnd/src/net/osmand/plus/render/RendererRegistry.java
index 3a6c6c1c4e4..859e1994bbb 100644
--- a/OsmAnd/src/net/osmand/plus/render/RendererRegistry.java
+++ b/OsmAnd/src/net/osmand/plus/render/RendererRegistry.java
@@ -81,22 +81,22 @@ private RenderingRulesStorage loadRenderer(String name, Set<String> loadedRender
 		} else {
 			throw new IllegalArgumentException("Not found " + name); //$NON-NLS-1$
 		}
-		RenderingRulesStorage b = new RenderingRulesStorage();
-		b.parseRulesFromXmlInputStream(is);
+		RenderingRulesStorage main = new RenderingRulesStorage();
+		main.parseRulesFromXmlInputStream(is);
 		loadedRenderers.add(name);
-		if(!Algoritms.isEmpty(b.getDepends())){
-			if (loadedRenderers.contains(b.getDepends())) {
+		if(!Algoritms.isEmpty(main.getDepends())){
+			if (loadedRenderers.contains(main.getDepends())) {
 				log.warn("Circular dependencies found " + name); //$NON-NLS-1$
 			} else {
-				RenderingRulesStorage dep = getRenderer(b.getDepends(), loadedRenderers);
+				RenderingRulesStorage dep = getRenderer(main.getDepends(), loadedRenderers);
 				if (dep == null) {
 					log.warn("Dependent renderer not found : "  + name); //$NON-NLS-1$
 				}
-				// TODO set dependent renders
+				main.setDependsStorage(dep);
 			}
 		}
-		renderers.put(name, b);
-		return b;
+		renderers.put(name, main);
+		return main;
 	}
 	
 	
