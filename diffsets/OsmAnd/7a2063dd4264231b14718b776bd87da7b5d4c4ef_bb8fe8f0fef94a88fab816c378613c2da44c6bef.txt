diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
index 491ca5d05ce..4aba928fe6f 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
@@ -61,6 +61,7 @@
 import net.osmand.plus.plugins.osmedit.dialogs.DismissRouteBottomSheetFragment;
 import net.osmand.plus.profiles.data.ProfileDataObject;
 import net.osmand.plus.profiles.data.RoutingDataUtils;
+import net.osmand.plus.profiles.data.RoutingProfilesHolder;
 import net.osmand.plus.routepreparationmenu.WaypointsFragment;
 import net.osmand.plus.routing.GPXRouteParams.GPXRouteParamsBuilder;
 import net.osmand.plus.routing.RoutingHelper;
@@ -93,7 +94,6 @@
 import java.util.ArrayList;
 import java.util.Date;
 import java.util.List;
-import java.util.Map;
 
 import static net.osmand.IndexConstants.GPX_FILE_EXT;
 import static net.osmand.aidlapi.OsmAndCustomizationConstants.DRAWER_AV_NOTES_ID;
@@ -580,12 +580,12 @@ private ContextMenuAdapter createSwitchProfileOptionsMenu(@NonNull OsmandApplica
 
 		String modeDescription;
 
-		Map<String, ProfileDataObject> profilesObjects = routingDataUtils.getRoutingProfiles();
+		RoutingProfilesHolder profiles = routingDataUtils.getRoutingProfiles();
 		for (final ApplicationMode appMode : activeModes) {
 			if (appMode.isCustomProfile()) {
-				modeDescription = getProfileDescription(app, appMode, profilesObjects, getString(R.string.profile_type_user_string));
+				modeDescription = getProfileDescription(app, appMode, profiles, getString(R.string.profile_type_user_string));
 			} else {
-				modeDescription = getProfileDescription(app, appMode, profilesObjects, getString(R.string.profile_type_osmand_string));
+				modeDescription = getProfileDescription(app, appMode, profiles, getString(R.string.profile_type_osmand_string));
 			}
 
 			int tag = currentMode.equals(appMode) ? PROFILES_CHOSEN_PROFILE_TAG : PROFILES_NORMAL_PROFILE_TAG;
@@ -835,11 +835,11 @@ private void createProfilesController(final OsmandApplication app, ContextMenuAd
 		//switch profile button
 		ApplicationMode currentMode = app.getSettings().APPLICATION_MODE.get();
 		String modeDescription;
-		Map<String, ProfileDataObject> profilesObjects = routingDataUtils.getRoutingProfiles();
+		RoutingProfilesHolder profiles = routingDataUtils.getRoutingProfiles();
 		if (currentMode.isCustomProfile()) {
-			modeDescription = getProfileDescription(app, currentMode, profilesObjects, getString(R.string.profile_type_user_string));
+			modeDescription = getProfileDescription(app, currentMode, profiles, getString(R.string.profile_type_user_string));
 		} else {
-			modeDescription = getProfileDescription(app, currentMode, profilesObjects, getString(R.string.profile_type_osmand_string));
+			modeDescription = getProfileDescription(app, currentMode, profiles, getString(R.string.profile_type_osmand_string));
 		}
 
 		int icArrowResId = listExpanded ? R.drawable.ic_action_arrow_drop_up : R.drawable.ic_action_arrow_drop_down;
@@ -867,16 +867,17 @@ private void createProfilesController(final OsmandApplication app, ContextMenuAd
 				}));
 	}
 
-	private String getProfileDescription(OsmandApplication app, ApplicationMode mode,
-										 Map<String, ProfileDataObject> profilesObjects, String defaultDescription) {
+	private String getProfileDescription(@NonNull OsmandApplication app, @NonNull ApplicationMode mode,
+	                                     @NonNull RoutingProfilesHolder profiles,
+	                                     @NonNull String defaultDescription) {
 		String description = defaultDescription;
-
 		String routingProfileKey = mode.getRoutingProfile();
+		String derivedProfile = mode.getDerivedProfile();
 		if (!Algorithms.isEmpty(routingProfileKey)) {
-			ProfileDataObject profileDataObject = profilesObjects.get(routingProfileKey);
-			if (profileDataObject != null) {
+			ProfileDataObject profile = profiles.get(routingProfileKey, derivedProfile);
+			if (profile != null) {
 				description = String.format(app.getString(R.string.profile_type_descr_string),
-						Algorithms.capitalizeFirstLetterAndLowercase(profileDataObject.getName()));
+						Algorithms.capitalizeFirstLetterAndLowercase(profile.getName()));
 			}
 		}
 		return description;
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java b/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java
index 9c99ed963e9..39101aea262 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectNavProfileBottomSheet.java
@@ -1,7 +1,6 @@
 package net.osmand.plus.profiles;
 
 import android.graphics.drawable.Drawable;
-import android.os.Build;
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -16,10 +15,8 @@
 import androidx.fragment.app.FragmentActivity;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.CallbackWithObject;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.LongDescriptionItem;
@@ -35,6 +32,8 @@
 import net.osmand.plus.profiles.data.RoutingDataObject;
 import net.osmand.plus.profiles.data.RoutingDataUtils;
 import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.widgets.multistatetoggle.TextToggleButton.TextRadioItem;
 import net.osmand.router.RoutingConfiguration.Builder;
 import net.osmand.util.Algorithms;
@@ -174,10 +173,10 @@ private void tryDownloadPredefinedItems() {
 
 	private void createProfilesList() {
 		for (ProfilesGroup group : profileGroups) {
-			List<ProfileDataObject> items = group.getProfiles();
+			List<RoutingDataObject> items = group.getProfiles();
 			if (!Algorithms.isEmpty(items)) {
 				addGroupHeader(group.getTitle(), group.getDescription(app, nightMode));
-				for (ProfileDataObject item : items) {
+				for (RoutingDataObject item : items) {
 					addProfileItem(item);
 				}
 				addDivider();
@@ -254,10 +253,8 @@ protected void addProfileItem(ProfileDataObject profileDataObject) {
 
 			ImageView ivEndBtnIcon = itemView.findViewById(R.id.end_button_icon);
 			Drawable drawable = getIcon(R.drawable.ic_action_settings, getRouteInfoColorId());
-			if (Build.VERSION.SDK_INT >= 21) {
-				Drawable activeDrawable = getIcon(R.drawable.ic_action_settings, getActiveColorId());
-				drawable = AndroidUtils.createPressedStateListDrawable(drawable, activeDrawable);
-			}
+			Drawable activeDrawable = getIcon(R.drawable.ic_action_settings, getActiveColorId());
+			drawable = AndroidUtils.createPressedStateListDrawable(drawable, activeDrawable);
 			ivEndBtnIcon.setImageDrawable(drawable);
 
 			basePart.setOnClickListener(getItemClickListener(profile));
@@ -293,6 +290,17 @@ protected boolean isProfilesListUpdated(ProfileDataObject profile) {
 		return profile instanceof RoutingDataObject && ((RoutingDataObject) profile).isOnline();
 	}
 
+	@Override
+	protected boolean isSelected(ProfileDataObject profile) {
+		boolean isSelected = super.isSelected(profile);
+		String derivedProfile = getAppMode().getDerivedProfile();
+		if (!Algorithms.objectEquals(derivedProfile, "default") && profile instanceof RoutingDataObject) {
+			RoutingDataObject data = (RoutingDataObject) profile;
+			isSelected = isSelected && Algorithms.objectEquals(derivedProfile, data.getDerivedProfile());
+		}
+		return isSelected;
+	}
+
 	@Override
 	protected void refreshProfiles() {
 		profileGroups.clear();
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectOnlineApproxProfileBottomSheet.java b/OsmAnd/src/net/osmand/plus/profiles/SelectOnlineApproxProfileBottomSheet.java
index 9eb0f84170c..c6621d4a5ae 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectOnlineApproxProfileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectOnlineApproxProfileBottomSheet.java
@@ -14,6 +14,7 @@
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
 import net.osmand.plus.profiles.data.ProfileDataObject;
 import net.osmand.plus.profiles.data.ProfilesGroup;
+import net.osmand.plus.profiles.data.RoutingDataObject;
 import net.osmand.plus.profiles.data.RoutingDataUtils;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.util.Algorithms;
@@ -63,10 +64,10 @@ public void createMenuItems(@Nullable Bundle savedInstanceState) {
 
 	private void createProfilesList() {
 		for (ProfilesGroup group : profileGroups) {
-			List<ProfileDataObject> items = group.getProfiles();
+			List<RoutingDataObject> items = group.getProfiles();
 			if (!Algorithms.isEmpty(items)) {
 				addGroupHeader(group.getTitle(), group.getDescription(app, nightMode));
-				for (ProfileDataObject item : items) {
+				for (RoutingDataObject item : items) {
 					addProfileItem(item);
 				}
 				addDivider();
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java b/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java
index f285e29d988..93be4eb1add 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectProfileBottomSheet.java
@@ -26,6 +26,7 @@
 import androidx.core.content.ContextCompat;
 import androidx.fragment.app.Fragment;
 
+import net.osmand.plus.profiles.data.RoutingDataObject;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.OsmandApplication;
@@ -52,6 +53,7 @@ public abstract class SelectProfileBottomSheet extends BasePreferenceBottomSheet
 	public final static String PROFILE_KEY_ARG = "profile_key_arg";
 	public final static String USE_LAST_PROFILE_ARG = "use_last_profile_arg";
 	public final static String PROFILES_LIST_UPDATED_ARG = "is_profiles_list_updated";
+	public final static String DERIVED_PROFILE_ARG = "derived_profile";
 
 	protected OsmandApplication app;
 	protected String selectedItemKey;
@@ -233,6 +235,9 @@ protected void onItemSelected(ProfileDataObject profile) {
 		Bundle args = new Bundle();
 		args.putString(PROFILE_KEY_ARG, profile.getStringKey());
 		args.putBoolean(PROFILES_LIST_UPDATED_ARG, isProfilesListUpdated(profile));
+		if (profile instanceof RoutingDataObject) {
+			args.putString(DERIVED_PROFILE_ARG, ((RoutingDataObject) profile).getDerivedProfile());
+		}
 		Fragment target = getTargetFragment();
 		if (target instanceof OnSelectProfileCallback) {
 			((OnSelectProfileCallback) target).onProfileSelected(args);
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/OnlineRoutingDataObject.java b/OsmAnd/src/net/osmand/plus/profiles/data/OnlineRoutingDataObject.java
index 1d08b19b604..ec5ac61fc3f 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/data/OnlineRoutingDataObject.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/OnlineRoutingDataObject.java
@@ -12,7 +12,7 @@ public OnlineRoutingDataObject(String name,
 	                               String description,
 	                               String stringKey,
 	                               int iconRes) {
-		super(stringKey, name, description, iconRes, false, null);
+		super(stringKey, name, description, iconRes, false, null, null);
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/PredefinedProfilesGroup.java b/OsmAnd/src/net/osmand/plus/profiles/data/PredefinedProfilesGroup.java
index d353d7d3ac5..b33276d63c6 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/data/PredefinedProfilesGroup.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/PredefinedProfilesGroup.java
@@ -23,11 +23,11 @@
 
 public class PredefinedProfilesGroup extends ProfilesGroup {
 
-	private String type;
+	private final String type;
 
 	public PredefinedProfilesGroup(@NonNull String title,
 	                               @NonNull String type,
-	                               @NonNull List<ProfileDataObject> profiles) {
+	                               @NonNull List<RoutingDataObject> profiles) {
 		super(title, profiles);
 		this.type = type;
 	}
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/ProfilesGroup.java b/OsmAnd/src/net/osmand/plus/profiles/data/ProfilesGroup.java
index ad495ed0802..8f5abf141ad 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/data/ProfilesGroup.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/ProfilesGroup.java
@@ -10,10 +10,10 @@ public class ProfilesGroup {
 
 	protected CharSequence title;
 	protected CharSequence description;
-	protected List<ProfileDataObject> profiles;
+	protected List<RoutingDataObject> profiles;
 
 	public ProfilesGroup(@NonNull String title,
-	                     @NonNull List<ProfileDataObject> profiles) {
+	                     @NonNull List<RoutingDataObject> profiles) {
 		this.title = title;
 		this.profiles = profiles;
 	}
@@ -31,7 +31,7 @@ public void setDescription(CharSequence description) {
 		this.description = description;
 	}
 
-	public List<ProfileDataObject> getProfiles() {
+	public List<RoutingDataObject> getProfiles() {
 		return profiles;
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataObject.java b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataObject.java
index 54bed5ceede..3728a575b49 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataObject.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataObject.java
@@ -1,29 +1,31 @@
 package net.osmand.plus.profiles.data;
 
-import net.osmand.plus.R;
 
-import java.util.ArrayList;
-import java.util.List;
+public class RoutingDataObject extends ProfileDataObject implements Cloneable {
 
-
-public class RoutingDataObject extends ProfileDataObject {
-
-	private String fileName;
+	private final String fileName;
+	private final String derivedProfile;
 
 	public RoutingDataObject(String stringKey,
 	                         String name,
 	                         String description,
 	                         int iconRes,
 	                         boolean isSelected,
-	                         String fileName) {
+	                         String fileName,
+	                         String derivedProfile) {
 		super(name, description, stringKey, iconRes, isSelected, null, null);
 		this.fileName = fileName;
+		this.derivedProfile = derivedProfile;
 	}
 
 	public String getFileName() {
 		return fileName;
 	}
 
+	public String getDerivedProfile() {
+		return derivedProfile;
+	}
+
 	public boolean isOnline() {
 		return false;
 	}
@@ -32,46 +34,4 @@ public boolean isPredefined() {
 		return false;
 	}
 
-	public enum RoutingProfilesResources {
-		DIRECT_TO_MODE(R.string.routing_profile_direct_to, R.drawable.ic_action_navigation_type_direct_to),
-		STRAIGHT_LINE_MODE(R.string.routing_profile_straightline, R.drawable.ic_action_split_interval),
-		BROUTER_MODE(R.string.routing_profile_broutrer, R.drawable.ic_action_split_interval),
-		CAR(R.string.rendering_value_car_name, R.drawable.ic_action_car_dark),
-		PEDESTRIAN(R.string.rendering_value_pedestrian_name, R.drawable.ic_action_pedestrian_dark),
-		BICYCLE(R.string.rendering_value_bicycle_name, R.drawable.ic_action_bicycle_dark),
-		SKI(R.string.routing_profile_ski, R.drawable.ic_action_skiing),
-		PUBLIC_TRANSPORT(R.string.app_mode_public_transport, R.drawable.ic_action_bus_dark),
-		BOAT(R.string.app_mode_boat, R.drawable.ic_action_sail_boat_dark),
-		HORSEBACKRIDING(R.string.horseback_riding, R.drawable.ic_action_horse),
-		GEOCODING(R.string.routing_profile_geocoding, R.drawable.ic_action_world_globe);
-
-		int stringRes;
-		int iconRes;
-
-		RoutingProfilesResources(int stringRes, int iconRes) {
-			this.stringRes = stringRes;
-			this.iconRes = iconRes;
-		}
-
-		public int getStringRes() {
-			return stringRes;
-		}
-
-		public int getIconRes() {
-			return iconRes;
-		}
-
-		private static final List<String> rpValues = new ArrayList<>();
-
-		static {
-			for (RoutingProfilesResources rpr : RoutingProfilesResources.values()) {
-				rpValues.add(rpr.name());
-			}
-		}
-
-		public static boolean isRpValue(String value) {
-			return rpValues.contains(value);
-		}
-	}
-
 }
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataUtils.java b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataUtils.java
index c6508d111d7..06d38fc6847 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataUtils.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingDataUtils.java
@@ -1,5 +1,6 @@
 package net.osmand.plus.profiles.data;
 
+import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
 import net.osmand.CallbackWithObject;
@@ -9,7 +10,7 @@
 import net.osmand.plus.R;
 import net.osmand.plus.onlinerouting.OnlineRoutingHelper;
 import net.osmand.plus.onlinerouting.engine.OnlineRoutingEngine;
-import net.osmand.plus.profiles.data.RoutingDataObject.RoutingProfilesResources;
+import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.router.GeneralRouter;
 import net.osmand.router.RoutingConfiguration;
 import net.osmand.util.Algorithms;
@@ -25,6 +26,11 @@
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
+import java.util.Objects;
+
+import static net.osmand.plus.profiles.data.RoutingProfilesResources.BROUTER_MODE;
+import static net.osmand.plus.profiles.data.RoutingProfilesResources.DIRECT_TO_MODE;
+import static net.osmand.plus.profiles.data.RoutingProfilesResources.STRAIGHT_LINE_MODE;
 
 public class RoutingDataUtils {
 
@@ -34,13 +40,16 @@ public class RoutingDataUtils {
 
 	public static final String OSMAND_NAVIGATION = "osmand_navigation";
 
+	public static final String DERIVED_PROFILES = "derivedProfiles";
+	public static final String GEOCODING = "geocoding";
 	public static final String PROVIDERS = "providers";
+	public static final String DEFAULT = "default";
 	public static final String ROUTES = "routes";
 	public static final String NAME = "name";
 	public static final String TYPE = "type";
 	public static final String URL = "url";
 
-	private OsmandApplication app;
+	private final OsmandApplication app;
 
 	public RoutingDataUtils(OsmandApplication app) {
 		this.app = app;
@@ -48,18 +57,25 @@ public RoutingDataUtils(OsmandApplication app) {
 
 	public List<ProfilesGroup> getOfflineProfiles() {
 		List<ProfilesGroup> result = new ArrayList<>();
-		Map<String, List<ProfileDataObject>> byFileNames = getOfflineRoutingProfilesByFileNames();
-		result.add(new ProfilesGroup(getString(R.string.app_name_osmand), byFileNames.get(OSMAND_NAVIGATION)));
+		Map<String, RoutingFile> byFileNames = getOfflineRoutingFilesByNames();
+		result.add(createProfilesGroup(R.string.app_name_osmand, byFileNames.remove(OSMAND_NAVIGATION)));
 		for (String key : byFileNames.keySet()) {
-			if (!key.equals(OSMAND_NAVIGATION)) {
-				result.add(new ProfilesGroup(key, byFileNames.get(key)));
-			}
+			result.add(createProfilesGroup(key, byFileNames.remove(key)));
 		}
 		result.add(new ProfilesGroup(getString(R.string.shared_string_external), getExternalRoutingProfiles()));
 		sortItems(result);
 		return result;
 	}
 
+	private ProfilesGroup createProfilesGroup(int titleId, @Nullable RoutingFile file) {
+		return createProfilesGroup(getString(titleId), file);
+	}
+
+	private ProfilesGroup createProfilesGroup(@NonNull String title, @Nullable RoutingFile file) {
+		assert file != null;
+		return new ProfilesGroup(title, file.getProfiles());
+	}
+
 	public List<ProfilesGroup> getOnlineProfiles(@Nullable List<ProfilesGroup> predefined) {
 		List<ProfilesGroup> result = new ArrayList<>();
 		if (!Algorithms.isEmpty(predefined)) {
@@ -70,59 +86,57 @@ public List<ProfilesGroup> getOnlineProfiles(@Nullable List<ProfilesGroup> prede
 		return result;
 	}
 
-	public Map<String, ProfileDataObject> getRoutingProfiles() {
-		List<ProfileDataObject> profiles = new ArrayList<>();
+	public RoutingProfilesHolder getRoutingProfiles() {
+		List<RoutingDataObject> profiles = new ArrayList<>();
 		profiles.addAll(getOfflineRoutingProfiles());
 		profiles.addAll(getExternalRoutingProfiles());
 		profiles.addAll(getOnlineRoutingProfiles(false));
 
-		Map<String, ProfileDataObject> result = new HashMap<>();
-		for (ProfileDataObject onlineEngine : profiles) {
-			result.put(onlineEngine.getStringKey(), onlineEngine);
+		RoutingProfilesHolder result = new RoutingProfilesHolder();
+		for (RoutingDataObject profile : profiles) {
+			result.add(profile);
 		}
 		return result;
 	}
 
-	private Map<String, List<ProfileDataObject>> getOfflineRoutingProfilesByFileNames() {
-		Map<String, List<ProfileDataObject>> result = new HashMap<>();
-		for (final ProfileDataObject profile : getOfflineRoutingProfiles()) {
-			String fileName = null;
-			if (profile instanceof RoutingDataObject) {
-				fileName = ((RoutingDataObject) profile).getFileName();
+	private Map<String, RoutingFile> getOfflineRoutingFilesByNames() {
+		Map<String, RoutingFile> map = new HashMap<>();
+		for (final RoutingDataObject profile : getOfflineRoutingProfiles()) {
+			String fileName = profile.getFileName();
+			if (fileName == null) {
+				fileName = OSMAND_NAVIGATION;
 			}
-			fileName = fileName != null ? fileName : OSMAND_NAVIGATION;
-			if (result.containsKey(fileName)) {
-				result.get(fileName).add(profile);
+			if (map.containsKey(fileName)) {
+				RoutingFile file = Objects.requireNonNull(map.get(fileName));
+				file.addProfile(profile);
 			} else {
-				result.put(fileName, new ArrayList<ProfileDataObject>() {
-					{ add(profile); }
-				});
+				RoutingFile file = new RoutingFile(fileName);
+				file.addProfile(profile);
+				map.put(fileName, file);
 			}
 		}
-		return result;
+		return map;
 	}
 
-	private List<ProfileDataObject> getOfflineRoutingProfiles() {
-		List<ProfileDataObject> result = new ArrayList<>();
-		result.add(new RoutingDataObject(
-				RoutingProfilesResources.STRAIGHT_LINE_MODE.name(),
-				getString(RoutingProfilesResources.STRAIGHT_LINE_MODE.getStringRes()),
+	private List<RoutingDataObject> getOfflineRoutingProfiles() {
+		List<RoutingDataObject> result = new ArrayList<>();
+		result.add(new RoutingDataObject(STRAIGHT_LINE_MODE.name(),
+				getString(STRAIGHT_LINE_MODE.getStringRes()),
 				getString(R.string.special_routing_type),
-				RoutingProfilesResources.STRAIGHT_LINE_MODE.getIconRes(),
-				false, null));
-		result.add(new RoutingDataObject(
-				RoutingProfilesResources.DIRECT_TO_MODE.name(),
-				getString(RoutingProfilesResources.DIRECT_TO_MODE.getStringRes()),
+				STRAIGHT_LINE_MODE.getIconRes(),
+				false, null, null));
+		result.add(new RoutingDataObject(DIRECT_TO_MODE.name(),
+				getString(DIRECT_TO_MODE.getStringRes()),
 				getString(R.string.special_routing_type),
-				RoutingProfilesResources.DIRECT_TO_MODE.getIconRes(),
-				false, null));
+				DIRECT_TO_MODE.getIconRes(),
+				false, null, null));
 
 		List<String> disabledRouterNames = OsmandPlugin.getDisabledRouterNames();
 		for (RoutingConfiguration.Builder builder : app.getAllRoutingConfigs()) {
 			for (Map.Entry<String, GeneralRouter> entry : builder.getAllRouters().entrySet()) {
 				String routerKey = entry.getKey();
 				GeneralRouter router = entry.getValue();
-				if (!routerKey.equals("geocoding") && !disabledRouterNames.contains(router.getFilename())) {
+				if (!Algorithms.objectEquals(routerKey, GEOCODING) && !disabledRouterNames.contains(router.getFilename())) {
 					int iconRes = R.drawable.ic_action_gdirections_dark;
 					String name = router.getProfileName();
 					String fileName = router.getFilename();
@@ -133,22 +147,57 @@ private List<ProfileDataObject> getOfflineRoutingProfiles() {
 						iconRes = RoutingProfilesResources.valueOf(name.toUpperCase()).getIconRes();
 						name = getString(RoutingProfilesResources.valueOf(name.toUpperCase()).getStringRes());
 					}
-					result.add(new RoutingDataObject(routerKey, name, description, iconRes, false, fileName));
+					RoutingDataObject data = new RoutingDataObject(routerKey, name, description, iconRes, false, fileName, null);
+					result.add(data);
+					String sDerivedProfiles = router.getAttribute(DERIVED_PROFILES);
+					if (!Algorithms.isEmpty(sDerivedProfiles)) {
+						for (String derivedProfile : sDerivedProfiles.split(",")) {
+							if (Algorithms.objectEquals(derivedProfile, DEFAULT)) {
+								continue;
+							}
+							result.add(createDerivedProfile(data, derivedProfile));
+						}
+					}
 				}
 			}
 		}
 		return result;
 	}
 
-	private List<ProfileDataObject> getExternalRoutingProfiles() {
-		List<ProfileDataObject> result = new ArrayList<>();
+	private RoutingDataObject createDerivedProfile(@NonNull RoutingDataObject original, @NonNull String derivedProfile) {
+		String translationKey = "app_mode_" + derivedProfile;
+		String localizedProfileName = AndroidUtils.getStringByProperty(app, translationKey);
+		String name = translationKey.equals(localizedProfileName) ? Algorithms.capitalizeFirstLetter(translationKey) : localizedProfileName;
+		int iconRes = getIconResForDerivedProfile(derivedProfile);
+		return new RoutingDataObject(
+				original.getStringKey(), name, original.getDescription(),
+				iconRes, original.isSelected(), original.getFileName(),
+				derivedProfile
+		);
+	}
+
+	private int getIconResForDerivedProfile(@NonNull String derivedProfile) {
+		String imageKey = "ic_action_" + derivedProfile;
+		int iconId = AndroidUtils.getDrawableId(app, imageKey);
+		if (iconId != 0) {
+			return iconId;
+		}
+		// We need to check twice for legacy reasons: some icons have the _dark suffix
+		iconId = AndroidUtils.getDrawableId(app, imageKey + "_dark");
+		if (iconId != 0) {
+			return iconId;
+		}
+		return R.drawable.ic_action_gdirections_dark;
+	}
+
+	private List<RoutingDataObject> getExternalRoutingProfiles() {
+		List<RoutingDataObject> result = new ArrayList<>();
 		if (app.getBRouterService() != null) {
-			result.add(new RoutingDataObject(
-					RoutingProfilesResources.BROUTER_MODE.name(),
-					getString(RoutingProfilesResources.BROUTER_MODE.getStringRes()),
+			result.add(new RoutingDataObject(BROUTER_MODE.name(),
+					getString(BROUTER_MODE.getStringRes()),
 					getString(R.string.third_party_routing_type),
-					RoutingProfilesResources.BROUTER_MODE.getIconRes(),
-					false, null));
+					BROUTER_MODE.getIconRes(),
+					false, null, null));
 		}
 		return result;
 	}
@@ -163,9 +212,9 @@ public ProfileDataObject getOnlineEngineByKey(String stringKey) {
 		return null;
 	}
 
-	private List<ProfileDataObject> getOnlineRoutingProfiles(boolean onlyCustom) {
+	private List<RoutingDataObject> getOnlineRoutingProfiles(boolean onlyCustom) {
 		OnlineRoutingHelper helper = app.getOnlineRoutingHelper();
-		List<ProfileDataObject> objects = new ArrayList<>();
+		List<RoutingDataObject> objects = new ArrayList<>();
 		List<OnlineRoutingEngine> engines = onlyCustom ? helper.getOnlyCustomEngines() : helper.getEngines();
 		for (int i = 0; i < engines.size(); i++) {
 			OnlineRoutingDataObject profile = convertOnlineEngineToDataObject(engines.get(i));
@@ -212,7 +261,7 @@ private List<ProfilesGroup> parsePredefinedEnginesImpl(String content) throws JS
 			String providerType = groupObject.getString(TYPE);
 			String providerUrl = groupObject.getString(URL);
 			JSONArray items = groupObject.getJSONArray(ROUTES);
-			List<ProfileDataObject> engines = new ArrayList<>();
+			List<RoutingDataObject> engines = new ArrayList<>();
 			for (int j = 0; j < items.length(); j++) {
 				JSONObject item = items.getJSONObject(j);
 				String engineName = item.getString(NAME);
@@ -240,7 +289,7 @@ private String getString(int id) {
 
 	private static void sortItems(List<ProfilesGroup> groups) {
 		for (ProfilesGroup group : groups) {
-			List<ProfileDataObject> profiles = group.getProfiles();
+			List<RoutingDataObject> profiles = group.getProfiles();
 			if (!Algorithms.isEmpty(profiles)) {
 				Collections.sort(profiles);
 			}
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/RoutingFile.java b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingFile.java
new file mode 100644
index 00000000000..8855049615e
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingFile.java
@@ -0,0 +1,27 @@
+package net.osmand.plus.profiles.data;
+
+import androidx.annotation.NonNull;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class RoutingFile {
+	private final String fileName;
+	private final List<RoutingDataObject> profiles = new ArrayList<>();
+
+	public RoutingFile(String fileName) {
+		this.fileName = fileName;
+	}
+
+	public String getFileName() {
+		return fileName;
+	}
+
+	public List<RoutingDataObject> getProfiles() {
+		return profiles;
+	}
+
+	public void addProfile(@NonNull RoutingDataObject profile) {
+		profiles.add(profile);
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/RoutingProfilesHolder.java b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingProfilesHolder.java
new file mode 100644
index 00000000000..e9076cc40eb
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingProfilesHolder.java
@@ -0,0 +1,36 @@
+package net.osmand.plus.profiles.data;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
+import java.util.HashMap;
+import java.util.Map;
+
+public class RoutingProfilesHolder {
+
+	private final Map<String, RoutingDataObject> map = new HashMap<>();
+
+	@Nullable
+	public RoutingDataObject get(@NonNull String routingProfileKey, @Nullable String derivedProfile) {
+		return map.get(createFullKey(routingProfileKey, derivedProfile));
+	}
+
+	public void add(@NonNull RoutingDataObject profile) {
+		map.put(createFullKey(profile.getStringKey(), profile.getDerivedProfile()), profile);
+	}
+
+	public void setSelected(@NonNull RoutingDataObject selected) {
+		for (RoutingDataObject profile : map.values()) {
+			profile.setSelected(false);
+		}
+		selected.setSelected(true);
+	}
+
+	private String createFullKey(@NonNull String routingProfileKey, @Nullable String derivedProfile) {
+		if (derivedProfile == null) {
+			derivedProfile = "default";
+		}
+		return routingProfileKey + "_" + derivedProfile;
+	}
+
+}
diff --git a/OsmAnd/src/net/osmand/plus/profiles/data/RoutingProfilesResources.java b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingProfilesResources.java
new file mode 100644
index 00000000000..944190d7190
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/profiles/data/RoutingProfilesResources.java
@@ -0,0 +1,48 @@
+package net.osmand.plus.profiles.data;
+
+import net.osmand.plus.R;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public enum RoutingProfilesResources {
+	DIRECT_TO_MODE(R.string.routing_profile_direct_to, R.drawable.ic_action_navigation_type_direct_to),
+	STRAIGHT_LINE_MODE(R.string.routing_profile_straightline, R.drawable.ic_action_split_interval),
+	BROUTER_MODE(R.string.routing_profile_broutrer, R.drawable.ic_action_split_interval),
+	CAR(R.string.rendering_value_car_name, R.drawable.ic_action_car_dark),
+	PEDESTRIAN(R.string.rendering_value_pedestrian_name, R.drawable.ic_action_pedestrian_dark),
+	BICYCLE(R.string.rendering_value_bicycle_name, R.drawable.ic_action_bicycle_dark),
+	SKI(R.string.routing_profile_ski, R.drawable.ic_action_skiing),
+	PUBLIC_TRANSPORT(R.string.app_mode_public_transport, R.drawable.ic_action_bus_dark),
+	BOAT(R.string.app_mode_boat, R.drawable.ic_action_sail_boat_dark),
+	HORSEBACKRIDING(R.string.horseback_riding, R.drawable.ic_action_horse),
+	GEOCODING(R.string.routing_profile_geocoding, R.drawable.ic_action_world_globe);
+
+	int stringRes;
+	int iconRes;
+
+	RoutingProfilesResources(int stringRes, int iconRes) {
+		this.stringRes = stringRes;
+		this.iconRes = iconRes;
+	}
+
+	public int getStringRes() {
+		return stringRes;
+	}
+
+	public int getIconRes() {
+		return iconRes;
+	}
+
+	private static final List<String> rpValues = new ArrayList<>();
+
+	static {
+		for (RoutingProfilesResources rpr : RoutingProfilesResources.values()) {
+			rpValues.add(rpr.name());
+		}
+	}
+
+	public static boolean isRpValue(String value) {
+		return rpValues.contains(value);
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java b/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java
index 0a952e89ff0..ccb47580ce6 100644
--- a/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java
+++ b/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java
@@ -1,5 +1,11 @@
 package net.osmand.plus.settings.backend;
 
+import androidx.annotation.ColorInt;
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.core.content.ContextCompat;
+
 import com.google.gson.Gson;
 import com.google.gson.GsonBuilder;
 import com.google.gson.annotations.Expose;
@@ -25,12 +31,6 @@
 import java.util.Map;
 import java.util.Set;
 
-import androidx.annotation.ColorInt;
-import androidx.annotation.DrawableRes;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.core.content.ContextCompat;
-
 import static net.osmand.plus.views.mapwidgets.WidgetType.ALTITUDE;
 import static net.osmand.plus.views.mapwidgets.WidgetType.AVERAGE_SPEED;
 import static net.osmand.plus.views.mapwidgets.WidgetType.BATTERY;
@@ -436,6 +436,12 @@ public void setUserProfileName(String userProfileName) {
 		}
 	}
 
+	public void setDerivedProfile(String derivedProfile) {
+		if (!Algorithms.isEmpty(derivedProfile)) {
+			app.getSettings().DERIVED_PROFILE.setModeValue(this, derivedProfile);
+		}
+	}
+
 	public String getDerivedProfile() {
 		return app.getSettings().DERIVED_PROFILE.getModeValue(this);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java b/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java
index 16800597a78..f752c39c3d3 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java
@@ -30,7 +30,7 @@
 import net.osmand.plus.onlinerouting.engine.OnlineRoutingEngine;
 import net.osmand.plus.poi.PoiUIFilter;
 import net.osmand.plus.profiles.ProfileIconColors;
-import net.osmand.plus.profiles.data.RoutingDataObject.RoutingProfilesResources;
+import net.osmand.plus.profiles.data.RoutingProfilesResources;
 import net.osmand.plus.quickaction.QuickAction;
 import net.osmand.plus.render.RenderingIcons;
 import net.osmand.plus.settings.backend.ApplicationMode;
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java
index 266b448a211..290760e306e 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java
@@ -53,7 +53,7 @@
 import net.osmand.plus.plugins.osmedit.data.OsmNotesPoint;
 import net.osmand.plus.poi.PoiUIFilter;
 import net.osmand.plus.profiles.ProfileIconColors;
-import net.osmand.plus.profiles.data.RoutingDataObject.RoutingProfilesResources;
+import net.osmand.plus.profiles.data.RoutingProfilesResources;
 import net.osmand.plus.quickaction.QuickAction;
 import net.osmand.plus.render.RenderingIcons;
 import net.osmand.plus.settings.backend.ApplicationMode;
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/NavigationFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/NavigationFragment.java
index 9e4de4417fd..4ea0da6e860 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/NavigationFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/NavigationFragment.java
@@ -3,14 +3,24 @@
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
 
+import androidx.activity.OnBackPressedCallback;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentManager;
+import androidx.preference.Preference;
+import androidx.preference.SwitchPreferenceCompat;
+
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.measurementtool.MeasurementToolFragment;
 import net.osmand.plus.profiles.SelectNavProfileBottomSheet;
 import net.osmand.plus.profiles.SelectProfileBottomSheet.OnSelectProfileCallback;
 import net.osmand.plus.profiles.data.ProfileDataObject;
-import net.osmand.plus.profiles.data.RoutingDataObject.RoutingProfilesResources;
+import net.osmand.plus.profiles.data.RoutingDataObject;
 import net.osmand.plus.profiles.data.RoutingDataUtils;
+import net.osmand.plus.profiles.data.RoutingProfilesHolder;
+import net.osmand.plus.profiles.data.RoutingProfilesResources;
 import net.osmand.plus.routepreparationmenu.RouteOptionsBottomSheet;
 import net.osmand.plus.routepreparationmenu.RouteOptionsBottomSheet.DialogMode;
 import net.osmand.plus.routing.RouteService;
@@ -18,15 +28,8 @@
 import net.osmand.plus.settings.preferences.SwitchPreferenceEx;
 import net.osmand.util.Algorithms;
 
-import java.util.Map;
-
-import androidx.activity.OnBackPressedCallback;
-import androidx.fragment.app.Fragment;
-import androidx.fragment.app.FragmentManager;
-import androidx.preference.Preference;
-import androidx.preference.SwitchPreferenceCompat;
-
 import static net.osmand.plus.onlinerouting.engine.OnlineRoutingEngine.ONLINE_ROUTING_ENGINE_PREFIX;
+import static net.osmand.plus.profiles.SelectProfileBottomSheet.DERIVED_PROFILE_ARG;
 import static net.osmand.plus.profiles.SelectProfileBottomSheet.PROFILES_LIST_UPDATED_ARG;
 import static net.osmand.plus.profiles.SelectProfileBottomSheet.PROFILE_KEY_ARG;
 import static net.osmand.plus.routepreparationmenu.RouteOptionsBottomSheet.DIALOG_MODE_KEY;
@@ -39,14 +42,15 @@ public class NavigationFragment extends BaseSettingsFragment implements OnSelect
 
 	private static final String CUSTOMIZE_ROUTE_LINE = "customize_route_line";
 
-	private Map<String, ProfileDataObject> routingProfileDataObjects;
-	private Preference navigationType;
+	private RoutingProfilesHolder routingProfiles;
 	private RoutingDataUtils routingDataUtils;
+	private Preference navigationType;
 
 	@Override
 	public void onCreate(Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-		updateRoutingProfilesDataObjects();
+		routingDataUtils = new RoutingDataUtils(app);
+		updateRoutingProfiles();
 		setupOnBackPressedCallback();
 	}
 
@@ -94,12 +98,14 @@ protected void setupPreferences() {
 	}
 
 	private void setupNavigationTypePref() {
-		String routingProfileKey = getSelectedAppMode().getRoutingProfile();
+		ApplicationMode appMode = getSelectedAppMode();
+		String routingProfileKey = appMode.getRoutingProfile();
+		String derivedProfile = appMode.getDerivedProfile();
 		if (!Algorithms.isEmpty(routingProfileKey)) {
-			ProfileDataObject routingProfileDataObject = routingProfileDataObjects.get(routingProfileKey);
-			if (routingProfileDataObject != null) {
-				navigationType.setSummary(routingProfileDataObject.getName());
-				navigationType.setIcon(getActiveIcon(routingProfileDataObject.getIconRes()));
+			ProfileDataObject profile = routingProfiles.get(routingProfileKey, derivedProfile);
+			if (profile != null) {
+				navigationType.setSummary(profile.getName());
+				navigationType.setIcon(getActiveIcon(profile.getIconRes()));
 			}
 		}
 	}
@@ -153,28 +159,18 @@ public boolean onPreferenceClick(Preference preference) {
 		return false;
 	}
 
-	private void updateRoutingProfilesDataObjects() {
-		routingProfileDataObjects = getRoutingDataUtils().getRoutingProfiles();
+	private void updateRoutingProfiles() {
+		routingProfiles = routingDataUtils.getRoutingProfiles();
 	}
 
-	private RoutingDataUtils getRoutingDataUtils() {
-		if (routingDataUtils == null) {
-			routingDataUtils = new RoutingDataUtils(app);
-		}
-		return routingDataUtils;
-	}
-
-	void updateRoutingProfile(String profileKey) {
-		ProfileDataObject selectedRoutingProfileDataObject = routingProfileDataObjects.get(profileKey);
-		if (profileKey == null || selectedRoutingProfileDataObject == null) {
+	void updateRoutingProfile(@NonNull String profileKey, @Nullable String derivedProfile) {
+		RoutingDataObject selected = routingProfiles.get(profileKey, derivedProfile);
+		if (selected == null) {
 			return;
 		}
-		for (Map.Entry<String, ProfileDataObject> rp : routingProfileDataObjects.entrySet()) {
-			boolean selected = profileKey.equals(rp.getKey());
-			rp.getValue().setSelected(selected);
-		}
-		navigationType.setSummary(selectedRoutingProfileDataObject.getName());
-		navigationType.setIcon(getActiveIcon(selectedRoutingProfileDataObject.getIconRes()));
+		routingProfiles.setSelected(selected);
+		navigationType.setSummary(selected.getName());
+		navigationType.setIcon(getActiveIcon(selected.getIconRes()));
 
 		ApplicationMode appMode = getSelectedAppMode();
 		RouteService routeService;
@@ -189,8 +185,12 @@ void updateRoutingProfile(String profileKey) {
 		} else {
 			routeService = RouteService.OSMAND;
 		}
+		if (Algorithms.isEmpty(derivedProfile)) {
+			derivedProfile = "default";
+		}
 		appMode.setRouteService(routeService);
 		appMode.setRoutingProfile(profileKey);
+		appMode.setDerivedProfile(derivedProfile);
 	}
 
 	private void setupVehicleParametersPref() {
@@ -209,9 +209,12 @@ private void updateMenu() {
 	@Override
 	public void onProfileSelected(Bundle args) {
 		if (args.getBoolean(PROFILES_LIST_UPDATED_ARG)) {
-			updateRoutingProfilesDataObjects();
+			updateRoutingProfiles();
+		}
+		String profileKey = args.getString(PROFILE_KEY_ARG);
+		if (profileKey != null) {
+			updateRoutingProfile(profileKey, args.getString(DERIVED_PROFILE_ARG));
 		}
-		updateRoutingProfile(args.getString(PROFILE_KEY_ARG));
 		showHideCustomizeRouteLinePref();
 	}
 }
\ No newline at end of file
