diff --git a/DataExtractionOSM/src/net/osmand/binary/BinaryInspector.java b/DataExtractionOSM/src/net/osmand/binary/BinaryInspector.java
index 3971d86eac3..51f27a2fe34 100644
--- a/DataExtractionOSM/src/net/osmand/binary/BinaryInspector.java
+++ b/DataExtractionOSM/src/net/osmand/binary/BinaryInspector.java
@@ -49,7 +49,7 @@ public static void main(String[] args) throws IOException {
 		// test cases show info
 		
 		
-		 inspector(new String[]{/*"-vmap", "-bbox=-121.785,37.35,-121.744,37.33", */"/home/victor/projects/OsmAnd/data/osm-gen/Ru-spe.obf"});
+//		 inspector(new String[]{/*"-vmap", "-bbox=-121.785,37.35,-121.744,37.33", */"/home/victor/projects/OsmAnd/data/temp/Belgium_europe_2.obf"});
 		// test case extract parts
 		// test case 
 	}
@@ -363,6 +363,11 @@ protected static String formatBounds(int left, int right, int top, int bottom){
 		return format.format(new Object[]{l, t, r, b}); 
 	}
 	
+	protected static String formatLatBounds(double l, double r, double t, double b){
+		MessageFormat format = new MessageFormat("(left top - right bottom) : {0}, {1} NE - {2}, {3} NE", Locale.US);
+		return format.format(new Object[]{l, t, r, b}); 
+	}
+	
 	public static void printFileInformation(String fileName,VerboseInfo verbose) throws IOException {
 		File file = new File(fileName);
 		if(!file.exists()){
@@ -372,11 +377,6 @@ public static void printFileInformation(String fileName,VerboseInfo verbose) thr
 		printFileInformation(file,verbose);
 	}
 	
-	private static void formatPoint(BinaryMapDataObject o, int ind, StringBuilder b){
-		b.append((float)MapUtils.get31LongitudeX(o.getPoint31XTile(ind))).append(",").append((float)MapUtils.get31LatitudeY(o.getPoint31YTile(ind)));
-	}
-	
-	
 	
 
 	public static void printFileInformation(File file, VerboseInfo verbose) throws IOException {
@@ -405,6 +405,10 @@ public static void printFileInformation(File file, VerboseInfo verbose) throws I
 					int sh = (31 - BinaryMapIndexReader.TRANSPORT_STOP_ZOOM);
 					println("\t Bounds " + formatBounds(ti.getLeft() << sh, ti.getRight() << sh, 
 							ti.getTop() << sh, ti.getBottom() << sh));
+				} else if(p instanceof RouteRegion){
+					RouteRegion ri = ((RouteRegion) p);
+					println("\t Bounds " + formatLatBounds(ri.getLeftLongitude(), ri.getRightLongitude(), 
+							ri.getTopLatitude(), ri.getBottomLatitude()));
 				} else if(p instanceof MapIndex){
 					MapIndex m = ((MapIndex) p);
 					int j = 1;
diff --git a/DataExtractionOSM/src/net/osmand/binary/BinaryMapRouteReaderAdapter.java b/DataExtractionOSM/src/net/osmand/binary/BinaryMapRouteReaderAdapter.java
index 67959ae76e9..194a0127a2e 100644
--- a/DataExtractionOSM/src/net/osmand/binary/BinaryMapRouteReaderAdapter.java
+++ b/DataExtractionOSM/src/net/osmand/binary/BinaryMapRouteReaderAdapter.java
@@ -17,6 +17,8 @@
 import net.osmand.binary.OsmandOdb.OsmAndRoutingIndex.RouteDataBox;
 import net.osmand.binary.OsmandOdb.OsmAndRoutingIndex.RouteEncodingRule;
 import net.osmand.binary.OsmandOdb.RouteData;
+import net.osmand.data.MapAlgorithms;
+import net.osmand.osm.MapUtils;
 
 import org.apache.commons.logging.Log;
 
@@ -308,6 +310,10 @@ protected void readRouteIndex(RouteRegion region) throws IOException {
 				region.getSubregions().add(subregion);
 				codedIS.popLimit(oldLimit);
 				codedIS.seek(subregion.filePointer + subregion.length);
+				region.bottomLatitude = MapUtils.get31LatitudeY(subregion.bottom);
+				region.topLatitude = MapUtils.get31LatitudeY(subregion.top);
+				region.rightLongitude = MapUtils.get31LongitudeX(subregion.right);
+				region.leftLongitude = MapUtils.get31LongitudeX(subregion.left);
 			}	break;
 			
 			default:
diff --git a/DataExtractionOSM/src/net/osmand/data/preparation/IndexCreator.java b/DataExtractionOSM/src/net/osmand/data/preparation/IndexCreator.java
index e7271654d64..135fc99a00c 100644
--- a/DataExtractionOSM/src/net/osmand/data/preparation/IndexCreator.java
+++ b/DataExtractionOSM/src/net/osmand/data/preparation/IndexCreator.java
@@ -745,7 +745,7 @@ public static void main(String[] args) throws IOException, SAXException, SQLExce
 		MapRenderingTypes rt = MapRenderingTypes.getDefault();
 		MapZooms zooms = MapZooms.getDefault(); // MapZooms.parseZooms("15-");
 		creator.setNodesDBFile(new File("/home/victor/projects/OsmAnd/data/osm-gen/nodes.tmp.odb"));
-		creator.generateIndexes(new File("/home/victor/projects/OsmAnd/data/osm-maps/belarus.osm.pbf"),
+		creator.generateIndexes(new File("/home/victor/projects/OsmAnd/temp/map.osm"),
 				new ConsoleProgressImplementation(1), null, zooms, rt, log);
 		
 		
diff --git a/DataExtractionOSM/src/net/osmand/router/BinaryRoutePlanner.java b/DataExtractionOSM/src/net/osmand/router/BinaryRoutePlanner.java
index d9a7455efbe..b24cc5b6591 100644
--- a/DataExtractionOSM/src/net/osmand/router/BinaryRoutePlanner.java
+++ b/DataExtractionOSM/src/net/osmand/router/BinaryRoutePlanner.java
@@ -179,8 +179,8 @@ public int compare(RouteSegment o1, RouteSegment o2) {
 		ctx.startX = start.road.getPoint31XTile(start.segmentStart);
 		ctx.startY = start.road.getPoint31YTile(start.segmentStart);
 		// for start : f(start) = g(start) + h(start) = 0 + h(start) = h(start)
-		start.distanceToEnd = h(ctx, ctx.targetEndX, ctx.targetEndY, ctx.startX, ctx.startY);
-		end.distanceToEnd = start.distanceToEnd;
+		ctx.estimatedDistance = (float) h(ctx, ctx.targetEndX, ctx.targetEndY, ctx.startX, ctx.startY);
+		end.distanceToEnd = start.distanceToEnd	= ctx.estimatedDistance;
 		
 		graphDirectSegments.add(start);
 		graphReverseSegments.add(end);
diff --git a/DataExtractionOSM/src/net/osmand/router/RoutingContext.java b/DataExtractionOSM/src/net/osmand/router/RoutingContext.java
index 8d9e1bae2af..b3cd7c9a022 100644
--- a/DataExtractionOSM/src/net/osmand/router/RoutingContext.java
+++ b/DataExtractionOSM/src/net/osmand/router/RoutingContext.java
@@ -45,6 +45,7 @@ public class RoutingContext {
 	public int targetEndY;
 	public int startX;
 	public int startY;
+	public float estimatedDistance;
 	
 	RouteSegment finalDirectRoute = null;
 	int finalDirectEndSegment = 0;
diff --git a/DataExtractionOSM/src/net/osmand/swing/DataExtractionSettings.java b/DataExtractionOSM/src/net/osmand/swing/DataExtractionSettings.java
index c5443078a48..29020a8cfde 100644
--- a/DataExtractionOSM/src/net/osmand/swing/DataExtractionSettings.java
+++ b/DataExtractionOSM/src/net/osmand/swing/DataExtractionSettings.java
@@ -166,6 +166,14 @@ public void setRouteDirection(int s){
 		preferences.putInt("routeDirection", s);
 	}
 	
+	public String getRouteMode(){
+		return preferences.get("routeMode", "car");
+	}
+	
+	public void setRouteMode(String mode){
+		preferences.put("routeMode", mode);
+	}
+	
 	public String getNativeLibFile(){
 		String fl = preferences.get("nativeLibFile", null);
 		if(fl != null) {
diff --git a/DataExtractionOSM/src/net/osmand/swing/MapRouterLayer.java b/DataExtractionOSM/src/net/osmand/swing/MapRouterLayer.java
index ff3b74b4e74..2f28701b248 100644
--- a/DataExtractionOSM/src/net/osmand/swing/MapRouterLayer.java
+++ b/DataExtractionOSM/src/net/osmand/swing/MapRouterLayer.java
@@ -28,6 +28,7 @@
 import javax.xml.parsers.DocumentBuilderFactory;
 import javax.xml.parsers.ParserConfigurationException;
 
+import net.osmand.LogUtil;
 import net.osmand.binary.BinaryMapIndexReader;
 import net.osmand.data.DataTileManager;
 import net.osmand.osm.Entity;
@@ -35,8 +36,10 @@
 import net.osmand.osm.MapUtils;
 import net.osmand.osm.Way;
 import net.osmand.osm.OSMSettings.OSMTagKey;
+import net.osmand.router.BicycleRouter;
 import net.osmand.router.BinaryRoutePlanner;
 import net.osmand.router.CarRouter;
+import net.osmand.router.PedestrianRouter;
 import net.osmand.router.RouteSegmentResult;
 import net.osmand.router.RoutingContext;
 import net.osmand.router.VehicleRouter;
@@ -50,17 +53,19 @@
 import org.xml.sax.InputSource;
 import org.xml.sax.SAXException;
 
+import org.apache.commons.logging.Log;
 import org.json.JSONException;
 import org.json.JSONObject;
 import org.json.JSONTokener;
 
 
 public class MapRouterLayer implements MapPanelLayer {
+	
+	private final static Log log = LogUtil.getLog(MapRouterLayer.class);
 
 	private MapPanel map;
 	private LatLon startRoute ;
 	private LatLon endRoute ;
-	private VehicleRouter routerMode = new CarRouter();
 	private boolean nextAvailable = true;
 	private boolean pause = true;
 	private boolean stop = false;
@@ -558,7 +563,17 @@ public List<Way> selfRoute(LatLon start, LatLon end) {
 				
 				BinaryRoutePlanner router = new BinaryRoutePlanner(rs);
 				RoutingContext ctx = new RoutingContext();
-				ctx.setRouter(this.routerMode);
+				String m = DataExtractionSettings.getSettings().getRouteMode();
+				if("pedestrian".equalsIgnoreCase(m)) {
+					ctx.setRouter(new PedestrianRouter());
+					log.info("Use pedestrian mode for routing");
+				} else if("pedestrian".equalsIgnoreCase(m)) {
+					ctx.setRouter(new BicycleRouter());
+					log.info("Use bicycle mode for routing");
+				} else {
+					ctx.setRouter(new CarRouter());
+					log.info("Use car mode for routing");
+				}
 				int dir = DataExtractionSettings.getSettings().getRouteDirection();
 				if(dir != 0) {
 					ctx.setPlanRoadDirection(dir > 0 ? true : false);
diff --git a/DataExtractionOSM/src/net/osmand/swing/OsmExtractionPreferencesDialog.java b/DataExtractionOSM/src/net/osmand/swing/OsmExtractionPreferencesDialog.java
index e151d52163c..d5a70501d81 100644
--- a/DataExtractionOSM/src/net/osmand/swing/OsmExtractionPreferencesDialog.java
+++ b/DataExtractionOSM/src/net/osmand/swing/OsmExtractionPreferencesDialog.java
@@ -31,6 +31,7 @@ public class OsmExtractionPreferencesDialog extends JDialog {
 	private JTextField streetDefaultSuffixes;
 	private JTextField mapZooms;
 	private JTextField directionPlanRoute;
+	private JTextField routingMode;
 	private JTextField lineSmoothness;
 	private JTextField cityAdminLevel;
 	private JTextField osrmServerAddress;
@@ -141,6 +142,27 @@ private void createGeneralSection(JPanel root) {
 		constr.gridy = gridY++;
 		l.setConstraints(nativeFilesDirectory, constr);
 		
+		label = new JLabel("Routing mode (car/bicycle/pedestrian) : ");
+        panel.add(label);
+        constr = new GridBagConstraints();
+        constr.ipadx = 5;
+        constr.gridx = 0;
+        constr.gridy = gridY;
+        constr.anchor = GridBagConstraints.WEST;
+        l.setConstraints(label, constr);
+        
+        routingMode = new JTextField();
+        
+        routingMode.setText(DataExtractionSettings.getSettings().getRouteMode() +"");
+        panel.add(routingMode);
+        constr = new GridBagConstraints();
+        constr.weightx = 1;
+        constr.fill = GridBagConstraints.HORIZONTAL;
+        constr.ipadx = 5;
+        constr.gridx = 1;
+        constr.gridy = gridY++;
+        l.setConstraints(directionPlanRoute, constr);
+		
 		label = new JLabel("Direction to plan route (0 - both, 1 - forward, -1 - backward) : ");
         panel.add(label);
         constr = new GridBagConstraints();
@@ -436,6 +458,10 @@ public void saveProperties(){
 		if(!settings.getRenderXmlPath().equals(renderingStyleFile.getText())){
 			settings.setRenderXmlPath(renderingStyleFile.getText());
 		}
+		if(!settings.getRouteMode().equals(routingMode.getText())){
+			settings.setRouteMode(routingMode.getText());
+		}
+		
 //		if(settings.isSupressWarningsForDuplicatedId() != supressWarning.isSelected()){
 //			settings.setSupressWarningsForDuplicatedId	(supressWarning.isSelected());
 //		}
