diff --git a/OsmAnd/src/net/osmand/aidl/ConnectedApp.java b/OsmAnd/src/net/osmand/aidl/ConnectedApp.java
index d97d465b263..41dab2ef27d 100644
--- a/OsmAnd/src/net/osmand/aidl/ConnectedApp.java
+++ b/OsmAnd/src/net/osmand/aidl/ConnectedApp.java
@@ -25,7 +25,7 @@
 import net.osmand.plus.views.layers.base.OsmandMapLayer;
 import net.osmand.plus.views.layers.base.OsmandMapLayer.DrawSettings;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.SideWidgetInfo;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
 import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
@@ -181,7 +181,7 @@ public boolean onContextMenuClick(@Nullable OnDataChangeUiAdapter uiAdapter,
 	void createWidgetControls(@NonNull MapActivity mapActivity,
 	                          @NonNull List<MapWidgetInfo> widgetsInfos,
 	                          @NonNull ApplicationMode appMode) {
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 		for (AidlMapWidgetWrapper widgetData : widgets.values()) {
 			int iconId = AndroidUtils.getDrawableId(mapActivity.getMyApplication(), widgetData.getMenuIconName());
 			int menuIconId = iconId != 0 ? iconId : ContextMenuItem.INVALID_ID;
@@ -189,8 +189,8 @@ void createWidgetControls(@NonNull MapActivity mapActivity,
 			WidgetsPanel defaultPanel = widgetData.isRightPanelByDefault() ? WidgetsPanel.RIGHT : WidgetsPanel.LEFT;
 
 			TextInfoWidget widget = createWidgetControl(mapActivity, widgetData.getId());
-			MapWidgetInfo widgetInfo = widgetRegistry.createExternalWidget(widgetKey, widget, menuIconId,
-					widgetData.getMenuTitle(), defaultPanel, widgetData.getOrder(), appMode);
+			MapWidgetInfo widgetInfo = creator.createExternalWidget(widgetKey, widget, menuIconId,
+					widgetData.getMenuTitle(), defaultPanel, widgetData.getOrder());
 			((SideWidgetInfo) widgetInfo).setExternalProviderPackage(pack);
 
 			widgetsInfos.add(widgetInfo);
diff --git a/OsmAnd/src/net/osmand/aidl/OsmandAidlApi.java b/OsmAnd/src/net/osmand/aidl/OsmandAidlApi.java
index a6303329589..d22a6274c53 100644
--- a/OsmAnd/src/net/osmand/aidl/OsmandAidlApi.java
+++ b/OsmAnd/src/net/osmand/aidl/OsmandAidlApi.java
@@ -129,6 +129,7 @@
 import net.osmand.plus.views.layers.base.OsmandMapLayer;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
 import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.SideWidgetInfo;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
 import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
@@ -401,10 +402,11 @@ public void onReceive(Context context, Intent intent) {
 							WidgetsPanel defaultPanel = widgetData.isRightPanelByDefault() ? WidgetsPanel.RIGHT : WidgetsPanel.LEFT;
 							ApplicationMode appMode = app.getSettings().getApplicationMode();
 
-							MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
-							MapWidgetInfo widgetInfo = widgetRegistry.createExternalWidget(widgetKey, widget, menuIconId,
-									widgetData.getMenuTitle(), defaultPanel, widgetData.getOrder(), appMode);
-							widgetRegistry.registerWidget(widgetInfo);
+							WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
+							MapWidgetInfo widgetInfo = creator.createExternalWidget(widgetKey, widget, menuIconId,
+									widgetData.getMenuTitle(), defaultPanel, widgetData.getOrder());
+							MapWidgetRegistry registry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+							registry.registerWidget(widgetInfo);
 
 							((SideWidgetInfo) widgetInfo).setExternalProviderPackage(connectedApp.getPack());
 							layer.recreateControls();
diff --git a/OsmAnd/src/net/osmand/plus/plugins/antplus/AntPlusPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/antplus/AntPlusPlugin.java
index 9da6dc828e6..0fee623fe1c 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/antplus/AntPlusPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/antplus/AntPlusPlugin.java
@@ -35,7 +35,7 @@
 import net.osmand.plus.settings.backend.preferences.CommonPreference;
 import net.osmand.plus.settings.fragments.BaseSettingsFragment.SettingsScreenType;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 
@@ -135,22 +135,22 @@ public void disable(@NonNull OsmandApplication app) {
 
 	@Override
 	public void createWidgets(@NonNull MapActivity mapActivity, @NonNull List<MapWidgetInfo> widgetsInfos, @NonNull ApplicationMode appMode) {
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 
 		MapWidget heartRateWidget = createMapWidgetForParams(mapActivity, ANT_HEART_RATE);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(heartRateWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(heartRateWidget));
 
 		MapWidget bikePowerWidget = createMapWidgetForParams(mapActivity, ANT_BICYCLE_POWER);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(bikePowerWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(bikePowerWidget));
 
 		MapWidget bikeCadenceWidget = createMapWidgetForParams(mapActivity, ANT_BICYCLE_CADENCE);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(bikeCadenceWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(bikeCadenceWidget));
 
 		MapWidget bikeSpeedWidget = createMapWidgetForParams(mapActivity, ANT_BICYCLE_SPEED);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(bikeSpeedWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(bikeSpeedWidget));
 
 		MapWidget bikeDistanceWidget = createMapWidgetForParams(mapActivity, ANT_BICYCLE_DISTANCE);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(bikeDistanceWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(bikeDistanceWidget));
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
index 12e3028a4b7..ed0ddefd6b1 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
@@ -74,7 +74,7 @@
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.OsmandMapTileView;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 import net.osmand.plus.widgets.ctxmenu.ContextMenuAdapter;
@@ -719,19 +719,19 @@ public void updateLayers(@NonNull Context context, @Nullable MapActivity mapActi
 
 	@Override
 	public void createWidgets(@NonNull MapActivity mapActivity, @NonNull List<MapWidgetInfo> widgetsInfos, @NonNull ApplicationMode appMode) {
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 
 		MapWidget onRequestWidget = createMapWidgetForParams(mapActivity, AV_NOTES_ON_REQUEST);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(onRequestWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(onRequestWidget));
 
 		MapWidget audioWidget = createMapWidgetForParams(mapActivity, AV_NOTES_RECORD_AUDIO);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(audioWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(audioWidget));
 
 		MapWidget videoWidget = createMapWidgetForParams(mapActivity, AV_NOTES_RECORD_VIDEO);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(videoWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(videoWidget));
 
 		MapWidget photoWidget = createMapWidgetForParams(mapActivity, AV_NOTES_TAKE_PHOTO);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(photoWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(photoWidget));
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/plugins/development/OsmandDevelopmentPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/development/OsmandDevelopmentPlugin.java
index feee29b5d3a..26fc52f2986 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/development/OsmandDevelopmentPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/development/OsmandDevelopmentPlugin.java
@@ -38,7 +38,7 @@
 import net.osmand.plus.settings.fragments.BaseSettingsFragment.SettingsScreenType;
 import net.osmand.plus.views.corenative.NativeCoreContext;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 import net.osmand.plus.widgets.ctxmenu.ContextMenuAdapter;
@@ -121,22 +121,22 @@ public void registerOptionsMenuItems(MapActivity mapActivity, ContextMenuAdapter
 
 	@Override
 	public void createWidgets(@NonNull MapActivity mapActivity, @NonNull List<MapWidgetInfo> widgetsInfos, @NonNull ApplicationMode appMode) {
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 
 		MapWidget fpsWidget = createMapWidgetForParams(mapActivity, DEV_FPS);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(fpsWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(fpsWidget));
 
 		MapWidget cameraTiltWidget = createMapWidgetForParams(mapActivity, DEV_CAMERA_TILT);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(cameraTiltWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(cameraTiltWidget));
 
 		MapWidget cameraDistanceWidget = createMapWidgetForParams(mapActivity, DEV_CAMERA_DISTANCE);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(cameraDistanceWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(cameraDistanceWidget));
 
 		MapWidget zoomLevelWidget = createMapWidgetForParams(mapActivity, DEV_ZOOM_LEVEL);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(zoomLevelWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(zoomLevelWidget));
 
 		MapWidget targetDistanceWidget = createMapWidgetForParams(mapActivity, DEV_TARGET_DISTANCE);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(targetDistanceWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(targetDistanceWidget));
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/plugins/mapillary/MapillaryPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/mapillary/MapillaryPlugin.java
index c1e3a777138..06443bede3d 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/mapillary/MapillaryPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/mapillary/MapillaryPlugin.java
@@ -41,6 +41,7 @@
 import net.osmand.plus.views.layers.MapTileLayer;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
 import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 import net.osmand.plus.widgets.ctxmenu.ContextMenuAdapter;
@@ -230,9 +231,9 @@ public boolean onContextMenuClick(@Nullable OnDataChangeUiAdapter uiAdapter, @Nu
 
 	@Override
 	public void createWidgets(@NonNull MapActivity mapActivity, @NonNull List<MapWidgetInfo> widgetsInfos, @NonNull ApplicationMode appMode) {
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 		MapWidget widget = createMapWidgetForParams(mapActivity, WidgetType.MAPILLARY);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(widget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(widget));
 	}
 
 	public void setWidgetVisible(MapActivity mapActivity, boolean visible) {
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java
index 31a3f3bca29..887c0bf4895 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java
@@ -41,7 +41,7 @@
 import net.osmand.plus.track.helpers.SelectedGpxFile;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.WidgetGroup;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
@@ -184,19 +184,19 @@ public void mapActivityPause(@NonNull MapActivity activity) {
 
 	@Override
 	public void createWidgets(@NonNull MapActivity mapActivity, @NonNull List<MapWidgetInfo> widgetsInfos, @NonNull ApplicationMode appMode) {
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 
 		MapWidget distanceWidget = createMapWidgetForParams(mapActivity, TRIP_RECORDING_DISTANCE);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(distanceWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(distanceWidget));
 
 		MapWidget timeWidget = createMapWidgetForParams(mapActivity, TRIP_RECORDING_TIME);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(timeWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(timeWidget));
 
 		MapWidget uphillWidget = createMapWidgetForParams(mapActivity, TRIP_RECORDING_UPHILL);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(uphillWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(uphillWidget));
 
 		MapWidget downhillWidget = createMapWidgetForParams(mapActivity, TRIP_RECORDING_DOWNHILL);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(downhillWidget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(downhillWidget));
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java
index 9bef5c9eb20..a27baa56177 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java
@@ -39,7 +39,7 @@
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 import net.osmand.plus.widgets.ctxmenu.ContextMenuAdapter;
@@ -423,9 +423,9 @@ protected MapWidget createMapWidgetForParams(@NonNull MapActivity mapActivity, @
 
 	@Override
 	public void createWidgets(@NonNull MapActivity mapActivity, @NonNull List<MapWidgetInfo> widgetsInfos, @NonNull ApplicationMode appMode) {
-		MapWidgetRegistry widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 		MapWidget widget = createMapWidgetForParams(mapActivity, PARKING);
-		widgetsInfos.add(widgetRegistry.createWidgetInfo(widget, appMode));
+		widgetsInfos.add(creator.createWidgetInfo(widget));
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
index cf57fe53005..76fc0e8eed9 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
@@ -1,45 +1,14 @@
 package net.osmand.plus.views.mapwidgets;
 
-import static net.osmand.plus.views.mapwidgets.WidgetType.ALTITUDE_MY_LOCATION;
-import static net.osmand.plus.views.mapwidgets.WidgetType.ALTITUDE_MAP_CENTER;
-import static net.osmand.plus.views.mapwidgets.WidgetType.AVERAGE_SPEED;
-import static net.osmand.plus.views.mapwidgets.WidgetType.BATTERY;
-import static net.osmand.plus.views.mapwidgets.WidgetType.COORDINATES_CURRENT_LOCATION;
-import static net.osmand.plus.views.mapwidgets.WidgetType.COORDINATES_MAP_CENTER;
-import static net.osmand.plus.views.mapwidgets.WidgetType.CURRENT_SPEED;
-import static net.osmand.plus.views.mapwidgets.WidgetType.CURRENT_TIME;
-import static net.osmand.plus.views.mapwidgets.WidgetType.DISTANCE_TO_DESTINATION;
-import static net.osmand.plus.views.mapwidgets.WidgetType.ELEVATION_PROFILE;
-import static net.osmand.plus.views.mapwidgets.WidgetType.GPS_INFO;
-import static net.osmand.plus.views.mapwidgets.WidgetType.INTERMEDIATE_DESTINATION;
-import static net.osmand.plus.views.mapwidgets.WidgetType.LANES;
-import static net.osmand.plus.views.mapwidgets.WidgetType.MAGNETIC_BEARING;
-import static net.osmand.plus.views.mapwidgets.WidgetType.MARKERS_TOP_BAR;
-import static net.osmand.plus.views.mapwidgets.WidgetType.MAX_SPEED;
-import static net.osmand.plus.views.mapwidgets.WidgetType.NEXT_TURN;
-import static net.osmand.plus.views.mapwidgets.WidgetType.RADIUS_RULER;
-import static net.osmand.plus.views.mapwidgets.WidgetType.RELATIVE_BEARING;
-import static net.osmand.plus.views.mapwidgets.WidgetType.SECOND_NEXT_TURN;
-import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_1;
-import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_2;
-import static net.osmand.plus.views.mapwidgets.WidgetType.SMALL_NEXT_TURN;
-import static net.osmand.plus.views.mapwidgets.WidgetType.STREET_NAME;
-import static net.osmand.plus.views.mapwidgets.WidgetType.TIME_TO_DESTINATION;
-import static net.osmand.plus.views.mapwidgets.WidgetType.TIME_TO_INTERMEDIATE;
-import static net.osmand.plus.views.mapwidgets.WidgetType.TRUE_BEARING;
-
 import android.view.ViewGroup;
 
 import androidx.annotation.ColorRes;
-import androidx.annotation.DrawableRes;
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
-import androidx.annotation.StringRes;
 
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
-import net.osmand.plus.plugins.PluginsHelper;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.backend.WidgetsAvailabilityHelper;
@@ -297,7 +266,7 @@ public Set<MapWidgetInfo> getWidgetsForPanel(@NonNull MapActivity mapActivity,
 		if (settings.getApplicationMode() == appMode) {
 			widgetInfos.addAll(getAllWidgets());
 		} else {
-			widgetInfos.addAll(createAllControls(mapActivity, appMode));
+			widgetInfos.addAll(WidgetsInitializer.createAllControls(mapActivity, appMode));
 		}
 		Set<MapWidgetInfo> filteredWidgets = new TreeSet<>();
 		for (MapWidgetInfo widget : widgetInfos) {
@@ -359,187 +328,15 @@ public void registerWidget(@NonNull MapWidgetInfo widgetInfo) {
 	}
 
 	public void registerAllControls(@NonNull MapActivity mapActivity) {
-		List<MapWidgetInfo> widgetInfos = createAllControls(mapActivity, settings.getApplicationMode());
-		reorderWidgets(widgetInfos);
+		ApplicationMode appMode = settings.getApplicationMode();
+		List<MapWidgetInfo> infos = WidgetsInitializer.createAllControls(mapActivity, appMode);
+		reorderWidgets(infos);
 
-		for (MapWidgetInfo widgetInfo : widgetInfos) {
+		for (MapWidgetInfo widgetInfo : infos) {
 			notifyWidgetRegistered(widgetInfo);
 		}
 	}
 
-	@NonNull
-	public List<MapWidgetInfo> createAllControls(@NonNull MapActivity mapActivity, @NonNull ApplicationMode appMode) {
-		List<MapWidgetInfo> widgetInfos = new ArrayList<>();
-		MapWidgetsFactory widgetsFactory = new MapWidgetsFactory(mapActivity);
-
-		createTopWidgets(widgetsFactory, widgetInfos, appMode);
-		createBottomWidgets(widgetsFactory, widgetInfos, appMode);
-		createLeftWidgets(widgetsFactory, widgetInfos, appMode);
-		createRightWidgets(widgetsFactory, widgetInfos, appMode);
-
-		PluginsHelper.createMapWidgets(mapActivity, widgetInfos, appMode);
-		app.getAidlApi().createWidgetControls(mapActivity, widgetInfos, appMode);
-		createCustomWidgets(widgetsFactory, appMode, widgetInfos);
-
-		return widgetInfos;
-	}
-
-	private void createTopWidgets(@NonNull MapWidgetsFactory factory, @NonNull List<MapWidgetInfo> infos, @NonNull ApplicationMode appMode) {
-		infos.add(createWidgetInfo(factory, COORDINATES_CURRENT_LOCATION, appMode));
-		infos.add(createWidgetInfo(factory, COORDINATES_MAP_CENTER, appMode));
-		infos.add(createWidgetInfo(factory, STREET_NAME, appMode));
-		infos.add(createWidgetInfo(factory, LANES, appMode));
-		infos.add(createWidgetInfo(factory, MARKERS_TOP_BAR, appMode));
-	}
-
-	private void createBottomWidgets(@NonNull MapWidgetsFactory factory, @NonNull List<MapWidgetInfo> infos, @NonNull ApplicationMode appMode) {
-		infos.add(createWidgetInfo(factory, ELEVATION_PROFILE, appMode));
-	}
-
-	private void createLeftWidgets(@NonNull MapWidgetsFactory factory, @NonNull List<MapWidgetInfo> infos, @NonNull ApplicationMode appMode) {
-		infos.add(createWidgetInfo(factory, NEXT_TURN, appMode));
-		infos.add(createWidgetInfo(factory, SMALL_NEXT_TURN, appMode));
-		infos.add(createWidgetInfo(factory, SECOND_NEXT_TURN, appMode));
-	}
-
-	private void createRightWidgets(@NonNull MapWidgetsFactory factory, @NonNull List<MapWidgetInfo> infos, @NonNull ApplicationMode appMode) {
-		infos.add(createWidgetInfo(factory, INTERMEDIATE_DESTINATION, appMode));
-		infos.add(createWidgetInfo(factory, DISTANCE_TO_DESTINATION, appMode));
-		infos.add(createWidgetInfo(factory, RELATIVE_BEARING, appMode));
-		infos.add(createWidgetInfo(factory, MAGNETIC_BEARING, appMode));
-		infos.add(createWidgetInfo(factory, TRUE_BEARING, appMode));
-		infos.add(createWidgetInfo(factory, CURRENT_SPEED, appMode));
-		infos.add(createWidgetInfo(factory, AVERAGE_SPEED, appMode));
-		infos.add(createWidgetInfo(factory, MAX_SPEED, appMode));
-		infos.add(createWidgetInfo(factory, ALTITUDE_MY_LOCATION, appMode));
-		infos.add(createWidgetInfo(factory, ALTITUDE_MAP_CENTER, appMode));
-		infos.add(createWidgetInfo(factory, GPS_INFO, appMode));
-		infos.add(createWidgetInfo(factory, CURRENT_TIME, appMode));
-		infos.add(createWidgetInfo(factory, BATTERY, appMode));
-		infos.add(createWidgetInfo(factory, RADIUS_RULER, appMode));
-		infos.add(createWidgetInfo(factory, TIME_TO_INTERMEDIATE, appMode));
-		infos.add(createWidgetInfo(factory, TIME_TO_DESTINATION, appMode));
-		infos.add(createWidgetInfo(factory, SIDE_MARKER_1, appMode));
-		infos.add(createWidgetInfo(factory, SIDE_MARKER_2, appMode));
-	}
-
-	@Nullable
-	private MapWidgetInfo createWidgetInfo(@NonNull MapWidgetsFactory widgetsFactory, @NonNull WidgetType widgetType, @NonNull ApplicationMode appMode) {
-		MapWidget mapWidget = widgetsFactory.createMapWidget(widgetType);
-		if (mapWidget != null) {
-			return createWidgetInfo(mapWidget, appMode);
-		}
-		return null;
-	}
-
-	@Nullable
-	public MapWidgetInfo createWidgetInfo(@NonNull MapWidget widget) {
-		return createWidgetInfo(widget, settings.getApplicationMode());
-	}
-
-	@Nullable
-	public MapWidgetInfo createWidgetInfo(@NonNull MapWidget widget, @NonNull ApplicationMode appMode) {
-		WidgetType widgetType = widget.getWidgetType();
-		if (widgetType != null) {
-			String widgetId = widgetType.id;
-			WidgetsPanel panel = widgetType.getPanel(widgetId, appMode, settings);
-			int page = panel.getWidgetPage(appMode, widgetId, settings);
-			int order = panel.getWidgetOrder(appMode, widgetId, settings);
-			return createWidgetInfo(widgetId, widget, widgetType.dayIconId, widgetType.nightIconId,
-					widgetType.titleId, null, page, order, panel);
-		}
-		return null;
-	}
-
-	@NonNull
-	public MapWidgetInfo createWidgetInfo(@NonNull String key,
-	                                      @NonNull MapWidget widget,
-	                                      @DrawableRes int daySettingsIconId,
-	                                      @DrawableRes int nightSettingIconId,
-	                                      @StringRes int messageId,
-	                                      @Nullable String message,
-	                                      int page,
-	                                      int order,
-	                                      @NonNull WidgetsPanel widgetPanel) {
-		if (widget instanceof TextInfoWidget) {
-			TextInfoWidget textInfoWidget = ((TextInfoWidget) widget);
-			return new SideWidgetInfo(key, textInfoWidget, daySettingsIconId, nightSettingIconId,
-					messageId, message, page, order, widgetPanel);
-		} else {
-			return new CenterWidgetInfo(key, widget, daySettingsIconId, nightSettingIconId,
-					messageId, message, page, order, widgetPanel);
-		}
-	}
-
-	@NonNull
-	public MapWidgetInfo createExternalWidget(@NonNull String widgetId,
-	                                          @NonNull MapWidget widget,
-	                                          @DrawableRes int settingsIconId,
-	                                          @Nullable String message,
-	                                          @NonNull WidgetsPanel defaultPanel,
-	                                          int order,
-	                                          @NonNull ApplicationMode appMode) {
-		WidgetsPanel panel = getExternalWidgetPanel(widgetId, defaultPanel, appMode);
-		int page = panel.getWidgetPage(appMode, widgetId, settings);
-		int savedOrder = panel.getWidgetOrder(appMode, widgetId, settings);
-		if (savedOrder != WidgetsPanel.DEFAULT_ORDER) {
-			order = savedOrder;
-		}
-		return createWidgetInfo(widgetId, widget, settingsIconId,
-				settingsIconId, MapWidgetInfo.INVALID_ID, message, page, order, panel);
-	}
-
-	private void createCustomWidgets(@NonNull MapWidgetsFactory factory, @NonNull ApplicationMode appMode, @NonNull List<MapWidgetInfo> widgetInfos) {
-		List<String> widgetKeys = settings.CUSTOM_WIDGETS_KEYS.getStringsListForProfile(appMode);
-		if (!Algorithms.isEmpty(widgetKeys)) {
-			for (String key : widgetKeys) {
-				WidgetType widgetType = WidgetType.getById(key);
-				if (widgetType != null) {
-					MapWidgetInfo widgetInfo = createCustomWidget(factory, key, widgetType, appMode);
-					if (widgetInfo != null) {
-						widgetInfos.add(widgetInfo);
-					}
-				}
-			}
-		}
-	}
-
-	private MapWidgetInfo createCustomWidget(@NonNull MapWidgetsFactory factory, @NonNull String key,
-	                                         @NonNull WidgetType widgetType, @NonNull ApplicationMode appMode) {
-		MapWidget widget = factory.createMapWidget(key, widgetType);
-		if (widget != null) {
-			WidgetsPanel panel = widgetType.getPanel(key, appMode, settings);
-			return createCustomWidget(key, widget, widgetType, panel, appMode);
-		}
-		return null;
-	}
-
-	@NonNull
-	public MapWidgetInfo createCustomWidget(@NonNull String widgetId,
-	                                        @NonNull MapWidget widget,
-	                                        @NonNull WidgetType widgetType,
-	                                        @NonNull WidgetsPanel panel,
-	                                        @NonNull ApplicationMode appMode) {
-		int page = panel.getWidgetPage(appMode, widgetId, settings);
-		int order = panel.getWidgetOrder(appMode, widgetId, settings);
-
-		return createWidgetInfo(widgetId, widget, widgetType.dayIconId, widgetType.nightIconId, widgetType.titleId, null, page, order, panel);
-	}
-
-	@NonNull
-	private WidgetsPanel getExternalWidgetPanel(@NonNull String widgetId,
-	                                            @NonNull WidgetsPanel defaultPanel,
-	                                            @NonNull ApplicationMode appMode) {
-		boolean storedInLeftPanel = WidgetsPanel.LEFT.getWidgetOrder(appMode, widgetId, settings) != WidgetsPanel.DEFAULT_ORDER;
-		boolean storedInRightPanel = WidgetsPanel.RIGHT.getWidgetOrder(appMode, widgetId, settings) != WidgetsPanel.DEFAULT_ORDER;
-		if (storedInLeftPanel) {
-			return WidgetsPanel.LEFT;
-		} else if (storedInRightPanel) {
-			return WidgetsPanel.RIGHT;
-		}
-		return defaultPanel;
-	}
-
 	public interface WidgetsRegistryListener {
 		void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo);
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java
index e1a9db8aa1e..5e662bdd4c3 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetsFactory.java
@@ -9,6 +9,7 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.plugins.PluginsHelper;
+import net.osmand.plus.plugins.development.OsmandDevelopmentPlugin;
 import net.osmand.plus.views.mapwidgets.widgets.AltitudeWidget;
 import net.osmand.plus.views.mapwidgets.widgets.AverageSpeedWidget;
 import net.osmand.plus.views.mapwidgets.widgets.BatteryWidget;
@@ -51,6 +52,13 @@ public MapWidget createMapWidget(@NonNull WidgetType widgetType) {
 	}
 
 	public MapWidget createMapWidget(@Nullable String customId, @NonNull WidgetType widgetType) {
+		if (isWidgetCreationAllowed(widgetType)) {
+			return createMapWidgetImpl(customId, widgetType);
+		}
+		return null;
+	}
+
+	private MapWidget createMapWidgetImpl(@Nullable String customId, @NonNull WidgetType widgetType) {
 		switch (widgetType) {
 			case NEXT_TURN:
 				return new NextTurnWidget(mapActivity, false);
@@ -114,4 +122,12 @@ public MapWidget createMapWidget(@Nullable String customId, @NonNull WidgetType
 				return PluginsHelper.createMapWidget(mapActivity, widgetType);
 		}
 	}
+
+	private boolean isWidgetCreationAllowed(@NonNull WidgetType widgetType) {
+		if (widgetType == ALTITUDE_MAP_CENTER) {
+			OsmandDevelopmentPlugin plugin = PluginsHelper.getPlugin(OsmandDevelopmentPlugin.class);
+			return plugin != null && plugin.isHeightmapEnabled();
+		}
+		return true;
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetGroup.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetGroup.java
index 8af6775be4f..f865b0adc88 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetGroup.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetGroup.java
@@ -58,7 +58,7 @@ public enum WidgetGroup {
 	public List<WidgetType> getWidgets() {
 		List<WidgetType> widgets = new ArrayList<>();
 		for (WidgetType widget : WidgetType.values()) {
-			if (this == widget.group) {
+			if (this == widget.getGroup()) {
 				widgets.add(widget);
 			}
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetInfoCreator.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetInfoCreator.java
new file mode 100644
index 00000000000..89e2901af79
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetInfoCreator.java
@@ -0,0 +1,118 @@
+package net.osmand.plus.views.mapwidgets;
+
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.annotation.StringRes;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
+import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
+
+public class WidgetInfoCreator {
+
+	private final OsmandSettings settings;
+	private final ApplicationMode appMode;
+
+	public WidgetInfoCreator(@NonNull OsmandApplication app, @NonNull ApplicationMode appMode) {
+		settings = app.getSettings();
+		this.appMode = appMode;
+	}
+
+	@Nullable
+	public MapWidgetInfo createWidgetInfo(@NonNull MapWidgetsFactory factory, @NonNull WidgetType widgetType) {
+		MapWidget mapWidget = factory.createMapWidget(widgetType);
+		if (mapWidget != null) {
+			return createWidgetInfo(mapWidget);
+		}
+		return null;
+	}
+
+	@Nullable
+	public MapWidgetInfo createCustomWidgetInfo(@NonNull MapWidgetsFactory factory,
+	                                            @NonNull String key, @NonNull WidgetType widgetType) {
+		MapWidget widget = factory.createMapWidget(key, widgetType);
+		if (widget != null) {
+			WidgetsPanel panel = widgetType.getPanel(key, appMode, settings);
+			return createCustomWidgetInfo(key, widget, widgetType, panel);
+		}
+		return null;
+	}
+
+
+	@Nullable
+	public MapWidgetInfo createWidgetInfo(@NonNull MapWidget widget) {
+		WidgetType widgetType = widget.getWidgetType();
+		if (widgetType != null) {
+			String widgetId = widgetType.id;
+			WidgetsPanel panel = widgetType.getPanel(widgetId, appMode, settings);
+			int page = panel.getWidgetPage(appMode, widgetId, settings);
+			int order = panel.getWidgetOrder(appMode, widgetId, settings);
+			return createWidgetInfo(widgetId, widget, widgetType.dayIconId, widgetType.nightIconId,
+					widgetType.titleId, null, page, order, panel);
+		}
+		return null;
+	}
+
+	@NonNull
+	public MapWidgetInfo createExternalWidget(@NonNull String widgetId,
+	                                          @NonNull MapWidget widget,
+	                                          @DrawableRes int settingsIconId,
+	                                          @Nullable String message,
+	                                          @NonNull WidgetsPanel defaultPanel,
+	                                          int order) {
+		WidgetsPanel panel = getExternalWidgetPanel(widgetId, defaultPanel);
+		int page = panel.getWidgetPage(appMode, widgetId, settings);
+		int savedOrder = panel.getWidgetOrder(appMode, widgetId, settings);
+		if (savedOrder != WidgetsPanel.DEFAULT_ORDER) {
+			order = savedOrder;
+		}
+		return createWidgetInfo(widgetId, widget, settingsIconId,
+				settingsIconId, MapWidgetInfo.INVALID_ID, message, page, order, panel);
+	}
+
+	@NonNull
+	private WidgetsPanel getExternalWidgetPanel(@NonNull String widgetId,
+	                                            @NonNull WidgetsPanel defaultPanel) {
+		boolean storedInLeftPanel = WidgetsPanel.LEFT.getWidgetOrder(appMode, widgetId, settings) != WidgetsPanel.DEFAULT_ORDER;
+		boolean storedInRightPanel = WidgetsPanel.RIGHT.getWidgetOrder(appMode, widgetId, settings) != WidgetsPanel.DEFAULT_ORDER;
+		if (storedInLeftPanel) {
+			return WidgetsPanel.LEFT;
+		} else if (storedInRightPanel) {
+			return WidgetsPanel.RIGHT;
+		}
+		return defaultPanel;
+	}
+
+	@NonNull
+	public MapWidgetInfo createCustomWidgetInfo(@NonNull String widgetId, @NonNull MapWidget widget,
+	                                            @NonNull WidgetType widgetType, @NonNull WidgetsPanel panel) {
+		int page = panel.getWidgetPage(appMode, widgetId, settings);
+		int order = panel.getWidgetOrder(appMode, widgetId, settings);
+		return createWidgetInfo(widgetId, widget, widgetType.dayIconId, widgetType.nightIconId,
+				widgetType.titleId, null, page, order, panel);
+	}
+
+	@NonNull
+	public MapWidgetInfo createWidgetInfo(@NonNull String key,
+	                                      @NonNull MapWidget widget,
+	                                      @DrawableRes int daySettingsIconId,
+	                                      @DrawableRes int nightSettingIconId,
+	                                      @StringRes int messageId,
+	                                      @Nullable String message,
+	                                      int page,
+	                                      int order,
+	                                      @NonNull WidgetsPanel widgetPanel) {
+		if (widget instanceof TextInfoWidget) {
+			TextInfoWidget textInfoWidget = ((TextInfoWidget) widget);
+			return new SideWidgetInfo(key, textInfoWidget, daySettingsIconId, nightSettingIconId,
+					messageId, message, page, order, widgetPanel);
+		} else {
+			return new CenterWidgetInfo(key, widget, daySettingsIconId, nightSettingIconId,
+					messageId, message, page, order, widgetPanel);
+		}
+	}
+
+}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
index efa92b42b74..60db2d857a2 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
@@ -1,6 +1,7 @@
 package net.osmand.plus.views.mapwidgets;
 
 import static net.osmand.plus.views.mapwidgets.MapWidgetInfo.DELIMITER;
+import static net.osmand.plus.views.mapwidgets.WidgetGroup.ALTITUDE;
 import static net.osmand.plus.views.mapwidgets.WidgetGroup.ANT_PLUS;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.BOTTOM;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.LEFT;
@@ -17,6 +18,7 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.inapp.InAppPurchaseHelper;
+import net.osmand.plus.plugins.PluginsHelper;
 import net.osmand.plus.plugins.development.OsmandDevelopmentPlugin;
 import net.osmand.plus.plugins.mapillary.MapillaryPlugin;
 import net.osmand.plus.plugins.parking.ParkingPositionPlugin;
@@ -124,7 +126,7 @@ public enum WidgetType {
 	@StringRes
 	public final int docsUrlId;
 	@Nullable
-	public WidgetGroup group;
+	private WidgetGroup group;
 	@NonNull
 	public final WidgetsPanel defaultPanel;
 
@@ -151,6 +153,16 @@ public int getIconId(boolean night) {
 		return night ? nightIconId : dayIconId;
 	}
 
+	public WidgetGroup getGroup() {
+		if (group == ALTITUDE) {
+			OsmandDevelopmentPlugin plugin = PluginsHelper.getPlugin(OsmandDevelopmentPlugin.class);
+			if (plugin == null || !plugin.isHeightmapEnabled()) {
+				return null;
+			}
+		}
+		return group;
+	}
+
 	@StringRes
 	public int getGroupDescriptionId() {
 		if (this == MAGNETIC_BEARING) {
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsInitializer.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsInitializer.java
new file mode 100644
index 00000000000..1facbc75292
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsInitializer.java
@@ -0,0 +1,145 @@
+package net.osmand.plus.views.mapwidgets;
+
+import static net.osmand.plus.views.mapwidgets.WidgetType.ALTITUDE_MAP_CENTER;
+import static net.osmand.plus.views.mapwidgets.WidgetType.ALTITUDE_MY_LOCATION;
+import static net.osmand.plus.views.mapwidgets.WidgetType.AVERAGE_SPEED;
+import static net.osmand.plus.views.mapwidgets.WidgetType.BATTERY;
+import static net.osmand.plus.views.mapwidgets.WidgetType.COORDINATES_CURRENT_LOCATION;
+import static net.osmand.plus.views.mapwidgets.WidgetType.COORDINATES_MAP_CENTER;
+import static net.osmand.plus.views.mapwidgets.WidgetType.CURRENT_SPEED;
+import static net.osmand.plus.views.mapwidgets.WidgetType.CURRENT_TIME;
+import static net.osmand.plus.views.mapwidgets.WidgetType.DISTANCE_TO_DESTINATION;
+import static net.osmand.plus.views.mapwidgets.WidgetType.ELEVATION_PROFILE;
+import static net.osmand.plus.views.mapwidgets.WidgetType.GPS_INFO;
+import static net.osmand.plus.views.mapwidgets.WidgetType.INTERMEDIATE_DESTINATION;
+import static net.osmand.plus.views.mapwidgets.WidgetType.LANES;
+import static net.osmand.plus.views.mapwidgets.WidgetType.MAGNETIC_BEARING;
+import static net.osmand.plus.views.mapwidgets.WidgetType.MARKERS_TOP_BAR;
+import static net.osmand.plus.views.mapwidgets.WidgetType.MAX_SPEED;
+import static net.osmand.plus.views.mapwidgets.WidgetType.NEXT_TURN;
+import static net.osmand.plus.views.mapwidgets.WidgetType.RADIUS_RULER;
+import static net.osmand.plus.views.mapwidgets.WidgetType.RELATIVE_BEARING;
+import static net.osmand.plus.views.mapwidgets.WidgetType.SECOND_NEXT_TURN;
+import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_1;
+import static net.osmand.plus.views.mapwidgets.WidgetType.SIDE_MARKER_2;
+import static net.osmand.plus.views.mapwidgets.WidgetType.SMALL_NEXT_TURN;
+import static net.osmand.plus.views.mapwidgets.WidgetType.STREET_NAME;
+import static net.osmand.plus.views.mapwidgets.WidgetType.TIME_TO_DESTINATION;
+import static net.osmand.plus.views.mapwidgets.WidgetType.TIME_TO_INTERMEDIATE;
+import static net.osmand.plus.views.mapwidgets.WidgetType.TRUE_BEARING;
+
+import androidx.annotation.NonNull;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.plugins.PluginsHelper;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.util.Algorithms;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class WidgetsInitializer {
+
+	private final MapActivity mapActivity;
+	private final OsmandSettings settings;
+	private final ApplicationMode appMode;
+	private final OsmandApplication app;
+
+	private final MapWidgetsFactory factory;
+	private final WidgetInfoCreator creator;
+
+	private final List<MapWidgetInfo> mapWidgetsCache = new ArrayList<>();
+
+	private WidgetsInitializer(MapActivity mapActivity, ApplicationMode appMode) {
+		this.mapActivity = mapActivity;
+		this.appMode = appMode;
+		app = mapActivity.getMyApplication();
+		settings = app.getSettings();
+		factory = new MapWidgetsFactory(mapActivity);
+		creator = new WidgetInfoCreator(app, appMode);
+	}
+
+	private List<MapWidgetInfo> createAllControls() {
+		createCommonWidgets();
+		PluginsHelper.createMapWidgets(mapActivity, mapWidgetsCache, appMode);
+		app.getAidlApi().createWidgetControls(mapActivity, mapWidgetsCache, appMode);
+		createCustomWidgets();
+		return mapWidgetsCache;
+	}
+
+	public void createCommonWidgets() {
+		createTopWidgets();
+		createBottomWidgets();
+		createLeftWidgets();
+		createRightWidgets();
+	}
+
+	private void createTopWidgets() {
+		addWidgetInfo(COORDINATES_CURRENT_LOCATION);
+		addWidgetInfo(COORDINATES_MAP_CENTER);
+		addWidgetInfo(STREET_NAME);
+		addWidgetInfo(LANES);
+		addWidgetInfo(MARKERS_TOP_BAR);
+	}
+
+	private void createBottomWidgets() {
+		addWidgetInfo(ELEVATION_PROFILE);
+	}
+
+	private void createLeftWidgets() {
+		addWidgetInfo(NEXT_TURN);
+		addWidgetInfo(SMALL_NEXT_TURN);
+		addWidgetInfo(SECOND_NEXT_TURN);
+	}
+
+	private void createRightWidgets() {
+		addWidgetInfo(INTERMEDIATE_DESTINATION);
+		addWidgetInfo(DISTANCE_TO_DESTINATION);
+		addWidgetInfo(RELATIVE_BEARING);
+		addWidgetInfo(MAGNETIC_BEARING);
+		addWidgetInfo(TRUE_BEARING);
+		addWidgetInfo(CURRENT_SPEED);
+		addWidgetInfo(AVERAGE_SPEED);
+		addWidgetInfo(MAX_SPEED);
+		addWidgetInfo(ALTITUDE_MAP_CENTER);
+		addWidgetInfo(ALTITUDE_MY_LOCATION);
+		addWidgetInfo(GPS_INFO);
+		addWidgetInfo(CURRENT_TIME);
+		addWidgetInfo(BATTERY);
+		addWidgetInfo(RADIUS_RULER);
+		addWidgetInfo(TIME_TO_INTERMEDIATE);
+		addWidgetInfo(TIME_TO_DESTINATION);
+		addWidgetInfo(SIDE_MARKER_1);
+		addWidgetInfo(SIDE_MARKER_2);
+	}
+
+	private void addWidgetInfo(@NonNull WidgetType widgetType) {
+		MapWidgetInfo widgetInfo = creator.createWidgetInfo(factory, widgetType);
+		if (widgetInfo != null) {
+			mapWidgetsCache.add(widgetInfo);
+		}
+	}
+
+	public void createCustomWidgets() {
+		List<String> widgetKeys = settings.CUSTOM_WIDGETS_KEYS.getStringsListForProfile(appMode);
+		if (!Algorithms.isEmpty(widgetKeys)) {
+			for (String key : widgetKeys) {
+				WidgetType widgetType = WidgetType.getById(key);
+				if (widgetType != null) {
+					MapWidgetInfo widgetInfo = creator.createCustomWidgetInfo(factory, key, widgetType);
+					if (widgetInfo != null) {
+						mapWidgetsCache.add(widgetInfo);
+					}
+				}
+			}
+		}
+	}
+
+	public static List<MapWidgetInfo> createAllControls(@NonNull MapActivity mapActivity,
+	                                                    @NonNull ApplicationMode appMode) {
+		WidgetsInitializer initializer = new WidgetsInitializer(mapActivity, appMode);
+		return initializer.createAllControls();
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java
index df57832ed75..481e62855b7 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java
@@ -14,6 +14,7 @@
 import net.osmand.plus.settings.backend.preferences.OsmandPreference;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
 import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.MapWidgetsFactory;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
@@ -157,9 +158,10 @@ private MapWidgetInfo createDuplicateWidgetInfo(@NonNull WidgetType widgetType,
 		String duplicateWidgetId = WidgetType.getDuplicateWidgetId(widgetType);
 		MapWidget duplicateWidget = widgetsFactory.createMapWidget(duplicateWidgetId, widgetType);
 		if (duplicateWidget != null) {
+			WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
 			settings.CUSTOM_WIDGETS_KEYS.addModeValue(appMode, duplicateWidgetId);
-			MapWidgetInfo duplicateWidgetInfo = widgetRegistry.createCustomWidget(duplicateWidgetId,
-					duplicateWidget, widgetType, panel, appMode);
+			MapWidgetInfo duplicateWidgetInfo = creator.createCustomWidgetInfo(
+					duplicateWidgetId, duplicateWidget, widgetType, panel);
 			widgetRegistry.enableDisableWidgetForMode(appMode, duplicateWidgetInfo, true, false);
 			return duplicateWidgetInfo;
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java
index 8c5df6ab225..7fbfff2aa31 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java
@@ -23,6 +23,7 @@
 import net.osmand.plus.views.layers.MapInfoLayer;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
 import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.MapWidgetsFactory;
 import net.osmand.plus.views.mapwidgets.WidgetGroup;
 import net.osmand.plus.views.mapwidgets.WidgetType;
@@ -112,7 +113,7 @@ private void initFromBundle(@NonNull Bundle bundle) {
 			throw new IllegalStateException("Failed to find widget by id: " + widgetId);
 		}
 		widgetType = widgetInfo.getWidgetType();
-		widgetGroup = widgetType == null ? null : widgetType.group;
+		widgetGroup = widgetType == null ? null : widgetType.getGroup();
 		panel = widgetInfo.widgetPanel;
 	}
 
@@ -300,8 +301,9 @@ private String createDuplicateWidget() {
 			widgetState.copyPrefs(appMode, duplicateId);
 		}
 		MapWidget duplicateWidget = new MapWidgetsFactory(mapActivity).createMapWidget(duplicateId, widgetType);
-		MapWidgetInfo duplicateWidgetInfo = widgetRegistry
-				.createCustomWidget(duplicateId, duplicateWidget, widgetType, panel, appMode);
+		WidgetInfoCreator creator = new WidgetInfoCreator(app, appMode);
+		MapWidgetInfo duplicateWidgetInfo = creator.createCustomWidgetInfo(
+				duplicateId, duplicateWidget, widgetType, panel);
 		duplicateWidgetInfo.enableDisableForMode(appMode, true);
 		widgetInfo.widget.copySettings(appMode, duplicateId);
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
index 5c08c8f29fe..6ed6feeb411 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
@@ -47,6 +47,7 @@
 import net.osmand.plus.views.layers.MapInfoLayer;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
 import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetInfoCreator;
 import net.osmand.plus.views.mapwidgets.MapWidgetsFactory;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
@@ -284,7 +285,8 @@ private MapWidgetInfo createDuplicateWidget(@NonNull String widgetId, @NonNull W
 			MapWidget widget = widgetsFactory.createMapWidget(id, widgetType);
 			if (widget != null) {
 				settings.CUSTOM_WIDGETS_KEYS.addValue(id);
-				return widgetRegistry.createCustomWidget(id, widget, widgetType, panel, selectedAppMode);
+				WidgetInfoCreator creator = new WidgetInfoCreator(app, selectedAppMode);
+				return creator.createCustomWidgetInfo(id, widget, widgetType, panel);
 			}
 		}
 		return null;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
index ca270a6608e..6da607df43f 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
@@ -265,7 +265,7 @@ private void inflateWidgetItemsViews(@NonNull Set<MapWidgetInfo> widgetsInfo, @N
 			title.setText(widgetInfo.getTitle(app));
 
 			WidgetType widgetType = widgetInfo.getWidgetType();
-			WidgetGroup widgetGroup = widgetType == null ? null : widgetType.group;
+			WidgetGroup widgetGroup = widgetType == null ? null : widgetType.getGroup();
 			if (widgetGroup != null) {
 				TextView description = view.findViewById(R.id.description);
 				description.setText(widgetGroup.titleId);
@@ -344,7 +344,7 @@ private List<WidgetType> excludeGroupsDuplicated(List<WidgetType> widgets) {
 		List<WidgetGroup> visitedGroups = new ArrayList<>();
 		List<WidgetType> matchingWidgets = new ArrayList<>();
 		for (WidgetType widget : widgets) {
-			WidgetGroup group = widget.group;
+			WidgetGroup group = widget.getGroup();
 			if (group != null && !visitedGroups.contains(group)) {
 				visitedGroups.add(group);
 				matchingWidgets.add(widget);
@@ -359,7 +359,7 @@ private void inflateAvailableDefaultWidgets(@NonNull List<WidgetType> widgets, b
 		LayoutInflater inflater = UiUtilities.getInflater(getContext(), nightMode);
 		for (int i = 0; i < widgets.size(); i++) {
 			WidgetType widgetType = widgets.get(i);
-			WidgetGroup widgetGroup = widgetType.group;
+			WidgetGroup widgetGroup = widgetType.getGroup();
 
 			View view = inflater.inflate(R.layout.configure_screen_widget_item, availableWidgetsContainer, false);
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
index beb233ce7b0..6cd776ee8f6 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
@@ -273,7 +273,7 @@ private List<String> listAddedGroupWidgets(@NonNull WidgetGroup widgetGroup) {
 				if (listItem.value instanceof AddedWidgetUiInfo) {
 					AddedWidgetUiInfo addedWidgetUiInfo = (AddedWidgetUiInfo) listItem.value;
 					WidgetType widgetType = WidgetType.getById(addedWidgetUiInfo.key);
-					if (widgetType != null && widgetGroup == widgetType.group) {
+					if (widgetType != null && widgetGroup == widgetType.getGroup()) {
 						addedGroupWidgets.add(widgetType.id);
 					}
 				}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapterHelper.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapterHelper.java
index a482541063d..a38d5ccb5ae 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapterHelper.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapterHelper.java
@@ -58,7 +58,7 @@ public void deleteWidget(@NonNull AddedWidgetUiInfo widgetUiInfo, int position)
 
 	private void updateAvailableWidget(@NonNull AddedWidgetUiInfo addedWidgetUiInfo) {
 		WidgetType widgetType = WidgetType.getById(addedWidgetUiInfo.key);
-		WidgetGroup widgetGroup = widgetType != null ? widgetType.group : null;
+		WidgetGroup widgetGroup = widgetType != null ? widgetType.getGroup() : null;
 		if (widgetGroup != null) {
 			boolean addGroupItem = areAllGroupWidgetsAdded(widgetGroup);
 			if (addGroupItem) {
@@ -355,8 +355,8 @@ private boolean widgetAlreadyAdded(@NonNull String widgetId) {
 
 	private void removeAddedItemFromAvailable(@NonNull String widgetId) {
 		WidgetType widgetType = WidgetType.getById(widgetId);
-		if (widgetType != null && widgetType.group != null) {
-			WidgetGroup group = widgetType.group;
+		WidgetGroup group = widgetType != null ? widgetType.getGroup() : null;
+		if (group != null) {
 			if (areAllGroupWidgetsAdded(group)) {
 				int indexToRemove = getIndexOfAvailableGroup(group);
 				if (indexToRemove != -1) {
@@ -389,7 +389,7 @@ private boolean areAllGroupWidgetsAdded(@NonNull WidgetGroup group) {
 			if (listItem.value instanceof AddedWidgetUiInfo) {
 				AddedWidgetUiInfo addedWidgetUiInfo = (AddedWidgetUiInfo) listItem.value;
 				WidgetType widgetType = WidgetType.getById(addedWidgetUiInfo.key);
-				if (widgetType != null && group == widgetType.group) {
+				if (widgetType != null && group == widgetType.getGroup()) {
 					addedGroupWidgetsCount++;
 				}
 			}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
index dbd2e8f9ac2..edfbd516a10 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
@@ -357,7 +357,7 @@ private List<ListItem> createAvailableWidgetsList(@NonNull ApplicationMode appMo
 			WidgetType widgetType = WidgetType.getById(widgetInfo.key);
 			boolean defaultWidget = widgetType != null;
 			if (defaultWidget) {
-				WidgetGroup group = widgetType.group;
+				WidgetGroup group = widgetType.getGroup();
 				if (group != null && !availableGroups.contains(group)) {
 					availableGroups.add(group);
 					defaultWidgetsItems.put(group.getOrder(), new ListItem(ItemType.AVAILABLE_GROUP, group));
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/AvailableItemViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/AvailableItemViewHolder.java
index b1174df2ab4..e4a2ed1eeae 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/AvailableItemViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/AvailableItemViewHolder.java
@@ -1,6 +1,5 @@
 package net.osmand.plus.views.mapwidgets.configure.reorder.viewholder;
 
-import android.content.Context;
 import android.text.Spannable;
 import android.text.SpannableString;
 import android.text.style.ForegroundColorSpan;
@@ -9,6 +8,7 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.UnmovableItem;
@@ -44,14 +44,14 @@ public boolean isMovingDisabled() {
 	}
 
 	@NonNull
-	public static Spannable getGroupTitle(@NonNull WidgetGroup group, @NonNull Context context, boolean nightMode) {
-		String groupName = context.getString(group.titleId);
+	public static Spannable getGroupTitle(@NonNull WidgetGroup group, @NonNull OsmandApplication app, boolean nightMode) {
+		String groupName = app.getString(group.titleId);
 		int widgetsCount = group.getWidgets().size();
-		String title = context.getString(R.string.ltr_or_rtl_combine_via_dash, groupName, String.valueOf(widgetsCount));
+		String title = app.getString(R.string.ltr_or_rtl_combine_via_dash, groupName, String.valueOf(widgetsCount));
 		SpannableString spannableTitle = new SpannableString(title);
 		int spanFlag = Spannable.SPAN_EXCLUSIVE_EXCLUSIVE;
-		int primaryTextColor = ColorUtilities.getPrimaryTextColor(context, nightMode);
-		int secondaryTextColor = ColorUtilities.getSecondaryTextColor(context, nightMode);
+		int primaryTextColor = ColorUtilities.getPrimaryTextColor(app, nightMode);
+		int secondaryTextColor = ColorUtilities.getSecondaryTextColor(app, nightMode);
 
 		int nameStartIndex = title.indexOf(groupName);
 		if (nameStartIndex != -1) {
