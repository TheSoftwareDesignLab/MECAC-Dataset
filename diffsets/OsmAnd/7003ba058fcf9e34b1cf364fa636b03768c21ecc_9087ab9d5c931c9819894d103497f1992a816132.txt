diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
index 1dc9c484a73..ba102dcf9db 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
@@ -2086,7 +2086,7 @@ public boolean onPreferenceStartFragment(PreferenceFragmentCompat caller, Prefer
 			Fragment fragment = Fragment.instantiate(this, fragmentName);
 
 			getSupportFragmentManager().beginTransaction()
-					.replace(R.id.fragmentContainer, fragment, fragment.getClass().getSimpleName())
+					.replace(R.id.fragmentContainer, fragment, fragment.getClass().getName())
 					.addToBackStack(DRAWER_SETTINGS_ID + ".new")
 					.commit();
 
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java
index 6dad949aab6..af3a315e6ad 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java
@@ -58,11 +58,12 @@ public void onProfilePressed(ApplicationMode item) {
 		dismiss();
 	}
 
-	public static void showInstance(@NonNull FragmentManager fm, Fragment target) {
+	public static void showInstance(@NonNull FragmentManager fm, Fragment target, boolean usedOnMap) {
 		try {
 			if (fm.findFragmentByTag(SelectAppModesBottomSheetDialogFragment.TAG) == null) {
 				SelectAppModesBottomSheetDialogFragment fragment = new SelectAppModesBottomSheetDialogFragment();
 				fragment.setTargetFragment(target, 0);
+				fragment.setUsedOnMap(usedOnMap);
 				fragment.show(fm, SelectAppModesBottomSheetDialogFragment.TAG);
 			}
 		} catch (RuntimeException e) {
diff --git a/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java
index e5bb17f270a..2fdd8b2c78f 100644
--- a/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/BaseSettingsFragment.java
@@ -125,9 +125,7 @@ public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {
 	@Override
 	@SuppressLint("RestrictedApi")
 	public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
-		nightMode = !settings.isLightContent();
-		themeRes = nightMode ? R.style.OsmandDarkTheme : R.style.OsmandLightTheme;
-
+		updateTheme();
 		View view = super.onCreateView(inflater, container, savedInstanceState);
 		if (view != null) {
 			AndroidUtils.addStatusBarPadding21v(getContext(), view);
@@ -145,10 +143,17 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle sa
 			setDivider(null);
 			view.setBackgroundColor(ContextCompat.getColor(app, getBackgroundColorRes()));
 		}
-
 		return view;
 	}
 
+	private boolean updateTheme() {
+		boolean nightMode = !settings.isLightContent();
+		boolean changed = this.nightMode != nightMode;
+		this.nightMode = nightMode;
+		this.themeRes = nightMode ? R.style.OsmandDarkTheme : R.style.OsmandLightTheme;
+		return changed;
+	}
+
 	@Override
 	public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
 		super.onViewCreated(view, savedInstanceState);
@@ -157,11 +162,9 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat
 
 	@Override
 	public RecyclerView onCreateRecyclerView(LayoutInflater inflater, ViewGroup parent, Bundle savedInstanceState) {
-		LayoutInflater themedInflater = UiUtilities.getInflater(getActivity(), nightMode);
-
+		LayoutInflater themedInflater = UiUtilities.getInflater(getActivity(), isNightMode());
 		RecyclerView recyclerView = super.onCreateRecyclerView(themedInflater, parent, savedInstanceState);
 		recyclerView.setPadding(0, 0, 0, AndroidUtils.dpToPx(app, 80));
-
 		return recyclerView;
 	}
 
@@ -285,8 +288,25 @@ public void onDisplayPreferenceDialog(Preference preference) {
 
 	@Override
 	public void onAppModeChanged() {
-		updateToolbar();
-		updateAllSettings();
+		if (updateTheme()) {
+			recreate();
+		} else {
+			updateToolbar();
+			updateAllSettings();
+		}
+	}
+
+	public void recreate() {
+		FragmentActivity activity = getActivity();
+		if (activity != null) {
+			Fragment fragment = Fragment.instantiate(activity, currentScreenType.fragmentName);
+			FragmentManager fm = activity.getSupportFragmentManager();
+			fm.popBackStack();
+			fm.beginTransaction()
+					.replace(R.id.fragmentContainer, fragment, fragment.getClass().getName())
+					.addToBackStack(DRAWER_SETTINGS_ID + ".new")
+					.commit();
+		}
 	}
 
 	protected abstract void setupPreferences();
@@ -311,7 +331,7 @@ protected void createToolbar(LayoutInflater inflater, View view) {
 		AppBarLayout appBarLayout = (AppBarLayout) view.findViewById(R.id.appbar);
 		ViewCompat.setElevation(appBarLayout, 5.0f);
 
-		View toolbarContainer = UiUtilities.getInflater(getActivity(), nightMode).inflate(currentScreenType.toolbarResId, appBarLayout);
+		View toolbarContainer = UiUtilities.getInflater(getActivity(), isNightMode()).inflate(currentScreenType.toolbarResId, appBarLayout);
 
 		TextView toolbarTitle = (TextView) view.findViewById(R.id.toolbar_title);
 		toolbarTitle.setText(getPreferenceScreen().getTitle());
@@ -334,7 +354,7 @@ public void onClick(View v) {
 				public void onClick(View v) {
 					FragmentManager fragmentManager = getFragmentManager();
 					if (fragmentManager != null) {
-						SelectAppModesBottomSheetDialogFragment.showInstance(fragmentManager, BaseSettingsFragment.this);
+						SelectAppModesBottomSheetDialogFragment.showInstance(fragmentManager, BaseSettingsFragment.this, false);
 					}
 				}
 			});
@@ -433,7 +453,7 @@ private void registerPreferences(PreferenceGroup preferenceGroup) {
 	public void updateAllSettings() {
 		PreferenceScreen screen = getPreferenceScreen();
 		if (screen != null) {
-			getPreferenceScreen().removeAll();
+			screen.removeAll();
 		}
 		updatePreferencesScreen();
 	}
