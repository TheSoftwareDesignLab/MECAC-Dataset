diff --git a/OsmAnd/src/net/osmand/plus/routing/RouteCalculationResult.java b/OsmAnd/src/net/osmand/plus/routing/RouteCalculationResult.java
index d92d65a7195..5b6cb4f75f9 100644
--- a/OsmAnd/src/net/osmand/plus/routing/RouteCalculationResult.java
+++ b/OsmAnd/src/net/osmand/plus/routing/RouteCalculationResult.java
@@ -40,7 +40,7 @@ public class RouteCalculationResult {
 
 	private static final double DISTANCE_CLOSEST_TO_INTERMEDIATE = 3000;
 	private static final double DISTANCE_THRESHOLD_TO_INTERMEDIATE = 25;
-	private static final double DISTANCE_THRESHOLD_TO_INTRODUCE_FIRST_AND_LAST_POINTS = 50;
+	private static final double DISTANCE_THRESHOLD_TO_INTRODUCE_FIRST_AND_LAST_POINTS = 15;
 
 	public static final String FIRST_LAST_LOCATION_PROVIDER = "FirstLastLocationProvider";
 
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/RouteLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/RouteLayer.java
index 6a8ec681525..48765784553 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/RouteLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/RouteLayer.java
@@ -647,6 +647,9 @@ private List<ActionPoint> calculateActionPoints(double topLatitude, double leftL
 		int prevFinishPoint = -1;
 		for (int routePoint = 0; routePoint < routeNodes.size(); routePoint++) {
 			Location loc = routeNodes.get(routePoint);
+			if (RouteCalculationResult.FIRST_LAST_LOCATION_PROVIDER.equals(loc.getProvider())) {
+				continue;
+			}
 			if (nf != null) {
 				int pnt = nf.routeEndPointOffset == 0 ? nf.routePointOffset : nf.routeEndPointOffset;
 				if(pnt < routePoint + cd ) {
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWay.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWay.java
index 946d83620eb..06aef8d1ea4 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWay.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWay.java
@@ -46,7 +46,6 @@ public abstract class GeometryWay<T extends CommonGeometryWayContext, D extends
 	List<GeometryWayPoint> points = new ArrayList<>();
 	//OpenGL
 	protected final List<List<DrawPathData31>> pathsData31Cache = new ArrayList<>();
-	protected int startLocationIndexCached = -1;
 	public int baseOrder = -1;
 	public long linesPriority = Long.MIN_VALUE;
 	public VectorLinesCollection vectorLinesCollection;
@@ -148,7 +147,6 @@ public void clearWay() {
 
 	private void clearPathCache() {
 		pathsData31Cache.clear();
-		startLocationIndexCached = -1;
 	}
 
 	public void resetSymbolProviders() {
@@ -207,6 +205,11 @@ public void drawSegments(@NonNull RotatedTileBox tb, @Nullable Canvas canvas, do
 
 		MapRendererView mapRenderer = getMapRenderer();
 		boolean hasMapRenderer = mapRenderer != null;
+		if (hasMapRenderer && !pathsData31Cache.isEmpty()) {
+			cutStartOfCachedPath(mapRenderer, tb, startLocationIndex, lastProjection);
+			return;
+		}
+
 		PathGeometryZoom geometryZoom = !hasMapRenderer ? getGeometryZoom(tb) : null;
 		TByteArrayList simplification = geometryZoom != null ? geometryZoom.getSimplifyPoints() : null;
 		List<Double> odistances = geometryZoom != null ? geometryZoom.getDistances() : null;
@@ -217,22 +220,19 @@ public void drawSegments(@NonNull RotatedTileBox tb, @Nullable Canvas canvas, do
 		GeometryWayStyle<?> walkWayStyle = new GeometryWalkWayStyle(getContext());
 		GeometryWayStyle<?> style = defaultWayStyle;
 		boolean previousVisible = false;
-		if (lastProjection != null) {
-			previousVisible = addInitialPoint(tb, topLatitude, leftLongitude, bottomLatitude, rightLongitude,
-					startLocationIndex == 0 ? walkWayStyle : defaultWayStyle, previousVisible, lastProjection, startLocationIndex);
-		}
-		Location nextVisiblePoint = getNextVisiblePoint();
-		if (nextVisiblePoint != null) {
-			boolean added = addInitialPoint(tb, topLatitude, leftLongitude, bottomLatitude, rightLongitude,
-					style, previousVisible, nextVisiblePoint, startLocationIndex);
-			if (added) {
-				previousVisible = true;
+		if (!hasMapRenderer) {
+			if (lastProjection != null) {
+				previousVisible = addInitialPoint(tb, topLatitude, leftLongitude, bottomLatitude, rightLongitude,
+						style, lastProjection, startLocationIndex);
+			}
+			Location nextVisiblePoint = getNextVisiblePoint();
+			if (nextVisiblePoint != null) {
+				boolean added = addInitialPoint(tb, topLatitude, leftLongitude, bottomLatitude, rightLongitude,
+						style, nextVisiblePoint, startLocationIndex);
+				if (added) {
+					previousVisible = true;
+				}
 			}
-		}
-
-		if (hasMapRenderer && !pathsData31Cache.isEmpty()) {
-			cutStartOfCachedPath(mapRenderer, tb, startLocationIndex, previousVisible);
-			return;
 		}
 
 		GeometryWayProvider locationProvider = this.locationProvider;
@@ -375,8 +375,7 @@ protected void addLocation(RotatedTileBox tb, double latitude, double longitude,
 	}
 
 	protected boolean addInitialPoint(RotatedTileBox tb, double topLatitude, double leftLongitude, double bottomLatitude,
-	                                  double rightLongitude, GeometryWayStyle<?> style, boolean previousVisible,
-	                                  Location lastPoint, int startLocationIndex) {
+	                                  double rightLongitude, GeometryWayStyle<?> style, Location lastPoint, int startLocationIndex) {
 		if (hasMapRenderer() || (leftLongitude <= lastPoint.getLongitude() && lastPoint.getLongitude() <= rightLongitude
 				&& bottomLatitude <= lastPoint.getLatitude() && lastPoint.getLatitude() <= topLatitude)) {
 			addLocation(tb, lastPoint.getLatitude(), lastPoint.getLongitude(), startLocationIndex, 0, true,
@@ -390,94 +389,50 @@ protected boolean addInitialPoint(RotatedTileBox tb, double topLatitude, double
 	protected List<List<DrawPathData31>> cutStartOfCachedPath(@NonNull MapRendererView mapRenderer,
 	                                                          @NonNull RotatedTileBox tb,
 	                                                          int startLocationIndex,
-	                                                          boolean previousVisible) {
-		List<List<DrawPathData31>> croppedPathsData31 = new ArrayList<>();
-		boolean drawNext = false;
+	                                                          Location lastProjection) {
 		float passedDist = 0;
 		int passedLineId = 0;
-		int firstX31 = -1;
-		int firstY31 = -1;
-		boolean create = !previousVisible || startLocationIndexCached == -1;
-		boolean update = false;
+		int lastX31 = 0;
+		int lastY31 = 0;
+		float lastPathDist = 0;
 		for (List<DrawPathData31> pathsDataList : pathsData31Cache) {
-			if (drawNext) {
-				croppedPathsData31.add(pathsDataList);
-				drawPathLine(tb, pathsDataList);
-				continue;
-			}
-			List<DrawPathData31> newPathsDataList = new ArrayList<>();
 			for (DrawPathData31 pathData : pathsDataList) {
-				if (drawNext) {
-					newPathsDataList.add(pathData);
-					continue;
+				boolean hasIndex = false;
+				for (Integer index : pathData.indexes) {
+					if (index <= startLocationIndex) {
+						hasIndex = true;
+						break;
+					}
 				}
-				if (pathData.indexes.size() < 3 || pathData.indexes.contains(startLocationIndex)) {
-					List<Integer> ind = new ArrayList<>();
-					List<Integer> tx = new ArrayList<>();
-					List<Integer> ty = new ArrayList<>();
-					List<Float> heights = new ArrayList<>();
+				if (hasIndex) {
 					List<Integer> indexes = pathData.indexes;
-					for (int i = 0; i < indexes.size(); i++) {
+					for (int i = 0; i < indexes.size() - 1; i++) {
 						Integer index = indexes.get(i);
-						if (previousVisible && index >= INITIAL_POINT_INDEX_SHIFT) {
-							continue;
-						}
-						if (index >= startLocationIndex - 1) {
-							ind.add(index);
-							tx.add(pathData.tx.get(i));
-							ty.add(pathData.ty.get(i));
-							if (pathData.heights != null) {
-								heights.add(pathData.heights.get(i));
-							}
-							if (firstX31 == -1) {
-								if (index >= startLocationIndexCached && index > 0) {
-									passedDist += pathData.distances.get(i);
-								}
-								firstX31 = pathData.tx.get(i);
-								firstY31 = pathData.ty.get(i);
-							}
-						} else if (!update && index >= startLocationIndexCached && index > 0) {
-							if (pathData.distances.get(i) == 0 && i > 0) {
-								passedDist += (float) MapUtils.measuredDist31(
-										pathData.tx.get(i - 1), pathData.ty.get(i - 1), pathData.tx.get(i), pathData.ty.get(i));
+						if (index < startLocationIndex) {
+							lastX31 = pathData.tx.get(i);
+							lastY31 = pathData.ty.get(i);
+							if (passedLineId != pathData.lineId) {
+								passedDist = pathData.distances.get(i);
 							} else {
-								passedDist += pathData.distances.get(i);
+								passedDist += i > 0 ? pathData.distances.get(i) : lastPathDist;
 							}
-						}
-					}
-					if (previousVisible) {
-						if (startLocationIndexCached == -1) {
-							startLocationIndexCached = startLocationIndex;
-						}
-						if (!update && !this.points.isEmpty() && firstX31 != -1) {
-							GeometryWayPoint firstPnt = this.points.get(0);
-							passedDist += (float) MapUtils.measuredDist31(firstX31, firstY31, firstPnt.tx31, firstPnt.ty31);
 							passedLineId = pathData.lineId;
-							update = passedLineId > 0;
+							lastPathDist = pathData.distances.get(pathData.distances.size() - 1);
 						}
-					} else {
-						drawNext = true;
-					}
-					if (create && tx.size() > 1) {
-						DrawPathData31 newPathData = new DrawPathData31(ind, tx, ty, pathData.style);
-						if (!heights.isEmpty()) {
-							newPathData.heights = heights;
-						}
-						newPathsDataList.add(newPathData);
 					}
 				}
 			}
-			if (create && !newPathsDataList.isEmpty()) {
-				croppedPathsData31.add(newPathsDataList);
-				drawPathLine(tb, newPathsDataList);
-			}
 		}
-		if (update) {
+		if (lastProjection != null && lastX31 != 0 && lastY31 != 0) {
+			passedDist += (float) MapUtils.measuredDist31(
+					MapUtils.get31TileNumberX(lastProjection.getLongitude()),
+					MapUtils.get31TileNumberY(lastProjection.getLatitude()), lastX31, lastY31);
+		}
+
+		if (passedLineId > 0) {
 			updatePathLine(passedLineId, passedDist);
-			if (!create) {
-				return null;
-			}
 		}
+
 		if (shouldDrawArrows()) {
 			VectorLinesCollection vectorLinesCollection = this.vectorLinesCollection;
 			VectorLineArrowsProvider vectorLineArrowsProvider = this.vectorLineArrowsProvider;
@@ -492,7 +447,7 @@ protected List<List<DrawPathData31>> cutStartOfCachedPath(@NonNull MapRendererVi
 			}
 		}
 
-		return create ? croppedPathsData31 : null;
+		return new ArrayList<>(pathsData31Cache);
 	}
 
 	protected boolean shouldDrawArrows() {
@@ -524,7 +479,7 @@ public void drawRouteSegment(@NonNull RotatedTileBox tb, @Nullable Canvas canvas
 				if (hasMapRenderer) {
 					List<DrawPathData31> pathsData = GeometryWayPathAlgorithms.calculatePath(points);
 					if (!Algorithms.isEmpty(pathsData)) {
-						drawPathLine(tb, pathsData);
+						drawPathLine(pathsData);
 					}
 					pathsData31Cache.add(pathsData);
 				} else if (canvas != null) {
@@ -588,7 +543,7 @@ private void drawPathLine(Canvas canvas, RotatedTileBox tb, List<DrawPathData> p
 		}
 	}
 
-	private void drawPathLine(RotatedTileBox tb, List<DrawPathData31> pathsData) {
+	private void drawPathLine(List<DrawPathData31> pathsData) {
 		MapRendererView mapRenderer = getMapRenderer();
 		if (mapRenderer != null) {
 			VectorLinesCollection vectorLinesCollection = this.vectorLinesCollection;
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayDrawer.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayDrawer.java
index 494efe6a3a8..60a7711aa27 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayDrawer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayDrawer.java
@@ -385,11 +385,11 @@ public void drawPath(Canvas canvas, DrawPathData pathData) {
 
 	public void drawPath(@NonNull VectorLinesCollection collection, int baseOrder, boolean shouldDrawArrows,
 	                     @NonNull List<DrawPathData31> pathsData) {
-		int lineId = LINE_ID;
 		GeometryWayStyle<?> prevStyle = null;
 		List<DrawPathData31> dataArr = new ArrayList<>();
+		int lineId = LINE_ID;
 		for (DrawPathData31 data : pathsData) {
-			if (prevStyle != null && (!Algorithms.objectEquals(data.style, prevStyle) || data.style.isUnique()
+			if (!dataArr.isEmpty() && prevStyle != null && (!Algorithms.objectEquals(data.style, prevStyle) || data.style.isUnique()
 					|| prevStyle.hasPathLine() != data.style.hasPathLine())) {
 				drawVectorLine(collection, lineId++, baseOrder, shouldDrawArrows, true, prevStyle, dataArr);
 				dataArr.clear();
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPathAlgorithms.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPathAlgorithms.java
index cf006ac089c..c0548c3e92c 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPathAlgorithms.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPathAlgorithms.java
@@ -3,16 +3,17 @@
 import android.graphics.Path;
 import android.graphics.PointF;
 
-import net.osmand.core.jni.QListFloat;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
 import net.osmand.data.RotatedTileBox;
+import net.osmand.plus.views.layers.geometry.GeometryWayDrawer.DrawPathData31;
 import net.osmand.util.MapAlgorithms;
 import net.osmand.util.MapUtils;
 
 import java.util.ArrayList;
 import java.util.List;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
 import gnu.trove.list.array.TByteArrayList;
 
 public class GeometryWayPathAlgorithms {
@@ -142,8 +143,8 @@ public  static List<GeometryWayDrawer.DrawPathData> calculatePath(@NonNull Rotat
 		return pathsData;
 	}
 
-	public static List<GeometryWayDrawer.DrawPathData31> calculatePath(@NonNull List<GeometryWayPoint> points) {
-		List<GeometryWayDrawer.DrawPathData31> pathsData = new ArrayList<>();
+	public static List<DrawPathData31> calculatePath(@NonNull List<GeometryWayPoint> points) {
+		List<DrawPathData31> pathsData = new ArrayList<>();
 		GeometryWayPoint firstPoint = points.get(0);
 		GeometryWayStyle<?> style = points.get(0).style;
 		List<Integer> ind = new ArrayList<>();
@@ -166,7 +167,7 @@ public static List<GeometryWayDrawer.DrawPathData31> calculatePath(@NonNull List
 			if (style != null) {
 				GeometryWayStyle<?> newStyle = pnt.style;
 				if (!style.equals(newStyle) || newStyle.isUnique()) {
-					GeometryWayDrawer.DrawPathData31 newPathData = new GeometryWayDrawer.DrawPathData31(ind, tx, ty, style);
+					DrawPathData31 newPathData = new DrawPathData31(ind, tx, ty, style);
 					newPathData.heights = heights;
 					newPathData.distances = distances;
 					pathsData.add(newPathData);
@@ -185,10 +186,10 @@ public static List<GeometryWayDrawer.DrawPathData31> calculatePath(@NonNull List
 			}
 		}
 		if (tx.size() > 1) {
-			GeometryWayDrawer.DrawPathData31 newPathData = new GeometryWayDrawer.DrawPathData31(ind, tx, ty, style);
-			pathsData.add(newPathData);
+			DrawPathData31 newPathData = new DrawPathData31(ind, tx, ty, style);
 			newPathData.heights = heights;
 			newPathData.distances = distances;
+			pathsData.add(newPathData);
 		}
 		return pathsData;
 	}
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPoint.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPoint.java
index b0e24a438b9..c7bca689b54 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPoint.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/GeometryWayPoint.java
@@ -10,7 +10,6 @@ public class GeometryWayPoint {
 	public GeometryWayStyle<?> style;
 
 	public GeometryWayPoint() {
-
 	}
 
 	public GeometryWayPoint(int ind, float tx, float ty) {
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWay.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWay.java
index f68e7c4604f..860f0131ad6 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWay.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWay.java
@@ -289,9 +289,9 @@ protected void addLocation(RotatedTileBox tb, int locationIdx, double dist,
 	@Override
 	protected boolean addInitialPoint(RotatedTileBox tb, double topLatitude, double leftLongitude,
 	                                  double bottomLatitude, double rightLongitude, GeometryWayStyle<?> style,
-	                                  boolean previousVisible, Location lastPoint, int startLocationIndex) {
+	                                  Location lastPoint, int startLocationIndex) {
 		boolean added = super.addInitialPoint(tb, topLatitude, leftLongitude, bottomLatitude, rightLongitude,
-				style, previousVisible, lastPoint, startLocationIndex);
+				style, lastPoint, startLocationIndex);
 		if (!added) {
 			return false;
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWayDrawer.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWayDrawer.java
index 594345b16f5..1f69d9f5129 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWayDrawer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiColoringGeometryWayDrawer.java
@@ -71,11 +71,11 @@ public void drawPath(@NonNull VectorLinesCollection collection, int baseOrder,
 
 	protected void drawGradient(@NonNull VectorLinesCollection collection, int baseOrder,
 	                            boolean shouldDrawArrows, @NonNull List<DrawPathData31> pathsData) {
-		int lineId = LINE_ID;
 		GeometryWayStyle<?> prevStyle = null;
 		List<DrawPathData31> dataArr = new ArrayList<>();
+		int lineId = LINE_ID;
 		for (DrawPathData31 data : pathsData) {
-			if (prevStyle != null && data.style == null) {
+			if (!dataArr.isEmpty() && prevStyle != null && data.style == null) {
 				drawVectorLine(collection, lineId++, baseOrder--, shouldDrawArrows, true, prevStyle, dataArr);
 				dataArr.clear();
 			}
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiProfileGeometryWayDrawer.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiProfileGeometryWayDrawer.java
index c73159cfabf..dceaca62e0b 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiProfileGeometryWayDrawer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/MultiProfileGeometryWayDrawer.java
@@ -39,12 +39,12 @@ private GeometryMultiProfileWayStyle getMultiProfileWayStyle(@Nullable GeometryW
 	@Override
 	public void drawPath(@NonNull VectorLinesCollection collection, int baseOrder,
 	                     boolean shouldDrawArrows, @NonNull List<DrawPathData31> pathsData) {
-		int lineId = LINE_ID;
 		GeometryWayStyle<?> prevStyle = null;
 		List<DrawPathData31> dataArr = new ArrayList<>();
+		int lineId = LINE_ID;
 		for (DrawPathData31 data : pathsData) {
 			GeometryMultiProfileWayStyle style = getMultiProfileWayStyle(data.style);
-			if (prevStyle != null && !Algorithms.objectEquals(style, prevStyle) && !dataArr.isEmpty()) {
+			if (!dataArr.isEmpty() && prevStyle != null && !Algorithms.objectEquals(style, prevStyle) && !dataArr.isEmpty()) {
 				drawVectorLine(collection, lineId++, baseOrder--, shouldDrawArrows,
 						true, prevStyle, dataArr);
 				dataArr.clear();
@@ -55,7 +55,7 @@ public void drawPath(@NonNull VectorLinesCollection collection, int baseOrder,
 				dataArr.add(data);
 			}
 		}
-		if (!dataArr.isEmpty()) {
+		if (!dataArr.isEmpty() && prevStyle != null) {
 			drawVectorLine(collection, lineId, baseOrder, shouldDrawArrows, true, prevStyle,
 					dataArr);
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/PublicTransportGeometryWayDrawer.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/PublicTransportGeometryWayDrawer.java
index 851dd9bd859..1583f97c288 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/PublicTransportGeometryWayDrawer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/PublicTransportGeometryWayDrawer.java
@@ -58,14 +58,14 @@ public void drawPath(Canvas canvas, DrawPathData pathData) {
 	@Override
 	public void drawPath(@NonNull VectorLinesCollection collection, int baseOrder,
 	                     boolean shouldDrawArrows, @NonNull List<DrawPathData31> pathsData) {
-		int lineId = LINE_ID;
 		GeometryWayStyle<?> prevStyle = null;
 		List<DrawPathData31> dataArr = new ArrayList<>();
 		RenderingLineAttributes attrsPT = getContext().getAttrsPT();
 		float width = attrsPT.paint.getStrokeWidth();
 		float outlineWidth = attrsPT.paint2.getStrokeWidth();
+		int lineId = LINE_ID;
 		for (DrawPathData31 data : pathsData) {
-			if (prevStyle != null && (!Algorithms.objectEquals(data.style, prevStyle) || data.style.isUnique())) {
+			if (!dataArr.isEmpty() && prevStyle != null && (!Algorithms.objectEquals(data.style, prevStyle) || data.style.isUnique())) {
 				if (prevStyle instanceof GeometryTransportWayStyle) {
 					int outlineColor = prevStyle.getStrokeColor(0);
 					drawVectorLine(collection, lineId++, baseOrder--, shouldDrawArrows, prevStyle,
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/geometry/RouteGeometryWay.java b/OsmAnd/src/net/osmand/plus/views/layers/geometry/RouteGeometryWay.java
index 79a50133e6c..50f9e31b4f2 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/geometry/RouteGeometryWay.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/geometry/RouteGeometryWay.java
@@ -8,13 +8,6 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
-import androidx.annotation.ColorInt;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-
-import androidx.annotation.ColorInt;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
 import net.osmand.Location;
 import net.osmand.core.android.MapRendererView;
 import net.osmand.core.jni.PointI;
@@ -155,9 +148,9 @@ protected boolean shouldSkipLocation(@Nullable TByteArrayList simplification, Ma
 	@Override
 	protected boolean addInitialPoint(RotatedTileBox tb,
 	                                  double topLatitude, double leftLongitude, double bottomLatitude, double rightLongitude,
-	                                  GeometryWayStyle<?> style, boolean previousVisible, Location lastPoint, int startLocationIndex) {
+	                                  GeometryWayStyle<?> style, Location lastPoint, int startLocationIndex) {
 		boolean added = super.addInitialPoint(tb, topLatitude, leftLongitude, bottomLatitude, rightLongitude,
-				style, previousVisible, lastPoint, startLocationIndex);
+				style, lastPoint, startLocationIndex);
 		if (added) {
 			if (currentCachedSegment == null) {
 				currentCachedSegment = new Segment();
@@ -172,9 +165,9 @@ protected boolean addInitialPoint(RotatedTileBox tb,
 	protected List<List<DrawPathData31>> cutStartOfCachedPath(@NonNull MapRendererView mapRenderer,
 	                                                          @NonNull RotatedTileBox tb,
 	                                                          int startLocationIndex,
-	                                                          boolean previousVisible) {
-		List<List<DrawPathData31>> croppedPathData31 = super.cutStartOfCachedPath(mapRenderer, tb, startLocationIndex, previousVisible);
-		if (croppedPathData31 == null) {
+	                                                          Location lastProjection) {
+		List<List<DrawPathData31>> croppedPathData31 = super.cutStartOfCachedPath(mapRenderer, tb, startLocationIndex, lastProjection);
+		if (croppedPathData31 == null || !cachedSegments.isEmpty()) {
 			return null;
 		}
 
@@ -185,30 +178,25 @@ protected List<List<DrawPathData31>> cutStartOfCachedPath(@NonNull MapRendererVi
 			segment.indexes = new ArrayList<>();
 			segment.styles = new ArrayList<>();
 
-			for (int lineIndex = 0; lineIndex < segmentData.size(); lineIndex++) {
-				DrawPathData31 line = segmentData.get(lineIndex);
-
-				boolean lastLine = lineIndex + 1 == segmentData.size();
-				int endIndex = lastLine
-						? line.indexes.size()
-						: line.indexes.size() - 1;
+			for (int pathIndex = 0; pathIndex < segmentData.size(); pathIndex++) {
+				DrawPathData31 path31 = segmentData.get(pathIndex);
+				boolean lastPath = pathIndex + 1 == segmentData.size();
+				int endIndex = lastPath ? path31.indexes.size() : path31.indexes.size() - 1;
 				for (int i = 0; i < endIndex; i++) {
-					int index = line.indexes.get(i);
+					int index = path31.indexes.get(i);
 					if (index >= INITIAL_POINT_INDEX_SHIFT) {
-						int x31 = line.tx.get(i);
-						int y31 = line.ty.get(i);
+						int x31 = path31.tx.get(i);
+						int y31 = path31.ty.get(i);
 						double lat = MapUtils.get31LatitudeY(y31);
 						double lon = MapUtils.get31LongitudeX(x31);
 						segment.initialLocations.add(new Location("", lat, lon));
 					}
-
 					segment.indexes.add(index);
-					segment.styles.add(line.style);
+					segment.styles.add(path31.style);
 				}
 			}
 			segments.add(segment);
 		}
-
 		cachedSegments = segments;
 
 		return croppedPathData31;
@@ -436,8 +424,7 @@ private Integer getActionPointColor(@NonNull ActionPoint actionPoint) {
 			}
 
 			GeometryWayStyle<?> style = segment.styles.get(pointOrder);
-			if (style instanceof GeometryGradientWayStyle<?>) {
-				GeometryGradientWayStyle<?> gradientStyle = (GeometryGradientWayStyle<?>) style;
+			if (style instanceof GeometryGradientWayStyle<?> gradientStyle) {
 				if (pointOrder + 1 == segment.styles.size()) {
 					return gradientStyle.nextColor;
 				} else {
