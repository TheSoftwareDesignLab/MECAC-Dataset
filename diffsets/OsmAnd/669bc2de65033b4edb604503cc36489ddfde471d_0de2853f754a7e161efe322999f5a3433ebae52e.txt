diff --git a/OsmAnd/res/layout/fragment_edit_key_action.xml b/OsmAnd/res/layout/fragment_edit_key_assignment.xml
similarity index 67%
rename from OsmAnd/res/layout/fragment_edit_key_action.xml
rename to OsmAnd/res/layout/fragment_edit_key_assignment.xml
index cebcdd57748..40b9ca16c5a 100644
--- a/OsmAnd/res/layout/fragment_edit_key_action.xml
+++ b/OsmAnd/res/layout/fragment_edit_key_assignment.xml
@@ -19,53 +19,14 @@
 			android:fillViewport="true"
 			android:overScrollMode="never">
 
-			<LinearLayout
+			<androidx.recyclerview.widget.RecyclerView
+				android:id="@+id/recycler_view"
 				android:layout_width="match_parent"
-				android:layout_height="wrap_content"
-				android:orientation="vertical">
-
-				<FrameLayout
-					android:layout_width="match_parent"
-					android:layout_height="@dimen/content_padding">
-
-					<FrameLayout
-						android:layout_width="match_parent"
-						android:layout_height="wrap_content"
-						android:layout_gravity="bottom">
-
-						<include layout="@layout/card_top_divider" />
-
-					</FrameLayout>
-
-				</FrameLayout>
-
-				<LinearLayout
-					android:layout_width="match_parent"
-					android:layout_height="wrap_content"
-					android:background="?attr/list_background_color"
-					android:orientation="vertical">
-
-					<include
-						android:id="@+id/custom_name_button"
-						layout="@layout/list_item_with_right_text_56dp" />
-
-					<include
-						android:id="@+id/action_button"
-						layout="@layout/list_item_with_right_text_56dp" />
-
-					<include
-						android:id="@+id/key_button"
-						layout="@layout/list_item_with_right_text_56dp" />
-
-				</LinearLayout>
-
-				<include layout="@layout/card_bottom_divider" />
-
-				<View
-					android:layout_width="match_parent"
-					android:layout_height="@dimen/list_content_padding" />
-
-			</LinearLayout>
+				android:layout_height="match_parent"
+				android:nestedScrollingEnabled="false"
+				android:clipToPadding="false"
+				android:orientation="vertical"
+				android:scrollbars="none" />
 
 		</androidx.core.widget.NestedScrollView>
 
diff --git a/OsmAnd/res/menu/edit_key_assignment_menu.xml b/OsmAnd/res/menu/edit_key_assignment_menu.xml
index 2ac71391c97..ed76e95623c 100644
--- a/OsmAnd/res/menu/edit_key_assignment_menu.xml
+++ b/OsmAnd/res/menu/edit_key_assignment_menu.xml
@@ -1,6 +1,14 @@
 <?xml version="1.0" encoding="utf-8"?>
 <menu xmlns:android="http://schemas.android.com/apk/res/android"
 	xmlns:app="http://schemas.android.com/apk/res-auto">
+
+	<item
+		android:id="@+id/action_add_new_button"
+		android:icon="@drawable/ic_action_add_no_bg"
+		android:title="@string/add_new_button"
+		app:iconTint="?attr/default_icon_color"
+		app:showAsAction="always" />
+
 	<item
 		android:id="@+id/action_clear_key_assignment"
 		android:icon="@drawable/ic_action_key_assignment_remove"
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index 40f251cb286..7ebd0dfedf9 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -10,6 +10,8 @@
 	- For wording and consistency, please note https://docs.osmand.net/docs/technical/contributions/translating-osmand
 	Thx - Hardy
 -->
+    <string name="key_assignments_already_cleared_message">All key assignments are already cleared</string>
+    <string name="add_new_button">Add a new button</string>
     <string name="reset_key_assignments_desc">All key assignments for the selected type will be removed.</string>
     <string name="reset_key_assignments">Reset key assignments</string>
     <string name="shared_string_reassign">Reassign</string>
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/assignment/KeyAssignment.java b/OsmAnd/src/net/osmand/plus/keyevent/assignment/KeyAssignment.java
index e9f4099a76f..982492f01cd 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/assignment/KeyAssignment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/assignment/KeyAssignment.java
@@ -79,6 +79,15 @@ public void clearKeyCodes() {
 		keyCodes = new ArrayList<>();
 	}
 
+	public boolean hasKeyCode(int keyCode) {
+		for (int assignedKeyCode : getKeyCodes()) {
+			if (assignedKeyCode == keyCode) {
+				return true;
+			}
+		}
+		return false;
+	}
+
 	@NonNull
 	public String getId() {
 		return "default_" + commandId;
@@ -126,6 +135,10 @@ public List<String> getKeyLabels(@NonNull Context context) {
 		return keyLabels;
 	}
 
+	public boolean hasKeyCodes() {
+		return !Algorithms.isEmpty(getKeyCodes());
+	}
+
 	@NonNull
 	public List<Integer> getKeyCodes() {
 		return keyCodes;
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/devices/CustomInputDeviceProfile.java b/OsmAnd/src/net/osmand/plus/keyevent/devices/CustomInputDeviceProfile.java
index 09ce09abb3f..610c62ce63d 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/devices/CustomInputDeviceProfile.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/devices/CustomInputDeviceProfile.java
@@ -50,7 +50,6 @@ public void renameAssignment(@NonNull String assignmentId, @NonNull String newNa
 		KeyAssignment assignment = assignmentsCollection.findById(assignmentId);
 		if (assignment != null) {
 			assignment.setCustomName(newName);
-			assignmentsCollection.syncCache();
 		}
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/devices/InputDeviceProfile.java b/OsmAnd/src/net/osmand/plus/keyevent/devices/InputDeviceProfile.java
index 008c831c938..3250c8b74ac 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/devices/InputDeviceProfile.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/devices/InputDeviceProfile.java
@@ -63,6 +63,10 @@ public int getAssignmentsCount() {
 		return assignmentsCollection.getAllAssignments().size();
 	}
 
+	public boolean hasActiveAssignments() {
+		return getActiveAssignmentsCount() > 0;
+	}
+
 	public int getActiveAssignmentsCount() {
 		return assignmentsCollection.getActiveAssignmentsCount();
 	}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/EditKeyAssignmentFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/EditKeyAssignmentFragment.java
deleted file mode 100644
index ede9d09709d..00000000000
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/EditKeyAssignmentFragment.java
+++ /dev/null
@@ -1,310 +0,0 @@
-package net.osmand.plus.keyevent.fragments;
-
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
-import static net.osmand.plus.utils.AndroidUtils.setBackground;
-import static net.osmand.plus.utils.ColorUtilities.getActiveColor;
-import static net.osmand.plus.utils.ColorUtilities.getPrimaryIconColor;
-import static net.osmand.plus.utils.UiUtilities.getColoredSelectableDrawable;
-
-import android.graphics.Typeface;
-import android.os.Bundle;
-import android.text.TextUtils;
-import android.view.KeyEvent;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.EditText;
-import android.widget.TextView;
-
-import androidx.annotation.ColorInt;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.appcompat.widget.Toolbar;
-import androidx.fragment.app.Fragment;
-import androidx.fragment.app.FragmentActivity;
-import androidx.fragment.app.FragmentManager;
-
-import com.google.android.material.appbar.AppBarLayout;
-import com.google.android.material.appbar.CollapsingToolbarLayout;
-
-import net.osmand.CallbackWithObject;
-import net.osmand.plus.R;
-import net.osmand.plus.activities.MapActivity;
-import net.osmand.plus.base.BaseOsmAndFragment;
-import net.osmand.plus.helpers.AndroidUiHelper;
-import net.osmand.plus.keyevent.InputDevicesHelper;
-import net.osmand.plus.keyevent.listener.EventType;
-import net.osmand.plus.keyevent.listener.InputDevicesEventListener;
-import net.osmand.plus.keyevent.assignment.KeyAssignment;
-import net.osmand.plus.keyevent.fragments.selectkeycode.OnKeyCodeSelectedCallback;
-import net.osmand.plus.keyevent.fragments.selectkeycode.SelectKeyCodeFragment;
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.utils.AndroidUtils;
-import net.osmand.plus.utils.ColorUtilities;
-import net.osmand.plus.widgets.alert.AlertDialogData;
-import net.osmand.plus.widgets.alert.AlertDialogExtra;
-import net.osmand.plus.widgets.alert.CustomAlert;
-import net.osmand.util.Algorithms;
-
-import java.util.List;
-import java.util.Objects;
-
-public class EditKeyAssignmentFragment extends BaseOsmAndFragment
-		implements OnKeyCodeSelectedCallback, InputDevicesEventListener {
-
-	public static final String TAG = EditKeyAssignmentFragment.class.getSimpleName();
-
-	private static final String ATTR_DEVICE_ID = "attr_device_id";
-	private static final String ATTR_ASSIGNMENT_ID = "attr_key_assignment";
-
-	private ApplicationMode appMode;
-	private InputDevicesHelper deviceHelper;
-
-	private String deviceId;
-	private String assignmentId;
-
-	@Override
-	public void onCreate(@Nullable Bundle savedInstanceState) {
-		super.onCreate(savedInstanceState);
-		deviceHelper = app.getInputDeviceHelper();
-		Bundle arguments = requireArguments();
-		deviceId = arguments.getString(ATTR_DEVICE_ID);
-		assignmentId = arguments.getString(ATTR_ASSIGNMENT_ID);
-		String appModeKey = arguments.getString(APP_MODE_KEY);
-		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
-	}
-
-	@Nullable
-	@Override
-	public View onCreateView(@NonNull LayoutInflater inflater,
-	                         @Nullable ViewGroup container,
-	                         @Nullable Bundle savedInstanceState) {
-		updateNightMode();
-		View view = themedInflater.inflate(R.layout.fragment_edit_key_action, container, false);
-		AndroidUtils.addStatusBarPadding21v(requireMyActivity(), view);
-
-		setupToolbar(view);
-		updateViewContent(view, getAssignment());
-		return view;
-	}
-
-	private void setupToolbar(@NonNull View view) {
-		AppBarLayout appBar = view.findViewById(R.id.appbar);
-		appBar.setExpanded(AndroidUiHelper.isOrientationPortrait(requireActivity()));
-
-		int color = getPrimaryIconColor(app, nightMode);
-		Toolbar toolbar = view.findViewById(R.id.toolbar);
-		toolbar.setNavigationIcon(getPaintedContentIcon(R.drawable.ic_action_close, color));
-		toolbar.setNavigationContentDescription(R.string.shared_string_close);
-		toolbar.setNavigationOnClickListener(v -> {
-			dismiss();
-		});
-
-		toolbar.inflateMenu(R.menu.edit_key_assignment_menu);
-		toolbar.setOnMenuItemClickListener(item -> {
-			if (item.getItemId() == R.id.action_clear_key_assignment) {
-				showRemoveKeyAssignmentDialog();
-				return true;
-			}
-			return false;
-		});
-	}
-
-	private void setupActionNameRow(@NonNull View view, @NonNull KeyAssignment assignment) {
-		View customNameButton = view.findViewById(R.id.custom_name_button);
-		TextView title = customNameButton.findViewById(R.id.title);
-		title.setText(R.string.shared_string_name);
-
-		String name = assignment.getName(app);
-		TextView summary = customNameButton.findViewById(R.id.description);
-		summary.setText(name);
-
-		customNameButton.setOnClickListener(v -> showEnterNameDialog(name, newName -> {
-			onNameEntered(newName);
-			return true;
-		}));
-		View backgroundView = customNameButton.findViewById(R.id.selectable_list_item);
-		setupSelectableBackground(backgroundView, appMode.getProfileColor(nightMode));
-	}
-
-	private void setupActionTypeRow(@NonNull View view, @NonNull KeyAssignment assignment) {
-		View actionButton = view.findViewById(R.id.action_button);
-		TextView title = actionButton.findViewById(R.id.title);
-		title.setText(R.string.shared_string_action);
-		TextView summary = actionButton.findViewById(R.id.description);
-		summary.setText(assignment.getCommandTitle(app));
-	}
-
-	private void setupKeyButtonRow(@NonNull View view, @NonNull KeyAssignment assignment) {
-		View keyButton = view.findViewById(R.id.key_button);
-		TextView title = keyButton.findViewById(R.id.title);
-		title.setText(R.string.shared_string_button);
-
-		TextView summary = keyButton.findViewById(R.id.description);
-		List<String> keyLabels = assignment.getKeyLabels(app);
-		String fullSummary = TextUtils.join(", ", keyLabels);
-		summary.setText(fullSummary);
-		summary.setTextColor(getActiveColor(app, nightMode));
-		summary.setTypeface(summary.getTypeface(), Typeface.BOLD);
-
-		keyButton.setOnClickListener(v -> {
-			FragmentActivity activity = getActivity();
-			if (activity != null) {
-				Fragment thisFragment = EditKeyAssignmentFragment.this;
-				FragmentManager fm = activity.getSupportFragmentManager();
-				int keyCode = Algorithms.isEmpty(assignment.getKeyCodes()) ? KeyEvent.KEYCODE_UNKNOWN : assignment.getKeyCodes().get(0);
-				SelectKeyCodeFragment.showInstance(fm, thisFragment, appMode, deviceId, assignment.getCommandId(), keyCode);
-			}
-		});
-		View backgroundView = keyButton.findViewById(R.id.selectable_list_item);
-		setupSelectableBackground(backgroundView, appMode.getProfileColor(nightMode));
-		AndroidUiHelper.updateVisibility(keyButton.findViewById(R.id.bottom_divider), false);
-	}
-
-	private void showEnterNameDialog(@Nullable String oldName,
-	                                 @NonNull CallbackWithObject<String> callback) {
-		FragmentActivity activity = getActivity();
-		if (activity == null) return;
-
-		AlertDialogData dialogData = new AlertDialogData(activity, nightMode)
-				.setTitle(getString(R.string.shared_string_name))
-				.setControlsColor(getActiveColor(activity, nightMode))
-				.setNegativeButton(R.string.shared_string_cancel, null);
-
-		dialogData.setPositiveButton(R.string.shared_string_apply, (dialog, which) -> {
-			Object extra = dialogData.getExtra(AlertDialogExtra.EDIT_TEXT);
-			if (extra instanceof EditText) {
-				EditText editText = (EditText) extra;
-				String newName = editText.getText().toString();
-				if (Objects.equals(oldName, newName)) {
-					return;
-				}
-				if (Algorithms.isBlank(newName)) {
-					app.showToastMessage(R.string.empty_name);
-				} else if (deviceHelper.hasAssignmentNameDuplicate(app, appMode, deviceId, newName)) {
-					app.showToastMessage(R.string.message_name_is_already_exists);
-				} else {
-					callback.processResult(newName.trim());
-				}
-			}
-		});
-		String caption = activity.getString(R.string.shared_string_name);
-		CustomAlert.showInput(dialogData, activity, oldName, caption);
-	}
-
-	private void showRemoveKeyAssignmentDialog() {
-		FragmentActivity activity = getActivity();
-		if (activity == null) return;
-
-		AlertDialogData dialogData = new AlertDialogData(activity, isNightMode())
-				.setTitle(R.string.clear_key_assignment)
-				.setNegativeButton(R.string.shared_string_cancel, null)
-				.setPositiveButton(R.string.shared_string_remove, (dialog, which) -> {
-					onResetKeyCodes();
-				});
-		CustomAlert.showSimpleMessage(dialogData, R.string.clear_key_assignment_desc);
-	}
-
-	private void onNameEntered(@NonNull String newName) {
-		deviceHelper.renameAssignment(appMode, deviceId, assignmentId, newName);
-	}
-
-	private void onResetKeyCodes() {
-		deviceHelper.clearAssignmentKeyCodes(appMode, deviceId, assignmentId);
-	}
-
-	@Override
-	public void onKeyCodeSelected(int oldKeyCode, int newKeyCode) {
-		if (oldKeyCode == KeyEvent.KEYCODE_UNKNOWN) {
-			deviceHelper.addAssignmentKeyCode(appMode, deviceId, assignmentId, newKeyCode);
-		} else {
-			deviceHelper.updateAssignmentKeyCode(appMode, deviceId, assignmentId, oldKeyCode, newKeyCode);
-		}
-	}
-
-	@Override
-	public void processInputDevicesEvent(@NonNull ApplicationMode appMode, @NonNull EventType event) {
-		if (event.isAssignmentRelated()) {
-			updateViewContent(getView(), getAssignment());
-		}
-	}
-
-	private void updateViewContent(@Nullable View view, @Nullable KeyAssignment assignment) {
-		if (view != null && assignment != null) {
-			updateToolbarTitle(view, assignment);
-			setupActionNameRow(view, assignment);
-			setupActionTypeRow(view, assignment);
-			setupKeyButtonRow(view, assignment);
-		}
-	}
-
-	private void updateToolbarTitle(@NonNull View view, @NonNull KeyAssignment assignment) {
-		CollapsingToolbarLayout collapsingToolbarLayout = view.findViewById(R.id.toolbar_layout);
-		collapsingToolbarLayout.setTitle(assignment.getName(app));
-	}
-
-	@Nullable
-	private KeyAssignment getAssignment() {
-		return deviceHelper.findAssignment(appMode, deviceId, assignmentId);
-	}
-
-	@Override
-	public void onResume() {
-		super.onResume();
-		MapActivity mapActivity = getMapActivity();
-		if (mapActivity != null) {
-			mapActivity.disableDrawer();
-		}
-		deviceHelper.addListener(this);
-	}
-
-	@Override
-	public void onPause() {
-		super.onPause();
-		MapActivity mapActivity = getMapActivity();
-		if (mapActivity != null) {
-			mapActivity.enableDrawer();
-		}
-		deviceHelper.removeListener(this);
-	}
-
-	@Nullable
-	private MapActivity getMapActivity() {
-		return (MapActivity) getActivity();
-	}
-
-	private void dismiss() {
-		FragmentActivity activity = getActivity();
-		if (activity != null) {
-			activity.onBackPressed();
-		}
-	}
-
-	private void setupSelectableBackground(@NonNull View view, @ColorInt int color) {
-		setBackground(view, getColoredSelectableDrawable(view.getContext(), color, 0.3f));
-	}
-
-	@Override
-	public int getStatusBarColorId() {
-		AndroidUiHelper.setStatusBarContentColor(getView(), nightMode);
-		return ColorUtilities.getStatusBarSecondaryColorId(nightMode);
-	}
-
-	public static void showInstance(@NonNull FragmentManager manager,
-	                                @NonNull ApplicationMode appMode,
-	                                @NonNull String deviceId,
-	                                @NonNull String assignmentId) {
-		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
-			EditKeyAssignmentFragment fragment = new EditKeyAssignmentFragment();
-			Bundle arguments = new Bundle();
-			arguments.putString(ATTR_DEVICE_ID, deviceId);
-			arguments.putString(ATTR_ASSIGNMENT_ID, assignmentId);
-			arguments.putString(APP_MODE_KEY, appMode.getStringKey());
-			fragment.setArguments(arguments);
-			manager.beginTransaction()
-					.replace(R.id.fragmentContainer, fragment, TAG)
-					.addToBackStack(TAG)
-					.commitAllowingStateLoss();
-		}
-	}
-}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentAdapter.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentAdapter.java
new file mode 100644
index 00000000000..25f8a0a41c7
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentAdapter.java
@@ -0,0 +1,193 @@
+package net.osmand.plus.keyevent.fragments.editassignment;
+
+import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
+import static net.osmand.plus.keyevent.KeySymbolMapper.getKeySymbol;
+import static net.osmand.plus.utils.AndroidUtils.setBackground;
+import static net.osmand.plus.utils.ColorUtilities.getActiveColor;
+import static net.osmand.plus.utils.UiUtilities.getColoredSelectableDrawable;
+import static net.osmand.util.Algorithms.equalsToAny;
+
+import android.content.Context;
+import android.graphics.Typeface;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.FrameLayout.LayoutParams;
+import android.widget.TextView;
+
+import androidx.annotation.ColorInt;
+import androidx.annotation.DimenRes;
+import androidx.annotation.LayoutRes;
+import androidx.annotation.NonNull;
+import androidx.recyclerview.widget.RecyclerView;
+import androidx.recyclerview.widget.RecyclerView.ViewHolder;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.base.containers.ScreenItem;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.utils.UiUtilities;
+
+import java.util.ArrayList;
+import java.util.List;
+
+class EditKeyAssignmentAdapter extends RecyclerView.Adapter<ViewHolder> {
+
+	static final int CARD_TOP_DIVIDER = 1;
+	static final int NAME_ITEM = 2;
+	static final int ACTION_ITEM = 3;
+	static final int BUTTON_ITEM = 4;
+	static final int CARD_BOTTOM_SHADOW = 5;
+	static final int SPACE = 6;
+
+	private final OsmandApplication app;
+	private final ApplicationMode appMode;
+	private ViewGroup parent;
+	private Context context;
+
+	private List<ScreenItem> screenItems = new ArrayList<>();
+	private final boolean usedOnMap;
+	private final EditKeyAssignmentController controller;
+
+	public EditKeyAssignmentAdapter(@NonNull OsmandApplication app, @NonNull ApplicationMode appMode,
+	                                @NonNull EditKeyAssignmentController controller, boolean usedOnMap) {
+		setHasStableIds(true);
+		this.app = app;
+		this.appMode = appMode;
+		this.usedOnMap = usedOnMap;
+		this.controller = controller;
+	}
+
+	@NonNull
+	@Override
+	public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
+		this.parent = parent;
+		context = parent.getContext();
+		switch (viewType) {
+			case CARD_TOP_DIVIDER:
+				return new CardTopDividerViewHolder(inflate(R.layout.list_item_divider));
+			case NAME_ITEM:
+			case ACTION_ITEM:
+			case BUTTON_ITEM:
+				return new ActionItemViewHolder(inflate(R.layout.list_item_with_right_text_56dp));
+			case CARD_BOTTOM_SHADOW:
+				return new CardBottomShadowViewHolder(inflate(R.layout.card_bottom_divider));
+			case SPACE:
+				return new SpaceViewHolder(new View(context), getDimen(R.dimen.fab_margin_bottom_big));
+			default:
+				throw new IllegalArgumentException("Unsupported view type");
+		}
+	}
+
+	@Override
+	public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
+		int itemType = getItemViewType(position);
+		if (!equalsToAny(itemType, NAME_ITEM, ACTION_ITEM, BUTTON_ITEM)) {
+			return;
+		}
+		ActionItemViewHolder h = (ActionItemViewHolder) holder;
+		if (itemType == NAME_ITEM) {
+			h.title.setText(R.string.shared_string_name);
+			h.summary.setText(controller.getCustomNameSummary());
+			h.buttonView.setOnClickListener(v -> {
+				controller.askRenameAssignment();
+			});
+
+		} else if (itemType == ACTION_ITEM) {
+			h.title.setText(R.string.shared_string_action);
+			h.summary.setText(controller.getActionNameSummary());
+
+		} else if (itemType == BUTTON_ITEM) {
+			ScreenItem item = screenItems.get(position);
+			Integer keyCode = (Integer) item.getValue();
+			h.title.setText(R.string.shared_string_button);
+			h.summary.setText(getKeySymbol(app, keyCode));
+			h.summary.setTextColor(getActiveColor(app, controller.isNightMode()));
+			h.summary.setTypeface(h.summary.getTypeface(), Typeface.BOLD);
+			h.buttonView.setOnClickListener(v -> {
+				controller.askChangeKeyCode(keyCode);
+			});
+
+			ScreenItem nextItem = position < screenItems.size() - 1 ? screenItems.get(position + 1) : null;
+			boolean dividerNeeded = nextItem != null && nextItem.getType() == BUTTON_ITEM;
+			AndroidUiHelper.updateVisibility(h.divider, dividerNeeded);
+		}
+		int color = appMode.getProfileColor(controller.isNightMode());
+		setupSelectableBackground(h.buttonView, color);
+	}
+
+	public void setScreenData(@NonNull List<ScreenItem> screenItems) {
+		this.screenItems = screenItems;
+		notifyDataSetChanged();
+	}
+
+	@Override
+	public int getItemCount() {
+		return screenItems.size();
+	}
+
+	@Override
+	public int getItemViewType(int position) {
+		return screenItems.get(position).getType();
+	}
+
+	@Override
+	public long getItemId(int position) {
+		return screenItems.get(position).getId();
+	}
+
+	private View inflate(@LayoutRes int layoutResId) {
+		LayoutInflater inflater = UiUtilities.getInflater(context, controller.isNightMode());
+		return inflater.inflate(layoutResId, parent, false);
+	}
+
+	private void setupSelectableBackground(@NonNull View view, @ColorInt int color) {
+		setBackground(view, getColoredSelectableDrawable(view.getContext(), color, 0.3f));
+	}
+
+	private int getDimen(@DimenRes int resId) {
+		return app.getResources().getDimensionPixelSize(resId);
+	}
+
+	static class CardTopDividerViewHolder extends ViewHolder {
+		public CardTopDividerViewHolder(@NonNull View itemView) {
+			super(itemView);
+			View shadowToHide = itemView.findViewById(R.id.bottomShadowView);
+			if (shadowToHide != null) {
+				shadowToHide.setVisibility(View.INVISIBLE);
+			}
+		}
+	}
+
+	static class CardBottomShadowViewHolder extends ViewHolder {
+		public CardBottomShadowViewHolder(@NonNull View itemView) {
+			super(itemView);
+		}
+
+	}
+
+	static class SpaceViewHolder extends ViewHolder {
+		public SpaceViewHolder(@NonNull View itemView, int hSpace) {
+			super(itemView);
+			itemView.setLayoutParams(new LayoutParams(MATCH_PARENT, hSpace));
+		}
+	}
+
+	static class ActionItemViewHolder extends ViewHolder {
+
+		public View buttonView;
+		public TextView title;
+		public TextView summary;
+		public View divider;
+
+		public ActionItemViewHolder(@NonNull View itemView) {
+			super(itemView);
+			buttonView = itemView.findViewById(R.id.selectable_list_item);
+			title = itemView.findViewById(R.id.title);
+			summary = itemView.findViewById(R.id.description);
+			divider = itemView.findViewById(R.id.bottom_divider);
+		}
+	}
+
+}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
new file mode 100644
index 00000000000..c73cfe934fe
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
@@ -0,0 +1,186 @@
+package net.osmand.plus.keyevent.fragments.editassignment;
+
+import static net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentAdapter.ACTION_ITEM;
+import static net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentAdapter.BUTTON_ITEM;
+import static net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentAdapter.CARD_BOTTOM_SHADOW;
+import static net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentAdapter.CARD_TOP_DIVIDER;
+import static net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentAdapter.NAME_ITEM;
+import static net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentAdapter.SPACE;
+import static net.osmand.plus.utils.ColorUtilities.getActiveColor;
+
+import android.view.KeyEvent;
+import android.widget.EditText;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentActivity;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.CallbackWithObject;
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.base.containers.ScreenItem;
+import net.osmand.plus.keyevent.InputDevicesHelper;
+import net.osmand.plus.keyevent.assignment.KeyAssignment;
+import net.osmand.plus.keyevent.fragments.selectkeycode.SelectKeyCodeFragment;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.widgets.alert.AlertDialogData;
+import net.osmand.plus.widgets.alert.AlertDialogExtra;
+import net.osmand.plus.widgets.alert.CustomAlert;
+import net.osmand.util.Algorithms;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Objects;
+
+class EditKeyAssignmentController {
+
+	private final OsmandApplication app;
+	private final ApplicationMode appMode;
+	private final InputDevicesHelper deviceHelper;
+	private final String deviceId;
+	private final String assignmentId;
+	private FragmentActivity activity;
+	private final Fragment targetFragment;
+	private final boolean usedOnMap;
+
+	public EditKeyAssignmentController(@NonNull OsmandApplication app,
+	                                   @NonNull ApplicationMode appMode,
+									   @NonNull Fragment targetFragment,
+									   @NonNull String deviceId,
+									   @NonNull String assignmentId,
+	                                   boolean usedOnMap) {
+		this.app = app;
+		this.appMode = appMode;
+		this.targetFragment = targetFragment;
+		this.usedOnMap = usedOnMap;
+		this.deviceHelper = app.getInputDeviceHelper();
+		this.deviceId = deviceId;
+		this.assignmentId = assignmentId;
+	}
+
+	@NonNull
+	public List<ScreenItem> populateScreenItems() {
+		KeyAssignment assignment = deviceHelper.findAssignment(appMode, deviceId, assignmentId);
+		if (assignment == null) {
+			return new ArrayList<>();
+		}
+		List<ScreenItem> screenItems = new ArrayList<>();
+		screenItems.add(new ScreenItem(CARD_TOP_DIVIDER));
+		screenItems.add(new ScreenItem(NAME_ITEM, assignment.getName(app)));
+		screenItems.add(new ScreenItem(ACTION_ITEM, assignment.getCommandTitle(app)));
+
+		if (assignment.hasKeyCodes()) {
+			List<Integer> keyCodes = assignment.getKeyCodes();
+			for (int i = 0; i < keyCodes.size(); i++) {
+				screenItems.add(new ScreenItem(BUTTON_ITEM, keyCodes.get(i)));
+			}
+		} else {
+			screenItems.add(new ScreenItem(BUTTON_ITEM, KeyEvent.KEYCODE_UNKNOWN));
+		}
+		screenItems.add(new ScreenItem(CARD_BOTTOM_SHADOW));
+		screenItems.add(new ScreenItem(SPACE));
+		return screenItems;
+	}
+
+	public void setActivity(FragmentActivity activity) {
+		this.activity = activity;
+	}
+
+	@Nullable
+	public String getCustomNameSummary() {
+		KeyAssignment assignment = getAssignment();
+		return assignment != null ? assignment.getName(app) : null;
+	}
+
+	@Nullable
+	public String getActionNameSummary() {
+		KeyAssignment assignment = getAssignment();
+		return assignment != null ? assignment.getCommandTitle(app) : null;
+	}
+
+	public void askRenameAssignment() {
+		String oldName = getCustomNameSummary();
+		showEnterNameDialog(oldName, newName -> {
+			onNameEntered(newName);
+			return true;
+		});
+	}
+
+	private void showEnterNameDialog(@Nullable String oldName,
+	                                 @NonNull CallbackWithObject<String> callback) {
+		boolean nightMode = isNightMode();
+
+		AlertDialogData dialogData = new AlertDialogData(activity, nightMode)
+				.setTitle(R.string.shared_string_name)
+				.setControlsColor(getActiveColor(activity, nightMode))
+				.setNegativeButton(R.string.shared_string_cancel, null);
+
+		dialogData.setPositiveButton(R.string.shared_string_apply, (dialog, which) -> {
+			Object extra = dialogData.getExtra(AlertDialogExtra.EDIT_TEXT);
+			if (extra instanceof EditText) {
+				EditText editText = (EditText) extra;
+				String newName = editText.getText().toString();
+				if (Objects.equals(oldName, newName)) {
+					return;
+				}
+				if (Algorithms.isBlank(newName)) {
+					app.showToastMessage(R.string.empty_name);
+				} else if (deviceHelper.hasAssignmentNameDuplicate(app, appMode, deviceId, newName)) {
+					app.showToastMessage(R.string.message_name_is_already_exists);
+				} else {
+					callback.processResult(newName.trim());
+				}
+			}
+		});
+		String caption = activity.getString(R.string.shared_string_name);
+		CustomAlert.showInput(dialogData, activity, oldName, caption);
+	}
+
+	private void onNameEntered(@NonNull String newName) {
+		deviceHelper.renameAssignment(appMode, deviceId, assignmentId, newName);
+	}
+
+	public void askAddKeyCode() {
+		askChangeKeyCode(KeyEvent.KEYCODE_UNKNOWN);
+	}
+
+	public void askChangeKeyCode(int keyCode) {
+		SelectKeyCodeFragment.showInstance(
+				activity.getSupportFragmentManager(),
+				targetFragment, appMode, deviceId, assignmentId, keyCode);
+	}
+
+	public void askClearKeyCodes() {
+		KeyAssignment assignment = getAssignment();
+		if (assignment != null && !assignment.hasKeyCodes()) {
+			app.showShortToastMessage(R.string.key_assignments_already_cleared_message);
+			return;
+		}
+		AlertDialogData dialogData = new AlertDialogData(activity, isNightMode())
+				.setTitle(R.string.clear_key_assignment)
+				.setNegativeButton(R.string.shared_string_cancel, null)
+				.setPositiveButton(R.string.shared_string_remove, (dialog, which) -> {
+					deviceHelper.clearAssignmentKeyCodes(appMode, deviceId, assignmentId);
+				});
+		CustomAlert.showSimpleMessage(dialogData, R.string.clear_key_assignment_desc);
+	}
+
+	@Nullable
+	public KeyAssignment getAssignment() {
+		return deviceHelper.findAssignment(appMode, deviceId, assignmentId);
+	}
+
+	public boolean isNightMode() {
+		return app.getDaynightHelper().isNightMode(usedOnMap);
+	}
+
+	public void addOrUpdateKeyCode(int oldKeyCode, int newKeyCode) {
+		if (oldKeyCode == KeyEvent.KEYCODE_UNKNOWN) {
+			deviceHelper.addAssignmentKeyCode(appMode, deviceId, assignmentId, newKeyCode);
+		} else {
+			deviceHelper.updateAssignmentKeyCode(appMode, deviceId, assignmentId, oldKeyCode, newKeyCode);
+		}
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
new file mode 100644
index 00000000000..2a47be0271b
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
@@ -0,0 +1,182 @@
+package net.osmand.plus.keyevent.fragments.editassignment;
+
+import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
+import static net.osmand.plus.utils.ColorUtilities.getPrimaryIconColor;
+
+import android.os.Bundle;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.appcompat.widget.Toolbar;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentActivity;
+import androidx.fragment.app.FragmentManager;
+import androidx.recyclerview.widget.LinearLayoutManager;
+import androidx.recyclerview.widget.RecyclerView;
+
+import com.google.android.material.appbar.AppBarLayout;
+import com.google.android.material.appbar.CollapsingToolbarLayout;
+
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.base.BaseOsmAndFragment;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.keyevent.listener.EventType;
+import net.osmand.plus.keyevent.listener.InputDevicesEventListener;
+import net.osmand.plus.keyevent.fragments.selectkeycode.OnKeyCodeSelectedCallback;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
+
+public class EditKeyAssignmentFragment extends BaseOsmAndFragment
+		implements OnKeyCodeSelectedCallback, InputDevicesEventListener {
+
+	public static final String TAG = EditKeyAssignmentFragment.class.getSimpleName();
+
+	private static final String ATTR_DEVICE_ID = "attr_device_id";
+	private static final String ATTR_ASSIGNMENT_ID = "attr_key_assignment";
+
+	private EditKeyAssignmentAdapter adapter;
+	private EditKeyAssignmentController controller;
+	private ApplicationMode appMode;
+
+	@Override
+	public void onCreate(@Nullable Bundle savedInstanceState) {
+		super.onCreate(savedInstanceState);
+		Fragment thisFragment = this;
+		Bundle arguments = requireArguments();
+		String appModeKey = arguments.getString(APP_MODE_KEY);
+		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
+		String deviceId = arguments.getString(ATTR_DEVICE_ID, "");
+		String assignmentId = arguments.getString(ATTR_ASSIGNMENT_ID, "");
+		controller = new EditKeyAssignmentController(app, appMode, thisFragment, deviceId, assignmentId, isUsedOnMap());
+	}
+
+	@Nullable
+	@Override
+	public View onCreateView(@NonNull LayoutInflater inflater,
+	                         @Nullable ViewGroup container,
+	                         @Nullable Bundle savedInstanceState) {
+		updateNightMode();
+		View view = inflate(R.layout.fragment_edit_key_assignment, container);
+		AndroidUtils.addStatusBarPadding21v(requireMyActivity(), view);
+		setupToolbar(view);
+
+		adapter = new EditKeyAssignmentAdapter(app, appMode, controller, isUsedOnMap());
+		RecyclerView recyclerView = view.findViewById(R.id.recycler_view);
+		recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));
+		recyclerView.setAdapter(adapter);
+		updateViewContent(view);
+		return view;
+	}
+
+	private void setupToolbar(@NonNull View view) {
+		AppBarLayout appBar = view.findViewById(R.id.appbar);
+		appBar.setExpanded(AndroidUiHelper.isOrientationPortrait(requireActivity()));
+
+		int color = getPrimaryIconColor(app, nightMode);
+		Toolbar toolbar = view.findViewById(R.id.toolbar);
+		toolbar.setNavigationIcon(getPaintedContentIcon(R.drawable.ic_action_close, color));
+		toolbar.setNavigationContentDescription(R.string.shared_string_close);
+		toolbar.setNavigationOnClickListener(v -> {
+			dismiss();
+		});
+
+		toolbar.inflateMenu(R.menu.edit_key_assignment_menu);
+		toolbar.setOnMenuItemClickListener(item -> {
+			int itemId = item.getItemId();
+			if (itemId == R.id.action_add_new_button) {
+				controller.askAddKeyCode();
+				return true;
+			} else if (itemId == R.id.action_clear_key_assignment) {
+				controller.askClearKeyCodes();
+				return true;
+			}
+			return false;
+		});
+	}
+
+	@Override
+	public void onKeyCodeSelected(int oldKeyCode, int newKeyCode) {
+		controller.addOrUpdateKeyCode(oldKeyCode, newKeyCode);
+	}
+
+	@Override
+	public void processInputDevicesEvent(@NonNull ApplicationMode appMode, @NonNull EventType event) {
+		View view = getView();
+		if (view != null && event.isAssignmentRelated()) {
+			updateViewContent(view);
+		}
+	}
+
+	private void updateViewContent(@NonNull View view) {
+		updateToolbarTitle(view);
+		adapter.setScreenData(controller.populateScreenItems());
+	}
+
+	private void updateToolbarTitle(@NonNull View view) {
+		CollapsingToolbarLayout collapsingToolbarLayout = view.findViewById(R.id.toolbar_layout);
+		collapsingToolbarLayout.setTitle(controller.getCustomNameSummary());
+	}
+
+	@Override
+	public void onResume() {
+		super.onResume();
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity != null) {
+			mapActivity.disableDrawer();
+			controller.setActivity(mapActivity);
+		}
+		app.getInputDeviceHelper().addListener(this);
+	}
+
+	@Override
+	public void onPause() {
+		super.onPause();
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity != null) {
+			mapActivity.enableDrawer();
+		}
+		controller.setActivity(null);
+		app.getInputDeviceHelper().removeListener(this);
+	}
+
+	private void dismiss() {
+		FragmentActivity activity = getActivity();
+		if (activity != null) {
+			activity.onBackPressed();
+		}
+	}
+
+	@Nullable
+	private MapActivity getMapActivity() {
+		return (MapActivity) getActivity();
+	}
+
+	@Override
+	public int getStatusBarColorId() {
+		AndroidUiHelper.setStatusBarContentColor(getView(), nightMode);
+		return ColorUtilities.getStatusBarSecondaryColorId(nightMode);
+	}
+
+	public static void showInstance(@NonNull FragmentManager manager,
+	                                @NonNull ApplicationMode appMode,
+	                                @NonNull String deviceId,
+	                                @NonNull String assignmentId) {
+		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
+			EditKeyAssignmentFragment fragment = new EditKeyAssignmentFragment();
+			Bundle arguments = new Bundle();
+			arguments.putString(ATTR_DEVICE_ID, deviceId);
+			arguments.putString(ATTR_ASSIGNMENT_ID, assignmentId);
+			arguments.putString(APP_MODE_KEY, appMode.getStringKey());
+			fragment.setArguments(arguments);
+			manager.beginTransaction()
+					.replace(R.id.fragmentContainer, fragment, TAG)
+					.addToBackStack(TAG)
+					.commitAllowingStateLoss();
+		}
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsAdapter.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsAdapter.java
index 3d24fe85fe8..14c38a878a8 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsAdapter.java
@@ -32,12 +32,12 @@
 
 class KeyAssignmentsAdapter extends RecyclerView.Adapter<ViewHolder> {
 
-	public static final int CARD_TOP_DIVIDER = 1;
-	public static final int CARD_DIVIDER = 2;
-	public static final int HEADER = 3;
-	public static final int KEY_ASSIGNMENT_ITEM = 4;
-	public static final int CARD_BOTTOM_SHADOW = 5;
-	public static final int SPACE = 6;
+	static final int CARD_TOP_DIVIDER = 1;
+	static final int CARD_DIVIDER = 2;
+	static final int HEADER = 3;
+	static final int KEY_ASSIGNMENT_ITEM = 4;
+	static final int CARD_BOTTOM_SHADOW = 5;
+	static final int SPACE = 6;
 
 	private final OsmandApplication app;
 	private final ApplicationMode appMode;
@@ -94,7 +94,7 @@ public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
 			KeyAssignment assignment = (KeyAssignment) item.getValue();
 
 			if (isEditable()) {
-				boolean nightMode = isNightMode();
+				boolean nightMode = controller.isNightMode();
 				int color = appMode.getProfileColor(nightMode);
 				setupSelectableBackground(h.buttonView, color);
 			}
@@ -135,7 +135,7 @@ public long getItemId(int position) {
 	}
 
 	private View inflate(@LayoutRes int layoutResId) {
-		LayoutInflater inflater = UiUtilities.getInflater(context, isNightMode());
+		LayoutInflater inflater = UiUtilities.getInflater(context, controller.isNightMode());
 		return inflater.inflate(layoutResId, parent, false);
 	}
 
@@ -147,10 +147,6 @@ private boolean isEditable() {
 		return editable;
 	}
 
-	private boolean isNightMode() {
-		return app.getDaynightHelper().isNightMode(usedOnMap);
-	}
-
 	private int getDimen(@DimenRes int resId) {
 		return app.getResources().getDimensionPixelSize(resId);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java
index d75841fa896..407813d215e 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java
@@ -17,7 +17,7 @@
 import net.osmand.plus.keyevent.InputDevicesHelper;
 import net.osmand.plus.keyevent.assignment.KeyAssignmentCategory;
 import net.osmand.plus.keyevent.devices.InputDeviceProfile;
-import net.osmand.plus.keyevent.fragments.EditKeyAssignmentFragment;
+import net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentFragment;
 import net.osmand.plus.keyevent.assignment.KeyAssignment;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.widgets.alert.AlertDialogData;
@@ -75,6 +75,10 @@ public void setActivity(FragmentActivity activity) {
 	}
 
 	public void askRemoveAllAssignments() {
+		if (!inputDevice.hasActiveAssignments()) {
+			app.showShortToastMessage(R.string.key_assignments_already_cleared_message);
+			return;
+		}
 		AlertDialogData dialogData = new AlertDialogData(activity, isNightMode())
 				.setTitle(R.string.reset_key_assignments)
 				.setNegativeButton(R.string.shared_string_cancel, null)
@@ -95,7 +99,7 @@ public void askEditAssignment(@NonNull KeyAssignment assignment) {
 		}
 	}
 
-	private boolean isNightMode() {
+	public boolean isNightMode() {
 		return app.getDaynightHelper().isNightMode(usedOnMap);
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
index d688745ad8f..3a2ce4a6760 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
@@ -31,6 +31,7 @@
 import net.osmand.plus.keyevent.KeyEventCommandsCache;
 import net.osmand.plus.keyevent.KeyEventHelper;
 import net.osmand.plus.keyevent.KeySymbolMapper;
+import net.osmand.plus.keyevent.assignment.KeyAssignment;
 import net.osmand.plus.keyevent.commands.KeyEventCommand;
 import net.osmand.plus.keyevent.devices.InputDeviceProfile;
 import net.osmand.plus.settings.backend.ApplicationMode;
@@ -46,8 +47,8 @@ public class SelectKeyCodeFragment extends BaseOsmAndFragment implements KeyEven
 	public static final String TAG = SelectKeyCodeFragment.class.getSimpleName();
 
 	private static final String ATTR_KEY_CODE = "attr_key_code";
-	private static final String ATTR_COMMAND_ID = "attr_command_id";
 	private static final String ATTR_DEVICE_ID = "attr_input_device_id";
+	private static final String ATTR_ASSIGNMENT_ID = "attr_key_assignment_id";
 
 	private static final int PULSE_DELAY_MS = 1000;
 
@@ -56,7 +57,7 @@ public class SelectKeyCodeFragment extends BaseOsmAndFragment implements KeyEven
 
 	private Integer keyCode = null;
 	private int initialKeyCode;
-	private String commandId;
+	private String assignmentId;
 	private InputDeviceProfile inputDevice;
 
 	@Override
@@ -67,7 +68,7 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 
 		Bundle arguments = requireArguments();
 		initialKeyCode = arguments.getInt(ATTR_KEY_CODE);
-		commandId = arguments.getString(ATTR_COMMAND_ID);
+		assignmentId = arguments.getString(ATTR_ASSIGNMENT_ID);
 
 		String appModeKey = arguments.getString(APP_MODE_KEY);
 		ApplicationMode appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
@@ -115,7 +116,7 @@ private void setupToolbar(@NonNull View view) {
 	}
 
 	private void setupDescription(@NonNull View view) {
-		KeyEventCommand command = KeyEventCommandsCache.getCommand(app, commandId);
+		KeyEventCommand command = KeyEventCommandsCache.getCommand(app, getCommandId());
 		if (command != null) {
 			String action = command.toHumanString(app);
 			String message = getString(R.string.press_button_to_link_with_action, action);
@@ -193,7 +194,7 @@ private void updateErrorMessageState(@NonNull View view) {
 	}
 
 	private void updateApplyButtonState() {
-		applyButton.setEnabled(isKeyCodeChanged());
+		applyButton.setEnabled(isKeyCodeChanged() && !isKeyCodeAlreadyAssignedToThisAction());
 		applyButton.setButtonType(isKeyCodeFree() ? DialogButtonType.PRIMARY : DialogButtonType.PRIMARY_HARMFUL);
 		applyButton.setTitleId(isKeyCodeFree() ? R.string.shared_string_save : R.string.shared_string_reassign);
 	}
@@ -235,16 +236,32 @@ private boolean isKeyCodeFree() {
 		return getCommandDuplication(keyCode) == null;
 	}
 
+	private boolean isKeyCodeAlreadyAssignedToThisAction() {
+		KeyAssignment keyAssignment = getKeyAssignment();
+		return keyAssignment != null && keyAssignment.hasKeyCode(keyCode);
+	}
+
 	private KeyEventCommand getCommandDuplication(int keyCode) {
 		if (inputDevice != null) {
 			KeyEventCommand command = inputDevice.findCommand(keyCode);
-			if (command != null && !Objects.equals(commandId, command.getId())) {
+			if (command != null && !Objects.equals(getCommandId(), command.getId())) {
 				return command;
 			}
 		}
 		return null;
 	}
 
+	@NonNull
+	private String getCommandId() {
+		KeyAssignment assignment = getKeyAssignment();
+		return assignment != null ? assignment.getCommandId() : "";
+	}
+
+	@Nullable
+	private KeyAssignment getKeyAssignment() {
+		return inputDevice.findAssignment(assignmentId);
+	}
+
 	@Override
 	public void onResume() {
 		super.onResume();
@@ -293,14 +310,14 @@ public static void showInstance(@NonNull FragmentManager manager,
 									@NonNull Fragment targetFragment,
 	                                @NonNull ApplicationMode appMode,
 	                                @NonNull String deviceId,
-	                                @NonNull String commandId,
+									@NonNull String assignmentId,
 	                                @NonNull Integer keyCode) {
 		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 			SelectKeyCodeFragment fragment = new SelectKeyCodeFragment();
 			Bundle arguments = new Bundle();
 			arguments.putString(APP_MODE_KEY, appMode.getStringKey());
 			arguments.putString(ATTR_DEVICE_ID, deviceId);
-			arguments.putString(ATTR_COMMAND_ID, commandId);
+			arguments.putString(ATTR_ASSIGNMENT_ID, assignmentId);
 			arguments.putInt(ATTR_KEY_CODE, keyCode);
 			fragment.setArguments(arguments);
 			fragment.setTargetFragment(targetFragment, 0);
