diff --git a/OsmAnd/src/net/osmand/plus/track/CachedTrack.java b/OsmAnd/src/net/osmand/plus/track/CachedTrack.java
index 37cc236e3b1..fda16081168 100644
--- a/OsmAnd/src/net/osmand/plus/track/CachedTrack.java
+++ b/OsmAnd/src/net/osmand/plus/track/CachedTrack.java
@@ -36,6 +36,7 @@ public class CachedTrack {
 	private boolean useJoinSegments;
 
 	private final Map<String, List<TrkSegment>> segmentsCache = new HashMap<>();
+	private int nearestZoom;
 	private Set<String> availableColoringTypes;
 
 	private final Map<Integer, List<RouteSegmentResult>> routeCache = new HashMap<>();
@@ -82,9 +83,18 @@ public List<TrkSegment> getCachedTrackSegments(int zoom, @NonNull GradientScaleT
 			clearCaches();
 			List<TrkSegment> segments = calculateGradientTrack(zoom, scaleType);
 			segmentsCache.put(trackId, segments);
+			nearestZoom = zoom;			
 			return segments;
 		} else {
-			List<TrkSegment> segments = segmentsCache.get(trackId);
+			List<TrkSegment> segments = null;
+			if (Math.abs(zoom - nearestZoom) < 3) {
+				String nearestTrackId = nearestZoom + "_" + scaleType;
+				segments = segmentsCache.get(nearestTrackId);
+			}
+			if (segments == null) {
+				nearestZoom = zoom;
+				segments = segmentsCache.get(trackId);
+			}
 			if (segments == null) {
 				segments = calculateGradientTrack(zoom, scaleType);
 				segmentsCache.put(trackId, segments);
diff --git a/OsmAnd/src/net/osmand/plus/track/helpers/FilteredSelectedGpxFile.java b/OsmAnd/src/net/osmand/plus/track/helpers/FilteredSelectedGpxFile.java
index 0fffc8eaf25..dad1c53c65b 100644
--- a/OsmAnd/src/net/osmand/plus/track/helpers/FilteredSelectedGpxFile.java
+++ b/OsmAnd/src/net/osmand/plus/track/helpers/FilteredSelectedGpxFile.java
@@ -3,6 +3,7 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import net.osmand.core.jni.QVectorPointI;
 import net.osmand.GPXUtilities.GPXFile;
 import net.osmand.GPXUtilities.GPXTrackAnalysis;
 import net.osmand.GPXUtilities.TrkSegment;
@@ -97,6 +98,14 @@ public void setDisplayGroups(@Nullable List<GpxDisplayGroup> displayGroups) {
 	@Override
 	public void processPoints(OsmandApplication app) {
 		processedPointsToDisplay = gpxFile.proccessPoints();
+		if (app.getOsmandMap() != null &&
+			app.getOsmandMap().getMapView() != null &&
+			app.getOsmandMap().getMapView().hasMapRenderer()) {
+			path31 = trackPointsToPath31(processedPointsToDisplay);
+		} else {
+			path31 = null;
+		}
+		path31FromGeneralTrack = false;
 	}
 
 	private int calculatePointsCount(@NonNull GPXFile gpxFile) {
@@ -136,6 +145,28 @@ public List<TrkSegment> getPointsToDisplay() {
 				: processedPointsToDisplay;
 	}
 
+	@NonNull
+	@Override
+	public QVectorPointI getPath31ToDisplay() {
+		if (joinSegments && gpxFile != null) {
+			if (!gpxFile.hasGeneralTrack()) {
+				if (gpxFile.getGeneralTrack() != null) {
+					path31 = trackPointsToPath31(gpxFile.getGeneralTrack().segments);
+					path31FromGeneralTrack = true;
+				}
+			} else {
+				if (!path31FromGeneralTrack || path31 == null) {
+					path31 = trackPointsToPath31(gpxFile.getGeneralTrack().segments);
+					path31FromGeneralTrack = true;
+				}
+			}
+		}
+		if (path31 == null) {
+			path31 = trackPointsToPath31(processedPointsToDisplay);
+		}
+		return path31;
+	}
+
 	@NonNull
 	public SelectedGpxFile getSourceSelectedGpxFile() {
 		return sourceSelectedGpxFile;
diff --git a/OsmAnd/src/net/osmand/plus/track/helpers/SelectedGpxFile.java b/OsmAnd/src/net/osmand/plus/track/helpers/SelectedGpxFile.java
index a3e2a71eb5b..dcb79594dde 100644
--- a/OsmAnd/src/net/osmand/plus/track/helpers/SelectedGpxFile.java
+++ b/OsmAnd/src/net/osmand/plus/track/helpers/SelectedGpxFile.java
@@ -3,12 +3,17 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import net.osmand.core.android.MapRendererView;
+import net.osmand.core.jni.PointI;
+import net.osmand.core.jni.QVectorPointI;
 import net.osmand.GPXUtilities.GPXFile;
 import net.osmand.GPXUtilities.GPXTrackAnalysis;
 import net.osmand.GPXUtilities.TrkSegment;
+import net.osmand.GPXUtilities.WptPt;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.track.helpers.GPXDatabase.GpxDataItem;
 import net.osmand.util.Algorithms;
+import net.osmand.util.MapUtils;
 
 import java.io.File;
 import java.util.ArrayList;
@@ -27,6 +32,8 @@ public class SelectedGpxFile {
 
 	protected Set<String> hiddenGroups = new HashSet<>();
 	protected List<TrkSegment> processedPointsToDisplay = new ArrayList<>();
+	protected QVectorPointI path31 = null;
+	protected boolean path31FromGeneralTrack;
 	protected List<GpxDisplayGroup> displayGroups;
 
 	protected int color;
@@ -96,6 +103,14 @@ public void processPoints(OsmandApplication app) {
 			this.processedPointsToDisplay = gpxFile.processRoutePoints();
 			routePoints = !this.processedPointsToDisplay.isEmpty();
 		}
+		if (app.getOsmandMap() != null &&
+			app.getOsmandMap().getMapView() != null &&
+			app.getOsmandMap().getMapView().hasMapRenderer()) {
+			path31 = trackPointsToPath31(this.processedPointsToDisplay);
+		} else {
+			path31 = null;
+		}
+		path31FromGeneralTrack = false;
 		if (filteredSelectedGpxFile != null) {
 			filteredSelectedGpxFile.processPoints(app);
 		}
@@ -118,6 +133,49 @@ public List<TrkSegment> getPointsToDisplay() {
 		}
 	}
 
+	@NonNull
+	public QVectorPointI getPath31ToDisplay() {
+		if (filteredSelectedGpxFile != null) {
+			return filteredSelectedGpxFile.getPath31ToDisplay();
+		} else if (joinSegments) {
+			if (gpxFile == null) {
+				return new QVectorPointI();
+			}
+			if (!gpxFile.hasGeneralTrack()) {
+				if (gpxFile.getGeneralTrack() != null) {
+					path31 = trackPointsToPath31(gpxFile.getGeneralTrack().segments);
+					path31FromGeneralTrack = true;
+					return path31;
+				} else {					
+					return new QVectorPointI();
+				}
+			} else {
+				if (!path31FromGeneralTrack || path31 == null) {
+					path31 = trackPointsToPath31(gpxFile.getGeneralTrack().segments);
+					path31FromGeneralTrack = true;
+				}
+				return path31;
+			}
+		} else {
+			if (path31 == null) {
+				path31 = trackPointsToPath31(processedPointsToDisplay);
+			}
+			return path31;
+		}
+	}
+
+	public QVectorPointI trackPointsToPath31(List<TrkSegment> segments) {
+		QVectorPointI path = new QVectorPointI();
+		for (TrkSegment segment : segments) {
+			for (WptPt pt : segment.points) {
+				int x = MapUtils.get31TileNumberX(pt.lon);
+				int y = MapUtils.get31TileNumberY(pt.lat);
+				path.add(new PointI(x, y));
+			}
+		}
+		return path;
+	}
+
 	public List<TrkSegment> getModifiablePointsToDisplay() {
 		return processedPointsToDisplay;
 	}
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/GPXLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/GPXLayer.java
index 467095758c2..35902288ca9 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/GPXLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/GPXLayer.java
@@ -1108,9 +1108,20 @@ private void drawSelectedFileSegments(SelectedGpxFile selectedGpxFile, boolean c
 		ColoringType coloringType = ColoringType.getNonNullTrackColoringTypeByName(coloringTypeName);
 		String routeIndoAttribute = ColoringType.getRouteInfoAttribute(coloringTypeName);
 
-		boolean visible = hasMapRenderer || QuadRect.trivialOverlap(tileBox.getLatLonBounds(),
-				calculateTrackBounds(selectedGpxFile.getPointsToDisplay()));
+		boolean visible = hasMapRenderer
+				? getMapRenderer().isPathVisible(selectedGpxFile.getPath31ToDisplay())
+				: QuadRect.trivialOverlap(tileBox.getLatLonBounds(),
+					calculateTrackBounds(selectedGpxFile.getPointsToDisplay()));
 		if (!gpxFile.hasTrkPt() && coloringType.isGradient() || !visible) {
+			Set<TrkSegment> renderedSegments = renderedSegmentsCache.get(gpxFilePath);
+			if (renderedSegments != null) {
+				Iterator<TrkSegment> it = renderedSegments.iterator();
+				while (it.hasNext()) {
+					TrkSegment renderedSegment = it.next();
+					resetSymbolProviders(renderedSegment);
+					it.remove();
+				}
+			}	
 			segmentsCache.remove(gpxFilePath);
 			return;
 		}
