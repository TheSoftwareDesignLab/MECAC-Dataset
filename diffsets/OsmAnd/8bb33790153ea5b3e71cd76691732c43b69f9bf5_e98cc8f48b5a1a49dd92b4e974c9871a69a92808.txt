diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/grid/ButtonPositionSize.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/grid/ButtonPositionSize.kt
index 103e281ef33..c32c85cd7d4 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/grid/ButtonPositionSize.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/grid/ButtonPositionSize.kt
@@ -52,6 +52,9 @@ class ButtonPositionSize {
 
 	fun setMoveHorizontal() = apply { this.xMove = true }
 
+	fun setNonMoveable() = apply { this.xMove = false; this.yMove = false; }
+
+
 	fun setSize(width8dp: Int, height8dp: Int) = apply {
 		this.width = width8dp
 		this.height = height8dp
@@ -230,7 +233,8 @@ class ButtonPositionSize {
 		private const val MAX_STUCK_ATTEMPTS = 20
 
 		var DEBUG_PRINT: Boolean = false; // false
-		var ALTERNATIVE_ALGORITHM: Boolean = false;
+		var DEBUG_PRINT_MOVE: Boolean = false; // false
+		var ALTERNATIVE_ALGORITHM: Boolean = true;
 
 		const val CELL_SIZE_DP = 8
 		const val DEF_MARGIN_DP = 4
@@ -286,14 +290,13 @@ class ButtonPositionSize {
 					for (j in 0 until i) {
 						val check = buttons[j]
 						if (button.overlap(check)) {
-							val moved = moveButton(space, button, check)
+							val moved = moveButton(space, button, check, totalWidth, totalHeight)
 							if (!moved) {
 								// skip unmoveable situations
 								continue;
 							}
 							overlap = true
-							button.updateBounds(totalWidth, totalHeight)
-							if (DEBUG_PRINT) {
+							if (DEBUG_PRINT_MOVE) {
 								LOG.info("Move $button because $check new bounds ${button.bounds}");
 							}
 						}
@@ -313,14 +316,14 @@ class ButtonPositionSize {
 					for (i in (fixedPos + 1) until buttons.size) {
 						val check = buttons[i]
 						if (button.overlap(check)) {
-							val moved = moveButton(space, check, button)
+							val moved = moveButton(space, check, button, totalWidth, totalHeight)
 							if (!moved) {
 								// skip unmoveable situations
 								continue;
 							}
 							overlap = true
 							check.updateBounds(totalWidth, totalHeight)
-							if (DEBUG_PRINT) {
+							if (DEBUG_PRINT_MOVE) {
 								LOG.info("Move $check because $button new bounds ${check.bounds}");
 							}
 							fixedPos = i
@@ -342,9 +345,20 @@ class ButtonPositionSize {
 			return true
 		}
 
-		private fun moveButton(space: Int, toMove: ButtonPositionSize, overlap: ButtonPositionSize): Boolean {
+		private fun moveAndCheck(toMove: ButtonPositionSize, overlap: ButtonPositionSize,
+								 totalWidth: Int, totalHeight: Int, mx: Int, my: Int): Boolean {
+			toMove.marginX += mx;
+			toMove.marginY += my;
+			toMove.updateBounds(totalWidth, totalHeight);
+			return toMove.overlap(overlap);
+		}
+		private fun moveButton(space: Int, toMove: ButtonPositionSize, overlap: ButtonPositionSize,
+							   totalWidth: Int, totalHeight: Int): Boolean {
 			var xMove = false
 			var yMove = false
+			if (!toMove.xMove && !toMove.yMove) {
+				return false
+			}
 
 			if (overlap.moveDescendants == MOVE_DESCENDANTS_ANY) {
 				if (overlap.posH == POS_FULL_WIDTH) {
@@ -360,14 +374,36 @@ class ButtonPositionSize {
 			} else if (overlap.moveDescendants == MOVE_DESCENDANTS_HORIZONTAL) {
 				xMove = true
 			}
-
-			if (xMove) {
-				toMove.marginX = space + overlap.marginX + overlap.width
+			var ox = toMove.marginX;
+			var oy = toMove.marginY;
+			var ok = false;
+			while (!ok && xMove && toMove.marginX <= totalWidth - toMove.width) {
+				if (!moveAndCheck(toMove, overlap, totalWidth, totalHeight, 1, 0)) {
+					if (moveAndCheck(toMove, overlap, totalWidth, totalHeight, space, 0)) {
+						// move back not enough space for space
+						moveAndCheck(toMove, overlap, totalWidth, totalHeight, -space, 0);
+					}
+					ok = true;
+				}
+			}
+			if (!ok) {
+				toMove.marginX = ox;
+				toMove.updateBounds(totalWidth, totalHeight);
+			}
+			while (!ok && yMove && toMove.marginY <= totalHeight - toMove.height) {
+				if (!moveAndCheck(toMove, overlap, totalWidth, totalHeight, 0, 1)) {
+					if (moveAndCheck(toMove, overlap, totalWidth, totalHeight, 0, space)) {
+						// move back not enough space for space
+						moveAndCheck(toMove, overlap, totalWidth, totalHeight, 0, -space);
+					}
+					ok = true;
+				}
 			}
-			if (yMove) {
-				toMove.marginY = space + overlap.marginY + overlap.height
+			if (!ok) {
+				toMove.marginY = oy;
+				toMove.updateBounds(totalWidth, totalHeight);
 			}
-			return xMove || yMove;
+			return ok;
 		}
 	}
 }
diff --git a/OsmAnd-shared/src/commonTest/kotlin/net/osmand/shared/grid/ButtonPositionSizeTest.kt b/OsmAnd-shared/src/commonTest/kotlin/net/osmand/shared/grid/ButtonPositionSizeTest.kt
index 322b3bedc0f..2daeb5c427a 100644
--- a/OsmAnd-shared/src/commonTest/kotlin/net/osmand/shared/grid/ButtonPositionSizeTest.kt
+++ b/OsmAnd-shared/src/commonTest/kotlin/net/osmand/shared/grid/ButtonPositionSizeTest.kt
@@ -5,6 +5,39 @@ import kotlin.test.assertTrue
 
 class ButtonPositionSizeTest {
 
+
+	@Test
+	fun testLayout0() {
+		ButtonPositionSize.DEBUG_PRINT = true;
+		ButtonPositionSize.ALTERNATIVE_ALGORITHM = true;
+		val buttons = listOf(
+			ButtonPositionSize("map_right_widgets_panel", 15, false, true).
+				setSize(15, 21).setMoveDescendantsHorizontal(),
+			ButtonPositionSize("map_top_widgets_panel", 114, true, true).
+				setSize(114, 12).setMargin(0, 0).setMoveDescendantsVertical(),
+			ButtonPositionSize("map_bottom_widgets_panel", 68, true, false).
+				setSize(68, 9).setMargin(22, 0).setMoveDescendantsVertical(),
+
+			ButtonPositionSize("map.view.layers", 6, true, true),
+			ButtonPositionSize("map.view.quick_search", 6, true, true).setMoveHorizontal(),
+			ButtonPositionSize("map.view.compass", 6, true, true).setMoveVertical(),
+
+			ButtonPositionSize("map.view.zoom_out", 7, false, false),
+			ButtonPositionSize("map.view.zoom_id", 7, false, false).setMoveVertical(),
+			ButtonPositionSize("map.view.back_to_loc", 7, false, false).setMoveHorizontal(),
+
+			ButtonPositionSize("map.view.menu", 7, true, false),
+			ButtonPositionSize("map.view.route_planning", 7, true, false).setMoveHorizontal(),
+
+			ButtonPositionSize("map.quick_actions1", 7, false, false).setMargin(8, 7),
+			ButtonPositionSize("map.quick_actions2", 7, false, true).setMargin(0, 15),
+		)
+		val compute = ButtonPositionSize.computeNonOverlap(1, buttons, 114, 45);
+		assertTrue(compute);
+//		assertTrue { check(buttons, "map.view.zoom_out", 107.0, 38.0) }
+
+	}
+
 	@Test
 	fun testLayout1() {
 		ButtonPositionSize.DEBUG_PRINT = true;
diff --git a/OsmAnd/src/net/osmand/plus/views/controls/MapHudLayout.java b/OsmAnd/src/net/osmand/plus/views/controls/MapHudLayout.java
index 936e460724d..84d92bcd9e1 100644
--- a/OsmAnd/src/net/osmand/plus/views/controls/MapHudLayout.java
+++ b/OsmAnd/src/net/osmand/plus/views/controls/MapHudLayout.java
@@ -270,22 +270,27 @@ private ButtonPositionSize createWidgetPosition(@NonNull View view) {
 			position.setMoveDescendantsVertical();
 			position.setPositionVertical(panel.isTopPanel() ? POS_TOP : POS_BOTTOM);
 			position.setPositionHorizontal(shouldCenterVerticalPanels() ? POS_LEFT : POS_FULL_WIDTH);
+			position.setNonMoveable();
 		} else if (view instanceof SideWidgetsPanel panel) {
 			position.setMoveDescendantsVertical();
 			position.setPositionVertical(POS_TOP);
 			position.setPositionHorizontal(panel.rightSide ? POS_RIGHT : POS_LEFT);
+			position.setNonMoveable();
 		} else if (id == R.id.widget_top_bar) {
 			position.setMoveDescendantsVertical();
 			position.setPositionVertical(POS_TOP);
 			position.setPositionHorizontal(shouldCenterVerticalPanels() ? POS_LEFT : POS_FULL_WIDTH);
+			position.setNonMoveable();
 		} else if (id == R.id.measurement_buttons) {
 			position.setMoveDescendantsHorizontal();
 			position.setPositionVertical(POS_BOTTOM);
 			position.setPositionHorizontal(POS_LEFT);
+			position.setNonMoveable();
 		} else if (id == R.id.add_gpx_point_bottom_sheet || id == R.id.recording_note_layout) {
 			position.setMoveDescendantsVertical();
 			position.setPositionVertical(POS_BOTTOM);
 			position.setPositionHorizontal(portrait ? POS_FULL_WIDTH : POS_LEFT);
+			position.setNonMoveable();
 		} else if (view instanceof RulerWidget) {
 			position.setMoveHorizontal();
 			position.setPositionVertical(POS_BOTTOM);
