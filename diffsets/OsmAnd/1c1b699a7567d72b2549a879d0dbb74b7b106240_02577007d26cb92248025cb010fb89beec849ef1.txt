diff --git a/OsmAnd/res/layout/fragment_edit_key_assignment.xml b/OsmAnd/res/layout/fragment_edit_key_assignment.xml
index ba2559355f0..2e7384c598c 100644
--- a/OsmAnd/res/layout/fragment_edit_key_assignment.xml
+++ b/OsmAnd/res/layout/fragment_edit_key_assignment.xml
@@ -69,22 +69,31 @@
 
 	</com.google.android.material.appbar.AppBarLayout>
 
-	<FrameLayout
-		android:id="@+id/bottom_buttons"
+	<LinearLayout
 		android:layout_width="match_parent"
-		android:layout_height="@dimen/dialog_button_ex_height"
+		android:layout_height="wrap_content"
 		android:layout_gravity="bottom"
-		android:background="?attr/list_background_color">
+		android:orientation="vertical">
 
-		<net.osmand.plus.widgets.dialogbutton.DialogButton
-			android:id="@+id/save_button"
+		<include layout="@layout/card_top_divider" />
+
+		<FrameLayout
+			android:id="@+id/bottom_buttons"
 			android:layout_width="match_parent"
-			android:layout_height="wrap_content"
-			android:layout_gravity="center_vertical"
-			android:layout_marginHorizontal="@dimen/content_padding"
-			osmand:dialogButtonTitle="@string/shared_string_save"
-			osmand:dialogButtonType="primary" />
+			android:layout_height="@dimen/dialog_button_ex_height"
+			android:background="?attr/list_background_color">
 
-	</FrameLayout>
+			<net.osmand.plus.widgets.dialogbutton.DialogButton
+				android:id="@+id/save_button"
+				android:layout_width="match_parent"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center_vertical"
+				android:layout_marginHorizontal="@dimen/content_padding"
+				osmand:dialogButtonTitle="@string/shared_string_save"
+				osmand:dialogButtonType="primary" />
+
+		</FrameLayout>
+
+	</LinearLayout>
 
 </androidx.coordinatorlayout.widget.CoordinatorLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/fragment_key_assignments_list.xml b/OsmAnd/res/layout/fragment_key_assignments_list.xml
index c0ea1d40b00..cf58efda48a 100644
--- a/OsmAnd/res/layout/fragment_key_assignments_list.xml
+++ b/OsmAnd/res/layout/fragment_key_assignments_list.xml
@@ -44,22 +44,32 @@
 		app:srcCompat="@drawable/ic_action_plus"
 		app:tint="?attr/app_bar_primary_item_color" />
 
-	<FrameLayout
-		android:id="@+id/bottom_buttons"
+	<LinearLayout
 		android:layout_width="match_parent"
-		android:layout_height="@dimen/dialog_button_ex_height"
+		android:layout_height="wrap_content"
+		android:layout_gravity="bottom"
 		android:layout_alignParentBottom="true"
-		android:background="?attr/list_background_color">
+		android:orientation="vertical">
+
+		<include layout="@layout/card_top_divider" />
 
-		<net.osmand.plus.widgets.dialogbutton.DialogButton
-			android:id="@+id/save_button"
+		<FrameLayout
+			android:id="@+id/bottom_buttons"
 			android:layout_width="match_parent"
-			android:layout_height="wrap_content"
-			android:layout_gravity="center_vertical"
-			android:layout_marginHorizontal="@dimen/content_padding"
-			app:dialogButtonTitle="@string/shared_string_save"
-			app:dialogButtonType="primary" />
+			android:layout_height="@dimen/dialog_button_ex_height"
+			android:background="?attr/list_background_color">
 
-	</FrameLayout>
+			<net.osmand.plus.widgets.dialogbutton.DialogButton
+				android:id="@+id/save_button"
+				android:layout_width="match_parent"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center_vertical"
+				android:layout_marginHorizontal="@dimen/content_padding"
+				app:dialogButtonTitle="@string/shared_string_save"
+				app:dialogButtonType="primary" />
+
+		</FrameLayout>
+
+	</LinearLayout>
 
 </RelativeLayout>
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
index a0faeef4c0a..4a36e8afce0 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
@@ -72,6 +72,9 @@ public EditKeyAssignmentController(@NonNull OsmandApplication app,
 		this.deviceHelper = app.getInputDeviceHelper();
 		this.deviceId = deviceId;
 		this.assignmentId = assignmentId;
+		if (assignmentId == null) {
+			enterEditMode();
+		}
 	}
 
 	@NonNull
@@ -262,12 +265,20 @@ public boolean isInEditMode() {
 		return editBundle != null;
 	}
 
+	public boolean isNewAssignment() {
+		return assignmentId == null;
+	}
+
 	public boolean hasChangesToSave() {
 		return editBundle != null && editBundle.command != null && !Algorithms.isEmpty(editBundle.keyCodes);
 	}
 
-	public void saveChanges() {
-		// TODO
+	public void askSaveChanges() {
+		if (isNewAssignment()) {
+
+		} else {
+
+		}
 	}
 
 	@Nullable
@@ -292,18 +303,18 @@ private static class EditingBundle {
 		List<Integer> keyCodes;
 	}
 
-	public static void registerInstance(@NonNull OsmandApplication app,
-	                                    @NonNull ApplicationMode appMode,
-	                                    @NonNull String deviceId,
-	                                    @Nullable String assignmentId,
-	                                    boolean usedOnMap) {
+	public static void createInstance(@NonNull OsmandApplication app,
+	                                  @NonNull ApplicationMode appMode,
+	                                  @NonNull String deviceId,
+	                                  @Nullable String assignmentId,
+	                                  boolean usedOnMap) {
 		app.getDialogManager().register(
 				PROCESS_ID, new EditKeyAssignmentController(app, appMode, deviceId, assignmentId, usedOnMap)
 		);
 	}
 
 	@Nullable
-	public static EditKeyAssignmentController getInstance(@NonNull OsmandApplication app) {
+	public static EditKeyAssignmentController getExistedInstance(@NonNull OsmandApplication app) {
 		DialogManager dialogManager = app.getDialogManager();
 		return (EditKeyAssignmentController) dialogManager.findController(PROCESS_ID);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
index e77db9f9047..b18499616c2 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
@@ -50,11 +50,12 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		Bundle arguments = requireArguments();
 		String appModeKey = arguments.getString(APP_MODE_KEY);
 		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
-		controller = EditKeyAssignmentController.getInstance(app);
-		if (controller == null) {
+		controller = EditKeyAssignmentController.getExistedInstance(app);
+		if (controller != null) {
+			app.getDialogManager().register(PROCESS_ID, this);
+		} else {
 			dismiss();
 		}
-		app.getDialogManager().register(PROCESS_ID, this);
 	}
 
 	@Nullable
@@ -71,7 +72,7 @@ public View onCreateView(@NonNull LayoutInflater inflater,
 		RecyclerView recyclerView = view.findViewById(R.id.recycler_view);
 		recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));
 		recyclerView.setAdapter(adapter);
-		updateViewContent(view);
+		updateScreenMode(view);
 		return view;
 	}
 
@@ -83,7 +84,7 @@ private void setupToolbar(@NonNull View view) {
 		toolbar.setNavigationIcon(getNavigationIcon());
 		toolbar.setNavigationContentDescription(R.string.shared_string_exit);
 		toolbar.setNavigationOnClickListener(v -> {
-			if (controller.isInEditMode()) {
+			if (controller.isInEditMode() && !controller.isNewAssignment()) {
 				exitEditMode(view);
 			} else {
 				dismiss();
@@ -107,17 +108,18 @@ private void setupToolbar(@NonNull View view) {
 
 	private void enterEditMode(@NonNull View view) {
 		controller.enterEditMode();
-		onScreenModeChange(view, true);
+		updateScreenMode(view);
 	}
 
 	private void exitEditMode(@NonNull View view) {
 		controller.exitEditMode();
-		onScreenModeChange(view, false);
+		updateScreenMode(view);
 	}
 
-	private void onScreenModeChange(@NonNull View view, boolean editMode) {
+	private void updateScreenMode(@NonNull View view) {
 		Toolbar toolbar = view.findViewById(R.id.toolbar);
 		toolbar.setNavigationIcon(getNavigationIcon());
+		boolean editMode = controller.isInEditMode();
 		AndroidUiHelper.updateVisibility(view.findViewById(R.id.action_edit), !editMode);
 		AndroidUiHelper.updateVisibility(view.findViewById(R.id.action_overflow_menu), !editMode);
 		AndroidUiHelper.updateVisibility(view.findViewById(R.id.bottom_buttons), editMode);
@@ -166,7 +168,10 @@ private void updateToolbarTitle(@NonNull View view) {
 	private void updateSaveButton(@NonNull View view) {
 		DialogButton saveButton = view.findViewById(R.id.save_button);
 		saveButton.setEnabled(controller.hasChangesToSave());
-		saveButton.setOnClickListener(v -> controller.saveChanges());
+		saveButton.setOnClickListener(v -> {
+			controller.askSaveChanges();
+			dismiss();
+		});
 	}
 
 	@Override
@@ -229,7 +234,7 @@ public static void showInstance(@NonNull OsmandApplication app,
 	                                @NonNull String deviceId,
 	                                @Nullable String assignmentId) {
 		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
-			EditKeyAssignmentController.registerInstance(app, appMode, deviceId, assignmentId, false);
+			EditKeyAssignmentController.createInstance(app, appMode, deviceId, assignmentId, false);
 			EditKeyAssignmentFragment fragment = new EditKeyAssignmentFragment();
 			Bundle arguments = new Bundle();
 			arguments.putString(APP_MODE_KEY, appMode.getStringKey());
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java
index 84959044638..1e9f218fe73 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java
@@ -140,23 +140,21 @@ public void onAskRefreshDialogCompletely(@NonNull String processId) {
 		updateViewContent();
 	}
 
-	private void updateViewContent() {
-		adapter.setScreenData(controller.populateScreenItems(), controller.isDeviceTypeEditable());
-	}
-
 	private void enterEditMode(@NonNull View view) {
 		controller.enterEditMode();
-		onScreenModeChange(view);
+		updateScreenMode(view);
 	}
 
 	private void askExitEditMode(@NonNull View view) {
 		// todo check changes
 		controller.exitEditMode();
-		onScreenModeChange(view);
+		updateScreenMode(view);
 	}
 
-	private void onScreenModeChange(@NonNull View view) {
+	private void updateScreenMode(@NonNull View view) {
 		updateToolbar(view);
+		updateSaveButton(view);
+		updateFabButton(view);
 		updateViewContent();
 	}
 
@@ -176,6 +174,10 @@ private void updateFabButton(@NonNull View view) {
 		addButton.setOnClickListener(v -> controller.askAddAssignment());
 	}
 
+	private void updateViewContent() {
+		adapter.setScreenData(controller.populateScreenItems(), controller.isDeviceTypeEditable());
+	}
+
 	@Override
 	public void onResume() {
 		super.onResume();
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
index e51a59fa995..ad6513f6a66 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
@@ -17,7 +17,6 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.appcompat.widget.Toolbar;
-import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentActivity;
 import androidx.fragment.app.FragmentManager;
 
@@ -141,7 +140,7 @@ private void startPulseAnimation(@NonNull View view) {
 	private void setupApplyButton(@NonNull View view) {
 		applyButton = view.findViewById(R.id.dismiss_button);
 		applyButton.setOnClickListener(v -> {
-			EditKeyAssignmentController controller = EditKeyAssignmentController.getInstance(app);
+			EditKeyAssignmentController controller = EditKeyAssignmentController.getExistedInstance(app);
 			if (controller != null) {
 				controller.onKeyCodeSelected(initialKeyCode, keyCode);
 			}
@@ -206,8 +205,9 @@ private void updateWarningMessageState(@NonNull View view) {
 
 	private void updateApplyButtonState() {
 		applyButton.setEnabled(isKeyCodeChanged() && !isKeyCodeAlreadyAssignedToThisAction());
-		applyButton.setButtonType(isKeyCodeFree() ? DialogButtonType.PRIMARY : DialogButtonType.PRIMARY_HARMFUL);
-		applyButton.setTitleId(isKeyCodeFree() ? R.string.shared_string_save : R.string.shared_string_reassign);
+		boolean keyCodeFree = isKeyCodeFree();
+		applyButton.setButtonType(keyCodeFree ? DialogButtonType.PRIMARY : DialogButtonType.PRIMARY_HARMFUL);
+		applyButton.setTitleId(keyCodeFree ? R.string.shared_string_save : R.string.shared_string_reassign);
 	}
 
 	@Override
