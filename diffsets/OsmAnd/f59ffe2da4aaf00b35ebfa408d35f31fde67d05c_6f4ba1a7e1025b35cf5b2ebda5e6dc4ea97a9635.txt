diff --git a/OsmAnd/res/layout/configure_buttons_card.xml b/OsmAnd/res/layout/configure_buttons_card.xml
new file mode 100644
index 00000000000..6efd803695e
--- /dev/null
+++ b/OsmAnd/res/layout/configure_buttons_card.xml
@@ -0,0 +1,41 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	android:layout_width="match_parent"
+	android:layout_height="wrap_content"
+	android:orientation="vertical">
+
+	<include
+		android:id="@+id/top_divider"
+		layout="@layout/list_item_divider" />
+
+	<LinearLayout
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:background="?attr/list_background_color"
+		android:orientation="vertical">
+
+		<include layout="@layout/configure_widgets_header" />
+
+		<include
+			android:id="@+id/compass_button"
+			layout="@layout/configure_screen_list_item" />
+
+		<include
+			android:id="@+id/map_3d_mode_button"
+			layout="@layout/configure_screen_list_item" />
+
+		<include
+			android:id="@+id/distance_by_tap_button"
+			layout="@layout/configure_screen_list_item" />
+
+		<include
+			android:id="@+id/quick_actions_button"
+			layout="@layout/configure_screen_list_item" />
+
+	</LinearLayout>
+
+	<include
+		android:id="@+id/bottom_divider"
+		layout="@layout/card_bottom_divider" />
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/configure_widgets_actions_card.xml b/OsmAnd/res/layout/configure_widgets_actions_card.xml
index 0c5f7ebda6c..632c18ce2dc 100644
--- a/OsmAnd/res/layout/configure_widgets_actions_card.xml
+++ b/OsmAnd/res/layout/configure_widgets_actions_card.xml
@@ -1,26 +1,33 @@
 <?xml version="1.0" encoding="utf-8"?>
 <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-	android:id="@+id/actions_container"
 	android:layout_width="match_parent"
 	android:layout_height="wrap_content"
-	android:orientation="vertical"
-	android:background="?list_background_color">
+	android:orientation="vertical">
 
-	<net.osmand.plus.widgets.TextViewEx
-		style="@style/TitleStyle.Medium"
+	<include
+		android:id="@+id/top_divider"
+		layout="@layout/list_item_divider" />
+
+	<LinearLayout
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
-		android:layout_marginHorizontal="@dimen/content_padding"
-		android:layout_marginVertical="@dimen/content_padding_small"
-		android:text="@string/shared_string_actions"
-		android:textColor="?android:textColorSecondary" />
+		android:background="?attr/list_background_color"
+		android:orientation="vertical">
 
-	<include
-		android:id="@+id/reset_to_default"
-		layout="@layout/configure_screen_list_item_button" />
+		<include layout="@layout/configure_widgets_header" />
+
+		<include
+			android:id="@+id/reset_button"
+			layout="@layout/configure_screen_list_item_button" />
+
+		<include
+			android:id="@+id/copy_button"
+			layout="@layout/configure_screen_list_item_button" />
+
+	</LinearLayout>
 
 	<include
-		android:id="@+id/copy_from_another_profile"
-		layout="@layout/configure_screen_list_item_button" />
+		android:id="@+id/bottom_divider"
+		layout="@layout/card_bottom_divider" />
 
 </LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/configure_widgets_card.xml b/OsmAnd/res/layout/configure_widgets_card.xml
new file mode 100644
index 00000000000..00961a3cc67
--- /dev/null
+++ b/OsmAnd/res/layout/configure_widgets_card.xml
@@ -0,0 +1,51 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	android:layout_width="match_parent"
+	android:layout_height="wrap_content"
+	android:orientation="vertical">
+
+	<include
+		android:id="@+id/top_divider"
+		layout="@layout/list_item_divider" />
+
+	<LinearLayout
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:background="?attr/list_background_color"
+		android:orientation="vertical">
+
+		<include layout="@layout/configure_widgets_header" />
+
+		<include
+			android:id="@+id/left_panel"
+			layout="@layout/configure_screen_list_item" />
+
+		<include
+			android:id="@+id/right_panel"
+			layout="@layout/configure_screen_list_item" />
+
+		<include
+			android:id="@+id/top_panel"
+			layout="@layout/configure_screen_list_item" />
+
+		<include
+			android:id="@+id/bottom_panel"
+			layout="@layout/configure_screen_list_item" />
+
+		<include
+			android:id="@+id/transparent_widgets_button"
+			layout="@layout/configure_screen_list_item" />
+
+		<LinearLayout
+			android:id="@+id/items_container"
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:orientation="vertical" />
+
+	</LinearLayout>
+
+	<include
+		android:id="@+id/bottom_divider"
+		layout="@layout/card_bottom_divider" />
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/configure_widgets_header.xml b/OsmAnd/res/layout/configure_widgets_header.xml
new file mode 100644
index 00000000000..4c7fa315f78
--- /dev/null
+++ b/OsmAnd/res/layout/configure_widgets_header.xml
@@ -0,0 +1,28 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:layout_width="match_parent"
+	android:layout_height="wrap_content"
+	android:background="?attr/list_background_color"
+	android:orientation="vertical"
+	android:paddingVertical="@dimen/content_padding_small">
+
+	<net.osmand.plus.widgets.TextViewEx
+		android:id="@+id/title"
+		style="@style/TitleStyle.Medium"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:layout_marginHorizontal="@dimen/content_padding"
+		android:textColor="?android:textColorPrimary"
+		tools:text="@string/shared_string_widgets" />
+
+	<net.osmand.plus.widgets.TextViewEx
+		android:id="@+id/description"
+		style="@style/DescStyle"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:layout_marginHorizontal="@dimen/content_padding"
+		android:textColor="?android:textColorSecondary"
+		tools:text="@string/configure_screen_widgets_descr" />
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/fragment_configure_screen.xml b/OsmAnd/res/layout/fragment_configure_screen.xml
index 71d8cf53aaa..debc3f0b1ec 100644
--- a/OsmAnd/res/layout/fragment_configure_screen.xml
+++ b/OsmAnd/res/layout/fragment_configure_screen.xml
@@ -5,8 +5,8 @@
 	android:layout_width="match_parent"
 	android:layout_height="match_parent"
 	android:background="?attr/activity_background_color"
-	android:fitsSystemWindows="true"
 	android:clickable="true"
+	android:fitsSystemWindows="true"
 	android:focusable="true">
 
 	<com.google.android.material.appbar.AppBarLayout
@@ -52,9 +52,9 @@
 						style="@style/Widget.AppCompat.Toolbar.Button.Navigation"
 						android:layout_width="@dimen/toolbar_height"
 						android:layout_height="@dimen/toolbar_height"
-						android:tint="@color/icon_color_default_light"
+						android:contentDescription="@string/shared_string_back"
 						osmand:srcCompat="@drawable/ic_arrow_back"
-						android:contentDescription="@string/shared_string_back"/>
+						osmand:tint="@color/icon_color_default_light" />
 
 					<net.osmand.plus.widgets.TextViewEx
 						android:id="@+id/toolbar_title"
@@ -80,9 +80,9 @@
 						style="@style/Widget.AppCompat.Toolbar.Button.Navigation"
 						android:layout_width="@dimen/toolbar_height"
 						android:layout_height="@dimen/toolbar_height"
+						android:contentDescription="@string/shared_string_menu"
 						android:tint="?default_icon_color"
-						osmand:srcCompat="@drawable/ic_overflow_menu_white"
-						android:contentDescription="@string/shared_string_menu"/>
+						osmand:srcCompat="@drawable/ic_overflow_menu_white" />
 
 				</LinearLayout>
 
@@ -120,88 +120,11 @@
 				android:overScrollMode="never">
 
 				<LinearLayout
+					android:id="@+id/cards_container"
 					android:layout_width="match_parent"
 					android:layout_height="wrap_content"
 					android:layout_marginBottom="@dimen/content_padding"
-					android:orientation="vertical">
-
-					<include
-						layout="@layout/card_bottom_divider"
-						android:visibility="invisible" />
-
-					<View
-						android:layout_width="match_parent"
-						android:layout_height="4dp" />
-
-					<include layout="@layout/card_top_divider" />
-
-					<LinearLayout
-						android:layout_width="match_parent"
-						android:layout_height="wrap_content"
-						android:background="?attr/list_background_color"
-						android:orientation="vertical">
-
-						<net.osmand.plus.widgets.TextViewEx
-							style="@style/TitleStyle.Medium"
-							android:layout_width="match_parent"
-							android:layout_height="wrap_content"
-							android:layout_marginHorizontal="@dimen/content_padding"
-							android:layout_marginTop="@dimen/content_padding_small"
-							android:text="@string/shared_string_widgets"
-							android:textColor="?android:textColorPrimary" />
-
-						<net.osmand.plus.widgets.TextViewEx
-							style="@style/DescStyle"
-							android:layout_width="match_parent"
-							android:layout_height="wrap_content"
-							android:layout_marginHorizontal="@dimen/content_padding"
-							android:layout_marginBottom="@dimen/content_padding_small"
-							android:text="@string/configure_screen_widgets_descr"
-							android:textColor="?android:textColorSecondary" />
-
-						<LinearLayout
-							android:id="@+id/widgets_card"
-							android:layout_width="match_parent"
-							android:layout_height="wrap_content"
-							android:orientation="vertical" />
-
-					</LinearLayout>
-
-					<include layout="@layout/list_item_divider" />
-
-					<LinearLayout
-						android:layout_width="match_parent"
-						android:layout_height="wrap_content"
-						android:background="?attr/list_background_color"
-						android:orientation="vertical">
-
-						<net.osmand.plus.widgets.TextViewEx
-							style="@style/TitleStyle.Medium"
-							android:layout_width="match_parent"
-							android:layout_height="wrap_content"
-							android:layout_marginHorizontal="@dimen/content_padding"
-							android:layout_marginVertical="@dimen/content_padding_small"
-							android:text="@string/shared_string_buttons"
-							android:textColor="?android:textColorPrimary" />
-
-						<LinearLayout
-							android:id="@+id/buttons_card"
-							android:layout_width="match_parent"
-							android:layout_height="wrap_content"
-							android:orientation="vertical" />
-
-					</LinearLayout>
-					
-					<include layout="@layout/list_item_divider" />
-
-					<FrameLayout
-						android:id="@+id/configure_screen_actions_container"
-						android:layout_width="match_parent"
-						android:layout_height="wrap_content" />
-
-					<include layout="@layout/card_bottom_divider" />
-
-				</LinearLayout>
+					android:orientation="vertical" />
 
 			</androidx.core.widget.NestedScrollView>
 
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
index a0619cadce5..0f934a4b9e1 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
@@ -106,7 +106,7 @@
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.views.MapActions;
 import net.osmand.plus.views.layers.MapControlsLayer;
-import net.osmand.plus.views.mapwidgets.configure.ConfigureScreenFragment;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.ConfigureScreenFragment;
 import net.osmand.plus.widgets.ctxmenu.ContextMenuAdapter;
 import net.osmand.plus.widgets.ctxmenu.ContextMenuListAdapter;
 import net.osmand.plus.widgets.ctxmenu.ViewCreator;
diff --git a/OsmAnd/src/net/osmand/plus/helpers/IntentHelper.java b/OsmAnd/src/net/osmand/plus/helpers/IntentHelper.java
index e06b6aeea47..7ec36bc4e17 100644
--- a/OsmAnd/src/net/osmand/plus/helpers/IntentHelper.java
+++ b/OsmAnd/src/net/osmand/plus/helpers/IntentHelper.java
@@ -65,7 +65,7 @@
 import net.osmand.plus.utils.AndroidNetworkUtils;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.views.OsmandMapTileView;
-import net.osmand.plus.views.mapwidgets.configure.ConfigureScreenFragment;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.ConfigureScreenFragment;
 import net.osmand.util.Algorithms;
 import net.osmand.util.GeoParsedPoint;
 import net.osmand.util.GeoPointParserUtil;
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
index 1ee2feefba1..c4c1c8f0834 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
@@ -57,7 +57,7 @@
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
-import net.osmand.plus.views.mapwidgets.configure.ConfigureScreenFragment;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.ConfigureScreenFragment;
 import net.osmand.plus.widgets.dialogbutton.DialogButton;
 
 import org.apache.commons.logging.Log;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenActionsCard.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenActionsCard.java
deleted file mode 100644
index a19672c72a4..00000000000
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenActionsCard.java
+++ /dev/null
@@ -1,78 +0,0 @@
-package net.osmand.plus.views.mapwidgets.configure;
-
-import static net.osmand.plus.settings.bottomsheets.ConfirmationBottomSheet.showResetSettingsDialog;
-
-import android.view.View;
-import android.widget.ImageView;
-import android.widget.TextView;
-
-import androidx.annotation.DrawableRes;
-import androidx.annotation.NonNull;
-import androidx.annotation.StringRes;
-import androidx.fragment.app.Fragment;
-import androidx.fragment.app.FragmentManager;
-
-import net.osmand.plus.R;
-import net.osmand.plus.activities.MapActivity;
-import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet;
-import net.osmand.plus.routepreparationmenu.cards.MapBaseCard;
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.views.mapwidgets.configure.panel.WidgetsListFragment;
-
-public class ConfigureScreenActionsCard extends MapBaseCard {
-
-	private final Fragment target;
-	private final ApplicationMode appMode;
-	@StringRes
-	private final int screenTitleId;
-
-	public ConfigureScreenActionsCard(@NonNull MapActivity mapActivity,
-	                                  @NonNull Fragment target,
-	                                  @NonNull ApplicationMode appMode,
-	                                  @StringRes int screenTitleId) {
-		super(mapActivity, false);
-		this.target = target;
-		this.appMode = appMode;
-		this.screenTitleId = screenTitleId;
-	}
-
-	@Override
-	public int getCardLayoutId() {
-		return R.layout.configure_widgets_actions_card;
-	}
-
-	@Override
-	protected void updateContent() {
-		View resetToDefaultContainer = view.findViewById(R.id.reset_to_default);
-		setupAction(resetToDefaultContainer, R.drawable.ic_action_reset, R.string.reset_to_default);
-		resetToDefaultContainer.setOnClickListener(v -> showResetToDefaultConfirmationDialog());
-
-		View copyFromProfileContainer = view.findViewById(R.id.copy_from_another_profile);
-		setupAction(copyFromProfileContainer, R.drawable.ic_action_copy, R.string.copy_from_other_profile);
-		copyFromProfileContainer.setOnClickListener(v -> showCopyFromProfileDialog());
-	}
-
-	private void setupAction(@NonNull View view, @DrawableRes int iconId, @StringRes int titleId) {
-		ImageView resetIcon = view.findViewById(R.id.icon);
-		TextView resetTitle = view.findViewById(R.id.title);
-
-		resetIcon.setImageDrawable(app.getUIUtilities().getIcon(iconId));
-		resetTitle.setText(titleId);
-		View container = view.findViewById(R.id.container);
-		WidgetsListFragment.setupListItemBackground(app, container, appMode.getProfileColor(nightMode));
-	}
-
-	private void showResetToDefaultConfirmationDialog() {
-		FragmentManager fragmentManager = target.getFragmentManager();
-		if (fragmentManager != null) {
-			showResetSettingsDialog(fragmentManager, target, screenTitleId);
-		}
-	}
-
-	private void showCopyFromProfileDialog() {
-		FragmentManager fragmentManager = target.getFragmentManager();
-		if (fragmentManager != null) {
-			SelectCopyAppModeBottomSheet.showInstance(fragmentManager, target, appMode);
-		}
-	}
-}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
deleted file mode 100644
index 1c6c50ecf9a..00000000000
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
+++ /dev/null
@@ -1,616 +0,0 @@
-package net.osmand.plus.views.mapwidgets.configure;
-
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.AVAILABLE_MODE;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.ENABLED_MODE;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.MATCHING_PANELS_MODE;
-import static net.osmand.plus.views.mapwidgets.configure.Map3DModeBottomSheet.*;
-
-import android.graphics.drawable.Drawable;
-import android.os.Build;
-import android.os.Bundle;
-import android.util.TypedValue;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.View.OnClickListener;
-import android.view.ViewGroup;
-import android.widget.CompoundButton;
-import android.widget.ImageButton;
-import android.widget.ImageView;
-import android.widget.LinearLayout;
-import android.widget.TextView;
-
-import androidx.annotation.DrawableRes;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.appcompat.widget.Toolbar;
-import androidx.coordinatorlayout.widget.CoordinatorLayout;
-import androidx.core.content.ContextCompat;
-import androidx.core.widget.NestedScrollView;
-import androidx.fragment.app.Fragment;
-import androidx.fragment.app.FragmentActivity;
-import androidx.fragment.app.FragmentManager;
-
-import com.google.android.material.appbar.AppBarLayout;
-import com.google.android.material.appbar.AppBarLayout.Behavior;
-
-import net.osmand.StateChangedListener;
-import net.osmand.plus.R;
-import net.osmand.plus.activities.MapActivity;
-import net.osmand.plus.base.BaseOsmAndFragment;
-import net.osmand.plus.helpers.AndroidUiHelper;
-import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet.CopyAppModePrefsListener;
-import net.osmand.plus.quickaction.QuickActionListFragment;
-import net.osmand.plus.quickaction.QuickActionRegistry;
-import net.osmand.plus.quickaction.QuickActionRegistry.QuickActionUpdatesListener;
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.settings.enums.Map3DModeVisibility;
-import net.osmand.plus.utils.AndroidUtils;
-import net.osmand.plus.utils.ColorUtilities;
-import net.osmand.plus.utils.UiUtilities;
-import net.osmand.plus.views.layers.MapInfoLayer;
-import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
-import net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WidgetsRegistryListener;
-import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.configure.CompassVisibilityBottomSheetDialogFragment.CompassVisibility;
-import net.osmand.plus.views.mapwidgets.configure.CompassVisibilityBottomSheetDialogFragment.CompassVisibilityUpdateListener;
-import net.osmand.plus.settings.bottomsheets.ConfirmationBottomSheet.ConfirmationDialogListener;
-import net.osmand.plus.views.mapwidgets.configure.panel.ConfigureWidgetsFragment;
-import net.osmand.plus.widgets.chips.ChipItem;
-import net.osmand.plus.widgets.chips.HorizontalChipsView;
-import net.osmand.util.Algorithms;
-
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.List;
-
-public class ConfigureScreenFragment extends BaseOsmAndFragment implements QuickActionUpdatesListener,
-		WidgetsRegistryListener, ConfirmationDialogListener, CopyAppModePrefsListener, CompassVisibilityUpdateListener, Map3DModeUpdateListener {
-
-	public static final String TAG = ConfigureScreenFragment.class.getSimpleName();
-
-	private MapWidgetRegistry widgetRegistry;
-	private WidgetsSettingsHelper widgetsSettingsHelper;
-	private ApplicationMode selectedAppMode;
-
-	private MapActivity mapActivity;
-
-	private AppBarLayout appBar;
-	private Toolbar toolbar;
-	private HorizontalChipsView modesToggle;
-	private LinearLayout widgetsCard;
-	private LinearLayout buttonsCard;
-	private ViewGroup actionsCardContainer;
-	private NestedScrollView scrollView;
-
-	private int currentScrollY;
-	private int currentAppBarOffset;
-
-	private StateChangedListener<Boolean> distanceByTapListener;
-
-	@Override
-	public void onCreate(@Nullable Bundle savedInstanceState) {
-		super.onCreate(savedInstanceState);
-		mapActivity = (MapActivity) requireMyActivity();
-		selectedAppMode = settings.getApplicationMode();
-		widgetRegistry = mapActivity.getMapLayers().getMapWidgetRegistry();
-		widgetsSettingsHelper = new WidgetsSettingsHelper(mapActivity, selectedAppMode);
-	}
-
-	@Nullable
-	@Override
-	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
-		updateNightMode();
-		View view = themedInflater.inflate(R.layout.fragment_configure_screen, container, false);
-		if (Build.VERSION.SDK_INT < 30) {
-			AndroidUtils.addStatusBarPadding21v(requireMyActivity(), view);
-		}
-
-		appBar = view.findViewById(R.id.appbar);
-		toolbar = view.findViewById(R.id.toolbar);
-		modesToggle = view.findViewById(R.id.modes_toggle);
-		widgetsCard = view.findViewById(R.id.widgets_card);
-		buttonsCard = view.findViewById(R.id.buttons_card);
-		scrollView = view.findViewById(R.id.scroll_view);
-		actionsCardContainer = view.findViewById(R.id.configure_screen_actions_container);
-
-		setupAppBar();
-		setupToolbar();
-		setupModesToggle();
-		setupWidgetsCard();
-		setupButtonsCard();
-		setupActionsCard();
-
-		if (currentScrollY > 0) {
-			scrollView.scrollTo(0, currentScrollY);
-		}
-
-		return view;
-	}
-
-	@Override
-	public void onResume() {
-		super.onResume();
-		setupWidgetsCard();
-		settings.SHOW_DISTANCE_RULER.addListener(getDistanceByTapListener());
-	}
-
-	@Override
-	public void onPause() {
-		super.onPause();
-		settings.SHOW_DISTANCE_RULER.removeListener(getDistanceByTapListener());
-	}
-
-	@Override
-	public void onStart() {
-		super.onStart();
-		app.getQuickActionRegistry().addUpdatesListener(this);
-		widgetRegistry.addWidgetsRegistryListener(this);
-		mapActivity.disableDrawer();
-	}
-
-	@Override
-	public void onStop() {
-		super.onStop();
-		app.getQuickActionRegistry().removeUpdatesListener(this);
-		widgetRegistry.removeWidgetsRegistryListener(this);
-		mapActivity.enableDrawer();
-	}
-
-	private void setupAppBar() {
-		appBar.addOnOffsetChangedListener((appBarLayout, verticalOffset) -> currentAppBarOffset = verticalOffset);
-		CoordinatorLayout.LayoutParams param = (CoordinatorLayout.LayoutParams) appBar.getLayoutParams();
-		param.setBehavior(new AppBarLayout.Behavior());
-		setAppBarOffset(currentAppBarOffset);
-	}
-
-	private void setAppBarOffset(int verticalOffset) {
-		CoordinatorLayout.LayoutParams param = (CoordinatorLayout.LayoutParams) appBar.getLayoutParams();
-		AppBarLayout.Behavior behavior = (Behavior) param.getBehavior();
-		if (behavior != null) {
-			behavior.setTopAndBottomOffset(verticalOffset);
-		}
-	}
-
-	private void setupToolbar() {
-		ImageButton backButton = toolbar.findViewById(R.id.back_button);
-		backButton.setOnClickListener(view -> {
-			FragmentActivity activity = getActivity();
-			if (activity != null) {
-				activity.onBackPressed();
-			}
-		});
-		backButton.setImageDrawable(getContentIcon(AndroidUtils.getNavigationIconResId(app)));
-
-		View infoButton = toolbar.findViewById(R.id.info_button);
-		infoButton.setOnClickListener(v -> {
-			FragmentActivity activity = getActivity();
-			if (activity != null) {
-				AndroidUtils.openUrl(activity, R.string.docs_widget_configure_screen, nightMode);
-			}
-		});
-
-		View actionsButton = toolbar.findViewById(R.id.actions_button);
-		actionsButton.setOnClickListener(v -> {
-			appBar.setExpanded(false);
-			scrollView.smoothScrollTo(0, (int) actionsCardContainer.getY());
-		});
-	}
-
-	private void setupModesToggle() {
-		ChipItem selectedItem = null;
-		List<ChipItem> items = new ArrayList<>();
-		for (ApplicationMode mode : ApplicationMode.values(app)) {
-			ChipItem item = new ChipItem(mode.getStringKey());
-			int profileColor = mode.getProfileColor(nightMode);
-			int bgSelectedColor = ColorUtilities.getColorWithAlpha(profileColor, 0.25f);
-			// Do not use iconsCache to prevent same coloring for profiles with same icons
-			item.icon = ContextCompat.getDrawable(app, mode.getIconRes());
-			item.iconColor = profileColor;
-			item.iconSelectedColor = profileColor;
-			item.strokeSelectedColor = profileColor;
-			item.strokeSelectedWidth = AndroidUtils.dpToPx(app, 2);
-			item.rippleColor = profileColor;
-			item.bgSelectedColor = bgSelectedColor;
-			item.contentDescription = mode.toHumanString();
-			item.tag = mode;
-			if (Algorithms.objectEquals(selectedAppMode, mode)) {
-				selectedItem = item;
-			}
-			items.add(item);
-		}
-		modesToggle.setItems(items);
-		modesToggle.setSelected(selectedItem);
-		modesToggle.setOnSelectChipListener(chip -> {
-			if (chip.tag instanceof ApplicationMode) {
-				ApplicationMode mode = (ApplicationMode) chip.tag;
-				if (!Algorithms.stringsEqual(mode.getStringKey(), selectedAppMode.getStringKey())) {
-					selectedAppMode = mode;
-					modesToggle.scrollTo(chip);
-					settings.setApplicationMode(mode);
-					updateFragment();
-				}
-			}
-			return true;
-		});
-		if (selectedItem != null) {
-			modesToggle.scrollTo(selectedItem);
-		}
-	}
-
-	private void setupWidgetsCard() {
-		widgetsCard.removeAllViews();
-		widgetsCard.addView(createWidgetGroupView(WidgetsPanel.LEFT, false, false));
-		widgetsCard.addView(createWidgetGroupView(WidgetsPanel.RIGHT, true, false));
-		widgetsCard.addView(createWidgetGroupView(WidgetsPanel.TOP, false, false));
-		widgetsCard.addView(createWidgetGroupView(WidgetsPanel.BOTTOM, false, true));
-
-		widgetsCard.addView(new ButtonBuilder()
-				.setTitle(getString(R.string.map_widget_transparent))
-				.setIconId(R.drawable.ic_action_appearance)
-				.setEnabled(settings.TRANSPARENT_MAP_THEME.getModeValue(selectedAppMode))
-				.showSwitch(true, view -> {
-					boolean enabled = settings.TRANSPARENT_MAP_THEME.get();
-					settings.TRANSPARENT_MAP_THEME.setModeValue(selectedAppMode, !enabled);
-					mapActivity.updateApplicationModeSettings();
-				})
-				.createButton());
-	}
-
-	public void setupButtonsCard() {
-		buttonsCard.removeAllViews();
-
-		CompassVisibility compassVisibility = settings.COMPASS_VISIBILITY.getModeValue(selectedAppMode);
-		buttonsCard.addView(new ButtonBuilder()
-				.setTitle(getString(R.string.map_widget_compass))
-				.setDescription(compassVisibility.getTitle(app))
-				.setIconId(compassVisibility.iconId)
-				.setEnabled(true)
-				.showShortDivider(true)
-				.setClickListener(v -> {
-					FragmentActivity activity = getActivity();
-					if (activity != null) {
-						FragmentManager fragmentManager = activity.getSupportFragmentManager();
-						CompassVisibilityBottomSheetDialogFragment.showInstance(fragmentManager, this, selectedAppMode);
-					}
-				})
-				.createButton());
-
-		if (app.useOpenGlRenderer()) {
-			Map3DModeVisibility map3DModeVisibility = settings.MAP_3D_MODE_VISIBILITY.getModeValue(selectedAppMode);
-			buttonsCard.addView(new ButtonBuilder()
-					.setTitle(getString(R.string.map_3d_mode_action))
-					.setDescription(map3DModeVisibility.getTitle(app))
-					.setIconId(map3DModeVisibility.iconId)
-					.setEnabled(true)
-					.showShortDivider(true)
-					.setClickListener(v -> {
-						FragmentActivity activity = getActivity();
-						if (activity != null) {
-							FragmentManager fragmentManager = activity.getSupportFragmentManager();
-							Map3DModeBottomSheet.showInstance(fragmentManager, this, selectedAppMode);
-						}
-					})
-					.createButton());
-		}
-
-		boolean distanceByTapEnabled = settings.SHOW_DISTANCE_RULER.getModeValue(selectedAppMode);
-		buttonsCard.addView(new ButtonBuilder()
-				.setTitle(getString(R.string.map_widget_distance_by_tap))
-				.setIconId(R.drawable.ic_action_ruler_line)
-				.setEnabled(distanceByTapEnabled)
-				.showState(true, getString(distanceByTapEnabled ? R.string.shared_string_on : R.string.shared_string_off))
-				.showShortDivider(true)
-				.setClickListener(v -> DistanceByTapFragment.showInstance(requireActivity())).createButton());
-
-		QuickActionRegistry registry = app.getQuickActionRegistry();
-		int actionsCount = registry.getQuickActions().size();
-		String actions = getString(R.string.shared_string_actions);
-		String desc = getString(R.string.ltr_or_rtl_combine_via_colon, actions, String.valueOf(actionsCount));
-		buttonsCard.addView(new ButtonBuilder()
-				.setTitle(getString(R.string.configure_screen_quick_action))
-				.setDescription(desc)
-				.setIconId(R.drawable.ic_quick_action)
-				.setEnabled(settings.QUICK_ACTION.getModeValue(selectedAppMode))
-				.setClickListener(v -> QuickActionListFragment.showInstance(requireActivity(), false))
-				.createButton());
-	}
-
-	private void setupActionsCard() {
-		ConfigureScreenActionsCard card = new ConfigureScreenActionsCard(mapActivity, this,
-				selectedAppMode, R.string.map_widget_config);
-		actionsCardContainer.addView(card.build(actionsCardContainer.getContext()));
-	}
-
-	@Override
-	public void onActionConfirmed(int actionId) {
-		MapActivity mapActivity = getMapActivity();
-		if (mapActivity == null) {
-			return;
-		}
-		widgetsSettingsHelper.setAppMode(selectedAppMode);
-		widgetsSettingsHelper.resetConfigureScreenSettings();
-		recreateControlsCompletely(mapActivity);
-		updateFragment();
-	}
-
-	@Override
-	public void copyAppModePrefs(@NonNull ApplicationMode fromAppMode) {
-		MapActivity mapActivity = getMapActivity();
-		if (mapActivity == null) {
-			return;
-		}
-		widgetsSettingsHelper.setAppMode(selectedAppMode);
-		widgetsSettingsHelper.copyConfigureScreenSettings(fromAppMode);
-		recreateControlsCompletely(mapActivity);
-		updateFragment();
-	}
-
-	private void recreateControlsCompletely(@NonNull MapActivity mapActivity) {
-		MapInfoLayer mapInfoLayer = app.getOsmandMap().getMapLayers().getMapInfoLayer();
-		if (mapInfoLayer != null) {
-			mapInfoLayer.recreateAllControls(mapActivity);
-		}
-	}
-
-	@Override
-	public void onActionsUpdated() {
-		setupButtonsCard();
-	}
-
-	@Override
-	public void onCompassVisibilityUpdated(@NonNull CompassVisibility visibility) {
-		setupButtonsCard();
-	}
-
-	@Override
-	public void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo) {
-		updateWidgetsCountForPanel(widgetInfo.getWidgetPanel());
-	}
-
-	private void updateWidgetsCountForPanel(@NonNull WidgetsPanel panel) {
-		MapActivity mapActivity = getMapActivity();
-		View panelContainer = widgetsCard.findViewWithTag(panel.name());
-		if (mapActivity != null && panelContainer != null) {
-			int count = getWidgetsCount(mapActivity, panel);
-			updateWidgetsCount(panelContainer, count);
-		}
-	}
-
-	@Override
-	public void onWidgetVisibilityChanged(@NonNull MapWidgetInfo widgetInfo) {
-
-	}
-
-	@Override
-	public void onWidgetsCleared() {
-
-	}
-
-	private View createWidgetGroupView(@NonNull WidgetsPanel panel, boolean showShortDivider, boolean showLongDivider) {
-		boolean rtl = AndroidUtils.isLayoutRtl(app);
-		int activeColor = selectedAppMode.getProfileColor(nightMode);
-		int defColor = ColorUtilities.getDefaultIconColor(app, nightMode);
-
-		View view = themedInflater.inflate(R.layout.configure_screen_list_item, null);
-		view.setTag(panel.name());
-		ImageView ivIcon = view.findViewById(R.id.icon);
-		TextView tvTitle = view.findViewById(R.id.title);
-
-		MapActivity mapActivity = requireMapActivity();
-		int count = getWidgetsCount(mapActivity, panel);
-		int iconColor = count > 0 ? activeColor : defColor;
-		Drawable icon = getPaintedContentIcon(panel.getIconId(rtl), iconColor);
-		ivIcon.setImageDrawable(icon);
-
-		String title = getString(panel.getTitleId(rtl));
-		tvTitle.setText(title);
-
-		updateWidgetsCount(view, count);
-
-		if (showShortDivider) {
-			view.findViewById(R.id.short_divider).setVisibility(View.VISIBLE);
-		}
-
-		if (showLongDivider) {
-			view.findViewById(R.id.long_divider).setVisibility(View.VISIBLE);
-		}
-
-		setupClickListener(view, v -> {
-			FragmentActivity activity = getActivity();
-			if (activity != null) {
-				ConfigureWidgetsFragment.showInstance(activity, panel, selectedAppMode);
-			}
-		});
-		setupListItemBackground(view);
-		return view;
-	}
-
-	private int getWidgetsCount(@NonNull MapActivity mapActivity, @NonNull WidgetsPanel panel) {
-		int filter = ENABLED_MODE | AVAILABLE_MODE | MATCHING_PANELS_MODE;
-		return widgetRegistry.getWidgetsForPanel(mapActivity, selectedAppMode, filter, Collections.singletonList(panel)).size();
-	}
-
-	private void updateWidgetsCount(@NonNull View container, int count) {
-		TextView countContainer = container.findViewById(R.id.items_count_descr);
-		countContainer.setText(String.valueOf(count));
-		AndroidUiHelper.updateVisibility(countContainer, true);
-	}
-
-	private void setupListItemBackground(@NonNull View view) {
-		View button = view.findViewById(R.id.button_container);
-		int color = selectedAppMode.getProfileColor(nightMode);
-		Drawable background = UiUtilities.getColoredSelectableDrawable(app, color, 0.3f);
-		AndroidUtils.setBackground(button, background);
-	}
-
-	private void setupClickListener(@NonNull View view, @Nullable OnClickListener listener) {
-		View button = view.findViewById(R.id.button_container);
-		button.setOnClickListener(listener);
-	}
-
-	@Override
-	public int getStatusBarColorId() {
-		AndroidUiHelper.setStatusBarContentColor(getView(), nightMode);
-		return ColorUtilities.getListBgColorId(nightMode);
-	}
-
-	public boolean getContentStatusBarNightMode() {
-		return nightMode;
-	}
-
-	@NonNull
-	public MapActivity requireMapActivity() {
-		FragmentActivity activity = getActivity();
-		if (!(activity instanceof MapActivity)) {
-			throw new IllegalStateException("Fragment " + this + " not attached to an activity.");
-		}
-		return (MapActivity) activity;
-	}
-
-	@Nullable
-	public MapActivity getMapActivity() {
-		FragmentActivity activity = getActivity();
-		return activity instanceof MapActivity ? ((MapActivity) activity) : null;
-	}
-
-	private void updateFragment() {
-		FragmentManager manager = mapActivity.getSupportFragmentManager();
-		Fragment fragment = manager.findFragmentByTag(TAG);
-		if (fragment != null && AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
-			currentScrollY = scrollView.getScrollY();
-			manager.beginTransaction().detach(fragment).commitAllowingStateLoss();
-			manager.beginTransaction().attach(fragment).commitAllowingStateLoss();
-		}
-	}
-
-	public static void showInstance(@NonNull FragmentActivity activity) {
-		FragmentManager fragmentManager = activity.getSupportFragmentManager();
-		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
-			ConfigureScreenFragment fragment = new ConfigureScreenFragment();
-			fragmentManager.beginTransaction()
-					.add(R.id.fragmentContainer, fragment, TAG)
-					.addToBackStack(TAG)
-					.commitAllowingStateLoss();
-		}
-	}
-
-	@NonNull
-	private StateChangedListener<Boolean> getDistanceByTapListener() {
-		if (distanceByTapListener == null) {
-			distanceByTapListener = change -> app.runInUIThread(() -> setupButtonsCard());
-		}
-		return distanceByTapListener;
-	}
-
-	@Override
-	public void onMap3DModeUpdated() {
-		setupButtonsCard();
-	}
-
-	private class ButtonBuilder {
-		private int iconId;
-		private String title;
-		private String desc;
-		private String stateText;
-		private boolean enabled = false;
-		private boolean showShortDivider = false;
-		private OnClickListener listener;
-		private OnClickListener onSwitchClickListener;
-		private boolean showState = false;
-		private boolean showSwitch = false;
-
-		public ButtonBuilder setTitle(@NonNull String title) {
-			this.title = title;
-			return this;
-		}
-
-		public ButtonBuilder setIconId(@DrawableRes int iconId) {
-			this.iconId = iconId;
-			return this;
-		}
-
-		public ButtonBuilder setDescription(@Nullable String desc) {
-			this.desc = desc;
-			return this;
-		}
-
-		public ButtonBuilder setEnabled(boolean enabled) {
-			this.enabled = enabled;
-			return this;
-		}
-
-		public ButtonBuilder setClickListener(@Nullable OnClickListener listener) {
-			this.listener = listener;
-			return this;
-		}
-
-		public ButtonBuilder showShortDivider(boolean showShortDivider) {
-			this.showShortDivider = showShortDivider;
-			return this;
-		}
-
-		public ButtonBuilder showState(boolean showState, @NonNull String stateText) {
-			this.showState = showState;
-			this.stateText = stateText;
-			return this;
-		}
-
-		public ButtonBuilder showSwitch(boolean showSwitch, @NonNull OnClickListener onSwitchClickListener) {
-			this.showSwitch = showSwitch;
-			this.onSwitchClickListener = onSwitchClickListener;
-			return this;
-		}
-
-		public View createButton() {
-			View view = themedInflater.inflate(R.layout.configure_screen_list_item, null);
-			TextView tvTitle = view.findViewById(R.id.title);
-			ImageView ivIcon = view.findViewById(R.id.icon);
-			TextView tvDesc = view.findViewById(R.id.description);
-			View shortDivider = view.findViewById(R.id.short_divider);
-			CompoundButton cb = view.findViewById(R.id.compound_button);
-			TextView stateContainer = view.findViewById(R.id.items_count_descr);
-
-			int activeColor = selectedAppMode.getProfileColor(nightMode);
-			int defColor = ColorUtilities.getDefaultIconColor(app, nightMode);
-			int iconColor = enabled ? activeColor : defColor;
-			tvTitle.setText(title);
-			Drawable icon = getPaintedContentIcon(iconId, iconColor);
-			ivIcon.setImageDrawable(icon);
-
-			if (desc != null) {
-				tvDesc.setText(desc);
-				AndroidUiHelper.updateVisibility(tvDesc, true);
-			}
-			if (showState) {
-				stateContainer.setTextSize(TypedValue.COMPLEX_UNIT_PX, getResources().getDimensionPixelSize(R.dimen.default_sub_text_size));
-				stateContainer.setText(stateText);
-				AndroidUiHelper.updateVisibility(stateContainer, true);
-			}
-			if (showSwitch) {
-				cb.setChecked(enabled);
-				AndroidUiHelper.updateVisibility(cb, true);
-				UiUtilities.setupCompoundButton(nightMode, activeColor, cb);
-
-				cb.setOnCheckedChangeListener((buttonView, isChecked) -> {
-					ivIcon.setColorFilter(isChecked ? activeColor : defColor);
-					if (onSwitchClickListener != null) {
-						onSwitchClickListener.onClick(buttonView);
-					}
-				});
-			}
-			if (listener == null && showSwitch) {
-				setupClickListener(view, v -> {
-					boolean newState = !cb.isChecked();
-					cb.setChecked(newState);
-				});
-			} else {
-				setupClickListener(view, listener);
-			}
-
-			AndroidUiHelper.updateVisibility(shortDivider, showShortDivider);
-			setupListItemBackground(view);
-			return view;
-		}
-	}
-}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/ConfigureScreenFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/ConfigureScreenFragment.java
new file mode 100644
index 00000000000..77ee68aa2c5
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/ConfigureScreenFragment.java
@@ -0,0 +1,365 @@
+package net.osmand.plus.views.mapwidgets.configure.dialogs;
+
+import static net.osmand.plus.views.mapwidgets.configure.dialogs.Map3DModeBottomSheet.Map3DModeUpdateListener;
+
+import android.os.Build;
+import android.os.Bundle;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ImageButton;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.appcompat.widget.Toolbar;
+import androidx.coordinatorlayout.widget.CoordinatorLayout;
+import androidx.core.content.ContextCompat;
+import androidx.core.widget.NestedScrollView;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentActivity;
+import androidx.fragment.app.FragmentManager;
+
+import com.google.android.material.appbar.AppBarLayout;
+import com.google.android.material.appbar.AppBarLayout.Behavior;
+
+import net.osmand.StateChangedListener;
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.base.BaseOsmAndFragment;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet.CopyAppModePrefsListener;
+import net.osmand.plus.quickaction.QuickActionRegistry.QuickActionUpdatesListener;
+import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.bottomsheets.ConfirmationBottomSheet.ConfirmationDialogListener;
+import net.osmand.plus.settings.enums.CompassVisibility;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.views.layers.MapInfoLayer;
+import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WidgetsRegistryListener;
+import net.osmand.plus.views.mapwidgets.configure.WidgetsSettingsHelper;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.CompassVisibilityBottomSheetDialogFragment.CompassVisibilityUpdateListener;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.cards.ConfigureScreenActionsCard;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.cards.ConfigureScreenButtonsCard;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.cards.ConfigureScreenWidgetsCard;
+import net.osmand.plus.widgets.chips.ChipItem;
+import net.osmand.plus.widgets.chips.HorizontalChipsView;
+import net.osmand.util.Algorithms;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class ConfigureScreenFragment extends BaseOsmAndFragment implements QuickActionUpdatesListener,
+		WidgetsRegistryListener, ConfirmationDialogListener, CopyAppModePrefsListener,
+		CompassVisibilityUpdateListener, Map3DModeUpdateListener {
+
+	public static final String TAG = ConfigureScreenFragment.class.getSimpleName();
+
+	private MapWidgetRegistry widgetRegistry;
+	private WidgetsSettingsHelper widgetsSettingsHelper;
+	private ApplicationMode selectedAppMode;
+
+	private MapActivity mapActivity;
+
+	private AppBarLayout appBar;
+	private HorizontalChipsView modesToggle;
+	private ViewGroup cardsContainer;
+	private NestedScrollView scrollView;
+
+	private ConfigureScreenWidgetsCard widgetsCard;
+	private ConfigureScreenButtonsCard buttonsCard;
+	private ConfigureScreenActionsCard actionsCard;
+
+	private int currentScrollY;
+	private int currentAppBarOffset;
+
+	private StateChangedListener<Boolean> distanceByTapListener;
+
+	@Override
+	public void onCreate(@Nullable Bundle savedInstanceState) {
+		super.onCreate(savedInstanceState);
+		mapActivity = (MapActivity) requireMyActivity();
+		selectedAppMode = settings.getApplicationMode();
+		widgetRegistry = mapActivity.getMapLayers().getMapWidgetRegistry();
+		widgetsSettingsHelper = new WidgetsSettingsHelper(mapActivity, selectedAppMode);
+	}
+
+	@Nullable
+	@Override
+	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+		updateNightMode();
+		View view = themedInflater.inflate(R.layout.fragment_configure_screen, container, false);
+		if (Build.VERSION.SDK_INT < 30) {
+			AndroidUtils.addStatusBarPadding21v(requireMyActivity(), view);
+		}
+
+		appBar = view.findViewById(R.id.appbar);
+		modesToggle = view.findViewById(R.id.modes_toggle);
+		cardsContainer = view.findViewById(R.id.cards_container);
+		scrollView = view.findViewById(R.id.scroll_view);
+
+		setupAppBar();
+		setupToolbar(view);
+		setupModesToggle();
+		setupCards();
+
+		if (currentScrollY > 0) {
+			scrollView.scrollTo(0, currentScrollY);
+		}
+
+		return view;
+	}
+
+	@Override
+	public void onResume() {
+		super.onResume();
+		updateCard(widgetsCard);
+		settings.SHOW_DISTANCE_RULER.addListener(getDistanceByTapListener());
+	}
+
+	@Override
+	public void onPause() {
+		super.onPause();
+		settings.SHOW_DISTANCE_RULER.removeListener(getDistanceByTapListener());
+	}
+
+	@Override
+	public void onStart() {
+		super.onStart();
+		app.getQuickActionRegistry().addUpdatesListener(this);
+		widgetRegistry.addWidgetsRegistryListener(this);
+		mapActivity.disableDrawer();
+	}
+
+	@Override
+	public void onStop() {
+		super.onStop();
+		app.getQuickActionRegistry().removeUpdatesListener(this);
+		widgetRegistry.removeWidgetsRegistryListener(this);
+		mapActivity.enableDrawer();
+	}
+
+	private void setupAppBar() {
+		appBar.addOnOffsetChangedListener((appBarLayout, verticalOffset) -> currentAppBarOffset = verticalOffset);
+		CoordinatorLayout.LayoutParams param = (CoordinatorLayout.LayoutParams) appBar.getLayoutParams();
+		param.setBehavior(new AppBarLayout.Behavior());
+		setAppBarOffset(currentAppBarOffset);
+	}
+
+	private void setAppBarOffset(int verticalOffset) {
+		CoordinatorLayout.LayoutParams param = (CoordinatorLayout.LayoutParams) appBar.getLayoutParams();
+		AppBarLayout.Behavior behavior = (Behavior) param.getBehavior();
+		if (behavior != null) {
+			behavior.setTopAndBottomOffset(verticalOffset);
+		}
+	}
+
+	private void setupToolbar(@NonNull View view) {
+		Toolbar toolbar = view.findViewById(R.id.toolbar);
+
+		ImageButton backButton = toolbar.findViewById(R.id.back_button);
+		backButton.setOnClickListener(v -> {
+			FragmentActivity activity = getActivity();
+			if (activity != null) {
+				activity.onBackPressed();
+			}
+		});
+		backButton.setImageDrawable(getContentIcon(AndroidUtils.getNavigationIconResId(app)));
+
+		View infoButton = toolbar.findViewById(R.id.info_button);
+		infoButton.setOnClickListener(v -> {
+			FragmentActivity activity = getActivity();
+			if (activity != null) {
+				AndroidUtils.openUrl(activity, R.string.docs_widget_configure_screen, nightMode);
+			}
+		});
+
+		View actionsButton = toolbar.findViewById(R.id.actions_button);
+		actionsButton.setOnClickListener(v -> {
+			appBar.setExpanded(false);
+
+			View cardView = actionsCard != null ? actionsCard.getView() : null;
+			if (cardView != null) {
+				scrollView.smoothScrollTo(0, (int) cardView.getY());
+			}
+		});
+	}
+
+	private void setupModesToggle() {
+		ChipItem selectedItem = null;
+		List<ChipItem> items = new ArrayList<>();
+		for (ApplicationMode mode : ApplicationMode.values(app)) {
+			ChipItem item = new ChipItem(mode.getStringKey());
+			int profileColor = mode.getProfileColor(nightMode);
+			int bgSelectedColor = ColorUtilities.getColorWithAlpha(profileColor, 0.25f);
+			// Do not use iconsCache to prevent same coloring for profiles with same icons
+			item.icon = ContextCompat.getDrawable(app, mode.getIconRes());
+			item.iconColor = profileColor;
+			item.iconSelectedColor = profileColor;
+			item.strokeSelectedColor = profileColor;
+			item.strokeSelectedWidth = AndroidUtils.dpToPx(app, 2);
+			item.rippleColor = profileColor;
+			item.bgSelectedColor = bgSelectedColor;
+			item.contentDescription = mode.toHumanString();
+			item.tag = mode;
+			if (Algorithms.objectEquals(selectedAppMode, mode)) {
+				selectedItem = item;
+			}
+			items.add(item);
+		}
+		modesToggle.setItems(items);
+		modesToggle.setSelected(selectedItem);
+		modesToggle.setOnSelectChipListener(chip -> {
+			if (chip.tag instanceof ApplicationMode) {
+				ApplicationMode mode = (ApplicationMode) chip.tag;
+				if (!Algorithms.stringsEqual(mode.getStringKey(), selectedAppMode.getStringKey())) {
+					selectedAppMode = mode;
+					modesToggle.scrollTo(chip);
+					settings.setApplicationMode(mode);
+					updateFragment();
+				}
+			}
+			return true;
+		});
+		if (selectedItem != null) {
+			modesToggle.scrollTo(selectedItem);
+		}
+	}
+
+	private void setupCards() {
+		cardsContainer.removeAllViews();
+
+		widgetsCard = new ConfigureScreenWidgetsCard(mapActivity);
+		cardsContainer.addView(widgetsCard.build(mapActivity));
+
+		buttonsCard = new ConfigureScreenButtonsCard(mapActivity, this);
+		cardsContainer.addView(buttonsCard.build(mapActivity));
+
+		actionsCard = new ConfigureScreenActionsCard(mapActivity, this, R.string.map_widget_config);
+		cardsContainer.addView(actionsCard.build(mapActivity));
+	}
+
+	private void updateCard(@Nullable BaseCard card) {
+		if (card != null) {
+			card.update();
+		}
+	}
+
+	@Override
+	public void onActionConfirmed(int actionId) {
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity == null) {
+			return;
+		}
+		widgetsSettingsHelper.setAppMode(selectedAppMode);
+		widgetsSettingsHelper.resetConfigureScreenSettings();
+		recreateControlsCompletely(mapActivity);
+		updateFragment();
+	}
+
+	@Override
+	public void copyAppModePrefs(@NonNull ApplicationMode fromAppMode) {
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity == null) {
+			return;
+		}
+		widgetsSettingsHelper.setAppMode(selectedAppMode);
+		widgetsSettingsHelper.copyConfigureScreenSettings(fromAppMode);
+		recreateControlsCompletely(mapActivity);
+		updateFragment();
+	}
+
+	private void recreateControlsCompletely(@NonNull MapActivity mapActivity) {
+		MapInfoLayer mapInfoLayer = app.getOsmandMap().getMapLayers().getMapInfoLayer();
+		if (mapInfoLayer != null) {
+			mapInfoLayer.recreateAllControls(mapActivity);
+		}
+	}
+
+	@Override
+	public void onActionsUpdated() {
+		updateCard(buttonsCard);
+	}
+
+	@Override
+	public void onCompassVisibilityUpdated(@NonNull CompassVisibility visibility) {
+		updateCard(buttonsCard);
+	}
+
+	@Override
+	public void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo) {
+		updateCard(widgetsCard);
+	}
+
+	@Override
+	public void onWidgetVisibilityChanged(@NonNull MapWidgetInfo widgetInfo) {
+
+	}
+
+	@Override
+	public void onWidgetsCleared() {
+
+	}
+
+	@Override
+	public int getStatusBarColorId() {
+		AndroidUiHelper.setStatusBarContentColor(getView(), nightMode);
+		return ColorUtilities.getListBgColorId(nightMode);
+	}
+
+	@Override
+	public boolean getContentStatusBarNightMode() {
+		return nightMode;
+	}
+
+	@NonNull
+	private StateChangedListener<Boolean> getDistanceByTapListener() {
+		if (distanceByTapListener == null) {
+			distanceByTapListener = change -> app.runInUIThread(() -> updateCard(buttonsCard));
+		}
+		return distanceByTapListener;
+	}
+
+	@Override
+	public void onMap3DModeUpdated() {
+		updateCard(buttonsCard);
+	}
+
+	@NonNull
+	public MapActivity requireMapActivity() {
+		FragmentActivity activity = getActivity();
+		if (!(activity instanceof MapActivity)) {
+			throw new IllegalStateException("Fragment " + this + " not attached to an activity.");
+		}
+		return (MapActivity) activity;
+	}
+
+	@Nullable
+	public MapActivity getMapActivity() {
+		FragmentActivity activity = getActivity();
+		return activity instanceof MapActivity ? ((MapActivity) activity) : null;
+	}
+
+	private void updateFragment() {
+		FragmentManager manager = mapActivity.getSupportFragmentManager();
+		Fragment fragment = manager.findFragmentByTag(TAG);
+		if (fragment != null && AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
+			currentScrollY = scrollView.getScrollY();
+			manager.beginTransaction().detach(fragment).commitAllowingStateLoss();
+			manager.beginTransaction().attach(fragment).commitAllowingStateLoss();
+		}
+	}
+
+	public static void showInstance(@NonNull FragmentActivity activity) {
+		FragmentManager fragmentManager = activity.getSupportFragmentManager();
+		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
+			ConfigureScreenFragment fragment = new ConfigureScreenFragment();
+			fragmentManager.beginTransaction()
+					.add(R.id.fragmentContainer, fragment, TAG)
+					.addToBackStack(TAG)
+					.commitAllowingStateLoss();
+		}
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/DistanceByTapFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/DistanceByTapFragment.java
similarity index 98%
rename from OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/DistanceByTapFragment.java
rename to OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/DistanceByTapFragment.java
index 012d4135e3b..5cd7d587f79 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/DistanceByTapFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/DistanceByTapFragment.java
@@ -1,9 +1,8 @@
-package net.osmand.plus.views.mapwidgets.configure;
+package net.osmand.plus.views.mapwidgets.configure.dialogs;
 
 import static net.osmand.plus.utils.UiUtilities.CompoundButtonType.TOOLBAR;
 
 import android.app.Activity;
-import android.content.Context;
 import android.graphics.drawable.ColorDrawable;
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
@@ -24,7 +23,6 @@
 import androidx.fragment.app.FragmentActivity;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.base.BaseOsmAndFragment;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/Map3DModeBottomSheet.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
similarity index 98%
rename from OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/Map3DModeBottomSheet.java
rename to OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
index 67b1322e8e5..677119a2bd4 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/Map3DModeBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
@@ -1,4 +1,4 @@
-package net.osmand.plus.views.mapwidgets.configure;
+package net.osmand.plus.views.mapwidgets.configure.dialogs;
 
 import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenActionsCard.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenActionsCard.java
new file mode 100644
index 00000000000..8c363377732
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenActionsCard.java
@@ -0,0 +1,84 @@
+package net.osmand.plus.views.mapwidgets.configure.dialogs.cards;
+
+import static net.osmand.plus.settings.bottomsheets.ConfirmationBottomSheet.showResetSettingsDialog;
+
+import android.view.View;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.StringRes;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.profiles.SelectCopyAppModeBottomSheet;
+import net.osmand.plus.routepreparationmenu.cards.MapBaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.views.mapwidgets.configure.panel.WidgetsListFragment;
+
+public class ConfigureScreenActionsCard extends MapBaseCard {
+
+	private final Fragment target;
+	@StringRes
+	private final int screenTitleId;
+
+	public ConfigureScreenActionsCard(@NonNull MapActivity mapActivity, @NonNull Fragment target, @StringRes int screenTitleId) {
+		super(mapActivity, false);
+		this.target = target;
+		this.screenTitleId = screenTitleId;
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.configure_widgets_actions_card;
+	}
+
+	@Override
+	protected void updateContent() {
+		TextView title = view.findViewById(R.id.title);
+		title.setText(R.string.shared_string_actions);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.description), false);
+
+		setupResetButton();
+		setupCopyButton();
+	}
+
+	private void setupCopyButton() {
+		View button = view.findViewById(R.id.copy_button);
+		setupAction(button, R.drawable.ic_action_copy, R.string.copy_from_other_profile);
+		button.setOnClickListener(v -> {
+			FragmentManager manager = target.getFragmentManager();
+			if (manager != null) {
+				ApplicationMode appMode = settings.getApplicationMode();
+				SelectCopyAppModeBottomSheet.showInstance(manager, target, appMode);
+			}
+		});
+	}
+
+	private void setupResetButton() {
+		View button = view.findViewById(R.id.reset_button);
+		setupAction(button, R.drawable.ic_action_reset, R.string.reset_to_default);
+		button.setOnClickListener(v -> {
+			FragmentManager manager = target.getFragmentManager();
+			if (manager != null) {
+				showResetSettingsDialog(manager, target, screenTitleId);
+			}
+		});
+	}
+
+	private void setupAction(@NonNull View view, @DrawableRes int iconId, @StringRes int titleId) {
+		ImageView icon = view.findViewById(R.id.icon);
+		TextView title = view.findViewById(R.id.title);
+
+		title.setText(titleId);
+		icon.setImageDrawable(getIcon(iconId));
+
+		ApplicationMode appMode = settings.getApplicationMode();
+		View container = view.findViewById(R.id.container);
+		WidgetsListFragment.setupListItemBackground(app, container, appMode.getProfileColor(nightMode));
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenButtonsCard.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenButtonsCard.java
new file mode 100644
index 00000000000..76d50be6926
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenButtonsCard.java
@@ -0,0 +1,134 @@
+package net.osmand.plus.views.mapwidgets.configure.dialogs.cards;
+
+import static android.util.TypedValue.COMPLEX_UNIT_PX;
+
+import android.graphics.drawable.Drawable;
+import android.view.View;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.quickaction.QuickActionListFragment;
+import net.osmand.plus.routepreparationmenu.cards.MapBaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.enums.CompassVisibility;
+import net.osmand.plus.settings.enums.Map3DModeVisibility;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.CompassVisibilityBottomSheetDialogFragment;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.DistanceByTapFragment;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.Map3DModeBottomSheet;
+
+public class ConfigureScreenButtonsCard extends MapBaseCard {
+
+	private final Fragment target;
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.configure_buttons_card;
+	}
+
+	public ConfigureScreenButtonsCard(@NonNull MapActivity activity, @NonNull Fragment target) {
+		super(activity, false);
+		this.target = target;
+	}
+
+	@Override
+	protected void updateContent() {
+		TextView title = view.findViewById(R.id.title);
+		title.setText(R.string.shared_string_buttons);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.description), false);
+
+		ApplicationMode appMode = settings.getApplicationMode();
+
+		setupCompassVisibilityButton(appMode);
+		setupMap3DModeVisibilityButton(appMode);
+		setupDistanceRulerButton(appMode);
+		setupQuickActionsButton(appMode);
+
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.bottom_divider), false);
+	}
+
+	private void setupDistanceRulerButton(@NonNull ApplicationMode appMode) {
+		boolean enabled = settings.SHOW_DISTANCE_RULER.getModeValue(appMode);
+
+		View button = view.findViewById(R.id.distance_by_tap_button);
+		button.setOnClickListener(v -> DistanceByTapFragment.showInstance(getMapActivity()));
+		setupButton(button, getString(R.string.map_widget_distance_by_tap), null, R.drawable.ic_action_ruler_line, enabled, nightMode);
+
+		TextView count = button.findViewById(R.id.items_count_descr);
+		count.setText(enabled ? R.string.shared_string_on : R.string.shared_string_off);
+		count.setTextSize(COMPLEX_UNIT_PX, app.getResources().getDimensionPixelSize(R.dimen.default_sub_text_size));
+
+		AndroidUiHelper.updateVisibility(count, true);
+		AndroidUiHelper.updateVisibility(button.findViewById(R.id.short_divider), true);
+	}
+
+	private void setupQuickActionsButton(@NonNull ApplicationMode appMode) {
+		String actions = getString(R.string.shared_string_actions);
+		int actionsCount = app.getQuickActionRegistry().getQuickActions().size();
+
+		View button = view.findViewById(R.id.quick_actions_button);
+		button.setOnClickListener(v -> QuickActionListFragment.showInstance(getMapActivity(), false));
+		setupButton(button, getString(R.string.configure_screen_quick_action), getString(R.string.ltr_or_rtl_combine_via_colon, actions, String.valueOf(actionsCount)), R.drawable.ic_quick_action, settings.QUICK_ACTION.getModeValue(appMode), nightMode);
+	}
+
+	private void setupMap3DModeVisibilityButton(@NonNull ApplicationMode appMode) {
+		View button = view.findViewById(R.id.map_3d_mode_button);
+		button.setOnClickListener(v -> {
+			FragmentManager fragmentManager = getMapActivity().getSupportFragmentManager();
+			Map3DModeBottomSheet.showInstance(fragmentManager, target, appMode);
+		});
+		Map3DModeVisibility visibility = settings.MAP_3D_MODE_VISIBILITY.getModeValue(appMode);
+		setupButton(button, getString(R.string.map_3d_mode_action), visibility.getTitle(app), visibility.iconId, true, nightMode);
+
+		AndroidUiHelper.updateVisibility(button.findViewById(R.id.short_divider), true);
+	}
+
+	private void setupCompassVisibilityButton(@NonNull ApplicationMode appMode) {
+		View button = view.findViewById(R.id.compass_button);
+		button.setOnClickListener(v -> {
+			FragmentManager fragmentManager = getMapActivity().getSupportFragmentManager();
+			CompassVisibilityBottomSheetDialogFragment.showInstance(fragmentManager, target, appMode);
+		});
+		CompassVisibility visibility = settings.COMPASS_VISIBILITY.getModeValue(appMode);
+		setupButton(button, getString(R.string.map_widget_compass), visibility.getTitle(app), visibility.iconId, true, nightMode);
+
+		AndroidUiHelper.updateVisibility(button.findViewById(R.id.short_divider), true);
+	}
+
+	public static void setupButton(@NonNull View view, @NonNull String title, @Nullable String description,
+	                               @DrawableRes int iconId, boolean enabled, boolean nightMode) {
+		OsmandApplication app = (OsmandApplication) view.getContext().getApplicationContext();
+		ApplicationMode appMode = app.getSettings().getApplicationMode();
+
+		TextView titleTv = view.findViewById(R.id.title);
+		titleTv.setText(title);
+
+		int iconColor = enabled ? appMode.getProfileColor(nightMode) : ColorUtilities.getDefaultIconColor(app, nightMode);
+		ImageView ivIcon = view.findViewById(R.id.icon);
+		ivIcon.setImageDrawable(app.getUIUtilities().getPaintedIcon(iconId, iconColor));
+
+		TextView descriptionTv = view.findViewById(R.id.description);
+		descriptionTv.setText(description);
+		AndroidUiHelper.updateVisibility(descriptionTv, description != null);
+
+		setupListItemBackground(view, appMode, nightMode);
+	}
+
+	private static void setupListItemBackground(@NonNull View view, @NonNull ApplicationMode mode, boolean nightMode) {
+		int color = mode.getProfileColor(nightMode);
+		Drawable background = UiUtilities.getColoredSelectableDrawable(view.getContext(), color, 0.3f);
+		AndroidUtils.setBackground(view.findViewById(R.id.button_container), background);
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenWidgetsCard.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenWidgetsCard.java
new file mode 100644
index 00000000000..53ac328649b
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/cards/ConfigureScreenWidgetsCard.java
@@ -0,0 +1,136 @@
+package net.osmand.plus.views.mapwidgets.configure.dialogs.cards;
+
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.AVAILABLE_MODE;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.ENABLED_MODE;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.MATCHING_PANELS_MODE;
+import static net.osmand.plus.views.mapwidgets.WidgetsPanel.BOTTOM;
+import static net.osmand.plus.views.mapwidgets.WidgetsPanel.LEFT;
+import static net.osmand.plus.views.mapwidgets.WidgetsPanel.RIGHT;
+import static net.osmand.plus.views.mapwidgets.WidgetsPanel.TOP;
+
+import android.graphics.drawable.Drawable;
+import android.view.View;
+import android.widget.CompoundButton;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import androidx.annotation.NonNull;
+
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.routepreparationmenu.cards.MapBaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
+import net.osmand.plus.views.mapwidgets.WidgetsPanel;
+import net.osmand.plus.views.mapwidgets.configure.panel.ConfigureWidgetsFragment;
+
+import java.util.Collections;
+
+public class ConfigureScreenWidgetsCard extends MapBaseCard {
+
+	private final MapWidgetRegistry widgetRegistry;
+
+	public ConfigureScreenWidgetsCard(@NonNull MapActivity mapActivity) {
+		super(mapActivity, false);
+		widgetRegistry = mapActivity.getMapLayers().getMapWidgetRegistry();
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.configure_widgets_card;
+	}
+
+	@Override
+	protected void updateContent() {
+		TextView title = view.findViewById(R.id.title);
+		TextView description = view.findViewById(R.id.description);
+
+		title.setText(R.string.shared_string_widgets);
+		description.setText(R.string.configure_screen_widgets_descr);
+
+		ApplicationMode appMode = settings.getApplicationMode();
+
+		setupWidgetGroupView(view.findViewById(R.id.left_panel), LEFT, appMode);
+		setupWidgetGroupView(view.findViewById(R.id.right_panel), RIGHT, appMode);
+		setupWidgetGroupView(view.findViewById(R.id.top_panel), TOP, appMode);
+		setupWidgetGroupView(view.findViewById(R.id.bottom_panel), BOTTOM, appMode);
+
+		setupTransparentWidgetsButton(appMode);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.bottomShadowView), false);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.bottom_divider), false);
+	}
+
+	private void setupWidgetGroupView(@NonNull View view, @NonNull WidgetsPanel panel, @NonNull ApplicationMode appMode) {
+		boolean rtl = AndroidUtils.isLayoutRtl(app);
+		int activeColor = appMode.getProfileColor(nightMode);
+		int defColor = ColorUtilities.getDefaultIconColor(app, nightMode);
+
+		view.setTag(panel.name());
+		ImageView ivIcon = view.findViewById(R.id.icon);
+		TextView tvTitle = view.findViewById(R.id.title);
+
+		int count = getWidgetsCount(panel, appMode);
+		int iconColor = count > 0 ? activeColor : defColor;
+		ivIcon.setImageDrawable(getPaintedIcon(panel.getIconId(rtl), iconColor));
+
+		tvTitle.setText(panel.getTitleId(rtl));
+
+		updateWidgetsCount(view, count);
+
+		view.findViewById(R.id.button_container).setOnClickListener(v -> ConfigureWidgetsFragment.showInstance(getMapActivity(), panel, appMode));
+
+		setupListItemBackground(view, appMode);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.short_divider), panel == RIGHT);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.long_divider), panel == BOTTOM);
+	}
+
+	private int getWidgetsCount(@NonNull WidgetsPanel panel, @NonNull ApplicationMode appMode) {
+		int filter = ENABLED_MODE | AVAILABLE_MODE | MATCHING_PANELS_MODE;
+		return widgetRegistry.getWidgetsForPanel(mapActivity, appMode, filter, Collections.singletonList(panel)).size();
+	}
+
+	private void updateWidgetsCount(@NonNull View container, int count) {
+		TextView countContainer = container.findViewById(R.id.items_count_descr);
+		countContainer.setText(String.valueOf(count));
+		AndroidUiHelper.updateVisibility(countContainer, true);
+	}
+
+	private void setupTransparentWidgetsButton(@NonNull ApplicationMode appMode) {
+		View button = view.findViewById(R.id.transparent_widgets_button);
+
+		boolean enabled = settings.TRANSPARENT_MAP_THEME.getModeValue(appMode);
+		ConfigureScreenButtonsCard.setupButton(button, getString(R.string.map_widget_transparent), null, R.drawable.ic_action_appearance, enabled, nightMode);
+
+		CompoundButton compoundButton = button.findViewById(R.id.compound_button);
+		compoundButton.setChecked(enabled);
+		AndroidUiHelper.updateVisibility(compoundButton, true);
+
+		button.setOnClickListener(v -> {
+			boolean newState = !compoundButton.isChecked();
+			compoundButton.setChecked(newState);
+		});
+		int activeColor = appMode.getProfileColor(nightMode);
+		int defColor = ColorUtilities.getDefaultIconColor(app, nightMode);
+		UiUtilities.setupCompoundButton(nightMode, activeColor, compoundButton);
+
+		ImageView icon = button.findViewById(R.id.icon);
+		compoundButton.setOnCheckedChangeListener((buttonView, isChecked) -> {
+			icon.setColorFilter(isChecked ? activeColor : defColor);
+
+			boolean transparent = settings.TRANSPARENT_MAP_THEME.get();
+			settings.TRANSPARENT_MAP_THEME.setModeValue(appMode, !transparent);
+			mapActivity.updateApplicationModeSettings();
+		});
+	}
+
+	private void setupListItemBackground(@NonNull View view, @NonNull ApplicationMode appMode) {
+		View button = view.findViewById(R.id.button_container);
+		int color = appMode.getProfileColor(nightMode);
+		Drawable background = UiUtilities.getColoredSelectableDrawable(app, color, 0.3f);
+		AndroidUtils.setBackground(button, background);
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
index b2218c34bd2..a52c4357bf8 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
@@ -25,7 +25,7 @@
 import net.osmand.plus.views.mapwidgets.WidgetGroup;
 import net.osmand.plus.views.mapwidgets.WidgetType;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.configure.ConfigureScreenActionsCard;
+import net.osmand.plus.views.mapwidgets.configure.dialogs.cards.ConfigureScreenActionsCard;
 import net.osmand.plus.settings.bottomsheets.ConfirmationBottomSheet.ConfirmationDialogListener;
 import net.osmand.plus.views.mapwidgets.configure.WidgetsSettingsHelper;
 import net.osmand.plus.views.mapwidgets.configure.WidgetIconsHelper;
@@ -170,7 +170,7 @@ public void scrollToActions() {
 
 	private void setupActionsCard() {
 		int panelTitleId = selectedPanel.getTitleId(AndroidUtils.isLayoutRtl(app));
-		View cardView = new ConfigureScreenActionsCard(requireMapActivity(), this, selectedAppMode, panelTitleId)
+		View cardView = new ConfigureScreenActionsCard(requireMapActivity(), this, panelTitleId)
 				.build(view.getContext());
 		actionsCardContainer.addView(cardView);
 	}
