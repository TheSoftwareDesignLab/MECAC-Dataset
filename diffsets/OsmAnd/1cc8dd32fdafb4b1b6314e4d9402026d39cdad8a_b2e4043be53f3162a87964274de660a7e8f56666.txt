diff --git a/OsmAnd/res/layout/current_gpx_item.xml b/OsmAnd/res/layout/current_gpx_item.xml
index 38cb9aee84f..cf8a2f546fb 100644
--- a/OsmAnd/res/layout/current_gpx_item.xml
+++ b/OsmAnd/res/layout/current_gpx_item.xml
@@ -7,10 +7,6 @@
 	android:background="?attr/list_background_color"
 	android:orientation="vertical">
 
-	<include
-		android:id="@+id/top_divider"
-		layout="@layout/simple_divider_item" />
-
 	<include layout="@layout/track_list_item" />
 
 	<LinearLayout
diff --git a/OsmAnd/res/layout/filter_city_item.xml b/OsmAnd/res/layout/filter_city_item.xml
index c078fd747c5..241b3a1fa0f 100644
--- a/OsmAnd/res/layout/filter_city_item.xml
+++ b/OsmAnd/res/layout/filter_city_item.xml
@@ -12,6 +12,7 @@
 		android:id="@+id/title_container"
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
+		android:background="?attr/selectableItemBackground"
 		android:orientation="horizontal"
 		android:paddingTop="@dimen/content_padding"
 		android:paddingBottom="@dimen/content_padding">
diff --git a/OsmAnd/res/layout/filter_date_item.xml b/OsmAnd/res/layout/filter_date_item.xml
index 457d5d4d8fb..6fcd9d34aea 100644
--- a/OsmAnd/res/layout/filter_date_item.xml
+++ b/OsmAnd/res/layout/filter_date_item.xml
@@ -12,6 +12,7 @@
 		android:id="@+id/title_container"
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
+		android:background="?attr/selectableItemBackground"
 		android:orientation="horizontal"
 		android:paddingTop="@dimen/content_padding"
 		android:paddingBottom="@dimen/content_padding">
diff --git a/OsmAnd/res/layout/filter_other_item.xml b/OsmAnd/res/layout/filter_other_item.xml
index 5388d6db1c8..74ceac53d1b 100644
--- a/OsmAnd/res/layout/filter_other_item.xml
+++ b/OsmAnd/res/layout/filter_other_item.xml
@@ -12,6 +12,7 @@
 		android:id="@+id/title_container"
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
+		android:background="?attr/selectableItemBackground"
 		android:orientation="horizontal"
 		android:paddingTop="@dimen/content_padding"
 		android:paddingBottom="@dimen/content_padding">
diff --git a/OsmAnd/res/layout/filter_range_item.xml b/OsmAnd/res/layout/filter_range_item.xml
index c6105588d03..84d57404524 100644
--- a/OsmAnd/res/layout/filter_range_item.xml
+++ b/OsmAnd/res/layout/filter_range_item.xml
@@ -14,7 +14,9 @@
 		android:layout_height="wrap_content"
 		android:orientation="horizontal"
 		android:paddingTop="@dimen/content_padding"
-		android:paddingBottom="@dimen/content_padding">
+		android:background="?attr/selectableItemBackground"
+		android:paddingBottom="@dimen/content_padding"
+		>
 
 		<net.osmand.plus.widgets.TextViewEx
 			android:id="@+id/title"
@@ -111,6 +113,8 @@
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
 		app:labelBehavior="gone"
+		app:tickColorInactive="#000"
+		app:tickColorActive="#000"
 		android:layout_marginStart="@dimen/content_padding_small"
 		android:layout_marginLeft="@dimen/content_padding_small"
 		android:layout_marginEnd="@dimen/content_padding_small"
diff --git a/OsmAnd/res/layout/fragment_track_filters.xml b/OsmAnd/res/layout/fragment_track_filters.xml
index b44cfa2a4d3..48dc7e2ffec 100644
--- a/OsmAnd/res/layout/fragment_track_filters.xml
+++ b/OsmAnd/res/layout/fragment_track_filters.xml
@@ -28,7 +28,7 @@
 				android:layout_width="@dimen/toolbar_height"
 				android:layout_height="@dimen/toolbar_height"
 				android:contentDescription="@string/access_shared_string_navigate_up"
-				osmand:srcCompat="@drawable/ic_arrow_back"
+				osmand:srcCompat="@drawable/ic_action_close"
 				osmand:tint="?attr/default_icon_color" />
 
 			<net.osmand.plus.widgets.TextViewEx
@@ -61,37 +61,58 @@
 	</LinearLayout>
 
 	<LinearLayout
-		android:id="@+id/buttons_container"
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
 		android:layout_gravity="bottom"
-		android:background="?attr/list_background_color"
-		android:gravity="center"
-		android:minHeight="@dimen/bottom_sheet_title_height"
-		android:orientation="horizontal"
-		android:padding="@dimen/content_padding_half">
-
-		<net.osmand.plus.widgets.dialogbutton.DialogButton
-			android:id="@+id/reset_all_button"
-			android:layout_width="wrap_content"
-			android:layout_height="wrap_content"
-			osmand:dialogButtonTitle="@string/shared_string_reset_all"
-			osmand:dialogButtonType="tertiary"
-			osmand:dialogButtonUseUppercaseTitle="true" />
+		android:orientation="vertical">
 
-		<View
-			android:layout_width="0dp"
-			android:layout_height="match_parent"
-			android:layout_weight="1" />
+		<me.zhanghai.android.materialprogressbar.MaterialProgressBar
+			android:id="@+id/progress_bar"
+			style="@style/Widget.MaterialProgressBar.ProgressBar.Horizontal"
+			android:layout_width="match_parent"
+			android:layout_height="4dp"
+			android:indeterminate="true"
+			android:visibility="gone"
+			osmand:mpb_progressStyle="horizontal"
+			osmand:mpb_setBothDrawables="true"
+			osmand:mpb_useIntrinsicPadding="false" />
+
+		<include
+			android:id="@+id/top_divider"
+			layout="@layout/simple_divider_item" />
 
-		<net.osmand.plus.widgets.dialogbutton.DialogButton
-			android:id="@+id/show_button"
-			android:layout_width="wrap_content"
+		<LinearLayout
+			android:id="@+id/buttons_container"
+			android:layout_width="match_parent"
 			android:layout_height="wrap_content"
-			osmand:dialogButtonTitle="@string/shared_string_show"
-			osmand:dialogButtonType="tertiary"
-			osmand:dialogButtonUseUppercaseTitle="true" />
+			android:background="?attr/list_background_color"
+			android:gravity="center"
+			android:minHeight="@dimen/bottom_sheet_title_height"
+			android:orientation="horizontal"
+			android:padding="@dimen/content_padding_half">
+
+			<net.osmand.plus.widgets.dialogbutton.DialogButton
+				android:id="@+id/reset_all_button"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				osmand:dialogButtonTitle="@string/shared_string_reset_all"
+				osmand:dialogButtonType="tertiary"
+				osmand:dialogButtonUseUppercaseTitle="true" />
+
+			<View
+				android:layout_width="0dp"
+				android:layout_height="match_parent"
+				android:layout_weight="1" />
+
+			<net.osmand.plus.widgets.dialogbutton.DialogButton
+				android:id="@+id/show_button"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				osmand:dialogButtonTitle="@string/shared_string_show"
+				osmand:dialogButtonType="tertiary"
+				osmand:dialogButtonUseUppercaseTitle="true" />
 
+		</LinearLayout>
 	</LinearLayout>
 
 </LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/values/no_translate.xml b/OsmAnd/res/values/no_translate.xml
index 840ba2d42cf..bcca6432e8e 100644
--- a/OsmAnd/res/values/no_translate.xml
+++ b/OsmAnd/res/values/no_translate.xml
@@ -8,6 +8,7 @@
     <string name="app_store_name">OsmAnd Maps</string>
     
     <!-- Not translatable -->
+    <string name="number_in_breckets">(%d)</string>
     <string name="degree_celsius">Â°C</string>
     <string name="amazon_market">Amazon</string>
     <string name="huawei_market">Huawei</string>
diff --git a/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt b/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt
index 3f45ec59353..7907c3f58e2 100644
--- a/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt
+++ b/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt
@@ -28,7 +28,7 @@ import java.util.Collections
 
 class SearchTracksAdapter(
     private val app: OsmandApplication,
-    private val trackItems: List<TrackItem>,
+    private var trackItems: List<TrackItem>,
     private val nightMode: Boolean,
     private var selectionMode: Boolean
 ) :
@@ -87,6 +87,11 @@ class SearchTracksAdapter(
         filter.setCallback(filterCallback)
     }
 
+    fun updateAllItems(allItems: List<TrackItem>) {
+        trackItems = allItems
+        filter.setAllItems(allItems)
+    }
+
     fun updateFilteredItems(filteredItems: List<TrackItem>) {
         this.filteredItems = filteredItems
 
diff --git a/OsmAnd/src/net/osmand/plus/configmap/tracks/TrackFolderLoaderTask.java b/OsmAnd/src/net/osmand/plus/configmap/tracks/TrackFolderLoaderTask.java
index 0b9bba89d21..36bb4c99580 100644
--- a/OsmAnd/src/net/osmand/plus/configmap/tracks/TrackFolderLoaderTask.java
+++ b/OsmAnd/src/net/osmand/plus/configmap/tracks/TrackFolderLoaderTask.java
@@ -97,6 +97,7 @@ protected void onPostExecute(@NonNull TrackFolder folder) {
 		if (listener != null) {
 			listener.loadTracksFinished(folder);
 		}
+		smartFolderHelper.notifyUpdateListeners();
 	}
 
 	public interface LoadTracksListener {
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java
index 4f037715987..a3cd3478e81 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java
@@ -38,13 +38,14 @@
 import net.osmand.plus.widgets.dialogbutton.DialogButton;
 
 import java.io.File;
+import java.util.ArrayList;
 import java.util.Collections;
 import java.util.HashSet;
 import java.util.List;
 import java.util.Set;
 
 public class SearchMyPlacesTracksFragment extends SearchTrackBaseFragment implements SelectGpxTaskListener,
-		FragmentStateHolder, SelectionHelperProvider<TrackItem>, OnTrackFileMoveListener, SmartFolderUpdateListener, FilterChangedListener {
+		FragmentStateHolder, SelectionHelperProvider<TrackItem>, OnTrackFileMoveListener, SmartFolderUpdateListener, FilterChangedListener, TackFiltersContainer {
 
 	public static final String TAG = SearchMyPlacesTracksFragment.class.getSimpleName();
 
@@ -307,6 +308,9 @@ private void setupBottomMenu(View view) {
 	@Override
 	public void onResume() {
 		super.onResume();
+		setupToolbar(requireView());
+//		updateNightMode();
+//		updateStatusBarColor(requireDialog().getWindow());
 		app.getSmartFolderHelper().addUpdateListener(this);
 		((TracksSearchFilter) adapter.getFilter()).addFiltersChangedListener(this);
 		updateContent();
@@ -359,6 +363,7 @@ public void onSmartFolderUpdated(@NonNull SmartFolder smartFolder) {
 
 	@Override
 	public void onSmartFoldersUpdated() {
+		adapter.updateFilteredItems(new ArrayList<>(selectionHelper.getAllItems()));
 		updateButtonsState();
 	}
 
@@ -367,7 +372,7 @@ public void showFiltersDialog() {
 		FragmentManager manager = getFragmentManager();
 		Filter filter = adapter.getFilter();
 		if (manager != null && filter instanceof TracksSearchFilter) {
-			TracksFilterFragment.Companion.showInstance(manager, (TracksSearchFilter) filter, smartFolder);
+			TracksFilterFragment.Companion.showInstance(manager, (TracksSearchFilter) filter, this, smartFolder);
 		}
 	}
 
@@ -375,4 +380,13 @@ public void showFiltersDialog() {
 	public void onFilterChanged() {
 		updateButtonsState();
 	}
+
+	@Override
+	public void onFilterDialogClosed() {
+		setupFilterCallback();
+		List<TrackItem> filteredItems = ((TracksSearchFilter) adapter.getFilter()).getFilteredTrackItems();
+		if (filteredItems != null) {
+			updateAdapterWithFilteredItems(filteredItems);
+		}
+	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchTrackBaseFragment.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchTrackBaseFragment.java
index 5062f5e0977..39291afe4a7 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchTrackBaseFragment.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchTrackBaseFragment.java
@@ -61,7 +61,6 @@ public abstract class SearchTrackBaseFragment extends BaseOsmAndDialogFragment i
 	private Float heading;
 	private boolean locationUpdateStarted;
 	private boolean compassUpdateAllowed = true;
-	private SmartFolderHelper smartFolderHelper;
 
 	@Override
 	protected boolean isUsedOnMap() {
@@ -71,7 +70,6 @@ protected boolean isUsedOnMap() {
 	@Override
 	public void onCreate(Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-		smartFolderHelper = app.getSmartFolderHelper();
 		if (!selectionHelper.hasAnyItems()) {
 			setupSelectionHelper();
 		}
@@ -123,15 +121,23 @@ public void onResume() {
 		searchEditText.requestFocus();
 		AndroidUtils.showSoftKeyboard(requireActivity(), searchEditText);
 		startLocationUpdate();
+		setupFilterCallback();
+	}
+
+	protected void setupFilterCallback() {
 		adapter.setFilterCallback(filteredItems -> {
-			searchEditText.setText(adapter.getCurrentSearchQuery());
-			searchEditText.setSelection(searchEditText.length());
-			adapter.updateFilteredItems(filteredItems);
-			updateButtonsState();
+			updateAdapterWithFilteredItems(filteredItems);
 			return true;
 		});
 	}
 
+	protected void updateAdapterWithFilteredItems(List<TrackItem> filteredItems) {
+		searchEditText.setText(adapter.getCurrentSearchQuery());
+		searchEditText.setSelection(searchEditText.length());
+		adapter.updateFilteredItems(filteredItems);
+		updateButtonsState();
+	}
+
 	public void setupSelectionHelper() {
 		Fragment fragment = getTargetFragment();
 		if (fragment instanceof ItemsSelectionHelper.SelectionHelperProvider) {
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TackFiltersContainer.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TackFiltersContainer.java
new file mode 100644
index 00000000000..21ae63f7b1c
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TackFiltersContainer.java
@@ -0,0 +1,6 @@
+package net.osmand.plus.myplaces.tracks;
+
+public interface TackFiltersContainer {
+	default void onFilterDialogClosed() {
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java
index 44bdf1895c5..16c7064f0e6 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java
@@ -32,10 +32,11 @@
 
 public class TracksSearchFilter extends Filter implements FilterChangedListener {
 
-	private final List<TrackItem> trackItems;
+	private List<TrackItem> trackItems;
 	private CallbackWithObject<List<TrackItem>> callback;
 	private List<BaseTrackFilter> currentFilters = new ArrayList<>();
 	private List<FilterChangedListener> filterChangedListeners = new ArrayList<>();
+	private List<TrackItem> filteredTrackItems;
 
 	private OsmandApplication app;
 
@@ -56,6 +57,10 @@ private void initFilters(@NonNull OsmandApplication app) {
 			dateFilter.setValueFrom(minDate);
 			dateFilter.setValueTo(now);
 		}
+		LengthTrackFilter lengthFilter = (LengthTrackFilter) getFilterByType(FilterType.LENGTH);
+		if (lengthFilter != null) {
+			lengthFilter.setMaxValue((float) app.getGpxDbHelper().getTracksMaxDuration());
+		}
 		CityTrackFilter cityFilter = (CityTrackFilter) getFilterByType(FilterType.CITY);
 		if (cityFilter != null) {
 			cityFilter.setFullCitiesList(app.getGpxDbHelper().getNearestCityList());
@@ -296,5 +301,23 @@ public void onFilterChanged() {
 		}
 
 	}
+
+	public void resetFilteredItems() {
+		filteredTrackItems = null;
+	}
+
+	@Nullable
+	public List<TrackItem> getFilteredTrackItems() {
+		return filteredTrackItems;
+	}
+
+	public void setFilteredTrackItems(List<TrackItem> trackItems) {
+		filteredTrackItems = trackItems;
+	}
+
+	public void setAllItems(List<TrackItem> trackItems) {
+		this.trackItems = trackItems;
+	}
+
 }
 
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java
index f0e651171e5..7288dec6916 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java
@@ -193,8 +193,8 @@ public boolean onOptionsItemSelected(MenuItem item) {
 	protected List<Object> getAdapterItems() {
 		List<Object> items = new ArrayList<>();
 		boolean osmMonitoringEnabled = PluginsHelper.isActive(OsmandMonitoringPlugin.class);
-		boolean isTracksEmpty = Algorithms.isEmpty(rootFolder.getFlattenedTrackItems());
-		boolean isSubFoldersEmpty = Algorithms.isEmpty(rootFolder.getFlattenedSubFolders());
+		boolean isTracksEmpty = rootFolder == null || Algorithms.isEmpty(rootFolder.getFlattenedTrackItems());
+		boolean isSubFoldersEmpty = rootFolder == null || Algorithms.isEmpty(rootFolder.getFlattenedSubFolders());
 		boolean isSmartFoldersEmpty = Algorithms.isEmpty(smartFolderHelper.getSmartFolders());
 
 		items.add(TYPE_SORT_TRACKS);
@@ -209,8 +209,10 @@ protected List<Object> getAdapterItems() {
 			if (smartFolderHelper != null) {
 				items.addAll(smartFolderHelper.getSmartFolders());
 			}
-			items.addAll(rootFolder.getSubFolders());
-			items.addAll(rootFolder.getTrackItems());
+			if (rootFolder != null) {
+				items.addAll(rootFolder.getSubFolders());
+				items.addAll(rootFolder.getTrackItems());
+			}
 		}
 		if (!isTracksEmpty) {
 			items.add(rootFolder.getFolderAnalysis());
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/SmartFolderFragment.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/SmartFolderFragment.kt
index f4e0189a24c..a5c00a97c89 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/SmartFolderFragment.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/SmartFolderFragment.kt
@@ -132,4 +132,13 @@ class SmartFolderFragment : TrackFolderFragment(), SmartFolderUpdateListener {
 			updateContent()
 		}
 	}
+
+	override fun onSmartFoldersUpdated() {
+		super.onSmartFoldersUpdated()
+		val actualFolder = smartFolderHelper.getSmartFolder(smartFolder.folderName)
+		if (actualFolder != smartFolder) {
+			smartFolder = actualFolder
+		}
+		updateContent()
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt
index 1726261c160..e8047fca2ae 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt
@@ -1,17 +1,24 @@
 package net.osmand.plus.myplaces.tracks.dialogs
 
+import android.app.Dialog
 import android.os.Bundle
 import android.view.LayoutInflater
 import android.view.View
 import android.view.ViewGroup
+import android.view.Window
 import android.widget.ImageView
+import android.widget.ProgressBar
 import android.widget.Toast
 import androidx.core.content.ContextCompat
 import androidx.fragment.app.FragmentManager
 import androidx.recyclerview.widget.LinearLayoutManager
 import androidx.recyclerview.widget.RecyclerView
+import net.osmand.CallbackWithObject
 import net.osmand.plus.R
 import net.osmand.plus.base.BaseOsmAndDialogFragment
+import net.osmand.plus.configmap.tracks.TrackItem
+import net.osmand.plus.helpers.AndroidUiHelper
+import net.osmand.plus.myplaces.tracks.TackFiltersContainer
 import net.osmand.plus.myplaces.tracks.TracksSearchFilter
 import net.osmand.plus.myplaces.tracks.filters.FilterChangedListener
 import net.osmand.plus.myplaces.tracks.filters.FiltersAdapter
@@ -29,10 +36,12 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 		fun showInstance(
 			manager: FragmentManager,
 			filter: TracksSearchFilter,
+			trackFiltersContainer: TackFiltersContainer,
 			smartFolder: SmartFolder?) {
 			if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 				val fragment = TracksFilterFragment()
 				fragment.retainInstance = true
+				fragment.trackFiltersContainer = trackFiltersContainer
 				fragment.filter = filter
 				fragment.smartFolder = smartFolder
 				fragment.show(manager, TAG)
@@ -43,15 +52,40 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 	lateinit var filter: TracksSearchFilter
 	var adapter: FiltersAdapter? = null
 	var resetAllButton: DialogButton? = null
+	var progressBar: ProgressBar? = null
 	var showButton: DialogButton? = null
 	private lateinit var smartFolderHelper: SmartFolderHelper
 	private var smartFolder: SmartFolder? = null
+	private lateinit var trackFiltersContainer: TackFiltersContainer
 
 	override fun onCreate(savedInstanceState: Bundle?) {
 		super.onCreate(savedInstanceState)
 		smartFolderHelper = app.smartFolderHelper
 	}
 
+	override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {
+		val themeId =
+			if (nightMode) R.style.OsmandDarkTheme else R.style.OsmandLightTheme_LightStatusBar
+		val dialog = Dialog(requireContext(), themeId)
+		val window = dialog.window
+		if (window != null) {
+			if (!settings.DO_NOT_USE_ANIMATIONS.get()) {
+				window.attributes.windowAnimations = R.style.Animations_Alpha
+			}
+			updateStatusBarColor(window)
+		}
+		return dialog
+	}
+
+	private fun updateStatusBarColor(window: Window?) {
+		window?.let {
+			val statusBarColor =
+				if (nightMode) R.color.status_bar_secondary_dark else R.color.status_bar_secondary_light
+			ContextCompat.getColor(requireContext(), statusBarColor)
+			window.statusBarColor = ContextCompat.getColor(requireContext(), statusBarColor)
+		}
+	}
+
 	override fun onCreateView(
 		inflater: LayoutInflater,
 		container: ViewGroup?,
@@ -71,6 +105,7 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 		setupList(view)
 		setupBottomMenu(view)
 		updateUI()
+		applyFilter()
 	}
 
 	private fun setupBottomMenu(view: View) {
@@ -85,8 +120,9 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 		showButton = view.findViewById(R.id.show_button)
 		showButton?.setOnClickListener {
 			dismiss()
-			filter.filter()
+			trackFiltersContainer.onFilterDialogClosed()
 		}
+		progressBar = view.findViewById(R.id.progress_bar)
 	}
 
 	fun setupToolbar(view: View) {
@@ -96,6 +132,7 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 				app.smartFolderHelper.saveSmartFolder(smartFolder!!, filter.currentFilters)
 				Toast.makeText(app, R.string.smart_folder_saved, Toast.LENGTH_SHORT).show()
 				dismiss()
+				trackFiltersContainer.onFilterDialogClosed()
 			} else {
 				smartFolderHelper.showSaveSmartFolderDialog(
 					requireActivity(),
@@ -111,6 +148,8 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 					it.notifyItemRangeChanged(0, it.itemCount)
 				}
 				dismiss()
+				filter.resetFilteredItems()
+				trackFiltersContainer.onFilterDialogClosed()
 			}
 			if (closeButton is ImageView) {
 				UiUtilities.rotateImageByLayoutDirection(closeButton)
@@ -128,14 +167,36 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 
 	override fun onFilterChanged() {
 		updateUI()
+		applyFilter()
 	}
 
+	private fun applyFilter() {
+		updateProgressVisibility(true)
+		filter.filter()
+	}
+
+
 	private fun updateUI() {
 		resetAllButton?.isEnabled = filter.appliedFiltersCount > 0
+		var filteredItemsCount = 0
+		if (filter.filteredTrackItems?.size != null) {
+			filteredItemsCount = filter.filteredTrackItems!!.size
+		}
+		showButton?.setTitle(
+			app.getString(R.string.shared_string_show) +
+					String.format(app.getString(R.string.number_in_breckets), filteredItemsCount))
 	}
 
 	override fun onResume() {
 		super.onResume()
+		updateNightMode()
+		updateStatusBarColor(requireDialog().window)
+		filter.setCallback(CallbackWithObject<List<TrackItem>> { trackItems ->
+			updateProgressVisibility(false)
+			filter.filteredTrackItems = trackItems
+			updateUI()
+			return@CallbackWithObject true
+		})
 		filter.addFiltersChangedListener(this)
 	}
 
@@ -143,4 +204,9 @@ class TracksFilterFragment : BaseOsmAndDialogFragment(),
 		super.onPause()
 		filter.removeFiltersChangedListener(this)
 	}
+
+	private fun updateProgressVisibility(visible: Boolean) {
+		AndroidUiHelper.setVisibility(
+			if (visible) View.VISIBLE else View.GONE, progressBar)
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/DateCreationTrackFilter.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/DateCreationTrackFilter.kt
index 8acbddbc04c..97de68b5eca 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/DateCreationTrackFilter.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/DateCreationTrackFilter.kt
@@ -1,5 +1,6 @@
 package net.osmand.plus.myplaces.tracks.filters
 
+import android.util.Log
 import com.google.gson.annotations.Expose
 import net.osmand.plus.R
 import net.osmand.plus.configmap.tracks.TrackItem
@@ -34,7 +35,9 @@ class DateCreationTrackFilter(filterChangedListener: FilterChangedListener) :
 	}
 
 	private fun isDatesEquals(day1: Long, day2: Long): Boolean {
-		return DATE_FORMAT.format(day1).equals(DATE_FORMAT.format(day2))
+		val day1String = DATE_FORMAT.format(day1)
+		val day2String = DATE_FORMAT.format(day2)
+		return day1String.equals(day2String)
 	}
 
 	override fun isTrackAccepted(trackItem: TrackItem): Boolean {
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/RangeTrackFilter.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/RangeTrackFilter.kt
index a9cf7f697ab..f380d328717 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/RangeTrackFilter.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/RangeTrackFilter.kt
@@ -20,6 +20,7 @@ abstract class RangeTrackFilter(
 
 	@Expose
 	var maxValue: Float
+		private set
 
 	@Expose
 	var valueFrom: Float
@@ -69,6 +70,11 @@ abstract class RangeTrackFilter(
 		}
 	}
 
+	fun setMaxValue(value: Float) {
+		maxValue = value
+		valueTo = value
+	}
+
 	override fun equals(other: Any?): Boolean {
 		return super.equals(other) &&
 				other is RangeTrackFilter &&
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt
index e6484ae6621..924bca00f85 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt
@@ -107,7 +107,7 @@ class SmartFolderHelper(val app: OsmandApplication) {
 		notifyFolderCreatedListeners(newFolder)
 	}
 
-	private fun notifyUpdateListeners() {
+	fun notifyUpdateListeners() {
 		for (listener in updateListeners) {
 			listener.onSmartFoldersUpdated()
 		}
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/FilterRangeViewHolder.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/FilterRangeViewHolder.kt
index c0c02d36092..e4143772536 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/FilterRangeViewHolder.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/FilterRangeViewHolder.kt
@@ -15,8 +15,12 @@ import net.osmand.plus.widgets.tools.SimpleTextWatcher
 import net.osmand.util.Algorithms
 import studio.carbonylgroup.textfieldboxes.ExtendedEditText
 import java.text.DecimalFormat
+import kotlin.math.ceil
+import kotlin.math.floor
 
-open class FilterRangeViewHolder(itemView: View, nightMode: Boolean) :
+open class FilterRangeViewHolder(
+	itemView: View,
+	nightMode: Boolean) :
 	RecyclerView.ViewHolder(itemView) {
 	protected val app: OsmandApplication
 	private val nightMode: Boolean
@@ -71,10 +75,13 @@ open class FilterRangeViewHolder(itemView: View, nightMode: Boolean) :
 			override fun afterTextChanged(newText: Editable) {
 				super.afterTextChanged(newText)
 				if (!Algorithms.isEmpty(newText) && Algorithms.isFloat(newText.toString(), true)) {
-					val newValue = Math.round(newText.toString().toFloat() * 1000) / 1000f
-					if (filter!!.valueFrom != newValue) {
-						filter!!.setValueFrom(newValue)
-						updateValues()
+					val newValue = newText.toString().toFloat()
+					filter?.let { rangeFilter ->
+						if (rangeFilter.valueFrom != newValue
+							&& newValue < rangeFilter.valueTo) {
+							rangeFilter.setValueFrom(newValue)
+							updateValues()
+						}
 					}
 				}
 			}
@@ -85,9 +92,12 @@ open class FilterRangeViewHolder(itemView: View, nightMode: Boolean) :
 				super.afterTextChanged(newText)
 				if (!Algorithms.isEmpty(newText) && Algorithms.isInt(newText.toString())) {
 					val newValue = newText.toString().toFloat()
-					if (filter!!.valueTo != newValue) {
-						filter!!.setValueTo(newValue)
-						updateValues()
+					filter?.let { rangeFilter ->
+						if (rangeFilter.valueTo != newValue
+							&& newValue > rangeFilter.valueFrom) {
+							rangeFilter.setValueTo(newValue)
+							updateValues()
+						}
 					}
 				}
 			}
@@ -117,19 +127,19 @@ open class FilterRangeViewHolder(itemView: View, nightMode: Boolean) :
 	}
 
 	private fun updateValues() {
-		val valueFrom = filter!!.valueFrom
-		val valueTo = filter!!.valueTo
+		val valueFrom = floor(filter!!.valueFrom)
+		val valueTo = ceil(filter!!.valueTo)
+		slider.valueFrom = floor(filter!!.minValue)
+		slider.valueTo = ceil(filter!!.maxValue)
 		slider.setValues(valueFrom, valueTo)
-		slider.valueFrom = filter!!.minValue
-		slider.valueTo = filter!!.maxValue
 		valueFromInput.setText(decimalFormat.format(valueFrom))
 		valueFromInput.setSelection(valueFromInput.length())
 		valueToInput.setText(decimalFormat.format(valueTo))
 		valueToInput.setSelection(valueToInput.length())
 		val minValuePrompt =
-			"${decimalFormat.format(filter!!.minValue)}, ${app.getString(filter!!.unitResId)}"
+			"${decimalFormat.format(filter!!.minValue)} ${app.getString(filter!!.unitResId)}"
 		val maxValuePrompt =
-			"${decimalFormat.format(filter!!.maxValue)}, ${app.getString(filter!!.unitResId)}"
+			"${decimalFormat.format(filter!!.maxValue)} ${app.getString(filter!!.unitResId)}"
 		minFilterValue.text = minValuePrompt
 		maxFilterValue.text = maxValuePrompt
 		AndroidUiHelper.updateVisibility(selectedValue, filter!!.isEnabled())
diff --git a/OsmAnd/src/net/osmand/plus/track/helpers/GPXDatabase.java b/OsmAnd/src/net/osmand/plus/track/helpers/GPXDatabase.java
index bb2bbaf22e8..aed5de34ca8 100644
--- a/OsmAnd/src/net/osmand/plus/track/helpers/GPXDatabase.java
+++ b/OsmAnd/src/net/osmand/plus/track/helpers/GPXDatabase.java
@@ -237,6 +237,10 @@ public class GPXDatabase {
 			" FROM " + GPX_TABLE_NAME + " WHERE " + GPX_COL_FILE_CREATION_TIME +
 			" != 0";
 
+	private static final String GPX_MAX_TRACK_DURATION = "SELECT " +
+			"MAX(" + GPX_COL_TOTAL_DISTANCE + ") " +
+			" FROM " + GPX_TABLE_NAME;
+
 	private static final String GPX_TABLE_UPDATE_APPEARANCE = "UPDATE " +
 			GPX_TABLE_NAME + " SET " +
 			GPX_COL_COLOR + " = ?, " +
@@ -261,7 +265,7 @@ public static class GpxDataItem {
 		private double splitInterval;
 		private long fileLastModifiedTime;
 		private long fileLastUploadedTime;
-		private long fileCreationTime;
+		private long fileCreationTime = -1;
 		private boolean importedByApi;
 		private boolean showAsMarkers;
 		private boolean joinSegments;
@@ -645,7 +649,7 @@ public boolean updateCreateTime(@NonNull GpxDataItem item, long fileCreatedTime)
 								GPX_COL_FILE_CREATION_TIME + " = ? " +
 								" WHERE " + GPX_COL_NAME + " = ? AND " + GPX_COL_DIR + " = ?",
 						new Object[] {fileCreatedTime, fileName, fileDir});
-				item.fileLastUploadedTime = fileCreatedTime;
+				item.fileCreationTime = fileCreatedTime;
 			} finally {
 				db.close();
 			}
@@ -1236,6 +1240,28 @@ public long getTracksMinCreateDate() {
 		return minDate;
 	}
 
+	public double getTracksMaxDuration() {
+		double maxLength = 0.0;
+		SQLiteConnection db = openConnection(false);
+		if (db != null) {
+			try {
+				SQLiteCursor query = db.rawQuery(GPX_MAX_TRACK_DURATION, null);
+				if (query != null) {
+					try {
+						if (query.moveToFirst()) {
+							maxLength = query.getDouble(0);
+						}
+					} finally {
+						query.close();
+					}
+				}
+			} finally {
+				db.close();
+			}
+		}
+		return maxLength;
+	}
+
 	public List<String> getNearestCityList() {
 		ArrayList<String> nearestCities = new ArrayList<>();
 		SQLiteConnection db = openConnection(false);
diff --git a/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java b/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java
index 252f8333284..fdd66344ad1 100644
--- a/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java
+++ b/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java
@@ -9,6 +9,7 @@
 
 import net.osmand.gpx.GPXTrackAnalysis;
 import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.configmap.tracks.TrackItem;
 import net.osmand.plus.track.GpxSplitType;
 import net.osmand.plus.track.data.GPXInfo;
 import net.osmand.plus.track.helpers.GPXDatabase.GpxDataItem;
@@ -222,6 +223,10 @@ public long getTracksMinCreateDate() {
 		return database.getTracksMinCreateDate();
 	}
 
+	public double getTracksMaxDuration() {
+		return database.getTracksMaxDuration();
+	}
+
 	@Nullable
 	public GpxDataItem getItem(@NonNull File file) {
 		return getItem(file, null);
@@ -287,6 +292,13 @@ public GPXDatabase getGPXDatabase() {
 	@Override
 	public void onGpxDataItemRead(@NonNull GpxDataItem item) {
 		putToCache(item);
+		putGpxDataItemToSmartFolder(item);
+	}
+
+	private void putGpxDataItemToSmartFolder(@NonNull GpxDataItem item) {
+		TrackItem trackItem = new TrackItem(item.getFile());
+		trackItem.setDataItem(item);
+		app.getSmartFolderHelper().addTrackItemToSmartFolder(trackItem);
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/widgets/OsmandTextFieldBoxes.java b/OsmAnd/src/net/osmand/plus/widgets/OsmandTextFieldBoxes.java
index 73528690d74..a42c6b2f018 100644
--- a/OsmAnd/src/net/osmand/plus/widgets/OsmandTextFieldBoxes.java
+++ b/OsmAnd/src/net/osmand/plus/widgets/OsmandTextFieldBoxes.java
@@ -4,6 +4,7 @@
 import android.graphics.drawable.Drawable;
 import android.util.AttributeSet;
 import android.view.View;
+import android.view.inputmethod.InputMethodManager;
 
 import net.osmand.plus.R;
 
@@ -23,6 +24,18 @@ public OsmandTextFieldBoxes(Context context, AttributeSet attrs, int defStyleAtt
 		super(context, attrs, defStyleAttr);
 	}
 
+	@Override
+	protected void onFinishInflate() {
+		super.onFinishInflate();
+		editText.setOnFocusChangeListener((view, hasFocus) -> {
+			setHasFocus(hasFocus);
+			if (hasFocus) {
+				inputMethodManager.showSoftInput(editText, InputMethodManager.SHOW_IMPLICIT);
+				performClick();
+			}
+		});
+	}
+
 	public void makeCompactPadding() {
 		floatingLabel.setVisibility(View.GONE);
 		labelSpace.setVisibility(View.GONE);
