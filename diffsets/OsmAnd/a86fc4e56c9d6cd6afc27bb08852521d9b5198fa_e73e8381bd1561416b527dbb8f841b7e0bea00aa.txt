diff --git a/OsmAnd/res/layout-land/map_hud_layout.xml b/OsmAnd/res/layout-land/map_hud_layout.xml
index 0bfdd79d7a4..58bae08bc37 100644
--- a/OsmAnd/res/layout-land/map_hud_layout.xml
+++ b/OsmAnd/res/layout-land/map_hud_layout.xml
@@ -42,7 +42,7 @@
 
 	</net.osmand.plus.views.controls.MapHudLayout>
 
-	<FrameLayout
+	<net.osmand.plus.views.ObservableFrameLayout
 		android:id="@+id/bottomFragmentContainer"
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content" />
diff --git a/OsmAnd/res/layout-sw600dp/map_hud_layout.xml b/OsmAnd/res/layout-sw600dp/map_hud_layout.xml
index 0bfdd79d7a4..58bae08bc37 100644
--- a/OsmAnd/res/layout-sw600dp/map_hud_layout.xml
+++ b/OsmAnd/res/layout-sw600dp/map_hud_layout.xml
@@ -42,7 +42,7 @@
 
 	</net.osmand.plus.views.controls.MapHudLayout>
 
-	<FrameLayout
+	<net.osmand.plus.views.ObservableFrameLayout
 		android:id="@+id/bottomFragmentContainer"
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content" />
diff --git a/OsmAnd/res/layout/map_hud_layout.xml b/OsmAnd/res/layout/map_hud_layout.xml
index 58c7e721e98..0b52027a4bd 100644
--- a/OsmAnd/res/layout/map_hud_layout.xml
+++ b/OsmAnd/res/layout/map_hud_layout.xml
@@ -34,7 +34,7 @@
 
 	</net.osmand.plus.views.controls.MapHudLayout>
 
-	<FrameLayout
+	<net.osmand.plus.views.ObservableFrameLayout
 		android:id="@+id/bottomFragmentContainer"
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content" />
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
index 1a8baf6a6be..0349f5a7e30 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
@@ -32,6 +32,7 @@
 import androidx.core.app.ActivityCompat;
 import androidx.core.content.ContextCompat;
 import androidx.core.view.GravityCompat;
+import androidx.core.view.WindowInsetsCompat;
 import androidx.drawerlayout.widget.DrawerLayout;
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentManager;
@@ -244,15 +245,10 @@ public void onCreate(Bundle savedInstanceState) {
 		// Navigation Drawer
 		AndroidUtils.addStatusBarPadding21v(this, findViewById(R.id.menuItems));
 
-		InsetsUtils.setWindowInsetsListener(findViewById(R.id.menuItems), (view, insets) -> {
-			InsetTargetsCollection targetsCollection = new InsetTargetsCollection();
-			targetsCollection.replace(InsetTarget.createCustomBuilder(view)
-					.portraitSides(InsetSide.TOP, InsetSide.BOTTOM).landscapeSides(InsetSide.TOP)
-					.applyPadding(true).build());
-			targetsCollection.replace(InsetTarget.createLeftSideContainer(true, true, view));
-
-			InsetsUtils.processInsets(view, targetsCollection, insets);
-		}, false);
+		View mapHudLayout = findViewById(R.id.map_hud_container);
+		if (InsetsUtils.isEdgeToEdgeSupported()) {
+			mapHudLayout.setFitsSystemWindows(false);
+		}
 
 		if (WhatsNewDialogFragment.shouldShowDialog(app)) {
 			boolean showed = WhatsNewDialogFragment.showInstance(getSupportFragmentManager());
@@ -334,6 +330,26 @@ public void onCreate(Bundle savedInstanceState) {
 		extendedMapActivity.onCreate(this, savedInstanceState);
 	}
 
+	protected int getRootViewId(){
+		return R.id.drawer_layout;
+	}
+
+	@Override
+	public InsetTargetsCollection getInsetTargets() {
+		InsetTargetsCollection collection = new InsetTargetsCollection();
+		collection.add(InsetTarget.createCustomBuilder(R.id.menuItems)
+				.portraitSides(InsetSide.TOP, InsetSide.BOTTOM).landscapeSides(InsetSide.TOP)
+				.applyPadding(true).build());
+		collection.add(InsetTarget.createLeftSideContainer(true, true, R.id.menuItems));
+
+		return collection;
+	}
+
+	@Override
+	public void onApplyInsets(@NonNull WindowInsetsCompat insets) {
+		getMapLayers().setWindowInsets(insets);
+	}
+
 	private void setMapInitialLatLon(@NonNull OsmandMapTileView mapView, @Nullable Location location) {
 		if (location != null) {
 			mapView.setLatLon(location.getLatitude(), location.getLongitude());
diff --git a/OsmAnd/src/net/osmand/plus/activities/OsmandActionBarActivity.java b/OsmAnd/src/net/osmand/plus/activities/OsmandActionBarActivity.java
index 33b01ce93a8..3378babb6cb 100644
--- a/OsmAnd/src/net/osmand/plus/activities/OsmandActionBarActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/OsmandActionBarActivity.java
@@ -37,7 +37,7 @@
 public class OsmandActionBarActivity extends OsmandInAppPurchaseActivity implements ISupportInsets {
 
 	private final List<ActivityResultListener> resultListeners = new ArrayList<>();
-
+	protected WindowInsetsCompat rootInsets;
 	@ColorRes
 	protected int getStatusBarColorId() {
 		boolean nightMode = app.getDaynightHelper().isNightMode(APP);
@@ -73,6 +73,10 @@ public void removeActivityResultListener(ActivityResultListener listener) {
 		resultListeners.remove(listener);
 	}
 
+	protected int getRootViewId(){
+		return R.id.root;
+	}
+
 	@Override
 	public void onContentChanged() {
 		super.onContentChanged();
@@ -80,7 +84,7 @@ public void onContentChanged() {
 		setupHomeButton();
 		updateStatusBarColor();
 
-		View root = findViewById(R.id.root);
+		View root = findViewById(getRootViewId());
 		if (root != null) {
 			InsetsUtils.processInsets(this, root, null, false);
 		}
@@ -171,11 +175,11 @@ public Activity requireActivity() {
 	@Nullable
 	@Override
 	public WindowInsetsCompat getLastRootInsets() {
-		return null;
+		return rootInsets;
 	}
 
 	@Override
 	public void setLastRootInsets(@NonNull WindowInsetsCompat rootInsets) {
-
+		this.rootInsets = rootInsets;
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
index 9dad96e9949..ddeaa1d32ca 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
@@ -88,6 +88,7 @@
 import net.osmand.plus.utils.*;
 import net.osmand.plus.utils.AndroidNetworkUtils.NetworkResult;
 import net.osmand.plus.utils.AndroidNetworkUtils.OnFileUploadCallback;
+import net.osmand.plus.utils.InsetTarget.Type;
 import net.osmand.plus.views.OsmandMapTileView;
 import net.osmand.plus.views.layers.MapControlsLayer.MapControlsThemeProvider;
 import net.osmand.plus.widgets.dialogbutton.DialogButtonType;
@@ -564,6 +565,14 @@ public void onSelectProfileIcon(int startPointPos) {
 		return view;
 	}
 
+	@Override
+	public InsetTargetsCollection getInsetTargets() {
+		InsetTargetsCollection collection = super.getInsetTargets();
+		collection.removeType(Type.ROOT_INSET);
+		collection.replace(InsetTarget.createBottomContainer(R.id.main_content).build());
+		return collection;
+	}
+
 	public OnBackPressedCallback getOnBackPressedCallback() {
 		return onBackPressedCallback;
 	}
diff --git a/OsmAnd/src/net/osmand/plus/utils/InsetsUtils.java b/OsmAnd/src/net/osmand/plus/utils/InsetsUtils.java
index e1be5eefa72..be33836a6bb 100644
--- a/OsmAnd/src/net/osmand/plus/utils/InsetsUtils.java
+++ b/OsmAnd/src/net/osmand/plus/utils/InsetsUtils.java
@@ -1,5 +1,7 @@
 package net.osmand.plus.utils;
 
+import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;
+import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_REVERSE_PORTRAIT;
 import static net.osmand.plus.helpers.AndroidUiHelper.processSystemBarScrims;
 
 import android.app.Activity;
@@ -171,7 +173,7 @@ public static void processInsets(@NonNull ISupportInsets insetSupportedFragment,
 		}, consume);
 	}
 
-	public static void processInsets(View root, InsetTargetsCollection collection, @NonNull WindowInsetsCompat insets) {
+	public static void processInsets(@NonNull View root, @NonNull InsetTargetsCollection collection, @NonNull WindowInsetsCompat insets) {
 		for (InsetTarget target : collection.getAll()) {
 			if (Objects.requireNonNull(target.getType()) == Type.COLLAPSING_APPBAR) {
 				applyAppBarWithCollapseInsets(root, target, insets, collection);
@@ -208,10 +210,6 @@ private static void applyRootInsetsPaddings(View root, InsetTarget target, Windo
 		}
 	}
 
-	public static boolean isLandscape(Context context) {
-		return context.getResources().getConfiguration().orientation == Configuration.ORIENTATION_LANDSCAPE;
-	}
-
 	private static void applyCustomInsets(View root, InsetTarget target, WindowInsetsCompat insets) {
 		for (View view : resolveViews(root, target)) {
 			if (view != null) {
@@ -389,6 +387,11 @@ private static void applyClipPadding(View view) {
 		}
 	}
 
+	public static boolean isLandscape(Context context) {
+		int orientation = context.getResources().getConfiguration().orientation;
+		return !(orientation  == SCREEN_ORIENTATION_PORTRAIT || orientation == SCREEN_ORIENTATION_REVERSE_PORTRAIT);
+	}
+
 	private static List<View> resolveViews(View root, InsetTarget target) {
 		List<View> result = new ArrayList<>();
 		if (target.getViews() != null) {
diff --git a/OsmAnd/src/net/osmand/plus/views/MapLayers.java b/OsmAnd/src/net/osmand/plus/views/MapLayers.java
index 1d3d3f7b565..0a128a2487d 100644
--- a/OsmAnd/src/net/osmand/plus/views/MapLayers.java
+++ b/OsmAnd/src/net/osmand/plus/views/MapLayers.java
@@ -10,6 +10,7 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.appcompat.app.AlertDialog;
+import androidx.core.view.WindowInsetsCompat;
 
 import net.osmand.CallbackWithObject;
 import net.osmand.IndexConstants;
@@ -248,6 +249,13 @@ public boolean hasMapActivity() {
 		return false;
 	}
 
+	public void setWindowInsets(@NonNull WindowInsetsCompat windowInsets) {
+		OsmandMapTileView mapView = app.getOsmandMap().getMapView();
+		for (OsmandMapLayer layer : mapView.getLayers()) {
+			layer.setWindowInsets(windowInsets);
+		}
+	}
+
 	public void updateLayers(@Nullable MapActivity mapActivity) {
 		OsmandSettings settings = app.getSettings();
 		OsmandMapTileView mapView = app.getOsmandMap().getMapView();
diff --git a/OsmAnd/src/net/osmand/plus/views/ObservableFrameLayout.kt b/OsmAnd/src/net/osmand/plus/views/ObservableFrameLayout.kt
new file mode 100644
index 00000000000..c24bdbdfe09
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/views/ObservableFrameLayout.kt
@@ -0,0 +1,24 @@
+package net.osmand.plus.views
+
+import android.content.Context
+import android.util.AttributeSet
+import android.view.View
+import android.widget.FrameLayout
+import androidx.core.view.isNotEmpty
+
+class ObservableFrameLayout @JvmOverloads constructor(
+    context: Context, attrs: AttributeSet? = null
+) : FrameLayout(context, attrs) {
+
+    var onChildChanged: ((hasChild: Boolean) -> Unit)? = null
+
+    override fun onViewAdded(child: View?) {
+        super.onViewAdded(child)
+        onChildChanged?.invoke(isNotEmpty())
+    }
+
+    override fun onViewRemoved(child: View?) {
+        super.onViewRemoved(child)
+        onChildChanged?.invoke(isNotEmpty())
+    }
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/controls/VerticalWidgetPanel.java b/OsmAnd/src/net/osmand/plus/views/controls/VerticalWidgetPanel.java
index d573a5825e0..912927faa52 100644
--- a/OsmAnd/src/net/osmand/plus/views/controls/VerticalWidgetPanel.java
+++ b/OsmAnd/src/net/osmand/plus/views/controls/VerticalWidgetPanel.java
@@ -2,6 +2,7 @@
 
 import android.content.Context;
 import android.content.res.TypedArray;
+import android.graphics.Color;
 import android.util.AttributeSet;
 import android.view.View;
 import android.view.ViewGroup;
@@ -23,6 +24,8 @@
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.enums.ThemeUsageContext;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.InsetsUtils;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.layers.MapInfoLayer.TextState;
 import net.osmand.plus.views.layers.base.OsmandMapLayer.DrawSettings;
@@ -41,6 +44,8 @@
 
 public class VerticalWidgetPanel extends LinearLayoutEx implements WidgetsContainer {
 
+	private final List<VerticalPanelVisibilityListener> visibilityListeners = new ArrayList<>();
+
 	private final OsmandApplication app;
 	private final OsmandSettings settings;
 	private final MapWidgetRegistry widgetRegistry;
@@ -94,7 +99,17 @@ private void init() {
 		updateRows();
 	}
 
-	private boolean isAnyRowVisible() {
+	public void addVisibilityListener(@Nullable VerticalPanelVisibilityListener listener) {
+		if (!visibilityListeners.contains(listener)) {
+			visibilityListeners.add(listener);
+		}
+	}
+
+	public void removeVisibilityListener(@Nullable VerticalPanelVisibilityListener listener) {
+		visibilityListeners.remove(listener);
+	}
+
+	public boolean isAnyRowVisible() {
 		for (Row row : visibleRows) {
 			if (row.isAnyWidgetVisible()) {
 				return true;
@@ -111,7 +126,20 @@ private void applyShadow() {
 	}
 
 	private void updateVisibility() {
-		AndroidUiHelper.updateVisibility(this, isAnyRowVisible());
+		boolean isAnyRowVisible = isAnyRowVisible();
+		AndroidUiHelper.updateVisibility(this, isAnyRowVisible);
+
+		for (VerticalPanelVisibilityListener listener : visibilityListeners) {
+			listener.isVisible(isAnyRowVisible);
+		}
+		if (InsetsUtils.isEdgeToEdgeSupported() && !topPanel) {
+			boolean isTransparentWidgets = app.getSettings().TRANSPARENT_MAP_THEME.get();
+			if (isAnyRowVisible && !isTransparentWidgets) {
+				setBackgroundColor(ColorUtilities.getWidgetBackgroundColor(app, nightMode));
+			} else {
+				setBackgroundColor(Color.TRANSPARENT);
+			}
+		}
 	}
 
 	public void update(@Nullable DrawSettings drawSettings) {
@@ -467,4 +495,8 @@ public boolean areContentsTheSame(int oldItemPosition, int newItemPosition) {
 			return Algorithms.objectEquals(oldMapWidgets, newMapWidgets);
 		}
 	}
+
+	public interface VerticalPanelVisibilityListener {
+		void isVisible(boolean isVisible);
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
index 2e97849def7..51cd1afc887 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
@@ -13,6 +13,7 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.core.content.ContextCompat;
+import androidx.core.view.WindowInsetsCompat;
 
 import net.osmand.data.RotatedTileBox;
 import net.osmand.plus.OsmandApplication;
@@ -27,10 +28,17 @@
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.InsetTarget;
+import net.osmand.plus.utils.InsetTarget.InsetTargetBuilder;
+import net.osmand.plus.utils.InsetTargetsCollection;
+import net.osmand.plus.utils.InsetsUtils;
+import net.osmand.plus.utils.InsetsUtils.InsetSide;
 import net.osmand.plus.views.MapLayers;
+import net.osmand.plus.views.ObservableFrameLayout;
 import net.osmand.plus.views.controls.MapHudLayout;
 import net.osmand.plus.views.controls.SideWidgetsPanel;
 import net.osmand.plus.views.controls.VerticalWidgetPanel;
+import net.osmand.plus.views.controls.VerticalWidgetPanel.VerticalPanelVisibilityListener;
 import net.osmand.plus.views.controls.WidgetsContainer;
 import net.osmand.plus.views.layers.base.OsmandMapLayer;
 import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
@@ -49,6 +57,9 @@
 import java.util.ArrayList;
 import java.util.List;
 
+import kotlin.Unit;
+import kotlin.jvm.functions.Function1;
+
 public class MapInfoLayer extends OsmandMapLayer implements ICoveredScreenRectProvider {
 
 	private final RouteLayer routeLayer;
@@ -71,6 +82,7 @@ public class MapInfoLayer extends OsmandMapLayer implements ICoveredScreenRectPr
 	private List<WidgetsContainer> additionalWidgets;
 
 	private AndroidAutoMapPlaceholderView androidAutoMapPlaceholderView;
+	private ObservableFrameLayout bottomFragmentContainer;
 
 	private DrawSettings drawSettings;
 	private int themeId = -1;
@@ -79,6 +91,10 @@ public class MapInfoLayer extends OsmandMapLayer implements ICoveredScreenRectPr
 
 	private final BoundsChangeListener topPanelBoundsChangeListener;
 	private final BoundsChangeListener bottomPanelBoundsChangeListener;
+	private VerticalPanelVisibilityListener bottomWidgetsVisibilityListener;
+	private WindowInsetsCompat lastWindowInsets;
+
+	private boolean isContentVisible = false;
 
 	public MapInfoLayer(@NonNull Context context, @NonNull RouteLayer layer) {
 		super(context);
@@ -103,10 +119,13 @@ public void setMapActivity(@Nullable MapActivity mapActivity) {
 			rightWidgetsPanel = mapActivity.findViewById(R.id.map_right_widgets_panel);
 			bottomWidgetsPanel = mapActivity.findViewById(R.id.map_bottom_widgets_panel);
 			androidAutoMapPlaceholderView = mapActivity.findViewById(R.id.AndroidAutoPlaceholder);
+			bottomFragmentContainer = mapActivity.findViewById(R.id.bottomFragmentContainer);
 
 			leftWidgetsPanel.setScreenWidth(mapActivity);
 			rightWidgetsPanel.setScreenWidth(mapActivity);
 
+			registerInsetListeners();
+
 			LayoutInflater inflater = mapActivity.getLayoutInflater();
 			rulerWidget = (RulerWidget) inflater.inflate(R.layout.map_ruler, mapHudLayout, false);
 			mapHudLayout.addWidget(rulerWidget);
@@ -124,10 +143,16 @@ public void setMapActivity(@Nullable MapActivity mapActivity) {
 			}
 			if (bottomWidgetsPanel != null) {
 				bottomWidgetsPanel.removeOnLayoutChangeListener(bottomPanelBoundsChangeListener);
+				bottomWidgetsPanel.removeVisibilityListener(bottomWidgetsVisibilityListener);
 			}
 			if (mapHudLayout != null) {
 				mapHudLayout.removeWidget(rulerWidget);
 			}
+
+			if (bottomFragmentContainer != null) {
+				bottomFragmentContainer.setOnChildChanged(null);
+			}
+
 			mapDisplayPositionManager.unregisterCoveredScreenRectProvider(this);
 			mapDisplayPositionManager.updateMapDisplayPosition(true);
 
@@ -141,6 +166,7 @@ public void setMapActivity(@Nullable MapActivity mapActivity) {
 			rightWidgetsPanel = null;
 			rulerWidget = null;
 			androidAutoMapPlaceholderView = null;
+			bottomFragmentContainer = null;
 
 			drawSettings = null;
 			alarmWidget = null;
@@ -149,9 +175,69 @@ public void setMapActivity(@Nullable MapActivity mapActivity) {
 			sideWidgetsPanels = null;
 			additionalWidgets = null;
 			topToolbarView = null;
+			lastWindowInsets = null;
 		}
 	}
 
+	private void onBottomWidgetPanelChanged(boolean isVisible) {
+		if (bottomFragmentContainer != null) {
+			boolean bottomFragmentVisible = bottomFragmentContainer.getChildCount() > 0;
+			if (bottomFragmentVisible) {
+				isVisible = true;
+			}
+		}
+		updateLayerInsets(isVisible, false);
+	}
+
+	private void updateLayerInsets(boolean isVisible, boolean forceUpdate) {
+		if (!forceUpdate && (!InsetsUtils.isEdgeToEdgeSupported() || isContentVisible == isVisible)) {
+			return;
+		}
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity == null || lastWindowInsets == null) {
+			return;
+		}
+		InsetTargetsCollection targetsCollection = new InsetTargetsCollection();
+		InsetTargetBuilder mapHudLayoutBuilder = InsetTarget.createCustomBuilder(mapHudLayout).applyPadding(true);
+
+		if (isVisible) {
+			targetsCollection.add(InsetTarget.createCustomBuilder(bottomWidgetsPanel)
+					.portraitSides(InsetSide.BOTTOM)
+					.landscapeSides(InsetSide.BOTTOM)
+					.applyPadding(true).build());
+
+			mapHudLayoutBuilder.portraitSides(InsetSide.TOP, InsetSide.RESET)
+					.landscapeSides(InsetSide.TOP, InsetSide.BOTTOM, InsetSide.LEFT, InsetSide.RIGHT);
+		} else {
+			mapHudLayoutBuilder.portraitSides(InsetSide.TOP, InsetSide.BOTTOM, InsetSide.RESET)
+					.landscapeSides(InsetSide.TOP, InsetSide.BOTTOM, InsetSide.LEFT, InsetSide.RIGHT);
+		}
+		targetsCollection.add(mapHudLayoutBuilder);
+		InsetsUtils.processInsets(mapActivity.findViewById(R.id.map_hud_container), targetsCollection, lastWindowInsets);
+		isContentVisible = isVisible;
+	}
+
+	@Override
+	public void setWindowInsets(@NonNull WindowInsetsCompat windowInsets) {
+		super.setWindowInsets(windowInsets);
+		this.lastWindowInsets = windowInsets;
+		updateLayerInsets(bottomWidgetsPanel.isAnyRowVisible(), true);
+	}
+
+	private void registerInsetListeners() {
+		if (!InsetsUtils.isEdgeToEdgeSupported()) {
+			return;
+		}
+		bottomFragmentContainer.setOnChildChanged(hasChild -> {
+			if (bottomFragmentContainer != null) {
+				updateLayerInsets(hasChild, true);
+			}
+			return Unit.INSTANCE;
+		});
+		bottomWidgetsVisibilityListener = this::onBottomWidgetPanelChanged;
+		bottomWidgetsPanel.addVisibilityListener(bottomWidgetsVisibilityListener);
+	}
+
 	@Nullable
 	public TopToolbarView getTopToolbarView() {
 		return topToolbarView;
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/base/OsmandMapLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/base/OsmandMapLayer.java
index 81141f92e0b..ece53ccff24 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/base/OsmandMapLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/base/OsmandMapLayer.java
@@ -20,6 +20,7 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.annotation.StringRes;
+import androidx.core.view.WindowInsetsCompat;
 
 import net.osmand.PlatformUtil;
 import net.osmand.core.android.MapRendererView;
@@ -199,6 +200,9 @@ public void setMapRendererChanged(boolean mapRendererChanged) {
 		this.mapRendererChanged = mapRendererChanged;
 	}
 
+	public void setWindowInsets(@NonNull WindowInsetsCompat windowInsets) {
+	}
+
 	@NonNull
 	public MapActivity requireMapActivity() {
 		MapActivity mapActivity = getMapActivity();
