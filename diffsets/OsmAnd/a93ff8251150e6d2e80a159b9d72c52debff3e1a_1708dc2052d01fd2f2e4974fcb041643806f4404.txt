diff --git a/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
index 2c733c4b246..e0c456faad4 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
@@ -550,10 +550,10 @@ public AudioVideoNotesPlugin(OsmandApplication app) {
 		super(app);
 
 		ApplicationMode[] noAppMode = {};
-		ApplicationMode.regWidgetVisibility(AV_NOTES_ON_REQUEST.id, noAppMode);
-		ApplicationMode.regWidgetVisibility(AV_NOTES_RECORD_AUDIO.id, noAppMode);
-		ApplicationMode.regWidgetVisibility(AV_NOTES_RECORD_VIDEO.id, noAppMode);
-		ApplicationMode.regWidgetVisibility(AV_NOTES_TAKE_PHOTO.id, noAppMode);
+		ApplicationMode.regWidgetVisibility(AV_NOTES_ON_REQUEST, noAppMode);
+		ApplicationMode.regWidgetVisibility(AV_NOTES_RECORD_AUDIO, noAppMode);
+		ApplicationMode.regWidgetVisibility(AV_NOTES_RECORD_VIDEO, noAppMode);
+		ApplicationMode.regWidgetVisibility(AV_NOTES_TAKE_PHOTO, noAppMode);
 
 		AV_EXTERNAL_RECORDER = registerBooleanPreference("av_external_recorder", false);
 		AV_EXTERNAL_PHOTO_CAM = registerBooleanPreference("av_external_cam", true);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java
index 3c3a8308e08..988f9772eb8 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/OsmandMonitoringPlugin.java
@@ -99,7 +99,7 @@ public OsmandMonitoringPlugin(OsmandApplication app) {
 	private void registerWidgetsVisibility() {
 		for (WidgetType widget : WidgetGroup.TRIP_RECORDING.getWidgets()) {
 			ApplicationMode[] appModes = widget == TRIP_RECORDING_DISTANCE ? null : new ApplicationMode[] {};
-			ApplicationMode.regWidgetVisibility(widget.id, appModes);
+			ApplicationMode.regWidgetVisibility(widget, appModes);
 		}
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java
index f1e6748b536..4761a7c11b0 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/parking/ParkingPositionPlugin.java
@@ -79,7 +79,7 @@ public class ParkingPositionPlugin extends OsmandPlugin {
 	public ParkingPositionPlugin(OsmandApplication app) {
 		super(app);
 		OsmandSettings set = app.getSettings();
-		ApplicationMode.regWidgetVisibility(PARKING.id, (ApplicationMode[]) null);
+		ApplicationMode.regWidgetVisibility(PARKING, (ApplicationMode[]) null);
 		parkingLat = set.registerFloatPreference(PARKING_POINT_LAT, 0f).makeGlobal().makeShared();
 		parkingLon = set.registerFloatPreference(PARKING_POINT_LON, 0f).makeGlobal().makeShared();
 		parkingType = set.registerBooleanPreference(PARKING_TYPE, false).makeGlobal().makeShared();
diff --git a/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java b/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java
index 459848d3eb8..4082a6a469e 100644
--- a/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java
+++ b/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java
@@ -198,44 +198,51 @@ private static void initRegVisibility() {
 		ApplicationMode[] navigationSet1 = {CAR, BICYCLE, BOAT, SKI, TRUCK, MOTORCYCLE, HORSE};
 		ApplicationMode[] navigationSet2 = {PEDESTRIAN, PUBLIC_TRANSPORT, AIRCRAFT};
 
-		regWidgetVisibility(NEXT_TURN.id, navigationSet1);
-		regWidgetVisibility(SMALL_NEXT_TURN.id, navigationSet2);
-		regWidgetVisibility(SECOND_NEXT_TURN.id, navigationSet1);
-		regWidgetAvailability(NEXT_TURN.id, exceptDefault);
-		regWidgetAvailability(SMALL_NEXT_TURN.id, exceptDefault);
-		regWidgetAvailability(SECOND_NEXT_TURN.id, exceptDefault);
+		regWidgetVisibility(NEXT_TURN, navigationSet1);
+		regWidgetVisibility(SMALL_NEXT_TURN, navigationSet2);
+		regWidgetVisibility(SECOND_NEXT_TURN, navigationSet1);
+		regWidgetAvailability(NEXT_TURN, exceptDefault);
+		regWidgetAvailability(SMALL_NEXT_TURN, exceptDefault);
+		regWidgetAvailability(SECOND_NEXT_TURN, exceptDefault);
 
 		// right
-		regWidgetVisibility(INTERMEDIATE_DESTINATION.id, all);
-		regWidgetVisibility(DISTANCE_TO_DESTINATION.id, all);
-		regWidgetVisibility(TIME_TO_INTERMEDIATE.id, all);
-		regWidgetVisibility(TIME_TO_DESTINATION.id, all);
-		regWidgetVisibility(CURRENT_SPEED.id, CAR, BICYCLE, BOAT, SKI, PUBLIC_TRANSPORT, AIRCRAFT, TRUCK,
+		regWidgetVisibility(INTERMEDIATE_DESTINATION, all);
+		regWidgetVisibility(DISTANCE_TO_DESTINATION, all);
+		regWidgetVisibility(TIME_TO_INTERMEDIATE, all);
+		regWidgetVisibility(TIME_TO_DESTINATION, all);
+		regWidgetVisibility(CURRENT_SPEED, CAR, BICYCLE, BOAT, SKI, PUBLIC_TRANSPORT, AIRCRAFT, TRUCK,
 				MOTORCYCLE, HORSE);
-		regWidgetVisibility(MAX_SPEED.id, CAR, TRUCK, MOTORCYCLE);
-		regWidgetVisibility(ALTITUDE.id, PEDESTRIAN, BICYCLE);
-		regWidgetAvailability(INTERMEDIATE_DESTINATION.id, all);
-		regWidgetAvailability(DISTANCE_TO_DESTINATION.id, all);
-		regWidgetAvailability(TIME_TO_INTERMEDIATE.id, all);
-		regWidgetAvailability(TIME_TO_DESTINATION.id, all);
-		regWidgetAvailability(CURRENT_SPEED.id, all);
-		regWidgetAvailability(MAX_SPEED.id, all);
-		regWidgetAvailability(AVERAGE_SPEED.id, all);
-		regWidgetAvailability(ALTITUDE.id, all);
+		regWidgetVisibility(MAX_SPEED, CAR, TRUCK, MOTORCYCLE);
+		regWidgetVisibility(ALTITUDE, PEDESTRIAN, BICYCLE);
+		regWidgetAvailability(INTERMEDIATE_DESTINATION, all);
+		regWidgetAvailability(DISTANCE_TO_DESTINATION, all);
+		regWidgetAvailability(TIME_TO_INTERMEDIATE, all);
+		regWidgetAvailability(TIME_TO_DESTINATION, all);
+		regWidgetAvailability(CURRENT_SPEED, all);
+		regWidgetAvailability(MAX_SPEED, all);
+		regWidgetAvailability(AVERAGE_SPEED, all);
+		regWidgetAvailability(ALTITUDE, all);
 
 		// all = null everything
-		regWidgetAvailability(SIDE_MARKER_1.id, all);
-		regWidgetAvailability(SIDE_MARKER_2.id, all);
-		regWidgetAvailability(GPS_INFO.id, all);
-		regWidgetAvailability(BATTERY.id, all);
-		regWidgetAvailability(RELATIVE_BEARING.id, all);
-		regWidgetAvailability(MAGNETIC_BEARING.id, all);
-		regWidgetAvailability(TRUE_BEARING.id, all);
-		regWidgetAvailability(RADIUS_RULER.id, all);
-		regWidgetAvailability(CURRENT_TIME.id, all);
+		regWidgetAvailability(SIDE_MARKER_1, all);
+		regWidgetAvailability(SIDE_MARKER_2, all);
+		regWidgetAvailability(GPS_INFO, all);
+		regWidgetAvailability(BATTERY, all);
+		regWidgetAvailability(RELATIVE_BEARING, all);
+		regWidgetAvailability(MAGNETIC_BEARING, all);
+		regWidgetAvailability(TRUE_BEARING, all);
+		regWidgetAvailability(RADIUS_RULER, all);
+		regWidgetAvailability(CURRENT_TIME, all);
+	}
+
+	@NonNull
+	public static Set<ApplicationMode> regWidgetVisibility(@NonNull WidgetType widgetType,
+	                                                       @Nullable ApplicationMode... appModes) {
+		return regWidgetVisibility(widgetType.id, appModes);
 	}
 
 	// returns modifiable ! Set<ApplicationMode> to exclude non-wanted derived
+	@NonNull
 	public static Set<ApplicationMode> regWidgetVisibility(@NonNull String widgetId,
 	                                                       @Nullable ApplicationMode... appModes) {
 		HashSet<ApplicationMode> set = new HashSet<>();
@@ -262,6 +269,13 @@ public boolean isWidgetVisibleByDefault(@NonNull String widgetId) {
 		return widgetsVisibility != null && widgetsVisibility.contains(this);
 	}
 
+	@NonNull
+	public static Set<ApplicationMode> regWidgetAvailability(@NonNull WidgetType widgetType,
+	                                                         @Nullable ApplicationMode... appModes) {
+		return regWidgetAvailability(widgetType.id, appModes);
+	}
+
+	@NonNull
 	public static Set<ApplicationMode> regWidgetAvailability(@NonNull String widgetId,
 	                                                         @Nullable ApplicationMode... appModes) {
 		HashSet<ApplicationMode> set = new HashSet<>();
@@ -280,11 +294,10 @@ public static Set<ApplicationMode> regWidgetAvailability(@NonNull String widgetI
 		return set;
 	}
 
-	public boolean isWidgetAvailable(String widgetId) {
+	public boolean isWidgetAvailable(@NonNull String widgetId) {
 		if (app.getAppCustomization().areWidgetsCustomized()) {
 			return app.getAppCustomization().isWidgetAvailable(widgetId, this);
 		}
-
 		String defaultWidgetId = WidgetType.getDefaultWidgetId(widgetId);
 		Set<ApplicationMode> availableForModes = widgetsAvailabilityMap.get(defaultWidgetId);
 		return availableForModes == null || availableForModes.contains(this);
diff --git a/OsmAnd/src/net/osmand/plus/settings/backend/OsmAndAppCustomization.java b/OsmAnd/src/net/osmand/plus/settings/backend/OsmAndAppCustomization.java
index 41b31c08acd..1eda13608fa 100644
--- a/OsmAnd/src/net/osmand/plus/settings/backend/OsmAndAppCustomization.java
+++ b/OsmAnd/src/net/osmand/plus/settings/backend/OsmAndAppCustomization.java
@@ -343,6 +343,7 @@ public void setFeaturesDisabledPatterns(@NonNull Collection<String> patterns) {
 		setFeaturesCustomized();
 	}
 
+	@NonNull
 	public Set<ApplicationMode> regWidgetVisibility(@NonNull String widgetId, @Nullable List<String> appModeKeys) {
 		HashSet<ApplicationMode> set = getAppModesSet(appModeKeys);
 		widgetsVisibilityMap.put(widgetId, set);
@@ -350,6 +351,7 @@ public Set<ApplicationMode> regWidgetVisibility(@NonNull String widgetId, @Nulla
 		return set;
 	}
 
+	@NonNull
 	public Set<ApplicationMode> regWidgetAvailability(@NonNull String widgetId, @Nullable List<String> appModeKeys) {
 		HashSet<ApplicationMode> set = getAppModesSet(appModeKeys);
 		widgetsAvailabilityMap.put(widgetId, set);
@@ -357,7 +359,7 @@ public Set<ApplicationMode> regWidgetAvailability(@NonNull String widgetId, @Nul
 		return set;
 	}
 
-	public void setMapMargins(int left, int top, int right, int bottom, List<String> appModeKeys) {
+	public void setMapMargins(int left, int top, int right, int bottom, @Nullable List<String> appModeKeys) {
 		marginLeft = left;
 		marginTop = top;
 		marginRight = right;
@@ -365,7 +367,7 @@ public void setMapMargins(int left, int top, int right, int bottom, List<String>
 		marginAppModeUsage.addAll(getAppModesSet(appModeKeys));
 	}
 
-	public void updateMapMargins(MapActivity mapActivity) {
+	public void updateMapMargins(@NonNull MapActivity mapActivity) {
 		if (isMapMarginAvailable()) {
 			mapActivity.setMargins(marginLeft, marginTop, marginRight, marginBottom);
 		} else {
@@ -377,7 +379,7 @@ boolean isMapMarginAvailable() {
 		return marginAppModeUsage.contains(app.getSettings().getApplicationMode());
 	}
 
-	public boolean isWidgetVisible(@NonNull String key, ApplicationMode appMode) {
+	public boolean isWidgetVisible(@NonNull String key, @NonNull ApplicationMode appMode) {
 		Set<ApplicationMode> set = widgetsVisibilityMap.get(key);
 		if (set == null) {
 			return false;
@@ -385,7 +387,7 @@ public boolean isWidgetVisible(@NonNull String key, ApplicationMode appMode) {
 		return set.contains(appMode);
 	}
 
-	public boolean isWidgetAvailable(@NonNull String widgetId, ApplicationMode appMode) {
+	public boolean isWidgetAvailable(@NonNull String widgetId, @NonNull ApplicationMode appMode) {
 		Set<ApplicationMode> availableForModes = widgetsAvailabilityMap.get(widgetId);
 		if (availableForModes == null) {
 			return true;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
index bb082006fe4..fc8f2838aff 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
@@ -100,6 +100,10 @@ public WidgetType getWidgetType() {
 		return widget.getWidgetType();
 	}
 
+	public boolean isExternal() {
+		return widget.isExternal();
+	}
+
 	@NonNull
 	public String getTitle(@NonNull Context ctx) {
 		String message = getMessage();
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
index 083e671dfc5..f2ac27d9a9e 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
@@ -186,10 +186,10 @@ public void removeWidgetsRegistryListener(@NonNull WidgetsRegistryListener liste
 		this.listeners = listeners;
 	}
 
-	private void notifyWidgetRegistered(@NonNull MapWidgetInfo widgetInfo, @Nullable WidgetType widgetType) {
+	private void notifyWidgetRegistered(@NonNull MapWidgetInfo widgetInfo) {
 		if (!Algorithms.isEmpty(listeners)) {
 			for (WidgetsRegistryListener listener : listeners) {
-				listener.onWidgetRegistered(widgetInfo, widgetType);
+				listener.onWidgetRegistered(widgetInfo);
 			}
 		}
 	}
@@ -357,7 +357,7 @@ public int getStatusBarColorForTopWidget(boolean night) {
 
 	public void registerWidget(@NonNull MapWidgetInfo widgetInfo) {
 		getWidgetsForPanel(widgetInfo.widgetPanel).add(widgetInfo);
-		notifyWidgetRegistered(widgetInfo, WidgetType.getById(widgetInfo.key));
+		notifyWidgetRegistered(widgetInfo);
 	}
 
 	public void registerAllControls(@NonNull MapActivity mapActivity) {
@@ -365,10 +365,11 @@ public void registerAllControls(@NonNull MapActivity mapActivity) {
 		reorderWidgets(widgetInfos);
 
 		for (MapWidgetInfo widgetInfo : widgetInfos) {
-			notifyWidgetRegistered(widgetInfo, WidgetType.getById(widgetInfo.key));
+			notifyWidgetRegistered(widgetInfo);
 		}
 	}
 
+	@NonNull
 	public List<MapWidgetInfo> createAllControls(@NonNull MapActivity mapActivity, @NonNull ApplicationMode appMode) {
 		List<MapWidgetInfo> widgetInfos = new ArrayList<>();
 		MapWidgetsFactory widgetsFactory = new MapWidgetsFactory(mapActivity);
@@ -440,10 +441,11 @@ public MapWidgetInfo createWidgetInfo(@NonNull MapWidget widget) {
 	public MapWidgetInfo createWidgetInfo(@NonNull MapWidget widget, @NonNull ApplicationMode appMode) {
 		WidgetType widgetType = widget.getWidgetType();
 		if (widgetType != null) {
-			WidgetsPanel panel = widgetType.getPanel(widgetType.id, appMode, settings);
-			int page = panel.getWidgetPage(appMode, widgetType.id, settings);
-			int order = panel.getWidgetOrder(appMode, widgetType.id, settings);
-			return createWidgetInfo(widgetType.id, widget, widgetType.dayIconId, widgetType.nightIconId,
+			String widgetId = widgetType.id;
+			WidgetsPanel panel = widgetType.getPanel(widgetId, appMode, settings);
+			int page = panel.getWidgetPage(appMode, widgetId, settings);
+			int order = panel.getWidgetOrder(appMode, widgetId, settings);
+			return createWidgetInfo(widgetId, widget, widgetType.dayIconId, widgetType.nightIconId,
 					widgetType.titleId, null, page, order, panel);
 		}
 		return null;
@@ -539,7 +541,7 @@ private WidgetsPanel getExternalWidgetPanel(@NonNull String widgetId,
 	}
 
 	public interface WidgetsRegistryListener {
-		void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo, @Nullable WidgetType widgetType);
+		void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo);
 
 		void onWidgetVisibilityChanged(@NonNull MapWidgetInfo widgetInfo);
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java
index 8be00759133..2be28c48454 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java
@@ -83,7 +83,8 @@ public void clearListeners() {
 	}
 
 	@Override
-	public void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo, @Nullable WidgetType widgetType) {
+	public void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo) {
+		WidgetType widgetType = widgetInfo.getWidgetType();
 		if (isMarkerWidget(widgetType) && widgetInfo.isEnabledForAppMode(settings.getApplicationMode())) {
 			addWidget(widgetInfo, widgetType);
 		}
@@ -91,7 +92,7 @@ public void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo, @Nullable Widg
 
 	@Override
 	public void onWidgetVisibilityChanged(@NonNull MapWidgetInfo widgetInfo) {
-		WidgetType widgetType = widgetInfo.widget.getWidgetType();
+		WidgetType widgetType = widgetInfo.getWidgetType();
 		if (isMarkerWidget(widgetType)) {
 			if (widgetInfo.isEnabledForAppMode(settings.getApplicationMode())) {
 				addWidget(widgetInfo, widgetType);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java
index e8d5e3915fc..b73d31dfa07 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java
@@ -17,7 +17,6 @@
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.COLLAPSED_PREFIX;
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.HIDE_PREFIX;
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.SETTINGS_SEPARATOR;
-import static net.osmand.plus.views.mapwidgets.WidgetsPanel.DEFAULT_ORDER;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.LEFT;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.RIGHT;
 
@@ -56,19 +55,17 @@ public String getExternalProviderPackage() {
 	@Override
 	public WidgetsPanel getUpdatedPanel() {
 		OsmandSettings settings = widget.getMyApplication().getSettings();
-		WidgetType widgetType = WidgetType.getById(key);
+		WidgetType widgetType = getWidgetType();
 		if (widgetType != null) {
-			if (widgetType.defaultPanel == LEFT
-					&& RIGHT.getWidgetOrder(key, settings) != DEFAULT_ORDER) {
+			if (widgetType.defaultPanel == LEFT && RIGHT.contains(key, settings)) {
 				widgetPanel = RIGHT;
-			} else if (widgetType.defaultPanel == RIGHT
-					&& LEFT.getWidgetOrder(key, settings) != DEFAULT_ORDER) {
+			} else if (widgetType.defaultPanel == RIGHT && LEFT.contains(key, settings)) {
 				widgetPanel = LEFT;
 			} else {
 				widgetPanel = widgetType.defaultPanel;
 			}
 		} else {
-			widgetPanel = LEFT.getWidgetOrder(key, settings) != DEFAULT_ORDER ? LEFT : RIGHT;
+			widgetPanel = LEFT.contains(key, settings) ? LEFT : RIGHT;
 		}
 		return widgetPanel;
 	}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
index 03499685e84..f4668a4be97 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetType.java
@@ -23,7 +23,6 @@
 
 import static net.osmand.plus.views.mapwidgets.MapWidgetInfo.DELIMITER;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.BOTTOM;
-import static net.osmand.plus.views.mapwidgets.WidgetsPanel.DEFAULT_ORDER;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.LEFT;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.RIGHT;
 import static net.osmand.plus.views.mapwidgets.WidgetsPanel.TOP;
@@ -182,9 +181,9 @@ public WidgetsPanel getPanel(@NonNull String widgetId, @NonNull ApplicationMode
 		if (defaultPanel == TOP || defaultPanel == BOTTOM) {
 			return defaultPanel;
 		} else if (defaultPanel == LEFT) {
-			return RIGHT.getWidgetOrder(mode, widgetId, settings) != DEFAULT_ORDER ? RIGHT : LEFT;
+			return RIGHT.contains(widgetId, settings, mode) ? RIGHT : LEFT;
 		} else if (defaultPanel == RIGHT) {
-			return LEFT.getWidgetOrder(mode, widgetId, settings) != DEFAULT_ORDER ? LEFT : RIGHT;
+			return LEFT.contains(widgetId, settings, mode) ? LEFT : RIGHT;
 		}
 		throw new IllegalStateException("Unsupported panel");
 	}
@@ -229,10 +228,12 @@ public static boolean isOriginalWidget(@NonNull String widgetId) {
 	@NonNull
 	public static String getDefaultWidgetId(@NonNull String widgetId) {
 		int index = widgetId.indexOf(DELIMITER);
-		if (index != -1) {
-			widgetId = widgetId.substring(0, index);
-		}
-		return widgetId;
+		return index != -1 ? widgetId.substring(0, index) : widgetId;
+	}
+
+	@NonNull
+	public static String getDuplicateWidgetId(@NonNull WidgetType widgetType) {
+		return getDuplicateWidgetId(widgetType.id);
 	}
 
 	@NonNull
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
index ec551911f86..bc6f04e9347 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
@@ -173,6 +173,14 @@ public List<List<String>> getWidgetsOrder(@NonNull ApplicationMode appMode, @Non
 		return widgetsOrder;
 	}
 
+	public boolean contains(@NonNull String widgetId, @NonNull OsmandSettings settings) {
+		return contains(widgetId, settings, settings.getApplicationMode());
+	}
+
+	public boolean contains(@NonNull String widgetId, @NonNull OsmandSettings settings, @NonNull ApplicationMode appMode) {
+		return getWidgetOrder(appMode, widgetId, settings) != DEFAULT_ORDER;
+	}
+
 	public boolean isPagingAllowed() {
 		return this == LEFT || this == RIGHT;
 	}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
index 4f12e5b4e3d..ea414a54f94 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
@@ -338,7 +338,7 @@ public void onCompassVisibilityUpdated(@NonNull CompassVisibility visibility) {
 	}
 
 	@Override
-	public void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo, @Nullable WidgetType widgetType) {
+	public void onWidgetRegistered(@NonNull MapWidgetInfo widgetInfo) {
 		updateWidgetsCountForPanel(widgetInfo.widgetPanel);
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java
index 115d83a5e98..a5f81fc81bf 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetsSettingsHelper.java
@@ -136,7 +136,7 @@ private List<MapWidgetInfo> getDefaultWidgetInfos(@NonNull WidgetsPanel panel) {
 
 	@Nullable
 	private MapWidgetInfo createDuplicateWidgetInfo(@NonNull WidgetType widgetType, @NonNull WidgetsPanel panel) {
-		String duplicateWidgetId = WidgetType.getDuplicateWidgetId(widgetType.id);
+		String duplicateWidgetId = WidgetType.getDuplicateWidgetId(widgetType);
 		MapWidget duplicateWidget = widgetsFactory.createMapWidget(duplicateWidgetId, widgetType);
 		if (duplicateWidget != null) {
 			settings.CUSTOM_WIDGETS_KEYS.addModeValue(appMode, duplicateWidgetId);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java
index 7a4514e5079..f4eedd024d2 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/WidgetInfoFragment.java
@@ -120,7 +120,7 @@ private void initFromBundle(@NonNull Bundle bundle) {
 		if (widgetInfo == null) {
 			throw new IllegalStateException("Failed to find widget by id: " + widgetId);
 		}
-		widgetType = WidgetType.getById(widgetInfo.key);
+		widgetType = widgetInfo.getWidgetType();
 		widgetGroup = widgetType == null ? null : widgetType.group;
 		panel = widgetInfo.widgetPanel;
 	}
@@ -277,7 +277,7 @@ private String createDuplicateWidget() {
 			return null;
 		}
 
-		String duplicateId = WidgetType.getDuplicateWidgetId(widgetType.id);
+		String duplicateId = WidgetType.getDuplicateWidgetId(widgetType);
 
 		settings.CUSTOM_WIDGETS_KEYS.addModeValue(appMode, duplicateId);
 		WidgetState widgetState = widgetInfo.getWidgetState();
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
index 392921c615c..031e2f3ae50 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
@@ -3,7 +3,6 @@
 import static net.osmand.plus.views.mapwidgets.MapWidgetInfo.DELIMITER;
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.AVAILABLE_MODE;
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.ENABLED_MODE;
-import static net.osmand.plus.views.mapwidgets.WidgetType.getDuplicateWidgetId;
 
 import android.graphics.PorterDuff;
 import android.graphics.drawable.Drawable;
@@ -279,7 +278,7 @@ public void onWidgetsSelectedToAdd(@NonNull List<String> widgetsIds, @NonNull Wi
 	private MapWidgetInfo createDuplicateWidget(@NonNull String widgetId, @NonNull WidgetsPanel panel) {
 		WidgetType widgetType = WidgetType.getById(widgetId);
 		if (widgetType != null) {
-			String id = widgetId.contains(DELIMITER) ? widgetId : getDuplicateWidgetId(widgetId);
+			String id = widgetId.contains(DELIMITER) ? widgetId : WidgetType.getDuplicateWidgetId(widgetId);
 			MapWidget widget = widgetsFactory.createMapWidget(id, widgetType);
 			if (widget != null) {
 				settings.CUSTOM_WIDGETS_KEYS.addValue(id);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
index b6ea16eb3b8..4842a207463 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
@@ -264,7 +264,7 @@ private void inflateWidgetItemsViews(@NonNull Set<MapWidgetInfo> widgetsInfo, @N
 			TextView title = view.findViewById(R.id.title);
 			title.setText(widgetInfo.getTitle(app));
 
-			WidgetType widgetType = WidgetType.getById(widgetInfo.key);
+			WidgetType widgetType = widgetInfo.getWidgetType();
 			WidgetGroup widgetGroup = widgetType == null ? null : widgetType.group;
 			if (widgetGroup != null) {
 				TextView description = view.findViewById(R.id.description);
@@ -443,7 +443,7 @@ private void inflateAvailableExternalWidgets(@NonNull List<MapWidgetInfo> extern
 	private List<WidgetType> listDefaultWidgets(@NonNull Set<MapWidgetInfo> widgets) {
 		Map<Integer, WidgetType> defaultWidgets = new TreeMap<>();
 		for (MapWidgetInfo widgetInfo : widgets) {
-			WidgetType widgetType = WidgetType.getById(widgetInfo.key);
+			WidgetType widgetType = widgetInfo.getWidgetType();
 			if (widgetType != null) {
 				defaultWidgets.put(widgetType.ordinal(), widgetType);
 			}
@@ -455,8 +455,7 @@ private List<WidgetType> listDefaultWidgets(@NonNull Set<MapWidgetInfo> widgets)
 	private List<MapWidgetInfo> listExternalWidgets(@NonNull Set<MapWidgetInfo> widgets) {
 		List<MapWidgetInfo> externalWidgets = new ArrayList<>();
 		for (MapWidgetInfo widgetInfo : widgets) {
-			WidgetType widgetType = WidgetType.getById(widgetInfo.key);
-			if (widgetType == null) {
+			if (widgetInfo.isExternal()) {
 				externalWidgets.add(widgetInfo);
 			}
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
index 716d8f74322..9c86adaa3dc 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
@@ -109,6 +109,10 @@ public WidgetType getWidgetType() {
 		return widgetType;
 	}
 
+	public boolean isExternal() {
+		return getWidgetType() == null;
+	}
+
 	public void updateInfo(@Nullable DrawSettings drawSettings) {
 		// Not implemented
 	}
