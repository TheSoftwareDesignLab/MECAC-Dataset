diff --git a/OsmAnd/res/layout/list_item_with_spinner.xml b/OsmAnd/res/layout/list_item_with_spinner.xml
index 1ba1dddd329..531d3b72c54 100644
--- a/OsmAnd/res/layout/list_item_with_spinner.xml
+++ b/OsmAnd/res/layout/list_item_with_spinner.xml
@@ -8,13 +8,13 @@
 	<LinearLayout
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
-		android:orientation="horizontal"
-		android:paddingVertical="@dimen/content_padding">
+		android:orientation="horizontal">
 
 		<TextView
 			android:id="@+id/title"
 			android:layout_width="0dp"
 			android:layout_height="wrap_content"
+			android:layout_gravity="center_vertical"
 			android:layout_weight="1"
 			android:gravity="start"
 			android:letterSpacing="0.01"
@@ -22,12 +22,35 @@
 			android:textSize="16sp"
 			tools:text="@string/visualized_by" />
 
-		<Spinner
-			android:id="@+id/spinner"
+		<LinearLayout
+			android:id="@+id/button"
 			android:layout_width="wrap_content"
 			android:layout_height="wrap_content"
-			android:gravity="end"
-			android:saveEnabled="false" />
+			android:orientation="horizontal"
+			android:padding="@dimen/list_item_button_padding">
+
+			<TextView
+				android:id="@+id/description"
+				style="@style/TitleStyle"
+				android:layout_width="wrap_content"
+				android:layout_height="wrap_content"
+				android:layout_gravity="center_vertical"
+				android:textColor="?android:textColorSecondary"
+				tools:text="@string/track_coloring_solid" />
+
+			<androidx.appcompat.widget.AppCompatImageButton
+				android:id="@+id/selector"
+				style="@style/Widget.AppCompat.ActionButton"
+				android:layout_width="@dimen/standard_icon_size"
+				android:layout_height="@dimen/standard_icon_size"
+				android:layout_margin="@dimen/content_padding_small"
+				android:clickable="false"
+				android:duplicateParentState="true"
+				android:scaleType="center"
+				android:src="@drawable/ic_action_arrow_down"
+				android:tint="?attr/default_icon_color" />
+
+		</LinearLayout>
 
 	</LinearLayout>
 
diff --git a/OsmAnd/src/net/osmand/plus/track/cards/Track3DCard.java b/OsmAnd/src/net/osmand/plus/track/cards/Track3DCard.java
index 3896f4ec656..cb89f2d0ed2 100644
--- a/OsmAnd/src/net/osmand/plus/track/cards/Track3DCard.java
+++ b/OsmAnd/src/net/osmand/plus/track/cards/Track3DCard.java
@@ -1,18 +1,21 @@
 package net.osmand.plus.track.cards;
 
+import static net.osmand.gpx.PointAttributes.SENSOR_TAG_BIKE_POWER;
+import static net.osmand.gpx.PointAttributes.SENSOR_TAG_CADENCE;
+import static net.osmand.gpx.PointAttributes.SENSOR_TAG_HEART_RATE;
+import static net.osmand.gpx.PointAttributes.SENSOR_TAG_SPEED;
+import static net.osmand.gpx.PointAttributes.SENSOR_TAG_TEMPERATURE;
 import static net.osmand.plus.chooseplan.OsmAndFeature.TERRAIN;
+import static net.osmand.plus.track.Gpx3DVisualizationType.FIXED_HEIGHT;
+import static net.osmand.plus.track.Gpx3DVisualizationType.NONE;
 
-import android.content.Context;
 import android.view.View;
-import android.widget.AdapterView;
-import android.widget.AdapterView.OnItemSelectedListener;
-import android.widget.ArrayAdapter;
-import android.widget.Spinner;
 import android.widget.TextView;
 
 import androidx.annotation.NonNull;
 import androidx.fragment.app.FragmentActivity;
 
+import net.osmand.gpx.GPXTrackAnalysis;
 import net.osmand.plus.R;
 import net.osmand.plus.Version;
 import net.osmand.plus.chooseplan.ChoosePlanFragment;
@@ -25,6 +28,9 @@
 import net.osmand.plus.track.Gpx3DWallColorType;
 import net.osmand.plus.track.TrackDrawInfo;
 import net.osmand.plus.utils.OsmAndFormatter;
+import net.osmand.plus.widgets.popup.PopUpMenu;
+import net.osmand.plus.widgets.popup.PopUpMenuDisplayData;
+import net.osmand.plus.widgets.popup.PopUpMenuItem;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -33,23 +39,14 @@ public class Track3DCard extends BaseCard {
 
 	public static final int WALL_HEIGHT_BUTTON_INDEX = 0;
 
-	private final TrackDrawInfo trackDrawInfo;
-	private Spinner visualizedBy;
-	private Spinner trackLine;
-	private Spinner wallColor;
-
-	private View trackLineContainer;
-	private View wallColorContainer;
-	private View visualizedByDivider;
-	private View freeUserCard;
-	private View settingsContainer;
-	private View wallHeightContainer;
-	private TextView wallHeightValue;
-	private TextView wallHeightTitle;
-
-	public Track3DCard(@NonNull FragmentActivity activity, @NonNull TrackDrawInfo trackDrawInfo) {
+	private final TrackDrawInfo drawInfo;
+	private final GPXTrackAnalysis analysis;
+
+	public Track3DCard(@NonNull FragmentActivity activity, @NonNull GPXTrackAnalysis analysis,
+	                   @NonNull TrackDrawInfo drawInfo) {
 		super(activity);
-		this.trackDrawInfo = trackDrawInfo;
+		this.drawInfo = drawInfo;
+		this.analysis = analysis;
 	}
 
 	@Override
@@ -57,136 +54,158 @@ public int getCardLayoutId() {
 		return R.layout.track_3d_appearence_card;
 	}
 
-	@NonNull
 	@Override
-	public View build(@NonNull Context ctx) {
-		View cardView = super.build(ctx);
-
-		settingsContainer = cardView.findViewById(R.id.settings_container);
-		freeUserCard = cardView.findViewById(R.id.free_user_card);
-		cardView.findViewById(R.id.get_btn).setOnClickListener((v) -> openChoosePlan());
-
-		setupVisualizedBy(cardView);
-		setupTrackLine(cardView);
-		setupWallColor(cardView);
-		setupVerticalExaggeration(cardView);
-
-		update();
+	protected void updateContent() {
+		boolean visible = drawInfo.getTrackVisualizationType().is3dType();
 
-		return cardView;
+		setupVisualizedBy(visible);
+		setupTrackLine(visible);
+		setupWallColor(visible);
+		setupVerticalExaggeration(visible);
+		setupFreeUserCard();
 	}
 
-	private void setupVisualizedBy(@NonNull View view) {
-		List<String> items = new ArrayList<>();
-		for (Gpx3DVisualizationType item : Gpx3DVisualizationType.values()) {
-			items.add(getString(item.getDisplayNameResId()));
-		}
+	private void setupVisualizedBy(boolean visible) {
 		View container = view.findViewById(R.id.visualized_by_container);
 		TextView title = container.findViewById(R.id.title);
-		title.setText(R.string.visualized_by);
+		TextView description = container.findViewById(R.id.description);
 
-		visualizedBy = container.findViewById(R.id.spinner);
-		initSpinner(view.getContext(), visualizedBy, items, new ItemListener() {
-			@Override
-			public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {
-				visualizedBy.setSelection(position);
-				trackDrawInfo.setTrackVisualizationType(Gpx3DVisualizationType.values()[position]);
-				updateContent();
-				notifyCardPressed();
+		title.setText(R.string.visualized_by);
+		description.setText(drawInfo.getTrackVisualizationType().getDisplayNameResId());
+
+		container.findViewById(R.id.button).setOnClickListener(v -> {
+			List<PopUpMenuItem> items = new ArrayList<>();
+
+			Gpx3DVisualizationType previous = null;
+			for (Gpx3DVisualizationType type : Gpx3DVisualizationType.values()) {
+				if (isVisualizationTypeAvailable(type, analysis)) {
+					items.add(new PopUpMenuItem.Builder(app)
+							.setTitleId(type.getDisplayNameResId())
+							.showTopDivider(FIXED_HEIGHT == type || NONE == previous)
+							.setOnClickListener(item -> {
+								drawInfo.setTrackVisualizationType(type);
+								updateContent();
+								notifyCardPressed();
+							})
+							.create());
+					previous = type;
+				}
 			}
+			showOptionsMenu(v, items);
 		});
-		visualizedByDivider = container.findViewById(R.id.divider);
+		AndroidUiHelper.updateVisibility(container.findViewById(R.id.divider), visible);
 	}
 
-	private void setupTrackLine(@NonNull View view) {
-		List<String> items = new ArrayList<>();
-		for (Gpx3DLinePositionType item : Gpx3DLinePositionType.values()) {
-			items.add(getString(item.getDisplayNameResId()));
-		}
-		trackLineContainer = view.findViewById(R.id.track_line_container);
-		trackLine = trackLineContainer.findViewById(R.id.spinner);
+	private boolean isVisualizationTypeAvailable(@NonNull Gpx3DVisualizationType type, @NonNull GPXTrackAnalysis analysis) {
+		return switch (type) {
+			case ALTITUDE -> analysis.hasElevationData();
+			case SPEED -> analysis.hasSpeedData();
+			case HEART_RATE -> analysis.hasData(SENSOR_TAG_HEART_RATE);
+			case BICYCLE_CADENCE -> analysis.hasData(SENSOR_TAG_CADENCE);
+			case BICYCLE_POWER -> analysis.hasData(SENSOR_TAG_BIKE_POWER);
+			case TEMPERATURE -> analysis.hasData(SENSOR_TAG_TEMPERATURE);
+			case SPEED_SENSOR -> analysis.hasData(SENSOR_TAG_SPEED);
+			default -> true;
+		};
+	}
 
-		TextView title = trackLineContainer.findViewById(R.id.title);
-		title.setText(R.string.track_line);
+	private void setupTrackLine(boolean visible) {
+		View container = view.findViewById(R.id.track_line_container);
+		TextView title = container.findViewById(R.id.title);
+		TextView description = container.findViewById(R.id.description);
 
-		initSpinner(view.getContext(), trackLine, items, new ItemListener() {
-			@Override
-			public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {
-				trackLine.setSelection(position);
-				trackDrawInfo.setTrackLinePositionType(Gpx3DLinePositionType.values()[position]);
-				notifyCardPressed();
+		title.setText(R.string.track_line);
+		description.setText(drawInfo.getTrackLinePositionType().getDisplayNameResId());
+
+		container.findViewById(R.id.button).setOnClickListener(v -> {
+			List<PopUpMenuItem> items = new ArrayList<>();
+			for (Gpx3DLinePositionType type : Gpx3DLinePositionType.values()) {
+				items.add(new PopUpMenuItem.Builder(app)
+						.setTitleId(type.getDisplayNameResId())
+						.setOnClickListener(item -> {
+							description.setText(item.getTitle());
+							drawInfo.setTrackLinePositionType(type);
+							notifyCardPressed();
+						})
+						.create());
 			}
+			showOptionsMenu(v, items);
 		});
+		AndroidUiHelper.updateVisibility(container, visible);
 	}
 
-	private void setupWallColor(@NonNull View view) {
-		List<String> items = new ArrayList<>();
-		for (Gpx3DWallColorType item : Gpx3DWallColorType.values()) {
-			items.add(getString(item.getDisplayNameResId()));
-		}
-		wallColorContainer = view.findViewById(R.id.wall_coloring_container);
-		wallColor = wallColorContainer.findViewById(R.id.spinner);
+	private void setupWallColor(boolean visible) {
+		View container = view.findViewById(R.id.wall_coloring_container);
+		TextView title = container.findViewById(R.id.title);
+		TextView description = container.findViewById(R.id.description);
 
-		TextView title = wallColorContainer.findViewById(R.id.title);
 		title.setText(R.string.wall_color);
-
-		initSpinner(view.getContext(), wallColor, items, new ItemListener() {
-			@Override
-			public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {
-				wallColor.setSelection(position);
-				trackDrawInfo.setTrackWallColorType(Gpx3DWallColorType.values()[position]);
-				notifyCardPressed();
+		description.setText(drawInfo.getTrackWallColorType().getDisplayNameResId());
+
+		container.findViewById(R.id.button).setOnClickListener(v -> {
+			List<PopUpMenuItem> items = new ArrayList<>();
+			for (Gpx3DWallColorType type : Gpx3DWallColorType.values()) {
+				if (isWallColorAvailable(type, analysis)) {
+					items.add(new PopUpMenuItem.Builder(app)
+							.setTitleId(type.getDisplayNameResId())
+							.setOnClickListener(item -> {
+								description.setText(item.getTitle());
+								drawInfo.setTrackWallColorType(type);
+								notifyCardPressed();
+							})
+							.create());
+				}
 			}
+			showOptionsMenu(v, items);
 		});
+		AndroidUiHelper.updateVisibility(container, visible);
+	}
+
+	private boolean isWallColorAvailable(@NonNull Gpx3DWallColorType type, @NonNull GPXTrackAnalysis analysis) {
+		return switch (type) {
+			case ALTITUDE -> analysis.hasElevationData();
+			case SPEED, SLOPE -> analysis.hasSpeedData();
+			default -> true;
+		};
 	}
 
-	private void initSpinner(@NonNull Context ctx, @NonNull Spinner spinner,
-	                         @NonNull List<String> items, @NonNull OnItemSelectedListener listener) {
-		ArrayAdapter<String> adapter = new ArrayAdapter<>(ctx, android.R.layout.simple_spinner_item, items);
-		adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
-		spinner.setAdapter(adapter);
-		spinner.setOnItemSelectedListener(listener);
+	private void showOptionsMenu(@NonNull View view, @NonNull List<PopUpMenuItem> items) {
+		PopUpMenuDisplayData displayData = new PopUpMenuDisplayData();
+		displayData.anchorView = view;
+		displayData.menuItems = items;
+		displayData.nightMode = nightMode;
+		PopUpMenu.show(displayData);
 	}
 
-	private void setupVerticalExaggeration(@NonNull View view) {
-		wallHeightContainer = view.findViewById(R.id.exaggeration_container);
+	private void setupVerticalExaggeration(boolean visible) {
+		View wallHeightContainer = view.findViewById(R.id.exaggeration_container);
 		wallHeightContainer.setOnClickListener((v) -> notifyButtonPressed(WALL_HEIGHT_BUTTON_INDEX));
 
-		wallHeightValue = wallHeightContainer.findViewById(R.id.value);
-		wallHeightTitle = wallHeightContainer.findViewById(R.id.title);
-	}
+		TextView title = wallHeightContainer.findViewById(R.id.title);
+		TextView description = wallHeightContainer.findViewById(R.id.value);
 
-	@Override
-	protected void updateContent() {
-		if (visualizedBy != null) {
-			Gpx3DVisualizationType type = trackDrawInfo.getTrackVisualizationType();
-			visualizedBy.setSelection(type.ordinal());
-			wallColor.setSelection(trackDrawInfo.getTrackWallColorType().ordinal());
-			trackLine.setSelection(trackDrawInfo.getTrackLinePositionType().ordinal());
-
-			boolean fixedHeight = trackDrawInfo.isFixedHeight();
-			if (fixedHeight) {
-				float elevation = trackDrawInfo.getElevationMeters();
-				wallHeightValue.setText(OsmAndFormatter.getFormattedAlt(elevation, app));
-			} else {
-				float exaggeration = trackDrawInfo.getAdditionalExaggeration();
-				wallHeightValue.setText(MapOptionSliderFragment.getFormattedValue(app, exaggeration));
-			}
-			wallHeightTitle.setText(fixedHeight ? R.string.wall_height : R.string.vertical_exaggeration);
-
-			boolean paramsVisible = type.is3dType();
-			AndroidUiHelper.updateVisibility(wallColor, paramsVisible);
-			AndroidUiHelper.updateVisibility(trackLine, paramsVisible);
-			AndroidUiHelper.updateVisibility(wallColorContainer, paramsVisible);
-			AndroidUiHelper.updateVisibility(trackLineContainer, paramsVisible);
-			AndroidUiHelper.updateVisibility(wallHeightContainer, paramsVisible);
-			AndroidUiHelper.updateVisibility(visualizedByDivider, paramsVisible);
-			AndroidUiHelper.updateVisibility(freeUserCard, isGetBtnVisible());
-			AndroidUiHelper.updateVisibility(settingsContainer, !isGetBtnVisible());
+		boolean fixedHeight = drawInfo.isFixedHeight();
+		if (fixedHeight) {
+			float elevation = drawInfo.getElevationMeters();
+			description.setText(OsmAndFormatter.getFormattedAlt(elevation, app));
+		} else {
+			float exaggeration = drawInfo.getAdditionalExaggeration();
+			description.setText(MapOptionSliderFragment.getFormattedValue(app, exaggeration));
 		}
+		title.setText(fixedHeight ? R.string.wall_height : R.string.vertical_exaggeration);
+		AndroidUiHelper.updateVisibility(wallHeightContainer, visible);
 	}
 
-	private boolean isGetBtnVisible() {
+	private void setupFreeUserCard() {
+		View container = view.findViewById(R.id.settings_container);
+		container.setOnClickListener((v) -> openChoosePlan());
+
+		boolean needPurchases = needPurchases();
+		AndroidUiHelper.updateVisibility(container, !needPurchases);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.free_user_card), needPurchases);
+	}
+
+	private boolean needPurchases() {
 		boolean isFullVersion = !Version.isFreeVersion(app) || InAppPurchaseUtils.isFullVersionAvailable(app, false);
 		return !isFullVersion && !InAppPurchaseUtils.isSubscribedToAny(app, false);
 	}
@@ -196,12 +215,4 @@ private void openChoosePlan() {
 			ChoosePlanFragment.showInstance(activity, TERRAIN);
 		}
 	}
-
-	private static abstract class ItemListener implements OnItemSelectedListener {
-
-		@Override
-		public void onNothingSelected(AdapterView<?> parent) {
-
-		}
-	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/TrackAppearanceFragment.java b/OsmAnd/src/net/osmand/plus/track/fragments/TrackAppearanceFragment.java
index 4b27151b267..7c80008a9e6 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/TrackAppearanceFragment.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/TrackAppearanceFragment.java
@@ -1,18 +1,6 @@
 package net.osmand.plus.track.fragments;
 
-import static net.osmand.gpx.GpxParameter.ADDITIONAL_EXAGGERATION;
-import static net.osmand.gpx.GpxParameter.COLOR;
-import static net.osmand.gpx.GpxParameter.COLORING_TYPE;
-import static net.osmand.gpx.GpxParameter.ELEVATION_METERS;
-import static net.osmand.gpx.GpxParameter.COLOR_PALETTE;
-import static net.osmand.gpx.GpxParameter.SHOW_ARROWS;
-import static net.osmand.gpx.GpxParameter.SHOW_START_FINISH;
-import static net.osmand.gpx.GpxParameter.SPLIT_INTERVAL;
-import static net.osmand.gpx.GpxParameter.SPLIT_TYPE;
-import static net.osmand.gpx.GpxParameter.TRACK_3D_LINE_POSITION_TYPE;
-import static net.osmand.gpx.GpxParameter.TRACK_3D_WALL_COLORING_TYPE;
-import static net.osmand.gpx.GpxParameter.TRACK_VISUALIZATION_TYPE;
-import static net.osmand.gpx.GpxParameter.WIDTH;
+import static net.osmand.gpx.GpxParameter.*;
 import static net.osmand.plus.plugins.monitoring.TripRecordingBottomSheet.UPDATE_TRACK_ICON;
 import static net.osmand.plus.routing.ColoringStyleAlgorithms.isAvailableInSubscription;
 import static net.osmand.plus.track.GpxAppearanceAdapter.TRACK_WIDTH_BOLD;
@@ -790,7 +778,7 @@ private void setupCards() {
 
 			inflate(R.layout.list_item_divider_basic, container, true);
 
-			track3DCard = new Track3DCard(mapActivity, trackDrawInfo);
+			track3DCard = new Track3DCard(mapActivity, selectedGpxFile.getTrackAnalysis(app), trackDrawInfo);
 			addCard(container, track3DCard);
 			addCard(container, new ActionsCard(mapActivity));
 		}
