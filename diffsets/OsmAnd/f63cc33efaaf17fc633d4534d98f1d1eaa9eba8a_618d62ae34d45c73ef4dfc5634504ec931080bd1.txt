diff --git a/OsmAnd/res/layout/fragment_choose_plan.xml b/OsmAnd/res/layout/fragment_choose_plan.xml
index 8950d6e2720..afc25acf664 100644
--- a/OsmAnd/res/layout/fragment_choose_plan.xml
+++ b/OsmAnd/res/layout/fragment_choose_plan.xml
@@ -1,62 +1,140 @@
 <?xml version="1.0" encoding="utf-8"?>
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:osmand="http://schemas.android.com/apk/res-auto"
     xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
     android:layout_height="match_parent"
-    android:background="?attr/wikivoyage_bg_color"
-    android:orientation="vertical">
+    android:fitsSystemWindows="true">
 
     <!-- Toolbar -->
-    <LinearLayout
-        android:id="@+id/toolbar_container"
+    <com.google.android.material.appbar.AppBarLayout
+        android:id="@+id/appbar"
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
-        android:background="?attr/list_background_color"
-        android:minHeight="@dimen/toolbar_height"
-        android:orientation="horizontal">
+        android:fitsSystemWindows="true"
+        osmand:elevation="0dp"
+        android:background="@android:color/transparent">
 
-        <androidx.appcompat.widget.AppCompatImageView
-            android:id="@+id/button_back"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:background="?attr/selectableItemBackgroundBorderless"
-            android:padding="@dimen/list_content_padding"
-            android:tint="@color/icon_color_default_light"
-            osmand:srcCompat="@drawable/ic_arrow_back" />
-
-        <net.osmand.plus.widgets.TextViewEx
-            android:id="@+id/toolbar_title"
-            android:layout_width="0dp"
+        <com.google.android.material.appbar.CollapsingToolbarLayout
+            android:id="@+id/toolbar_layout"
+            android:layout_width="match_parent"
             android:layout_height="wrap_content"
-            android:layout_gravity="center_vertical"
-            android:layout_marginStart="@dimen/content_padding"
-            android:layout_marginLeft="@dimen/content_padding"
-            android:layout_weight="1"
-            android:textSize="@dimen/dialog_header_text_size"
-            osmand:typeface="@string/font_roboto_medium"
-            tools:text="Title" />
+            osmand:expandedTitleMarginBottom="@dimen/content_padding_small"
+            osmand:expandedTitleMarginEnd="@dimen/content_padding"
+            osmand:expandedTitleMarginStart="@dimen/content_padding"
+            osmand:collapsedTitleTextAppearance="@style/AppBarTitle"
+            osmand:expandedTitleGravity="start|bottom"
+            osmand:expandedTitleTextAppearance="@style/AppBarTitle"
+            osmand:layout_scrollFlags="scroll|exitUntilCollapsed">
+
+            <!-- Header -->
+            <LinearLayout
+                android:id="@+id/header"
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:paddingTop="@dimen/toolbar_height"
+                android:layout_marginBottom="@dimen/content_padding_small"
+                osmand:layout_collapseMode="pin"
+                android:orientation="horizontal">
 
-        <androidx.appcompat.widget.AppCompatImageView
-            android:id="@+id/button_reset"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:background="?attr/selectableItemBackgroundBorderless"
-            android:padding="@dimen/list_content_padding"
-            android:tint="@color/icon_color_default_light"
-            osmand:srcCompat="@drawable/ic_action_reset_to_default_dark" />
+                <FrameLayout
+                    android:id="@+id/header_icon_background"
+                    android:layout_width="@dimen/icon_background_size"
+                    android:layout_height="@dimen/icon_background_size"
+                    android:layout_marginLeft="@dimen/content_padding"
+                    android:layout_marginRight="@dimen/content_padding"
+                    android:background="@drawable/rectangle_rounded">
+
+                    <androidx.appcompat.widget.AppCompatImageView
+                        android:id="@+id/header_icon"
+                        android:layout_width="@dimen/big_icon_size"
+                        android:layout_height="@dimen/big_icon_size"
+                        android:layout_gravity="center"
+                        android:background="?attr/selectableItemBackgroundBorderless"
+                        osmand:srcCompat="@drawable/ic_action_cloud_upload_colored" />
+
+                </FrameLayout>
+
+                <net.osmand.plus.widgets.TextViewEx
+                    android:id="@+id/header_title"
+                    android:layout_width="0dp"
+                    android:layout_height="wrap_content"
+                    android:layout_gravity="start|center_vertical"
+                    android:layout_weight="1"
+                    android:textColor="?android:textColorPrimary"
+                    android:textSize="@dimen/default_header_text_size"
+                    osmand:typeface="@string/font_roboto_medium"
+                    tools:text="@string/osmand_cloud" />
+
+            </LinearLayout>
+
+            <androidx.appcompat.widget.Toolbar
+                android:id="@+id/toolbar"
+                android:layout_width="match_parent"
+                android:layout_height="@dimen/toolbar_height"
+                android:minHeight="@dimen/toolbar_height"
+                osmand:titleMarginEnd="0dp"
+                osmand:titleMarginStart="0dp"
+                osmand:layout_collapseMode="pin"
+                osmand:layout_scrollFlags="scroll|enterAlways|exitUntilCollapsed">
+
+                <LinearLayout
+                    android:id="@+id/toolbar_container"
+                    android:layout_width="match_parent"
+                    android:layout_height="wrap_content"
+                    android:background="@color/color_transparent"
+                    android:minHeight="@dimen/toolbar_height"
+                    android:orientation="horizontal">
+
+                    <androidx.appcompat.widget.AppCompatImageView
+                        android:id="@+id/button_back"
+                        android:layout_width="wrap_content"
+                        android:layout_height="wrap_content"
+                        android:background="?attr/selectableItemBackgroundBorderless"
+                        android:padding="@dimen/list_content_padding"
+                        android:tint="@color/icon_color_default_light"
+                        osmand:srcCompat="@drawable/ic_arrow_back" />
+
+                    <net.osmand.plus.widgets.TextViewEx
+                        android:id="@+id/toolbar_title"
+                        android:layout_width="0dp"
+                        android:layout_height="wrap_content"
+                        android:layout_gravity="center_vertical"
+                        android:layout_marginStart="@dimen/content_padding"
+                        android:layout_marginLeft="@dimen/content_padding"
+                        android:layout_weight="1"
+                        android:textSize="@dimen/dialog_header_text_size"
+                        osmand:typeface="@string/font_roboto_medium"
+                        tools:text="Title" />
+
+                    <androidx.appcompat.widget.AppCompatImageView
+                        android:id="@+id/button_reset"
+                        android:layout_width="wrap_content"
+                        android:layout_height="wrap_content"
+                        android:background="?attr/selectableItemBackgroundBorderless"
+                        android:padding="@dimen/list_content_padding"
+                        android:tint="@color/icon_color_default_light"
+                        osmand:srcCompat="@drawable/ic_action_reset_to_default_dark" />
+
+                </LinearLayout>
 
-    </LinearLayout>
+            </androidx.appcompat.widget.Toolbar>
+
+        </com.google.android.material.appbar.CollapsingToolbarLayout>
+
+    </com.google.android.material.appbar.AppBarLayout>
 
     <FrameLayout
         android:layout_width="match_parent"
-        android:layout_height="wrap_content">
+        android:layout_height="match_parent"
+        osmand:layout_behavior="@string/appbar_scrolling_view_behavior">
 
-        <ScrollView
+        <androidx.core.widget.NestedScrollView
             android:id="@+id/scroll_view"
             android:layout_width="match_parent"
             android:layout_height="match_parent"
-            android:fillViewport="true">
+            android:fillViewport="true"
+            android:overScrollMode="never">
 
             <LinearLayout
                 android:layout_width="match_parent"
@@ -71,50 +149,12 @@
                     android:background="?attr/list_background_color"
                     android:orientation="vertical">
 
-                    <!-- Header -->
-                    <LinearLayout
-                        android:id="@+id/header"
-                        android:layout_width="match_parent"
-                        android:layout_height="wrap_content"
-                        android:orientation="horizontal">
-
-                        <FrameLayout
-                            android:id="@+id/header_icon_background"
-                            android:layout_width="@dimen/icon_background_size"
-                            android:layout_height="@dimen/icon_background_size"
-                            android:layout_marginLeft="@dimen/content_padding"
-                            android:layout_marginRight="@dimen/content_padding"
-                            android:background="@drawable/rectangle_rounded">
-
-                            <androidx.appcompat.widget.AppCompatImageView
-                                android:id="@+id/header_icon"
-                                android:layout_width="@dimen/big_icon_size"
-                                android:layout_height="@dimen/big_icon_size"
-                                android:layout_gravity="center"
-                                android:background="?attr/selectableItemBackgroundBorderless"
-                                osmand:srcCompat="@drawable/ic_action_cloud_upload_colored" />
-
-                        </FrameLayout>
-
-                        <net.osmand.plus.widgets.TextViewEx
-                            android:id="@+id/header_title"
-                            android:layout_width="0dp"
-                            android:layout_height="wrap_content"
-                            android:layout_gravity="start|center_vertical"
-                            android:layout_weight="1"
-                            android:textColor="?android:textColorPrimary"
-                            android:textSize="@dimen/default_header_text_size"
-                            osmand:typeface="@string/font_roboto_medium"
-                            tools:text="@string/osmand_cloud" />
-
-                    </LinearLayout>
-
                     <!-- Primary description -->
                     <net.osmand.plus.widgets.TextViewEx
                         android:id="@+id/primary_description"
                         android:layout_width="match_parent"
                         android:layout_height="wrap_content"
-                        android:layout_marginTop="@dimen/dialog_content_margin"
+                        android:layout_marginTop="@dimen/content_padding_half"
                         android:letterSpacing="@dimen/text_button_letter_spacing"
                         android:lineSpacingMultiplier="@dimen/info_description_line_spacing_multiplier"
                         android:paddingLeft="@dimen/content_padding"
@@ -221,14 +261,16 @@
 
             </LinearLayout>
 
-        </ScrollView>
+        </androidx.core.widget.NestedScrollView>
 
-        <include
-            android:id="@+id/toolbar_shadow"
-            layout="@layout/card_bottom_divider"
-            android:visibility="gone"
-            tools:visibility="visible" />
+        <androidx.appcompat.widget.AppCompatImageView
+            android:id="@+id/shadowView"
+            android:layout_width="match_parent"
+            android:layout_height="@dimen/abp__shadow_height"
+            osmand:srcCompat="@drawable/bg_shadow_list_bottom"
+            android:scaleType="fitXY" />
 
     </FrameLayout>
 
-</LinearLayout>
\ No newline at end of file
+
+</androidx.coordinatorlayout.widget.CoordinatorLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/fragment_selected_plan.xml b/OsmAnd/res/layout/fragment_selected_plan.xml
index 5558e31cbb9..0a8ffce2d32 100644
--- a/OsmAnd/res/layout/fragment_selected_plan.xml
+++ b/OsmAnd/res/layout/fragment_selected_plan.xml
@@ -1,61 +1,151 @@
 <?xml version="1.0" encoding="utf-8"?>
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:osmand="http://schemas.android.com/apk/res-auto"
     xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
     android:layout_height="match_parent"
-    android:orientation="vertical">
+    android:fitsSystemWindows="true">
 
     <!-- Toolbar -->
-    <LinearLayout
-        android:id="@+id/toolbar_container"
+    <com.google.android.material.appbar.AppBarLayout
+        android:id="@+id/appbar"
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
-        android:minHeight="@dimen/toolbar_height"
-        android:background="?attr/activity_background_color"
-        android:orientation="horizontal">
+        android:fitsSystemWindows="true"
+        osmand:elevation="0dp"
+        android:background="@android:color/transparent">
 
-        <androidx.appcompat.widget.AppCompatImageView
-            android:id="@+id/button_back"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:background="?attr/selectableItemBackgroundBorderless"
-            android:padding="@dimen/list_content_padding"
-            tools:tint="@color/icon_color_default_light"
-            osmand:srcCompat="@drawable/ic_arrow_back" />
-
-        <net.osmand.plus.widgets.TextViewEx
-            android:id="@+id/toolbar_title"
-            android:layout_width="0dp"
+        <com.google.android.material.appbar.CollapsingToolbarLayout
+            android:id="@+id/toolbar_layout"
+            android:layout_width="match_parent"
             android:layout_height="wrap_content"
-            android:layout_gravity="center_vertical"
-            android:layout_marginStart="@dimen/content_padding"
-            android:layout_marginLeft="@dimen/content_padding"
-            android:layout_weight="1"
-            android:textSize="@dimen/dialog_header_text_size"
-            osmand:typeface="@string/font_roboto_medium"
-            tools:text="Title" />
+            osmand:expandedTitleMarginBottom="@dimen/content_padding_small"
+            osmand:expandedTitleMarginEnd="@dimen/content_padding"
+            osmand:expandedTitleMarginStart="@dimen/content_padding"
+            osmand:collapsedTitleTextAppearance="@style/AppBarTitle"
+            osmand:expandedTitleGravity="start|bottom"
+            osmand:expandedTitleTextAppearance="@style/AppBarTitle"
+            osmand:layout_scrollFlags="scroll|exitUntilCollapsed">
+
+            <!-- Header -->
+            <LinearLayout
+                android:id="@+id/header"
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:orientation="horizontal"
+                android:paddingLeft="@dimen/content_padding"
+                android:paddingTop="@dimen/toolbar_height"
+                android:layout_marginBottom="@dimen/content_padding_small"
+                android:paddingRight="@dimen/content_padding"
+                android:paddingBottom="@dimen/content_padding_small"
+                osmand:layout_collapseMode="pin">
 
-        <androidx.appcompat.widget.AppCompatImageView
-            android:id="@+id/button_help"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:background="?attr/selectableItemBackgroundBorderless"
-            android:padding="@dimen/list_content_padding"
-            tools:tint="@color/icon_color_default_light"
-            osmand:srcCompat="@drawable/ic_action_help" />
+                <LinearLayout
+                    android:layout_width="0dp"
+                    android:layout_height="wrap_content"
+                    android:layout_weight="1"
+                    android:orientation="vertical">
+
+                    <net.osmand.plus.widgets.TextViewEx
+                        android:id="@+id/header_title"
+                        android:layout_width="wrap_content"
+                        android:layout_height="wrap_content"
+                        android:layout_gravity="start|center_vertical"
+                        android:textColor="?android:textColorPrimary"
+                        android:textSize="@dimen/big_header_text_size"
+                        osmand:typeface="@string/font_roboto_medium"
+                        tools:text="@string/osmand_pro" />
+
+                    <net.osmand.plus.widgets.TextViewEx
+                        android:id="@+id/header_descr"
+                        android:layout_width="wrap_content"
+                        android:layout_height="wrap_content"
+                        android:layout_gravity="start|center_vertical"
+                        android:textColor="?android:textColorSecondary"
+                        android:textSize="@dimen/default_list_text_size"
+                        osmand:typeface="@string/font_roboto_regular"
+                        tools:text="@string/osmand_pro_tagline" />
+
+                </LinearLayout>
+
+                <androidx.appcompat.widget.AppCompatImageView
+                    android:id="@+id/header_icon"
+                    android:layout_width="@dimen/big_icon_size"
+                    android:layout_height="@dimen/big_icon_size"
+                    android:layout_gravity="center"
+                    android:layout_marginStart="@dimen/content_padding"
+                    android:layout_marginLeft="@dimen/content_padding"
+                    tools:srcCompat="@drawable/ic_action_osmand_pro_logo" />
+
+            </LinearLayout>
+
+            <androidx.appcompat.widget.Toolbar
+                android:id="@+id/toolbar"
+                android:layout_width="match_parent"
+                android:layout_height="@dimen/toolbar_height"
+                android:minHeight="@dimen/toolbar_height"
+                osmand:titleMarginEnd="0dp"
+                osmand:titleMarginStart="0dp"
+                osmand:layout_collapseMode="pin"
+                osmand:layout_scrollFlags="scroll|enterAlways|exitUntilCollapsed">
+
+                <LinearLayout
+                    android:id="@+id/toolbar_container"
+                    android:layout_width="match_parent"
+                    android:layout_height="wrap_content"
+                    android:background="@color/color_transparent"
+                    android:minHeight="@dimen/toolbar_height"
+                    android:orientation="horizontal">
+
+                    <androidx.appcompat.widget.AppCompatImageView
+                        android:id="@+id/button_back"
+                        android:layout_width="wrap_content"
+                        android:layout_height="wrap_content"
+                        android:background="?attr/selectableItemBackgroundBorderless"
+                        android:padding="@dimen/list_content_padding"
+                        android:tint="@color/icon_color_default_light"
+                        osmand:srcCompat="@drawable/ic_arrow_back" />
+
+                    <net.osmand.plus.widgets.TextViewEx
+                        android:id="@+id/toolbar_title"
+                        android:layout_width="0dp"
+                        android:layout_height="wrap_content"
+                        android:layout_gravity="center_vertical"
+                        android:layout_marginStart="@dimen/content_padding"
+                        android:layout_marginLeft="@dimen/content_padding"
+                        android:layout_weight="1"
+                        android:textSize="@dimen/dialog_header_text_size"
+                        osmand:typeface="@string/font_roboto_medium"
+                        tools:text="Title" />
+
+                    <androidx.appcompat.widget.AppCompatImageView
+                        android:id="@+id/button_help"
+                        android:layout_width="wrap_content"
+                        android:layout_height="wrap_content"
+                        android:background="?attr/selectableItemBackgroundBorderless"
+                        android:padding="@dimen/list_content_padding"
+                        tools:tint="@color/icon_color_default_light"
+                        osmand:srcCompat="@drawable/ic_action_help" />
+
+                </LinearLayout>
+
+            </androidx.appcompat.widget.Toolbar>
+
+        </com.google.android.material.appbar.CollapsingToolbarLayout>
 
-    </LinearLayout>
+    </com.google.android.material.appbar.AppBarLayout>
 
     <FrameLayout
         android:layout_width="match_parent"
-        android:layout_height="wrap_content">
+        android:layout_height="wrap_content"
+        osmand:layout_behavior="@string/appbar_scrolling_view_behavior">
 
-        <ScrollView
+        <androidx.core.widget.NestedScrollView
             android:id="@+id/scroll_view"
             android:layout_width="match_parent"
             android:layout_height="match_parent"
-            android:fillViewport="true">
+            android:fillViewport="true"
+            android:overScrollMode="never">
 
             <LinearLayout
                 android:layout_width="match_parent"
@@ -71,56 +161,6 @@
                     android:background="?attr/activity_background_color"
                     android:orientation="vertical">
 
-                    <!-- Header -->
-                    <LinearLayout
-                        android:id="@+id/header"
-                        android:layout_width="match_parent"
-                        android:layout_height="wrap_content"
-                        android:orientation="horizontal"
-                        android:paddingLeft="@dimen/content_padding"
-                        android:paddingTop="@dimen/content_padding_half"
-                        android:paddingRight="@dimen/content_padding"
-                        android:paddingBottom="@dimen/content_padding_small">
-
-                        <LinearLayout
-                            android:layout_width="0dp"
-                            android:layout_height="wrap_content"
-                            android:layout_weight="1"
-                            android:orientation="vertical">
-
-                            <net.osmand.plus.widgets.TextViewEx
-                                android:id="@+id/header_title"
-                                android:layout_width="wrap_content"
-                                android:layout_height="wrap_content"
-                                android:layout_gravity="start|center_vertical"
-                                android:textColor="?android:textColorPrimary"
-                                android:textSize="@dimen/big_header_text_size"
-                                osmand:typeface="@string/font_roboto_medium"
-                                tools:text="@string/osmand_pro" />
-
-                            <net.osmand.plus.widgets.TextViewEx
-                                android:id="@+id/header_descr"
-                                android:layout_width="wrap_content"
-                                android:layout_height="wrap_content"
-                                android:layout_gravity="start|center_vertical"
-                                android:textColor="?android:textColorSecondary"
-                                android:textSize="@dimen/default_list_text_size"
-                                osmand:typeface="@string/font_roboto_regular"
-                                tools:text="@string/osmand_pro_tagline" />
-
-                        </LinearLayout>
-
-                        <androidx.appcompat.widget.AppCompatImageView
-                            android:id="@+id/header_icon"
-                            android:layout_width="@dimen/big_icon_size"
-                            android:layout_height="@dimen/big_icon_size"
-                            android:layout_gravity="center"
-                            android:layout_marginStart="@dimen/content_padding"
-                            android:layout_marginLeft="@dimen/content_padding"
-                            tools:srcCompat="@drawable/ic_action_osmand_pro_logo" />
-
-                    </LinearLayout>
-
                     <!-- Features list -->
                     <LinearLayout
                         android:id="@+id/features_list"
@@ -280,14 +320,15 @@
 
             </LinearLayout>
 
-        </ScrollView>
+        </androidx.core.widget.NestedScrollView>
 
-        <include
-            android:id="@+id/toolbar_shadow"
-            layout="@layout/card_bottom_divider"
-            android:visibility="gone"
-            tools:visibility="visible" />
+        <androidx.appcompat.widget.AppCompatImageView
+            android:id="@+id/shadowView"
+            android:layout_width="match_parent"
+            android:layout_height="@dimen/abp__shadow_height"
+            osmand:srcCompat="@drawable/bg_shadow_list_bottom"
+            android:scaleType="fitXY" />
 
     </FrameLayout>
 
-</LinearLayout>
\ No newline at end of file
+</androidx.coordinatorlayout.widget.CoordinatorLayout>
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/UiUtilities.java b/OsmAnd/src/net/osmand/plus/UiUtilities.java
index 62aaaf1db69..bfda5be0265 100644
--- a/OsmAnd/src/net/osmand/plus/UiUtilities.java
+++ b/OsmAnd/src/net/osmand/plus/UiUtilities.java
@@ -216,6 +216,34 @@ public static int getContrastColor(Context context, @ColorInt int color, boolean
 		return luminance < 0.5 ? transparent ? ContextCompat.getColor(context, R.color.color_black_transparent) : Color.BLACK : Color.WHITE;
 	}
 
+	public static float getProportionalAlpha(float startValue,
+	                                         float endValue,
+	                                         float currentValue) {
+		currentValue = Math.min(currentValue, endValue);
+		float proportion = (endValue - startValue) / 100;
+		if (currentValue > startValue) {
+			float currentInRange = currentValue - startValue;
+			return 1.0f - (currentInRange / proportion) / 100;
+		}
+		return 1.0f;
+	}
+
+	@ColorInt
+	public static int getProportionalColorMix(@ColorInt int startColor,
+	                                          @ColorInt int endColor,
+	                                          float startValue,
+	                                          float endValue,
+	                                          float currentValue) {
+		currentValue = Math.min(currentValue, endValue);
+		float proportion = (endValue - startValue) / 100;
+		if (currentValue > startValue) {
+			float currentInRange = currentValue - startValue;
+			float amount = (currentInRange / proportion) / 100;
+			return UiUtilities.mixTwoColors(endColor, startColor, amount);
+		}
+		return startColor;
+	}
+
 	@ColorInt
 	public static int getColorWithAlpha(@ColorInt int color, float ratio) {
 		int alpha = Math.round(Color.alpha(color) * ratio);
diff --git a/OsmAnd/src/net/osmand/plus/chooseplan/BasePurchaseFragment.java b/OsmAnd/src/net/osmand/plus/chooseplan/BasePurchaseFragment.java
index 5dac76bf2f0..74e6cef303f 100644
--- a/OsmAnd/src/net/osmand/plus/chooseplan/BasePurchaseFragment.java
+++ b/OsmAnd/src/net/osmand/plus/chooseplan/BasePurchaseFragment.java
@@ -12,7 +12,6 @@
 import android.view.ViewGroup;
 import android.view.Window;
 import android.widget.ImageView;
-import android.widget.ScrollView;
 import android.widget.TextView;
 
 import androidx.annotation.ColorInt;
@@ -21,6 +20,10 @@
 import androidx.annotation.Nullable;
 import androidx.appcompat.content.res.AppCompatResources;
 import androidx.core.content.ContextCompat;
+import androidx.core.widget.NestedScrollView;
+
+import com.google.android.material.appbar.AppBarLayout;
+import com.google.android.material.appbar.AppBarLayout.OnOffsetChangedListener;
 
 import net.osmand.AndroidUtils;
 import net.osmand.plus.OsmandApplication;
@@ -36,7 +39,7 @@
 
 import static net.osmand.plus.liveupdates.LiveUpdatesSettingsBottomSheet.getActiveColorId;
 
-public abstract class BasePurchaseFragment extends BaseOsmAndDialogFragment {
+public abstract class BasePurchaseFragment extends BaseOsmAndDialogFragment implements OnOffsetChangedListener {
 
 	protected OsmandApplication app;
 	protected InAppPurchaseHelper purchaseHelper;
@@ -45,7 +48,9 @@ public abstract class BasePurchaseFragment extends BaseOsmAndDialogFragment {
 	protected boolean nightMode;
 
 	protected View view;
-	protected ScrollView scrollView;
+	protected AppBarLayout appBar;
+	protected NestedScrollView scrollView;
+	private int lastKnownToolbarOffset;
 
 	protected List<OsmAndFeature> features = new ArrayList<>(Arrays.asList(OsmAndFeature.values()));
 
@@ -152,6 +157,8 @@ public View onCreateView(@NonNull LayoutInflater i,
 	                         @Nullable Bundle savedInstanceState) {
 		view = inflater.inflate(getLayoutId(), container, false);
 		scrollView = view.findViewById(R.id.scroll_view);
+		appBar = view.findViewById(R.id.appbar);
+		appBar.addOnOffsetChangedListener(this);
 		initView();
 		return view;
 	}
@@ -234,6 +241,18 @@ protected void bindFeatureItem(@NonNull View itemView,
 		tvTitle.setText(getString(titleId));
 	}
 
+	@Override
+	public void onOffsetChanged(AppBarLayout appBarLayout, int verticalOffset) {
+		lastKnownToolbarOffset = verticalOffset;
+		updateToolbar();
+	}
+
+	protected void updateToolbar() {
+		updateToolbar(lastKnownToolbarOffset);
+	}
+
+	protected abstract void updateToolbar(int verticalOffset);
+
 	protected int getAlphaColor(@ColorInt int colorNoAlpha, float ratio) {
 		return UiUtilities.getColorWithAlpha(colorNoAlpha, ratio);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/chooseplan/ChoosePlanFragment.java b/OsmAnd/src/net/osmand/plus/chooseplan/ChoosePlanFragment.java
index cf0cf4b2a4f..ef2a7523664 100644
--- a/OsmAnd/src/net/osmand/plus/chooseplan/ChoosePlanFragment.java
+++ b/OsmAnd/src/net/osmand/plus/chooseplan/ChoosePlanFragment.java
@@ -99,22 +99,25 @@ private void setupToolbar() {
 
 		ImageView restoreBtn = view.findViewById(R.id.button_reset);
 		restoreBtn.setOnClickListener(v -> purchaseHelper.requestInventory());
-
-		scrollView.getViewTreeObserver().addOnScrollChangedListener(this::updateToolbar);
 	}
 
-	private void updateToolbar() {
-		View shadow = view.findViewById(R.id.toolbar_shadow);
+	@Override
+	protected void updateToolbar(int verticalOffset) {
+		float absOffset = Math.abs(verticalOffset);
+		float totalScrollRange = appBar.getTotalScrollRange();
+
+		float alpha = UiUtilities.getProportionalAlpha(totalScrollRange * 0.25f, totalScrollRange * 0.9f, absOffset);
+		float inverseAlpha = 1.0f - UiUtilities.getProportionalAlpha(totalScrollRange * 0.5f, totalScrollRange, absOffset);
+
 		View header = view.findViewById(R.id.header);
+		header.setAlpha(alpha);
+
 		TextView tvTitle = view.findViewById(R.id.toolbar_title);
-		if (scrollView.getScrollY() > header.getBottom()) {
-			shadow.setVisibility(View.VISIBLE);
-			tvTitle.setText(getString(selectedFeature.getHeaderTitleId()));
+		tvTitle.setText(getString(selectedFeature.getHeaderTitleId()));
+		tvTitle.setAlpha(inverseAlpha);
 
-		} else {
-			shadow.setVisibility(View.GONE);
-			tvTitle.setText("");
-		}
+		View shadow = view.findViewById(R.id.shadowView);
+		shadow.setAlpha(inverseAlpha);
 	}
 
 	private void setupHeaderIconBackground() {
diff --git a/OsmAnd/src/net/osmand/plus/chooseplan/SelectedPlanFragment.java b/OsmAnd/src/net/osmand/plus/chooseplan/SelectedPlanFragment.java
index 72c9277b704..33126eb200d 100644
--- a/OsmAnd/src/net/osmand/plus/chooseplan/SelectedPlanFragment.java
+++ b/OsmAnd/src/net/osmand/plus/chooseplan/SelectedPlanFragment.java
@@ -1,5 +1,6 @@
 package net.osmand.plus.chooseplan;
 
+import android.app.Dialog;
 import android.graphics.Color;
 import android.graphics.drawable.ColorDrawable;
 import android.graphics.drawable.Drawable;
@@ -7,9 +8,10 @@
 import android.net.Uri;
 import android.os.Build;
 import android.view.View;
+import android.view.Window;
+import android.view.WindowManager;
 import android.widget.ImageView;
 import android.widget.LinearLayout;
-import android.widget.ScrollView;
 import android.widget.TextView;
 
 import androidx.annotation.ColorRes;
@@ -19,6 +21,7 @@
 import net.osmand.AndroidUtils;
 import net.osmand.PlatformUtil;
 import net.osmand.plus.R;
+import net.osmand.plus.UiUtilities;
 import net.osmand.plus.Version;
 import net.osmand.plus.inapp.InAppPurchases.InAppSubscription;
 import net.osmand.plus.wikipedia.WikipediaDialogFragment;
@@ -74,49 +77,52 @@ private void setupToolbar() {
 		ImageView helpBtn = view.findViewById(R.id.button_help);
 		helpBtn.setOnClickListener(v ->
 				WikipediaDialogFragment.showFullArticle(requireActivity(), Uri.parse(PURCHASES_INFO), nightMode));
-
-		scrollView.getViewTreeObserver().addOnScrollChangedListener(this::updateToolbar);
 	}
 
-	private void updateToolbar() {
-		View container = view.findViewById(R.id.toolbar_container);
-		View shadow = view.findViewById(R.id.toolbar_shadow);
-		View header = view.findViewById(R.id.header);
+	@Override
+	protected void updateToolbar(int verticalOffset) {
+		float absOffset = Math.abs(verticalOffset);
+		float totalScrollRange = appBar.getTotalScrollRange();
+		boolean collapsed = Math.abs(verticalOffset) == appBar.getTotalScrollRange();
+
+		float alpha = UiUtilities.getProportionalAlpha(0, totalScrollRange * 0.75f, absOffset);
+		float inverseAlpha = 1.0f - UiUtilities.getProportionalAlpha(0, totalScrollRange, absOffset);
+
 		int defaultLinksColor = ContextCompat.getColor(app, getToolbarLinksColor());
 		int activeLinksColor = ContextCompat.getColor(app, getActiveToolbarLinksColor());
 		int headerBgColor = ContextCompat.getColor(app, getHeaderBgColorId());
 		int activeColor = ContextCompat.getColor(app, getActiveColorId(nightMode));
-		int toolbarColor;
+
+		View header = view.findViewById(R.id.header);
+		header.setAlpha(alpha);
 
 		ImageView icBack = view.findViewById(R.id.button_back);
 		ImageView icInfo = view.findViewById(R.id.button_help);
-		TextView tvTitle = view.findViewById(R.id.toolbar_title);
-
-		boolean paintToolbar = scrollView.getScrollY() > header.getBottom();
-		if (paintToolbar) {
-			toolbarColor = activeColor;
-			shadow.setVisibility(View.VISIBLE);
-			tvTitle.setText(getHeader());
-			tvTitle.setTextColor(activeLinksColor);
-			icBack.setColorFilter(activeLinksColor);
-			icInfo.setColorFilter(activeLinksColor);
-		} else {
-			toolbarColor = headerBgColor;
-			shadow.setVisibility(View.GONE);
-			tvTitle.setText("");
-			icBack.setColorFilter(defaultLinksColor);
-			icInfo.setColorFilter(defaultLinksColor);
-		}
+		int iconsColor = UiUtilities.getProportionalColorMix(defaultLinksColor, activeLinksColor, 0, totalScrollRange, Math.abs(verticalOffset));
+		icBack.setColorFilter(iconsColor);
+		icInfo.setColorFilter(iconsColor);
 
-		container.setBackgroundColor(toolbarColor);
-		if (Build.VERSION.SDK_INT >= 21 && getDialog() != null && getDialog().getWindow() != null) {
-			getDialog().getWindow().setStatusBarColor(toolbarColor);
+		TextView tvTitle = view.findViewById(R.id.toolbar_title);
+		tvTitle.setTextColor(activeLinksColor);
+		tvTitle.setText(getHeader());
+		tvTitle.setAlpha(inverseAlpha);
+
+		int toolbarColor = UiUtilities.getProportionalColorMix(headerBgColor, activeColor, 0, totalScrollRange, Math.abs(verticalOffset));
+		appBar.setBackgroundColor(toolbarColor);
+		Dialog dialog = getDialog();
+		if (Build.VERSION.SDK_INT >= 21 && dialog != null && dialog.getWindow() != null) {
+			Window window = dialog.getWindow();
+			window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);
+			window.setStatusBarColor(toolbarColor);
 			if (Build.VERSION.SDK_INT >= 23 && !nightMode) {
-				getDialog().getWindow().getDecorView().setSystemUiVisibility(paintToolbar ?
+				window.getDecorView().setSystemUiVisibility(collapsed ?
 						view.getSystemUiVisibility() & ~View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR :
 						view.getSystemUiVisibility() | View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);
 			}
 		}
+
+		View shadow = view.findViewById(R.id.shadowView);
+		shadow.setAlpha(inverseAlpha);
 	}
 
 	private void setupHeader() {
@@ -145,10 +151,10 @@ private void createFeaturesPreview() {
 
 	private void setupLearnMoreButton() {
 		View btn = view.findViewById(R.id.learn_more_button);
-		ScrollView scrollView = view.findViewById(R.id.scroll_view);
 		btn.setOnClickListener(v -> {
 			View includesContainer = view.findViewById(R.id.list_included);
 			scrollView.smoothScrollTo(0, includesContainer.getTop());
+			appBar.setExpanded(false);
 		});
 	}
 
