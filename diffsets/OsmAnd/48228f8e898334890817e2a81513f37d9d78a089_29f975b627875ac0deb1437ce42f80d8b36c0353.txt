diff --git a/OsmAnd/res/layout-land/coordinates_widget.xml b/OsmAnd/res/layout-land/coordinates_widget.xml
deleted file mode 100644
index 374a348e785..00000000000
--- a/OsmAnd/res/layout-land/coordinates_widget.xml
+++ /dev/null
@@ -1,101 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
-	xmlns:osmand="http://schemas.android.com/apk/res-auto"
-	xmlns:tools="http://schemas.android.com/tools"
-	android:layout_width="match_parent"
-	android:layout_height="wrap_content"
-	android:minHeight="@dimen/map_address_height"
-	android:background="@color/activity_background_dark"
-	android:clickable="true"
-	tools:ignore="KeyboardInaccessibleWidget">
-
-	<LinearLayout
-		android:layout_width="match_parent"
-		android:layout_height="wrap_content"
-		android:layout_gravity="center_vertical"
-		android:background="?attr/selectableItemBackground"
-		android:gravity="center_vertical"
-		android:orientation="horizontal"
-		tools:ignore="UselessParent">
-
-		<LinearLayout
-			android:id="@+id/first_coordinates_container"
-			android:layout_width="0dp"
-			android:layout_height="wrap_content"
-			android:layout_marginLeft="@dimen/content_padding_half"
-			android:layout_marginRight="@dimen/content_padding_half"
-			android:layout_weight="1"
-			android:orientation="horizontal"
-			android:layout_marginStart="@dimen/content_padding_half"
-			android:layout_marginEnd="@dimen/content_padding_half">
-
-			<androidx.appcompat.widget.AppCompatImageView
-				android:id="@+id/first_icon"
-				android:layout_width="@dimen/standard_icon_size"
-				android:layout_height="@dimen/standard_icon_size"
-				android:layout_gravity="center"
-				android:layout_marginTop="@dimen/content_padding_half"
-				android:layout_marginEnd="@dimen/content_padding_half"
-				android:layout_marginBottom="@dimen/content_padding_half"
-				osmand:srcCompat="@drawable/widget_coordinates_latitude_day" />
-
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/first_coordinate"
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content"
-				android:layout_gravity="center"
-				android:maxLines="1"
-				android:textDirection="ltr"
-				android:textColor="@color/activity_background_light"
-				android:textSize="@dimen/map_top_widget_text_size"
-				tools:textStyle="bold"
-				tools:text="N 20°96′60″" />
-
-		</LinearLayout>
-
-		<View
-			android:id="@+id/divider"
-			android:layout_width="1dp"
-			android:layout_height="match_parent"
-			android:layout_marginTop="@dimen/content_padding_small"
-			android:layout_marginBottom="@dimen/content_padding_small"
-			tools:background="@color/map_progress_bar_bg_light" />
-
-		<LinearLayout
-			android:id="@+id/second_container"
-			android:layout_width="0dp"
-			android:layout_height="wrap_content"
-			android:layout_marginLeft="@dimen/content_padding_half"
-			android:layout_marginRight="@dimen/content_padding_half"
-			android:layout_weight="1"
-			android:orientation="horizontal"
-			android:layout_marginStart="@dimen/content_padding_half"
-			android:layout_marginEnd="@dimen/content_padding_half">
-
-			<androidx.appcompat.widget.AppCompatImageView
-				android:id="@+id/second_icon"
-				android:layout_width="@dimen/standard_icon_size"
-				android:layout_height="@dimen/standard_icon_size"
-				android:layout_gravity="center"
-				android:layout_marginTop="@dimen/content_padding_half"
-				android:layout_marginEnd="@dimen/content_padding_half"
-				android:layout_marginBottom="@dimen/content_padding_half"
-				osmand:srcCompat="@drawable/widget_coordinates_longitude_day" />
-
-			<net.osmand.plus.widgets.TextViewEx
-				android:id="@+id/second_coordinate"
-				android:layout_width="wrap_content"
-				android:layout_height="wrap_content"
-				android:layout_gravity="center"
-				android:maxLines="1"
-				android:textDirection="ltr"
-				android:textColor="@color/activity_background_light"
-				android:textSize="@dimen/map_top_widget_text_size"
-				tools:textStyle="bold"
-				tools:text="W 120°31′12″" />
-
-		</LinearLayout>
-
-	</LinearLayout>
-
-</FrameLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout-land/lanes_widget.xml b/OsmAnd/res/layout-land/lanes_widget.xml
deleted file mode 100644
index b03df865057..00000000000
--- a/OsmAnd/res/layout-land/lanes_widget.xml
+++ /dev/null
@@ -1,53 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-	xmlns:tools="http://schemas.android.com/tools"
-	android:id="@+id/map_center_info"
-	android:layout_width="wrap_content"
-	android:layout_height="wrap_content"
-	android:layout_gravity="center_horizontal|top"
-	android:layout_marginTop="@dimen/map_button_margin"
-	android:orientation="vertical"
-	android:background="@drawable/btn_round"
-	android:visibility="gone">
-
-	<androidx.appcompat.widget.AppCompatImageView
-		android:id="@+id/map_lanes"
-		android:layout_width="wrap_content"
-		android:layout_height="wrap_content"
-		android:layout_gravity="center"
-		android:layout_marginStart="@dimen/widget_turn_lane_border"
-		android:layout_marginTop="@dimen/widget_turn_lane_border"
-		android:layout_marginEnd="@dimen/widget_turn_lane_border" />
-
-	<FrameLayout
-		android:layout_width="wrap_content"
-		android:layout_height="0dp"
-		android:layout_weight="1"
-		android:layout_gravity="center">
-
-		<TextView
-			android:id="@+id/map_lanes_dist_text_shadow"
-			android:layout_width="wrap_content"
-			android:layout_height="wrap_content"
-			android:layout_gravity="center"
-			android:layout_marginHorizontal="@dimen/widget_turn_lane_border"
-			android:maxLines="1"
-			android:importantForAccessibility="no"
-			android:textColor="@color/color_black"
-			android:textSize="@dimen/map_button_text_size"
-			tools:text="1048 km" />
-
-		<TextView
-			android:id="@+id/map_lanes_dist_text"
-			android:layout_width="wrap_content"
-			android:layout_height="wrap_content"
-			android:layout_gravity="center"
-			android:layout_marginHorizontal="@dimen/widget_turn_lane_border"
-			android:maxLines="1"
-			android:textColor="@color/color_black"
-			android:textSize="@dimen/map_button_text_size"
-			tools:text="1048 km" />
-
-	</FrameLayout>
-
-</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout-land/street_name_widget.xml b/OsmAnd/res/layout-land/street_name_widget.xml
index efb3f39e816..995869b0b30 100644
--- a/OsmAnd/res/layout-land/street_name_widget.xml
+++ b/OsmAnd/res/layout-land/street_name_widget.xml
@@ -5,24 +5,24 @@
 	android:id="@+id/street_name_widget"
 	android:layout_width="match_parent"
 	android:layout_height="wrap_content"
-	android:minHeight="@dimen/map_address_height"
-	android:background="@drawable/btn_round">
+	android:background="@drawable/btn_round"
+	android:minHeight="@dimen/map_address_height">
 
 	<LinearLayout
 		android:layout_width="wrap_content"
 		android:layout_height="wrap_content"
 		android:layout_gravity="center"
 		android:layout_marginHorizontal="@dimen/measurement_tool_menu_title_padding_bottom"
-		android:orientation="horizontal"
-		android:gravity="center">
+		android:gravity="center"
+		android:orientation="horizontal">
 
 		<net.osmand.plus.widgets.TextViewEx
 			android:id="@+id/map_exit_ref"
 			android:layout_width="wrap_content"
 			android:layout_height="wrap_content"
-			android:minWidth="@dimen/map_widget_height"
-			android:gravity="center"
 			android:background="@drawable/bg_topbar_shield_exit_ref"
+			android:gravity="center"
+			android:minWidth="@dimen/map_widget_height"
 			android:textColor="@color/color_white"
 			android:textSize="@dimen/map_widget_text_size"
 			android:visibility="gone"
@@ -85,8 +85,8 @@
 			android:id="@+id/waypoint_icon"
 			android:layout_width="wrap_content"
 			android:layout_height="wrap_content"
-			android:layout_marginHorizontal="@dimen/map_button_margin"
 			android:layout_gravity="center_vertical"
+			android:layout_marginHorizontal="@dimen/map_button_margin"
 			osmand:srcCompat="@drawable/ic_action_remove_dark" />
 
 		<LinearLayout
@@ -99,8 +99,8 @@
 				android:id="@+id/waypoint_dist"
 				android:layout_width="@dimen/card_title_row_min_height"
 				android:layout_height="wrap_content"
-				android:layout_marginStart="@dimen/favorites_icon_padding"
 				android:layout_gravity="center_vertical"
+				android:layout_marginStart="@dimen/favorites_icon_padding"
 				android:maxLines="2"
 				android:textColor="@color/osmand_orange"
 				android:textSize="@dimen/default_list_text_size"
@@ -110,8 +110,8 @@
 				android:id="@+id/waypoint_deviation"
 				android:layout_width="@dimen/card_title_row_min_height"
 				android:layout_height="wrap_content"
-				android:layout_marginStart="@dimen/favorites_icon_padding"
 				android:layout_gravity="bottom"
+				android:layout_marginStart="@dimen/favorites_icon_padding"
 				android:drawablePadding="@dimen/favorites_icon_padding"
 				android:maxLines="1"
 				android:textColor="@color/osmand_orange"
@@ -124,8 +124,8 @@
 		<FrameLayout
 			android:layout_width="0dp"
 			android:layout_height="wrap_content"
-			android:layout_marginStart="@dimen/list_item_button_padding"
 			android:layout_gravity="center_vertical"
+			android:layout_marginStart="@dimen/list_item_button_padding"
 			android:layout_weight="1">
 
 
@@ -134,8 +134,8 @@
 				android:layout_width="wrap_content"
 				android:layout_height="wrap_content"
 				android:ellipsize="end"
-				android:maxLines="2"
 				android:importantForAccessibility="no"
+				android:maxLines="2"
 				android:textColor="@color/color_black"
 				android:textSize="@dimen/map_button_text_size"
 				tools:text="Waypoint" />
@@ -154,20 +154,20 @@
 
 		<ImageButton
 			android:id="@+id/waypoint_more"
-			android:contentDescription="@string/shared_string_more"
 			android:layout_width="@dimen/map_address_height"
 			android:layout_height="@dimen/map_address_height"
 			android:layout_gravity="center_vertical"
 			android:background="@drawable/btn_circle_transparent"
+			android:contentDescription="@string/shared_string_more"
 			osmand:srcCompat="@drawable/ic_overflow_menu_white" />
 
 		<ImageButton
 			android:id="@+id/waypoint_close"
-			android:contentDescription="@string/shared_string_close"
 			android:layout_width="@dimen/map_address_height"
 			android:layout_height="@dimen/map_address_height"
 			android:layout_gravity="center_vertical"
 			android:background="@drawable/btn_circle_transparent"
+			android:contentDescription="@string/shared_string_close"
 			osmand:srcCompat="@drawable/ic_action_remove_dark" />
 
 	</LinearLayout>
diff --git a/OsmAnd/res/layout/configure_screen_widget_item.xml b/OsmAnd/res/layout/configure_screen_widget_item.xml
index df49c1797e7..c8eeec145a7 100644
--- a/OsmAnd/res/layout/configure_screen_widget_item.xml
+++ b/OsmAnd/res/layout/configure_screen_widget_item.xml
@@ -1,6 +1,5 @@
 <?xml version="1.0" encoding="utf-8"?>
-<LinearLayout
-	xmlns:android="http://schemas.android.com/apk/res/android"
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
 	xmlns:tools="http://schemas.android.com/tools"
 	android:layout_width="match_parent"
 	android:layout_height="wrap_content"
@@ -20,16 +19,16 @@
 			android:layout_height="@dimen/standard_icon_size"
 			android:layout_gravity="center_vertical"
 			android:layout_marginHorizontal="@dimen/content_padding"
-			tools:src="@drawable/ic_action_info_dark"/>
+			tools:src="@drawable/ic_action_info_dark" />
 
 		<LinearLayout
 			android:id="@+id/text_wrapper"
 			android:layout_width="0dp"
 			android:layout_height="wrap_content"
-			android:layout_weight="1"
 			android:layout_gravity="center_vertical"
-			android:layout_marginStart="@dimen/content_padding"
 			android:layout_marginVertical="@dimen/content_padding_small"
+			android:layout_marginStart="@dimen/content_padding"
+			android:layout_weight="1"
 			android:gravity="center_vertical"
 			android:orientation="vertical">
 
@@ -38,7 +37,7 @@
 				android:layout_width="match_parent"
 				android:layout_height="wrap_content"
 				android:textAppearance="@style/TextAppearance.ListItemTitle"
-				tools:text="Some title text"/>
+				tools:text="Some title text" />
 
 			<androidx.appcompat.widget.AppCompatTextView
 				android:id="@+id/description"
@@ -48,7 +47,7 @@
 				android:lines="1"
 				android:textColor="?android:textColorSecondary"
 				android:textSize="@dimen/default_desc_text_size"
-				tools:text="Some very long subtitle text, that won't fit into one line"/>
+				tools:text="Some very long subtitle text, that won't fit into one line" />
 
 		</LinearLayout>
 
@@ -59,15 +58,24 @@
 			android:layout_gravity="center_vertical"
 			android:layout_margin="@dimen/content_padding"
 			android:tint="?attr/default_icon_color"
-			tools:src="@drawable/ic_action_additional_option"/>
+			tools:src="@drawable/ic_action_additional_option" />
 
-		<androidx.appcompat.widget.SwitchCompat
-			android:id="@+id/compound_button"
+		<FrameLayout
+			android:id="@+id/switch_container"
 			android:layout_width="wrap_content"
-			android:layout_height="match_parent"
-			android:layout_gravity="center_vertical"
-			android:layout_marginEnd="@dimen/content_padding"
-			android:focusable="false"/>
+			android:layout_height="match_parent">
+
+			<androidx.appcompat.widget.SwitchCompat
+				android:id="@+id/compound_button"
+				android:layout_width="wrap_content"
+				android:layout_height="match_parent"
+				android:layout_gravity="center_vertical"
+				android:layout_marginEnd="@dimen/content_padding"
+				android:background="@null"
+				android:clickable="false"
+				android:focusable="false" />
+
+		</FrameLayout>
 
 	</LinearLayout>
 
diff --git a/OsmAnd/res/layout/coordinates_widget.xml b/OsmAnd/res/layout/coordinates_widget.xml
index 697ec22d55b..d902590b074 100644
--- a/OsmAnd/res/layout/coordinates_widget.xml
+++ b/OsmAnd/res/layout/coordinates_widget.xml
@@ -4,9 +4,9 @@
 	xmlns:tools="http://schemas.android.com/tools"
 	android:layout_width="match_parent"
 	android:layout_height="wrap_content"
-	android:minHeight="@dimen/map_address_height"
 	android:background="@color/activity_background_dark"
 	android:clickable="true"
+	android:minHeight="@dimen/map_address_height"
 	tools:ignore="KeyboardInaccessibleWidget">
 
 	<LinearLayout
@@ -22,12 +22,12 @@
 			android:id="@+id/first_coordinates_container"
 			android:layout_width="0dp"
 			android:layout_height="wrap_content"
+			android:layout_marginStart="@dimen/content_padding_half"
 			android:layout_marginLeft="@dimen/content_padding_half"
+			android:layout_marginEnd="@dimen/content_padding_half"
 			android:layout_marginRight="@dimen/content_padding_half"
 			android:layout_weight="1"
-			android:orientation="horizontal"
-			android:layout_marginEnd="@dimen/content_padding_half"
-			android:layout_marginStart="@dimen/content_padding_half">
+			android:orientation="horizontal">
 
 			<androidx.appcompat.widget.AppCompatImageView
 				android:id="@+id/first_icon"
@@ -45,11 +45,11 @@
 				android:layout_height="wrap_content"
 				android:layout_gravity="center"
 				android:maxLines="1"
-				android:textDirection="ltr"
 				android:textColor="@color/activity_background_light"
+				android:textDirection="ltr"
 				android:textSize="@dimen/map_top_widget_text_size"
-				tools:textStyle="bold"
-				tools:text="N 20°96′60″" />
+				tools:text="N 20°96′60″"
+				tools:textStyle="bold" />
 
 		</LinearLayout>
 
@@ -65,12 +65,12 @@
 			android:id="@+id/second_container"
 			android:layout_width="0dp"
 			android:layout_height="wrap_content"
+			android:layout_marginStart="@dimen/content_padding_half"
 			android:layout_marginLeft="@dimen/content_padding_half"
+			android:layout_marginEnd="@dimen/content_padding_half"
 			android:layout_marginRight="@dimen/content_padding_half"
 			android:layout_weight="1"
-			android:orientation="horizontal"
-			android:layout_marginEnd="@dimen/content_padding_half"
-			android:layout_marginStart="@dimen/content_padding_half">
+			android:orientation="horizontal">
 
 			<androidx.appcompat.widget.AppCompatImageView
 				android:id="@+id/second_icon"
@@ -88,11 +88,11 @@
 				android:layout_height="wrap_content"
 				android:layout_gravity="center"
 				android:maxLines="1"
-				android:textDirection="ltr"
 				android:textColor="@color/activity_background_light"
+				android:textDirection="ltr"
 				android:textSize="@dimen/map_top_widget_text_size"
-				tools:textStyle="bold"
-				tools:text="W 120°31′12″" />
+				tools:text="W 120°31′12″"
+				tools:textStyle="bold" />
 
 		</LinearLayout>
 
diff --git a/OsmAnd/res/layout/lanes_widget.xml b/OsmAnd/res/layout/lanes_widget.xml
index b03df865057..222585ea0b8 100644
--- a/OsmAnd/res/layout/lanes_widget.xml
+++ b/OsmAnd/res/layout/lanes_widget.xml
@@ -6,8 +6,8 @@
 	android:layout_height="wrap_content"
 	android:layout_gravity="center_horizontal|top"
 	android:layout_marginTop="@dimen/map_button_margin"
-	android:orientation="vertical"
 	android:background="@drawable/btn_round"
+	android:orientation="vertical"
 	android:visibility="gone">
 
 	<androidx.appcompat.widget.AppCompatImageView
@@ -22,8 +22,8 @@
 	<FrameLayout
 		android:layout_width="wrap_content"
 		android:layout_height="0dp"
-		android:layout_weight="1"
-		android:layout_gravity="center">
+		android:layout_gravity="center"
+		android:layout_weight="1">
 
 		<TextView
 			android:id="@+id/map_lanes_dist_text_shadow"
@@ -31,8 +31,8 @@
 			android:layout_height="wrap_content"
 			android:layout_gravity="center"
 			android:layout_marginHorizontal="@dimen/widget_turn_lane_border"
-			android:maxLines="1"
 			android:importantForAccessibility="no"
+			android:maxLines="1"
 			android:textColor="@color/color_black"
 			android:textSize="@dimen/map_button_text_size"
 			tools:text="1048 km" />
diff --git a/OsmAnd/res/layout/street_name_widget.xml b/OsmAnd/res/layout/street_name_widget.xml
index 61b040e3d44..6b14f0bdc46 100644
--- a/OsmAnd/res/layout/street_name_widget.xml
+++ b/OsmAnd/res/layout/street_name_widget.xml
@@ -4,29 +4,29 @@
 	android:id="@+id/street_name_widget"
 	android:layout_width="match_parent"
 	android:layout_height="wrap_content"
-	android:minHeight="@dimen/map_address_height"
-	android:background="@drawable/btn_flat">
+	android:background="@drawable/btn_flat"
+	android:minHeight="@dimen/map_address_height">
 
 	<LinearLayout
 		android:layout_width="match_parent"
 		android:layout_height="wrap_content"
-		android:orientation="horizontal"
-		android:layout_marginHorizontal="@dimen/measurement_tool_menu_title_padding_bottom"
 		android:layout_gravity="center"
-		android:gravity="center">
+		android:layout_marginHorizontal="@dimen/measurement_tool_menu_title_padding_bottom"
+		android:gravity="center"
+		android:orientation="horizontal">
 
 		<net.osmand.plus.widgets.TextViewEx
 			android:id="@+id/map_exit_ref"
 			android:layout_width="wrap_content"
 			android:layout_height="wrap_content"
-			android:minWidth="@dimen/map_widget_height"
+			android:background="@drawable/bg_topbar_shield_exit_ref"
 			android:gravity="center"
+			android:minWidth="@dimen/map_widget_height"
 			android:paddingHorizontal="@dimen/text_margin_small"
-			android:background="@drawable/bg_topbar_shield_exit_ref"
-			android:visibility="gone"
 			android:textColor="@color/color_white"
 			android:textSize="@dimen/map_widget_text_size"
 			android:textStyle="bold"
+			android:visibility="gone"
 			tools:text="8"
 			tools:visibility="visible" />
 
@@ -137,8 +137,8 @@
 				android:layout_width="wrap_content"
 				android:layout_height="wrap_content"
 				android:ellipsize="end"
-				android:maxLines="2"
 				android:importantForAccessibility="no"
+				android:maxLines="2"
 				android:textColor="@color/color_black"
 				android:textSize="@dimen/map_button_text_size"
 				tools:text="Waypoint" />
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index 55fbcf09e93..438671e9968 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -18,7 +18,6 @@
     <string name="shared_string_item">Item</string>
     <string name="shared_string_buttons">Buttons</string>
     <string name="configure_screen_widgets_descr">Select screen side to add or rearange widgets.</string>
-    <string name="rendering_attr_showFitnessTrails_name">Show fitness trails</string>
     <string name="osm_carto_render_descr">Similar to OpenStreetMap-carto style used on main OSM site</string>
     <string name="rendering_attr_showRunningRoutes_name">Running routes</string>
     <string name="rendering_attr_showRunningRoutes_description">Show running routes</string>
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
index 3fb5694b9a0..8638820deeb 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
@@ -778,7 +778,7 @@ private ContextMenuAdapter createNormalOptionsMenu(final OsmandApplication app,
 				.setTitleId(R.string.layer_map_appearance, mapActivity)
 				.setIcon(R.drawable.ic_configure_screen_dark)
 				.setListener((adapter, itemId, pos, isChecked, viewCoordinates) -> {
-					app.logEvent("config_screen_open");
+					app.logEvent("drawer_config_screen_open");
 					MapActivity.clearPrevActivityIntent();
 					ConfigureScreenFragment.showInstance(mapActivity);
 					return true;
diff --git a/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java b/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java
index c35a16097d4..011496c98af 100644
--- a/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java
+++ b/OsmAnd/src/net/osmand/plus/dashboard/DashboardOnMap.java
@@ -753,8 +753,6 @@ public void refreshContent(boolean force) {
 		if (force) {
 			listView.clearParams();
 			updateListAdapter();
-		} else if (visibleType == DashboardType.CONFIGURE_SCREEN) {
-			updateListAdapter();
 		} else if (visibleType == DashboardType.CONFIGURE_MAP || visibleType == DashboardType.ROUTE_PREFERENCES) {
 			int index = listView.getFirstVisiblePosition();
 			View v = listView.getChildAt(0);
diff --git a/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
index c49cd0bdc00..e1348f5051f 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesPlugin.java
@@ -1,5 +1,11 @@
 package net.osmand.plus.plugins.audionotes;
 
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.MAP_CONTEXT_MENU_AUDIO_NOTE;
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.MAP_CONTEXT_MENU_PHOTO_NOTE;
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.MAP_CONTEXT_MENU_VIDEO_NOTE;
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.PLUGIN_AUDIO_VIDEO_NOTES;
+import static net.osmand.aidlapi.OsmAndCustomizationConstants.RECORDING_LAYER;
+
 import android.Manifest;
 import android.annotation.TargetApi;
 import android.app.Activity;
@@ -30,6 +36,11 @@
 import android.view.WindowManager;
 import android.widget.Toast;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.appcompat.app.AlertDialog;
+import androidx.core.app.ActivityCompat;
+
 import net.osmand.IProgress;
 import net.osmand.IndexConstants;
 import net.osmand.Location;
@@ -37,9 +48,6 @@
 import net.osmand.data.DataTileManager;
 import net.osmand.data.LatLon;
 import net.osmand.data.PointDescription;
-import net.osmand.plus.widgets.cmadapter.ContextMenuAdapter;
-import net.osmand.plus.widgets.cmadapter.callback.ItemClickListener;
-import net.osmand.plus.widgets.cmadapter.item.ContextMenuItem;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
@@ -65,6 +73,9 @@
 import net.osmand.plus.views.mapwidgets.widgets.RightTextInfoWidget;
 import net.osmand.plus.views.mapwidgets.widgets.TextInfoWidget;
 import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
+import net.osmand.plus.widgets.cmadapter.ContextMenuAdapter;
+import net.osmand.plus.widgets.cmadapter.callback.ItemClickListener;
+import net.osmand.plus.widgets.cmadapter.item.ContextMenuItem;
 import net.osmand.render.RenderingRuleProperty;
 import net.osmand.util.Algorithms;
 import net.osmand.util.GeoPointParserUtil.GeoParsedPoint;
@@ -89,17 +100,6 @@
 import java.util.Timer;
 import java.util.TimerTask;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.appcompat.app.AlertDialog;
-import androidx.core.app.ActivityCompat;
-
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.MAP_CONTEXT_MENU_AUDIO_NOTE;
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.MAP_CONTEXT_MENU_PHOTO_NOTE;
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.MAP_CONTEXT_MENU_VIDEO_NOTE;
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.PLUGIN_AUDIO_VIDEO_NOTES;
-import static net.osmand.aidlapi.OsmAndCustomizationConstants.RECORDING_LAYER;
-
 
 public class AudioVideoNotesPlugin extends OsmandPlugin {
 
@@ -2059,92 +2059,4 @@ public Drawable getAssetResourceImage() {
 	public DashFragmentData getCardFragment() {
 		return DashAudioVideoNotesFragment.FRAGMENT_DATA;
 	}
-
-	public static class AudioVideoNotesWidgetState extends WidgetState {
-
-		private final CommonPreference<Integer> defaultActionSetting;
-
-		private static final int AV_WIDGET_STATE_ASK = R.id.av_notes_widget_state_ask;
-		private static final int AV_WIDGET_STATE_AUDIO = R.id.av_notes_widget_state_audio;
-		private static final int AV_WIDGET_STATE_VIDEO = R.id.av_notes_widget_state_video;
-		private static final int AV_WIDGET_STATE_PHOTO = R.id.av_notes_widget_state_photo;
-
-		AudioVideoNotesWidgetState(OsmandApplication ctx, CommonPreference<Integer> defaultActionSetting) {
-			super(ctx);
-			this.defaultActionSetting = defaultActionSetting;
-		}
-
-		@Override
-		public int getMenuTitleId() {
-			Integer action = defaultActionSetting.get();
-			switch (action) {
-				case AV_DEFAULT_ACTION_AUDIO:
-					return R.string.av_def_action_audio;
-				case AV_DEFAULT_ACTION_VIDEO:
-					return R.string.av_def_action_video;
-				case AV_DEFAULT_ACTION_TAKEPICTURE:
-					return R.string.av_def_action_picture;
-				default:
-					return R.string.map_widget_av_notes;
-			}
-		}
-
-		@Override
-		public int getSettingsIconId() {
-			Integer action = defaultActionSetting.get();
-			switch (action) {
-				case AV_DEFAULT_ACTION_AUDIO:
-					return R.drawable.ic_action_micro_dark;
-				case AV_DEFAULT_ACTION_VIDEO:
-					return R.drawable.ic_action_video_dark;
-				case AV_DEFAULT_ACTION_TAKEPICTURE:
-					return R.drawable.ic_action_photo_dark;
-				default:
-					return R.drawable.ic_action_photo_dark;
-			}
-		}
-
-		@Override
-		public int getMenuItemId() {
-			Integer action = defaultActionSetting.get();
-			switch (action) {
-				case AV_DEFAULT_ACTION_AUDIO:
-					return AV_WIDGET_STATE_AUDIO;
-				case AV_DEFAULT_ACTION_VIDEO:
-					return AV_WIDGET_STATE_VIDEO;
-				case AV_DEFAULT_ACTION_TAKEPICTURE:
-					return AV_WIDGET_STATE_PHOTO;
-				default:
-					return AV_WIDGET_STATE_ASK;
-			}
-		}
-
-		@Override
-		public int[] getMenuTitleIds() {
-			return new int[]{R.string.av_def_action_choose, R.string.av_def_action_audio, R.string.av_def_action_video, R.string.av_def_action_picture};
-		}
-
-		@Override
-		public int[] getMenuIconIds() {
-			return new int[]{R.drawable.ic_action_photo_dark, R.drawable.ic_action_micro_dark, R.drawable.ic_action_video_dark, R.drawable.ic_action_photo_dark};
-		}
-
-		@Override
-		public int[] getMenuItemIds() {
-			return new int[]{AV_WIDGET_STATE_ASK, AV_WIDGET_STATE_AUDIO, AV_WIDGET_STATE_VIDEO, AV_WIDGET_STATE_PHOTO};
-		}
-
-		@Override
-		public void changeState(int stateId) {
-			if (stateId == AV_WIDGET_STATE_AUDIO) {
-				defaultActionSetting.set(AV_DEFAULT_ACTION_AUDIO);
-			} else if (stateId == AV_WIDGET_STATE_VIDEO) {
-				defaultActionSetting.set(AV_DEFAULT_ACTION_VIDEO);
-			} else if (stateId == AV_WIDGET_STATE_PHOTO) {
-				defaultActionSetting.set(AV_DEFAULT_ACTION_TAKEPICTURE);
-			} else {
-				defaultActionSetting.set(AV_DEFAULT_ACTION_CHOOSE);
-			}
-		}
-	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesWidgetState.java b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesWidgetState.java
new file mode 100644
index 00000000000..663147b0b2e
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/plugins/audionotes/AudioVideoNotesWidgetState.java
@@ -0,0 +1,94 @@
+package net.osmand.plus.plugins.audionotes;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.settings.backend.preferences.CommonPreference;
+import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
+
+public class AudioVideoNotesWidgetState extends WidgetState {
+
+	private final CommonPreference<Integer> defaultActionSetting;
+
+	private static final int AV_WIDGET_STATE_ASK = R.id.av_notes_widget_state_ask;
+	private static final int AV_WIDGET_STATE_AUDIO = R.id.av_notes_widget_state_audio;
+	private static final int AV_WIDGET_STATE_VIDEO = R.id.av_notes_widget_state_video;
+	private static final int AV_WIDGET_STATE_PHOTO = R.id.av_notes_widget_state_photo;
+
+	AudioVideoNotesWidgetState(OsmandApplication ctx, CommonPreference<Integer> defaultActionSetting) {
+		super(ctx);
+		this.defaultActionSetting = defaultActionSetting;
+	}
+
+	@Override
+	public int getMenuTitleId() {
+		Integer action = defaultActionSetting.get();
+		switch (action) {
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_AUDIO:
+				return R.string.av_def_action_audio;
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_VIDEO:
+				return R.string.av_def_action_video;
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_TAKEPICTURE:
+				return R.string.av_def_action_picture;
+			default:
+				return R.string.map_widget_av_notes;
+		}
+	}
+
+	@Override
+	public int getSettingsIconId() {
+		Integer action = defaultActionSetting.get();
+		switch (action) {
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_AUDIO:
+				return R.drawable.ic_action_micro_dark;
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_VIDEO:
+				return R.drawable.ic_action_video_dark;
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_TAKEPICTURE:
+				return R.drawable.ic_action_photo_dark;
+			default:
+				return R.drawable.ic_action_photo_dark;
+		}
+	}
+
+	@Override
+	public int getMenuItemId() {
+		Integer action = defaultActionSetting.get();
+		switch (action) {
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_AUDIO:
+				return AV_WIDGET_STATE_AUDIO;
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_VIDEO:
+				return AV_WIDGET_STATE_VIDEO;
+			case AudioVideoNotesPlugin.AV_DEFAULT_ACTION_TAKEPICTURE:
+				return AV_WIDGET_STATE_PHOTO;
+			default:
+				return AV_WIDGET_STATE_ASK;
+		}
+	}
+
+	@Override
+	public int[] getMenuTitleIds() {
+		return new int[] {R.string.av_def_action_choose, R.string.av_def_action_audio, R.string.av_def_action_video, R.string.av_def_action_picture};
+	}
+
+	@Override
+	public int[] getMenuIconIds() {
+		return new int[] {R.drawable.ic_action_photo_dark, R.drawable.ic_action_micro_dark, R.drawable.ic_action_video_dark, R.drawable.ic_action_photo_dark};
+	}
+
+	@Override
+	public int[] getMenuItemIds() {
+		return new int[] {AV_WIDGET_STATE_ASK, AV_WIDGET_STATE_AUDIO, AV_WIDGET_STATE_VIDEO, AV_WIDGET_STATE_PHOTO};
+	}
+
+	@Override
+	public void changeState(int stateId) {
+		if (stateId == AV_WIDGET_STATE_AUDIO) {
+			defaultActionSetting.set(AudioVideoNotesPlugin.AV_DEFAULT_ACTION_AUDIO);
+		} else if (stateId == AV_WIDGET_STATE_VIDEO) {
+			defaultActionSetting.set(AudioVideoNotesPlugin.AV_DEFAULT_ACTION_VIDEO);
+		} else if (stateId == AV_WIDGET_STATE_PHOTO) {
+			defaultActionSetting.set(AudioVideoNotesPlugin.AV_DEFAULT_ACTION_TAKEPICTURE);
+		} else {
+			defaultActionSetting.set(AudioVideoNotesPlugin.AV_DEFAULT_ACTION_CHOOSE);
+		}
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
index 2a737532a15..88d277fc0a6 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ConfigureProfileFragment.java
@@ -1,5 +1,7 @@
 package net.osmand.plus.settings.fragments;
 
+import static net.osmand.plus.utils.UiUtilities.CompoundButtonType.TOOLBAR;
+
 import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
@@ -59,8 +61,6 @@
 import java.util.Collections;
 import java.util.List;
 
-import static net.osmand.plus.utils.UiUtilities.CompoundButtonType.TOOLBAR;
-
 public class ConfigureProfileFragment extends BaseSettingsFragment implements CopyAppModePrefsListener,
 		ResetAppModePrefsListener, PluginStateListener {
 
@@ -107,15 +107,11 @@ protected void createToolbar(LayoutInflater inflater, View view) {
 		toolbarSubtitle.setText(R.string.configure_profile);
 		toolbarSubtitle.setVisibility(View.VISIBLE);
 
-		view.findViewById(R.id.toolbar_switch_container).setOnClickListener(new View.OnClickListener() {
-			@Override
-			public void onClick(View view) {
-				ApplicationMode selectedMode = getSelectedAppMode();
-				List<ApplicationMode> availableAppModes = ApplicationMode.values(app);
-				boolean isChecked = availableAppModes.contains(selectedMode);
-				ApplicationMode.changeProfileAvailability(selectedMode, !isChecked, getMyApplication());
-				updateToolbarSwitch();
-			}
+		view.findViewById(R.id.toolbar_switch_container).setOnClickListener(view1 -> {
+			ApplicationMode selectedMode = getSelectedAppMode();
+			boolean isChecked = ApplicationMode.values(app).contains(selectedMode);
+			ApplicationMode.changeProfileAvailability(selectedMode, !isChecked, getMyApplication());
+			updateToolbarSwitch();
 		});
 
 		View switchProfile = view.findViewById(R.id.profile_button);
@@ -244,7 +240,7 @@ private RecyclerView.ItemDecoration createDividerItemDecoration() {
 
 		return new RecyclerView.ItemDecoration() {
 			@Override
-			public void onDraw(Canvas canvas, RecyclerView parent, RecyclerView.State state) {
+			public void onDraw(@NonNull Canvas canvas, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) {
 				int dividerLeft = parent.getPaddingLeft();
 				int dividerRight = parent.getWidth() - parent.getPaddingRight();
 
@@ -266,7 +262,7 @@ public void onDraw(Canvas canvas, RecyclerView parent, RecyclerView.State state)
 			}
 
 			@Override
-			public void getItemOffsets(Rect outRect, View view, RecyclerView parent, RecyclerView.State state) {
+			public void getItemOffsets(@NonNull Rect outRect, @NonNull View view, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) {
 				if (shouldDrawDivider(view)) {
 					outRect.set(0, 0, 0, pluginDividerHeight);
 				}
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
index d1aea45b088..d0dff335b8f 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
@@ -1,6 +1,28 @@
 package net.osmand.plus.views.layers;
 
 
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_ALTITUDE;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_BATTERY;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_BEARING;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_COORDINATES;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_DISTANCE;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_GPS_INFO;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_INTERMEDIATE_DISTANCE;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_INTERMEDIATE_TIME;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_LANES;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MAP_MARKERS;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MARKER_1;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MARKER_2;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MAX_SPEED;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_NEXT_NEXT_TURN;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_NEXT_TURN;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_NEXT_TURN_SMALL;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_PLAIN_TIME;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_RADIUS_RULER;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_SPEED;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_STREET_NAME;
+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_TIME;
+
 import android.content.Context;
 import android.graphics.Canvas;
 import android.graphics.drawable.Drawable;
@@ -8,6 +30,12 @@
 import android.view.ViewGroup;
 import android.widget.ImageButton;
 
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.annotation.StringRes;
+import androidx.core.content.ContextCompat;
+
 import net.osmand.StateChangedListener;
 import net.osmand.data.RotatedTileBox;
 import net.osmand.plus.OsmandApplication;
@@ -46,34 +74,6 @@
 import java.util.ArrayList;
 import java.util.List;
 
-import androidx.annotation.DrawableRes;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.annotation.StringRes;
-import androidx.core.content.ContextCompat;
-
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_ALTITUDE;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_BATTERY;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_BEARING;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_COORDINATES;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_DISTANCE;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_GPS_INFO;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_INTERMEDIATE_DISTANCE;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_INTERMEDIATE_TIME;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_LANES;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MAP_MARKERS;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MARKER_1;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MARKER_2;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_MAX_SPEED;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_NEXT_NEXT_TURN;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_NEXT_TURN;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_NEXT_TURN_SMALL;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_PLAIN_TIME;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_RADIUS_RULER;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_SPEED;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_STREET_NAME;
-import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_TIME;
-
 public class MapInfoLayer extends OsmandMapLayer {
 
 	private static boolean WIDGETS_EXPANDED = false;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/CenterWidgetInfo.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/CenterWidgetInfo.java
index e68388ad1b0..077c87ed412 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/CenterWidgetInfo.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/CenterWidgetInfo.java
@@ -1,14 +1,14 @@
 package net.osmand.plus.views.mapwidgets;
 
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
-import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
-
 import androidx.annotation.DrawableRes;
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.annotation.StringRes;
 
+import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
+import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
+
 public class CenterWidgetInfo extends MapWidgetInfo {
 
 	public CenterWidgetInfo(@NonNull String key,
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
index b879fd95bd7..7fb8a839a57 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetInfo.java
@@ -9,9 +9,6 @@
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
 
-import java.util.LinkedHashSet;
-import java.util.Set;
-
 public abstract class MapWidgetInfo implements Comparable<MapWidgetInfo> {
 
 	public static final int INVALID_ID = 0;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
index 7dde4423723..334ec1b638f 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MapWidgetRegistry.java
@@ -11,12 +11,14 @@
 import androidx.annotation.Nullable;
 import androidx.annotation.StringRes;
 
+import net.osmand.CallbackWithObject;
 import net.osmand.StateChangedListener;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.inapp.InAppPurchaseHelper;
 import net.osmand.plus.mapmarkers.DirectionIndicationDialogFragment;
+import net.osmand.plus.quickaction.QuickActionListFragment;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.backend.preferences.OsmandPreference;
@@ -204,7 +206,6 @@ public MapWidgetInfo registerWidget(@NonNull String key,
 	                                    int priorityOrder,
 	                                    @NonNull WidgetsPanel widgetPanel) {
 		MapWidgetInfo widgetInfo;
-
 		if (widget instanceof TextInfoWidget) {
 			widgetInfo = new SideWidgetInfo(key, widget, widgetState, settingsIconId, messageId, message,
 					priorityOrder, widgetPanel);
@@ -291,9 +292,9 @@ private void setVisibility(ArrayAdapter<ContextMenuItem> adapter,
 		adapter.notifyDataSetChanged();
 	}
 
-	public void setVisibility(MapWidgetInfo m, boolean visible, boolean collapsed) {
+	public void setVisibility(@NonNull MapWidgetInfo widgetInfo, boolean visible, boolean collapsed) {
 		ApplicationMode mode = settings.APPLICATION_MODE.get();
-		setVisibility(mode, m, visible, collapsed);
+		setVisibility(mode, widgetInfo, visible, collapsed);
 	}
 
 	public void setVisibility(ApplicationMode mode, MapWidgetInfo m, boolean visible, boolean collapsed) {
@@ -498,7 +499,7 @@ public boolean onContextMenuClick(ArrayAdapter<ContextMenuItem> adapter, int ite
 
 					@Override
 					public boolean onRowItemClick(ArrayAdapter<ContextMenuItem> adapter, View view, int itemId, int position) {
-//						QuickActionListFragment.showInstance(mapActivity, true, true);
+						QuickActionListFragment.showInstance(mapActivity, true);
 						return true;
 					}
 
@@ -546,11 +547,14 @@ public boolean onRowItemClick(final ArrayAdapter<ContextMenuItem> adapter,
 								return false;
 							}
 							boolean selected = r.isVisibleCollapsed(mode) || r.isVisible(mode);
-							showPopUpMenu(mapActivity, view, adapter, r.getWidgetState(), r.getMessage(), mode,
+
+							WidgetState widgetState = r.getWidgetState();
+							CallbackWithObject<WidgetState> callback = getWidgetStateCallback(adapter, widgetState, r.getMessage(), pos);
+							showPopUpMenu(view, callback, widgetState, mode,
 									getPopupMenuItemListener(adapter, r, pos, true, false),
 									getPopupMenuItemListener(adapter, r, pos, false, false),
 									getPopupMenuItemListener(adapter, r, pos, true, true),
-									selected, pos);
+									selected);
 
 							return false;
 						}
@@ -572,14 +576,25 @@ public boolean onContextMenuClick(ArrayAdapter<ContextMenuItem> a,
 		}
 	}
 
-	private OnClickListener getPopupMenuItemListener(final ArrayAdapter<ContextMenuItem> adapter,
-	                                                      final MapWidgetInfo r,
-	                                                      final int pos,
-	                                                      final boolean visible,
-	                                                      final boolean collapsed) {
+	private OnClickListener getPopupMenuItemListener(ArrayAdapter<ContextMenuItem> adapter, MapWidgetInfo r, int pos, boolean visible, boolean collapsed) {
 		return v -> setVisibility(adapter, r, pos, visible, collapsed);
 	}
 
+	private CallbackWithObject<WidgetState> getWidgetStateCallback(ArrayAdapter<ContextMenuItem> adapter, WidgetState widgetState, String message, int pos) {
+		return result -> {
+			ContextMenuItem item = adapter.getItem(pos);
+			if (message != null) {
+				item.setTitle(message);
+			} else {
+				item.setTitle(getString(widgetState.getMenuTitleId()));
+			}
+			item.setIcon(widgetState.getSettingsIconId());
+
+			adapter.notifyDataSetChanged();
+			return false;
+		};
+	}
+
 	public void addControlsAppearance(@NonNull MapActivity mapActivity, @NonNull ContextMenuAdapter cm, @NonNull ApplicationMode mode) {
 		if (mode != ApplicationMode.DEFAULT) {
 			addControlId(mapActivity, cm, R.string.map_widget_top_text, settings.SHOW_STREET_NAME);
@@ -633,10 +648,11 @@ public boolean onRowItemClick(final ArrayAdapter<ContextMenuItem> adapter,
 					                              final int itemId,
 					                              final int pos) {
 						boolean selected = pref.get();
-						showPopUpMenu(mapActivity, view, adapter, widgetState, null, mode,
+						CallbackWithObject<WidgetState> callback = getWidgetStateCallback(adapter, widgetState, null, pos);
+						showPopUpMenu(view, callback, widgetState, mode,
 								getElevationPopupMenuItemListener(mapActivity, adapter, pref, pos, true),
 								getElevationPopupMenuItemListener(mapActivity, adapter, pref, pos, false),
-								null, selected, pos);
+								null, selected);
 						return false;
 					}
 
@@ -661,17 +677,14 @@ public OnClickListener getElevationPopupMenuItemListener(@NonNull MapActivity ma
 		};
 	}
 
-	public void showPopUpMenu(@NonNull MapActivity mapActivity,
-	                          @NonNull View view,
-	                          @NonNull final ArrayAdapter<ContextMenuItem> adapter,
+	public void showPopUpMenu(@NonNull View view,
+	                          @NonNull final CallbackWithObject<WidgetState> callback,
 	                          @Nullable final WidgetState widgetState,
-	                          @Nullable final String message,
 	                          @NonNull ApplicationMode mode,
-	                          @NonNull OnClickListener showBtnListener,
-	                          @NonNull OnClickListener hideBtnListener,
+	                          @Nullable OnClickListener showBtnListener,
+	                          @Nullable OnClickListener hideBtnListener,
 	                          @Nullable OnClickListener collapseBtnListener,
-	                          boolean selected,
-	                          final int pos) {
+	                          boolean selected) {
 		final boolean nightMode = app.getDaynightHelper().isNightModeForMapControls();
 		final int currentModeColor = mode.getProfileColor(nightMode);
 		View parentView = view.findViewById(R.id.text_wrapper);
@@ -697,18 +710,11 @@ public void showPopUpMenu(@NonNull MapActivity mapActivity,
 							.setIcon(icon)
 							.setOnClickListener(v -> {
 								widgetState.changeState(id);
-								MapInfoLayer mil = mapActivity.getMapLayers().getMapInfoLayer();
-								if (mil != null) {
-									mil.recreateControls();
-								}
-								ContextMenuItem item = adapter.getItem(pos);
-								item.setIcon(widgetState.getSettingsIconId());
-								if (message != null) {
-									item.setTitle(message);
-								} else {
-									item.setTitle(getString(widgetState.getMenuTitleId()));
+								MapInfoLayer layer = app.getOsmandMap().getMapLayers().getMapInfoLayer();
+								if (layer != null) {
+									layer.recreateControls();
 								}
-								adapter.notifyDataSetChanged();
+								callback.processResult(widgetState);
 							})
 							.showCompoundBtn(currentModeColor)
 							.setSelected(checkedItem)
@@ -716,23 +722,21 @@ public void showPopUpMenu(@NonNull MapActivity mapActivity,
 				}
 			}
 		}
-
-		// show
-		items.add(new PopUpMenuItem.Builder(app)
-				.setTitleId(R.string.shared_string_show)
-				.setIcon(uiUtilities.getThemedIcon(R.drawable.ic_action_view))
-				.setOnClickListener(showBtnListener)
-				.showTopDivider(items.size() > 0)
-				.create());
-
-		// hide
-		items.add(new PopUpMenuItem.Builder(app)
-				.setTitleId(R.string.shared_string_hide)
-				.setIcon(uiUtilities.getThemedIcon(R.drawable.ic_action_hide))
-				.setOnClickListener(hideBtnListener)
-				.create());
-
-		// collapse
+		if (showBtnListener != null) {
+			items.add(new PopUpMenuItem.Builder(app)
+					.setTitleId(R.string.shared_string_show)
+					.setIcon(uiUtilities.getThemedIcon(R.drawable.ic_action_view))
+					.setOnClickListener(showBtnListener)
+					.showTopDivider(items.size() > 0)
+					.create());
+		}
+		if (hideBtnListener != null) {
+			items.add(new PopUpMenuItem.Builder(app)
+					.setTitleId(R.string.shared_string_hide)
+					.setIcon(uiUtilities.getThemedIcon(R.drawable.ic_action_hide))
+					.setOnClickListener(hideBtnListener)
+					.create());
+		}
 		if (collapseBtnListener != null) {
 			items.add(new PopUpMenuItem.Builder(app)
 					.setTitleId(R.string.shared_string_collapse)
@@ -743,23 +747,10 @@ public void showPopUpMenu(@NonNull MapActivity mapActivity,
 
 		new PopUpMenuHelper.Builder(parentView, items, nightMode)
 				.setWidthType(PopUpMenuWidthType.STANDARD)
-				.setBackgroundColor(ColorUtilities.getListBgColor(mapActivity, nightMode))
+				.setBackgroundColor(ColorUtilities.getListBgColor(app, nightMode))
 				.show();
 	}
 
-	public ContextMenuAdapter getViewConfigureMenuAdapter(@NonNull MapActivity mapActivity) {
-		ContextMenuAdapter cm = new ContextMenuAdapter(app);
-		boolean nightMode = app.getDaynightHelper().isNightModeForMapControls();
-		cm.setProfileDependent(true);
-		cm.setDefaultLayoutId(R.layout.list_item_icon_and_menu);
-		cm.addItem(new ContextMenuItem(null).setTitleId(R.string.app_modes_choose, mapActivity)
-				.setLayout(R.layout.mode_toggles));
-//		cm.setChangeAppModeListener(() -> mapActivity.getDashboard().updateListAdapter(getViewConfigureMenuAdapter(mapActivity)));
-		ApplicationMode mode = settings.getApplicationMode();
-		addControls(mapActivity, cm, mode);
-		return cm;
-	}
-
 	private String getString(@StringRes int resId) {
 		return app.getString(resId);
 	}
@@ -783,7 +774,7 @@ public AppearanceItemClickListener(OsmandPreference<Boolean> pref, MapActivity m
 
 		@Override
 		public boolean onContextMenuClick(ArrayAdapter<ContextMenuItem> a, int itemId, int pos,
-										  boolean isChecked, int[] viewCoordinates) {
+		                                  boolean isChecked, int[] viewCoordinates) {
 			updateAppearancePref(mapActivity, pref, a, !pref.get());
 			return false;
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java
index 9aeb8b88ca1..14174d6b949 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/MarkersWidgetsHelper.java
@@ -2,6 +2,9 @@
 
 import android.view.View;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
 import net.osmand.Location;
 import net.osmand.data.LatLon;
 import net.osmand.plus.OsmAndLocationProvider;
@@ -14,9 +17,6 @@
 import net.osmand.plus.views.mapwidgets.widgets.MapMarkerSideWidget;
 import net.osmand.plus.views.mapwidgets.widgets.MapMarkersBarWidget;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-
 public class MarkersWidgetsHelper {
 
 	private final MapActivity mapActivity;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java
index 13497b9b91c..97ecbfa4037 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/SideWidgetInfo.java
@@ -1,5 +1,10 @@
 package net.osmand.plus.views.mapwidgets;
 
+import androidx.annotation.DrawableRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.annotation.StringRes;
+
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.views.mapwidgets.widgets.MapWidget;
 import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
@@ -7,11 +12,6 @@
 import java.util.LinkedHashSet;
 import java.util.Set;
 
-import androidx.annotation.DrawableRes;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.annotation.StringRes;
-
 public class SideWidgetInfo extends MapWidgetInfo {
 
 	private final Set<ApplicationMode> visibleCollapsible = new LinkedHashSet<>();
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
index 47d36fd43c7..60b96a0d6e5 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsPanel.java
@@ -1,15 +1,5 @@
 package net.osmand.plus.views.mapwidgets;
 
-import net.osmand.plus.R;
-import net.osmand.plus.settings.backend.OsmandSettings;
-import net.osmand.plus.settings.backend.preferences.ListStringPreference;
-import net.osmand.util.Algorithms;
-
-import java.util.ArrayList;
-import java.util.List;
-
-import androidx.annotation.NonNull;
-
 import static net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin.WIDGET_AUDIO_VIDEO_NOTES;
 import static net.osmand.plus.plugins.development.OsmandDevelopmentPlugin.WIDGET_FPS;
 import static net.osmand.plus.plugins.mapillary.MapillaryPlugin.WIDGET_MAPILLARY;
@@ -38,6 +28,16 @@
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_STREET_NAME;
 import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.WIDGET_TIME;
 
+import androidx.annotation.NonNull;
+
+import net.osmand.plus.R;
+import net.osmand.plus.settings.backend.OsmandSettings;
+import net.osmand.plus.settings.backend.preferences.ListStringPreference;
+import net.osmand.util.Algorithms;
+
+import java.util.ArrayList;
+import java.util.List;
+
 public enum WidgetsPanel {
 
 	LEFT(R.drawable.ic_action_screen_side_left, R.string.map_widget_left, R.id.left_side),
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsRegister.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsRegister.java
deleted file mode 100644
index 45869d36e38..00000000000
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/WidgetsRegister.java
+++ /dev/null
@@ -1,100 +0,0 @@
-package net.osmand.plus.views.mapwidgets;
-
-import androidx.annotation.NonNull;
-
-import net.osmand.plus.R;
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.views.mapwidgets.configure.WidgetItem;
-
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-
-public class WidgetsRegister {
-
-	private static Map<WidgetsPanel, List<WidgetItem>> map;
-
-	static {
-		add(WidgetsPanel.LEFT, R.drawable.ic_action_next_turn, "Next turn", true);
-		add(WidgetsPanel.LEFT, R.drawable.ic_action_next_turn, "Second next turn");
-		add(WidgetsPanel.LEFT, R.drawable.ic_action_next_turn, "Next small");
-
-		add(WidgetsPanel.RIGHT, R.drawable.widget_intermediate_day, "Intermediate destination", true);
-		add(WidgetsPanel.RIGHT, R.drawable.widget_time_to_distance_day, "Intermediate arrival time", true);
-		add(WidgetsPanel.RIGHT, R.drawable.widget_target_day, "Destination", true);
-		add(WidgetsPanel.RIGHT, R.drawable.widget_time_day, "Arrival time", true);
-		add(WidgetsPanel.RIGHT, R.drawable.widget_bearing_day, "Relative bearing", true);
-		add(WidgetsPanel.RIGHT, R.drawable.widget_speed_day, "Speed", true);
-		add(WidgetsPanel.RIGHT, R.drawable.widget_max_speed_day, "Speed limit", true);
-		add(WidgetsPanel.RIGHT, R.drawable.widget_altitude_day, "Altitude");
-		add(WidgetsPanel.RIGHT, R.drawable.widget_gps_info_day, "GPS info");
-		add(WidgetsPanel.RIGHT, R.drawable.widget_monitoring_rec_big_day, "Trip recording");
-		add(WidgetsPanel.RIGHT, R.drawable.widget_av_audio_day, "Audio/Video notes");
-		add(WidgetsPanel.RIGHT, R.drawable.widget_battery_charging_day, "Battery level");
-		add(WidgetsPanel.RIGHT, R.drawable.widget_bearing_day, "Radius ruller");
-		add(WidgetsPanel.RIGHT, R.drawable.widget_fps_day, "FPS Debug info");
-
-		add(WidgetsPanel.TOP, R.drawable.widget_coordinates_latitude_day, "Street name", true);
-		add(WidgetsPanel.TOP, R.drawable.ic_action_lanes, "Lanes", true);
-		add(WidgetsPanel.TOP, R.drawable.ic_action_marker_dark, "Map markers bar");
-		add(WidgetsPanel.TOP, R.drawable.widget_coordinates_latitude_north_day, "Coordinates widget");
-
-//		add(WidgetsGroup.BOTTOM, R.drawable.ic_action_elevation, "Elevation widget");
-	}
-
-	private static void add(@NonNull WidgetsPanel panel,
-	                        @NonNull Integer iconId,
-	                        @NonNull String title) {
-		add(panel, iconId, title, false);
-	}
-
-	private static void add(@NonNull WidgetsPanel panel,
-	                        @NonNull Integer iconId,
-	                        @NonNull String title,
-	                        boolean enabled) {
-		if (map == null) {
-			map = new HashMap<>();
-		}
-
-		List<WidgetItem> list = map.get(panel);
-		if (list == null) {
-			list = new ArrayList<>();
-			map.put(panel, list);
-		}
-
-		WidgetItem widget = new WidgetItem(iconId, title);
-		widget.isActive = enabled;
-		widget.priority = list.size();
-		list.add(widget);
-	}
-
-	@NonNull
-	public static List<WidgetItem> getSortedWidgets(@NonNull ApplicationMode appMode,
-	                                                @NonNull WidgetsPanel panel,
-	                                                boolean useDefaultOrder) {
-		List<WidgetItem> widgets = getWidgets(appMode, panel, useDefaultOrder);
-		Collections.sort(widgets, (o1, o2) -> {
-			int order1 = o1.priority;
-			int order2 = o2.priority;
-			return Integer.compare(order1, order2);
-		});
-		return widgets;
-	}
-
-	@NonNull
-	public static List<WidgetItem> getWidgets(@NonNull ApplicationMode appMode,
-	                                          @NonNull WidgetsPanel panel) {
-		return getWidgets(appMode, panel, false);
-	}
-
-	@NonNull
-	public static List<WidgetItem> getWidgets(@NonNull ApplicationMode appMode,
-	                                          @NonNull WidgetsPanel panel,
-	                                          boolean useDefaultOrder) {
-		List<WidgetItem> widgets = map.get(panel);
-		return widgets != null ? widgets : new ArrayList<>();
-	}
-
-}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
index 8e0682b6c69..2eb907b9a4b 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/ConfigureScreenFragment.java
@@ -30,12 +30,11 @@
 import net.osmand.plus.quickaction.QuickActionRegistry.QuickActionUpdatesListener;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
-import net.osmand.plus.settings.backend.preferences.OsmandPreference;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.WidgetsRegister;
 import net.osmand.plus.views.mapwidgets.configure.panel.ConfigureWidgetsFragment;
 import net.osmand.plus.widgets.chips.ChipItem;
 import net.osmand.plus.widgets.chips.HorizontalChipsView;
@@ -51,11 +50,13 @@ public class ConfigureScreenFragment extends BaseOsmAndFragment implements Quick
 	private static final String INFO_LINK = "https://docs.osmand.net/en/main@latest/osmand/widgets/configure-screen";
 
 	private OsmandApplication app;
-	private MapActivity mapActivity;
 	private OsmandSettings settings;
-	private ApplicationMode appMode;
 	private UiUtilities iconsCache;
-	private LayoutInflater inflater;
+	private MapWidgetRegistry widgetRegistry;
+	private ApplicationMode selectedAppMode;
+
+	private MapActivity mapActivity;
+	private LayoutInflater themedInflater;
 
 	private Toolbar toolbar;
 	private HorizontalChipsView modesToggle;
@@ -70,7 +71,8 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		app = requireMyApplication();
 		settings = app.getSettings();
 		mapActivity = (MapActivity) requireMyActivity();
-		appMode = settings.getApplicationMode();
+		selectedAppMode = settings.getApplicationMode();
+		widgetRegistry = mapActivity.getMapLayers().getMapWidgetRegistry();
 	}
 
 	@Nullable
@@ -78,9 +80,9 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
 		iconsCache = app.getUIUtilities();
 		nightMode = !settings.isLightContent();
-		this.inflater = inflater = UiUtilities.getInflater(getContext(), nightMode);
+		themedInflater = UiUtilities.getInflater(getContext(), nightMode);
 
-		View view = inflater.inflate(R.layout.fragment_configure_screen, container, false);
+		View view = themedInflater.inflate(R.layout.fragment_configure_screen, container, false);
 		if (Build.VERSION.SDK_INT < 30) {
 			AndroidUtils.addStatusBarPadding21v(app, view);
 		}
@@ -112,16 +114,17 @@ public void onStop() {
 	}
 
 	private void setupToolbar() {
-		ImageButton backBtn = toolbar.findViewById(R.id.back_button);
-		backBtn.setOnClickListener(view -> {
+		ImageButton backButton = toolbar.findViewById(R.id.back_button);
+		backButton.setOnClickListener(view -> {
 			FragmentActivity activity = getActivity();
 			if (activity != null) {
 				activity.onBackPressed();
 			}
 		});
-		UiUtilities.rotateImageByLayoutDirection(backBtn);
-		View infoBtn = toolbar.findViewById(R.id.info_button);
-		infoBtn.setOnClickListener(v -> {
+		backButton.setImageDrawable(getContentIcon(AndroidUtils.getNavigationIconResId(app)));
+
+		View infoButton = toolbar.findViewById(R.id.info_button);
+		infoButton.setOnClickListener(v -> {
 			FragmentActivity activity = getActivity();
 			if (activity != null) {
 				AndroidUtils.openUrl(activity, Uri.parse(INFO_LINK), nightMode);
@@ -130,21 +133,21 @@ private void setupToolbar() {
 	}
 
 	private void setupModesToggle() {
-		List<ChipItem> items = new ArrayList<>();
 		ChipItem selectedItem = null;
-		for (ApplicationMode am : ApplicationMode.values(app)) {
-			ChipItem item = new ChipItem(am.getStringKey());
-			int profileColor = am.getProfileColor(nightMode);
+		List<ChipItem> items = new ArrayList<>();
+		for (ApplicationMode mode : ApplicationMode.values(app)) {
+			ChipItem item = new ChipItem(mode.getStringKey());
+			int profileColor = mode.getProfileColor(nightMode);
 			int bgSelectedColor = ColorUtilities.getColorWithAlpha(profileColor, 0.25f);
 			// Do not use iconsCache to prevent same coloring for profiles with same icons
-			item.icon = ContextCompat.getDrawable(app, am.getIconRes());
+			item.icon = ContextCompat.getDrawable(app, mode.getIconRes());
 			item.iconColor = profileColor;
 			item.iconSelectedColor = profileColor;
 			item.strokeSelectedColor = profileColor;
 			item.rippleColor = profileColor;
 			item.bgSelectedColor = bgSelectedColor;
-			item.tag = am;
-			if (Algorithms.objectEquals(appMode, am)) {
+			item.tag = mode;
+			if (Algorithms.objectEquals(selectedAppMode, mode)) {
 				selectedItem = item;
 			}
 			items.add(item);
@@ -154,7 +157,7 @@ private void setupModesToggle() {
 		modesToggle.setOnSelectChipListener(chip -> {
 			if (chip.tag instanceof ApplicationMode) {
 				ApplicationMode am = (ApplicationMode) chip.tag;
-				appMode = am;
+				selectedAppMode = am;
 				modesToggle.smoothScrollTo(chip);
 				settings.setApplicationMode(am);
 				fullUpdate();
@@ -178,16 +181,12 @@ private void updateWidgetsCard() {
 		widgetsCard.addView(createWidgetGroupView(WidgetsPanel.TOP, false, false));
 		widgetsCard.addView(createWidgetGroupView(WidgetsPanel.BOTTOM, false, true));
 
-		OsmandPreference<Boolean> prefTransparentWidgets = settings.TRANSPARENT_MAP_THEME;
-		widgetsCard.addView(createButtonWithSwitch(
-				R.drawable.ic_action_appearance,
-				getString(R.string.map_widget_transparent),
-				prefTransparentWidgets.getModeValue(appMode),
-				false,
+		widgetsCard.addView(createButtonWithSwitch(R.drawable.ic_action_appearance, getString(R.string.map_widget_transparent),
+				settings.TRANSPARENT_MAP_THEME.getModeValue(selectedAppMode),
 				false,
 				v -> {
-					boolean enabled = prefTransparentWidgets.get();
-					prefTransparentWidgets.setModeValue(appMode, !enabled);
+					boolean enabled = settings.TRANSPARENT_MAP_THEME.get();
+					settings.TRANSPARENT_MAP_THEME.setModeValue(selectedAppMode, !enabled);
 					mapActivity.updateApplicationModeSettings();
 				}
 		));
@@ -196,71 +195,58 @@ private void updateWidgetsCard() {
 	private void updateButtonsCard() {
 		buttonsCard.removeAllViews();
 
-		OsmandPreference<Boolean> prefShowCompass = settings.SHOW_COMPASS;
 		buttonsCard.addView(createButtonWithSwitch(
 				R.drawable.ic_action_compass,
 				getString(R.string.map_widget_compass),
-				prefShowCompass.getModeValue(appMode),
-				false,
+				settings.SHOW_COMPASS.getModeValue(selectedAppMode),
 				false,
 				v -> {
-					boolean enabled = prefShowCompass.getModeValue(appMode);
-					prefShowCompass.setModeValue(appMode, !enabled);
+					boolean enabled = settings.SHOW_COMPASS.getModeValue(selectedAppMode);
+					settings.SHOW_COMPASS.setModeValue(selectedAppMode, !enabled);
 					mapActivity.updateApplicationModeSettings();
 				}
 		));
 
-		OsmandPreference<Boolean> prefDistanceRuler = settings.SHOW_DISTANCE_RULER;
 		buttonsCard.addView(createButtonWithSwitch(
 				R.drawable.ic_action_ruler_line,
 				getString(R.string.map_widget_distance_by_tap),
-				prefDistanceRuler.getModeValue(appMode),
+				settings.SHOW_DISTANCE_RULER.getModeValue(selectedAppMode),
 				true,
-				false,
 				v -> {
-					boolean enabled = prefDistanceRuler.getModeValue(appMode);
-					prefDistanceRuler.setModeValue(appMode, !enabled);
+					boolean enabled = settings.SHOW_DISTANCE_RULER.getModeValue(selectedAppMode);
+					settings.SHOW_DISTANCE_RULER.setModeValue(selectedAppMode, !enabled);
 					mapActivity.updateApplicationModeSettings();
 				}
 		));
 
-		QuickActionRegistry qaRegistry = app.getQuickActionRegistry();
-		int actionsCount = qaRegistry.getQuickActions().size();
+		QuickActionRegistry registry = app.getQuickActionRegistry();
+		int actionsCount = registry.getQuickActions().size();
 		String actions = getString(R.string.shared_string_actions);
 		String desc = getString(R.string.ltr_or_rtl_combine_via_colon, actions, String.valueOf(actionsCount));
 		buttonsCard.addView(createButtonWithDesc(
 				R.drawable.ic_quick_action,
 				getString(R.string.configure_screen_quick_action),
 				desc,
-				settings.QUICK_ACTION.getModeValue(appMode),
+				settings.QUICK_ACTION.getModeValue(selectedAppMode),
 				v -> QuickActionListFragment.showInstance(requireActivity(), false)
 		));
 	}
 
-	private void showConfigureWidgetsScreen(WidgetsPanel panel) {
-		FragmentActivity activity = getActivity();
-		if (activity != null) {
-			ConfigureWidgetsFragment.showInstance(activity, panel, appMode);
-		}
-	}
-
 	@Override
 	public void onActionsUpdated() {
 		updateButtonsCard();
 	}
 
-	private View createWidgetGroupView(WidgetsPanel panel,
-	                                   boolean showShortDivider,
-	                                   boolean showLongDivider) {
-		int activeColor = appMode.getProfileColor(nightMode);
+	private View createWidgetGroupView(@NonNull WidgetsPanel panel, boolean showShortDivider, boolean showLongDivider) {
+		int activeColor = selectedAppMode.getProfileColor(nightMode);
 		int defColor = ColorUtilities.getDefaultIconColor(app, nightMode);
 
-		View view = inflater.inflate(R.layout.configure_screen_list_item, null);
+		View view = themedInflater.inflate(R.layout.configure_screen_list_item, null);
 		ImageView ivIcon = view.findViewById(R.id.icon);
 		TextView tvTitle = view.findViewById(R.id.title);
 		TextView tvDesc = view.findViewById(R.id.items_count_descr);
 
-		int count = WidgetsRegister.getWidgets(appMode, panel, false).size();
+		int count = widgetRegistry.getWidgetsForPanel(panel).size();
 		int iconColor = count > 0 ? activeColor : defColor;
 		Drawable icon = getPaintedContentIcon(panel.getIconId(), iconColor);
 		ivIcon.setImageDrawable(icon);
@@ -279,7 +265,12 @@ private View createWidgetGroupView(WidgetsPanel panel,
 			view.findViewById(R.id.long_divider).setVisibility(View.VISIBLE);
 		}
 
-		setupClickListener(view, v -> showConfigureWidgetsScreen(panel));
+		setupClickListener(view, v -> {
+			FragmentActivity activity = getActivity();
+			if (activity != null) {
+				ConfigureWidgetsFragment.showInstance(activity, panel, selectedAppMode);
+			}
+		});
 		setupListItemBackground(view);
 		return view;
 	}
@@ -288,12 +279,11 @@ private View createButtonWithSwitch(int iconId,
 	                                    @NonNull String title,
 	                                    boolean enabled,
 	                                    boolean showShortDivider,
-	                                    boolean showLongDivider,
 	                                    @Nullable OnClickListener listener) {
-		int activeColor = appMode.getProfileColor(nightMode);
+		int activeColor = selectedAppMode.getProfileColor(nightMode);
 		int defColor = ColorUtilities.getDefaultIconColor(app, nightMode);
 		int iconColor = enabled ? activeColor : defColor;
-		View view = inflater.inflate(R.layout.configure_screen_list_item, null);
+		View view = themedInflater.inflate(R.layout.configure_screen_list_item, null);
 
 		Drawable icon = getPaintedContentIcon(iconId, iconColor);
 		ImageView ivIcon = view.findViewById(R.id.icon);
@@ -312,10 +302,6 @@ private View createButtonWithSwitch(int iconId,
 			view.findViewById(R.id.short_divider).setVisibility(View.VISIBLE);
 		}
 
-		if (showLongDivider) {
-			view.findViewById(R.id.long_divider).setVisibility(View.VISIBLE);
-		}
-
 		cb.setOnCheckedChangeListener((buttonView, isChecked) -> {
 			ivIcon.setColorFilter(isChecked ? activeColor : defColor);
 			if (listener != null) {
@@ -336,10 +322,10 @@ private View createButtonWithDesc(int iconId,
 	                                  @NonNull String desc,
 	                                  boolean enabled,
 	                                  OnClickListener listener) {
-		int activeColor = appMode.getProfileColor(nightMode);
+		int activeColor = selectedAppMode.getProfileColor(nightMode);
 		int defColor = ColorUtilities.getDefaultIconColor(app, nightMode);
 		int iconColor = enabled ? activeColor : defColor;
-		View view = inflater.inflate(R.layout.configure_screen_list_item, null);
+		View view = themedInflater.inflate(R.layout.configure_screen_list_item, null);
 
 		Drawable icon = getPaintedContentIcon(iconId, iconColor);
 		ImageView ivIcon = view.findViewById(R.id.icon);
@@ -359,13 +345,12 @@ private View createButtonWithDesc(int iconId,
 
 	private void setupListItemBackground(@NonNull View view) {
 		View button = view.findViewById(R.id.button_container);
-		int color = appMode.getProfileColor(nightMode);
+		int color = selectedAppMode.getProfileColor(nightMode);
 		Drawable background = UiUtilities.getColoredSelectableDrawable(app, color, 0.3f);
 		AndroidUtils.setBackground(button, background);
 	}
 
-	private void setupClickListener(@NonNull View view,
-	                                @Nullable OnClickListener listener) {
+	private void setupClickListener(@NonNull View view, @Nullable OnClickListener listener) {
 		View button = view.findViewById(R.id.button_container);
 		button.setOnClickListener(listener);
 	}
@@ -373,8 +358,8 @@ private void setupClickListener(@NonNull View view,
 	@Override
 	public int getStatusBarColorId() {
 		View view = getView();
-		if (view != null && Build.VERSION.SDK_INT >= 23 && !nightMode) {
-				view.setSystemUiVisibility(view.getSystemUiVisibility() | View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);
+		if (view != null && !nightMode) {
+			view.setSystemUiVisibility(view.getSystemUiVisibility() | View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);
 		}
 		return ColorUtilities.getListBgColorId(nightMode);
 	}
@@ -389,5 +374,4 @@ public static void showInstance(@NonNull FragmentActivity activity) {
 					.commitAllowingStateLoss();
 		}
 	}
-
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetItem.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetItem.java
index 422235df072..8083a8d5b8b 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetItem.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/WidgetItem.java
@@ -11,5 +11,4 @@ public WidgetItem(int iconId, String title) {
 		this.iconId = iconId;
 		this.title = title;
 	}
-
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
index e62a967df73..391ebed63d8 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/ConfigureWidgetsFragment.java
@@ -37,14 +37,12 @@
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.configure.reorder.OnNewOrderAppliedCallback;
-import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsFragment;
+import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsFragment.WidgetsOrderListener;
 
-import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.List;
 
-public class ConfigureWidgetsFragment extends BaseOsmAndFragment
-		implements OnNewOrderAppliedCallback, OnOffsetChangedListener {
+public class ConfigureWidgetsFragment extends BaseOsmAndFragment implements WidgetsOrderListener, OnOffsetChangedListener {
 
 	public static final String TAG = ConfigureWidgetsFragment.class.getSimpleName();
 
@@ -55,20 +53,30 @@ public class ConfigureWidgetsFragment extends BaseOsmAndFragment
 
 	private OsmandApplication app;
 	private OsmandSettings settings;
-	private ApplicationMode appMode;
 
-	private View view;
-	private AppBarLayout appBar;
+	private WidgetsPanel selectedPanel;
+	private ApplicationMode selectedAppMode;
+	private WidgetsListFragment selectedFragment;
+
 	private Toolbar toolbar;
 	private TabLayout tabLayout;
 	private ViewPager2 viewPager;
 	private View compensationView;
 
-	private List<WidgetsPanel> availablePanels;
-	private WidgetsListFragment currentListFragment;
-	private WidgetsPanel selectedPanel;
 	private boolean nightMode;
 
+	public void setSelectedPanel(@NonNull WidgetsPanel panel) {
+		this.selectedPanel = panel;
+	}
+
+	public void setSelectedAppMode(@NonNull ApplicationMode appMode) {
+		this.selectedAppMode = appMode;
+	}
+
+	public void setSelectedFragment(@Nullable WidgetsListFragment fragment) {
+		this.selectedFragment = fragment;
+	}
+
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
@@ -76,35 +84,29 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		settings = app.getSettings();
 
 		if (savedInstanceState != null) {
-			restoreData(savedInstanceState);
+			String appModeKey = savedInstanceState.getString(APP_MODE_ATTR);
+			selectedAppMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
+			selectedPanel = WidgetsPanel.valueOf(savedInstanceState.getString(SELECTED_GROUP_ATTR));
 		}
-
-		availablePanels = new ArrayList<>();
-		availablePanels.add(WidgetsPanel.LEFT);
-		availablePanels.add(WidgetsPanel.RIGHT);
-		availablePanels.add(WidgetsPanel.TOP);
-		availablePanels.add(WidgetsPanel.BOTTOM);
 	}
 
 	@Nullable
 	@Override
-	public View onCreateView(@NonNull LayoutInflater inflater,
-	                         @Nullable ViewGroup container,
-	                         @Nullable Bundle savedInstanceState) {
+	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
 		nightMode = !settings.isLightContent();
-		inflater = UiUtilities.getInflater(getContext(), nightMode);
+		inflater = UiUtilities.getInflater(requireContext(), nightMode);
 
-		view = inflater.inflate(R.layout.fragment_configure_widgets, container, false);
+		View view = inflater.inflate(R.layout.fragment_configure_widgets, container, false);
 		if (Build.VERSION.SDK_INT < 30) {
 			AndroidUtils.addStatusBarPadding21v(app, view);
 		}
+		AppBarLayout appBar = view.findViewById(R.id.appbar);
+		appBar.addOnOffsetChangedListener(this);
 
-		appBar = view.findViewById(R.id.appbar);
 		toolbar = view.findViewById(R.id.toolbar);
 		tabLayout = view.findViewById(R.id.tab_layout);
 		viewPager = view.findViewById(R.id.view_pager);
 		compensationView = view.findViewById(R.id.compensation_view);
-		appBar.addOnOffsetChangedListener(this);
 
 		setupToolbar();
 		setupTabLayout();
@@ -113,41 +115,48 @@ public View onCreateView(@NonNull LayoutInflater inflater,
 	}
 
 	private void setupToolbar() {
-		ImageButton backBtn = toolbar.findViewById(R.id.back_button);
-		backBtn.setOnClickListener(view -> {
+		ImageButton backButton = toolbar.findViewById(R.id.back_button);
+		backButton.setOnClickListener(view -> {
 			FragmentActivity activity = getActivity();
 			if (activity != null) {
 				activity.onBackPressed();
 			}
 		});
-		UiUtilities.rotateImageByLayoutDirection(backBtn);
-		View infoBtn = toolbar.findViewById(R.id.info_button);
-		infoBtn.setOnClickListener(v -> {
+		UiUtilities.rotateImageByLayoutDirection(backButton);
+
+		View infoButton = toolbar.findViewById(R.id.info_button);
+		infoButton.setOnClickListener(v -> {
 			FragmentActivity activity = getActivity();
 			if (activity != null) {
 				AndroidUtils.openUrl(activity, Uri.parse(INFO_LINK), nightMode);
 			}
 		});
 		TextView tvSubtitle = toolbar.findViewById(R.id.toolbar_subtitle);
-		String appModeName = appMode.toHumanString();
-		tvSubtitle.setText(appModeName);
+		tvSubtitle.setText(selectedAppMode.toHumanString());
+	}
+
+	@Override
+	public void onSaveInstanceState(@NonNull Bundle outState) {
+		super.onSaveInstanceState(outState);
+		outState.putString(APP_MODE_ATTR, selectedAppMode.getStringKey());
+		outState.putString(SELECTED_GROUP_ATTR, selectedPanel.name());
 	}
 
 	private void setupTabLayout() {
-		WidgetsTabAdapter tabAdapter = new WidgetsTabAdapter(this, availablePanels);
+		WidgetsTabAdapter tabAdapter = new WidgetsTabAdapter(this);
 		viewPager.setAdapter(tabAdapter);
-
 		viewPager.registerOnPageChangeCallback(new OnPageChangeCallback() {
 			@Override
 			public void onPageSelected(int position) {
-				selectedPanel = availablePanels.get(position);
+				selectedPanel = WidgetsPanel.values()[position];
 			}
 		});
 
-		TabLayoutMediator mediator = new TabLayoutMediator(tabLayout, viewPager, (tab, position) -> { });
+		TabLayoutMediator mediator = new TabLayoutMediator(tabLayout, viewPager, (tab, position) -> {
+		});
 		mediator.attach();
 
-		int profileColor = appMode.getProfileColor(nightMode);
+		int profileColor = selectedAppMode.getProfileColor(nightMode);
 		int defaultIconColor = ColorUtilities.getDefaultIconColor(app, nightMode);
 		tabLayout.setSelectedTabIndicatorColor(profileColor);
 		tabLayout.addOnTabSelectedListener(new OnTabSelectedListener() {
@@ -173,104 +182,51 @@ public void onTabReselected(Tab tab) {
 			}
 		});
 
+		List<WidgetsPanel> panels = Arrays.asList(WidgetsPanel.values());
 		for (int i = 0; i < tabLayout.getTabCount(); i++) {
 			Tab tab = tabLayout.getTabAt(i);
-			WidgetsPanel panel = availablePanels.get(i);
-			if (tab != null ) {
+			WidgetsPanel panel = panels.get(i);
+			if (tab != null) {
 				tab.setTag(panel);
 				tab.setIcon(panel.getIconId());
 			}
 		}
-
-		int selectedTabPosition = availablePanels.indexOf(selectedPanel);
+		int selectedTabPosition = panels.indexOf(selectedPanel);
 		viewPager.setCurrentItem(selectedTabPosition, false);
 	}
 
-	public void setupReorderButton(View btnChangeOrder) {
-		btnChangeOrder.setOnClickListener(v -> onReorderButtonClicked());
-		setupListItemBackground(btnChangeOrder);
-	}
-
-	private void onReorderButtonClicked() {
-		FragmentActivity activity = getActivity();
-		if (activity != null) {
-			ReorderWidgetsFragment.showInstance(this, activity, selectedPanel, appMode);
-		}
-	}
-
 	@Override
-	public void onSaveInstanceState(@NonNull Bundle outState) {
-		super.onSaveInstanceState(outState);
-		outState.putString(APP_MODE_ATTR, appMode.getStringKey());
-		outState.putString(SELECTED_GROUP_ATTR, selectedPanel.name());
-	}
-
-	private void restoreData(@NonNull Bundle savedInstanceState) {
-		String appModeKey = savedInstanceState.getString(APP_MODE_ATTR);
-		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
-		String groupName = savedInstanceState.getString(SELECTED_GROUP_ATTR);
-		selectedPanel = WidgetsPanel.valueOf(groupName);
-	}
-
-	private void setupListItemBackground(@NonNull View view) {
-		View button = view.findViewById(R.id.button_container);
-		int activeColor = appMode.getProfileColor(nightMode);;
-		Drawable background = UiUtilities.getColoredSelectableDrawable(app, activeColor, 0.3f);
-		AndroidUtils.setBackground(button, background);
-	}
-
-	public void setSelectedPanel(WidgetsPanel selectedPanel) {
-		this.selectedPanel = selectedPanel;
-	}
-
-	public WidgetsPanel getSelectedPanel() {
-		return selectedPanel;
-	}
-
-	public void setAppMode(ApplicationMode appMode) {
-		this.appMode = appMode;
+	public void onOffsetChanged(AppBarLayout appBarLayout, int verticalOffset) {
+		int height = toolbar.getHeight() - Math.abs(verticalOffset);
+		compensationView.setLayoutParams(new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, height));
 	}
 
-	public void setCurrentListFragment(WidgetsListFragment currentListFragment) {
-		this.currentListFragment = currentListFragment;
+	@Override
+	public void onWidgetsOrderApplied() {
+		if (selectedFragment != null) {
+			selectedFragment.updateContent();
+		}
 	}
 
 	@Override
 	public int getStatusBarColorId() {
 		View view = getView();
-		if (view != null && Build.VERSION.SDK_INT >= 23 && !nightMode) {
+		if (view != null && !nightMode) {
 			view.setSystemUiVisibility(view.getSystemUiVisibility() | View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);
 		}
 		return ColorUtilities.getListBgColorId(nightMode);
 	}
 
-	@Override
-	public void onOffsetChanged(AppBarLayout appBarLayout, int verticalOffset) {
-		int height = toolbar.getHeight() - Math.abs(verticalOffset);
-		LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, height);
-		compensationView.setLayoutParams(params);
-	}
-
-	@Override
-	public void onNewOrderApplied() {
-		if (currentListFragment != null) {
-			currentListFragment.updateContent();
-		}
-	}
-
-	public static void showInstance(@NonNull FragmentActivity activity,
-	                                @NonNull WidgetsPanel selectedGroup,
-	                                @NonNull ApplicationMode appMode) {
+	public static void showInstance(@NonNull FragmentActivity activity, @NonNull WidgetsPanel panel, @NonNull ApplicationMode appMode) {
 		FragmentManager fragmentManager = activity.getSupportFragmentManager();
 		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
 			ConfigureWidgetsFragment fragment = new ConfigureWidgetsFragment();
-			fragment.setSelectedPanel(selectedGroup);
-			fragment.setAppMode(appMode);
+			fragment.setSelectedPanel(panel);
+			fragment.setSelectedAppMode(appMode);
 			fragmentManager.beginTransaction()
 					.add(R.id.fragmentContainer, fragment, TAG)
 					.addToBackStack(TAG)
 					.commitAllowingStateLoss();
 		}
 	}
-
-}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
index 86537f6ef82..167ec5af44e 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsListFragment.java
@@ -1,12 +1,11 @@
 package net.osmand.plus.views.mapwidgets.configure.panel;
 
-import android.graphics.ColorMatrix;
-import android.graphics.ColorMatrixColorFilter;
+import static net.osmand.plus.utils.ColorUtilities.getDefaultIconColor;
+
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.View;
-import android.view.View.OnClickListener;
 import android.view.ViewGroup;
 import android.view.ViewTreeObserver.OnScrollChangedListener;
 import android.widget.CompoundButton;
@@ -18,178 +17,191 @@
 import androidx.annotation.Nullable;
 import androidx.core.widget.NestedScrollView;
 import androidx.fragment.app.Fragment;
+import androidx.fragment.app.FragmentActivity;
 
+import net.osmand.CallbackWithObject;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
+import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.settings.backend.ApplicationMode;
+import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.views.mapwidgets.MapWidgetInfo;
+import net.osmand.plus.views.mapwidgets.MapWidgetRegistry;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.WidgetsRegister;
-import net.osmand.plus.views.mapwidgets.configure.WidgetItem;
-
-import java.util.List;
+import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsFragment;
+import net.osmand.plus.views.mapwidgets.widgetstates.WidgetState;
 
 public class WidgetsListFragment extends Fragment implements OnScrollChangedListener {
 
 	private static final String SELECTED_GROUP_ATTR = "selected_group_key";
 
 	private OsmandApplication app;
-	private ApplicationMode appMode;
-	private LayoutInflater inflater;
-	private WidgetsPanel panel;
+	private UiUtilities uiUtilities;
+	private MapWidgetRegistry widgetRegistry;
+
+	private WidgetsPanel selectedPanel;
+	private ApplicationMode selectedAppMode;
+
+	private View changeOrderListButton;
+	private View changeOrderFooterButton;
+	private LinearLayout widgetsContainer;
+
 	private boolean nightMode;
 
-	private View view;
-	private LinearLayout widgetsList;
-	private NestedScrollView scrollView;
-	private View listBtnChangeOrder;
-	private View stickBtnChangeOrder;
-	private ConfigureWidgetsFragment parentFragment;
+	public void setSelectedPanel(@NonNull WidgetsPanel panel) {
+		this.selectedPanel = panel;
+	}
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = (OsmandApplication) requireContext().getApplicationContext();
-		appMode = app.getSettings().getApplicationMode();
-		nightMode = !app.getSettings().isLightContent();
-		parentFragment = (ConfigureWidgetsFragment) getParentFragment();
+		uiUtilities = app.getUIUtilities();
+		widgetRegistry = app.getOsmandMap().getMapLayers().getMapWidgetRegistry();
+
+		OsmandSettings settings = app.getSettings();
+		selectedAppMode = settings.getApplicationMode();
+		nightMode = !settings.isLightContent();
 		if (savedInstanceState != null) {
-			restoreData(savedInstanceState);
+			selectedPanel = WidgetsPanel.valueOf(savedInstanceState.getString(SELECTED_GROUP_ATTR));
 		}
 	}
 
 	@Nullable
 	@Override
-	public View onCreateView(@NonNull LayoutInflater inflater,
-	                         @Nullable ViewGroup container,
-	                         @Nullable Bundle savedInstanceState) {
-		this.inflater = inflater = UiUtilities.getInflater(getContext(), nightMode);
-		view = inflater.inflate(R.layout.fragment_widgets_list, container, false);
-		widgetsList = view.findViewById(R.id.widgets_list);
-		scrollView = view.findViewById(R.id.scroll_view);
-		listBtnChangeOrder = view.findViewById(R.id.change_order_button_in_list);
-		stickBtnChangeOrder = view.findViewById(R.id.change_order_button_in_bottom);
+	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+		View view = inflater.inflate(R.layout.fragment_widgets_list, container, false);
+
+		widgetsContainer = view.findViewById(R.id.widgets_list);
+		changeOrderListButton = view.findViewById(R.id.change_order_button_in_list);
+		changeOrderFooterButton = view.findViewById(R.id.change_order_button_in_bottom);
+
+		NestedScrollView scrollView = view.findViewById(R.id.scroll_view);
 		scrollView.getViewTreeObserver().addOnScrollChangedListener(this);
-		setupBtnChangeOrder();
+
 		updateContent();
+
+		TextView panelTitle = view.findViewById(R.id.panel_title);
+		panelTitle.setText(getString(selectedPanel.getTitleId()));
+
+		setupReorderButton(changeOrderListButton);
+		setupReorderButton(changeOrderFooterButton);
+
 		return view;
 	}
 
 	@Override
 	public void onResume() {
 		super.onResume();
-		parentFragment.setCurrentListFragment(this);
-	}
 
-	private void setupBtnChangeOrder() {
-		parentFragment.setupReorderButton(stickBtnChangeOrder);
-		parentFragment.setupReorderButton(listBtnChangeOrder);
+		Fragment fragment = getParentFragment();
+		if (fragment instanceof ConfigureWidgetsFragment) {
+			((ConfigureWidgetsFragment) fragment).setSelectedFragment(this);
+		}
 	}
 
-	public void updateContent() {
-		updateCardTitle();
-		updateWidgetsList();
+	@Override
+	public void onPause() {
+		super.onPause();
+
+		Fragment fragment = getParentFragment();
+		if (fragment instanceof ConfigureWidgetsFragment) {
+			((ConfigureWidgetsFragment) fragment).setSelectedFragment(null);
+		}
 	}
 
-	private void updateCardTitle() {
-		TextView tvPanelTitle = view.findViewById(R.id.panel_title);
-		tvPanelTitle.setText(getString(panel.getTitleId()));
+	public void setupReorderButton(@NonNull View view) {
+		view.setOnClickListener(v -> {
+			FragmentActivity activity = getActivity();
+			if (activity != null) {
+				ReorderWidgetsFragment.showInstance(this, activity, selectedPanel, selectedAppMode);
+			}
+		});
+		setupListItemBackground(view);
 	}
 
-	private void updateWidgetsList() {
-		widgetsList.removeAllViews();
-		int profileColor = appMode.getProfileColor(nightMode);
-		List<WidgetItem> widgets = WidgetsRegister.getSortedWidgets(appMode, panel, false);
-		for (WidgetItem widget : widgets) {
-			View view = inflater.inflate(R.layout.configure_screen_widget_item, widgetsList, false);
+	public void updateContent() {
+		widgetsContainer.removeAllViews();
 
-			boolean isEnabled = widget.isActive;
+		int profileColor = selectedAppMode.getProfileColor(nightMode);
+		int defaultIconColor = getDefaultIconColor(app, nightMode);
 
-			ImageView ivIcon = view.findViewById(R.id.icon);
-			ivIcon.setImageResource(widget.iconId);
-			setImageFilter(ivIcon, !isEnabled);
+		LayoutInflater inflater = UiUtilities.getInflater(getContext(), nightMode);
+		for (MapWidgetInfo widgetInfo : widgetRegistry.getWidgetsForPanel(selectedPanel)) {
+			if (!selectedAppMode.isWidgetAvailable(widgetInfo.key)) {
+				continue;
+			}
+			View view = inflater.inflate(R.layout.configure_screen_widget_item, widgetsContainer, false);
 
 			TextView tvTitle = view.findViewById(R.id.title);
-			tvTitle.setText(widget.title);
+			if (widgetInfo.getMessage() != null) {
+				tvTitle.setText(widgetInfo.getMessage());
+			} else {
+				tvTitle.setText(widgetInfo.getMessageId());
+			}
+			AndroidUiHelper.updateVisibility(view.findViewById(R.id.description), false);
 
-			TextView tvDesc = view.findViewById(R.id.description);
-			tvDesc.setVisibility(View.GONE);
+			boolean selected = widgetInfo.isVisibleCollapsed(selectedAppMode) || widgetInfo.isVisible(selectedAppMode);
 
-			ImageView ivSecondaryIcon = view.findViewById(R.id.secondary_icon);
-			ivSecondaryIcon.setImageResource(R.drawable.ic_action_additional_option);
+			int colorId = selected ? profileColor : defaultIconColor;
+			ImageView imageView = view.findViewById(R.id.icon);
+			imageView.setImageDrawable(uiUtilities.getPaintedIcon(widgetInfo.getSettingsIconId(), colorId));
 
-			CompoundButton cb = view.findViewById(R.id.compound_button);
-			cb.setChecked(isEnabled);
-			cb.setVisibility(View.VISIBLE);
-			UiUtilities.setupCompoundButton(nightMode, profileColor, cb);
+			ImageView secondaryIcon = view.findViewById(R.id.secondary_icon);
+			secondaryIcon.setImageResource(R.drawable.ic_action_additional_option);
+			AndroidUiHelper.updateVisibility(secondaryIcon, widgetInfo.getWidgetState() != null);
 
-			OnClickListener listener = v -> {
-				boolean isChecked = cb.isChecked();
-				setImageFilter(ivIcon, !isChecked);
-				widget.isActive = isChecked;
-			};
+			CompoundButton compoundButton = view.findViewById(R.id.compound_button);
+			compoundButton.setChecked(selected);
+			UiUtilities.setupCompoundButton(nightMode, profileColor, compoundButton);
 
-			cb.setOnCheckedChangeListener((buttonView, isChecked) -> listener.onClick(buttonView));
+			view.findViewById(R.id.switch_container).setOnClickListener(view1 -> {
+				compoundButton.performClick();
 
-			view.setOnClickListener(v -> {
-				cb.setChecked(!cb.isChecked());
-				listener.onClick(v);
+				boolean checked = compoundButton.isChecked();
+				widgetRegistry.setVisibility(widgetInfo, checked, false);
+				imageView.setImageDrawable(uiUtilities.getPaintedIcon(widgetInfo.getSettingsIconId(), checked ? profileColor : defaultIconColor));
 			});
 
+			view.setOnClickListener(v -> {
+				if (widgetInfo.getWidgetState() == null) {
+					boolean checked = !compoundButton.isChecked();
+					compoundButton.setChecked(checked);
+					widgetRegistry.setVisibility(widgetInfo, checked, false);
+					imageView.setImageDrawable(uiUtilities.getPaintedIcon(widgetInfo.getSettingsIconId(), checked ? profileColor : defaultIconColor));
+				} else {
+					CallbackWithObject<WidgetState> callback = result -> {
+						updateContent();
+						return true;
+					};
+					widgetRegistry.showPopUpMenu(view, callback, widgetInfo.getWidgetState(), selectedAppMode,
+							null, null, null, compoundButton.isChecked());
+				}
+			});
 			setupListItemBackground(view);
-
-			widgetsList.addView(view);
+			widgetsContainer.addView(view);
 		}
 	}
 
 	private void setupListItemBackground(@NonNull View view) {
 		View button = view.findViewById(R.id.button_container);
-		int activeColor = appMode.getProfileColor(nightMode);
+		int activeColor = selectedAppMode.getProfileColor(nightMode);
 		Drawable background = UiUtilities.getColoredSelectableDrawable(app, activeColor, 0.3f);
 		AndroidUtils.setBackground(button, background);
 	}
 
-	private void setImageFilter(@NonNull ImageView ivImage, boolean applyFilter) {
-		if (applyFilter) {
-			ColorMatrix matrix = new ColorMatrix();
-			matrix.setSaturation(0);
-			ColorMatrixColorFilter filter = new ColorMatrixColorFilter(matrix);
-			ivImage.setColorFilter(filter);
-		} else {
-			ivImage.clearColorFilter();
-		}
-	}
-
-	private void updateReorderButtons() {
-		int y1 = AndroidUtils.getViewOnScreenY(listBtnChangeOrder);
-		int y2 = AndroidUtils.getViewOnScreenY(stickBtnChangeOrder);
-		stickBtnChangeOrder.setVisibility(y1 <= y2 ? View.GONE : View.VISIBLE);
-	}
-
-	@Nullable
-	public NestedScrollView getScrollView() {
-		return scrollView;
-	}
-
-	@Override
-	public void onScrollChanged() {
-		updateReorderButtons();
-	}
-
-	public void setPanel(@NonNull WidgetsPanel panel) {
-		this.panel = panel;
-	}
-
 	@Override
 	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
-		outState.putString(SELECTED_GROUP_ATTR, panel.name());
+		outState.putString(SELECTED_GROUP_ATTR, selectedPanel.name());
 	}
 
-	private void restoreData(@NonNull Bundle savedInstanceState) {
-		String groupName = savedInstanceState.getString(SELECTED_GROUP_ATTR);
-		panel = WidgetsPanel.valueOf(groupName);
+	@Override
+	public void onScrollChanged() {
+		int y1 = AndroidUtils.getViewOnScreenY(changeOrderListButton);
+		int y2 = AndroidUtils.getViewOnScreenY(changeOrderFooterButton);
+		changeOrderFooterButton.setVisibility(y1 <= y2 ? View.GONE : View.VISIBLE);
 	}
-
-}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsTabAdapter.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsTabAdapter.java
index fd669f7a2f3..62142f51e39 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsTabAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/panel/WidgetsTabAdapter.java
@@ -6,29 +6,22 @@
 
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
 
-import java.util.List;
-
 public class WidgetsTabAdapter extends FragmentStateAdapter {
 
-	private final List<WidgetsPanel> widgetsPanels;
-
-	public WidgetsTabAdapter(@NonNull Fragment fragment,
-	                         @NonNull List<WidgetsPanel> widgetsPanels) {
+	public WidgetsTabAdapter(@NonNull Fragment fragment) {
 		super(fragment);
-		this.widgetsPanels = widgetsPanels;
 	}
 
 	@NonNull
 	@Override
 	public Fragment createFragment(int position) {
 		WidgetsListFragment fragment = new WidgetsListFragment();
-		fragment.setPanel(widgetsPanels.get(position));
+		fragment.setSelectedPanel(WidgetsPanel.values()[position]);
 		return fragment;
 	}
 
 	@Override
 	public int getItemCount() {
-		return widgetsPanels.size();
+		return WidgetsPanel.values().length;
 	}
-
-}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/DataHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/DataHolder.java
index f78cde3c80c..0fa1b6cc4b4 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/DataHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/DataHolder.java
@@ -6,11 +6,8 @@
 
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.WidgetsRegister;
-import net.osmand.plus.views.mapwidgets.configure.WidgetItem;
 
 import java.util.HashMap;
-import java.util.List;
 
 public class DataHolder {
 
@@ -73,10 +70,10 @@ public void initOrders(@NonNull ApplicationMode appMode,
 		if (orderByDefault) {
 			orderModified();
 		}
-		List<WidgetItem> widgets = WidgetsRegister.getSortedWidgets(appMode, selectedPanel, orderByDefault);
-		for (WidgetItem widget : widgets) {
-			orders.put(widget.title, widget.priority);
-		}
+//		List<WidgetItem> widgets = WidgetsRegister.getSortedWidgets(appMode, selectedPanel, orderByDefault);
+//		for (WidgetItem widget : widgets) {
+//			orders.put(widget.title, widget.priority);
+//		}
 	}
 
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/OnNewOrderAppliedCallback.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/OnNewOrderAppliedCallback.java
deleted file mode 100644
index 90ad87c8ada..00000000000
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/OnNewOrderAppliedCallback.java
+++ /dev/null
@@ -1,5 +0,0 @@
-package net.osmand.plus.views.mapwidgets.configure.reorder;
-
-public interface OnNewOrderAppliedCallback {
-	void onNewOrderApplied();
-}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
index 3ec64df0ba4..3361294c1b6 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsAdapter.java
@@ -22,7 +22,7 @@
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.ButtonViewHolder;
-import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.ButtonViewHolder.ButtonUiInfo;
+import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.ButtonViewHolder.ButtonInfo;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.DividerViewHolder;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.HeaderViewHolder;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.SpaceViewHolder;
@@ -119,9 +119,9 @@ public void onBindViewHolder(@NonNull ViewHolder holder,
 		} else if (holder instanceof HeaderViewHolder) {
 			HeaderViewHolder h = (HeaderViewHolder) holder;
 			String header = (String) item.value;
-			h.tvTitle.setText(header);
+			h.title.setText(header);
 		} else if (holder instanceof ButtonViewHolder) {
-			ButtonUiInfo buttonInfo = (ButtonUiInfo) item.value;
+			ButtonInfo buttonInfo = (ButtonInfo) item.value;
 			ButtonViewHolder h = (ButtonViewHolder) holder;
 			h.buttonView.setOnClickListener(buttonInfo.listener);
 			h.icon.setImageResource(buttonInfo.iconRes);
@@ -132,7 +132,7 @@ public void onBindViewHolder(@NonNull ViewHolder holder,
 			AndroidUtils.setBackground(h.buttonView, drawable);
 		} else if (holder instanceof SpaceViewHolder) {
 			float space = (float) item.value;
-			((SpaceViewHolder) holder).setSpace((int) space);
+			((SpaceViewHolder) holder).setHeight((int) space);
 		}
 	}
 
@@ -182,8 +182,8 @@ public long getItemId(int position) {
 		ListItem item = items.get(position);
 		if (item.value instanceof WidgetUiInfo) {
 			return ((WidgetUiInfo) item.value).title.hashCode();
-		} else if (item.value instanceof ButtonUiInfo) {
-			return ((ButtonUiInfo) item.value).title.hashCode();
+		} else if (item.value instanceof ButtonInfo) {
+			return ((ButtonInfo) item.value).title.hashCode();
 		} else if (item.value != null) {
 			return item.value.hashCode();
 		}
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
index 224db26dc65..9a8042cd770 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/ReorderWidgetsFragment.java
@@ -33,12 +33,11 @@
 import net.osmand.plus.utils.UiUtilities.DialogButtonType;
 import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
 import net.osmand.plus.views.mapwidgets.WidgetsPanel;
-import net.osmand.plus.views.mapwidgets.WidgetsRegister;
 import net.osmand.plus.views.mapwidgets.configure.WidgetItem;
 import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsAdapter.ItemType;
 import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsAdapter.ListItem;
 import net.osmand.plus.views.mapwidgets.configure.reorder.ReorderWidgetsAdapter.WidgetAdapterListener;
-import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.ButtonViewHolder.ButtonUiInfo;
+import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.ButtonViewHolder.ButtonInfo;
 import net.osmand.plus.views.mapwidgets.configure.reorder.viewholder.WidgetViewHolder.WidgetUiInfo;
 
 import java.util.ArrayList;
@@ -62,7 +61,7 @@ public class ReorderWidgetsFragment extends BaseOsmAndFragment implements CopyAp
 	private RecyclerView rvContentList;
 
 	private final DataHolder dataHolder = new DataHolder();
-	private OnNewOrderAppliedCallback callback;
+	private WidgetsOrderListener callback;
 	private ReorderWidgetsAdapter adapter;
 
 
@@ -71,7 +70,7 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = requireMyApplication();
 		settings = app.getSettings();
-		callback = (OnNewOrderAppliedCallback) getTargetFragment();
+		callback = (WidgetsOrderListener) getTargetFragment();
 		if (savedInstanceState != null) {
 			restoreData(savedInstanceState);
 		} else {
@@ -182,16 +181,16 @@ private void onCopyFromProfile() {
 
 	private void onApplyChanges() {
 		applyOrder();
-		callback.onNewOrderApplied();
+		callback.onWidgetsOrderApplied();
 		dismiss();
 	}
 
 	private void applyOrder() {
 		WidgetsPanel selectedPanel = dataHolder.getSelectedPanel();
-		for (WidgetItem widget : WidgetsRegister.getWidgets(appMode, selectedPanel)) {
-			String key = widget.title;
-			widget.priority = dataHolder.getOrder(key);
-		}
+//		for (WidgetItem widget : WidgetsRegister.getWidgets(appMode, selectedPanel)) {
+//			String key = widget.title;
+//			widget.priority = dataHolder.getOrder(key);
+//		}
 	}
 
 	@Override
@@ -214,12 +213,12 @@ private void updateItems() {
 		items.addAll(createWidgetsList());
 		items.add(new ListItem(ItemType.CARD_DIVIDER, 0));
 		items.add(new ListItem(ItemType.HEADER, getString(R.string.shared_string_actions)));
-		items.add(new ListItem(ItemType.BUTTON, new ButtonUiInfo(
+		items.add(new ListItem(ItemType.BUTTON, new ButtonInfo(
 				getString(R.string.reset_to_default),
 				R.drawable.ic_action_reset,
 				v -> onResetChanges()
 		)));
-		items.add(new ListItem(ItemType.BUTTON, new ButtonUiInfo(
+		items.add(new ListItem(ItemType.BUTTON, new ButtonInfo(
 				getString(R.string.copy_from_other_profile),
 				R.drawable.ic_action_copy,
 				v -> onCopyFromProfile()
@@ -232,7 +231,7 @@ private void updateItems() {
 
 	private List<ListItem> createWidgetsList() {
 		List<ListItem> list = new ArrayList<>();
-		List<WidgetItem> widgets = WidgetsRegister.getWidgets(appMode, dataHolder.getSelectedPanel(), false);
+		List<WidgetItem> widgets = new ArrayList<>();
 		for (WidgetItem item : widgets) {
 			addWidgetToList(list, item);
 		}
@@ -284,7 +283,7 @@ public void setAppMode(ApplicationMode appMode) {
 	@Override
 	public int getStatusBarColorId() {
 		View view = getView();
-		if (view != null && Build.VERSION.SDK_INT >= 23 && !nightMode) {
+		if (view != null && !nightMode) {
 			view.setSystemUiVisibility(view.getSystemUiVisibility() | View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);
 		}
 		return ColorUtilities.getListBgColorId(nightMode);
@@ -307,4 +306,7 @@ public static void showInstance(@NonNull Fragment target,
 		}
 	}
 
+	public interface WidgetsOrderListener {
+		void onWidgetsOrderApplied();
+	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/ButtonViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/ButtonViewHolder.java
index 4c425ad812b..d382ccb5534 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/ButtonViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/ButtonViewHolder.java
@@ -6,19 +6,18 @@
 import android.widget.TextView;
 
 import androidx.annotation.NonNull;
-import androidx.recyclerview.widget.RecyclerView;
+import androidx.recyclerview.widget.RecyclerView.ViewHolder;
 
 import net.osmand.plus.R;
-import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
+import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.UnmovableItem;
 
-public class ButtonViewHolder extends RecyclerView.ViewHolder
-		implements ReorderItemTouchHelperCallback.UnmovableItem {
+public class ButtonViewHolder extends ViewHolder implements UnmovableItem {
 
 	public View buttonView;
 	public ImageView icon;
 	public TextView title;
 
-	public ButtonViewHolder(View itemView) {
+	public ButtonViewHolder(@NonNull View itemView) {
 		super(itemView);
 		buttonView = itemView.findViewById(R.id.button_container);
 		icon = itemView.findViewById(R.id.icon);
@@ -30,17 +29,17 @@ public boolean isMovingDisabled() {
 		return true;
 	}
 
-	public static class ButtonUiInfo {
+	public static class ButtonInfo {
+
 		public final String title;
 		public final int iconRes;
 		public final OnClickListener listener;
 
-		public ButtonUiInfo(@NonNull String title, int iconRes,
-		                    @NonNull OnClickListener listener) {
+		public ButtonInfo(@NonNull String title, int iconRes,
+		                  @NonNull OnClickListener listener) {
 			this.title = title;
 			this.iconRes = iconRes;
 			this.listener = listener;
 		}
 	}
-
 }
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/DividerViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/DividerViewHolder.java
index 12df7ad6eca..e9e2cc22061 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/DividerViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/DividerViewHolder.java
@@ -2,14 +2,14 @@
 
 import android.view.View;
 
-import androidx.recyclerview.widget.RecyclerView;
+import androidx.annotation.NonNull;
+import androidx.recyclerview.widget.RecyclerView.ViewHolder;
 
-import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
+import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.UnmovableItem;
 
-public class DividerViewHolder extends RecyclerView.ViewHolder
-		implements ReorderItemTouchHelperCallback.UnmovableItem {
+public class DividerViewHolder extends ViewHolder implements UnmovableItem {
 
-	public DividerViewHolder(View itemView) {
+	public DividerViewHolder(@NonNull View itemView) {
 		super(itemView);
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/HeaderViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/HeaderViewHolder.java
index 65e062ce8ce..1dfa1831349 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/HeaderViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/HeaderViewHolder.java
@@ -3,19 +3,19 @@
 import android.view.View;
 import android.widget.TextView;
 
-import androidx.recyclerview.widget.RecyclerView;
+import androidx.annotation.NonNull;
+import androidx.recyclerview.widget.RecyclerView.ViewHolder;
 
 import net.osmand.plus.R;
-import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
+import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.UnmovableItem;
 
-public class HeaderViewHolder extends RecyclerView.ViewHolder
-		implements ReorderItemTouchHelperCallback.UnmovableItem {
+public class HeaderViewHolder extends ViewHolder implements UnmovableItem {
 
-	public final TextView tvTitle;
+	public final TextView title;
 
-	public HeaderViewHolder(View itemView) {
+	public HeaderViewHolder(@NonNull View itemView) {
 		super(itemView);
-		tvTitle = itemView.findViewById(R.id.title);
+		title = itemView.findViewById(R.id.title);
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/SpaceViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/SpaceViewHolder.java
index f9b522c45cc..3c42071ede4 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/SpaceViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/SpaceViewHolder.java
@@ -4,23 +4,19 @@
 import android.view.ViewGroup;
 import android.widget.FrameLayout;
 
-import androidx.recyclerview.widget.RecyclerView;
+import androidx.annotation.NonNull;
+import androidx.recyclerview.widget.RecyclerView.ViewHolder;
 
-import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
+import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.UnmovableItem;
 
-public class SpaceViewHolder extends RecyclerView.ViewHolder
-		implements ReorderItemTouchHelperCallback.UnmovableItem {
+public class SpaceViewHolder extends ViewHolder implements UnmovableItem {
 
-	View space;
-
-	public SpaceViewHolder(View itemView) {
+	public SpaceViewHolder(@NonNull View itemView) {
 		super(itemView);
-		space = itemView;
 	}
 
-	public void setSpace(int hSpace) {
-		ViewGroup.LayoutParams lp = new FrameLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, hSpace);
-		space.setLayoutParams(lp);
+	public void setHeight(int height) {
+		itemView.setLayoutParams(new FrameLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, height));
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java
index fa1151a3528..637492a62e8 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/reorder/viewholder/WidgetViewHolder.java
@@ -5,12 +5,12 @@
 import android.widget.TextView;
 
 import androidx.recyclerview.widget.RecyclerView;
+import androidx.recyclerview.widget.RecyclerView.ViewHolder;
 
 import net.osmand.plus.R;
-import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
+import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback.UnmovableItem;
 
-public class WidgetViewHolder extends RecyclerView.ViewHolder
-		implements ReorderItemTouchHelperCallback.UnmovableItem {
+public class WidgetViewHolder extends ViewHolder implements UnmovableItem {
 
 	public TextView title;
 	public ImageView icon;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CoordinatesWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CoordinatesWidget.java
index d3bb83047b1..98e48d6b27f 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CoordinatesWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/CoordinatesWidget.java
@@ -7,6 +7,10 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.core.content.ContextCompat;
+
 import com.google.android.material.snackbar.Snackbar;
 import com.jwetherell.openmap.common.LatLonPoint;
 import com.jwetherell.openmap.common.MGRSPoint;
@@ -30,10 +34,6 @@
 
 import org.apache.commons.logging.Log;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.core.content.ContextCompat;
-
 public class CoordinatesWidget extends MapWidget {
 
 	private static final Log log = PlatformUtil.getLog(CoordinatesWidget.class);
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LanesWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LanesWidget.java
index 5e9e5395db6..7b9cb85c587 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LanesWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LanesWidget.java
@@ -4,6 +4,9 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
 import net.osmand.Location;
 import net.osmand.binary.RouteDataObject;
 import net.osmand.plus.OsmAndLocationProvider;
@@ -25,9 +28,6 @@
 import java.util.Arrays;
 import java.util.List;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-
 public class LanesWidget extends MapWidget {
 
 	private static final int MAX_METERS_NOT_SPOKEN_TURN = 800;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LeftTextInfoWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LeftTextInfoWidget.java
index 4ab1a18f226..d4d0c54add6 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LeftTextInfoWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/LeftTextInfoWidget.java
@@ -1,10 +1,10 @@
 package net.osmand.plus.views.mapwidgets.widgets;
 
+import androidx.annotation.NonNull;
+
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.views.layers.MapInfoLayer.TextState;
 
-import androidx.annotation.NonNull;
-
 public class LeftTextInfoWidget extends TextInfoWidget {
 
 	public LeftTextInfoWidget(@NonNull MapActivity mapActivity) {
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java
index 84bfdc245c2..e90b2542589 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkerSideWidget.java
@@ -2,6 +2,9 @@
 
 import android.graphics.drawable.Drawable;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
 import net.osmand.Location;
 import net.osmand.data.LatLon;
 import net.osmand.plus.R;
@@ -17,9 +20,6 @@
 
 import java.util.List;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-
 public class MapMarkerSideWidget extends RightTextInfoWidget {
 
 	private final MapMarkersHelper mapMarkersHelper;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkersBarWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkersBarWidget.java
index 5773fe4d5a3..147a2fb6c16 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkersBarWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapMarkersBarWidget.java
@@ -6,6 +6,9 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
 import net.osmand.Location;
 import net.osmand.data.LatLon;
 import net.osmand.data.PointDescription;
@@ -25,9 +28,6 @@
 
 import java.util.List;
 
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-
 public class MapMarkersBarWidget extends MapWidget {
 
 	public static final int MIN_METERS_OK_VISIBLE = 40;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
index 286063c94e7..8fe2b52da56 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/MapWidget.java
@@ -6,6 +6,12 @@
 import android.view.ViewGroup;
 import android.widget.TextView;
 
+import androidx.annotation.ColorInt;
+import androidx.annotation.LayoutRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.annotation.StringRes;
+
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.helpers.AndroidUiHelper;
@@ -16,12 +22,6 @@
 
 import java.util.List;
 
-import androidx.annotation.ColorInt;
-import androidx.annotation.LayoutRes;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.annotation.StringRes;
-
 public abstract class MapWidget {
 
 	protected final OsmandApplication app;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/RightTextInfoWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/RightTextInfoWidget.java
index f11515a5553..376fffcafa5 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/RightTextInfoWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/RightTextInfoWidget.java
@@ -1,10 +1,10 @@
 package net.osmand.plus.views.mapwidgets.widgets;
 
+import androidx.annotation.NonNull;
+
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.views.layers.MapInfoLayer.TextState;
 
-import androidx.annotation.NonNull;
-
 public class RightTextInfoWidget extends TextInfoWidget {
 
 	public RightTextInfoWidget(@NonNull MapActivity mapActivity) {
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/StreetNameWidget.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/StreetNameWidget.java
index 4ed25986855..1d55d19f7c3 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/StreetNameWidget.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/widgets/StreetNameWidget.java
@@ -1,5 +1,8 @@
 package net.osmand.plus.views.mapwidgets.widgets;
 
+import static net.osmand.plus.render.OsmandRenderer.RenderingContext;
+import static net.osmand.plus.render.TextRenderer.TextDrawInfo;
+
 import android.graphics.Bitmap;
 import android.graphics.Canvas;
 import android.graphics.Paint;
@@ -13,6 +16,12 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import androidx.annotation.ColorRes;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.appcompat.content.res.AppCompatResources;
+import androidx.core.content.ContextCompat;
+
 import net.osmand.Location;
 import net.osmand.binary.BinaryMapRouteReaderAdapter.RouteTypeRule;
 import net.osmand.binary.RouteDataObject;
@@ -43,15 +52,6 @@
 
 import java.util.List;
 
-import androidx.annotation.ColorRes;
-import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
-import androidx.appcompat.content.res.AppCompatResources;
-import androidx.core.content.ContextCompat;
-
-import static net.osmand.plus.render.OsmandRenderer.RenderingContext;
-import static net.osmand.plus.render.TextRenderer.TextDrawInfo;
-
 public class StreetNameWidget extends MapWidget {
 
 	private static final int MAX_MARKER_DISTANCE = 50;
