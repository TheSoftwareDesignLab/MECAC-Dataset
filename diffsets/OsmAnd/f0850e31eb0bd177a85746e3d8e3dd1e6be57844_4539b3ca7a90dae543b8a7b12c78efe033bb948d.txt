diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/api/OsmAndContext.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/api/OsmAndContext.kt
index 70f6d31f493..2537323a546 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/api/OsmAndContext.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/api/OsmAndContext.kt
@@ -2,9 +2,11 @@ package net.osmand.shared.api
 
 import net.osmand.shared.data.SpeedConstants
 import net.osmand.shared.filters.KMetricsConstants
+import net.osmand.shared.util.KStringMatcher
 
 interface OsmAndContext {
 	fun isGpxFileVisible(path: String): Boolean
 	fun getSpeedSystem(): SpeedConstants?
 	fun getMetricSystem(): KMetricsConstants?
+	fun getNameStringMatcher(name: String): KStringMatcher
 }
\ No newline at end of file
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/custom_types/StringIntegerPair.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/custom_types/StringIntegerPair.kt
new file mode 100644
index 00000000000..03b90644093
--- /dev/null
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/custom_types/StringIntegerPair.kt
@@ -0,0 +1,3 @@
+package net.osmand.shared.custom_types
+
+class StringIntegerPair(var first: String, var second: Int)
\ No newline at end of file
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/KInteger.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/KInteger.kt
new file mode 100644
index 00000000000..f22dc4f1457
--- /dev/null
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/KInteger.kt
@@ -0,0 +1,3 @@
+package net.osmand.shared.data
+
+class KInteger(var intValue: Int)
\ No newline at end of file
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/WidthMode.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/KWidthMode.kt
similarity index 59%
rename from OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/WidthMode.kt
rename to OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/KWidthMode.kt
index acd87566b51..7d9cd9f4fa3 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/WidthMode.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/data/KWidthMode.kt
@@ -1,6 +1,6 @@
-package net.osmand.plus.card.width
+package net.osmand.shared.data
 
-enum class WidthMode(
+enum class KWidthMode(
 	val key: String) {
 	THIN("thin"),
 	MEDIUM("medium"),
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ColorSingleFieldTrackFilterParams.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ColorSingleFieldTrackFilterParams.kt
index a77dc0a92c9..0bda6a9b291 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ColorSingleFieldTrackFilterParams.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ColorSingleFieldTrackFilterParams.kt
@@ -1,6 +1,5 @@
 package net.osmand.shared.filters
 
-import net.osmand.plus.myplaces.tracks.filters.SingleFieldTrackFilterParams
 import net.osmand.shared.util.KAlgorithms
 import net.osmand.shared.util.PlatformUtil
 
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/DateTrackFilter.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/DateTrackFilter.kt
index bbd70fb0ad7..dfa19c88683 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/DateTrackFilter.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/DateTrackFilter.kt
@@ -20,8 +20,10 @@ class DateTrackFilter(
 	dateFrom: Long,
 	filterChangedListener: FilterChangedListener?) :
 	BaseTrackFilter(trackFilterType, filterChangedListener) {
-	var initialValueFrom = Instant.fromEpochMilliseconds(dateFrom)
-	var initialValueTo = Clock.System.now()
+	var initialValueFrom = dateFrom
+	var initialValueTo = Clock.System.now().toEpochMilliseconds()
+//	var initialValueFromInstant = Instant.fromEpochMilliseconds(dateFrom)
+//	var initialValueToInstant = Clock.System.now()
 
 	@Serializable
 	var valueFrom = initialValueFrom
@@ -43,9 +45,9 @@ class DateTrackFilter(
 			valueTo)
 	}
 
-	private fun isDatesEquals(day1: Instant, day2: Instant): Boolean {
-		val day1String: String = PlatformUtil.formatDate(day1, DATE_PATTERN)
-		val day2String: String = PlatformUtil.formatDate(day2, DATE_PATTERN)
+	private fun isDatesEquals(day1: Long, day2: Long): Boolean {
+		val day1String: String = PlatformUtil.formatDate(Instant.fromEpochMilliseconds(day1), DATE_PATTERN)
+		val day2String: String = PlatformUtil.formatDate(Instant.fromEpochMilliseconds(day2), DATE_PATTERN)
 		return day1String == day2String
 	}
 
@@ -53,7 +55,7 @@ class DateTrackFilter(
 
 		trackItem.dataItem?.let {
 			it.getParameter<Long>(GpxParameter.FILE_CREATION_TIME)?.let{creationTime ->
-				return Instant.fromEpochMilliseconds(creationTime) in valueFrom..valueTo
+				return creationTime in valueFrom..valueTo
 			}
 		}
 		return false
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/FolderSingleFieldTrackFilterParams.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/FolderSingleFieldTrackFilterParams.kt
index 5cc4dd6ef77..e58674dbb26 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/FolderSingleFieldTrackFilterParams.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/FolderSingleFieldTrackFilterParams.kt
@@ -1,6 +1,5 @@
 package net.osmand.shared.filters
 
-import net.osmand.plus.myplaces.tracks.filters.SingleFieldTrackFilterParams
 import net.osmand.shared.util.KAlgorithms
 import net.osmand.shared.util.PlatformUtil
 
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ListFilterAdapter.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ListFilterAdapter.kt
deleted file mode 100644
index 6cdaff49079..00000000000
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ListFilterAdapter.kt
+++ /dev/null
@@ -1,251 +0,0 @@
-package net.osmand.shared.filters
-
-import android.view.View
-import android.view.ViewGroup
-import android.widget.ImageView
-import androidx.fragment.app.FragmentManager
-import androidx.recyclerview.widget.RecyclerView
-import net.osmand.CollatorStringMatcher
-import net.osmand.plus.OsmandApplication
-import net.osmand.plus.R
-import net.osmand.plus.helpers.AndroidUiHelper
-import net.osmand.plus.myplaces.tracks.DialogClosedListener
-import net.osmand.plus.myplaces.tracks.dialogs.FilterAllVariantsListFragment
-import net.osmand.plus.myplaces.tracks.filters.viewholders.FilterVariantViewHolder
-import net.osmand.plus.myplaces.tracks.filters.viewholders.ShowAllViewHolder
-import net.osmand.plus.utils.UiUtilities
-import net.osmand.search.core.SearchPhrase
-import net.osmand.util.Algorithms
-import net.osmand.view.ThreeStateCheckbox
-
-class ListFilterAdapter(
-	val app: OsmandApplication,
-	var nightMode: Boolean,
-	val filterChangedListener: FilterChangedListener?,
-	private val filterPropertiesClosed: DialogClosedListener?) :
-	RecyclerView.Adapter<RecyclerView.ViewHolder>(),
-	TrackFilterPropertiesAdapter {
-	companion object {
-		private const val MIN_VISIBLE_COUNT = 5
-		private const val SELECT_ALL_ITEM_TYPE = 0
-		private const val ITEM_TYPE = 1
-		private const val SHOW_ALL_ITEM_TYPE = 2
-	}
-
-	var items = ArrayList<String>()
-	var showAllItems = false
-	private var additionalItems = ArrayList<String>()
-	lateinit var fragmentManager: FragmentManager
-	lateinit var filter: ListTrackFilter
-	private var isSelectAllItemsBeingSet = false
-
-	private val newSelectedItemsListener =
-		object : FilterAllVariantsListFragment.NewSelectedItemsListener {
-			override fun setSelectedItemsDiff(
-				allSelectedItems: List<String>,
-				selectedItems: List<String>) {
-				filterCollection("")
-				filter.setSelectedItems(allSelectedItems)
-				setNewSelectedItems(selectedItems)
-			}
-		}
-
-	override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder {
-		val inflater = UiUtilities.getInflater(parent.context, nightMode)
-		return when (viewType) {
-			ITEM_TYPE -> {
-				val view =
-					inflater.inflate(R.layout.track_filter_checkbox_item, parent, false)
-				FilterVariantViewHolder(view, nightMode)
-			}
-
-			SELECT_ALL_ITEM_TYPE -> {
-				val view = inflater.inflate(
-					R.layout.all_folders_filter_item,
-					parent,
-					false)
-				SelectAllViewHolder(app, view, nightMode)
-			}
-
-			else -> {
-				val view = inflater.inflate(
-					R.layout.show_all_filter_items_item,
-					parent,
-					false)
-				val topBottomPadding =
-					app.resources.getDimensionPixelSize(R.dimen.content_padding_small)
-				val leftRightPadding = if(items.size > 0 && filter.collectionFilterParams.getItemIcon(app, items[0]) != null) {
-					app.resources.getDimensionPixelSize(R.dimen.content_padding_extra_large)
-				} else {
-					app.resources.getDimensionPixelSize(R.dimen.content_padding)
-				}
-				view.setPadding(
-					leftRightPadding,
-					topBottomPadding,
-					leftRightPadding,
-					topBottomPadding)
-				ShowAllViewHolder(view)
-			}
-		}
-	}
-
-	override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) {
-		when (holder) {
-			is ShowAllViewHolder -> {
-				holder.title.setText(R.string.shared_string_show_all)
-				holder.itemView.setOnClickListener {
-					FilterAllVariantsListFragment.showInstance(
-						app,
-						fragmentManager,
-						filter,
-						filterPropertiesClosed,
-						newSelectedItemsListener,
-						nightMode)
-				}
-			}
-
-			is FilterVariantViewHolder -> {
-				val itemName = getItem(position)
-				val icon = filter.collectionFilterParams.getItemIcon(app, itemName)
-				holder.title.text = filter.collectionFilterParams.getItemText(app, itemName)
-				holder.icon.setImageDrawable(icon)
-				AndroidUiHelper.updateVisibility(holder.icon, icon != null)
-				AndroidUiHelper.updateVisibility(holder.divider, position != itemCount - 1)
-				holder.itemView.setOnClickListener {
-					filter.setItemSelected(itemName, !filter.isItemSelected(itemName))
-					this.notifyItemChanged(position)
-				}
-				holder.count.text = filter.getTracksCountForItem(itemName).toString()
-				holder.checkBox.isChecked = filter.isItemSelected(itemName)
-			}
-
-			is SelectAllViewHolder -> {
-				isSelectAllItemsBeingSet = true
-				holder.switch.state = if (filter.isSelectAllItemsSelected ||
-					filter.selectedItems.size == items.size) {
-					holder.switch.isChecked = true
-					ThreeStateCheckbox.State.CHECKED
-				} else if (filter.selectedItems.size > 0) {
-					holder.switch.isChecked = false
-					ThreeStateCheckbox.State.MISC
-				} else {
-					holder.switch.isChecked = false
-					ThreeStateCheckbox.State.UNCHECKED
-				}
-				isSelectAllItemsBeingSet = false
-				holder.icon.setImageDrawable(
-					filter.collectionFilterParams.getAllItemsIcon(app,
-						holder.switch.state != ThreeStateCheckbox.State.UNCHECKED,
-						nightMode))
-				holder.switch.setOnCheckedChangeListener { _, isChecked ->
-					onAllFolderSelected(holder.switch, isChecked)
-				}
-				holder.itemView.setOnClickListener {
-					onAllFolderSelected(holder.switch, !filter.isSelectAllItemsSelected)
-					this.notifyItemChanged(position)
-				}
-			}
-		}
-	}
-
-	private fun onAllFolderSelected(checkbox: ThreeStateCheckbox, selected: Boolean) {
-		if (isSelectAllItemsBeingSet) return
-		filter.isSelectAllItemsSelected = selected
-		if (selected) {
-			checkbox.state = ThreeStateCheckbox.State.CHECKED
-			filter.addSelectedItems(ArrayList(filter.allItemsCollection.keys))
-		} else {
-			filter.clearSelectedItems()
-			checkbox.state = ThreeStateCheckbox.State.UNCHECKED
-		}
-		notifyDataSetChanged()
-		filterChangedListener?.onFilterChanged()
-
-	}
-
-	override fun getItemCount(): Int {
-		val correctionForSelectAllItem = if (hasSelectAllVariant()) 1 else 0
-		return if (showAllItems) {
-			items.size
-		} else if (items.size > MIN_VISIBLE_COUNT) {
-			MIN_VISIBLE_COUNT +
-					additionalItems.size +
-					(if (MIN_VISIBLE_COUNT + additionalItems.size == items.size) 0 else 1) +
-					correctionForSelectAllItem
-		} else {
-			items.size + correctionForSelectAllItem
-		}
-	}
-
-	override fun getItemViewType(position: Int): Int {
-		return if (showAllItems) {
-			ITEM_TYPE
-		} else if (position == 0 && hasSelectAllVariant()) {
-			SELECT_ALL_ITEM_TYPE
-		} else if (position == itemCount - 1 && items.size > MIN_VISIBLE_COUNT + additionalItems.size) {
-			SHOW_ALL_ITEM_TYPE
-		} else {
-			ITEM_TYPE
-		}
-	}
-
-	private fun getItem(position: Int): String {
-		val correctionForSelectAllItem = if (hasSelectAllVariant()) 1 else 0
-		return if (showAllItems) {
-			items[position]
-		} else if (position - correctionForSelectAllItem < MIN_VISIBLE_COUNT) {
-			items[position - correctionForSelectAllItem]
-		} else {
-			additionalItems[position - correctionForSelectAllItem - MIN_VISIBLE_COUNT]
-		}
-	}
-
-	private fun hasSelectAllVariant() = filter.collectionFilterParams.hasSelectAllVariant()
-
-	override fun setNewSelectedItems(newSelectedItems: List<String>) {
-		val additionalItems = ArrayList<String>()
-		val correctionForSelectAllItem = if (hasSelectAllVariant()) 1 else 0
-		for (selectedItem in newSelectedItems) {
-			if (items.indexOf(selectedItem) + correctionForSelectAllItem >= MIN_VISIBLE_COUNT) {
-				additionalItems.add(selectedItem)
-			}
-		}
-		this.additionalItems = additionalItems
-		notifyDataSetChanged()
-	}
-
-	override fun filterCollection(query: String) {
-		val filteredItems = ArrayList<String>()
-		if (Algorithms.isEmpty(query)) {
-			filteredItems.addAll(filter.allItems)
-		} else {
-			val matcher = SearchPhrase.NameStringMatcher(
-				query.trim { it <= ' ' },
-				CollatorStringMatcher.StringMatcherMode.CHECK_CONTAINS)
-			filter.let {
-				for (item in it.allItems) {
-					if (matcher.matches(item)) {
-						filteredItems.add(item)
-					}
-				}
-			}
-		}
-		items = filteredItems
-		notifyDataSetChanged()
-	}
-
-	class SelectAllViewHolder(app: OsmandApplication, view: View, val nightMode: Boolean) :
-		RecyclerView.ViewHolder(view) {
-		var switch: ThreeStateCheckbox
-		var icon: ImageView
-
-		init {
-			switch = view.findViewById(R.id.toggle_item)
-			icon = view.findViewById(R.id.icon)
-			UiUtilities.setupCompoundButton(
-				nightMode,
-				net.osmand.plus.utils.ColorUtilities.getActiveColor(app, nightMode),
-				switch)
-		}
-	}
-}
\ No newline at end of file
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ListTrackFilter.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ListTrackFilter.kt
index aca1c2f63b6..4459527563c 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ListTrackFilter.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/ListTrackFilter.kt
@@ -2,11 +2,13 @@ package net.osmand.shared.filters
 
 import kotlinx.serialization.Serializable
 import net.osmand.plus.configmap.tracks.TrackItem
-import net.osmand.plus.myplaces.tracks.filters.SingleFieldTrackFilterParams
+import net.osmand.shared.custom_types.StringIntegerPair
+import net.osmand.shared.data.KInteger
 import net.osmand.shared.gpx.GpxParameter
 import net.osmand.shared.util.KAlgorithms
 import net.osmand.shared.util.MultiNameSerializer
 import net.osmand.shared.util.SerialNames
+import kotlin.Pair
 
 open class ListTrackFilter(
 	trackFilterType: TrackFilterType,
@@ -70,7 +72,7 @@ open class ListTrackFilter(
 			filterChangedListener?.onFilterChanged()
 		}
 
-	fun setFullItemsCollection(collection: List<Pair<String, Int>>) {
+	fun setFullItemsCollection(collection: List<StringIntegerPair>) {
 		val tmpAllItems = ArrayList<String>()
 		val tmpAllItemsCollection = HashMap<String, Int>()
 		for (pair in collection) {
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/SingleFieldTrackFilterParams.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/SingleFieldTrackFilterParams.kt
index 8825a00feaf..27dddf56f39 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/SingleFieldTrackFilterParams.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/SingleFieldTrackFilterParams.kt
@@ -1,4 +1,4 @@
-package net.osmand.plus.myplaces.tracks.filters
+package net.osmand.shared.filters
 
 
 open class SingleFieldTrackFilterParams {
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TextTrackFilter.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TextTrackFilter.kt
index b93e9578636..2cbdaea3af6 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TextTrackFilter.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TextTrackFilter.kt
@@ -1,20 +1,20 @@
 package net.osmand.shared.filters
 
-import com.google.gson.annotations.Expose
-import net.osmand.CollatorStringMatcher
+import kotlinx.serialization.Serializable
 import net.osmand.plus.configmap.tracks.TrackItem
-import net.osmand.search.core.SearchPhrase
-import net.osmand.util.Algorithms
+import net.osmand.shared.util.KAlgorithms
+import net.osmand.shared.util.KStringMatcher
+import net.osmand.shared.util.PlatformUtil
 
 class TextTrackFilter(
 	trackFilterType: TrackFilterType,
 	filterChangedListener: FilterChangedListener?)
 	: BaseTrackFilter(trackFilterType, filterChangedListener) {
 
-	@Expose
+	@Serializable
 	var value = ""
 		set(value) {
-			if (!Algorithms.stringsEqual(field, value)) {
+			if (!KAlgorithms.stringsEqual(field, value)) {
 				field = value
 				updateMatcher()
 			}
@@ -27,10 +27,8 @@ class TextTrackFilter(
 		nameMatcher = createMatcher()
 	}
 
-	private fun createMatcher(): SearchPhrase.NameStringMatcher {
-		return SearchPhrase.NameStringMatcher(
-			value.trim { it <= ' ' },
-			CollatorStringMatcher.StringMatcherMode.CHECK_CONTAINS)
+	private fun createMatcher(): KStringMatcher {
+		return PlatformUtil.getOsmAndContext().getNameStringMatcher(value.trim { it <= ' ' })
 	}
 
 	override fun isTrackAccepted(trackItem: TrackItem): Boolean {
@@ -41,7 +39,7 @@ class TextTrackFilter(
 	}
 
 	override fun isEnabled(): Boolean {
-		return !Algorithms.isEmpty(value)
+		return !KAlgorithms.isEmpty(value)
 	}
 
 	override fun initWithValue(sourseFilter: BaseTrackFilter) {
@@ -55,7 +53,7 @@ class TextTrackFilter(
 	override fun equals(other: Any?): Boolean {
 		return super.equals(other) &&
 				other is TextTrackFilter &&
-				Algorithms.stringsEqual(other.value, value)
+				KAlgorithms.stringsEqual(other.value, value)
 	}
 
 	override fun hashCode(): Int {
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TrackFilterType.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TrackFilterType.kt
index fc8504a15ce..2d4735c436c 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TrackFilterType.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TrackFilterType.kt
@@ -1,10 +1,8 @@
 package net.osmand.shared.filters
 
-import net.osmand.plus.myplaces.tracks.filters.SingleFieldTrackFilterParams
 import net.osmand.shared.gpx.GpxParameter
 import net.osmand.shared.filters.OtherTrackParam.VISIBLE_ON_MAP
 import net.osmand.shared.filters.OtherTrackParam.WITH_WAYPOINTS
-import net.osmand.shared.filters.FilterType
 
 enum class TrackFilterType(
 	val nameResId: String,
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TrackFiltersHelper.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TrackFiltersHelper.kt
new file mode 100644
index 00000000000..31885803535
--- /dev/null
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/TrackFiltersHelper.kt
@@ -0,0 +1,150 @@
+package net.osmand.shared.filters
+
+import kotlinx.datetime.Clock
+import net.osmand.shared.gpx.GpxParameter
+import net.osmand.shared.filters.FilterType.TEXT
+import net.osmand.shared.filters.FilterType.RANGE
+import net.osmand.shared.filters.FilterType.DATE_RANGE
+import net.osmand.shared.filters.FilterType.OTHER
+import net.osmand.shared.filters.FilterType.SINGLE_FIELD_LIST
+import kotlin.reflect.KClass
+
+object TrackFiltersHelper {
+	fun createTextFilter(
+		filterType: TrackFilterType,
+		listener: FilterChangedListener?): BaseTrackFilter {
+		return TextTrackFilter(filterType, listener)
+	}
+
+	fun createDateFilter(
+		trackFilterType: TrackFilterType,
+		minDate: Long,
+		listener: FilterChangedListener?): BaseTrackFilter {
+		return DateTrackFilter(trackFilterType, minDate, listener)
+	}
+
+	fun createOtherFilter(
+		trackFilterType: TrackFilterType,
+		listener: FilterChangedListener?): BaseTrackFilter {
+		return OtherTrackFilter(trackFilterType, listener)
+	}
+
+	fun createSingleListFilter(
+		trackFilterType: TrackFilterType,
+		listener: FilterChangedListener?): BaseTrackFilter {
+		return if (trackFilterType === TrackFilterType.FOLDER) FolderTrackFilter(
+			listener) else ListTrackFilter(trackFilterType, listener)
+	}
+
+	fun createRangeFilter(
+		trackFilterType: TrackFilterType,
+		listener: FilterChangedListener?): BaseTrackFilter {
+		if (trackFilterType.defaultParams == null || trackFilterType.defaultParams.size < 2) {
+			throw IllegalArgumentException("RangeTrackFilter needs 2 default params: minValue, maxValue")
+		}
+		val minValue: Any = trackFilterType.defaultParams[0]
+		val maxValue: Any = trackFilterType.defaultParams[1]
+		if (minValue::class != maxValue::class) {
+			throw IllegalArgumentException("RangeTrackFilter's 2 default params (minValue, maxValue) must be the same type")
+		}
+		val parameter = trackFilterType.property
+		if (isGpxParameterClass(parameter, Double::class)) {
+			return RangeTrackFilter(
+				minValue as Double,
+				maxValue as Double,
+				trackFilterType,
+				listener)
+		} else if (isGpxParameterClass(parameter, Float::class)) {
+			return RangeTrackFilter(
+				minValue as Float,
+				maxValue as Float,
+				trackFilterType,
+				listener)
+		} else if (isGpxParameterClass(parameter, Int::class)) {
+			return RangeTrackFilter(
+				minValue as Int,
+				maxValue as Int,
+				trackFilterType,
+				listener)
+		} else if (isGpxParameterClass(parameter, Long::class)) {
+			return RangeTrackFilter(
+				minValue as Long,
+				maxValue as Long,
+				trackFilterType,
+				listener)
+		}
+		throw IllegalArgumentException("Unsupported gpxParameter type class " + parameter?.typeClass)
+	}
+
+	private fun isGpxParameterClass(parameter: GpxParameter?, javaClass: KClass<*>): Boolean {
+		return parameter?.typeClass == javaClass
+	}
+
+	fun createFilter(
+		trackFilterType: TrackFilterType,
+		filterChangedListener: FilterChangedListener?): BaseTrackFilter {
+		val newFilter: BaseTrackFilter
+		newFilter = when (trackFilterType.filterType) {
+			TEXT -> {
+				createTextFilter(
+					trackFilterType,
+					filterChangedListener)
+			}
+
+			RANGE -> {
+				createRangeFilter(
+					trackFilterType,
+					filterChangedListener)
+			}
+
+			DATE_RANGE -> {
+				createDateFilter(
+					trackFilterType,
+					Clock.System.now().toEpochMilliseconds(),
+					filterChangedListener)
+			}
+
+			OTHER -> {
+				createOtherFilter(
+					trackFilterType,
+					filterChangedListener)
+			}
+
+			SINGLE_FIELD_LIST -> {
+				createSingleListFilter(
+					trackFilterType,
+					filterChangedListener)
+			}
+
+			else -> throw IllegalArgumentException("Unknown filterType $trackFilterType")
+		}
+		return newFilter
+	}
+
+	fun getFilterClass(trackFilterType: TrackFilterType): KClass<out BaseTrackFilter> {
+		var filterClass = when (trackFilterType.filterType) {
+			TEXT -> {
+				TextTrackFilter::class
+			}
+
+			RANGE -> {
+				RangeTrackFilter::class
+			}
+
+			DATE_RANGE -> {
+				DateTrackFilter::class
+			}
+
+			OTHER -> {
+				OtherTrackFilter::class
+			}
+
+			SINGLE_FIELD_LIST -> {
+				ListTrackFilter::class
+			}
+
+			else -> throw IllegalArgumentException("Unknown filterType $trackFilterType")
+		}
+		return filterClass
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/WidthSingleFieldTrackFilterParams.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/WidthSingleFieldTrackFilterParams.kt
index d2b2e40db0f..5839c1db290 100644
--- a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/WidthSingleFieldTrackFilterParams.kt
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/filters/WidthSingleFieldTrackFilterParams.kt
@@ -1,7 +1,6 @@
 package net.osmand.shared.filters
 
-import net.osmand.plus.card.width.WidthMode
-import net.osmand.plus.myplaces.tracks.filters.SingleFieldTrackFilterParams
+import net.osmand.shared.data.KWidthMode
 import net.osmand.shared.util.KAlgorithms
 import net.osmand.shared.util.PlatformUtil
 
@@ -33,9 +32,9 @@ class WidthSingleFieldTrackFilterParams : SingleFieldTrackFilterParams() {
 			PlatformUtil.getStringResource("not_specified")
 		} else {
 			when (itemName) {
-				WidthMode.THIN.key -> PlatformUtil.getStringResource("rendering_value_thin_name")
-				WidthMode.MEDIUM.key -> PlatformUtil.getStringResource("rendering_value_medium_name")
-				WidthMode.BOLD.key -> PlatformUtil.getStringResource("rendering_value_bold_name")
+				KWidthMode.THIN.key -> PlatformUtil.getStringResource("rendering_value_thin_name")
+				KWidthMode.MEDIUM.key -> PlatformUtil.getStringResource("rendering_value_medium_name")
+				KWidthMode.BOLD.key -> PlatformUtil.getStringResource("rendering_value_bold_name")
 				else -> {
 					"${PlatformUtil.getStringResource("shared_string_custom")}: $itemName"
 				}
diff --git a/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/util/KStringMatcher.kt b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/util/KStringMatcher.kt
new file mode 100644
index 00000000000..96fa3b87be9
--- /dev/null
+++ b/OsmAnd-shared/src/commonMain/kotlin/net/osmand/shared/util/KStringMatcher.kt
@@ -0,0 +1,5 @@
+package net.osmand.shared.util
+
+interface KStringMatcher {
+	fun matches(name: String): Boolean
+}
\ No newline at end of file
diff --git a/OsmAnd-shared/src/iosMain/kotlin/net/osmand/shared/util/PlatformUtil.kt b/OsmAnd-shared/src/iosMain/kotlin/net/osmand/shared/util/PlatformUtil.kt
index cb703a9f2de..fb8cc665f8e 100644
--- a/OsmAnd-shared/src/iosMain/kotlin/net/osmand/shared/util/PlatformUtil.kt
+++ b/OsmAnd-shared/src/iosMain/kotlin/net/osmand/shared/util/PlatformUtil.kt
@@ -1,6 +1,7 @@
 package net.osmand.shared.util
 
 import kotlinx.datetime.Instant
+import net.osmand.shared.api.OsmAndContext
 import net.osmand.shared.api.SQLiteAPI
 import net.osmand.shared.api.SQLiteAPIImpl
 import net.osmand.shared.api.XmlFactoryAPI
@@ -83,4 +84,8 @@ actual object PlatformUtil {
 	actual fun formatDate(date: Instant, pattern: String): String {
 		TODO("Not yet implemented")
 	}
+
+	actual fun getOsmAndContext(): OsmAndContext {
+		TODO("Not yet implemented")
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/OsmAndContextImpl.kt b/OsmAnd/src/net/osmand/OsmAndContextImpl.kt
index 077c9d96eeb..bd1c21310cb 100644
--- a/OsmAnd/src/net/osmand/OsmAndContextImpl.kt
+++ b/OsmAnd/src/net/osmand/OsmAndContextImpl.kt
@@ -1,17 +1,17 @@
 package net.osmand
 
-import android.content.Context
 import net.osmand.plus.OsmandApplication
 import net.osmand.plus.settings.enums.MetricsConstants
-import net.osmand.shared.api.OsmAndContext
-import net.osmand.shared.data.SpeedConstants
 import net.osmand.plus.settings.enums.SpeedConstants.KILOMETERS_PER_HOUR
-import net.osmand.plus.settings.enums.SpeedConstants.MILES_PER_HOUR
 import net.osmand.plus.settings.enums.SpeedConstants.METERS_PER_SECOND
-import net.osmand.plus.settings.enums.SpeedConstants.MINUTES_PER_MILE
+import net.osmand.plus.settings.enums.SpeedConstants.MILES_PER_HOUR
 import net.osmand.plus.settings.enums.SpeedConstants.MINUTES_PER_KILOMETER
+import net.osmand.plus.settings.enums.SpeedConstants.MINUTES_PER_MILE
 import net.osmand.plus.settings.enums.SpeedConstants.NAUTICALMILES_PER_HOUR
+import net.osmand.shared.api.OsmAndContext
+import net.osmand.shared.data.SpeedConstants
 import net.osmand.shared.filters.KMetricsConstants
+import net.osmand.shared.util.KStringMatcher
 import java.lang.ref.WeakReference
 
 object OsmAndContextImpl: OsmAndContext {
@@ -61,4 +61,14 @@ object OsmAndContextImpl: OsmAndContext {
 		}
 		return null
 	}
+
+	override fun getNameStringMatcher(name: String): KStringMatcher {
+		return object:KStringMatcher{
+			private val sm: CollatorStringMatcher = CollatorStringMatcher(name, CollatorStringMatcher.StringMatcherMode.CHECK_CONTAINS)
+
+			override fun matches(name: String): Boolean {
+				return sm.matches(name)
+			}
+		}
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/base/dialog/DialogManager.java b/OsmAnd/src/net/osmand/plus/base/dialog/DialogManager.java
index 9b04f3c4322..406a5f70e78 100644
--- a/OsmAnd/src/net/osmand/plus/base/dialog/DialogManager.java
+++ b/OsmAnd/src/net/osmand/plus/base/dialog/DialogManager.java
@@ -13,18 +13,18 @@
 import net.osmand.plus.base.dialog.data.DisplayData;
 import net.osmand.plus.base.dialog.data.DisplayItem;
 import net.osmand.plus.base.dialog.interfaces.controller.IDialogController;
-import net.osmand.plus.base.dialog.interfaces.controller.IOnDialogDismissed;
 import net.osmand.plus.base.dialog.interfaces.controller.IDialogItemClicked;
 import net.osmand.plus.base.dialog.interfaces.controller.IDialogItemSelected;
 import net.osmand.plus.base.dialog.interfaces.controller.IDisplayDataProvider;
+import net.osmand.plus.base.dialog.interfaces.controller.IOnDialogDismissed;
 import net.osmand.plus.base.dialog.interfaces.dialog.IAskDismissDialog;
 import net.osmand.plus.base.dialog.interfaces.dialog.IAskRefreshDialogCompletely;
 import net.osmand.plus.base.dialog.interfaces.dialog.IDialog;
-import net.osmand.plus.myplaces.tracks.filters.BaseTrackFilter;
 import net.osmand.plus.myplaces.tracks.filters.SmartFolderHelper;
 import net.osmand.plus.widgets.alert.AlertDialogData;
 import net.osmand.plus.widgets.alert.AlertDialogExtra;
 import net.osmand.plus.widgets.alert.CustomAlert;
+import net.osmand.shared.filters.BaseTrackFilter;
 import net.osmand.util.Algorithms;
 
 import java.util.HashMap;
diff --git a/OsmAnd/src/net/osmand/plus/card/width/WidthComponentController.java b/OsmAnd/src/net/osmand/plus/card/width/WidthComponentController.java
index 708d23acd3c..10f6577b65a 100644
--- a/OsmAnd/src/net/osmand/plus/card/width/WidthComponentController.java
+++ b/OsmAnd/src/net/osmand/plus/card/width/WidthComponentController.java
@@ -16,6 +16,7 @@
 import net.osmand.plus.card.base.slider.moded.data.SliderMode;
 import net.osmand.plus.track.fragments.TrackAppearanceFragment.OnNeedScrollListener;
 import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.shared.data.KWidthMode;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -29,10 +30,10 @@ public class WidthComponentController implements IModedSliderController {
 	private OnNeedScrollListener onNeedScrollListener;
 	@ColorInt
 	private Integer iconsColor;
-	private WidthMode widthMode;
+	private KWidthMode widthMode;
 	private int customValue;
 
-	public WidthComponentController(@NonNull WidthMode widthMode, int customValue,
+	public WidthComponentController(@NonNull KWidthMode widthMode, int customValue,
 	                                @NonNull WidthComponentListener listener) {
 		this.listener = listener;
 		this.widthMode = widthMode;
@@ -56,7 +57,7 @@ public void onChangeSliderValue(float newValue) {
 
 	@Override
 	public boolean isSliderVisible() {
-		return widthMode == WidthMode.CUSTOM;
+		return widthMode == KWidthMode.CUSTOM;
 	}
 
 	@NonNull
@@ -72,17 +73,17 @@ public int getSelectedSliderValue() {
 	@Override
 	public @NonNull List<SliderMode> getSliderModes() {
 		List<SliderMode> sliderModes = new ArrayList<>();
-		for (WidthMode widthMode : WidthMode.values()) {
+		for (KWidthMode widthMode : KWidthMode.values()) {
 			sliderModes.add(new SliderMode(widthMode.getIconId(), widthMode));
 		}
 		return sliderModes;
 	}
 
 	public void askSelectWidthMode(@Nullable String width) {
-		askSelectWidthMode(WidthMode.valueOfKey(width));
+		askSelectWidthMode(KWidthMode.valueOfKey(width));
 	}
 
-	private void askSelectWidthMode(@NonNull WidthMode widthMode) {
+	private void askSelectWidthMode(@NonNull KWidthMode widthMode) {
 		askSelectSliderMode(new SliderMode(widthMode.getIconId(), widthMode));
 	}
 
@@ -94,7 +95,7 @@ public SliderMode getSelectedSliderMode() {
 
 	public void askSelectSliderMode(@NonNull SliderMode sliderMode) {
 		if (!isSelectedSliderMode(sliderMode)) {
-			widthMode = (WidthMode) sliderMode.getTag();
+			widthMode = (KWidthMode) sliderMode.getTag();
 			if (cardInstance != null) {
 				cardInstance.updateSegmentedButtonSelection();
 				cardInstance.updateSliderVisibility();
@@ -111,7 +112,7 @@ public boolean isSelectedSliderMode(@NonNull SliderMode sliderMode) {
 
 	@NonNull
 	public String getSummary(@NonNull Context context) {
-		if (widthMode == WidthMode.CUSTOM) {
+		if (widthMode == KWidthMode.CUSTOM) {
 			String custom = context.getString(R.string.shared_string_custom);
 			String value = getSelectedCustomValue();
 			return context.getString(R.string.ltr_or_rtl_combine_via_comma, custom, value);
@@ -121,7 +122,7 @@ public String getSummary(@NonNull Context context) {
 
 	@NonNull
 	public String getSelectedWidthValue() {
-		return widthMode == WidthMode.CUSTOM ? String.valueOf(customValue) : widthMode.getKey();
+		return widthMode == KWidthMode.CUSTOM ? String.valueOf(customValue) : widthMode.getKey();
 	}
 
 	private void notifyWidthSelected() {
@@ -130,7 +131,7 @@ private void notifyWidthSelected() {
 	}
 
 	private void requestVerticalScrollIfNeeded() {
-		if (widthMode == WidthMode.CUSTOM && cardInstance != null) {
+		if (widthMode == KWidthMode.CUSTOM && cardInstance != null) {
 			View sliderContainer = cardInstance.getSliderContainer();
 			ScrollUtils.addOnGlobalLayoutListener(sliderContainer, () -> {
 				if (sliderContainer.getVisibility() == View.VISIBLE && onNeedScrollListener != null) {
diff --git a/OsmAnd/src/net/osmand/plus/card/width/WidthMode.java b/OsmAnd/src/net/osmand/plus/card/width/WidthMode.java
index 2eef0dce735..a524657e648 100644
--- a/OsmAnd/src/net/osmand/plus/card/width/WidthMode.java
+++ b/OsmAnd/src/net/osmand/plus/card/width/WidthMode.java
@@ -6,6 +6,7 @@
 import androidx.annotation.StringRes;
 
 import net.osmand.plus.R;
+import net.osmand.shared.data.KWidthMode;
 import net.osmand.util.Algorithms;
 
 import java.util.Objects;
@@ -40,11 +41,11 @@ public int getTitleId() {
 	}
 
 	@NonNull
-	public static WidthMode valueOfKey(@Nullable String key) {
+	public static KWidthMode valueOfKey(@Nullable String key) {
 		if (key != null && Algorithms.isInt(key)) {
 			return CUSTOM;
 		}
-		for (WidthMode widthMode : values()) {
+		for (KWidthMode widthMode : values()) {
 			if (Objects.equals(widthMode.getKey(), key)) {
 				return widthMode;
 			}
diff --git a/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt b/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt
index 17b4d88fb64..642852b4022 100644
--- a/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt
+++ b/OsmAnd/src/net/osmand/plus/configmap/tracks/SearchTrackAdapter.kt
@@ -18,13 +18,13 @@ import net.osmand.plus.configmap.tracks.viewholders.SortTracksViewHolder.SortTra
 import net.osmand.plus.configmap.tracks.viewholders.TrackViewHolder
 import net.osmand.plus.configmap.tracks.viewholders.TrackViewHolder.TrackSelectionListener
 import net.osmand.plus.myplaces.tracks.TracksSearchFilter
-import net.osmand.plus.myplaces.tracks.filters.BaseTrackFilter
 import net.osmand.plus.settings.enums.TracksSortMode
 import net.osmand.plus.track.data.TrackFolder
 import net.osmand.plus.utils.ColorUtilities
 import net.osmand.plus.utils.UiUtilities
 import net.osmand.plus.utils.UpdateLocationUtils
 import net.osmand.plus.utils.UpdateLocationUtils.UpdateLocationViewCache
+import net.osmand.shared.filters.BaseTrackFilter
 import net.osmand.util.Algorithms
 import java.util.Collections
 
diff --git a/OsmAnd/src/net/osmand/plus/configmap/tracks/appearance/subcontrollers/WidthCardController.java b/OsmAnd/src/net/osmand/plus/configmap/tracks/appearance/subcontrollers/WidthCardController.java
index 40c265fe8e6..3cd8215cfa9 100644
--- a/OsmAnd/src/net/osmand/plus/configmap/tracks/appearance/subcontrollers/WidthCardController.java
+++ b/OsmAnd/src/net/osmand/plus/configmap/tracks/appearance/subcontrollers/WidthCardController.java
@@ -18,7 +18,7 @@
 import net.osmand.plus.card.base.slider.moded.ModedSliderCard;
 import net.osmand.plus.card.color.IControlsColorProvider;
 import net.osmand.plus.card.width.WidthComponentController;
-import net.osmand.plus.card.width.WidthMode;
+import net.osmand.shared.data.KWidthMode;
 import net.osmand.plus.configmap.tracks.appearance.data.AppearanceData;
 import net.osmand.plus.track.fragments.TrackAppearanceFragment.OnNeedScrollListener;
 import net.osmand.plus.track.fragments.controller.TrackWidthController.ITrackWidthSelectedListener;
@@ -139,7 +139,7 @@ private void widthValueSelected(@Nullable String widthValue) {
 	private WidthComponentController getWidthComponentController() {
 		if (widthComponentController == null) {
 			String selectedWidth = appearanceData.getParameter(WIDTH);
-			WidthMode widthMode = WidthMode.valueOfKey(selectedWidth);
+			KWidthMode widthMode = KWidthMode.valueOfKey(selectedWidth);
 			int customValue = Algorithms.parseIntSilently(selectedWidth, CUSTOM_WIDTH_MIN);
 			widthComponentController = new WidthComponentController(widthMode, customValue, this::widthValueSelected) {
 				@NonNull
@@ -163,7 +163,7 @@ protected CardState findCardState(@Nullable Object tag) {
 
 	@NonNull
 	private CardState findCardStateByWidthValue(@Nullable String width) {
-		return findCardState(width != null ? WidthMode.valueOfKey(width) : null);
+		return findCardState(width != null ? KWidthMode.valueOfKey(width) : null);
 	}
 
 	@Nullable
@@ -172,14 +172,14 @@ private String getWidthValue(@NonNull CardState cardState) {
 			WidthComponentController controller = getWidthComponentController();
 			return controller.getSelectedCustomValue();
 		}
-		if (cardState.getTag() instanceof WidthMode) {
-			return ((WidthMode) cardState.getTag()).getKey();
+		if (cardState.getTag() instanceof KWidthMode) {
+			return ((KWidthMode) cardState.getTag()).getKey();
 		}
 		return null;
 	}
 
 	private boolean isCustomValue(@NonNull CardState cardState) {
-		return cardState.getTag() == WidthMode.CUSTOM;
+		return cardState.getTag() == KWidthMode.CUSTOM;
 	}
 
 	@NonNull
@@ -191,7 +191,7 @@ protected List<CardState> collectSupportedCardStates() {
 		}
 		list.add(new CardState(R.string.shared_string_original));
 
-		for (WidthMode widthMode : WidthMode.values()) {
+		for (KWidthMode widthMode : KWidthMode.values()) {
 			list.add(new CardState(widthMode.getTitleId())
 					.setShowTopDivider(widthMode.ordinal() == 0)
 					.setTag(widthMode));
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java
index 5ec5879f1c2..1fe537dde59 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/SearchMyPlacesTracksFragment.java
@@ -30,8 +30,6 @@
 import net.osmand.plus.myplaces.tracks.dialogs.BaseTrackFolderFragment;
 import net.osmand.plus.myplaces.tracks.dialogs.MoveGpxFileBottomSheet.OnTrackFileMoveListener;
 import net.osmand.plus.myplaces.tracks.dialogs.TracksFilterFragment;
-import net.osmand.plus.myplaces.tracks.filters.BaseTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.FilterChangedListener;
 import net.osmand.plus.myplaces.tracks.filters.SmartFolderUpdateListener;
 import net.osmand.plus.track.data.SmartFolder;
 import net.osmand.plus.track.data.TrackFolder;
@@ -39,6 +37,8 @@
 import net.osmand.plus.track.helpers.SelectGpxTask.SelectGpxTaskListener;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.widgets.dialogbutton.DialogButton;
+import net.osmand.shared.filters.BaseTrackFilter;
+import net.osmand.shared.filters.FilterChangedListener;
 
 import java.io.File;
 import java.util.ArrayList;
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TrackFiltersHelper.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TrackFiltersHelper.java
deleted file mode 100644
index fe52ebcf434..00000000000
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TrackFiltersHelper.java
+++ /dev/null
@@ -1,127 +0,0 @@
-package net.osmand.plus.myplaces.tracks;
-
-import androidx.annotation.NonNull;
-
-import net.osmand.SharedUtil;
-import net.osmand.plus.OsmandApplication;
-import net.osmand.plus.myplaces.tracks.filters.BaseTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.DateTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.FilterChangedListener;
-import net.osmand.plus.myplaces.tracks.filters.FolderTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.ListTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.OtherTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.RangeTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.TextTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.TrackFilterType;
-import net.osmand.shared.gpx.GpxParameter;
-
-import java.util.Date;
-
-public class TrackFiltersHelper {
-
-	public static BaseTrackFilter createTextFilter(TrackFilterType filterType, FilterChangedListener listener) {
-		return new TextTrackFilter(filterType, listener);
-	}
-
-	public static BaseTrackFilter createDateFilter(TrackFilterType trackFilterType, Long minDate, FilterChangedListener listener) {
-		return new DateTrackFilter(trackFilterType, minDate, listener);
-	}
-
-	public static BaseTrackFilter createOtherFilter(OsmandApplication app, TrackFilterType trackFilterType, FilterChangedListener listener) {
-		return new OtherTrackFilter(app, trackFilterType, listener);
-	}
-
-	public static BaseTrackFilter createSingleListFilter(OsmandApplication app, TrackFilterType trackFilterType, FilterChangedListener listener) {
-		return trackFilterType == TrackFilterType.FOLDER
-				? new FolderTrackFilter(app, listener)
-				: new ListTrackFilter(app, trackFilterType, listener);
-	}
-
-	public static BaseTrackFilter createRangeFilter(OsmandApplication app, TrackFilterType trackFilterType, FilterChangedListener listener) {
-		if (trackFilterType.getDefaultParams().size() < 2) {
-			throw new IllegalArgumentException("RangeTrackFilter needs 2 default params: minValue, maxValue");
-		}
-		Object minValue = trackFilterType.getDefaultParams().get(0);
-		Object maxValue = trackFilterType.getDefaultParams().get(1);
-		if (minValue.getClass() != maxValue.getClass()) {
-			throw new IllegalArgumentException("RangeTrackFilter's 2 default params (minValue, maxValue) must be the same type");
-		}
-		GpxParameter parameter = trackFilterType.getProperty();
-		if (SharedUtil.isGpxParameterClass(parameter, Double.class)) {
-			return new RangeTrackFilter<>((Double) minValue, (Double) maxValue, app, trackFilterType, listener);
-		} else if (SharedUtil.isGpxParameterClass(parameter, Float.class)) {
-			return new RangeTrackFilter<>((Float) minValue, (Float) maxValue, app, trackFilterType, listener);
-		} else if (SharedUtil.isGpxParameterClass(parameter, Integer.class)) {
-			return new RangeTrackFilter<>((Integer) minValue, (Integer) maxValue, app, trackFilterType, listener);
-		} else if (SharedUtil.isGpxParameterClass(parameter, Long.class)) {
-			return new RangeTrackFilter<>((Long) minValue, (Long) maxValue, app, trackFilterType, listener);
-		}
-		throw new IllegalArgumentException("Unsupported gpxParameter type class " + parameter.getTypeClass());
-	}
-
-	public static BaseTrackFilter createFilter(OsmandApplication app, TrackFilterType trackFilterType, FilterChangedListener filterChangedListener) {
-		BaseTrackFilter newFilter;
-
-		switch (trackFilterType.getFilterType()) {
-			case TEXT: {
-				newFilter = createTextFilter(trackFilterType, filterChangedListener);
-				break;
-			}
-			case RANGE: {
-				newFilter = createRangeFilter(app, trackFilterType, filterChangedListener);
-				break;
-			}
-			case DATE_RANGE: {
-				newFilter = createDateFilter(trackFilterType, (new Date()).getTime(), filterChangedListener);
-				break;
-			}
-
-			case OTHER: {
-				newFilter = createOtherFilter(app, trackFilterType, filterChangedListener);
-				break;
-			}
-
-			case SINGLE_FIELD_LIST: {
-				newFilter = createSingleListFilter(app, trackFilterType, filterChangedListener);
-				break;
-			}
-
-			default:
-				throw new IllegalArgumentException("Unknown filterType " + trackFilterType);
-		}
-		return newFilter;
-	}
-
-	@NonNull
-	public static Class<? extends BaseTrackFilter> getFilterClass(TrackFilterType trackFilterType) {
-		Class<? extends BaseTrackFilter> filterClass = null;
-		switch (trackFilterType.getFilterType()) {
-			case TEXT: {
-				filterClass = TextTrackFilter.class;
-				break;
-			}
-			case RANGE: {
-				filterClass = RangeTrackFilter.class;
-				break;
-			}
-			case DATE_RANGE: {
-				filterClass = DateTrackFilter.class;
-				break;
-			}
-
-			case OTHER: {
-				filterClass = OtherTrackFilter.class;
-				break;
-			}
-
-			case SINGLE_FIELD_LIST: {
-				filterClass = ListTrackFilter.class;
-				break;
-			}
-
-			default:
-				throw new IllegalArgumentException("Unknown filterType " + trackFilterType);
-		}
-		return filterClass;
-	}
-}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java
index d0df9a3b65f..23a3a52e1f8 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TracksSearchFilter.java
@@ -10,15 +10,18 @@
 import net.osmand.plus.OsmAndTaskManager;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.configmap.tracks.TrackItem;
-import net.osmand.plus.myplaces.tracks.filters.BaseTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.DateTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.FilterChangedListener;
-import net.osmand.plus.myplaces.tracks.filters.ListTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.RangeTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.SingleFieldTrackFilterParams;
-import net.osmand.plus.myplaces.tracks.filters.TextTrackFilter;
-import net.osmand.plus.myplaces.tracks.filters.TrackFilterType;
+import net.osmand.shared.custom_types.StringIntegerPair;
+import net.osmand.shared.data.KInteger;
+import net.osmand.shared.filters.BaseTrackFilter;
+import net.osmand.shared.filters.DateTrackFilter;
+import net.osmand.shared.filters.FilterChangedListener;
+import net.osmand.shared.filters.ListTrackFilter;
+import net.osmand.shared.filters.RangeTrackFilter;
+import net.osmand.shared.filters.SingleFieldTrackFilterParams;
 import net.osmand.plus.track.data.TrackFolder;
+import net.osmand.shared.filters.TextTrackFilter;
+import net.osmand.shared.filters.TrackFilterType;
+import net.osmand.shared.filters.TrackFiltersHelper;
 import net.osmand.util.Algorithms;
 import net.osmand.util.CollectionUtils;
 
@@ -29,6 +32,9 @@
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
+import java.util.stream.Collectors;
+
+import kotlin.Pair;
 
 public class TracksSearchFilter extends Filter implements FilterChangedListener {
 	public static final Log LOG = PlatformUtil.getLog(TracksSearchFilter.class);
@@ -80,12 +86,18 @@ protected Void doInBackground(Void... voids) {
 							ListTrackFilter filter = (ListTrackFilter) getFilterByType(trackFilterType);
 							if (filter != null) {
 								SingleFieldTrackFilterParams filterParams = (SingleFieldTrackFilterParams) trackFilterType.getAdditionalData();
-								filter.setFullItemsCollection(app.getGpxDbHelper().getStringIntItemsCollection(
+
+
+								List<Pair<String, Integer>> items = app.getGpxDbHelper().getStringIntItemsCollection(
 										trackFilterType.getProperty().getColumnName(),
 										filterParams.includeEmptyValues(),
 										filterParams.sortByName(),
 										filterParams.sortDescending()
-								));
+								);
+
+								List<StringIntegerPair> itemsK = new ArrayList<>();
+								items.forEach(entry -> itemsK.add(new StringIntegerPair(entry.getFirst(),entry.getSecond())));
+								filter.setFullItemsCollection(itemsK);
 								if (trackFilterType == TrackFilterType.FOLDER) {
 									if (currentFolder != null) {
 										filter.setFirstItem(currentFolder.getRelativePath());
@@ -164,12 +176,15 @@ protected FilterResults performFiltering(CharSequence constraint) {
 		ListTrackFilter folderFilter = (ListTrackFilter) getFilterByType(TrackFilterType.FOLDER);
 		if (folderFilter != null) {
 			if (Algorithms.isEmpty(filterSpecificSearchResults)) {
-				folderFilter.setFullItemsCollection(app.getGpxDbHelper().getStringIntItemsCollection(
+				List<Pair<String, Integer>> items = app.getGpxDbHelper().getStringIntItemsCollection(
 						folderFilter.getTrackFilterType().getProperty().getColumnName(),
 						folderFilter.getCollectionFilterParams().includeEmptyValues(),
 						folderFilter.getCollectionFilterParams().sortByName(),
 						folderFilter.getCollectionFilterParams().sortDescending()
-				));
+				);
+				List<StringIntegerPair> itemsK = new ArrayList<>();
+				items.forEach(entry -> itemsK.add(new StringIntegerPair(entry.getFirst(),entry.getSecond())));
+				folderFilter.setFullItemsCollection(itemsK);
 			} else {
 				List<TrackItem> ignoreFoldersItems = filterSpecificSearchResults.get(TrackFilterType.FOLDER);
 				folderFilter.updateFullCollection(ignoreFoldersItems);
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/FilterAllVariantsListFragment.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/FilterAllVariantsListFragment.kt
index 82001b5c40c..4ac7fd6471e 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/FilterAllVariantsListFragment.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/FilterAllVariantsListFragment.kt
@@ -21,13 +21,13 @@ import net.osmand.plus.OsmandApplication
 import net.osmand.plus.R
 import net.osmand.plus.base.BaseOsmAndDialogFragment
 import net.osmand.plus.myplaces.tracks.DialogClosedListener
-import net.osmand.plus.myplaces.tracks.TrackFiltersHelper
+import net.osmand.shared.filters.TrackFiltersHelper
 import net.osmand.plus.myplaces.tracks.filters.ListFilterAdapter
-import net.osmand.plus.myplaces.tracks.filters.ListTrackFilter
 import net.osmand.plus.myplaces.tracks.filters.SmartFolderUpdateListener
 import net.osmand.plus.myplaces.tracks.filters.TrackFilterPropertiesAdapter
 import net.osmand.plus.utils.AndroidUtils
 import net.osmand.plus.widgets.dialogbutton.DialogButton
+import net.osmand.shared.filters.ListTrackFilter
 import studio.carbonylgroup.textfieldboxes.ExtendedEditText
 
 class FilterAllVariantsListFragment : BaseOsmAndDialogFragment(), SmartFolderUpdateListener {
@@ -44,14 +44,13 @@ class FilterAllVariantsListFragment : BaseOsmAndDialogFragment(), SmartFolderUpd
 		) {
 			if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 				val initialFilter =
-					TrackFiltersHelper.createFilter(app, filter.trackFilterType, null)
+					TrackFiltersHelper.createFilter(filter.trackFilterType, null)
 				if (initialFilter !is ListTrackFilter) {
 					throw IllegalArgumentException("Filter should be subclass from ListTrackFilter")
 				}
 				initialFilter.initWithValue(filter)
 				val currentFilter =
 					TrackFiltersHelper.createFilter(
-						app,
 						filter.trackFilterType,
 						null) as ListTrackFilter
 				currentFilter.initWithValue(filter)
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt
index edfd2c113b2..30bea96f7b5 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/TracksFilterFragment.kt
@@ -27,8 +27,6 @@ import net.osmand.plus.helpers.AndroidUiHelper
 import net.osmand.plus.myplaces.tracks.DialogClosedListener
 import net.osmand.plus.myplaces.tracks.SearchMyPlacesTracksFragment
 import net.osmand.plus.myplaces.tracks.TracksSearchFilter
-import net.osmand.plus.myplaces.tracks.filters.BaseTrackFilter
-import net.osmand.plus.myplaces.tracks.filters.FilterChangedListener
 import net.osmand.plus.myplaces.tracks.filters.FiltersAdapter
 import net.osmand.plus.myplaces.tracks.filters.SmartFolderHelper
 import net.osmand.plus.myplaces.tracks.filters.SmartFolderUpdateListener
@@ -37,6 +35,8 @@ import net.osmand.plus.track.data.TrackFolder
 import net.osmand.plus.utils.AndroidUtils
 import net.osmand.plus.utils.ColorUtilities.getStatusBarSecondaryColor
 import net.osmand.plus.widgets.dialogbutton.DialogButton
+import net.osmand.shared.filters.BaseTrackFilter
+import net.osmand.shared.filters.FilterChangedListener
 import net.osmand.util.Algorithms
 
 class TracksFilterFragment : BaseOsmAndDialogFragment(),
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/FiltersAdapter.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/FiltersAdapter.kt
index ae2751f8a95..fe984066bc7 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/FiltersAdapter.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/FiltersAdapter.kt
@@ -16,6 +16,12 @@ import net.osmand.plus.myplaces.tracks.filters.viewholders.FilterOtherViewHolder
 import net.osmand.plus.myplaces.tracks.filters.viewholders.FilterRangeViewHolder
 import net.osmand.plus.myplaces.tracks.filters.viewholders.ListFilterViewHolder
 import net.osmand.plus.utils.UiUtilities
+import net.osmand.shared.filters.DateTrackFilter
+import net.osmand.shared.filters.FilterType
+import net.osmand.shared.filters.ListTrackFilter
+import net.osmand.shared.filters.OtherTrackFilter
+import net.osmand.shared.filters.RangeTrackFilter
+import net.osmand.shared.filters.TextTrackFilter
 
 class FiltersAdapter(
 	private val app: OsmandApplication,
@@ -30,7 +36,7 @@ class FiltersAdapter(
 	override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder {
 		val inflater = UiUtilities.getInflater(parent.context, nightMode)
 
-		return when (FilterType.values()[viewType]) {
+		return when (FilterType.entries[viewType]) {
 			FilterType.TEXT -> {
 				val view = inflater.inflate(R.layout.filter_name_item, parent, false)
 				FilterNameViewHolder(view, nightMode)
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/ListFilterAdapter.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/ListFilterAdapter.kt
index e2ee7310902..870aad63092 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/ListFilterAdapter.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/ListFilterAdapter.kt
@@ -1,5 +1,7 @@
 package net.osmand.plus.myplaces.tracks.filters
 
+import android.graphics.Color
+import android.graphics.drawable.Drawable
 import android.view.View
 import android.view.ViewGroup
 import android.widget.ImageView
@@ -8,13 +10,22 @@ import androidx.recyclerview.widget.RecyclerView
 import net.osmand.CollatorStringMatcher
 import net.osmand.plus.OsmandApplication
 import net.osmand.plus.R
+import net.osmand.plus.card.width.WidthMode
 import net.osmand.plus.helpers.AndroidUiHelper
 import net.osmand.plus.myplaces.tracks.DialogClosedListener
 import net.osmand.plus.myplaces.tracks.dialogs.FilterAllVariantsListFragment
 import net.osmand.plus.myplaces.tracks.filters.viewholders.FilterVariantViewHolder
 import net.osmand.plus.myplaces.tracks.filters.viewholders.ShowAllViewHolder
+import net.osmand.plus.track.fragments.TrackAppearanceFragment
+import net.osmand.plus.utils.ColorUtilities
 import net.osmand.plus.utils.UiUtilities
 import net.osmand.search.core.SearchPhrase
+import net.osmand.shared.filters.ColorSingleFieldTrackFilterParams
+import net.osmand.shared.filters.FilterChangedListener
+import net.osmand.shared.filters.FolderSingleFieldTrackFilterParams
+import net.osmand.shared.filters.ListTrackFilter
+import net.osmand.shared.filters.SingleFieldTrackFilterParams
+import net.osmand.shared.filters.WidthSingleFieldTrackFilterParams
 import net.osmand.util.Algorithms
 import net.osmand.view.ThreeStateCheckbox
 
@@ -74,11 +85,14 @@ class ListFilterAdapter(
 					false)
 				val topBottomPadding =
 					app.resources.getDimensionPixelSize(R.dimen.content_padding_small)
-				val leftRightPadding = if(items.size > 0 && filter.collectionFilterParams.getItemIcon(app, items[0]) != null) {
-					app.resources.getDimensionPixelSize(R.dimen.content_padding_extra_large)
-				} else {
-					app.resources.getDimensionPixelSize(R.dimen.content_padding)
-				}
+				val leftRightPadding =
+					if (items.size > 0 && getFilterItemIcon(
+							filter.collectionFilterParams,
+							items[0]) != null) {
+						app.resources.getDimensionPixelSize(R.dimen.content_padding_extra_large)
+					} else {
+						app.resources.getDimensionPixelSize(R.dimen.content_padding)
+					}
 				view.setPadding(
 					leftRightPadding,
 					topBottomPadding,
@@ -89,6 +103,70 @@ class ListFilterAdapter(
 		}
 	}
 
+
+	private fun getFilterAllItemsIcon(
+		filterParams: SingleFieldTrackFilterParams, isChecked: Boolean,
+		nightMode: Boolean): Drawable? {
+		if (filterParams is FolderSingleFieldTrackFilterParams) {
+			return if (isChecked) {
+				app.uiUtilities.getActiveIcon(
+					R.drawable.ic_action_group_select_all,
+					nightMode)
+			} else {
+				app.uiUtilities.getPaintedIcon(
+					R.drawable.ic_action_group_select_all,
+					app.getColor(R.color.icon_color_default_light))
+			}
+		} else {
+			return null
+		}
+
+	}
+
+	private fun getFilterItemIcon(
+		filterParams: SingleFieldTrackFilterParams,
+		itemName: String): Drawable? {
+		if (filterParams is ColorSingleFieldTrackFilterParams) {
+			return if (Algorithms.isEmpty(itemName)) {
+				app.uiUtilities.getThemedIcon(R.drawable.ic_action_appearance_disabled)
+			} else {
+				val color = Color.parseColor(itemName)
+				val colorWithoutAlpha = ColorUtilities.removeAlpha(color)
+				val transparencyColor = ColorUtilities.getColorWithAlpha(colorWithoutAlpha, 0.8f)
+				val transparencyIcon =
+					app.uiUtilities.getPaintedIcon(R.drawable.ic_bg_transparency, transparencyColor)
+				val colorIcon = app.uiUtilities.getPaintedIcon(R.drawable.bg_point_circle, color)
+				UiUtilities.getLayeredIcon(transparencyIcon, colorIcon)
+			}
+		} else if (filterParams is FolderSingleFieldTrackFilterParams) {
+			return app.uiUtilities.getPaintedIcon(
+				R.drawable.ic_action_folder,
+				app.getColor(R.color.icon_color_default_light))
+		} else if (filterParams is WidthSingleFieldTrackFilterParams) {
+			return if (Algorithms.isEmpty(itemName)) {
+				app.uiUtilities.getThemedIcon(R.drawable.ic_action_appearance_disabled)
+			} else {
+				val iconColor = when (itemName) {
+					WidthMode.THIN.key,
+					WidthMode.MEDIUM.key,
+					WidthMode.BOLD.key -> R.color.track_filter_width_standard
+
+					else -> {
+						R.color.track_filter_width_custom
+					}
+				}
+				TrackAppearanceFragment.getTrackIcon(
+					app,
+					itemName,
+					false,
+					app.getColor(iconColor))
+			}
+
+		} else {
+			return null
+		}
+	}
+
 	override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) {
 		when (holder) {
 			is ShowAllViewHolder -> {
@@ -106,8 +184,8 @@ class ListFilterAdapter(
 
 			is FilterVariantViewHolder -> {
 				val itemName = getItem(position)
-				val icon = filter.collectionFilterParams.getItemIcon(app, itemName)
-				holder.title.text = filter.collectionFilterParams.getItemText(app, itemName)
+				val icon = getFilterItemIcon(filter.collectionFilterParams, itemName)
+				holder.title.text = filter.collectionFilterParams.getItemText(itemName)
 				holder.icon.setImageDrawable(icon)
 				AndroidUiHelper.updateVisibility(holder.icon, icon != null)
 				AndroidUiHelper.updateVisibility(holder.divider, position != itemCount - 1)
@@ -134,7 +212,8 @@ class ListFilterAdapter(
 				}
 				isSelectAllItemsBeingSet = false
 				holder.icon.setImageDrawable(
-					filter.collectionFilterParams.getAllItemsIcon(app,
+					getFilterAllItemsIcon(
+						filter.collectionFilterParams,
 						holder.switch.state != ThreeStateCheckbox.State.UNCHECKED,
 						nightMode))
 				holder.switch.setOnCheckedChangeListener { _, isChecked ->
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt
index 1c37779f403..8539e932de5 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/SmartFolderHelper.kt
@@ -4,13 +4,13 @@ import android.os.AsyncTask
 import androidx.annotation.WorkerThread
 import com.google.gson.Gson
 import com.google.gson.GsonBuilder
-import net.osmand.PlatformUtil
 import net.osmand.StateChangedListener
 import net.osmand.plus.OsmandApplication
 import net.osmand.plus.configmap.tracks.TrackItem
-import net.osmand.plus.myplaces.tracks.TrackFiltersHelper
+import net.osmand.shared.filters.TrackFiltersHelper
 import net.osmand.plus.settings.backend.preferences.CommonPreference
 import net.osmand.plus.track.data.SmartFolder
+import net.osmand.shared.filters.BaseTrackFilter
 import net.osmand.util.Algorithms
 import net.osmand.util.CollectionUtils
 import java.io.File
@@ -60,7 +60,7 @@ class SmartFolderHelper(val app: OsmandApplication) {
 						val newFilters: MutableList<BaseTrackFilter> = mutableListOf()
 						for (filter in it) {
 							val newFilter =
-								TrackFiltersHelper.createFilter(app, filter.trackFilterType, null)
+								TrackFiltersHelper.createFilter(filter.trackFilterType, null)
 							newFilter.initWithValue(filter)
 							newFilters.add(newFilter)
 						}
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/TrackFilterDeserializer.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/TrackFilterDeserializer.kt
index d64ea7f1676..3f161493086 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/TrackFilterDeserializer.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/TrackFilterDeserializer.kt
@@ -5,7 +5,9 @@ import com.google.gson.GsonBuilder
 import com.google.gson.JsonDeserializationContext
 import com.google.gson.JsonDeserializer
 import com.google.gson.JsonElement
-import net.osmand.plus.myplaces.tracks.TrackFiltersHelper
+import net.osmand.shared.filters.BaseTrackFilter
+import net.osmand.shared.filters.TrackFilterType
+import net.osmand.shared.filters.TrackFiltersHelper
 import java.lang.reflect.Type
 
 class TrackFilterDeserializer :
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/ListFilterViewHolder.kt b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/ListFilterViewHolder.kt
index c1d78cabe12..36a626b8a99 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/ListFilterViewHolder.kt
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/filters/viewholders/ListFilterViewHolder.kt
@@ -10,8 +10,8 @@ import net.osmand.plus.R
 import net.osmand.plus.helpers.AndroidUiHelper
 import net.osmand.plus.myplaces.tracks.DialogClosedListener
 import net.osmand.plus.myplaces.tracks.filters.ListFilterAdapter
-import net.osmand.plus.myplaces.tracks.filters.ListTrackFilter
 import net.osmand.plus.widgets.TextViewEx
+import net.osmand.shared.filters.ListTrackFilter
 
 class ListFilterViewHolder(var app: OsmandApplication, itemView: View, nightMode: Boolean) :
 	RecyclerView.ViewHolder(itemView) {
diff --git a/OsmAnd/src/net/osmand/plus/settings/controllers/RouteLineWidthController.java b/OsmAnd/src/net/osmand/plus/settings/controllers/RouteLineWidthController.java
index 1fcf01f901e..a86eda7bac4 100644
--- a/OsmAnd/src/net/osmand/plus/settings/controllers/RouteLineWidthController.java
+++ b/OsmAnd/src/net/osmand/plus/settings/controllers/RouteLineWidthController.java
@@ -21,9 +21,8 @@
 import net.osmand.plus.card.base.multistate.CardState;
 import net.osmand.plus.card.base.simple.DescriptionCard;
 import net.osmand.plus.card.base.slider.moded.ModedSliderCard;
-import net.osmand.plus.card.color.IControlsColorProvider;
 import net.osmand.plus.card.width.WidthComponentController;
-import net.osmand.plus.card.width.WidthMode;
+import net.osmand.shared.data.KWidthMode;
 import net.osmand.plus.routing.PreviewRouteLineInfo;
 import net.osmand.plus.track.fragments.TrackAppearanceFragment.OnNeedScrollListener;
 import net.osmand.plus.utils.UiUtilities;
@@ -156,7 +155,7 @@ private void setRouteLineWidth(String width) {
 	private WidthComponentController getWidthComponentController() {
 		if (widthComponentController == null) {
 			String selectedWidth = routeLinePreview.getWidth();
-			WidthMode widthMode = WidthMode.valueOfKey(selectedWidth);
+			KWidthMode widthMode = KWidthMode.valueOfKey(selectedWidth);
 			int customValue = parseIntSilently(selectedWidth, CUSTOM_WIDTH_MIN);
 			widthComponentController = new WidthComponentController(widthMode, customValue, this::onWidthValueSelected) {
 				@NonNull
@@ -180,7 +179,7 @@ protected CardState findCardState(@Nullable Object tag) {
 
 	@NonNull
 	private CardState findCardStateByWidthValue(@Nullable String width) {
-		return findCardState(width != null ? WidthMode.valueOfKey(width) : null);
+		return findCardState(width != null ? KWidthMode.valueOfKey(width) : null);
 	}
 
 	@Nullable
@@ -189,14 +188,14 @@ private String getWidthValue(@NonNull CardState cardState) {
 			WidthComponentController controller = getWidthComponentController();
 			return controller.getSelectedCustomValue();
 		}
-		if (cardState.getTag() instanceof WidthMode) {
-			return ((WidthMode) cardState.getTag()).getKey();
+		if (cardState.getTag() instanceof KWidthMode) {
+			return ((KWidthMode) cardState.getTag()).getKey();
 		}
 		return null;
 	}
 
 	private boolean isCustomValue(@NonNull CardState cardState) {
-		return cardState.getTag() == WidthMode.CUSTOM;
+		return cardState.getTag() == KWidthMode.CUSTOM;
 	}
 
 	public void onDestroy(@Nullable FragmentActivity activity) {
@@ -211,7 +210,7 @@ public void onDestroy(@Nullable FragmentActivity activity) {
 	protected List<CardState> collectSupportedCardStates() {
 		List<CardState> result = new ArrayList<>();
 		result.add(new CardState(R.string.map_widget_renderer));
-		for (WidthMode widthMode : WidthMode.values()) {
+		for (KWidthMode widthMode : KWidthMode.values()) {
 			result.add(new CardState(widthMode.getTitleId())
 					.setShowTopDivider(widthMode.ordinal() == 0)
 					.setTag(widthMode)
diff --git a/OsmAnd/src/net/osmand/plus/track/data/SmartFolder.kt b/OsmAnd/src/net/osmand/plus/track/data/SmartFolder.kt
index 54057eac361..496e8868947 100644
--- a/OsmAnd/src/net/osmand/plus/track/data/SmartFolder.kt
+++ b/OsmAnd/src/net/osmand/plus/track/data/SmartFolder.kt
@@ -3,8 +3,8 @@ package net.osmand.plus.track.data
 import android.content.Context
 import com.google.gson.annotations.Expose
 import net.osmand.plus.configmap.tracks.TrackItem
-import net.osmand.plus.myplaces.tracks.filters.BaseTrackFilter
 import net.osmand.plus.track.ComparableTracksGroup
+import net.osmand.shared.filters.BaseTrackFilter
 import net.osmand.util.CollectionUtils
 
 class SmartFolder(folderName: String) : TracksGroup, ComparableTracksGroup {
diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/controller/TrackWidthController.java b/OsmAnd/src/net/osmand/plus/track/fragments/controller/TrackWidthController.java
index 2692d16377b..f4c002ce2f4 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/controller/TrackWidthController.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/controller/TrackWidthController.java
@@ -19,9 +19,8 @@
 import net.osmand.plus.card.base.headed.IHeadedCardController;
 import net.osmand.plus.card.base.headed.IHeadedContentCard;
 import net.osmand.plus.card.base.slider.moded.ModedSliderCard;
-import net.osmand.plus.card.color.IControlsColorProvider;
 import net.osmand.plus.card.width.WidthComponentController;
-import net.osmand.plus.card.width.WidthMode;
+import net.osmand.shared.data.KWidthMode;
 import net.osmand.plus.track.TrackDrawInfo;
 import net.osmand.plus.track.fragments.TrackAppearanceFragment.OnNeedScrollListener;
 
@@ -131,7 +130,7 @@ private void setShowArrows(boolean showArrows) {
 	public WidthComponentController getWidthComponentController() {
 		if (widthComponentController == null) {
 			String selectedWidth = drawInfo.getWidth();
-			WidthMode widthMode = WidthMode.valueOfKey(selectedWidth);
+			KWidthMode widthMode = KWidthMode.valueOfKey(selectedWidth);
 			int customValue = parseIntSilently(selectedWidth, CUSTOM_WIDTH_MIN);
 			widthComponentController = new WidthComponentController(widthMode, customValue, this::onWidthValueSelected) {
 				@NonNull
diff --git a/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java b/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java
index bee89e30c1f..475b25534b9 100644
--- a/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java
+++ b/OsmAnd/src/net/osmand/plus/track/helpers/GpxDbHelper.java
@@ -182,16 +182,16 @@ public List<GpxDirItem> getDirItems() {
 	}
 
 	@NonNull
-	public List<Pair<String, Integer>> getStringIntItemsCollection(@NonNull String columnName,
+	public List<kotlin.Pair<String, Integer>> getStringIntItemsCollection(@NonNull String columnName,
 	                                                               boolean includeEmptyValues,
 	                                                               boolean sortByName,
 	                                                               boolean sortDescending) {
-		List<Pair<String, Integer>> res = new ArrayList<>();
+		List<kotlin.Pair<String, Integer>> res = new ArrayList<>();
 		for (StringIntPair item : database.getStringIntItemsCollection(columnName,
 				includeEmptyValues,
 				sortByName,
 				sortDescending)) {
-			res.add(new Pair<>(item.getString(), item.getInteger()));
+			res.add(new kotlin.Pair<>(item.getString(), item.getInteger()));
 		}
 		return res;
 	}
