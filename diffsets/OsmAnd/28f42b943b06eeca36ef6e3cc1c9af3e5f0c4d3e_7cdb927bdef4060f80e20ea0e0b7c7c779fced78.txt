diff --git a/OsmAnd/res/layout/fragment_gpx_approximation_bottom_sheet_dialog.xml b/OsmAnd/res/layout/fragment_gpx_approximation_bottom_sheet_dialog.xml
new file mode 100644
index 00000000000..3aff5d8aa55
--- /dev/null
+++ b/OsmAnd/res/layout/fragment_gpx_approximation_bottom_sheet_dialog.xml
@@ -0,0 +1,96 @@
+<?xml version="1.0" encoding="utf-8"?>
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:layout_width="match_parent"
+	android:layout_height="match_parent"
+	android:background="@color/color_transparent">
+
+	<LinearLayout
+		android:id="@+id/main_view"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:orientation="vertical">
+
+		<include layout="@layout/context_menu_top_shadow" />
+
+		<FrameLayout
+			android:id="@+id/bottom_container"
+			android:layout_width="match_parent"
+			android:layout_height="match_parent"
+			android:foreground="@drawable/bg_contextmenu_shadow"
+			android:foregroundGravity="top|fill_horizontal">
+
+			<net.osmand.plus.LockableScrollView
+				android:id="@+id/route_menu_bottom_scroll"
+				android:layout_width="match_parent"
+				android:layout_height="match_parent"
+				android:background="?attr/route_info_bg">
+
+				<LinearLayout
+					android:id="@+id/route_menu_cards_container"
+					android:layout_width="match_parent"
+					android:layout_height="wrap_content"
+					android:background="?attr/route_info_bg"
+					android:orientation="vertical"
+					android:paddingBottom="@dimen/dialog_button_ex_height">
+
+				</LinearLayout>
+
+			</net.osmand.plus.LockableScrollView>
+		</FrameLayout>
+
+	</LinearLayout>
+
+	<FrameLayout
+		android:id="@+id/map_controls_container"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:layout_gravity="bottom">
+
+		<include
+			layout="@layout/map_ruler"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_gravity="start|bottom"
+			android:layout_marginStart="@dimen/fab_margin_right"
+			android:layout_marginLeft="@dimen/fab_margin_right"
+			android:layout_marginEnd="@dimen/fab_margin_right"
+			android:layout_marginRight="@dimen/fab_margin_right"
+			tools:visibility="invisible" />
+
+		<include
+			layout="@layout/map_hud_controls"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_gravity="end|bottom"
+			android:layout_marginStart="@dimen/fab_margin_right"
+			android:layout_marginLeft="@dimen/fab_margin_right"
+			android:layout_marginEnd="@dimen/fab_margin_right"
+			android:layout_marginRight="@dimen/fab_margin_right"
+			tools:visibility="invisible" />
+
+	</FrameLayout>
+
+	<LinearLayout
+		android:id="@+id/control_buttons"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:layout_gravity="bottom"
+		android:orientation="vertical">
+
+		<androidx.appcompat.widget.AppCompatImageView
+			android:id="@+id/buttons_shadow"
+			android:layout_width="match_parent"
+			android:layout_height="10dp"
+			android:layout_gravity="bottom"
+			android:background="@drawable/bg_contextmenu_shadow_top_light" />
+
+		<include
+			layout="@layout/bottom_buttons"
+			android:layout_width="match_parent"
+			android:layout_height="@dimen/dialog_button_ex_height"
+			android:layout_gravity="bottom" />
+
+	</LinearLayout>
+
+</FrameLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/fragment_route_between_points_bottom_sheet_dialog.xml b/OsmAnd/res/layout/fragment_route_between_points_bottom_sheet_dialog.xml
new file mode 100644
index 00000000000..dff8a363aa8
--- /dev/null
+++ b/OsmAnd/res/layout/fragment_route_between_points_bottom_sheet_dialog.xml
@@ -0,0 +1,132 @@
+<?xml version="1.0" encoding="utf-8"?>
+<androidx.core.widget.NestedScrollView xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:osmand="http://schemas.android.com/apk/res-auto"
+	android:layout_width="match_parent"
+	android:layout_height="wrap_content">
+
+	<LinearLayout
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:background="?attr/bg_color"
+		android:orientation="vertical">
+
+		<LinearLayout
+			android:id="@+id/navigation_types_container"
+			android:layout_width="match_parent"
+			android:layout_height="wrap_content"
+			android:orientation="vertical"
+			android:paddingBottom="@dimen/bottom_sheet_content_padding_small">
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/choose_navigation_title"
+				android:layout_width="match_parent"
+				android:layout_height="@dimen/bottom_sheet_title_height"
+				android:gravity="center_vertical"
+				android:paddingEnd="@dimen/content_padding"
+				android:paddingLeft="@dimen/content_padding"
+				android:paddingRight="@dimen/content_padding"
+				android:paddingStart="@dimen/content_padding"
+				android:text="@string/route_between_points"
+				android:textAppearance="@style/TextAppearance.ListItemTitle"
+				osmand:typeface="@string/font_roboto_medium" />
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:layout_width="match_parent"
+				android:layout_height="wrap_content"
+				android:paddingEnd="@dimen/content_padding"
+				android:paddingLeft="@dimen/content_padding"
+				android:paddingRight="@dimen/content_padding"
+				android:paddingStart="@dimen/content_padding"
+				android:paddingBottom="@dimen/content_padding"
+				android:text="@string/rourte_between_points_desc"
+				android:textColor="?android:textColorPrimary"
+				android:lineSpacingMultiplier="@dimen/bottom_sheet_text_spacing_multiplier"
+				osmand:typeface="@string/font_roboto_regular"
+				android:letterSpacing="@dimen/description_letter_spacing"
+				android:textSize="@dimen/default_desc_text_size" />
+
+			<LinearLayout
+				android:layout_width="match_parent"
+				android:layout_height="@dimen/dialog_button_height"
+				android:layout_marginStart="@dimen/content_padding"
+				android:layout_marginEnd="@dimen/content_padding"
+				android:background="?attr/btn_bg_border_inactive"
+				android:baselineAligned="false"
+				android:orientation="horizontal">
+
+				<FrameLayout
+					android:id="@+id/next_segment_btn_container"
+					android:layout_width="0dp"
+					android:layout_height="match_parent"
+					android:layout_weight="1">
+
+					<net.osmand.plus.widgets.TextViewEx
+						android:id="@+id/next_segment_btn"
+						android:layout_width="match_parent"
+						android:layout_height="match_parent"
+						android:background="?attr/selectableItemBackground"
+						android:gravity="center"
+						android:text="@string/next_segment"
+						android:textSize="@dimen/default_desc_text_size"
+						osmand:typeface="@string/font_roboto_medium" />
+
+				</FrameLayout>
+
+				<FrameLayout
+					android:id="@+id/whole_track_btn_container"
+					android:layout_width="0dp"
+					android:layout_height="match_parent"
+					android:layout_weight="1">
+
+					<net.osmand.plus.widgets.TextViewEx
+						android:id="@+id/whole_track_btn"
+						android:layout_width="match_parent"
+						android:layout_height="match_parent"
+						android:background="?attr/selectableItemBackground"
+						android:gravity="center"
+						android:text="@string/whole_track"
+						android:textSize="@dimen/default_desc_text_size"
+						osmand:typeface="@string/font_roboto_medium" />
+
+				</FrameLayout>
+
+			</LinearLayout>
+
+			<net.osmand.plus.widgets.TextViewEx
+				android:id="@+id/button_description"
+				android:layout_width="match_parent"
+				android:layout_height="wrap_content"
+				android:paddingEnd="@dimen/content_padding"
+				android:paddingLeft="@dimen/content_padding"
+				android:paddingRight="@dimen/content_padding"
+				android:paddingStart="@dimen/content_padding"
+				android:paddingTop="@dimen/measurement_tool_content_padding_medium"
+				android:paddingBottom="@dimen/measurement_tool_content_padding_medium"
+				android:text="@string/rourte_between_points_next_segment_button_desc"
+				android:textColor="?android:textColorPrimary"
+				android:lineSpacingMultiplier="@dimen/bottom_sheet_text_spacing_multiplier"
+				osmand:typeface="@string/font_roboto_regular"
+				android:letterSpacing="@dimen/description_letter_spacing"
+				android:textSize="@dimen/default_desc_text_size" />
+		</LinearLayout>
+
+		<LinearLayout
+			android:id="@+id/buttons_container"
+			android:layout_width="match_parent"
+			android:layout_height="@dimen/dialog_button_ex_height"
+			android:gravity="center"
+			android:layout_gravity="bottom"
+			android:orientation="horizontal"
+			android:paddingLeft="@dimen/content_padding"
+			android:paddingRight="@dimen/content_padding"
+			android:paddingEnd="@dimen/content_padding"
+			android:paddingStart="@dimen/content_padding">
+
+			<include
+				android:id="@+id/dismiss_button"
+				layout="@layout/bottom_sheet_dialog_button" />
+		</LinearLayout>
+
+	</LinearLayout>
+
+</androidx.core.widget.NestedScrollView>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/navigation_profiles_card.xml b/OsmAnd/res/layout/navigation_profiles_card.xml
new file mode 100644
index 00000000000..caedf949035
--- /dev/null
+++ b/OsmAnd/res/layout/navigation_profiles_card.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:osmand="http://schemas.android.com/apk/res-auto"
+	android:layout_width="match_parent"
+	android:layout_height="match_parent"
+	android:orientation="vertical">
+
+	<net.osmand.plus.widgets.TextViewEx
+		android:id="@+id/navigation_profile"
+		android:layout_width="wrap_content"
+		android:layout_height="@dimen/measurement_tool_button_height"
+		android:gravity="start|center_vertical"
+		android:layout_marginLeft="@dimen/content_padding"
+		android:layout_marginRight="@dimen/content_padding"
+		osmand:typeface="@string/font_roboto_medium"
+		android:textColor="@color/active_color_primary_light"
+		android:textSize="@dimen/default_list_text_size"
+		android:text="@string/navigation_profile" />
+
+	<LinearLayout
+		android:id="@+id/content_container"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:layout_gravity="center_horizontal|bottom"
+		android:orientation="vertical" />
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/plan_route_threshold_slider.xml b/OsmAnd/res/layout/plan_route_threshold_slider.xml
new file mode 100644
index 00000000000..7debd5d1046
--- /dev/null
+++ b/OsmAnd/res/layout/plan_route_threshold_slider.xml
@@ -0,0 +1,48 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	xmlns:osmand="http://schemas.android.com/apk/res-auto"
+	xmlns:tools="http://schemas.android.com/tools"
+	android:orientation="vertical"
+	android:layout_width="match_parent"
+	android:layout_height="match_parent">
+
+	<FrameLayout
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:paddingTop="@dimen/content_padding_small"
+		android:paddingLeft="@dimen/content_padding"
+		android:paddingRight="@dimen/content_padding">
+
+		<net.osmand.plus.widgets.TextViewEx
+			android:id="@+id/title"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_gravity="start"
+			osmand:typeface="@string/font_roboto_regular"
+			android:textColor="?android:textColorPrimary"
+			android:textSize="@dimen/default_list_text_size"
+			android:text="@string/threshold_distance" />
+
+		<net.osmand.plus.widgets.TextViewEx
+			android:id="@+id/value"
+			android:layout_width="wrap_content"
+			android:layout_height="wrap_content"
+			android:layout_gravity="end"
+			osmand:typeface="@string/font_roboto_regular"
+			android:textColor="?android:textColorSecondary"
+			android:textSize="@dimen/default_list_text_size"
+			tools:text="5 m" />
+
+	</FrameLayout>
+
+	<com.google.android.material.slider.Slider
+		android:id="@+id/slider"
+		style="@style/Widget.Styled.Slider"
+		android:layout_marginLeft="@dimen/content_padding"
+		android:layout_marginRight="@dimen/content_padding"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content" />
+
+	<include layout="@layout/divider" />
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/values/sizes.xml b/OsmAnd/res/values/sizes.xml
index a9ab89109c2..463dd511b27 100644
--- a/OsmAnd/res/values/sizes.xml
+++ b/OsmAnd/res/values/sizes.xml
@@ -263,6 +263,7 @@
 	<dimen name="measurement_tool_button_padding">8dp</dimen>
 	<dimen name="measurement_tool_button_padding_top">10dp</dimen>
 	<dimen name="measurement_tool_button_height">36dp</dimen>
+	<dimen name="measurement_tool_options_divider_margin_start">72dp</dimen>
 	<dimen name="bottom_sheet_title_height">52dp</dimen>
 	<dimen name="bottom_sheet_descr_height">44dp</dimen>
 	<dimen name="bottom_sheet_list_item_height">48dp</dimen>
diff --git a/OsmAnd/res/values/strings.xml b/OsmAnd/res/values/strings.xml
index a31be91aa89..0c881d6586c 100644
--- a/OsmAnd/res/values/strings.xml
+++ b/OsmAnd/res/values/strings.xml
@@ -11,6 +11,17 @@
 	Thx - Hardy
 
 -->
+    <string name="rourte_between_points_add_track_desc">Select a track file for which a new segment will be added.</string>
+    <string name="navigation_profile">Navigation profile</string>
+    <string name="threshold_distance">Threshold distance</string>
+    <string name="rourte_between_points_warning_desc">To use this option OsmAnd need to snap your track to the map roads. \n\n On the next step you will need to select navigation profile to detect allowed roads and threshold distance to approximate you track with roads.</string>
+    <string name="next_segment">Next segment</string>
+    <string name="whole_track">Whole track</string>
+    <string name="rourte_between_points_desc">Select how to connect points, with a straight line, or calculate a route between them with selected profile.</string>
+    <string name="rourte_between_points_next_segment_button_desc">Only next segment will be recalculated using selected profile.</string>
+    <string name="rourte_between_points_whole_track_button_desc">Whole track will be recalculated using selected profile.</string>
+    <string name="reverse_route">Reverse route</string>
+    <string name="save_as_new_track">Save as new Track</string>
     <string name="overwrite_track">Overwrite track</string>
     <string name="shared_string_done">Done</string>
     <string name="plan_route_select_track_file_for_open">Select a track file for open.</string>
@@ -2162,7 +2173,7 @@
     <string name="traffic_warning_border_control">Border control</string>
     <string name="traffic_warning_payment">Toll booth</string>
     <string name="traffic_warning_stop">Stop sign</string>
-    <string name="traffic_warning_calming">Speed bump</string>
+    <string name="traffic_warning_calming">Traffic calming</string>
     <string name="traffic_warning_speed_camera">Speed camera</string>
     <string name="traffic_warning">Traffic warning</string>
     <string name="speak_favorites">Favorites nearby</string>
diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
index 50868c95a26..7450f211413 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java
@@ -117,9 +117,11 @@
 import net.osmand.plus.mapcontextmenu.other.TrackDetailsMenu;
 import net.osmand.plus.mapmarkers.MapMarkersDialogFragment;
 import net.osmand.plus.mapmarkers.PlanRouteFragment;
+import net.osmand.plus.measurementtool.GpxApproximationFragment;
 import net.osmand.plus.measurementtool.MeasurementEditingContext;
 import net.osmand.plus.measurementtool.MeasurementToolFragment;
 import net.osmand.plus.measurementtool.NewGpxData;
+import net.osmand.plus.measurementtool.SnapTrackWarningBottomSheet;
 import net.osmand.plus.quickaction.QuickActionListFragment;
 import net.osmand.plus.render.RendererRegistry;
 import net.osmand.plus.resources.ResourceManager;
@@ -688,6 +690,19 @@ public void onBackPressed() {
 			}
 			return;
 		}
+
+		SnapTrackWarningBottomSheet snapTrackWarningBottomSheet = getSnapTrackWarningBottomSheet();
+		if (snapTrackWarningBottomSheet != null) {
+			snapTrackWarningBottomSheet.dismiss();
+			return;
+		}
+
+		GpxApproximationFragment gpxApproximationFragment = getGpxApproximationFragment();
+		if (gpxApproximationFragment != null) {
+			gpxApproximationFragment.dismissImmediate();
+			return;
+		}
+
 		MeasurementToolFragment measurementToolFragment = getMeasurementToolFragment();
 		if (measurementToolFragment != null) {
 			measurementToolFragment.quit(true);
@@ -719,6 +734,7 @@ public void onBackPressed() {
 			}
 		}
 
+
 		if (mapContextMenu.isVisible() && mapContextMenu.isClosable()) {
 			if (mapContextMenu.getCurrentMenuState() != MenuState.HEADER_ONLY && !isLandscapeLayout()) {
 				mapContextMenu.openMenuHeaderOnly();
@@ -771,6 +787,7 @@ public void onBackPressed() {
 		super.onBackPressed();
 	}
 
+
 	private void quitAddGpxPointMode() {
 		getMapLayers().getContextMenuLayer().getAddGpxPointBottomSheetHelper().hide();
 		getMapLayers().getContextMenuLayer().quitAddGpxPoint();
@@ -2278,14 +2295,22 @@ public ImportCompleteFragment getImportCompleteFragment() {
 		return getFragment(ImportCompleteFragment.TAG);
 	}
 
-	public ConfigureMenuItemsFragment getConfigureMenuItemsFragment(){
+	public ConfigureMenuItemsFragment getConfigureMenuItemsFragment() {
 		return getFragment(ConfigureMenuItemsFragment.TAG);
 	}
 
-	public TrackAppearanceFragment getTrackAppearanceFragment(){
+	public TrackAppearanceFragment getTrackAppearanceFragment() {
 		return getFragment(TrackAppearanceFragment.TAG);
 	}
 
+	public GpxApproximationFragment getGpxApproximationFragment() {
+		return getFragment(GpxApproximationFragment.TAG);
+	}
+
+	private SnapTrackWarningBottomSheet getSnapTrackWarningBottomSheet() {
+		return getFragment(SnapTrackWarningBottomSheet.TAG);
+	}
+
 	public PointEditorFragmentNew getPointEditorFragmentNew() {
 		PointEditorFragmentNew pointEditorFragmentNew;
 		pointEditorFragmentNew = getFragment(FavoritePointEditor.TAG);
diff --git a/OsmAnd/src/net/osmand/plus/base/ContextMenuScrollFragment.java b/OsmAnd/src/net/osmand/plus/base/ContextMenuScrollFragment.java
index 6393c76cf5d..5884316361c 100644
--- a/OsmAnd/src/net/osmand/plus/base/ContextMenuScrollFragment.java
+++ b/OsmAnd/src/net/osmand/plus/base/ContextMenuScrollFragment.java
@@ -140,9 +140,13 @@ private int getMapControlsHeight() {
 		return mapControlsContainer != null ? mapControlsContainer.getHeight() : 0;
 	}
 
+	public int getMapControlsVisibleMenuState() {
+		return MenuState.HEADER_ONLY;
+	}
+
 	private void updateMapControlsVisibility(int menuState) {
 		if (mapBottomHudButtons != null) {
-			if (menuState == MenuState.HEADER_ONLY) {
+			if ((menuState & getMapControlsVisibleMenuState()) != 0) {
 				if (mapBottomHudButtons.getVisibility() != View.VISIBLE) {
 					mapBottomHudButtons.setVisibility(View.VISIBLE);
 				}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/GpxApproximationFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/GpxApproximationFragment.java
new file mode 100644
index 00000000000..176bb48b88f
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/GpxApproximationFragment.java
@@ -0,0 +1,247 @@
+package net.osmand.plus.measurementtool;
+
+import android.os.Bundle;
+import android.view.Gravity;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.FrameLayout;
+import android.widget.LinearLayout;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.FragmentActivity;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.AndroidUtils;
+import net.osmand.PlatformUtil;
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.UiUtilities;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.base.ContextMenuFragment;
+import net.osmand.plus.base.ContextMenuScrollFragment;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.mapcontextmenu.MenuController;
+import net.osmand.plus.settings.backend.ApplicationMode;
+
+import org.apache.commons.logging.Log;
+
+public class GpxApproximationFragment extends ContextMenuScrollFragment {
+
+	private static final Log LOG = PlatformUtil.getLog(GpxApproximationFragment.class);
+	public static final String TAG = GpxApproximationFragment.class.getSimpleName();
+
+	private GpxApproximationFragmentListener listener;
+	private int menuTitleHeight;
+	private ApplicationMode snapToRoadAppMode;
+	private int distanceThreshold;
+
+	public void setListener(GpxApproximationFragmentListener listener) {
+		this.listener = listener;
+	}
+
+
+	@Override
+	public int getMainLayoutId() {
+		return R.layout.fragment_gpx_approximation_bottom_sheet_dialog;
+	}
+
+	@Override
+	public int getHeaderViewHeight() {
+		return menuTitleHeight;
+	}
+
+	@Override
+	public boolean isHeaderViewDetached() {
+		return true;
+	}
+
+	@Override
+	public int getToolbarHeight() {
+		return 0;
+	}
+
+	public float getMiddleStateKoef() {
+		return 0.5f;
+	}
+
+	@Override
+	public int getSupportedMenuStatesPortrait() {
+		return MenuState.HALF_SCREEN | MenuState.FULL_SCREEN;
+	}
+
+	@Nullable
+	@Override
+	public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
+		View mainView = super.onCreateView(inflater, container, savedInstanceState);
+		if (mainView == null) {
+			return null;
+		}
+
+		if (isPortrait()) {
+			updateCardsLayout();
+		}
+		updateCards();
+		updateButtons(mainView);
+
+		if (!isPortrait()) {
+			int widthNoShadow = getLandscapeNoShadowWidth();
+			FrameLayout.LayoutParams params = new FrameLayout.LayoutParams(widthNoShadow, ViewGroup.LayoutParams.WRAP_CONTENT);
+			params.gravity = Gravity.BOTTOM | Gravity.START;
+			mainView.findViewById(R.id.control_buttons).setLayoutParams(params);
+		}
+		enterGpxApproximationMode();
+		runLayoutListener();
+
+		return mainView;
+	}
+
+	@Override
+	protected void calculateLayout(View view, boolean initLayout) {
+		menuTitleHeight = view.findViewById(R.id.control_buttons).getHeight()
+				- view.findViewById(R.id.buttons_shadow).getHeight();
+		super.calculateLayout(view, initLayout);
+	}
+
+	@Override
+	public void onDestroyView() {
+		if (listener != null) {
+			listener.onDestroyView();
+		}
+		super.onDestroyView();
+		exitGpxApproximationMode();
+	}
+
+	private void updateCardsLayout() {
+		View mainView = getMainView();
+		if (mainView != null) {
+			LinearLayout cardsContainer = getCardsContainer();
+			View topShadow = getTopShadow();
+			FrameLayout bottomContainer = getBottomContainer();
+			if (getCurrentMenuState() == MenuState.HEADER_ONLY) {
+				topShadow.setVisibility(View.INVISIBLE);
+				bottomContainer.setBackgroundDrawable(null);
+				AndroidUtils.setBackground(mainView.getContext(), cardsContainer, isNightMode(),
+						R.drawable.travel_card_bg_light, R.drawable.travel_card_bg_dark);
+			} else {
+				topShadow.setVisibility(View.VISIBLE);
+				AndroidUtils.setBackground(mainView.getContext(), bottomContainer, isNightMode(),
+						R.color.card_and_list_background_light, R.color.card_and_list_background_dark);
+				AndroidUtils.setBackground(mainView.getContext(), cardsContainer, isNightMode(),
+						R.color.card_and_list_background_light, R.color.card_and_list_background_dark);
+			}
+		}
+	}
+
+	private void updateButtons(View view) {
+		View buttonsContainer = view.findViewById(R.id.buttons_container);
+		buttonsContainer.setBackgroundColor(AndroidUtils.getColorFromAttr(view.getContext(), R.attr.route_info_bg));
+		View saveButton = view.findViewById(R.id.right_bottom_button);
+		saveButton.setOnClickListener(new View.OnClickListener() {
+			@Override
+			public void onClick(View v) {
+//				saveTrackInfo();
+				dismiss();
+			}
+		});
+
+		View cancelButton = view.findViewById(R.id.dismiss_button);
+		cancelButton.setOnClickListener(new View.OnClickListener() {
+			@Override
+			public void onClick(View v) {
+//				discardSplitChanges();
+				FragmentActivity activity = getActivity();
+				if (activity != null) {
+					activity.onBackPressed();
+				}
+			}
+		});
+
+		UiUtilities.setupDialogButton(isNightMode(), cancelButton, UiUtilities.DialogButtonType.SECONDARY, R.string.shared_string_cancel);
+		UiUtilities.setupDialogButton(isNightMode(), saveButton, UiUtilities.DialogButtonType.PRIMARY, R.string.shared_string_apply);
+
+		AndroidUiHelper.updateVisibility(saveButton, true);
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.buttons_divider), true);
+	}
+
+	private void updateCards() {
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity != null) {
+			ViewGroup cardsContainer = getCardsContainer();
+			cardsContainer.removeAllViews();
+
+			SliderCard sliderCard = new SliderCard(mapActivity);
+			cardsContainer.addView(sliderCard.build(mapActivity));
+
+			ProfileCard profileCard = new ProfileCard(mapActivity);
+			cardsContainer.addView(profileCard.build(mapActivity));
+		}
+	}
+
+	private void enterGpxApproximationMode() {
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity != null) {
+			boolean portrait = AndroidUiHelper.isOrientationPortrait(mapActivity);
+			AndroidUiHelper.setVisibility(mapActivity, portrait ? View.INVISIBLE : View.GONE,
+					R.id.map_left_widgets_panel,
+					R.id.map_right_widgets_panel,
+					R.id.map_center_info);
+		}
+	}
+
+	private void exitGpxApproximationMode() {
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity != null) {
+			AndroidUiHelper.setVisibility(mapActivity, View.VISIBLE,
+					R.id.map_left_widgets_panel,
+					R.id.map_right_widgets_panel,
+					R.id.map_center_info,
+					R.id.map_search_button);
+		}
+	}
+
+	@Override
+	public int getMapControlsVisibleMenuState() {
+		return MenuState.HEADER_ONLY | MenuState.HALF_SCREEN;
+	}
+
+	//	public static void showInstance(FragmentManager fm, RouteBetweenPointsFragmentListener listener,
+//	                                CalculationType calculationType, ApplicationMode applicationMode) {
+	public static void showInstance(FragmentManager fm) {
+		try {
+			if (!fm.isStateSaved()) {
+				GpxApproximationFragment fragment = new GpxApproximationFragment();
+//				fragment.setListener(listener);
+				fragment.setRetainInstance(true);
+				Bundle args = new Bundle();
+				args.putInt(ContextMenuFragment.MENU_STATE_KEY, MenuController.MenuState.HALF_SCREEN);
+				fragment.setArguments(args);
+				fm.beginTransaction()
+						.replace(R.id.fragmentContainer, fragment, TAG)
+						.addToBackStack(TAG)
+						.commitAllowingStateLoss();
+			}
+		} catch (RuntimeException e) {
+			LOG.error("showInstance", e);
+		}
+	}
+
+	public void dismissImmediate() {
+		MapActivity mapActivity = getMapActivity();
+		if (mapActivity != null) {
+			try {
+				mapActivity.getSupportFragmentManager().popBackStackImmediate(TAG, FragmentManager.POP_BACK_STACK_INCLUSIVE);
+			} catch (Exception e) {
+				LOG.error(e);
+			}
+		}
+	}
+
+	public interface GpxApproximationFragmentListener {
+
+		void onDestroyView();
+
+		void applyButtonOnClick(ApplicationMode mode, int distanceThreshold);
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementEditingContext.java b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementEditingContext.java
index f602fc4a2cb..073144826c3 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementEditingContext.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementEditingContext.java
@@ -27,8 +27,15 @@
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.ConcurrentLinkedQueue;
 
+import static net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType.*;
+
 public class MeasurementEditingContext {
 
+	public enum CalculationType {
+		NEXT_SEGMENT,
+		WHOLE_TRACK
+	}
+
 	private OsmandApplication application;
 	private final MeasurementCommandManager commandManager = new MeasurementCommandManager();
 
@@ -46,6 +53,7 @@ public class MeasurementEditingContext {
 	private boolean inSnapToRoadMode;
 	private boolean needUpdateCacheForSnap;
 	private int calculatedPairs;
+	private CalculationType calculationType = WHOLE_TRACK;
 
 	private SnapToRoadProgressListener progressListener;
 	private ApplicationMode snapToRoadAppMode;
@@ -110,6 +118,14 @@ public void setNewGpxData(NewGpxData newGpxData) {
 		this.newGpxData = newGpxData;
 	}
 
+	public CalculationType getCalculationType() {
+		return calculationType;
+	}
+
+	public void setCalculationType(CalculationType calculationType) {
+		this.calculationType = calculationType;
+	}
+
 	void setProgressListener(SnapToRoadProgressListener progressListener) {
 		this.progressListener = progressListener;
 	}
@@ -306,7 +322,7 @@ private int findPointIndex(WptPt point, List<WptPt> points, int firstIndex) {
 	}
 
 	boolean isSnapToRoadTrack() {
-		return !getNewGpxData().getTrkSegment().points.isEmpty()
+		return getNewGpxData() != null && !getNewGpxData().getTrkSegment().points.isEmpty()
 				&& !getNewGpxData().getGpxFile().getRoutePoints().isEmpty();
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
index ffd26ec83d6..5e5c50320ea 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
@@ -40,7 +40,6 @@
 import com.google.android.material.snackbar.Snackbar;
 
 import net.osmand.AndroidUtils;
-import net.osmand.CallbackWithObject;
 import net.osmand.FileUtils;
 import net.osmand.GPXUtilities;
 import net.osmand.GPXUtilities.GPXFile;
@@ -61,12 +60,11 @@
 import net.osmand.plus.activities.TrackActivity;
 import net.osmand.plus.base.BaseOsmAndFragment;
 import net.osmand.plus.helpers.AndroidUiHelper;
-import net.osmand.plus.helpers.GpxUiHelper;
 import net.osmand.plus.measurementtool.NewGpxData.ActionType;
 import net.osmand.plus.measurementtool.OptionsBottomSheetDialogFragment.OptionsFragmentListener;
+import net.osmand.plus.measurementtool.RouteBetweenPointsBottomSheetDialogFragment.RouteBetweenPointsFragmentListener;
 import net.osmand.plus.measurementtool.SaveAsNewTrackBottomSheetDialogFragment.SaveAsNewTrackFragmentListener;
 import net.osmand.plus.measurementtool.SelectedPointBottomSheetDialogFragment.SelectedPointFragmentListener;
-import net.osmand.plus.measurementtool.SnapToRoadBottomSheetDialogFragment.SnapToRoadFragmentListener;
 import net.osmand.plus.measurementtool.adapter.MeasurementToolAdapter;
 import net.osmand.plus.measurementtool.adapter.MeasurementToolAdapter.MeasurementAdapterListener;
 import net.osmand.plus.measurementtool.command.AddPointCommand;
@@ -78,7 +76,6 @@
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.views.MapControlsLayer;
 import net.osmand.plus.views.controls.ReorderItemTouchHelperCallback;
-import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory;
 import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory.TopToolbarController;
 import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory.TopToolbarControllerType;
 import net.osmand.plus.views.mapwidgets.MapInfoWidgetsFactory.TopToolbarView;
@@ -92,13 +89,15 @@
 import java.util.Locale;
 
 import static net.osmand.IndexConstants.GPX_FILE_EXT;
+import static net.osmand.plus.measurementtool.MeasurementEditingContext.*;
+import static net.osmand.plus.measurementtool.SelectFileBottomSheet.Mode.*;
 import static net.osmand.plus.measurementtool.SelectFileBottomSheet.SelectFileListener;
+import static net.osmand.plus.measurementtool.SnapTrackWarningBottomSheet.*;
 import static net.osmand.plus.measurementtool.StartPlanRouteBottomSheet.StartPlanRouteListener;
 
-
 public class MeasurementToolFragment extends BaseOsmAndFragment {
 
-	public static final String TAG = "MeasurementToolFragment";
+	public static final String TAG = MeasurementToolFragment.class.getSimpleName();
 
 	private RecyclerView pointsRv;
 	private String previousToolBarTitle = "";
@@ -123,6 +122,7 @@ public class MeasurementToolFragment extends BaseOsmAndFragment {
 	private boolean progressBarVisible;
 	private boolean pointsListOpened;
 	private boolean planRouteMode = false;
+	private boolean firstShow = true;
 	private Boolean saved;
 	private boolean portrait;
 	private boolean nightMode;
@@ -157,7 +157,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c
 		final MeasurementToolLayer measurementLayer = mapActivity.getMapLayers().getMeasurementToolLayer();
 
 		editingCtx.setApplication(mapActivity.getMyApplication());
-		editingCtx.setProgressListener(new MeasurementEditingContext.SnapToRoadProgressListener() {
+		editingCtx.setProgressListener(new SnapToRoadProgressListener() {
 			@Override
 			public void showProgressBar() {
 				MeasurementToolFragment.this.showProgressBar();
@@ -177,7 +177,7 @@ public void hideProgressBar() {
 			@Override
 			public void refresh() {
 				measurementLayer.refreshMap();
-				updateText();
+				updateDistancePointsText();
 			}
 		});
 
@@ -190,14 +190,6 @@ public void refresh() {
 			SelectedPointBottomSheetDialogFragment fragment = (SelectedPointBottomSheetDialogFragment) selectedPointFragment;
 			fragment.setListener(createSelectedPointFragmentListener());
 		}
-		Fragment optionsFragment = fragmentManager.findFragmentByTag(OptionsBottomSheetDialogFragment.TAG);
-		if (optionsFragment != null) {
-			((OptionsBottomSheetDialogFragment) optionsFragment).setListener(createOptionsFragmentListener());
-		}
-		Fragment snapToRoadFragment = fragmentManager.findFragmentByTag(SnapToRoadBottomSheetDialogFragment.TAG);
-		if (snapToRoadFragment != null) {
-			((SnapToRoadBottomSheetDialogFragment) snapToRoadFragment).setListener(createSnapToRoadFragmentListener());
-		}
 		Fragment saveAsNewTrackFragment = mapActivity.getSupportFragmentManager().findFragmentByTag(SaveAsNewTrackBottomSheetDialogFragment.TAG);
 		if (saveAsNewTrackFragment != null) {
 			((SaveAsNewTrackBottomSheetDialogFragment) saveAsNewTrackFragment).setListener(createSaveAsNewTrackFragmentListener());
@@ -307,14 +299,9 @@ public void onClick(View view) {
 		mainView.findViewById(R.id.options_button).setOnClickListener(new View.OnClickListener() {
 			@Override
 			public void onClick(View view) {
-				Bundle args = new Bundle();
-				args.putBoolean(OptionsBottomSheetDialogFragment.SNAP_TO_ROAD_ENABLED_KEY, editingCtx.isInSnapToRoadMode());
-				args.putBoolean(OptionsBottomSheetDialogFragment.ADD_LINE_MODE_KEY, newGpxData != null);
-				OptionsBottomSheetDialogFragment fragment = new OptionsBottomSheetDialogFragment();
-				fragment.setArguments(args);
-				fragment.setUsedOnMap(true);
-				fragment.setListener(createOptionsFragmentListener());
-				fragment.show(mapActivity.getSupportFragmentManager(), OptionsBottomSheetDialogFragment.TAG);
+				OptionsBottomSheetDialogFragment.showInstance(mapActivity.getSupportFragmentManager(), true,
+						editingCtx.isInSnapToRoadMode(), createOptionsFragmentListener(),
+						editingCtx.getSnapToRoadAppMode());
 			}
 		});
 
@@ -334,7 +321,7 @@ public void onClick(View view) {
 				}
 				adapter.notifyDataSetChanged();
 				updateUndoRedoButton(true, redoBtn);
-				updateText();
+				updateDistancePointsText();
 			}
 		});
 
@@ -351,7 +338,7 @@ public void onClick(View view) {
 				}
 				adapter.notifyDataSetChanged();
 				updateUndoRedoButton(true, undoBtn);
-				updateText();
+				updateDistancePointsText();
 			}
 		});
 
@@ -488,9 +475,10 @@ public void onCheckedChanged(CompoundButton compoundButton, boolean checked) {
 
 		initMeasurementMode(newGpxData);
 
-		if (planRouteMode) {
+		if (planRouteMode && firstShow) {
 			StartPlanRouteBottomSheet.showInstance(mapActivity.getSupportFragmentManager(),
 					createStartPlanRouteListener());
+			firstShow = false;
 		}
 		return view;
 	}
@@ -590,7 +578,7 @@ private void showProgressBar() {
 		progressBarVisible = true;
 	}
 
-	private void showSnapToRoadMenu(boolean rememberPreviousTitle) {
+	private void showRouteBetweenPointsMenu(boolean rememberPreviousTitle) {
 		MapActivity mapActivity = getMapActivity();
 		if (mapActivity != null) {
 			if (rememberPreviousTitle) {
@@ -598,13 +586,38 @@ private void showSnapToRoadMenu(boolean rememberPreviousTitle) {
 			}
 			toolBarController.setTitle(getString(R.string.route_between_points));
 			mapActivity.refreshMap();
-			SnapToRoadBottomSheetDialogFragment fragment = new SnapToRoadBottomSheetDialogFragment();
-			fragment.setListener(createSnapToRoadFragmentListener());
-			fragment.setShowStraightLine(true);
-			fragment.show(mapActivity.getSupportFragmentManager(), SnapToRoadBottomSheetDialogFragment.TAG);
+			if(editingCtx.isSnapToRoadTrack()) {
+				RouteBetweenPointsBottomSheetDialogFragment.showInstance(mapActivity.getSupportFragmentManager(),
+						createRouteBetweenPointsFragmentListener(), editingCtx.getCalculationType(),
+						editingCtx.getSnapToRoadAppMode());
+			} else {
+				toolBarController.setSaveViewVisible(false);
+				updateToolbar();
+				SnapTrackWarningBottomSheet.showInstance(mapActivity.getSupportFragmentManager(),
+						createSnapTrackWarningListener());
+			}
 		}
 	}
 
+	private SnapTrackWarningListener createSnapTrackWarningListener() {
+		return new SnapTrackWarningListener() {
+			@Override
+			public void continueButtonOnClick() {
+				MapActivity mapActivity = getMapActivity();
+				if (mapActivity != null) {
+
+					GpxApproximationFragment.showInstance(mapActivity.getSupportFragmentManager());
+				}
+			}
+
+			@Override
+			public void dismissButtonOnClick() {
+				toolBarController.setSaveViewVisible(true);
+				updateToolbar();
+			}
+		};
+	}
+
 	private OptionsFragmentListener createOptionsFragmentListener() {
 		return new OptionsFragmentListener() {
 
@@ -613,18 +626,16 @@ private OptionsFragmentListener createOptionsFragmentListener() {
 
 			@Override
 			public void snapToRoadOnCLick() {
-				if (!editingCtx.isInSnapToRoadMode()) {
-					showSnapToRoadMenu(true);
-				} else {
-					disableSnapToRoadMode();
-				}
+				showRouteBetweenPointsMenu(true);
 			}
 
 			@Override
-			public void directions() {
-				MapControlsLayer mapControlsLayer = mapActivity.getMapLayers().getMapControlsLayer();
-				if (mapControlsLayer != null) {
-					mapControlsLayer.doRoute(false);
+			public void directionsOnClick() {
+				if (mapActivity != null) {
+					MapControlsLayer mapControlsLayer = mapActivity.getMapLayers().getMapControlsLayer();
+					if (mapControlsLayer != null) {
+						mapControlsLayer.doRoute(false);
+					}
 				}
 			}
 
@@ -667,17 +678,6 @@ public void addToTheTrackOnClick() {
 				}
 			}
 
-			@Override
-			public void overwriteOldTrackOnClick() {
-				if (mapActivity != null && measurementLayer != null) {
-					if (editingCtx.getPointsCount() > 0) {
-						overwriteGpx(mapActivity);
-					} else {
-						Toast.makeText(mapActivity, getString(R.string.none_point_error), Toast.LENGTH_SHORT).show();
-					}
-				}
-			}
-
 			@Override
 			public void clearAllOnClick() {
 				editingCtx.getCommandManager().execute(new ClearPointsCommand(measurementLayer));
@@ -687,9 +687,14 @@ public void clearAllOnClick() {
 				}
 				updateUndoRedoButton(false, redoBtn);
 				disable(upDownBtn);
-				updateText();
+				updateDistancePointsText();
 				saved = false;
 			}
+
+			@Override
+			public void reverseRouteOnClick() {
+
+			}
 		};
 	}
 
@@ -750,8 +755,8 @@ public void onClearSelection() {
 		};
 	}
 
-	private SnapToRoadFragmentListener createSnapToRoadFragmentListener() {
-		return new SnapToRoadFragmentListener() {
+	private RouteBetweenPointsFragmentListener createRouteBetweenPointsFragmentListener() {
+		return new RouteBetweenPointsFragmentListener() {
 			@Override
 			public void onDestroyView(boolean snapToRoadEnabled) {
 				if (!snapToRoadEnabled && !editingCtx.isInSnapToRoadMode()) {
@@ -773,6 +778,11 @@ public void onApplicationModeItemClick(ApplicationMode mode) {
 					enableSnapToRoadMode(mode);
 				}
 			}
+
+			@Override
+			public void onCalculationTypeChanges(CalculationType calculationType) {
+				editingCtx.setCalculationType(calculationType);
+			}
 		};
 	}
 
@@ -783,7 +793,7 @@ public void openExistingTrackOnClick() {
 				MapActivity mapActivity = getMapActivity();
 				if (mapActivity != null) {
 					SelectFileBottomSheet.showInstance(mapActivity.getSupportFragmentManager(),
-							createSelectFileListener());
+							createSelectFileListener(), OPEN_TRACK);
 				}
 			}
 
@@ -817,6 +827,24 @@ public void dismissButtonOnClick() {
 		};
 	}
 
+	private SelectFileListener createAddToTrackFileListener() {
+		final MapActivity mapActivity = getMapActivity();
+		return new SelectFileListener() {
+			@Override
+			public void selectFileOnCLick(GPXFile gpxFile) {
+				if (mapActivity != null) {
+					SelectedGpxFile selectedGpxFile = mapActivity.getMyApplication().getSelectedGpxHelper().getSelectedFileByPath(gpxFile.path);
+					boolean showOnMap = selectedGpxFile != null;
+					saveExistingGpx(gpxFile, showOnMap, ActionType.ADD_SEGMENT, false);
+				}
+			}
+
+			@Override
+			public void dismissButtonOnClick() {
+			}
+		};
+	}
+
 	public void addNewGpxData(GPXFile gpxFile) {
 		QuadRect rect = gpxFile.getRect();
 		TrkSegment segment = getTrkSegment(gpxFile);
@@ -847,7 +875,7 @@ private void removePoint(MeasurementToolLayer layer, int position) {
 		adapter.notifyDataSetChanged();
 		updateUndoRedoButton(true, undoBtn);
 		updateUndoRedoButton(false, redoBtn);
-		updateText();
+		updateDistancePointsText();
 		saved = false;
 		hidePointsListIfNoPoints();
 	}
@@ -909,7 +937,7 @@ public void onDragEnded(RecyclerView.ViewHolder holder) {
 						editingCtx.getCommandManager().execute(new ReorderPointCommand(measurementLayer, fromPosition, toPosition));
 						adapter.notifyDataSetChanged();
 						updateUndoRedoButton(false, redoBtn);
-						updateText();
+						updateDistancePointsText();
 						mapActivity.refreshMap();
 						saved = false;
 					}
@@ -941,7 +969,7 @@ private void showSnapToRoadControls() {
 			snapToRoadBtn.setOnClickListener(new View.OnClickListener() {
 				@Override
 				public void onClick(View view) {
-					showSnapToRoadMenu(false);
+					showRouteBetweenPointsMenu(false);
 				}
 			});
 			snapToRoadBtn.setVisibility(View.VISIBLE);
@@ -982,7 +1010,7 @@ private void displayRoutePoints() {
 		if (measurementLayer != null) {
 			editingCtx.addPoints(points);
 			adapter.notifyDataSetChanged();
-			updateText();
+			updateDistancePointsText();
 		}
 	}
 
@@ -991,7 +1019,7 @@ private void displaySegmentPoints() {
 		if (measurementLayer != null) {
 			editingCtx.addPoints();
 			adapter.notifyDataSetChanged();
-			updateText();
+			updateDistancePointsText();
 		}
 	}
 
@@ -1009,7 +1037,31 @@ private void openSaveAsNewTrackMenu(MapActivity mapActivity) {
 		fragment.show(mapActivity.getSupportFragmentManager(), SaveAsNewTrackBottomSheetDialogFragment.TAG);
 	}
 
-	private AlertDialog showAddToTrackDialog(final MapActivity mapActivity) {
+//	private AlertDialog showAddToTrackDialog(final MapActivity mapActivity) {
+//
+//		CallbackWithObject<GPXFile[]> callbackWithObject = new CallbackWithObject<GPXFile[]>() {
+//			@Override
+//			public boolean processResult(GPXFile[] result) {
+//				GPXFile gpxFile;
+//				if (result != null && result.length > 0) {
+//					gpxFile = result[0];
+//					SelectedGpxFile selectedGpxFile = mapActivity.getMyApplication().getSelectedGpxHelper().getSelectedFileByPath(gpxFile.path);
+//					boolean showOnMap = selectedGpxFile != null;
+//					saveExistingGpx(gpxFile, showOnMap, ActionType.ADD_SEGMENT, false);
+//				}
+//				return true;
+//			}
+//		};
+//
+//		return GpxUiHelper.selectGPXFile(mapActivity, false, false, callbackWithObject, nightMode);
+//	}
+
+	private void showAddToTrackDialog(final MapActivity mapActivity) {
+		if (mapActivity != null) {
+			SelectFileBottomSheet.showInstance(mapActivity.getSupportFragmentManager(),
+					createAddToTrackFileListener(),ADD_TO_TRACK);
+		}
+		/*
 		CallbackWithObject<GPXFile[]> callbackWithObject = new CallbackWithObject<GPXFile[]>() {
 			@Override
 			public boolean processResult(GPXFile[] result) {
@@ -1024,7 +1076,7 @@ public boolean processResult(GPXFile[] result) {
 			}
 		};
 
-		return GpxUiHelper.selectGPXFile(mapActivity, false, false, callbackWithObject, nightMode);
+		return GpxUiHelper.selectGPXFile(mapActivity, false, false, callbackWithObject, nightMode);*/
 	}
 
 	private void applyMovePointMode() {
@@ -1098,7 +1150,7 @@ private void applyAddPointBeforeAfterMode() {
 		if (measurementLayer != null) {
 			measurementLayer.refreshMap();
 		}
-		updateText();
+		updateDistancePointsText();
 	}
 
 	private void cancelAddPointBeforeOrAfterMode() {
@@ -1197,7 +1249,7 @@ private void doAddOrMovePointCommonStuff() {
 		enable(upDownBtn);
 		updateUndoRedoButton(true, undoBtn);
 		updateUndoRedoButton(false, redoBtn);
-		updateText();
+		updateDistancePointsText();
 		adapter.notifyDataSetChanged();
 		saved = false;
 	}
@@ -1293,14 +1345,6 @@ private void addToGpx(MapActivity mapActivity) {
 		saveExistingGpx(gpx, showOnMap, actionType, true);
 	}
 
-	private void overwriteGpx(MapActivity mapActivity) {
-		GPXFile gpx = editingCtx.getNewGpxData().getGpxFile();
-		SelectedGpxFile selectedGpxFile = mapActivity.getMyApplication().getSelectedGpxHelper().getSelectedFileByPath(gpx.path);
-		boolean showOnMap = selectedGpxFile != null;
-		ActionType actionType = ActionType.OVERWRITE_SEGMENT;
-		saveExistingGpx(gpx, showOnMap, actionType, true);
-	}
-
 	private void saveAsGpx(final SaveType saveType) {
 		MapActivity mapActivity = getMapActivity();
 		if (mapActivity != null) {
@@ -1453,7 +1497,7 @@ protected Exception doInBackground(Void... voids) {
 							gpx.tracks.add(track);
 						} else if (saveType == SaveType.ROUTE_POINT) {
 							if (editingCtx.isInSnapToRoadMode()) {
-								editingCtx.exportRouteAsGpx(trackName, new MeasurementEditingContext.ExportAsGpxListener() {
+								editingCtx.exportRouteAsGpx(trackName, new ExportAsGpxListener() {
 									@Override
 									public void onExportAsGpxFinished(GPXFile gpx) {
 										gpx.addRoutePoints(editingCtx.getPoints());
@@ -1605,7 +1649,7 @@ private void disable(View view) {
 		view.setAlpha(.5f);
 	}
 
-	private void updateText() {
+	private void updateDistancePointsText() {
 		MeasurementToolLayer measurementLayer = getMeasurementLayer();
 		if (measurementLayer != null) {
 			distanceTv.setText(measurementLayer.getDistanceSt() + ",");
@@ -1657,8 +1701,7 @@ private void enterMeasurementMode() {
 			} else {
 				wasCollapseButtonVisible = false;
 			}
-
-			updateText();
+			updateDistancePointsText();
 		}
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/OptionsBottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/OptionsBottomSheetDialogFragment.java
index 264e958d50f..658c33047c1 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/OptionsBottomSheetDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/OptionsBottomSheetDialogFragment.java
@@ -1,44 +1,67 @@
 package net.osmand.plus.measurementtool;
 
+import android.graphics.drawable.Drawable;
 import android.os.Bundle;
 import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ImageView;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.PlatformUtil;
 import net.osmand.plus.R;
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithDescription;
 import net.osmand.plus.base.bottomsheetmenu.SimpleBottomSheetItem;
-import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerHalfItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
+import net.osmand.plus.settings.backend.ApplicationMode;
+
+import org.apache.commons.logging.Log;
 
 public class OptionsBottomSheetDialogFragment extends MenuBottomSheetDialogFragment {
 
-	public static final String TAG = "OptionsBottomSheetDialogFragment";
+	public static final String TAG = OptionsBottomSheetDialogFragment.class.getSimpleName();
+	private static final Log LOG = PlatformUtil.getLog(OptionsBottomSheetDialogFragment.class);
 
 	public static final String SNAP_TO_ROAD_ENABLED_KEY = "snap_to_road_enabled";
-	public static final String ADD_LINE_MODE_KEY = "add_line_mode";
 
 	private OptionsFragmentListener listener;
+	private ApplicationMode routeAppMode;
 
 	public void setListener(OptionsFragmentListener listener) {
 		this.listener = listener;
 	}
 
+	private void setRouteAppMode(ApplicationMode routeAppMode) {
+		this.routeAppMode = routeAppMode;
+	}
+
 	@Override
 	public void createMenuItems(Bundle savedInstanceState) {
 		Bundle args = getArguments();
 		boolean snapToRoadEnabled = false;
-		boolean addLineMode = false;
 		if (args != null) {
 			snapToRoadEnabled = args.getBoolean(SNAP_TO_ROAD_ENABLED_KEY);
-			addLineMode = args.getBoolean(ADD_LINE_MODE_KEY);
 		}
 
 		items.add(new TitleItem(getString(R.string.shared_string_options)));
 
+		String description;
+		Drawable icon;
+		if (!snapToRoadEnabled || routeAppMode == null) {
+			description = getString(R.string.routing_profile_straightline);
+			icon = getContentIcon(R.drawable.ic_action_split_interval);
+		} else {
+			description = routeAppMode.toHumanString();
+			icon = getIcon(routeAppMode.getIconRes(), routeAppMode.getIconColorInfo().getColor(nightMode));
+		}
+
 		BaseBottomSheetItem snapToRoadItem = new BottomSheetItemWithDescription.Builder()
-				.setDescription(getString(R.string.routing_profile_straightline))
-				.setIcon(getContentIcon(R.drawable.ic_action_split_interval))
+				.setDescription(description)
+				.setIcon(icon)
 				.setTitle(getString(R.string.route_between_points))
 				.setLayoutId(R.layout.bottom_sheet_item_with_descr_56dp)
 				.setOnClickListener(new View.OnClickListener() {
@@ -51,19 +74,56 @@ public void onClick(View v) {
 					}
 				})
 				.create();
+
 		items.add(snapToRoadItem);
 
-		items.add(new DividerHalfItem(getContext()));
+		items.add(new OptionsDividerItem(getContext()));
+
+		BaseBottomSheetItem saveAsNewSegmentItem = new SimpleBottomSheetItem.Builder()
+				.setIcon(getContentIcon(R.drawable.ic_action_save_to_file))
+				.setTitle(getString(R.string.shared_string_save_changes))
+				.setLayoutId(R.layout.bottom_sheet_item_simple_pad_32dp)
+				.setOnClickListener(new View.OnClickListener() {
+					@Override
+					public void onClick(View v) {
+						if (listener != null) {
+							listener.addToGpxOnClick();
+						}
+						dismiss();
+					}
+				})
+				.create();
+		items.add(saveAsNewSegmentItem);
+
+		items.add(getSaveAsNewTrackItem());
+
+		BaseBottomSheetItem addToTrackItem = new SimpleBottomSheetItem.Builder()
+				.setIcon(getContentIcon(R.drawable.ic_action_split_interval))
+				.setTitle(getString(R.string.add_to_a_track))
+				.setLayoutId(R.layout.bottom_sheet_item_simple_pad_32dp)
+				.setOnClickListener(new View.OnClickListener() {
+					@Override
+					public void onClick(View v) {
+						if (listener != null) {
+							listener.addToTheTrackOnClick();
+						}
+						dismiss();
+					}
+				})
+				.create();
+		items.add(addToTrackItem);
+
+		items.add(new OptionsDividerItem(getContext()));
 
 		BaseBottomSheetItem directions = new SimpleBottomSheetItem.Builder()
 				.setIcon(getContentIcon(R.drawable.ic_action_gdirections_dark))
 				.setTitle(getString(R.string.get_directions))
-				.setLayoutId(R.layout.bottom_sheet_item_simple)
+				.setLayoutId(R.layout.bottom_sheet_item_simple_pad_32dp)
 				.setOnClickListener(new View.OnClickListener() {
 					@Override
 					public void onClick(View v) {
 						if (listener != null) {
-							listener.directions();
+							listener.directionsOnClick();
 						}
 						dismiss();
 					}
@@ -71,69 +131,29 @@ public void onClick(View v) {
 				.create();
 		items.add(directions);
 
-		items.add(new DividerHalfItem(getContext()));
-
-		if (addLineMode && !snapToRoadEnabled) {
-			BaseBottomSheetItem saveAsNewSegmentItem = new SimpleBottomSheetItem.Builder()
-					.setIcon(getContentIcon(R.drawable.ic_action_polygom_dark))
-					.setTitle(getString(R.string.shared_string_save))
-					.setLayoutId(R.layout.bottom_sheet_item_simple)
-					.setOnClickListener(new View.OnClickListener() {
-						@Override
-						public void onClick(View v) {
-							if (listener != null) {
-								listener.addToGpxOnClick();
-							}
-							dismiss();
-						}
-					})
-					.create();
-			items.add(saveAsNewSegmentItem);
-		} else if (addLineMode) {
-
-			items.add(getSaveAsNewTrackItem());
-
-			BaseBottomSheetItem saveAsNewSegmentItem = new SimpleBottomSheetItem.Builder()
-					.setIcon(getContentIcon(R.drawable.ic_action_polygom_dark))
-					.setTitle(getString(R.string.overwrite_track))
-					.setLayoutId(R.layout.bottom_sheet_item_simple)
-					.setOnClickListener(new View.OnClickListener() {
-						@Override
-						public void onClick(View v) {
-							if (listener != null) {
-								listener.overwriteOldTrackOnClick();
-							}
-							dismiss();
-						}
-					})
-					.create();
-			items.add(saveAsNewSegmentItem);
-		} else {
-			items.add(getSaveAsNewTrackItem());
-
-			BaseBottomSheetItem addToTrackItem = new SimpleBottomSheetItem.Builder()
-					.setIcon(getContentIcon(R.drawable.ic_action_split_interval))
-					.setTitle(getString(R.string.add_to_a_track))
-					.setLayoutId(R.layout.bottom_sheet_item_simple)
-					.setOnClickListener(new View.OnClickListener() {
-						@Override
-						public void onClick(View v) {
-							if (listener != null) {
-								listener.addToTheTrackOnClick();
-							}
-							dismiss();
+		BaseBottomSheetItem reverseRoute = new SimpleBottomSheetItem.Builder()
+				.setIcon(getContentIcon(R.drawable.ic_action_change_navigation_points))
+				.setTitle(getString(R.string.reverse_route))
+				.setLayoutId(R.layout.bottom_sheet_item_simple_pad_32dp)
+				.setOnClickListener(new View.OnClickListener() {
+					@Override
+					public void onClick(View v) {
+						if (listener != null) {
+							listener.reverseRouteOnClick();
 						}
-					})
-					.create();
-			items.add(addToTrackItem);
-		}
+						dismiss();
+					}
+				})
+				.create();
+		items.add(reverseRoute);
 
-		items.add(new DividerHalfItem(getContext()));
+		items.add(new OptionsDividerItem(getContext()));
 
 		BaseBottomSheetItem clearAllItem = new SimpleBottomSheetItem.Builder()
-				.setIcon(getContentIcon(R.drawable.ic_action_reset_to_default_dark))
+				.setIcon(getIcon(R.drawable.ic_action_reset_to_default_dark, (
+						nightMode ? R.color.color_osm_edit_delete : R.color.color_osm_edit_delete)))
 				.setTitle(getString(R.string.shared_string_clear_all))
-				.setLayoutId(R.layout.bottom_sheet_item_simple)
+				.setLayoutId(R.layout.bottom_sheet_item_simple_pad_32dp)
 				.setOnClickListener(new View.OnClickListener() {
 					@Override
 					public void onClick(View v) {
@@ -150,8 +170,8 @@ public void onClick(View v) {
 	private BaseBottomSheetItem getSaveAsNewTrackItem() {
 		return new SimpleBottomSheetItem.Builder()
 				.setIcon(getContentIcon(R.drawable.ic_action_save_to_file))
-				.setTitle(getString(R.string.edit_filter_save_as_menu_item))
-				.setLayoutId(R.layout.bottom_sheet_item_simple)
+				.setTitle(getString(R.string.save_as_new_track))
+				.setLayoutId(R.layout.bottom_sheet_item_simple_pad_32dp)
 				.setOnClickListener(new View.OnClickListener() {
 					@Override
 					public void onClick(View v) {
@@ -164,6 +184,34 @@ public void onClick(View v) {
 				.create();
 	}
 
+	@Override
+	public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
+		super.onViewCreated(view, savedInstanceState);
+		ImageView icon = view.findViewById(R.id.icon);
+		ViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) icon.getLayoutParams();
+		params.rightMargin = view.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_icon_margin_large);
+	}
+
+	public static void showInstance(@NonNull FragmentManager fm, boolean hasRoutePoint, boolean snapToRoad,
+	                                OptionsFragmentListener optionsFragmentListener,
+	                                ApplicationMode routeAppMode) {
+		try {
+			if (!fm.isStateSaved()) {
+				Bundle args = new Bundle();
+				args.putBoolean(OptionsBottomSheetDialogFragment.SNAP_TO_ROAD_ENABLED_KEY, snapToRoad);
+				OptionsBottomSheetDialogFragment fragment = new OptionsBottomSheetDialogFragment();
+				fragment.setArguments(args);
+				fragment.setRouteAppMode(routeAppMode);
+				fragment.setUsedOnMap(hasRoutePoint);
+				fragment.setUsedOnMap(true);
+				fragment.setListener(optionsFragmentListener);
+				fragment.show(fm, TAG);
+			}
+		} catch (RuntimeException e) {
+			LOG.error("showInstance", e);
+		}
+	}
+
 	@Override
 	protected int getDismissButtonTextId() {
 		return R.string.shared_string_close;
@@ -173,15 +221,15 @@ interface OptionsFragmentListener {
 
 		void snapToRoadOnCLick();
 
-		void directions();
-
 		void addToGpxOnClick();
 
 		void saveAsNewTrackOnClick();
 
 		void addToTheTrackOnClick();
 
-		void overwriteOldTrackOnClick();
+		void directionsOnClick();
+
+		void reverseRouteOnClick();
 
 		void clearAllOnClick();
 	}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/OptionsDividerItem.java b/OsmAnd/src/net/osmand/plus/measurementtool/OptionsDividerItem.java
new file mode 100644
index 00000000000..6778bf76c84
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/OptionsDividerItem.java
@@ -0,0 +1,23 @@
+package net.osmand.plus.measurementtool;
+
+import android.content.Context;
+
+import net.osmand.plus.R;
+import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerItem;
+
+public class OptionsDividerItem extends DividerItem {
+
+	public OptionsDividerItem(Context context) {
+		super(context);
+	}
+
+	@Override
+	protected int getBottomMargin(Context context) {
+		return context.getResources().getDimensionPixelSize(R.dimen.bottom_sheet_divider_margin_top);
+	}
+
+	@Override
+	protected int getStartMargin(Context context) {
+		return context.getResources().getDimensionPixelSize(R.dimen.measurement_tool_options_divider_margin_start);
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/ProfileCard.java b/OsmAnd/src/net/osmand/plus/measurementtool/ProfileCard.java
new file mode 100644
index 00000000000..9dd78c0f0e1
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/ProfileCard.java
@@ -0,0 +1,87 @@
+package net.osmand.plus.measurementtool;
+
+import android.graphics.drawable.Drawable;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ImageView;
+import android.widget.LinearLayout;
+import android.widget.RadioButton;
+import android.widget.TextView;
+
+import net.osmand.plus.R;
+import net.osmand.plus.UiUtilities;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
+
+import java.util.ArrayList;
+import java.util.List;
+
+public class ProfileCard extends BaseCard {
+
+	public static final int INIT_MODE = 0;
+	ApplicationMode selectedMode;
+
+	public ProfileCard(MapActivity mapActivity) {
+		super(mapActivity);
+	}
+
+	public ApplicationMode getSelectedMode() {
+		return selectedMode;
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.navigation_profiles_card;
+	}
+
+	@Override
+	protected void updateContent() {
+
+		final List<ApplicationMode> modes = new ArrayList<>(ApplicationMode.values(app));
+		modes.remove(ApplicationMode.DEFAULT);
+		for (int i = 0; i < modes.size(); i++) {
+			ApplicationMode mode = modes.get(i);
+			LinearLayout container = view.findViewById(R.id.content_container);
+			Drawable icon = app.getUIUtilities().getIcon(mode.getIconRes(), mode.getIconColorInfo().getColor(nightMode));
+			String title = mode.toHumanString();
+			View.OnClickListener onClickListener = new View.OnClickListener() {
+				@Override
+				public void onClick(View v) {
+					RadioButton selectedProfile = v.findViewById(R.id.compound_button);
+					selectedMode = modes.get((Integer) v.getTag());
+					clearChecked();
+					selectedProfile.setChecked(true);
+				}
+
+				private void clearChecked() {
+					for (int i = 0; i < modes.size(); i++) {
+						RadioButton profile = view.findViewWithTag(i).findViewById(R.id.compound_button);
+						profile.setChecked(false);
+					}
+				}
+			};
+			addProfileView(container, onClickListener, i, icon, title);
+		}
+		initSelected(modes);
+	}
+
+	private void initSelected(List<ApplicationMode> modes) {
+		selectedMode = modes.get(INIT_MODE);
+		((RadioButton) view.findViewWithTag(INIT_MODE).findViewById(R.id.compound_button)).setChecked(true);
+	}
+
+	private void addProfileView(LinearLayout container, View.OnClickListener onClickListener, Object tag,
+	                            Drawable icon, CharSequence title) {
+		View row = UiUtilities.getInflater(mapActivity, nightMode)
+				.inflate(R.layout.bottom_sheet_item_with_radio_btn, container, false);
+		ImageView imageView = row.findViewById(R.id.icon);
+		imageView.setImageDrawable(icon);
+		ViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) imageView.getLayoutParams();
+		params.rightMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_icon_margin_large);
+		((TextView) row.findViewById(R.id.title)).setText(title);
+		row.setOnClickListener(onClickListener);
+		row.setTag(tag);
+		container.addView(row);
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/RouteBetweenPointsBottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/RouteBetweenPointsBottomSheetDialogFragment.java
new file mode 100644
index 00000000000..3c30b7dc0e4
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/RouteBetweenPointsBottomSheetDialogFragment.java
@@ -0,0 +1,253 @@
+package net.osmand.plus.measurementtool;
+
+import android.app.Dialog;
+import android.graphics.Color;
+import android.graphics.drawable.Drawable;
+import android.graphics.drawable.GradientDrawable;
+import android.os.Bundle;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.view.Window;
+import android.view.WindowManager;
+import android.widget.FrameLayout;
+import android.widget.ImageView;
+import android.widget.LinearLayout;
+import android.widget.RadioButton;
+import android.widget.TextView;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.core.content.ContextCompat;
+import androidx.fragment.app.FragmentActivity;
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.AndroidUtils;
+import net.osmand.PlatformUtil;
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.UiUtilities;
+import net.osmand.plus.base.BottomSheetDialogFragment;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType;
+import net.osmand.plus.settings.backend.ApplicationMode;
+
+import org.apache.commons.logging.Log;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import static net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType.NEXT_SEGMENT;
+import static net.osmand.plus.measurementtool.MeasurementEditingContext.CalculationType.WHOLE_TRACK;
+
+public class RouteBetweenPointsBottomSheetDialogFragment extends BottomSheetDialogFragment {
+
+	private static final Log LOG = PlatformUtil.getLog(RouteBetweenPointsBottomSheetDialogFragment.class);
+	public static final String TAG = RouteBetweenPointsBottomSheetDialogFragment.class.getSimpleName();
+	public static final int STRAIGHT_LINE_TAG = -1;
+
+	private RouteBetweenPointsFragmentListener listener;
+	private boolean nightMode;
+	private boolean portrait;
+	private boolean snapToRoadEnabled;
+	private TextView segmentBtn;
+	private TextView wholeTrackBtn;
+	private TextView btnDescription;
+	private FrameLayout segmentBtnContainer;
+	private FrameLayout wholeTrackBtnContainer;
+	private CalculationType calculationType = WHOLE_TRACK;
+	private ApplicationMode snapToRoadAppMode;
+
+	public void setListener(RouteBetweenPointsFragmentListener listener) {
+		this.listener = listener;
+	}
+
+	@Nullable
+	@Override
+	public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
+		OsmandApplication app = requiredMyApplication();
+		nightMode = app.getDaynightHelper().isNightModeForMapControls();
+		FragmentActivity activity = requireActivity();
+		portrait = AndroidUiHelper.isOrientationPortrait(activity);
+		final View mainView = inflater.inflate(R.layout.fragment_route_between_points_bottom_sheet_dialog,
+				container, false);
+		AndroidUtils.setBackground(activity, mainView, nightMode,
+				portrait ? R.drawable.bg_bottom_menu_light : R.drawable.bg_bottom_sheet_topsides_landscape_light,
+				portrait ? R.drawable.bg_bottom_menu_dark : R.drawable.bg_bottom_sheet_topsides_landscape_dark);
+
+		View cancelButton = mainView.findViewById(R.id.dismiss_button);
+		UiUtilities.setupDialogButton(nightMode, cancelButton, UiUtilities.DialogButtonType.SECONDARY,
+				R.string.shared_string_close);
+		mainView.findViewById(R.id.dismiss_button).setOnClickListener(new View.OnClickListener() {
+			@Override
+			public void onClick(View view) {
+				dismiss();
+			}
+		});
+		segmentBtnContainer = mainView.findViewById(R.id.next_segment_btn_container);
+		segmentBtn = mainView.findViewById(R.id.next_segment_btn);
+		wholeTrackBtnContainer = mainView.findViewById(R.id.whole_track_btn_container);
+		wholeTrackBtn = mainView.findViewById(R.id.whole_track_btn);
+		btnDescription = mainView.findViewById(R.id.button_description);
+
+		LinearLayout navigationType = (LinearLayout) mainView.findViewById(R.id.navigation_types_container);
+		final List<ApplicationMode> modes = new ArrayList<>(ApplicationMode.values(app));
+		modes.remove(ApplicationMode.DEFAULT);
+
+		View.OnClickListener onClickListener = new View.OnClickListener() {
+			@Override
+			public void onClick(View view) {
+				snapToRoadEnabled = false;
+				if (listener != null) {
+					ApplicationMode mode = null;
+					if ((int) view.getTag() != STRAIGHT_LINE_TAG) {
+						mode = modes.get((int) view.getTag());
+						snapToRoadEnabled = true;
+					}
+					listener.onApplicationModeItemClick(mode);
+				}
+				dismiss();
+			}
+		};
+
+		Drawable icon = app.getUIUtilities().getIcon(R.drawable.ic_action_split_interval, nightMode);
+		addProfileView(navigationType, onClickListener, STRAIGHT_LINE_TAG, icon,
+				app.getText(R.string.routing_profile_straightline), snapToRoadAppMode == null);
+		addDelimiterView(navigationType);
+
+		for (int i = 0; i < modes.size(); i++) {
+			ApplicationMode mode = modes.get(i);
+			icon = app.getUIUtilities().getIcon(mode.getIconRes(), mode.getIconColorInfo().getColor(nightMode));
+			addProfileView(navigationType, onClickListener, i, icon, mode.toHumanString(), mode.equals(snapToRoadAppMode));
+		}
+
+		segmentBtn.setOnClickListener(new View.OnClickListener() {
+			@Override
+			public void onClick(View v) {
+				updateModeButtons(NEXT_SEGMENT);
+			}
+		});
+		wholeTrackBtn.setOnClickListener(new View.OnClickListener() {
+			@Override
+			public void onClick(View v) {
+				updateModeButtons(WHOLE_TRACK);
+			}
+		});
+		updateModeButtons(calculationType);
+		return mainView;
+	}
+
+	private void addDelimiterView(LinearLayout container) {
+		View row = UiUtilities.getInflater(getContext(), nightMode).inflate(R.layout.divider, container, false);
+		View divider = row.findViewById(R.id.divider);
+		ViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) divider.getLayoutParams();
+		params.topMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_title_padding_bottom);
+		params.bottomMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_title_padding_bottom);
+		container.addView(row);
+	}
+
+	private void updateModeButtons(CalculationType calculationType) {
+		OsmandApplication app = requiredMyApplication();
+		int activeColor = ContextCompat.getColor(app, nightMode
+				? R.color.active_color_primary_dark
+				: R.color.active_color_primary_light);
+		int textColor = ContextCompat.getColor(app, nightMode
+				? R.color.text_color_primary_dark
+				: R.color.text_color_primary_light);
+		int radius = AndroidUtils.dpToPx(app, 4);
+
+		GradientDrawable background = new GradientDrawable();
+		background.setColor(UiUtilities.getColorWithAlpha(activeColor, 0.1f));
+		background.setStroke(AndroidUtils.dpToPx(app, 1), UiUtilities.getColorWithAlpha(activeColor, 0.5f));
+
+		if (calculationType == NEXT_SEGMENT) {
+			background.setCornerRadii(new float[]{radius, radius, 0, 0, 0, 0, radius, radius});
+			wholeTrackBtnContainer.setBackgroundColor(Color.TRANSPARENT);
+			wholeTrackBtn.setTextColor(activeColor);
+			segmentBtnContainer.setBackgroundDrawable(background);
+			segmentBtn.setTextColor(textColor);
+			btnDescription.setText(R.string.rourte_between_points_next_segment_button_desc);
+		} else {
+			background.setCornerRadii(new float[]{0, 0, radius, radius, radius, radius, 0, 0});
+			wholeTrackBtnContainer.setBackgroundDrawable(background);
+			wholeTrackBtn.setTextColor(textColor);
+			segmentBtnContainer.setBackgroundColor(Color.TRANSPARENT);
+			segmentBtn.setTextColor(activeColor);
+			btnDescription.setText(R.string.rourte_between_points_whole_track_button_desc);
+		}
+		setCalculationType(calculationType);
+		if (listener != null) {
+			listener.onCalculationTypeChanges(calculationType);
+		}
+	}
+
+	private void addProfileView(LinearLayout container, View.OnClickListener onClickListener, Object tag,
+	                            Drawable icon, CharSequence title, boolean check) {
+		View row = UiUtilities.getInflater(getContext(), nightMode)
+				.inflate(R.layout.bottom_sheet_item_with_radio_btn, container, false);
+		((RadioButton) row.findViewById(R.id.compound_button)).setChecked(check);
+		ImageView imageView = row.findViewById(R.id.icon);
+		imageView.setImageDrawable(icon);
+		ViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) imageView.getLayoutParams();
+		params.rightMargin = container.getContext().getResources().getDimensionPixelSize(R.dimen.bottom_sheet_icon_margin_large);
+		((TextView) row.findViewById(R.id.title)).setText(title);
+		row.setOnClickListener(onClickListener);
+		row.setTag(tag);
+		container.addView(row);
+	}
+
+	@Override
+	public void onStart() {
+		super.onStart();
+		if (!portrait) {
+			Dialog dialog = getDialog();
+			if (dialog != null && dialog.getWindow() != null) {
+				Window window = dialog.getWindow();
+				WindowManager.LayoutParams params = window.getAttributes();
+				params.width = dialog.getContext().getResources().getDimensionPixelSize(R.dimen.landscape_bottom_sheet_dialog_fragment_width);
+				window.setAttributes(params);
+			}
+		}
+	}
+
+	@Override
+	public void onDestroyView() {
+		if (listener != null) {
+			listener.onDestroyView(snapToRoadEnabled);
+		}
+		super.onDestroyView();
+	}
+
+
+	public void setRouteMode(ApplicationMode snapToRoadAppMode) {
+		this.snapToRoadAppMode = snapToRoadAppMode;
+	}
+
+	public void setCalculationType(CalculationType calculationType) {
+		this.calculationType = calculationType;
+	}
+
+	public static void showInstance(FragmentManager fm, RouteBetweenPointsFragmentListener listener,
+	                                CalculationType calculationType, ApplicationMode applicationMode) {
+		try {
+			if (!fm.isStateSaved()) {
+				RouteBetweenPointsBottomSheetDialogFragment fragment = new RouteBetweenPointsBottomSheetDialogFragment();
+				fragment.setListener(listener);
+				fragment.setCalculationType(calculationType);
+				fragment.setRouteMode(applicationMode);
+				fragment.show(fm, TAG);
+			}
+		} catch (RuntimeException e) {
+			LOG.error("showInstance", e);
+		}
+	}
+
+	public interface RouteBetweenPointsFragmentListener {
+
+		void onDestroyView(boolean snapToRoadEnabled);
+
+		void onApplicationModeItemClick(ApplicationMode mode);
+
+		void onCalculationTypeChanges(CalculationType calculationType);
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/SelectFileBottomSheet.java b/OsmAnd/src/net/osmand/plus/measurementtool/SelectFileBottomSheet.java
index 4e1a46c1629..d9757247617 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/SelectFileBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/SelectFileBottomSheet.java
@@ -3,7 +3,9 @@
 import android.content.Context;
 import android.os.Bundle;
 import android.view.View;
+import android.widget.TextView;
 
+import androidx.annotation.StringRes;
 import androidx.appcompat.view.ContextThemeWrapper;
 import androidx.fragment.app.FragmentManager;
 import androidx.recyclerview.widget.LinearLayoutManager;
@@ -22,7 +24,6 @@
 import net.osmand.plus.helpers.GpxUiHelper.GPXInfo;
 import net.osmand.plus.mapcontextmenu.other.HorizontalSelectionAdapter;
 import net.osmand.plus.mapcontextmenu.other.HorizontalSelectionAdapter.HorizontalSelectionAdapterListener;
-import net.osmand.util.Algorithms;
 
 import java.io.File;
 import java.util.ArrayList;
@@ -35,6 +36,27 @@
 
 public class SelectFileBottomSheet extends MenuBottomSheetDialogFragment {
 
+	enum Mode {
+		OPEN_TRACK(R.string.plan_route_open_existing_track, R.string.plan_route_select_track_file_for_open),
+		ADD_TO_TRACK(R.string.add_to_a_track, R.string.rourte_between_points_add_track_desc);
+
+		int title;
+		int description;
+
+		Mode(@StringRes int title, @StringRes int description) {
+			this.title = title;
+			this.description = description;
+		}
+
+		public int getTitle() {
+			return title;
+		}
+
+		public int getDescription() {
+			return description;
+		}
+	}
+
 	public static final String TAG = SelectFileBottomSheet.class.getSimpleName();
 	public static final int BOTTOM_SHEET_HEIGHT_DP = 427;
 
@@ -42,6 +64,11 @@ public class SelectFileBottomSheet extends MenuBottomSheetDialogFragment {
 	protected GpxTrackAdapter adapter;
 	private SelectFileListener listener;
 	private Map<String, List<GPXInfo>> gpxInfoMap;
+	private Mode fragmentMode;
+
+	public void setFragmentMode(Mode fragmentMode) {
+		this.fragmentMode = fragmentMode;
+	}
 
 	public void setListener(SelectFileListener listener) {
 		this.listener = listener;
@@ -54,6 +81,10 @@ public void createMenuItems(Bundle savedInstanceState) {
 		OsmandApplication app = requiredMyApplication();
 		mainView = View.inflate(new ContextThemeWrapper(context, themeRes),
 				R.layout.bottom_sheet_plan_route_select_file, null);
+		TextView titleView = mainView.findViewById(R.id.title);
+		titleView.setText(fragmentMode.title);
+		TextView descriptionView = mainView.findViewById(R.id.description);
+		descriptionView.setText(fragmentMode.description);
 		final RecyclerView filesRecyclerView = mainView.findViewById(R.id.gpx_track_list);
 		filesRecyclerView.setLayoutManager(new LinearLayoutManager(context));
 
@@ -139,13 +170,14 @@ protected int getCustomHeight() {
 		return AndroidUtils.dpToPx(mainView.getContext(), BOTTOM_SHEET_HEIGHT_DP);
 	}
 
-	public static void showInstance(FragmentManager fragmentManager, SelectFileListener listener) {
+	public static void showInstance(FragmentManager fragmentManager, SelectFileListener listener, Mode mode) {
 		if (!fragmentManager.isStateSaved()) {
 			SelectFileBottomSheet fragment = new SelectFileBottomSheet();
 			fragment.setUsedOnMap(true);
 			fragment.setRetainInstance(true);
 			fragment.setListener(listener);
-			fragment.show(fragmentManager, SelectFileBottomSheet.TAG);
+			fragment.setFragmentMode(mode);
+			fragment.show(fragmentManager, TAG);
 		}
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/SliderCard.java b/OsmAnd/src/net/osmand/plus/measurementtool/SliderCard.java
new file mode 100644
index 00000000000..fa0dd4d7faf
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/SliderCard.java
@@ -0,0 +1,56 @@
+package net.osmand.plus.measurementtool;
+
+import android.widget.TextView;
+
+import androidx.annotation.NonNull;
+import androidx.core.content.ContextCompat;
+
+import com.google.android.material.slider.Slider;
+
+import net.osmand.plus.R;
+import net.osmand.plus.UiUtilities;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+
+public class SliderCard extends BaseCard {
+
+	public static final int DEFAULT_VALUE = 30;
+
+	public SliderCard(MapActivity mapActivity) {
+		super(mapActivity);
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.plan_route_threshold_slider;
+	}
+
+	@Override
+	protected void updateContent() {
+		final TextView thresholdDistanceValue = view.findViewById(R.id.value);
+		thresholdDistanceValue.setText(getStringValueWithMetric(DEFAULT_VALUE));
+		TextView thresholdDistance = view.findViewById(R.id.title);
+		thresholdDistance.setText(R.string.threshold_distance);
+		Slider slider = view.findViewById(R.id.slider);
+		slider.setValueFrom(0);
+		slider.setValue(DEFAULT_VALUE);
+		slider.setValueTo(100);
+		slider.setStepSize(5);
+		UiUtilities.setupSlider(slider, nightMode, ContextCompat.getColor(view.getContext(),
+				R.color.profile_icon_color_blue_light));
+		slider.addOnChangeListener(new Slider.OnChangeListener() {
+			@Override
+			public void onValueChange(@NonNull Slider slider, float value, boolean fromUser) {
+				if (fromUser) {
+					String valueStr = getStringValueWithMetric((int) value);
+					thresholdDistanceValue.setText(valueStr);
+				}
+			}
+		});
+	}
+
+	private String getStringValueWithMetric(int value) {
+		return String.format(view.getContext().getString(R.string.ltr_or_rtl_combine_via_space),
+				String.valueOf(value), view.getContext().getString(R.string.m));
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/SnapTrackWarningBottomSheet.java b/OsmAnd/src/net/osmand/plus/measurementtool/SnapTrackWarningBottomSheet.java
new file mode 100644
index 00000000000..048e5bbe4a3
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/SnapTrackWarningBottomSheet.java
@@ -0,0 +1,106 @@
+package net.osmand.plus.measurementtool;
+
+import android.app.Activity;
+import android.os.Bundle;
+import android.view.View;
+
+import androidx.fragment.app.FragmentManager;
+
+import net.osmand.PlatformUtil;
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.R;
+import net.osmand.plus.activities.MapActivity;
+import net.osmand.plus.base.MenuBottomSheetDialogFragment;
+import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
+import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithDescription;
+import net.osmand.plus.base.bottomsheetmenu.simpleitems.DividerSpaceItem;
+import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
+import net.osmand.plus.helpers.GpxTrackAdapter;
+
+import org.apache.commons.logging.Log;
+
+public class SnapTrackWarningBottomSheet extends MenuBottomSheetDialogFragment {
+
+	public static final String TAG = SnapTrackWarningBottomSheet.class.getSimpleName();
+	private static final Log LOG = PlatformUtil.getLog(SnapTrackWarningBottomSheet.class);
+
+	protected View mainView;
+	protected GpxTrackAdapter adapter;
+	private SnapTrackWarningListener listener;
+
+	public void setListener(SnapTrackWarningListener listener) {
+		this.listener = listener;
+	}
+
+	@Override
+	public void createMenuItems(Bundle savedInstanceState) {
+		Activity activity = getActivity();
+		if (activity instanceof MapActivity) {
+			activity.findViewById(R.id.snap_to_road_image_button).setVisibility(View.GONE);
+		}
+		OsmandApplication app = requiredMyApplication();
+		items.add(new TitleItem(getString(R.string.route_between_points)));
+		BaseBottomSheetItem description = new BottomSheetItemWithDescription.Builder()
+				.setDescription(app.getString(R.string.rourte_between_points_warning_desc))
+				.setDescriptionColorId(R.color.text_color_primary_light)
+				.setLayoutId(R.layout.bottom_sheet_item_description_long)
+				.create();
+		items.add(description);
+		items.add(new DividerSpaceItem(app, app.getResources().getDimensionPixelSize(R.dimen.content_padding_half)));
+	}
+
+	public static void showInstance(FragmentManager fm, SnapTrackWarningListener listener) {
+		try {
+			if (!fm.isStateSaved()) {
+				SnapTrackWarningBottomSheet fragment = new SnapTrackWarningBottomSheet();
+				fragment.setUsedOnMap(true);
+				fragment.setRetainInstance(true);
+				fragment.setListener(listener);
+				fm.beginTransaction()
+						.add(R.id.bottomFragmentContainer, fragment, TAG)
+						.commitAllowingStateLoss();
+			}
+		} catch (RuntimeException e) {
+			LOG.error("showInstance", e);
+		}
+	}
+
+	@Override
+	protected int getRightBottomButtonTextId() {
+		return R.string.shared_string_continue;
+	}
+
+	@Override
+	protected void onRightBottomButtonClick() {
+		if (listener != null) {
+			listener.continueButtonOnClick();
+		}
+		dismiss();
+	}
+
+	@Override
+	protected int getDismissButtonTextId() {
+		return R.string.shared_string_cancel;
+	}
+
+
+	@Override
+	public void onDestroyView() {
+		super.onDestroyView();
+		Activity activity = getActivity();
+		if (activity instanceof MapActivity) {
+			activity.findViewById(R.id.snap_to_road_image_button).setVisibility(View.VISIBLE);
+		}
+		if (listener != null) {
+			listener.dismissButtonOnClick();
+		}
+	}
+
+	interface SnapTrackWarningListener {
+
+		void continueButtonOnClick();
+
+		void dismissButtonOnClick();
+
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/StartPlanRouteBottomSheet.java b/OsmAnd/src/net/osmand/plus/measurementtool/StartPlanRouteBottomSheet.java
index 52f8b64b253..483a45f94f2 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/StartPlanRouteBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/StartPlanRouteBottomSheet.java
@@ -94,7 +94,7 @@ public void onClick(View v) {
 		items.add(openExistingTrackItem);
 
 		BaseBottomSheetItem importTrackItem = new BottomSheetItemWithDescription.Builder()
-				.setIcon(getContentIcon(R.drawable.ic_action_phone))
+				.setIcon(getContentIcon(R.drawable.ic_action_import_to))
 				.setTitle(getString(R.string.plan_route_import_track))
 				.setLayoutId(R.layout.bottom_sheet_item_simple_pad_32dp)
 				.setOnClickListener(new View.OnClickListener() {
@@ -201,7 +201,7 @@ public static void showInstance(FragmentManager fragmentManager, StartPlanRouteL
 			fragment.setUsedOnMap(true);
 			fragment.setRetainInstance(true);
 			fragment.setListener(listener);
-			fragment.show(fragmentManager, StartPlanRouteBottomSheet.TAG);
+			fragment.show(fragmentManager, TAG);
 		}
 	}
 
