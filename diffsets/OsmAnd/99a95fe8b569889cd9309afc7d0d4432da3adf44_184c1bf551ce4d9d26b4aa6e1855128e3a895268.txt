diff --git a/OsmAnd/res/layout/local_item_fragment.xml b/OsmAnd/res/layout/local_item_fragment.xml
index 516dde994ad..8ba61897f41 100644
--- a/OsmAnd/res/layout/local_item_fragment.xml
+++ b/OsmAnd/res/layout/local_item_fragment.xml
@@ -62,7 +62,7 @@
 				android:id="@+id/container"
 				android:layout_width="match_parent"
 				android:layout_height="wrap_content"
-				android:background="?attr/list_background_color"
+				android:background="?attr/activity_background_color"
 				android:orientation="vertical" />
 
 		</androidx.core.widget.NestedScrollView>
diff --git a/OsmAnd/res/layout/local_item_info_card.xml b/OsmAnd/res/layout/local_item_info_card.xml
new file mode 100644
index 00000000000..64f84634b12
--- /dev/null
+++ b/OsmAnd/res/layout/local_item_info_card.xml
@@ -0,0 +1,30 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+	android:layout_width="match_parent"
+	android:layout_height="wrap_content"
+	android:orientation="vertical">
+
+	<LinearLayout
+		android:id="@+id/container"
+		android:layout_width="match_parent"
+		android:layout_height="wrap_content"
+		android:background="?attr/list_background_color"
+		android:orientation="vertical">
+
+		<include
+			android:id="@+id/type"
+			layout="@layout/local_item_row" />
+
+		<include
+			android:id="@+id/data"
+			layout="@layout/local_item_row" />
+
+		<include
+			android:id="@+id/size"
+			layout="@layout/local_item_row" />
+
+	</LinearLayout>
+
+	<include layout="@layout/card_bottom_divider" />
+
+</LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/res/layout/local_item_row.xml b/OsmAnd/res/layout/local_item_row.xml
index 17bce8227e1..3eca089648c 100644
--- a/OsmAnd/res/layout/local_item_row.xml
+++ b/OsmAnd/res/layout/local_item_row.xml
@@ -37,6 +37,7 @@
 				android:layout_marginVertical="@dimen/content_padding_small"
 				android:gravity="center_vertical"
 				android:textColor="?android:textColorSecondary"
+				android:textSize="@dimen/default_list_text_size"
 				tools:text="@string/shared_string_cache" />
 
 		</LinearLayout>
@@ -50,8 +51,4 @@
 
 	</LinearLayout>
 
-	<include
-		android:id="@+id/bottom_shadow"
-		layout="@layout/card_bottom_divider" />
-
 </LinearLayout>
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/download/local/LocalIndexHelper.java b/OsmAnd/src/net/osmand/plus/download/local/LocalIndexHelper.java
index 287044290fa..941b48270d0 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/LocalIndexHelper.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/LocalIndexHelper.java
@@ -44,6 +44,7 @@
 import net.osmand.plus.download.ui.AbstractLoadLocalIndexTask;
 import net.osmand.plus.resources.ResourceManager;
 import net.osmand.plus.resources.SQLiteTileSource;
+import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.voice.JsMediaCommandPlayer;
 import net.osmand.plus.voice.JsTtsCommandPlayer;
 import net.osmand.util.Algorithms;
@@ -61,32 +62,34 @@
 public class LocalIndexHelper {
 
 	private final OsmandApplication app;
+	private final OsmandSettings settings;
 	private final ResourceManager resourceManager;
 
 	public LocalIndexHelper(@NonNull OsmandApplication app) {
 		this.app = app;
+		settings = app.getSettings();
 		resourceManager = app.getResourceManager();
 	}
 
 	@NonNull
 	public Map<CategoryType, LocalCategory> loadAllFilesByCategories() {
 		Map<CategoryType, LocalCategory> categories = new TreeMap<>();
-		collectFiles(categories, getInternalDir(), false);
-		collectFiles(categories, getExternalDir(), true);
-		return categories;
-	}
 
-	@NonNull
-	private File getInternalDir() {
-		File filesDir = app.getFilesDir();
-		File parentDir = filesDir.getParentFile();
-		return parentDir != null && Algorithms.stringsEqual(parentDir.getName(), app.getPackageName()) ? parentDir : dir;
+		File internalDir = getAppDir(settings.getInternalAppPath());
+		File externalDir = getAppDir(settings.getExternalStorageDirectory());
+
+		collectFiles(categories, internalDir, false);
+
+		if (!Algorithms.objectEquals(internalDir, externalDir)) {
+			collectFiles(categories, externalDir, true);
+		}
+
+		return categories;
 	}
 
 	@NonNull
-	private File getExternalDir() {
-		File appDir = app.getAppPath(null);
-		File parentDir = appDir.getParentFile();
+	private File getAppDir(@NonNull File dir) {
+		File parentDir = dir.getParentFile();
 		return parentDir != null && Algorithms.stringsEqual(parentDir.getName(), app.getPackageName()) ? parentDir : dir;
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/download/local/LocalItem.java b/OsmAnd/src/net/osmand/plus/download/local/LocalItem.java
index 288473ba01c..f1c374efb7f 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/LocalItem.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/LocalItem.java
@@ -32,6 +32,7 @@
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.track.helpers.GpxUiHelper;
 import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.FileUtils;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.util.Algorithms;
 
@@ -45,7 +46,6 @@ public class LocalItem implements Comparable<LocalItem> {
 	private final String path;
 	private final String fileName;
 	private final long size;
-	private final boolean backuped;
 
 	@Nullable
 	private Object attachedObject;
@@ -58,7 +58,6 @@ public LocalItem(@NonNull File file, @NonNull LocalItemType type) {
 		this.fileName = file.getName();
 		this.path = file.getAbsolutePath();
 		this.size = file.length();
-		this.backuped = path.contains(BACKUP_INDEX_DIR);
 		this.lastModified = file.lastModified();
 	}
 
@@ -86,8 +85,9 @@ public long getSize() {
 		return size;
 	}
 
-	public boolean isBackuped() {
-		return backuped;
+	public boolean isBackuped(@NonNull OsmandApplication app) {
+		File backupDir = FileUtils.getExistingDir(app, BACKUP_INDEX_DIR);
+		return path.startsWith(backupDir.getAbsolutePath());
 	}
 
 	@Nullable
@@ -171,7 +171,7 @@ public String getDescription(@NonNull Context context) {
 	}
 
 	public boolean isLoaded(@NonNull OsmandApplication app) {
-		return !isBackuped() && app.getResourceManager().getIndexFileNames().containsKey(fileName);
+		return !isBackuped(app) && app.getResourceManager().getIndexFileNames().containsKey(fileName);
 	}
 
 	public boolean isCorrupted() {
diff --git a/OsmAnd/src/net/osmand/plus/download/local/LocalOperationTask.java b/OsmAnd/src/net/osmand/plus/download/local/LocalOperationTask.java
index 73f99da7650..82839bf4842 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/LocalOperationTask.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/LocalOperationTask.java
@@ -187,7 +187,7 @@ private boolean move(@NonNull File from, @NonNull File to) {
 	@NonNull
 	private File getFileToBackup(@NonNull LocalItem item) {
 		File file = item.getFile();
-		if (!item.isBackuped()) {
+		if (!item.isBackuped(app)) {
 			return new File(app.getAppPath(BACKUP_INDEX_DIR), file.getName());
 		}
 		return file;
@@ -197,7 +197,7 @@ private File getFileToBackup(@NonNull LocalItem item) {
 	private File getFileToRestore(@NonNull LocalItem item) {
 		File file = item.getFile();
 		String fileName = file.getName();
-		if (item.isBackuped()) {
+		if (item.isBackuped(app)) {
 			File parent = file.getParentFile();
 			if (item.getType() == MAP_DATA) {
 				if (fileName.endsWith(BINARY_ROAD_MAP_INDEX_EXT)) {
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/CategoriesAdapter.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/CategoriesAdapter.java
index 368984f8774..9fe087422c9 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/CategoriesAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/CategoriesAdapter.java
@@ -71,7 +71,7 @@ public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
 		if (holder instanceof MemoryViewHolder) {
 			MemoryInfo memoryInfo = (MemoryInfo) items.get(position);
 			MemoryViewHolder viewHolder = (MemoryViewHolder) holder;
-			viewHolder.bindView(memoryInfo);
+			viewHolder.bindView(memoryInfo, false);
 		} else if (holder instanceof CategoryViewHolder) {
 			LocalCategory category = (LocalCategory) items.get(position);
 			CategoryViewHolder viewHolder = (CategoryViewHolder) holder;
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/ItemMenuProvider.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/ItemMenuProvider.java
index fb0d0b9806c..ca568796d5f 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/ItemMenuProvider.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/ItemMenuProvider.java
@@ -113,7 +113,7 @@ public void onCreateMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {
 		}
 		LocalItemType type = localItem.getType();
 
-		boolean backuped = localItem.isBackuped();
+		boolean backuped = localItem.isBackuped(app);
 		if (type.isBackupSupported() || backuped) {
 			addOperationItem(menu, backuped ? RESTORE_OPERATION : BACKUP_OPERATION);
 		}
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemFragment.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemFragment.java
index 998b1c64931..19cf047da24 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemFragment.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemFragment.java
@@ -6,7 +6,6 @@
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
-import android.widget.TextView;
 
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
@@ -34,9 +33,6 @@
 import net.osmand.plus.utils.ColorUtilities;
 
 import java.io.File;
-import java.text.DateFormat;
-import java.text.SimpleDateFormat;
-import java.util.Locale;
 import java.util.Map;
 
 public class LocalItemFragment extends LocalBaseFragment implements ConfirmDeletionListener,
@@ -104,29 +100,13 @@ private void updateToolbar() {
 	}
 
 	private void updateContent() {
-		String type = localItem.getType().toHumanString(app);
-		addRow(itemsContainer, getString(R.string.shared_string_type), type, false);
+		itemsContainer.removeAllViews();
 
-		DateFormat format = new SimpleDateFormat("dd.MM.yyyy, HH:mm", Locale.getDefault());
-		String date = format.format(localItem.getFile().lastModified());
-		addRow(itemsContainer, getString(R.string.shared_string_created), date, false);
-
-		String size = AndroidUtils.formatSize(app, localItem.getSize());
-		addRow(itemsContainer, getString(R.string.shared_string_size), size, true);
-	}
-
-	private void addRow(@NonNull ViewGroup container, String title, String description, boolean lastItem) {
-		View view = themedInflater.inflate(R.layout.local_item_row, container, false);
-		container.addView(view);
-
-		TextView tvTitle = view.findViewById(R.id.title);
-		tvTitle.setText(title);
-
-		TextView tvDescription = view.findViewById(R.id.description);
-		tvDescription.setText(description);
-
-		AndroidUiHelper.updateVisibility(view.findViewById(R.id.bottom_divider), !lastItem);
-		AndroidUiHelper.updateVisibility(view.findViewById(R.id.bottom_shadow), lastItem);
+		FragmentActivity activity = getActivity();
+		if (activity != null) {
+			LocalItemInfoCard card = new LocalItemInfoCard(activity, localItem);
+			itemsContainer.addView(card.build(itemsContainer.getContext()));
+		}
 	}
 
 	@Override
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemInfoCard.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemInfoCard.java
new file mode 100644
index 00000000000..3eb7d20720b
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemInfoCard.java
@@ -0,0 +1,59 @@
+package net.osmand.plus.download.local.dialogs;
+
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.TextView;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+import androidx.fragment.app.FragmentActivity;
+
+import net.osmand.plus.R;
+import net.osmand.plus.download.local.LocalItem;
+import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+import net.osmand.plus.utils.AndroidUtils;
+
+import java.text.DateFormat;
+import java.text.SimpleDateFormat;
+import java.util.Locale;
+
+public class LocalItemInfoCard extends BaseCard {
+
+	private final LocalItem localItem;
+
+	public LocalItemInfoCard(@NonNull FragmentActivity activity, @NonNull LocalItem localItem) {
+		super(activity, false);
+		this.localItem = localItem;
+	}
+
+	@Override
+	public int getCardLayoutId() {
+		return R.layout.local_item_info_card;
+	}
+
+	@Override
+	protected void updateContent() {
+		ViewGroup container = view.findViewById(R.id.container);
+
+		String type = localItem.getType().toHumanString(app);
+		setupRow(container.findViewById(R.id.type), getString(R.string.shared_string_type), type, false);
+
+		DateFormat format = new SimpleDateFormat("dd.MM.yyyy, HH:mm", Locale.getDefault());
+		String date = format.format(localItem.getFile().lastModified());
+		setupRow(container.findViewById(R.id.data), getString(R.string.shared_string_created), date, false);
+
+		String size = AndroidUtils.formatSize(app, localItem.getSize());
+		setupRow(container.findViewById(R.id.size), getString(R.string.shared_string_size), size, true);
+	}
+
+	private void setupRow(@NonNull View view, @Nullable String title, @Nullable String description, boolean lastItem) {
+		TextView tvTitle = view.findViewById(R.id.title);
+		tvTitle.setText(title);
+
+		TextView tvDescription = view.findViewById(R.id.description);
+		tvDescription.setText(description);
+
+		AndroidUiHelper.updateVisibility(view.findViewById(R.id.bottom_divider), !lastItem);
+	}
+}
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsAdapter.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsAdapter.java
index fa92c8d2018..28473dedc5f 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsAdapter.java
@@ -73,8 +73,11 @@ public void onBindViewHolder(@NonNull ViewHolder holder, int position) {
 		if (holder instanceof MemoryViewHolder) {
 			MemoryInfo memoryInfo = (MemoryInfo) items.get(position);
 
+			boolean lastItem = position == getItemCount() - 1;
+			boolean hideDivider = !lastItem && items.get(position + 1) instanceof HeaderGroup;
+
 			MemoryViewHolder viewHolder = (MemoryViewHolder) holder;
-			viewHolder.bindView(memoryInfo);
+			viewHolder.bindView(memoryInfo, !hideDivider);
 		} else if (holder instanceof LocalItemHolder) {
 			LocalItem item = (LocalItem) items.get(position);
 			boolean lastItem = position == getItemCount() - 1;
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsFragment.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsFragment.java
index 9769f8f7844..0ff6b082e88 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/LocalItemsFragment.java
@@ -195,7 +195,7 @@ private List<Object> getSortedItems() {
 		LocalGroup group = getGroup();
 		if (group != null) {
 			for (LocalItem item : group.getItems()) {
-				if (item.isBackuped()) {
+				if (item.isBackuped(app)) {
 					backupedItems.add(item);
 				} else {
 					activeItems.add(item);
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/LocalItemHolder.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/LocalItemHolder.java
index 14637f237a8..d408174d569 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/LocalItemHolder.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/LocalItemHolder.java
@@ -22,6 +22,7 @@
 
 public class LocalItemHolder extends RecyclerView.ViewHolder {
 
+	private final OsmandApplication app;
 	private final UiUtilities uiUtilities;
 	private final LocalItemListener listener;
 
@@ -35,7 +36,7 @@ public class LocalItemHolder extends RecyclerView.ViewHolder {
 
 	public LocalItemHolder(@NonNull View itemView, @NonNull LocalItemListener listener, boolean nightMode) {
 		super(itemView);
-		OsmandApplication app = (OsmandApplication) itemView.getContext().getApplicationContext();
+		app = (OsmandApplication) itemView.getContext().getApplicationContext();
 		uiUtilities = app.getUIUtilities();
 		this.listener = listener;
 
@@ -81,7 +82,7 @@ public void bindView(@NonNull LocalItem item, boolean selectionMode, boolean las
 	@NonNull
 	private Drawable getIcon(@NonNull LocalItem item) {
 		LocalItemType type = item.getType();
-		if (type.isDownloadType() && !item.isBackuped()) {
+		if (type.isDownloadType() && !item.isBackuped(app)) {
 			boolean shouldUpdate = listener.itemUpdateAvailable(item);
 			return uiUtilities.getIcon(type.getIconId(), shouldUpdate ? R.color.color_distance : R.color.color_ok);
 		} else {
diff --git a/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/MemoryViewHolder.java b/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/MemoryViewHolder.java
index 6e66651e39c..34eed769797 100644
--- a/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/MemoryViewHolder.java
+++ b/OsmAnd/src/net/osmand/plus/download/local/dialogs/viewholders/MemoryViewHolder.java
@@ -46,6 +46,7 @@ public class MemoryViewHolder extends RecyclerView.ViewHolder {
 
 	private final TextView size;
 	private final HorizontalBarChart chart;
+	private final View bottomDivider;
 
 
 	public MemoryViewHolder(@NonNull View itemView, boolean showHeader, boolean nightMode) {
@@ -55,6 +56,7 @@ public MemoryViewHolder(@NonNull View itemView, boolean showHeader, boolean nigh
 
 		size = itemView.findViewById(R.id.size);
 		chart = itemView.findViewById(R.id.horizontal_chart);
+		bottomDivider = itemView.findViewById(R.id.bottom_divider);
 
 		ChartUtils.setupHorizontalGPXChart(app, chart, 0, 0, 0, false, nightMode);
 		chart.getAxisRight().setDrawLabels(false);
@@ -65,15 +67,16 @@ public MemoryViewHolder(@NonNull View itemView, boolean showHeader, boolean nigh
 
 		int padding = showHeader ? 0 : app.getResources().getDimensionPixelSize(R.dimen.content_padding);
 		AndroidUtils.setMargins((MarginLayoutParams) chart.getLayoutParams(), 0, padding, 0, 0);
+		AndroidUiHelper.updateVisibility(bottomDivider, !showHeader);
 		AndroidUiHelper.updateVisibility(itemView.findViewById(R.id.header), showHeader);
-		AndroidUiHelper.updateVisibility(itemView.findViewById(R.id.bottom_divider), !showHeader);
 	}
 
-	public void bindView(@NonNull MemoryInfo memoryInfo) {
+	public void bindView(@NonNull MemoryInfo memoryInfo, boolean showDivider) {
 		BarData barData = ChartUtils.buildStatisticChart(app, chart, memoryInfo, nightMode);
 		adapter.updateContent(barData, memoryInfo);
 
 		size.setText(AndroidUtils.formatSize(app, memoryInfo.getSize()));
+		AndroidUiHelper.updateVisibility(bottomDivider, showDivider);
 	}
 
 	private static class MemoryChartAdapter extends BaseChartAdapter<HorizontalBarChart, BarData, MemoryInfo> {
diff --git a/OsmAnd/src/net/osmand/plus/mapcontextmenu/controllers/MapDataMenuController.java b/OsmAnd/src/net/osmand/plus/mapcontextmenu/controllers/MapDataMenuController.java
index 4fc2e9628cc..6eedcc76deb 100644
--- a/OsmAnd/src/net/osmand/plus/mapcontextmenu/controllers/MapDataMenuController.java
+++ b/OsmAnd/src/net/osmand/plus/mapcontextmenu/controllers/MapDataMenuController.java
@@ -80,7 +80,7 @@ public MapDataMenuController(@NonNull MapActivity mapActivity, @NonNull PointDes
 			otherIndexItems.remove(indexItem);
 		} else if (localItem != null) {
 			downloaded = true;
-			backuped = localItem.isBackuped();
+			backuped = localItem.isBackuped(app);
 			LocalIndexHelper helper = new LocalIndexHelper(app);
 			otherLocalItems = helper.getLocalItems(mapObject.getWorldRegion().getRegionDownloadName());
 			for (Iterator<LocalItem> iterator = otherLocalItems.iterator(); iterator.hasNext(); ) {
@@ -653,7 +653,7 @@ protected void onPostExecute(Void result) {
 		@NonNull
 		private File getFileToRestore(@NonNull LocalItem item) {
 			String fileName = item.getFileName();
-			if (item.isBackuped()) {
+			if (item.isBackuped(app)) {
 				File parent = new File(item.getPath()).getParentFile();
 				if (item.getType() == LocalItemType.MAP_DATA) {
 					parent = app.getAppPath(IndexConstants.MAPS_PATH);
diff --git a/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java b/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java
index 9fb4348d4fb..8972bac5662 100644
--- a/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java
+++ b/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java
@@ -11,14 +11,15 @@
 import androidx.annotation.DrawableRes;
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
+import androidx.annotation.StringRes;
 import androidx.appcompat.view.ContextThemeWrapper;
 import androidx.core.content.ContextCompat;
 import androidx.fragment.app.FragmentActivity;
 
-import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.utils.ColorUtilities;
 
 public abstract class BaseCard {
 
@@ -197,4 +198,9 @@ public void updateVisibility(boolean show) {
 	public boolean isVisible() {
 		return view != null && view.getVisibility() == View.VISIBLE;
 	}
+
+	@NonNull
+	public final String getString(@StringRes int resId) {
+		return app.getString(resId);
+	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ChangeDataStorageBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ChangeDataStorageBottomSheet.java
index 489c06d0b6c..7297e827247 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ChangeDataStorageBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/ChangeDataStorageBottomSheet.java
@@ -1,5 +1,7 @@
 package net.osmand.plus.settings.bottomsheets;
 
+import static net.osmand.plus.settings.datastorage.DataStorageHelper.MANUALLY_SPECIFIED;
+
 import android.content.Context;
 import android.os.Bundle;
 import android.text.Spannable;
@@ -12,24 +14,23 @@
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentManager;
 
-import net.osmand.plus.utils.FileUtils;
 import net.osmand.PlatformUtil;
-import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.R;
-import net.osmand.plus.utils.UiUtilities;
-import net.osmand.plus.widgets.dialogbutton.DialogButtonType;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.base.bottomsheetmenu.BottomSheetItemWithDescription;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
-import net.osmand.plus.settings.fragments.BaseSettingsFragment;
 import net.osmand.plus.settings.datastorage.item.StorageItem;
+import net.osmand.plus.settings.fragments.BaseSettingsFragment;
+import net.osmand.plus.utils.AndroidUtils;
+import net.osmand.plus.utils.ColorUtilities;
+import net.osmand.plus.utils.FileUtils;
+import net.osmand.plus.utils.UiUtilities;
+import net.osmand.plus.widgets.dialogbutton.DialogButtonType;
 
 import org.apache.commons.logging.Log;
 
 import java.io.File;
 
-import static net.osmand.plus.settings.datastorage.DataStorageHelper.MANUALLY_SPECIFIED;
-
 public class ChangeDataStorageBottomSheet extends BasePreferenceBottomSheet {
 
 	public static final String TAG = "ChangeDataStorageBottomSheet";
@@ -47,24 +48,21 @@ public class ChangeDataStorageBottomSheet extends BasePreferenceBottomSheet {
 
 	@Override
 	public void createMenuItems(Bundle savedInstanceState) {
-
-		Context ctx = getContext();
-
 		if (savedInstanceState != null) {
 			currentDirectory = savedInstanceState.getParcelable(CURRENT_DIRECTORY);
 			newDirectory = savedInstanceState.getParcelable(NEW_DIRECTORY);
 		}
-
-		if (ctx == null || currentDirectory == null || newDirectory == null) {
+		if (currentDirectory == null || newDirectory == null) {
 			return;
 		}
 
+		Context ctx = UiUtilities.getThemedContext(requireContext(), nightMode);
 		items.add(new TitleItem(getString(R.string.change_osmand_data_folder_question)));
 
 		int textColorPrimary = ColorUtilities.getPrimaryTextColorId(nightMode);
 		int activeColor = ColorUtilities.getActiveColorId(nightMode);
 		CharSequence desc = null;
-		
+
 		File currentStorageFile = new File(currentDirectory.getDirectory());
 		if ((!FileUtils.isWritable(currentStorageFile))) {
 			desc = String.format(getString(R.string.android_19_location_disabled), currentStorageFile.getAbsoluteFile());
@@ -95,7 +93,7 @@ public void createMenuItems(Bundle savedInstanceState) {
 
 		//buttons
 		View mainView = View.inflate(ctx, R.layout.bottom_sheet_change_data_storage, null);
-		
+
 		View btnDontMoveView = mainView.findViewById(R.id.btnDontMove);
 		btnDontMoveView.setOnClickListener(v -> positiveButtonsClick(false));
 		UiUtilities.setupDialogButton(nightMode, btnDontMoveView, DialogButtonType.SECONDARY,
@@ -131,7 +129,7 @@ private void positiveButtonsClick(boolean moveData) {
 		bundle.putParcelable(CHOSEN_DIRECTORY, newDirectory);
 		bundle.putBoolean(MOVE_DATA, moveData);
 		Fragment fragment = getTargetFragment();
-		if (fragment  instanceof BaseSettingsFragment) {
+		if (fragment instanceof BaseSettingsFragment) {
 			((BaseSettingsFragment) fragment).onPreferenceChange(getPreference(), bundle);
 		}
 		dismiss();
@@ -149,25 +147,20 @@ protected boolean hideButtonsContainer() {
 		return true;
 	}
 
-	public static boolean showInstance(FragmentManager fm, String prefId, StorageItem currentDirectory,
-	                                   StorageItem newDirectory, Fragment target, boolean usedOnMap) {
-		try {
-			if (fm.findFragmentByTag(TAG) == null) {
-				Bundle args = new Bundle();
-				args.putString(PREFERENCE_ID, prefId);
-
-				ChangeDataStorageBottomSheet fragment = new ChangeDataStorageBottomSheet();
-				fragment.setCurrentDirectory(currentDirectory);
-				fragment.setNewDirectory(newDirectory);
-				fragment.setTargetFragment(target, 0);
-				fragment.setUsedOnMap(usedOnMap);
-				fragment.setArguments(args);
-				fragment.show(fm, TAG);
-				return true;
-			}
-		} catch (RuntimeException e) {
-			LOG.error(e.getMessage());
+	public static void showInstance(@NonNull FragmentManager manager, @NonNull String prefId,
+	                                StorageItem currentDirectory, StorageItem newDirectory,
+	                                Fragment target, boolean usedOnMap) {
+		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
+			Bundle args = new Bundle();
+			args.putString(PREFERENCE_ID, prefId);
+
+			ChangeDataStorageBottomSheet fragment = new ChangeDataStorageBottomSheet();
+			fragment.setCurrentDirectory(currentDirectory);
+			fragment.setNewDirectory(newDirectory);
+			fragment.setTargetFragment(target, 0);
+			fragment.setUsedOnMap(usedOnMap);
+			fragment.setArguments(args);
+			fragment.show(manager, TAG);
 		}
-		return false;
 	}
 }
\ No newline at end of file
diff --git a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
index 1939e17c6f5..399fd322334 100644
--- a/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
+++ b/OsmAnd/src/net/osmand/plus/views/layers/MapInfoLayer.java
@@ -187,8 +187,13 @@ public void recreateControls() {
 	public void recreateTopWidgetsPanel() {
 		ApplicationMode appMode = settings.getApplicationMode();
 		widgetRegistry.updateWidgetsInfo(appMode, drawSettings);
-		topWidgetsPanel.update(drawSettings);
-		bottomWidgetsPanel.update(drawSettings);
+
+		if (topWidgetsPanel != null) {
+			topWidgetsPanel.update(drawSettings);
+		}
+		if (bottomWidgetsPanel != null) {
+			bottomWidgetsPanel.update(drawSettings);
+		}
 	}
 
 	public RulerWidget setupRulerWidget(@NonNull View mapRulerView) {
@@ -318,7 +323,7 @@ private TextState calculateTextState(boolean verticalWidget) {
 			ts.panelBorderColorId = R.color.widget_panel_border_transparent;
 		} else if (nightMode) {
 			ts.boxTop = R.drawable.btn_flat_night;
-			ts.widgetBackgroundId = verticalWidget ? R.color.widget_background_color_dark  :R.drawable.bs_side_widget_night;
+			ts.widgetBackgroundId = verticalWidget ? R.color.widget_background_color_dark : R.drawable.bs_side_widget_night;
 			ts.boxFree = R.drawable.btn_round_night;
 			ts.widgetDividerColorId = R.color.divider_color_dark;
 			ts.panelBorderColorId = R.color.icon_color_secondary_dark;
