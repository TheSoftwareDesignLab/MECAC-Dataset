diff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
index dfdae7d09b8..b248f99a7e3 100644
--- a/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivityActions.java
@@ -313,7 +313,7 @@ public void enterRoutePlanningModeGivenGpx(GpxFile gpxFile, ApplicationMode appM
 				activity.getMapRouteInfoMenu().setShowMenu(menuState);
 			}
 			if (!settings.SPEED_CAMERAS_ALERT_SHOWED.get()) {
-				SpeedCamerasBottomSheet.showInstance(activity.getSupportFragmentManager(), null);
+				SpeedCamerasBottomSheet.showInstance(activity.getSupportFragmentManager(), null, null, true);
 			}
 		}
 	}
diff --git a/OsmAnd/src/net/osmand/plus/base/BaseOsmAndDialogFragment.java b/OsmAnd/src/net/osmand/plus/base/BaseOsmAndDialogFragment.java
index 29eff5ce30f..ada3c2db170 100644
--- a/OsmAnd/src/net/osmand/plus/base/BaseOsmAndDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/base/BaseOsmAndDialogFragment.java
@@ -17,15 +17,19 @@
 
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
-import net.osmand.plus.helpers.RequestMapThemeParams;
+import net.osmand.plus.helpers.RequestThemeParams;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
 
 public abstract class BaseOsmAndDialogFragment extends DialogFragment {
 
+	private static final String APP_MODE_KEY = "app_mode_key";
+
 	protected OsmandApplication app;
 	protected OsmandSettings settings;
+	protected ApplicationMode appMode;
 	protected UiUtilities iconsCache;
 	protected LayoutInflater themedInflater;
 	protected boolean nightMode;
@@ -36,21 +40,54 @@ public void onCreate(Bundle savedInstanceState) {
 		app = (OsmandApplication) requireActivity().getApplication();
 		settings = app.getSettings();
 		iconsCache = app.getUIUtilities();
+		restoreAppMode(savedInstanceState);
 
 		updateNightMode();
 		setStyle(STYLE_NO_FRAME, nightMode ? R.style.OsmandDarkTheme : R.style.OsmandLightTheme);
 		getActivity().getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE);
 	}
 
+	private void restoreAppMode(@Nullable Bundle savedInstanceState) {
+		if (savedInstanceState != null) {
+			String modeKey = savedInstanceState.getString(APP_MODE_KEY);
+			appMode = ApplicationMode.valueOfStringKey(modeKey, null);
+		}
+		Bundle args = getArguments();
+		if (appMode == null && args != null) {
+			String modeKey = args.getString(APP_MODE_KEY);
+			appMode = ApplicationMode.valueOfStringKey(modeKey, null);
+		}
+		if (appMode == null) {
+			appMode = settings.getApplicationMode();
+		}
+	}
+
+	@Override
+	public void onSaveInstanceState(@NonNull Bundle outState) {
+		super.onSaveInstanceState(outState);
+		if (appMode != null) {
+			outState.putString(APP_MODE_KEY, appMode.getStringKey());
+		}
+	}
+
 	protected void updateNightMode() {
 		nightMode = isNightMode(isUsedOnMap());
-		themedInflater = UiUtilities.getInflater(getContext(), nightMode);
+		themedInflater = UiUtilities.getInflater(requireContext(), nightMode);
 	}
 
 	protected boolean isUsedOnMap() {
 		return false;
 	}
 
+	public void setAppMode(@NonNull ApplicationMode appMode) {
+		this.appMode = appMode;
+	}
+
+	@NonNull
+	public ApplicationMode getAppMode() {
+		return appMode;
+	}
+
 	@NonNull
 	protected View inflate(@LayoutRes int layoutRedId) {
 		return inflate(layoutRedId, null);
@@ -92,7 +129,7 @@ protected Drawable getContentIcon(@DrawableRes int id) {
 	}
 
 	protected boolean isNightMode(boolean usedOnMap) {
-		RequestMapThemeParams params = new RequestMapThemeParams().markIgnoreExternalProvider();
+		RequestThemeParams params = new RequestThemeParams(appMode, true);
 		return app.getDaynightHelper().isNightMode(usedOnMap, params);
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/base/BaseOsmAndFragment.java b/OsmAnd/src/net/osmand/plus/base/BaseOsmAndFragment.java
index 389b2a35627..2766253793e 100644
--- a/OsmAnd/src/net/osmand/plus/base/BaseOsmAndFragment.java
+++ b/OsmAnd/src/net/osmand/plus/base/BaseOsmAndFragment.java
@@ -22,14 +22,18 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.activities.OsmandActionBarActivity;
-import net.osmand.plus.helpers.RequestMapThemeParams;
+import net.osmand.plus.helpers.RequestThemeParams;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
 
 public class BaseOsmAndFragment extends Fragment implements TransitionAnimator {
 
+	protected static final String APP_MODE_KEY = "app_mode_key";
+
 	protected OsmandApplication app;
+	protected ApplicationMode appMode;
 	protected OsmandSettings settings;
 	protected UiUtilities uiUtilities;
 	protected LayoutInflater themedInflater;
@@ -44,9 +48,42 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		app = (OsmandApplication) requireActivity().getApplication();
 		settings = app.getSettings();
 		uiUtilities = app.getUIUtilities();
+		restoreAppMode(savedInstanceState);
 		updateNightMode();
 	}
 
+	@Override
+	public void onSaveInstanceState(@NonNull Bundle outState) {
+		super.onSaveInstanceState(outState);
+		if (appMode != null) {
+			outState.putString(APP_MODE_KEY, appMode.getStringKey());
+		}
+	}
+
+	private void restoreAppMode(@Nullable Bundle savedInstanceState) {
+		if (savedInstanceState != null) {
+			String modeKey = savedInstanceState.getString(APP_MODE_KEY);
+			appMode = ApplicationMode.valueOfStringKey(modeKey, null);
+		}
+		Bundle args = getArguments();
+		if (appMode == null && args != null) {
+			String modeKey = args.getString(APP_MODE_KEY);
+			appMode = ApplicationMode.valueOfStringKey(modeKey, null);
+		}
+		if (appMode == null) {
+			appMode = settings.getApplicationMode();
+		}
+	}
+
+	public void setAppMode(@NonNull ApplicationMode appMode) {
+		this.appMode = appMode;
+	}
+
+	@NonNull
+	protected ApplicationMode getAppMode() {
+		return appMode;
+	}
+
 	protected void updateNightMode() {
 		nightMode = isNightMode(isUsedOnMap());
 		themedInflater = UiUtilities.getInflater(requireContext(), nightMode);
@@ -197,7 +234,7 @@ protected int getDimensionPixelSize(@DimenRes int resId) {
 	}
 
 	protected boolean isNightMode(boolean usedOnMap) {
-		RequestMapThemeParams params = new RequestMapThemeParams().markIgnoreExternalProvider();
+		RequestThemeParams params = new RequestThemeParams(appMode, true);
 		return app.getDaynightHelper().isNightMode(usedOnMap, params);
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java
index aac264aa54f..cc86599f578 100644
--- a/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/base/MenuBottomSheetDialogFragment.java
@@ -31,6 +31,7 @@
 import net.osmand.plus.R;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
@@ -43,10 +44,12 @@
 public abstract class MenuBottomSheetDialogFragment extends BottomSheetDialogFragment {
 
 	private static final String USED_ON_MAP_KEY = "used_on_map";
+	protected static final String APP_MODE_KEY = "app_mode_key";
 	protected static final int DEFAULT_VALUE = -1;
 
 	protected List<BaseBottomSheetItem> items = new ArrayList<>();
 
+	protected ApplicationMode appMode;
 	protected boolean usedOnMap = true;
 	protected boolean nightMode;
 
@@ -68,6 +71,20 @@ public void onCreate(Bundle savedInstanceState) {
 		if (savedInstanceState != null) {
 			usedOnMap = savedInstanceState.getBoolean(USED_ON_MAP_KEY);
 		}
+		restoreAppMode(savedInstanceState);
+	}
+
+	private void restoreAppMode(@Nullable Bundle savedInstanceState) {
+		Bundle args = getArguments();
+		if (savedInstanceState != null) {
+			appMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), null);
+		}
+		if (appMode == null && args != null) {
+			appMode = ApplicationMode.valueOfStringKey(args.getString(APP_MODE_KEY), null);
+		}
+		if (appMode == null) {
+			appMode = requiredMyApplication().getSettings().getApplicationMode();
+		}
 	}
 
 	@Nullable
@@ -115,6 +132,9 @@ public void onStart() {
 	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		outState.putBoolean(USED_ON_MAP_KEY, usedOnMap);
+		if (appMode != null) {
+			outState.putString(APP_MODE_KEY, appMode.getStringKey());
+		}
 	}
 
 	@Override
@@ -148,6 +168,15 @@ public void updateMenuItems() {
 		}
 	}
 
+	public void setAppMode(@Nullable ApplicationMode appMode) {
+		this.appMode = appMode;
+	}
+
+	@NonNull
+	public ApplicationMode getAppMode() {
+		return appMode;
+	}
+
 	@Override
 	protected Drawable getContentIcon(@DrawableRes int id) {
 		return getIcon(id, ColorUtilities.getDefaultIconColorId(nightMode));
@@ -463,7 +492,7 @@ protected LayerDrawable createBackgroundDrawable(@NonNull Context ctx, @Drawable
 	}
 
 	public boolean isNightMode(@NonNull OsmandApplication app) {
-		return app.getDaynightHelper().isNightMode(usedOnMap);
+		return app.getDaynightHelper().isNightMode(usedOnMap, appMode);
 	}
 
 	private void showShadowButton() {
diff --git a/OsmAnd/src/net/osmand/plus/card/color/palette/main/ColorsPaletteCard.java b/OsmAnd/src/net/osmand/plus/card/color/palette/main/ColorsPaletteCard.java
index 7a5d635fc93..8ddb5fe6d4e 100644
--- a/OsmAnd/src/net/osmand/plus/card/color/palette/main/ColorsPaletteCard.java
+++ b/OsmAnd/src/net/osmand/plus/card/color/palette/main/ColorsPaletteCard.java
@@ -12,6 +12,7 @@
 import net.osmand.plus.R;
 import net.osmand.plus.card.color.palette.main.data.PaletteColor;
 import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.widgets.tools.HorizontalSpaceItemDecoration;
 
@@ -24,13 +25,13 @@ public class ColorsPaletteCard extends BaseCard implements IColorsPalette {
 
 	public ColorsPaletteCard(@NonNull FragmentActivity activity,
 	                         @NonNull IColorsPaletteController controller) {
-		this(activity, controller, true);
+		this(activity, controller, null, true);
 	}
 
 	public ColorsPaletteCard(@NonNull FragmentActivity activity,
 	                         @NonNull IColorsPaletteController controller,
-	                         boolean usedOnMap) {
-		super(activity, usedOnMap);
+	                         @Nullable ApplicationMode appMode, boolean usedOnMap) {
+		super(activity, appMode, usedOnMap);
 		this.controller = controller;
 		controller.bindPalette(this);
 		paletteElements = new ColorsPaletteElements(activity, nightMode);
diff --git a/OsmAnd/src/net/osmand/plus/card/color/palette/moded/ModedColorsPaletteCard.java b/OsmAnd/src/net/osmand/plus/card/color/palette/moded/ModedColorsPaletteCard.java
index a402cc1fefc..451c65ce51e 100644
--- a/OsmAnd/src/net/osmand/plus/card/color/palette/moded/ModedColorsPaletteCard.java
+++ b/OsmAnd/src/net/osmand/plus/card/color/palette/moded/ModedColorsPaletteCard.java
@@ -9,6 +9,7 @@
 import net.osmand.plus.R;
 import net.osmand.plus.card.color.palette.main.ColorsPaletteCard;
 import net.osmand.plus.card.color.palette.main.data.PaletteMode;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.widgets.multistatetoggle.TextToggleButton;
 import net.osmand.plus.widgets.multistatetoggle.TextToggleButton.TextRadioItem;
 
@@ -22,13 +23,13 @@ public class ModedColorsPaletteCard extends ColorsPaletteCard {
 
 	public ModedColorsPaletteCard(@NonNull FragmentActivity activity,
 	                              @NonNull ModedColorsPaletteController controller) {
-		this(activity, controller, true);
+		this(activity, controller, null, true);
 	}
 
 	public ModedColorsPaletteCard(@NonNull FragmentActivity activity,
 	                              @NonNull ModedColorsPaletteController controller,
-	                              boolean usedOnMap) {
-		super(activity, controller, usedOnMap);
+	                              @Nullable ApplicationMode appMode, boolean usedOnMap) {
+		super(activity, controller, appMode, usedOnMap);
 		this.controller = controller;
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/card/icon/IconsPaletteCard.java b/OsmAnd/src/net/osmand/plus/card/icon/IconsPaletteCard.java
index c3be7dfa59e..6b4367b0dd4 100644
--- a/OsmAnd/src/net/osmand/plus/card/icon/IconsPaletteCard.java
+++ b/OsmAnd/src/net/osmand/plus/card/icon/IconsPaletteCard.java
@@ -11,6 +11,7 @@
 
 import net.osmand.plus.R;
 import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.widgets.tools.HorizontalSpaceItemDecoration;
 
@@ -22,7 +23,13 @@ public class IconsPaletteCard<IconData> extends BaseCard implements IIconsPalett
 
 	public IconsPaletteCard(@NonNull FragmentActivity activity,
 	                        @NonNull IIconsPaletteController<IconData> controller, boolean usedOnMap) {
-		super(activity, usedOnMap);
+		this(activity, controller, null, usedOnMap);
+	}
+
+	public IconsPaletteCard(@NonNull FragmentActivity activity,
+	                        @NonNull IIconsPaletteController<IconData> controller,
+	                        @Nullable ApplicationMode appMode, boolean usedOnMap) {
+		super(activity, appMode, usedOnMap);
 		this.controller = controller;
 		controller.bindPalette(this);
 		paletteAdapter = new IconsPaletteAdapter<>(activity, controller, nightMode);
diff --git a/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java b/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java
index 806b4bd8b1e..837b1a109f7 100644
--- a/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/dialogs/SpeedCamerasBottomSheet.java
@@ -16,6 +16,7 @@
 import net.osmand.plus.R;
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.FontCache;
 import net.osmand.plus.utils.UiUtilities;
 import net.osmand.plus.widgets.dialogbutton.DialogButtonType;
@@ -25,9 +26,12 @@ public class SpeedCamerasBottomSheet extends MenuBottomSheetDialogFragment {
 	public static final String TAG = SpeedCamerasBottomSheet.class.getName();
 	private OsmandApplication app;
 
-	public static void showInstance(@NonNull FragmentManager fm, @Nullable Fragment targetFragment) {
+	public static void showInstance(@NonNull FragmentManager fm, @Nullable Fragment targetFragment,
+	                                @Nullable ApplicationMode appMode, boolean usedOnMap) {
 		if (!fm.isStateSaved()) {
 			SpeedCamerasBottomSheet bottomSheet = new SpeedCamerasBottomSheet();
+			bottomSheet.setAppMode(appMode);
+			bottomSheet.setUsedOnMap(usedOnMap);
 			bottomSheet.setTargetFragment(targetFragment, 0);
 			bottomSheet.show(fm, TAG);
 		}
diff --git a/OsmAnd/src/net/osmand/plus/download/ui/DownloadResourceGroupFragment.java b/OsmAnd/src/net/osmand/plus/download/ui/DownloadResourceGroupFragment.java
index 4a95e04b941..8f5d2022ab3 100644
--- a/OsmAnd/src/net/osmand/plus/download/ui/DownloadResourceGroupFragment.java
+++ b/OsmAnd/src/net/osmand/plus/download/ui/DownloadResourceGroupFragment.java
@@ -22,6 +22,7 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
+import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.appcompat.app.AlertDialog;
 import androidx.appcompat.widget.Toolbar;
@@ -542,7 +543,7 @@ public void onRemoveLocalForecastEvent() {
 	}
 
 	@Override
-	public void onSaveInstanceState(Bundle outState) {
+	public void onSaveInstanceState(@NonNull Bundle outState) {
 		outState.putString(REGION_ID_DLG_KEY, groupId);
 		super.onSaveInstanceState(outState);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/helpers/DayNightHelper.java b/OsmAnd/src/net/osmand/plus/helpers/DayNightHelper.java
index 21f21a1856e..4f0c4557b00 100644
--- a/OsmAnd/src/net/osmand/plus/helpers/DayNightHelper.java
+++ b/OsmAnd/src/net/osmand/plus/helpers/DayNightHelper.java
@@ -111,28 +111,31 @@ private StateChangedListener<DayNightMode> getPreferenceStateListener() {
 	}
 
 	public boolean isNightMode(boolean usedOnMap) {
-		return isNightMode(usedOnMap, new RequestMapThemeParams());
+		return isNightMode(usedOnMap, new RequestThemeParams());
 	}
 
-	public boolean isNightMode(boolean usedOnMap, @NonNull RequestMapThemeParams params) {
+	public boolean isNightMode(boolean usedOnMap, @NonNull ApplicationMode appMode) {
+		return isNightMode(usedOnMap, new RequestThemeParams(appMode));
+	}
+
+	public boolean isNightMode(boolean usedOnMap, @NonNull RequestThemeParams params) {
 		if (usedOnMap) {
 			return isNightModeForMapControls(params);
 		} else {
-			return !settings.isLightContent();
+			return !settings.isLightContentForMode(params.requireAppMode(app));
 		}
 	}
 
 	public boolean isNightModeForMapControls() {
-		return isNightModeForMapControls(new RequestMapThemeParams());
+		return isNightModeForMapControls(new RequestThemeParams());
 	}
 
 	public boolean isNightModeForMapControlsForProfile(ApplicationMode mode) {
-		return isNightModeForMapControls(new RequestMapThemeParams().setAppMode(mode));
+		return isNightModeForMapControls(new RequestThemeParams(mode));
 	}
 
-	public boolean isNightModeForMapControls(@NonNull RequestMapThemeParams params) {
-		ApplicationMode mode = params.requireAppMode(settings.APPLICATION_MODE.get());
-		if (settings.isLightContentForMode(mode)) {
+	public boolean isNightModeForMapControls(@NonNull RequestThemeParams params) {
+		if (settings.isLightContentForMode(params.requireAppMode(app))) {
 			return isNightModeForProfile(params);
 		} else {
 			return true;
@@ -140,12 +143,12 @@ public boolean isNightModeForMapControls(@NonNull RequestMapThemeParams params)
 	}
 
 	public boolean isNightMode() {
-		return isNightModeForProfile(new RequestMapThemeParams());
+		return isNightModeForProfile(new RequestThemeParams());
 	}
 
-	private boolean isNightModeForProfile(@NonNull RequestMapThemeParams params) {
-		ApplicationMode mode = params.requireAppMode(settings.APPLICATION_MODE.get());
-		DayNightMode dayNightMode = settings.DAYNIGHT_MODE.getModeValue(mode);
+	private boolean isNightModeForProfile(@NonNull RequestThemeParams params) {
+		ApplicationMode appMode = params.requireAppMode(app);
+		DayNightMode dayNightMode = settings.DAYNIGHT_MODE.getModeValue(appMode);
 		if (externalMapThemeProvider != null && !params.shouldIgnoreExternalProvider()) {
 			DayNightMode providedTheme = externalMapThemeProvider.getMapTheme();
 			dayNightMode = providedTheme != null ? providedTheme : dayNightMode;
@@ -181,7 +184,7 @@ private boolean isNightModeForProfile(@NonNull RequestMapThemeParams params) {
 		} else if (dayNightMode.isSensor()) {
 			return lastNightMode;
 		} else if (dayNightMode.isAppTheme()) {
-			return !settings.isLightContentForMode(mode);
+			return !settings.isLightContentForMode(appMode);
 		}
 		return false;
 	}
diff --git a/OsmAnd/src/net/osmand/plus/helpers/RequestMapThemeParams.java b/OsmAnd/src/net/osmand/plus/helpers/RequestMapThemeParams.java
deleted file mode 100644
index 1d2b0ba2dd1..00000000000
--- a/OsmAnd/src/net/osmand/plus/helpers/RequestMapThemeParams.java
+++ /dev/null
@@ -1,32 +0,0 @@
-package net.osmand.plus.helpers;
-
-import androidx.annotation.NonNull;
-
-import net.osmand.plus.settings.backend.ApplicationMode;
-
-public class RequestMapThemeParams {
-
-	private ApplicationMode appMode;
-	private boolean ignoreExternalProvider = false;
-
-	@NonNull
-	public RequestMapThemeParams setAppMode(ApplicationMode appMode) {
-		this.appMode = appMode;
-		return this;
-	}
-
-	@NonNull
-	public RequestMapThemeParams markIgnoreExternalProvider() {
-		this.ignoreExternalProvider = true;
-		return this;
-	}
-
-	@NonNull
-	public ApplicationMode requireAppMode(@NonNull ApplicationMode defaultValue) {
-		return appMode != null ? appMode : defaultValue;
-	}
-
-	public boolean shouldIgnoreExternalProvider() {
-		return ignoreExternalProvider;
-	}
-}
diff --git a/OsmAnd/src/net/osmand/plus/helpers/RequestThemeParams.java b/OsmAnd/src/net/osmand/plus/helpers/RequestThemeParams.java
new file mode 100644
index 00000000000..69583625984
--- /dev/null
+++ b/OsmAnd/src/net/osmand/plus/helpers/RequestThemeParams.java
@@ -0,0 +1,35 @@
+package net.osmand.plus.helpers;
+
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
+import net.osmand.plus.OsmandApplication;
+import net.osmand.plus.settings.backend.ApplicationMode;
+
+public class RequestThemeParams {
+
+	private final ApplicationMode appMode;
+	private final boolean ignoreExternalProvider;
+
+	public RequestThemeParams() {
+		this(null, false);
+	}
+
+	public RequestThemeParams(@Nullable ApplicationMode appMode) {
+		this(appMode, false);
+	}
+
+	public RequestThemeParams(@Nullable ApplicationMode appMode, boolean ignoreExternalProvider) {
+		this.appMode = appMode;
+		this.ignoreExternalProvider = ignoreExternalProvider;
+	}
+
+	@NonNull
+	public ApplicationMode requireAppMode(@NonNull OsmandApplication app) {
+		return appMode != null ? appMode : app.getSettings().getApplicationMode();
+	}
+
+	public boolean shouldIgnoreExternalProvider() {
+		return ignoreExternalProvider;
+	}
+}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentAdapter.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentAdapter.java
index c976cc05a54..06666b8d89a 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentAdapter.java
@@ -12,7 +12,6 @@
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.FrameLayout.LayoutParams;
-import android.widget.ImageButton;
 import android.widget.ImageView;
 import android.widget.TextView;
 
@@ -28,9 +27,6 @@
 import net.osmand.plus.R;
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.base.containers.ScreenItem;
-import net.osmand.plus.helpers.RequestMapThemeParams;
-import net.osmand.plus.keyevent.assignment.KeyAssignment;
-import net.osmand.plus.keyevent.commands.KeyEventCommand;
 import net.osmand.plus.quickaction.QuickAction;
 import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.UiUtilities;
@@ -219,7 +215,7 @@ private void setupSelectableBackground(@NonNull View view, @ColorInt int color)
 	}
 
 	private boolean isNightMode() {
-		return app.getDaynightHelper().isNightMode(usedOnMap, new RequestMapThemeParams().setAppMode(appMode));
+		return app.getDaynightHelper().isNightMode(usedOnMap, appMode);
 	}
 
 	private int getDimen(@DimenRes int resId) {
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
index 6c8df309f06..786e5a92dee 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentController.java
@@ -345,7 +345,7 @@ private void askDismissDialog() {
 	}
 
 	public boolean isNightMode() {
-		return app.getDaynightHelper().isNightMode(false);
+		return app.getDaynightHelper().isNightMode(false, appMode);
 	}
 
 	@Nullable
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
index 9f62d82c0c7..d31726d0f69 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/editassignment/EditKeyAssignmentFragment.java
@@ -1,7 +1,6 @@
 package net.osmand.plus.keyevent.fragments.editassignment;
 
 import static net.osmand.plus.keyevent.fragments.editassignment.EditKeyAssignmentController.TRANSITION_NAME;
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 import static net.osmand.plus.utils.ColorUtilities.getPrimaryIconColor;
 
 import android.graphics.drawable.Drawable;
@@ -44,14 +43,10 @@ public class EditKeyAssignmentFragment extends BaseOsmAndFragment
 
 	private EditKeyAssignmentAdapter adapter;
 	private EditKeyAssignmentController controller;
-	private ApplicationMode appMode;
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-		Bundle arguments = requireArguments();
-		String appModeKey = arguments.getString(APP_MODE_KEY);
-		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
 		controller = EditKeyAssignmentController.getExistedInstance(app);
 		if (controller != null) {
 			controller.registerDialog(this);
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesAdapter.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesAdapter.java
index 93b91d4ffdf..2a9ce6cd99c 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesAdapter.java
@@ -173,7 +173,7 @@ private void setupSelectableBackground(@NonNull View view, @ColorInt int color)
 	}
 
 	private boolean isNightMode() {
-		return app.getDaynightHelper().isNightMode(usedOnMap);
+		return app.getDaynightHelper().isNightMode(usedOnMap, appMode);
 	}
 
 	private int getDimen(@DimenRes int resId) {
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesController.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesController.java
index 6f2e9fc5728..2d1c4563fbd 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesController.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesController.java
@@ -133,6 +133,6 @@ public boolean isSelected(@NonNull InputDeviceProfile device) {
 	}
 
 	private boolean isNightMode() {
-		return app.getDaynightHelper().isNightMode(usedOnMap);
+		return app.getDaynightHelper().isNightMode(usedOnMap, appMode);
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesFragment.java
index 340b219ca8f..e7370d0dfea 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/inputdevices/InputDevicesFragment.java
@@ -1,6 +1,5 @@
 package net.osmand.plus.keyevent.fragments.inputdevices;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 
 import android.os.Bundle;
 import android.view.LayoutInflater;
@@ -36,15 +35,11 @@ public class InputDevicesFragment extends BaseOsmAndFragment implements InputDev
 	private InputDevicesAdapter adapter;
 	private InputDevicesController controller;
 
-	private ApplicationMode appMode;
 	private InputDevicesHelper deviceHelper;
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-		Bundle arguments = getArguments();
-		String appModeKey = arguments != null ? arguments.getString(APP_MODE_KEY) : "";
-		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
 		controller = new InputDevicesController(app, appMode, isUsedOnMap());
 		deviceHelper = app.getInputDeviceHelper();
 	}
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java
index 3e9ad35bf21..9ed1466afec 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsController.java
@@ -20,7 +20,6 @@
 import net.osmand.plus.base.containers.ScreenItem;
 import net.osmand.plus.base.dialog.BaseDialogController;
 import net.osmand.plus.base.dialog.DialogManager;
-import net.osmand.plus.helpers.RequestMapThemeParams;
 import net.osmand.plus.keyevent.InputDevicesHelper;
 import net.osmand.plus.keyevent.devices.InputDeviceProfile;
 import net.osmand.plus.keyevent.assignment.KeyAssignment;
@@ -179,10 +178,6 @@ private void askRefreshDialog() {
 		dialogManager.askRefreshDialogCompletely(PROCESS_ID);
 	}
 
-	public boolean isNightMode() {
-		return app.getDaynightHelper().isNightMode(usedOnMap, new RequestMapThemeParams().setAppMode(appMode));
-	}
-
 	private static class EditingBundle {
 		private List<KeyAssignment> assignments;
 
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java
index 27f8cec0034..40b9786a0b5 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/keyassignments/KeyAssignmentsFragment.java
@@ -1,6 +1,5 @@
 package net.osmand.plus.keyevent.fragments.keyassignments;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 import static net.osmand.plus.utils.AndroidUtils.getNavigationIconResId;
 
 import android.os.Bundle;
@@ -27,7 +26,6 @@
 import net.osmand.plus.activities.MapActivity;
 import net.osmand.plus.base.BaseOsmAndFragment;
 import net.osmand.plus.base.dialog.interfaces.dialog.IAskRefreshDialogCompletely;
-import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.keyevent.InputDevicesHelper;
 import net.osmand.plus.keyevent.listener.EventType;
 import net.osmand.plus.keyevent.listener.InputDevicesEventListener;
@@ -43,16 +41,11 @@ public class KeyAssignmentsFragment extends BaseOsmAndFragment
 
 	private KeyAssignmentsAdapter adapter;
 	private KeyAssignmentsController controller;
-
-	private ApplicationMode appMode;
 	private InputDevicesHelper deviceHelper;
 
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-		Bundle arguments = getArguments();
-		String appModeKey = arguments != null ? arguments.getString(APP_MODE_KEY) : "";
-		appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
 		deviceHelper = app.getInputDeviceHelper();
 		controller = KeyAssignmentsController.getExistedInstance(app);
 		if (controller != null) {
diff --git a/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java b/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
index e3aab7d3077..5d08b1edc9c 100644
--- a/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
+++ b/OsmAnd/src/net/osmand/plus/keyevent/fragments/selectkeycode/SelectKeyCodeFragment.java
@@ -1,7 +1,6 @@
 package net.osmand.plus.keyevent.fragments.selectkeycode;
 
 import static android.graphics.Typeface.BOLD;
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 import static net.osmand.plus.utils.ColorUtilities.getPrimaryIconColor;
 import static net.osmand.plus.utils.UiUtilities.createSpannableString;
 
@@ -71,8 +70,6 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		initialKeyCode = arguments.getInt(ATTR_KEY_CODE);
 		assignmentId = arguments.getString(ATTR_ASSIGNMENT_ID);
 
-		String appModeKey = arguments.getString(APP_MODE_KEY);
-		ApplicationMode appMode = ApplicationMode.valueOfStringKey(appModeKey, settings.getApplicationMode());
 		String deviceId = Objects.requireNonNull(arguments.getString(ATTR_DEVICE_ID));
 		inputDevice = deviceHelper.getDeviceById(appMode, deviceId);
 
diff --git a/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/icon/EditorIconScreenAdapter.java b/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/icon/EditorIconScreenAdapter.java
index 1472e64fcbe..f1d2108167b 100644
--- a/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/icon/EditorIconScreenAdapter.java
+++ b/OsmAnd/src/net/osmand/plus/mapcontextmenu/editors/icon/EditorIconScreenAdapter.java
@@ -19,7 +19,6 @@
 import net.osmand.plus.base.containers.ScreenItem;
 import net.osmand.plus.card.icon.IconsPaletteElements;
 import net.osmand.plus.helpers.AndroidUiHelper;
-import net.osmand.plus.helpers.RequestMapThemeParams;
 import net.osmand.plus.mapcontextmenu.editors.icon.data.IconSearchResult;
 import net.osmand.plus.mapcontextmenu.editors.icon.data.IconsCategory;
 import net.osmand.plus.settings.backend.ApplicationMode;
@@ -150,7 +149,7 @@ private View inflate(@LayoutRes int layoutResId) {
 	}
 
 	private boolean isNightMode() {
-		return app.getDaynightHelper().isNightMode(usedOnMap, new RequestMapThemeParams().setAppMode(appMode));
+		return app.getDaynightHelper().isNightMode(usedOnMap, appMode);
 	}
 
 	static class IconsCategoryViewHolder extends ViewHolder {
diff --git a/OsmAnd/src/net/osmand/plus/mapmarkers/MapMarkerSelectionFragment.java b/OsmAnd/src/net/osmand/plus/mapmarkers/MapMarkerSelectionFragment.java
index b0bdce1ccd6..363cec4ebaf 100644
--- a/OsmAnd/src/net/osmand/plus/mapmarkers/MapMarkerSelectionFragment.java
+++ b/OsmAnd/src/net/osmand/plus/mapmarkers/MapMarkerSelectionFragment.java
@@ -10,6 +10,7 @@
 import android.widget.ImageButton;
 import android.widget.ListView;
 
+import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
 import net.osmand.plus.helpers.AndroidUiHelper;
@@ -102,7 +103,7 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle sa
 	}
 
 	@Override
-	public void onSaveInstanceState(Bundle outState) {
+	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		outState.putString(POINT_TYPE_KEY, pointType.name());
 	}
diff --git a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
index ffbf9394245..f4ee0a10f12 100644
--- a/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
+++ b/OsmAnd/src/net/osmand/plus/measurementtool/MeasurementToolFragment.java
@@ -726,7 +726,7 @@ private void initMeasurementMode(GpxData gpxData, boolean addPoints) {
 					if (!points.isEmpty()) {
 						ApplicationMode snapToRoadAppMode = ApplicationMode.valueOfStringKey(points.get(points.size() - 1).getProfileType(), null);
 						if (snapToRoadAppMode != null) {
-							setAppMode(snapToRoadAppMode);
+							setupAppMode(snapToRoadAppMode);
 						}
 					}
 				}
@@ -1487,7 +1487,7 @@ public void onDragEnded(RecyclerView.ViewHolder holder) {
 		};
 	}
 
-	private void setAppMode(@NonNull ApplicationMode appMode) {
+	private void setupAppMode(@NonNull ApplicationMode appMode) {
 		editingCtx.setAppMode(appMode);
 		editingCtx.scheduleRouteCalculateIfNotEmpty();
 		updateSnapToRoadControls();
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TrackFoldersHelper.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TrackFoldersHelper.java
index 0a171f2df84..c38d276d10d 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/TrackFoldersHelper.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/TrackFoldersHelper.java
@@ -19,6 +19,7 @@
 import androidx.fragment.app.FragmentManager;
 
 import net.osmand.CallbackWithObject;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.shared.SharedUtil;
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
@@ -83,6 +84,7 @@ public class TrackFoldersHelper implements OnTrackFileMoveListener {
 	public final static String SORT_SUB_FOLDERS_KEY = "sort_sub_folders_key";
 
 	private final OsmandApplication app;
+	private final ApplicationMode appMode;
 	private final UiUtilities uiUtilities;
 	private final ImportHelper importHelper;
 	private final GpxSelectionHelper gpxSelectionHelper;
@@ -97,10 +99,12 @@ public class TrackFoldersHelper implements OnTrackFileMoveListener {
 
 	private boolean importing;
 
-	public TrackFoldersHelper(@NonNull MyPlacesActivity activity, @NonNull TrackFolder rootFolder) {
+	public TrackFoldersHelper(@NonNull MyPlacesActivity activity,
+	                          @NonNull ApplicationMode appMode, @NonNull TrackFolder rootFolder) {
 		this.activity = activity;
 		this.rootFolder = rootFolder;
 		this.app = activity.getMyApplication();
+		this.appMode = appMode;
 		this.importHelper = app.getImportHelper();
 		this.uiUtilities = app.getUIUtilities();
 		this.gpxSelectionHelper = app.getSelectedGpxHelper();
@@ -318,7 +322,7 @@ public void showItemsOptionsMenu(@NonNull View view, @Nullable TrackFolder track
 						helper.saveRouteActivity(items, routeActivity);
 						dismissFragment(fragment, false);
 					});
-					SelectRouteActivityController.showDialog(activity, routeActivitySelectionHelper);
+					SelectRouteActivityController.showDialog(activity, appMode, routeActivitySelectionHelper);
 				})
 				.create()
 		);
diff --git a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java
index d43237e2a34..c072f9b97fa 100644
--- a/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java
+++ b/OsmAnd/src/net/osmand/plus/myplaces/tracks/dialogs/AvailableTracksFragment.java
@@ -94,7 +94,7 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		setRootFolder(folder);
 		setSelectedFolder(folder);
 
-		trackFoldersHelper = new TrackFoldersHelper(requireMyActivity(), folder);
+		trackFoldersHelper = new TrackFoldersHelper(requireMyActivity(), appMode, folder);
 		trackFoldersHelper.setLoadTracksListener(getLoadTracksListener());
 
 		visibleTracksGroup = new VisibleTracksGroup(app);
diff --git a/OsmAnd/src/net/osmand/plus/onlinerouting/ui/OnlineRoutingEngineFragment.java b/OsmAnd/src/net/osmand/plus/onlinerouting/ui/OnlineRoutingEngineFragment.java
index 376b785368b..3c76a9a9a4c 100644
--- a/OsmAnd/src/net/osmand/plus/onlinerouting/ui/OnlineRoutingEngineFragment.java
+++ b/OsmAnd/src/net/osmand/plus/onlinerouting/ui/OnlineRoutingEngineFragment.java
@@ -4,7 +4,6 @@
 import static net.osmand.plus.profiles.SelectProfileBottomSheet.DERIVED_PROFILE_ARG;
 import static net.osmand.plus.profiles.SelectProfileBottomSheet.OnSelectProfileCallback;
 import static net.osmand.plus.profiles.SelectProfileBottomSheet.PROFILE_KEY_ARG;
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 
 import android.annotation.SuppressLint;
 import android.app.Activity;
@@ -68,7 +67,6 @@ public class OnlineRoutingEngineFragment extends BaseOsmAndFragment implements O
 	private static final String EXAMPLE_LOCATION_KEY = "example_location";
 	private static final String EDITED_ENGINE_KEY = "edited_engine_key";
 
-	private ApplicationMode appMode;
 	private String approxRouteProfile;
 	private String approxDerivedProfile;
 	private MapActivity mapActivity;
@@ -597,11 +595,6 @@ private void dismiss() {
 		}
 	}
 
-	@NonNull
-	private ApplicationMode getAppMode() {
-		return appMode != null ? appMode : app.getSettings().getApplicationMode();
-	}
-
 	@Nullable
 	private MapActivity getMapActivity() {
 		FragmentActivity activity = getActivity();
@@ -635,7 +628,6 @@ private void saveState(@NonNull Bundle outState) {
 		}
 		outState.putString(ENGINE_CUSTOM_VEHICLE_KEY, customVehicleKey);
 		outState.putString(EXAMPLE_LOCATION_KEY, selectedLocation.name());
-		outState.putString(APP_MODE_KEY, getAppMode().getStringKey());
 		outState.putString(EDITED_ENGINE_KEY, editedEngineKey);
 	}
 
@@ -654,7 +646,6 @@ private void restoreState(@NonNull Bundle savedState) {
 		engine = type.newInstance(params);
 		customVehicleKey = savedState.getString(ENGINE_CUSTOM_VEHICLE_KEY);
 		selectedLocation = ExampleLocation.valueOf(savedState.getString(EXAMPLE_LOCATION_KEY));
-		appMode = ApplicationMode.valueOfStringKey(savedState.getString(APP_MODE_KEY), null);
 	}
 
 	private void initState() {
@@ -690,7 +681,7 @@ public static void showInstance(@NonNull FragmentActivity activity,
 		FragmentManager fragmentManager = activity.getSupportFragmentManager();
 		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
 			OnlineRoutingEngineFragment fragment = new OnlineRoutingEngineFragment();
-			fragment.appMode = appMode;
+			fragment.setAppMode(appMode);
 			fragment.editedEngineKey = editedEngineKey;
 			fragmentManager.beginTransaction()
 					.add(R.id.fragmentContainer, fragment, TAG)
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java
index 1d55971c254..f2338bc05c8 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/MonitoringSettingsFragment.java
@@ -487,7 +487,7 @@ public boolean onPreferenceClick(Preference preference) {
 		} else if (PRESELECTED_ROUTE_ACTIVITY.equals(prefId)) {
 			MapActivity mapActivity = getMapActivity();
 			if (mapActivity != null) {
-				SelectRouteActivityController.showDialog(mapActivity, getRouteActivitySelectionHelper());
+				SelectRouteActivityController.showDialog(mapActivity, getSelectedAppMode(), getRouteActivitySelectionHelper());
 			}
 		} else if (RECORD_OBD_DATA_PROMO.equals(prefId)) {
 			MapActivity mapActivity = getMapActivity();
diff --git a/OsmAnd/src/net/osmand/plus/plugins/monitoring/VehicleMetricsRecordingFragment.java b/OsmAnd/src/net/osmand/plus/plugins/monitoring/VehicleMetricsRecordingFragment.java
index c5764ae7981..993b67b0f37 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/monitoring/VehicleMetricsRecordingFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/monitoring/VehicleMetricsRecordingFragment.java
@@ -4,7 +4,6 @@
 import static net.osmand.plus.plugins.monitoring.VehicleMetricsRecordingFragment.VehicleMetricsRecordingCategory.FUEL;
 import static net.osmand.plus.plugins.monitoring.VehicleMetricsRecordingFragment.VehicleMetricsRecordingCategory.OTHER;
 import static net.osmand.plus.plugins.monitoring.VehicleMetricsRecordingFragment.VehicleMetricsRecordingCategory.TEMPERATURE;
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 
 import android.annotation.SuppressLint;
 import android.os.Bundle;
@@ -52,6 +51,7 @@
 import java.util.ArrayList;
 import java.util.HashSet;
 import java.util.List;
+import java.util.Objects;
 import java.util.Set;
 
 public class VehicleMetricsRecordingFragment extends BaseOsmAndFragment {
@@ -59,7 +59,6 @@ public class VehicleMetricsRecordingFragment extends BaseOsmAndFragment {
 	public static final String TAG = DistanceByTapFragment.class.getSimpleName();
 	public static final String SELECTED_COMMANDS_KEY = "selected_commands_key";
 
-	public ApplicationMode selectedMode;
 	private Toolbar toolbar;
 	private ImageView navigationIcon;
 
@@ -105,10 +104,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c
 		preference = PluginsHelper.requirePlugin(VehicleMetricsPlugin.class).getTRIP_RECORDING_VEHICLE_METRICS();
 
 		if (savedInstanceState != null) {
-			selectedMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), settings.getApplicationMode());
-			selectedCommands.addAll(savedInstanceState.getStringArrayList(SELECTED_COMMANDS_KEY));
+			selectedCommands.addAll(Objects.requireNonNull(savedInstanceState.getStringArrayList(SELECTED_COMMANDS_KEY)));
 		} else {
-			List<String> commands = preference.getStringsListForProfile(selectedMode);
+			List<String> commands = preference.getStringsListForProfile(appMode);
 			if (commands != null) {
 				selectedCommands.addAll(commands);
 			}
@@ -147,7 +145,6 @@ private void setupButtons() {
 	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		outState.putStringArrayList(SELECTED_COMMANDS_KEY, new ArrayList<>(selectedCommands));
-		outState.putString(APP_MODE_KEY, selectedMode.getStringKey());
 	}
 
 	private void dismiss() {
@@ -201,7 +198,7 @@ public boolean isCommandSelected(@NonNull OBDCommand command) {
 
 	private void updateSelectAllButton() {
 		selectAllButton.setTitleId(areAllCommandsSelected() ? R.string.shared_string_deselect_all : R.string.shared_string_select_all);
-		applyButton.setEnabled(!areListsEqual(selectedCommands, preference.getStringsListForProfile(selectedMode)));
+		applyButton.setEnabled(!areListsEqual(selectedCommands, preference.getStringsListForProfile(appMode)));
 	}
 
 	private boolean areListsEqual(@NonNull Set<String> set, @Nullable List<String> list) {
@@ -280,7 +277,7 @@ public static void showInstance(@NonNull FragmentActivity activity, @Nullable Mo
 		FragmentManager manager = activity.getSupportFragmentManager();
 		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 			VehicleMetricsRecordingFragment fragment = new VehicleMetricsRecordingFragment();
-			fragment.selectedMode = selectedAppMode;
+			fragment.setAppMode(selectedAppMode);
 			fragment.setTargetFragment(monitoringSettingsFragment, 0);
 			manager.beginTransaction()
 					.add(R.id.fragmentContainer, fragment, TAG)
diff --git a/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/EditPoiDialogFragment.java b/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/EditPoiDialogFragment.java
index 070daea625c..9adeb90cf84 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/EditPoiDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/osmedit/dialogs/EditPoiDialogFragment.java
@@ -339,7 +339,7 @@ public boolean onKey(DialogInterface dialog, int keyCode, KeyEvent event) {
 	}
 
 	@Override
-	public void onSaveInstanceState(Bundle outState) {
+	public void onSaveInstanceState(@NonNull Bundle outState) {
 		outState.putSerializable(TAGS_LIST, (Serializable) new LinkedHashMap<>(editPoiData.getTagValues()));
 		super.onSaveInstanceState(outState);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersPromoFragment.java b/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersPromoFragment.java
index 4e3c4bd4079..6131ca27a2e 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersPromoFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/MappersPromoFragment.java
@@ -24,6 +24,7 @@
 import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.plugins.osmedit.oauth.OsmOAuthHelper;
 import net.osmand.plus.plugins.osmedit.oauth.OsmOAuthHelper.OsmAuthorizationListener;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
@@ -39,10 +40,12 @@ public class MappersPromoFragment extends BasePurchaseDialogFragment {
 	private LinearLayout listContainer;
 	private final List<OsmAndFeature> allFeatures = new ArrayList<>();
 
-	public static void showInstance(@NonNull FragmentActivity activity, @Nullable Fragment target) {
+	public static void showInstance(@NonNull FragmentActivity activity,
+	                                @NonNull ApplicationMode appMode, @Nullable Fragment target) {
 		FragmentManager manager = activity.getSupportFragmentManager();
 		if (!manager.isStateSaved() && manager.findFragmentByTag(TAG) == null) {
 			MappersPromoFragment fragment = new MappersPromoFragment();
+			fragment.setAppMode(appMode);
 			fragment.setTargetFragment(target, 0);
 			fragment.show(activity.getSupportFragmentManager(), TAG);
 		}
diff --git a/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/OsmEditingFragment.java b/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/OsmEditingFragment.java
index d2c00e0319b..81183b58818 100644
--- a/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/OsmEditingFragment.java
+++ b/OsmAnd/src/net/osmand/plus/plugins/osmedit/fragments/OsmEditingFragment.java
@@ -234,7 +234,7 @@ public boolean onPreferenceClick(Preference preference) {
 			FragmentActivity activity = getActivity();
 			if (activity != null) {
 				if (!isValidToken() && !isLoginExists()) {
-					MappersPromoFragment.showInstance(activity, this);
+					MappersPromoFragment.showInstance(activity, getSelectedAppMode(), this);
 				} else {
 					MappersFragment.showInstance(activity);
 				}
diff --git a/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java b/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java
index 925e436b3d3..99752e59a3d 100644
--- a/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/profiles/SelectAppModesBottomSheetDialogFragment.java
@@ -1,7 +1,5 @@
 package net.osmand.plus.profiles;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
-
 import android.os.Bundle;
 
 import androidx.annotation.NonNull;
@@ -11,7 +9,6 @@
 
 import net.osmand.PlatformUtil;
 import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.R;
 
@@ -29,20 +26,14 @@ public class SelectAppModesBottomSheetDialogFragment extends AppModesBottomSheet
 	private static final Log LOG = PlatformUtil.getLog(SelectAppModesBottomSheetDialogFragment.class);
 
 	private List<ApplicationMode> activeModes = new ArrayList<>();
-	private ApplicationMode appMode;
 	private boolean appModeChangeable;
 
 	@Override
 	public void onCreate(Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		if (savedInstanceState != null) {
-			appMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), null);
 			appModeChangeable = savedInstanceState.getBoolean(APP_MODE_CHANGEABLE_KEY);
 		}
-		OsmandApplication app = requiredMyApplication();
-		if (appMode == null) {
-			appMode = app.getSettings().getApplicationMode();
-		}
 	}
 
 	@Override
@@ -53,14 +44,6 @@ public void onResume() {
 		setupHeightAndBackground(getView());
 	}
 
-	public ApplicationMode getAppMode() {
-		return appMode;
-	}
-
-	public void setAppMode(ApplicationMode appMode) {
-		this.appMode = appMode;
-	}
-
 	public boolean isAppModeChangeable() {
 		return appModeChangeable;
 	}
@@ -103,21 +86,9 @@ public void onProfilePressed(ApplicationMode appMode) {
 	@Override
 	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
-		if (appMode != null) {
-			outState.putString(APP_MODE_KEY, appMode.getStringKey());
-		}
 		outState.putBoolean(APP_MODE_CHANGEABLE_KEY, appModeChangeable);
 	}
 
-	@Override
-	public boolean isNightMode(@NonNull OsmandApplication app) {
-		if (usedOnMap) {
-			return app.getDaynightHelper().isNightModeForMapControlsForProfile(getAppMode());
-		} else {
-			return !app.getSettings().isLightContentForMode(getAppMode());
-		}
-	}
-
 	public static void showInstance(@NonNull FragmentManager fm, Fragment target, boolean usedOnMap,
 									@Nullable ApplicationMode appMode, boolean appModeChangeable) {
 		try {
diff --git a/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java b/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java
index bf94ca070cf..52f3b5e93ab 100644
--- a/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java
+++ b/OsmAnd/src/net/osmand/plus/routepreparationmenu/cards/BaseCard.java
@@ -19,7 +19,8 @@
 import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.R;
 import net.osmand.plus.helpers.AndroidUiHelper;
-import net.osmand.plus.helpers.RequestMapThemeParams;
+import net.osmand.plus.helpers.RequestThemeParams;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.utils.ColorUtilities;
 import net.osmand.plus.utils.UiUtilities;
@@ -28,6 +29,7 @@
 public abstract class BaseCard {
 
 	protected final OsmandApplication app;
+	protected final ApplicationMode appMode;
 	protected final OsmandSettings settings;
 	protected final FragmentActivity activity;
 
@@ -59,12 +61,17 @@ public BaseCard(@NonNull FragmentActivity activity) {
 	}
 
 	public BaseCard(@NonNull FragmentActivity activity, boolean usedOnMap) {
+		this(activity, null, usedOnMap);
+	}
+
+	public BaseCard(@NonNull FragmentActivity activity, @Nullable ApplicationMode appMode, boolean usedOnMap) {
 		this.activity = activity;
 		this.app = (OsmandApplication) activity.getApplicationContext();
 		this.settings = app.getSettings();
 		this.usedOnMap = usedOnMap;
-		RequestMapThemeParams requestMapThemeParams = new RequestMapThemeParams().markIgnoreExternalProvider();
-		nightMode = app.getDaynightHelper().isNightMode(usedOnMap, requestMapThemeParams);
+		this.appMode = appMode != null ? appMode : settings.getApplicationMode();
+		RequestThemeParams requestThemeParams = new RequestThemeParams(appMode, true);
+		nightMode = app.getDaynightHelper().isNightMode(usedOnMap, requestThemeParams);
 	}
 
 	public abstract int getCardLayoutId();
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BasePreferenceBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BasePreferenceBottomSheet.java
index 528015535b1..675f2502ae9 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BasePreferenceBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/BasePreferenceBottomSheet.java
@@ -1,7 +1,5 @@
 package net.osmand.plus.settings.bottomsheets;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
-
 import android.os.Bundle;
 
 import androidx.annotation.NonNull;
@@ -10,8 +8,6 @@
 import androidx.preference.DialogPreference.TargetFragment;
 import androidx.preference.Preference;
 
-import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.OsmandApplication;
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.settings.fragments.ApplyQueryType;
 
@@ -25,22 +21,12 @@ public abstract class BasePreferenceBottomSheet extends MenuBottomSheetDialogFra
 
 	private String prefId;
 	private Preference preference;
-	private ApplicationMode appMode;
 	private boolean profileDependent;
 	private ApplyQueryType applyQueryType;
 
-	public void setAppMode(ApplicationMode appMode) {
-		this.appMode = appMode;
-	}
-
-	public ApplicationMode getAppMode() {
-		return appMode != null ? appMode : requiredMyApplication().getSettings().getApplicationMode();
-	}
-
 	@Override
 	public void onCreate(Bundle savedInstanceState) {
 		if (savedInstanceState != null) {
-			appMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), null);
 			applyQueryType = ApplyQueryType.valueOf(savedInstanceState.getString(APPLY_QUERY_TYPE));
 			profileDependent = savedInstanceState.getBoolean(PROFILE_DEPENDENT, false);
 		}
@@ -51,22 +37,10 @@ public void onCreate(Bundle savedInstanceState) {
 	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		outState.putBoolean(PROFILE_DEPENDENT, profileDependent);
-		if (appMode != null) {
-			outState.putString(APP_MODE_KEY, appMode.getStringKey());
-		}
 		outState.putString(APPLY_QUERY_TYPE, applyQueryType != null ?
 				applyQueryType.name() : ApplyQueryType.NONE.name());
 	}
 
-	@Override
-	public boolean isNightMode(@NonNull OsmandApplication app) {
-		if (usedOnMap) {
-			return app.getDaynightHelper().isNightModeForMapControlsForProfile(getAppMode());
-		} else {
-			return !app.getSettings().isLightContentForMode(getAppMode());
-		}
-	}
-
 	public String getPrefId() {
 		if (prefId == null) {
 			Bundle args = getArguments();
@@ -97,8 +71,7 @@ public boolean shouldDismissOnChange() {
 	public static BasePreferenceBottomSheet findPreferenceBottomSheet(@NonNull FragmentManager manager, @NonNull String prefId) {
 		List<Fragment> fragments = manager.getFragments();
 		for (Fragment fragment : fragments) {
-			if (fragment instanceof BasePreferenceBottomSheet) {
-				BasePreferenceBottomSheet bottomSheet = (BasePreferenceBottomSheet) fragment;
+			if (fragment instanceof BasePreferenceBottomSheet bottomSheet) {
 				if (prefId.equals(bottomSheet.getPrefId())) {
 					return bottomSheet;
 				}
diff --git a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/CustomizableSingleSelectionBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/CustomizableSingleSelectionBottomSheet.java
index c29ba4a3831..9eb593413be 100644
--- a/OsmAnd/src/net/osmand/plus/settings/bottomsheets/CustomizableSingleSelectionBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/settings/bottomsheets/CustomizableSingleSelectionBottomSheet.java
@@ -9,6 +9,7 @@
 import android.os.Bundle;
 
 import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import androidx.fragment.app.FragmentManager;
 
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
@@ -18,6 +19,7 @@
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.LongDescriptionItem;
 import net.osmand.plus.base.bottomsheetmenu.simpleitems.TitleItem;
 import net.osmand.plus.base.dialog.data.DisplayItem;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.utils.UiUtilities;
 
 import java.util.List;
@@ -88,13 +90,14 @@ protected boolean hideButtonsContainer() {
 		return show == null || !show;
 	}
 
-	public static boolean showInstance(@NonNull FragmentManager fragmentManager,
-	                                   @NonNull String processId, boolean usedOnMap) {
+	public static boolean showInstance(@NonNull FragmentManager manager, @NonNull String processId,
+	                                   @Nullable ApplicationMode appMode, boolean usedOnMap) {
 		try {
 			CustomizableSingleSelectionBottomSheet fragment = new CustomizableSingleSelectionBottomSheet();
 			fragment.setProcessId(processId);
+			fragment.setAppMode(appMode);
 			fragment.setUsedOnMap(usedOnMap);
-			fragment.show(fragmentManager, TAG);
+			fragment.show(manager, TAG);
 			return true;
 		} catch (RuntimeException e) {
 			return false;
diff --git a/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeWidgetDialogController.java b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeWidgetDialogController.java
index de9bd9cc512..ae6c3b04249 100644
--- a/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeWidgetDialogController.java
+++ b/OsmAnd/src/net/osmand/plus/settings/controllers/CompassModeWidgetDialogController.java
@@ -40,6 +40,6 @@ public static void showDialog(@NonNull MapActivity mapActivity) {
 		dialogManager.register(PROCESS_ID, controller);
 
 		FragmentManager manager = mapActivity.getSupportFragmentManager();
-		CustomizableSingleSelectionBottomSheet.showInstance(manager, PROCESS_ID, true);
+		CustomizableSingleSelectionBottomSheet.showInstance(manager, PROCESS_ID, null, true);
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/settings/controllers/MapFocusDialogController.java b/OsmAnd/src/net/osmand/plus/settings/controllers/MapFocusDialogController.java
index 8a4d8c6501b..fb250fc4b83 100644
--- a/OsmAnd/src/net/osmand/plus/settings/controllers/MapFocusDialogController.java
+++ b/OsmAnd/src/net/osmand/plus/settings/controllers/MapFocusDialogController.java
@@ -97,6 +97,6 @@ public static void showDialog(@NonNull MapActivity mapActivity, @NonNull Applica
 		dialogManager.register(PROCESS_ID, controller);
 
 		FragmentManager manager = mapActivity.getSupportFragmentManager();
-		CustomizableSingleSelectionBottomSheet.showInstance(manager, PROCESS_ID, true);
+		CustomizableSingleSelectionBottomSheet.showInstance(manager, PROCESS_ID, appMode, true);
 	}
 }
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java
index 2dad20b4368..14696561e37 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/BaseSettingsFragment.java
@@ -102,18 +102,24 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		app = requireMyApplication();
 		settings = app.getSettings();
 		appCustomization = app.getAppCustomization();
-		Bundle args = getArguments();
+		restoreAppMode(savedInstanceState);
+		super.onCreate(savedInstanceState);
+		currentScreenType = getCurrentScreenType();
+	}
+
+	private void restoreAppMode(@Nullable Bundle savedInstanceState) {
 		if (savedInstanceState != null) {
-			appMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), null);
+			String modeKey = savedInstanceState.getString(APP_MODE_KEY);
+			appMode = ApplicationMode.valueOfStringKey(modeKey, null);
 		}
+		Bundle args = getArguments();
 		if (appMode == null && args != null) {
-			appMode = ApplicationMode.valueOfStringKey(args.getString(APP_MODE_KEY), null);
+			String modeKey = args.getString(APP_MODE_KEY);
+			appMode = ApplicationMode.valueOfStringKey(modeKey, null);
 		}
 		if (appMode == null) {
 			appMode = settings.getApplicationMode();
 		}
-		super.onCreate(savedInstanceState);
-		currentScreenType = getCurrentScreenType();
 	}
 
 	@Override
@@ -800,8 +806,9 @@ protected void showSingleSelectionDialog(@NonNull String processId,
 		if (activity != null) {
 			DialogManager dialogManager = app.getDialogManager();
 			dialogManager.register(processId, controller);
+			ApplicationMode appMode = getSelectedAppMode();
 			FragmentManager fm = activity.getSupportFragmentManager();
-			CustomizableSingleSelectionBottomSheet.showInstance(fm, processId, false);
+			CustomizableSingleSelectionBottomSheet.showInstance(fm, processId, appMode, false);
 		}
 	}
 
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/DetailedTrackGuidanceFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/DetailedTrackGuidanceFragment.java
index cf93aaa94ba..9867ba60437 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/DetailedTrackGuidanceFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/DetailedTrackGuidanceFragment.java
@@ -43,9 +43,6 @@ public class DetailedTrackGuidanceFragment extends BaseOsmAndFragment {
 	private static final String TAG = DetailedTrackGuidanceFragment.class.getSimpleName();
 	private static final String DETAILED_TRACK_GUIDANCE_KEY = "detailed_track_guidance_key";
 	private static final String THRESHOLD_DISTANCE_KEY = "threshold_distance_key";
-	private static final String SELECTED_APP_MODE_KEY = "selected_app_mode_key";
-
-	private ApplicationMode selectedAppMode;
 
 	private View sliderView;
 	private TextView sliderTv;
@@ -58,10 +55,8 @@ public class DetailedTrackGuidanceFragment extends BaseOsmAndFragment {
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-		setupAppMode(savedInstanceState);
-
-		int distance = settings.GPX_APPROXIMATION_DISTANCE.getModeValue(selectedAppMode);
-		TrackApproximationType type = settings.DETAILED_TRACK_GUIDANCE.getModeValue(selectedAppMode);
+		int distance = settings.GPX_APPROXIMATION_DISTANCE.getModeValue(appMode);
+		TrackApproximationType type = settings.DETAILED_TRACK_GUIDANCE.getModeValue(appMode);
 		if (savedInstanceState != null) {
 			changedTrackGuidance = TrackApproximationType.values()[savedInstanceState.getInt(DETAILED_TRACK_GUIDANCE_KEY, type.ordinal())];
 			changedThresholdDistance = savedInstanceState.getInt(THRESHOLD_DISTANCE_KEY, distance);
@@ -71,15 +66,6 @@ public void onCreate(@Nullable Bundle savedInstanceState) {
 		}
 	}
 
-	private void setupAppMode(@Nullable Bundle savedInstanceState) {
-		if (selectedAppMode == null && savedInstanceState != null) {
-			selectedAppMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(SELECTED_APP_MODE_KEY), null);
-		}
-		if (selectedAppMode == null) {
-			selectedAppMode = settings.getApplicationMode();
-		}
-	}
-
 	@Nullable
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,
@@ -101,7 +87,6 @@ public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		outState.putInt(DETAILED_TRACK_GUIDANCE_KEY, changedTrackGuidance.ordinal());
 		outState.putInt(THRESHOLD_DISTANCE_KEY, changedThresholdDistance);
-		outState.putString(SELECTED_APP_MODE_KEY, selectedAppMode.getStringKey());
 	}
 
 	private void setupToolbar(@NonNull View view) {
@@ -125,8 +110,8 @@ private void setupApplyButton(@NonNull View view) {
 
 		applyButton.setOnClickListener(v -> {
 			if (isParametersChanged()) {
-				settings.DETAILED_TRACK_GUIDANCE.setModeValue(selectedAppMode, changedTrackGuidance);
-				settings.GPX_APPROXIMATION_DISTANCE.setModeValue(selectedAppMode, changedThresholdDistance);
+				settings.DETAILED_TRACK_GUIDANCE.setModeValue(appMode, changedTrackGuidance);
+				settings.GPX_APPROXIMATION_DISTANCE.setModeValue(appMode, changedThresholdDistance);
 				Fragment fragment = getTargetFragment();
 				if (fragment instanceof NavigationFragment) {
 					((NavigationFragment) fragment).showTrackGuidancePref();
@@ -212,8 +197,8 @@ private void updateApplyButton() {
 	}
 
 	private boolean isParametersChanged() {
-		return settings.GPX_APPROXIMATION_DISTANCE.getModeValue(selectedAppMode) != changedThresholdDistance
-				|| settings.DETAILED_TRACK_GUIDANCE.getModeValue(selectedAppMode) != changedTrackGuidance;
+		return settings.GPX_APPROXIMATION_DISTANCE.getModeValue(appMode) != changedThresholdDistance
+				|| settings.DETAILED_TRACK_GUIDANCE.getModeValue(appMode) != changedTrackGuidance;
 	}
 
 	private void setupRadioButton(@NonNull View button, @StringRes int titleId, boolean selected, boolean showDivider, @NonNull View.OnClickListener listener) {
@@ -261,11 +246,12 @@ private MapActivity getMapActivity() {
 		return (MapActivity) getActivity();
 	}
 
-	public static void showInstance(@NonNull FragmentActivity activity, @NonNull ApplicationMode mode, NavigationFragment navigationFragment) {
+	public static void showInstance(@NonNull FragmentActivity activity, @NonNull ApplicationMode mode,
+	                                @NonNull NavigationFragment navigationFragment) {
 		FragmentManager manager = activity.getSupportFragmentManager();
 		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 			DetailedTrackGuidanceFragment fragment = new DetailedTrackGuidanceFragment();
-			fragment.selectedAppMode = mode;
+			fragment.setAppMode(mode);
 			fragment.setTargetFragment(navigationFragment, 0);
 			manager.beginTransaction()
 					.add(R.id.fragmentContainer, fragment, TAG)
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsFragment.java
index 59ddd641cc0..994fecaafd5 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportSettingsFragment.java
@@ -1,7 +1,6 @@
 package net.osmand.plus.settings.fragments;
 
 import static net.osmand.plus.settings.backend.backup.exporttype.ExportType.MAP_SOURCES;
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 
 import android.app.ProgressDialog;
 import android.content.Context;
@@ -65,7 +64,6 @@ public class ExportSettingsFragment extends BaseSettingsListFragment {
 	private static final SimpleDateFormat DATE_FORMAT = new SimpleDateFormat("yyyy-MM-dd", Locale.US);
 
 	private ProgressDialog progress;
-	private ApplicationMode appMode;
 	private SettingsExportListener exportListener;
 
 	private int progressMax;
@@ -78,7 +76,6 @@ public class ExportSettingsFragment extends BaseSettingsListFragment {
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		if (savedInstanceState != null) {
-			appMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), null);
 			globalExport = savedInstanceState.getBoolean(GLOBAL_EXPORT_KEY);
 			exportingStarted = savedInstanceState.getBoolean(EXPORTING_STARTED_KEY);
 			exportStartTime = savedInstanceState.getLong(EXPORT_START_TIME_KEY);
@@ -163,7 +160,6 @@ public void onSaveInstanceState(@NonNull Bundle outState) {
 		outState.putBoolean(GLOBAL_EXPORT_KEY, globalExport);
 		outState.putBoolean(EXPORTING_STARTED_KEY, exportingStarted);
 		outState.putLong(EXPORT_START_TIME_KEY, exportStartTime);
-		outState.putString(APP_MODE_KEY, appMode.getStringKey());
 		if (progress != null) {
 			outState.putInt(PROGRESS_MAX_KEY, progress.getMax());
 			outState.putInt(PROGRESS_VALUE_KEY, progress.getProgress());
@@ -337,7 +333,7 @@ public static void showInstance(@NonNull FragmentManager manager, @NonNull Appli
 	                                @Nullable HashMap<ExportType, List<?>> selectedTypes, boolean globalExport) {
 		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 			ExportSettingsFragment fragment = new ExportSettingsFragment();
-			fragment.appMode = appMode;
+			fragment.setAppMode(appMode);
 			fragment.globalExport = globalExport;
 
 			if (!Algorithms.isEmpty(selectedTypes)) {
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/GlobalSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/GlobalSettingsFragment.java
index fe53510d628..685a2f7985c 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/GlobalSettingsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/GlobalSettingsFragment.java
@@ -179,7 +179,7 @@ public boolean onPreferenceClick(Preference preference) {
 		} else if (settings.SPEED_CAMERAS_UNINSTALLED.getId().equals(prefId) && !settings.SPEED_CAMERAS_UNINSTALLED.get()) {
 			FragmentManager manager = getFragmentManager();
 			if (manager != null) {
-				SpeedCamerasBottomSheet.showInstance(manager, this);
+				SpeedCamerasBottomSheet.showInstance(manager, this, getSelectedAppMode(), false);
 			}
 		} else if (prefId.equals(settings.LOCATION_SOURCE.getId())) {
 			FragmentManager manager = getFragmentManager();
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ProfileOptionsDialogController.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ProfileOptionsDialogController.java
index 7285b92ce1e..35694170d12 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ProfileOptionsDialogController.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ProfileOptionsDialogController.java
@@ -19,6 +19,7 @@
 import net.osmand.plus.base.dialog.data.DisplayItem;
 import net.osmand.plus.base.dialog.interfaces.controller.IDialogItemSelected;
 import net.osmand.plus.base.dialog.interfaces.controller.IDisplayDataProvider;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.backend.preferences.CommonPreference;
 import net.osmand.plus.settings.bottomsheets.CustomizableSingleSelectionBottomSheet;
 import net.osmand.plus.settings.enums.MarkerDisplayOption;
@@ -79,7 +80,9 @@ public String getProcessId() {
 		return PROCESS_ID;
 	}
 
-	public void showDialog(@NonNull MapActivity mapActivity, @NonNull String title, @NonNull String description, @NonNull CommonPreference<MarkerDisplayOption> preference) {
+	public void showDialog(@NonNull MapActivity mapActivity, @NonNull ApplicationMode appMode,
+	                       @NonNull String title, @NonNull String description,
+	                       @NonNull CommonPreference<MarkerDisplayOption> preference) {
 		this.title = title;
 		this.description = description;
 		this.preference = preference;
@@ -88,7 +91,7 @@ public void showDialog(@NonNull MapActivity mapActivity, @NonNull String title,
 		dialogManager.register(PROCESS_ID, this);
 
 		FragmentManager manager = mapActivity.getSupportFragmentManager();
-		CustomizableSingleSelectionBottomSheet.showInstance(manager, PROCESS_ID, true);
+		CustomizableSingleSelectionBottomSheet.showInstance(manager, PROCESS_ID, appMode, true);
 	}
 }
 
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/RouteLineAppearanceFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/RouteLineAppearanceFragment.java
index 13870295c7d..20040e39272 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/RouteLineAppearanceFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/RouteLineAppearanceFragment.java
@@ -1,6 +1,5 @@
 package net.osmand.plus.settings.fragments;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 import static net.osmand.util.Algorithms.objectEquals;
 
 import android.graphics.Rect;
@@ -59,8 +58,6 @@ public class RouteLineAppearanceFragment extends ContextMenuScrollFragment
 
 	private PreviewRouteLineInfo previewRouteLineInfo;
 
-	private ApplicationMode appMode;
-
 	private int toolbarHeightPx;
 	private String currentHeaderSourceId;
 
@@ -117,7 +114,6 @@ public boolean shouldShowMapControls(int menuState) {
 	@Override
 	public void onCreate(@Nullable Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
-		setupAppMode(savedInstanceState);
 		toolbarHeightPx = getResources().getDimensionPixelSize(R.dimen.dashboard_map_toolbar);
 
 		if (savedInstanceState != null) {
@@ -133,15 +129,6 @@ public void handleOnBackPressed() {
 		});
 	}
 
-	private void setupAppMode(@Nullable Bundle savedInstanceState) {
-		if (appMode == null && savedInstanceState != null) {
-			appMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), null);
-		}
-		if (appMode == null) {
-			appMode = settings.getApplicationMode();
-		}
-	}
-
 	private PreviewRouteLineInfo createPreviewRouteLineInfo() {
 		int colorDay = settings.CUSTOM_ROUTE_COLOR_DAY.getModeValue(appMode);
 		int colorNight = settings.CUSTOM_ROUTE_COLOR_NIGHT.getModeValue(appMode);
@@ -456,7 +443,6 @@ private void setDrawInfoOnRouteLayer(@Nullable PreviewRouteLineInfo drawInfo) {
 	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		previewRouteLineInfo.saveToBundle(outState);
-		outState.putString(APP_MODE_KEY, appMode.getStringKey());
 	}
 
 	@Override
@@ -589,7 +575,7 @@ public void onItemPurchased(String sku, boolean active) {
 	}
 
 	public static boolean showInstance(@NonNull MapActivity mapActivity,
-	                                   @Nullable ApplicationMode appMode) {
+	                                   @NonNull ApplicationMode appMode) {
 		FragmentManager fragmentManager = mapActivity.getSupportFragmentManager();
 		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
 			MapRouteInfoMenu mapRouteInfoMenu = mapActivity.getMapRouteInfoMenu();
@@ -598,7 +584,7 @@ public static boolean showInstance(@NonNull MapActivity mapActivity,
 			}
 
 			RouteLineAppearanceFragment fragment = new RouteLineAppearanceFragment();
-			fragment.appMode = appMode;
+			fragment.setAppMode(appMode);
 
 			fragmentManager.beginTransaction()
 					.replace(R.id.fragmentContainer, fragment, TAG)
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ScreenAlertsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ScreenAlertsFragment.java
index df91a7fa67a..36814b5dccf 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ScreenAlertsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ScreenAlertsFragment.java
@@ -138,7 +138,7 @@ public boolean onPreferenceClick(Preference preference) {
 		updatePreference(findPreference(SCREEN_ALERTS_IMAGE));
 
 		if (settings.SPEED_CAMERAS_UNINSTALLED.getId().equals(preference.getKey())) {
-			SpeedCamerasBottomSheet.showInstance(requireActivity().getSupportFragmentManager(), this);
+			SpeedCamerasBottomSheet.showInstance(requireActivity().getSupportFragmentManager(), this, getSelectedAppMode(), false);
 		}
 		return super.onPreferenceClick(preference);
 	}
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuItemsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuItemsFragment.java
index 0d140a1c640..925b9728785 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuItemsFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuItemsFragment.java
@@ -1,6 +1,5 @@
 package net.osmand.plus.settings.fragments.configureitems;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 import static net.osmand.plus.settings.fragments.configureitems.RearrangeItemsHelper.SCREEN_TYPE_KEY;
 import static net.osmand.plus.widgets.dialogbutton.DialogButtonType.PRIMARY;
 import static net.osmand.plus.widgets.dialogbutton.DialogButtonType.SECONDARY;
@@ -88,6 +87,7 @@ public void handleOnBackPressed() {
 	@Nullable
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+		updateNightMode();
 		View view = themedInflater.inflate(R.layout.edit_arrangement_list_fragment, container, false);
 		AndroidUtils.addStatusBarPadding21v(requireMyActivity(), view);
 
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuRootFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuRootFragment.java
index edaeb60b0e6..c7706a8ab50 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuRootFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/configureitems/ConfigureMenuRootFragment.java
@@ -1,7 +1,5 @@
 package net.osmand.plus.settings.fragments.configureitems;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
-
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -34,8 +32,6 @@ public class ConfigureMenuRootFragment extends BaseOsmAndFragment {
 
 	public static final String TAG = ConfigureMenuRootFragment.class.getName();
 
-	private ApplicationMode appMode;
-
 	@Override
 	public int getStatusBarColorId() {
 		AndroidUiHelper.setStatusBarContentColor(getView(), nightMode);
@@ -46,22 +42,10 @@ public boolean getContentStatusBarNightMode() {
 		return nightMode;
 	}
 
-	@Override
-	public void onCreate(Bundle savedInstanceState) {
-		super.onCreate(savedInstanceState);
-
-		if (savedInstanceState != null) {
-			appMode = ApplicationMode.valueOfStringKey(savedInstanceState.getString(APP_MODE_KEY), null);
-		}
-		if (appMode == null) {
-			appMode = settings.getApplicationMode();
-		}
-		nightMode = !settings.isLightContentForMode(appMode);
-	}
-
 	@Nullable
 	@Override
 	public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
+		updateNightMode();
 		View view = themedInflater.inflate(R.layout.fragment_ui_customization, container, false);
 		AndroidUtils.addStatusBarPadding21v(requireActivity(), view);
 
@@ -131,16 +115,10 @@ public void onStop() {
 		}
 	}
 
-	@Override
-	public void onSaveInstanceState(@NonNull Bundle outState) {
-		super.onSaveInstanceState(outState);
-		outState.putString(APP_MODE_KEY, appMode.getStringKey());
-	}
-
 	public static void showInstance(@NonNull FragmentManager manager, @NonNull ApplicationMode appMode, @Nullable Fragment target) {
 		if (AndroidUtils.isFragmentCanBeAdded(manager, TAG)) {
 			ConfigureMenuRootFragment fragment = new ConfigureMenuRootFragment();
-			fragment.appMode = appMode;
+			fragment.setAppMode(appMode);
 			fragment.setTargetFragment(target, 0);
 
 			manager.beginTransaction()
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/profileappearance/ProfileAppearanceFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/profileappearance/ProfileAppearanceFragment.java
index 3f18d5de162..4dbc92b0635 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/profileappearance/ProfileAppearanceFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/profileappearance/ProfileAppearanceFragment.java
@@ -38,6 +38,7 @@
 import net.osmand.plus.card.icon.IconsPaletteCard;
 import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.routepreparationmenu.cards.BaseCard;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.fragments.BaseSettingsFragment;
 import net.osmand.plus.settings.fragments.ProfileOptionsDialogController;
 import net.osmand.plus.settings.fragments.SettingsScreenType;
@@ -178,6 +179,7 @@ protected void onBindPreferenceViewHolder(@NonNull Preference preference, @NonNu
 		if (activity == null) {
 			return;
 		}
+		ApplicationMode appMode = getSelectedAppMode();
 		String key = preference.getKey();
 		if (PROFILE_NAME.equals(preference.getKey())) {
 			profileName = (EditText) holder.findViewById(R.id.profile_name_et);
@@ -211,13 +213,13 @@ public void afterTextChanged(Editable s) {
 			profileNameOtfb = (OsmandTextFieldBoxes) holder.findViewById(R.id.profile_name_otfb);
 			updateProfileNameAppearance();
 		} else if (COLORS_CARD.equals(key)) {
-			bindCard(holder, new ColorsPaletteCard(activity, screenController.getColorsCardController()));
+			bindCard(holder, new ColorsPaletteCard(activity, screenController.getColorsCardController(), appMode, false));
 		} else if (PROFILE_ICON_CARD.equals(key)) {
-			bindCard(holder, new IconsPaletteCard<>(activity, screenController.getProfileIconCardController(), false));
+			bindCard(holder, new IconsPaletteCard<>(activity, screenController.getProfileIconCardController(), appMode, false));
 		} else if (RESTING_POSITION_ICON_CARD.equals(key)) {
-			bindCard(holder, new IconsPaletteCard<>(activity, screenController.getRestingIconCardController(), false));
+			bindCard(holder, new IconsPaletteCard<>(activity, screenController.getRestingIconCardController(), appMode, false));
 		} else if (NAVIGATION_POSITION_ICON_CARD.equals(key)) {
-			bindCard(holder, new IconsPaletteCard<>(activity, screenController.getNavigationIconCardController(), false));
+			bindCard(holder, new IconsPaletteCard<>(activity, screenController.getNavigationIconCardController(), appMode, false));
 		} else if (OPTIONS_CARD.equals(key)) {
 			ViewGroup container = (ViewGroup) holder.itemView;
 			container.removeAllViews();
@@ -228,12 +230,13 @@ public void afterTextChanged(Editable s) {
 	public boolean onPreferenceClick(Preference preference) {
 		MapActivity mapActivity = getMapActivity();
 		if (mapActivity != null) {
+			ApplicationMode appMode = getSelectedAppMode();
 			ProfileOptionsDialogController optionsDialogController = screenController.getProfileOptionController();
 			if (settings.VIEW_ANGLE_VISIBILITY.getId().equals(preference.getKey())) {
-				optionsDialogController.showDialog(mapActivity, app.getString(R.string.view_angle),
+				optionsDialogController.showDialog(mapActivity, appMode, app.getString(R.string.view_angle),
 						app.getString(R.string.view_angle_description), settings.VIEW_ANGLE_VISIBILITY);
 			} else if (settings.LOCATION_RADIUS_VISIBILITY.getId().equals(preference.getKey())) {
-				optionsDialogController.showDialog(mapActivity, app.getString(R.string.location_radius),
+				optionsDialogController.showDialog(mapActivity, appMode, app.getString(R.string.location_radius),
 						app.getString(R.string.location_radius_description), settings.LOCATION_RADIUS_VISIBILITY);
 			}
 		}
diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/voice/VoiceAnnouncesFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/voice/VoiceAnnouncesFragment.java
index 0e834b84c42..37663965b11 100644
--- a/OsmAnd/src/net/osmand/plus/settings/fragments/voice/VoiceAnnouncesFragment.java
+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/voice/VoiceAnnouncesFragment.java
@@ -237,10 +237,10 @@ public void onApplyPreferenceChange(String prefId, boolean applyToAllProfiles, O
 	@Override
 	public boolean onPreferenceClick(Preference preference) {
 		String prefId = preference.getKey();
+		ApplicationMode mode = getSelectedAppMode();
 		if (settings.SPEED_CAMERAS_UNINSTALLED.getId().equals(prefId)) {
-			SpeedCamerasBottomSheet.showInstance(requireFragmentManager(), this);
+			SpeedCamerasBottomSheet.showInstance(requireFragmentManager(), this, mode, false);
 		} else if (settings.SPEED_LIMIT_EXCEED_KMH.getId().equals(prefId)) {
-			ApplicationMode mode = getSelectedAppMode();
 			SpeedLimitBottomSheet.showInstance(requireFragmentManager(), this, prefId, mode);
 		}
 		return super.onPreferenceClick(preference);
diff --git a/OsmAnd/src/net/osmand/plus/track/cards/TrackTagsInfoCard.java b/OsmAnd/src/net/osmand/plus/track/cards/TrackTagsInfoCard.java
index 7db7b6e57b9..6df11a2ae07 100644
--- a/OsmAnd/src/net/osmand/plus/track/cards/TrackTagsInfoCard.java
+++ b/OsmAnd/src/net/osmand/plus/track/cards/TrackTagsInfoCard.java
@@ -104,7 +104,7 @@ public void updateContent() {
 				: app.getString(R.string.shared_string_none);
 		Drawable icon = getContentIcon(AndroidUtils.getActivityIconId(app, routeActivity));
 		createItemRow(getString(R.string.shared_string_activity), label, icon).setOnClickListener(
-				v -> SelectRouteActivityController.showDialog(activity, activityHelper)
+				v -> SelectRouteActivityController.showDialog(activity, appMode, activityHelper)
 		);
 
 		String keywords = metadata != null ? metadata.getKeywords() : null;
diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/SelectRouteActivityFragment.java b/OsmAnd/src/net/osmand/plus/track/fragments/SelectRouteActivityFragment.java
index 6ae062ea909..3d48cb570e5 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/SelectRouteActivityFragment.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/SelectRouteActivityFragment.java
@@ -25,6 +25,7 @@
 
 import net.osmand.plus.R;
 import net.osmand.plus.helpers.AndroidUiHelper;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.plus.settings.fragments.customizable.CustomizableSingleSelectionDialogFragment;
 import net.osmand.plus.track.fragments.controller.SelectRouteActivityController;
 import net.osmand.plus.utils.AndroidUtils;
@@ -170,10 +171,11 @@ protected int getLayoutId() {
 	}
 
 	public static boolean showInstance(@NonNull FragmentManager fragmentManager,
-	                                   @NonNull String processId) {
+	                                   @NonNull ApplicationMode appMode, @NonNull String processId) {
 		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
 			SelectRouteActivityFragment fragment = new SelectRouteActivityFragment();
 			fragment.setProcessId(processId);
+			fragment.setAppMode(appMode);
 			fragment.show(fragmentManager, TAG);
 			return true;
 		}
diff --git a/OsmAnd/src/net/osmand/plus/track/fragments/controller/SelectRouteActivityController.java b/OsmAnd/src/net/osmand/plus/track/fragments/controller/SelectRouteActivityController.java
index 3b537fa8764..bc544fe01c9 100644
--- a/OsmAnd/src/net/osmand/plus/track/fragments/controller/SelectRouteActivityController.java
+++ b/OsmAnd/src/net/osmand/plus/track/fragments/controller/SelectRouteActivityController.java
@@ -17,6 +17,7 @@
 import net.osmand.plus.base.dialog.data.DisplayItem;
 import net.osmand.plus.base.dialog.interfaces.controller.IDialogItemSelected;
 import net.osmand.plus.base.dialog.interfaces.controller.IDisplayDataProvider;
+import net.osmand.plus.settings.backend.ApplicationMode;
 import net.osmand.shared.gpx.RouteActivityHelper;
 import net.osmand.plus.track.fragments.SelectRouteActivityFragment;
 import net.osmand.plus.track.helpers.RouteActivitySearchFilter;
@@ -203,14 +204,14 @@ public String getProcessId() {
 		return PROCESS_ID;
 	}
 
-	public static void showDialog(@NonNull FragmentActivity activity,
+	public static void showDialog(@NonNull FragmentActivity activity, @Nullable ApplicationMode appMode,
 	                              @NonNull RouteActivitySelectionHelper routeActivitySelectionHelper) {
 		OsmandApplication app = (OsmandApplication) activity.getApplicationContext();
 		DialogManager dialogManager = app.getDialogManager();
 		dialogManager.register(PROCESS_ID, new SelectRouteActivityController(app, routeActivitySelectionHelper));
 
 		FragmentManager fragmentManager = activity.getSupportFragmentManager();
-		SelectRouteActivityFragment.showInstance(fragmentManager, PROCESS_ID);
+		SelectRouteActivityFragment.showInstance(fragmentManager, appMode, PROCESS_ID);
 	}
 
 	@Nullable
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java
index fa26695ec8f..72ae0116a37 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/CompassVisibilityBottomSheet.java
@@ -1,6 +1,5 @@
 package net.osmand.plus.views.mapwidgets.configure.dialogs;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
 
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
@@ -21,7 +20,6 @@
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.helpers.AndroidUiHelper;
 import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.enums.CompassVisibility;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
@@ -34,27 +32,13 @@ public class CompassVisibilityBottomSheet extends MenuBottomSheetDialogFragment
 	public static final String TAG = CompassVisibilityBottomSheet.class.getSimpleName();
 
 	private OsmandApplication app;
-	private OsmandSettings settings;
-	private ApplicationMode appMode;
 	private CompassButtonState buttonState;
 
 	@Override
 	public void onCreate(Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = requiredMyApplication();
-		settings = app.getSettings();
 		buttonState = app.getMapButtonsHelper().getCompassButtonState();
-
-		Bundle args = getArguments();
-		if (savedInstanceState != null) {
-			restoreAppMode(savedInstanceState);
-		} else if (args != null) {
-			restoreAppMode(args);
-		}
-	}
-
-	private void restoreAppMode(@NonNull Bundle bundle) {
-		appMode = ApplicationMode.valueOfStringKey(bundle.getString(APP_MODE_KEY), settings.getApplicationMode());
 	}
 
 	@Override
@@ -115,12 +99,6 @@ private Drawable getIconForVisibility(@NonNull CompassVisibility visibility) {
 		return getIcon(visibility.iconId, iconColorId);
 	}
 
-	@Override
-	public void onSaveInstanceState(@NonNull Bundle outState) {
-		super.onSaveInstanceState(outState);
-		outState.putString(APP_MODE_KEY, appMode.getStringKey());
-	}
-
 	@Override
 	protected int getDismissButtonTextId() {
 		return R.string.shared_string_close;
diff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
index b373432d0e6..72481a09cca 100644
--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/dialogs/Map3DModeBottomSheet.java
@@ -1,7 +1,5 @@
 package net.osmand.plus.views.mapwidgets.configure.dialogs;
 
-import static net.osmand.plus.settings.fragments.BaseSettingsFragment.APP_MODE_KEY;
-
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
 import android.view.LayoutInflater;
@@ -21,7 +19,6 @@
 import net.osmand.plus.base.MenuBottomSheetDialogFragment;
 import net.osmand.plus.base.bottomsheetmenu.BaseBottomSheetItem;
 import net.osmand.plus.settings.backend.ApplicationMode;
-import net.osmand.plus.settings.backend.OsmandSettings;
 import net.osmand.plus.settings.enums.Map3DModeVisibility;
 import net.osmand.plus.utils.AndroidUtils;
 import net.osmand.plus.utils.ColorUtilities;
@@ -33,27 +30,13 @@ public class Map3DModeBottomSheet extends MenuBottomSheetDialogFragment {
 	public static final String TAG = Map3DModeBottomSheet.class.getSimpleName();
 
 	private OsmandApplication app;
-	private OsmandSettings settings;
-	private ApplicationMode appMode;
 	private Map3DButtonState buttonState;
 
 	@Override
 	public void onCreate(Bundle savedInstanceState) {
 		super.onCreate(savedInstanceState);
 		app = requiredMyApplication();
-		settings = app.getSettings();
 		buttonState = app.getMapButtonsHelper().getMap3DButtonState();
-
-		Bundle args = getArguments();
-		if (savedInstanceState != null) {
-			restoreAppMode(savedInstanceState);
-		} else if (args != null) {
-			restoreAppMode(args);
-		}
-	}
-
-	private void restoreAppMode(@NonNull Bundle bundle) {
-		appMode = ApplicationMode.valueOfStringKey(bundle.getString(APP_MODE_KEY), settings.getApplicationMode());
 	}
 
 	@Override
@@ -122,8 +105,7 @@ protected int getDismissButtonTextId() {
 	}
 
 	public static void showInstance(@NonNull FragmentManager fragmentManager,
-	                                @Nullable Fragment target,
-	                                @NonNull ApplicationMode appMode) {
+	                                @Nullable Fragment target, @NonNull ApplicationMode appMode) {
 		if (AndroidUtils.isFragmentCanBeAdded(fragmentManager, TAG)) {
 			Map3DModeBottomSheet fragment = new Map3DModeBottomSheet();
 			fragment.setTargetFragment(target, 0);
diff --git a/OsmAnd/src/net/osmand/plus/wikivoyage/article/WikivoyageArticleDialogFragment.java b/OsmAnd/src/net/osmand/plus/wikivoyage/article/WikivoyageArticleDialogFragment.java
index 1797d1234e0..45c88779372 100644
--- a/OsmAnd/src/net/osmand/plus/wikivoyage/article/WikivoyageArticleDialogFragment.java
+++ b/OsmAnd/src/net/osmand/plus/wikivoyage/article/WikivoyageArticleDialogFragment.java
@@ -177,7 +177,7 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat
 	}
 
 	@Override
-	public void onSaveInstanceState(Bundle outState) {
+	public void onSaveInstanceState(@NonNull Bundle outState) {
 		super.onSaveInstanceState(outState);
 		outState.putString(SELECTED_LANG_KEY, selectedLang);
 	}
