diff --git a/android-components/.buildconfig.yml b/android-components/.buildconfig.yml
index 01d6822584a8..f453cd9809ba 100644
--- a/android-components/.buildconfig.yml
+++ b/android-components/.buildconfig.yml
@@ -291,10 +291,6 @@ projects:
     path: components/service/digitalassetlinks
     description: 'A library for communicating with the Digital Asset Links API.'
     publish: true
-  service-experiments:
-    path: components/service/experiments
-    description: 'An Android SDK for running experiments on user segments in multiple branches.'
-    publish: true
   service-glean:
     path: components/service/glean
     description: 'A client-side telemetry SDK for collecting metrics and sending them to the Mozilla telemetry service'
diff --git a/android-components/README.md b/android-components/README.md
index 63a840cfa247..e10f42b5afd2 100644
--- a/android-components/README.md
+++ b/android-components/README.md
@@ -206,8 +206,6 @@ _Components and libraries to interact with backend services._
 
 * ðŸ”µ [**Glean**](components/service/glean/README.md) - A client-side telemetry SDK for collecting metrics and sending them to Mozilla's telemetry service (eventually replacing [service-telemetry](components/service/telemetry/README.md)).
 
-* ðŸ”´ [**Experiments**](components/service/experiments/README.md) - An Android SDK for running experiments on user segments in multiple branches.
-
 * ðŸ”µ [**Location**](components/service/location/README.md) - A library for accessing Mozilla's and other location services.
 
 * ðŸ”´ [**Nimbus**](components/service/nimbus/README.md) - A wrapper for the Nimbus SDK.
diff --git a/android-components/components/service/experiments/.gitignore b/android-components/components/service/experiments/.gitignore
deleted file mode 100644
index 796b96d1c402..000000000000
--- a/android-components/components/service/experiments/.gitignore
+++ /dev/null
@@ -1 +0,0 @@
-/build
diff --git a/android-components/components/service/experiments/KintoSchema.md b/android-components/components/service/experiments/KintoSchema.md
deleted file mode 100644
index 5a3d93383589..000000000000
--- a/android-components/components/service/experiments/KintoSchema.md
+++ /dev/null
@@ -1,375 +0,0 @@
-# Kinto Schema
-
-This document contains the information about the Kinto schema and UI schema needed to run dev experiments
-on the "Dev" Kinto instance located at https://kinto.dev.mozaws.net.
-
-## JSON Schema
-
-```JSON
-{
-  "type": "object",
-  "required": [
-    "id",
-    "description",
-    "match",
-    "buckets",
-    "branches"
-  ],
-  "properties": {
-    "id": {
-      "title": "Experiment id",
-      "type": "string",
-      "minLength": 1,
-      "maxLength": 100
-    },
-    "description": {
-      "title": "Description",
-      "type": "string"     
-    },
-    "buckets": {
-      "title": "Buckets",
-      "type": "object",
-      "description": "Each user is assigned a random bucket from 0 to 999. Select the bucket ranges here to control the enrolled population size.",
-      "required": [
-        "start",
-        "count"
-      ],
-      "properties": {
-        "start": {
-          "mininum": 0,
-          "maximum": 999,
-          "type": "number"
-        },
-        "count": {
-          "mininum": 0,
-          "maximum": 1000,
-          "type": "number"
-        }
-      }
-    },
-    "branches": {
-      "title": "Branches",
-      "type": "array",
-      "required": [
-        "name",
-        "ratio"
-      ],
-      "default": [],
-      "uniqueItems": true,
-      "minItems": 1,
-      "description": "Each experiment needs to specify one or more branches. Each branch has a name and a ratio. An enrolled user is assigned one branch randomly, with the probabilities weighted per the ratio.",
-      "items": {
-        "description": "One experiment branch.",
-        "title": "Branch",
-        "type": "object",
-        "properties": {
-          "name": {
-            "type": "string",
-            "description": "The branch name. This is what product code uses to decide which branch logic to execute.",
-            "minLength": 1,
-            "maxLength": 100
-          },
-          "ratio": {
-            "type": "number",
-            "description": "The branches ratio is the probabilistic weight for random branch assignment.",
-            "mininum": 1,
-            "maximum": 1000,
-            "default": 1
-          }
-        }
-      }
-    },
-    "match": {
-      "title": "Matching",
-      "type": "object",
-      "description": "A list of optional matchers, which allow restricting the experiment to e.g. specific application ids.",
-      "properties": {
-        "app_id": {
-          "type": "string",
-          "description": "Match specific application ids. A regex. E.g.: ^org.mozilla.fennec|org.mozilla.firefox_beta|org.mozilla.firefox$",
-          "minLength": 1,
-          "maxLength": 1000
-        },
-        "app_display_version": {
-          "description": "The application's version number. A regex. E.g.: '47.0a1', '46.0'",
-          "type": "string"
-        },
-        "app_min_version": {
-          "description": "The application's minimum version number. E.g.: '47.0.11', '46.0'",
-          "type": "string"
-        },
-        "app_max_version": {
-          "description": "The application's maximum version number. E.g.: '47.0.11', '46.0'",
-          "type": "string"
-        },
-        "locale_country": {
-          "description": "Match country, pulled from the default locale. A regex. E.g.: USA|ITA",
-          "type": "string",
-          "minLength": 1,
-          "maxLength": 1000
-        },
-        "locale_language": {
-          "description": "Language, pulled from the default locale. A regex. E.g.: eng|esp",
-          "type": "string",
-          "minLength": 1,
-          "maxLength": 1000
-        },
-        "device_model": {
-          "description": "Device name. A regex.",
-          "type": "string",
-          "minLength": 1,
-          "maxLength": 1000
-        },
-        "device_manufacturer": {
-          "description": "Device manufacturer",
-          "type": "string",
-          "minLength": 1,
-          "maxLength": 1000
-        },
-        "regions": {
-          "default": [],
-          "description": "Compared with GeoIP lookup, where supported.",
-          "items": {
-            "default": "",
-            "description": "Similar to a GeoIP lookup",
-            "minLength": 1,
-            "maxLength": 1000,
-            "title": "Regions",
-            "type": "string"
-          },
-          "title": "Regions",
-          "type": "array",
-          "uniqueItems": true
-        },
-        "debug_tags": {
-          "default": [],
-          "description": "Target specific debug tags only. This allows testing of experiments for only specific active users for QA etc.",
-          "items": {
-            "default": "",
-            "description": "A debug tag set through the libraries debug activity.",
-            "minLength": 1,
-            "title": "Debug tag",
-            "type": "string"
-          },
-          "title": "Debug tags",
-          "type": "array",
-          "uniqueItems": true
-        }
-      }
-    }
-  }
-}
-```
-  
-## UI Schema
-
-```JSON
-{
-  "sort": "-last_modified",
-  "displayFields": [
-    "id",
-    "description"
-  ],
-  "attachment": {
-    "enabled": false,
-    "required": false
-  },
-  "schema": {
-    "properties": {
-      "id": {
-        "type": "string",
-        "maxLength": 100,
-        "title": "Experiment id",
-        "minLength": 1
-      },
-      "buckets": {
-        "description": "Each user is assigned a random bucket from 0 to 999. Select the bucket ranges here to control the enrolled population size.",
-        "properties": {
-          "start": {
-            "type": "number",
-            "mininum": 0,
-            "maximum": 999
-          },
-          "count": {
-            "type": "number",
-            "mininum": 0,
-            "maximum": 1000
-          }
-        },
-        "type": "object",
-        "required": [
-          "start",
-          "count"
-        ],
-        "title": "Buckets"
-      },
-      "description": {
-        "type": "string",
-        "title": "Description"
-      },
-      "branches": {
-        "description": "Each experiment needs to specify one or more branches. Each branch has a name and a ratio. An enrolled user is assigned one branch randomly, with the probabilities weighted per the ratio.",
-        "required": [
-          "name",
-          "ratio"
-        ],
-        "title": "Branches",
-        "items": {
-          "description": "One experiment branch.",
-          "properties": {
-            "ratio": {
-              "description": "The branches ratio is the probabilistic weight for random branch assignment.",
-              "type": "number",
-              "default": 1,
-              "mininum": 1,
-              "maximum": 1000
-            },
-            "name": {
-              "description": "The branch name. This is what product code uses to decide which branch logic to execute.",
-              "type": "string",
-              "maxLength": 100,
-              "minLength": 1
-            }
-          },
-          "type": "object",
-          "title": "Branch"
-        },
-        "type": "array",
-        "minItems": 1,
-        "uniqueItems": true,
-        "default": []
-      },
-      "match": {
-        "description": "A list of optional matchers, which allow restricting the experiment to e.g. specific application ids.",
-        "properties": {
-          "app_id": {
-            "description": "Match specific application ids. A regex. E.g.: ^org.mozilla.fennec|org.mozilla.firefox_beta|org.mozilla.firefox$",
-            "type": "string",
-            "maxLength": 1000,
-            "minLength": 1
-          },
-          "app_display_version": {
-            "description": "The application's version number. A regex. E.g.: '47.0a1', '46.0'",
-            "type": "string"
-          },
-          "app_min_version": {
-            "description": "The application's minimum version number. E.g.: '47.0.11', '46.0'",
-            "type": "string"
-          },
-          "app_max_version": {
-            "description": "The application's maximum version number. E.g.: '47.0.11', '46.0'",
-            "type": "string"
-          },
-          "device_manufacturer": {
-            "description": "Device manufacturer",
-            "type": "string",
-            "maxLength": 1000,
-            "minLength": 1
-          },
-          "debug_tags": {
-            "description": "Target specific debug tags only. This allows testing of experiments for only specific active users for QA etc.",
-            "title": "Debug tags",
-            "items": {
-              "description": "A debug tag set through the libraries debug activity.",
-              "type": "string",
-              "title": "Debug tag",
-              "default": "",
-              "minLength": 1
-            },
-            "type": "array",
-            "uniqueItems": true,
-            "default": []
-          },
-          "locale_country": {
-            "description": "Match country, pulled from the default locale. A regex. E.g.: USA|ITA",
-            "type": "string",
-            "maxLength": 1000,
-            "minLength": 1
-          },
-          "regions": {
-            "description": "Compared with GeoIP lookup, where supported.",
-            "title": "Regions",
-            "items": {
-              "description": "Similar to a GeoIP lookup",
-              "maxLength": 1000,
-              "title": "Regions",
-              "type": "string",
-              "minLength": 1,
-              "default": ""
-            },
-            "type": "array",
-            "uniqueItems": true,
-            "default": []
-          },
-          "device_model": {
-            "description": "Device name. A regex.",
-            "type": "string",
-            "maxLength": 1000,
-            "minLength": 1
-          },
-          "locale_language": {
-            "description": "Language, pulled from the default locale. A regex. E.g.: eng|esp",
-            "type": "string",
-            "maxLength": 1000,
-            "minLength": 1
-          }
-        },
-        "type": "object",
-        "title": "Matching"
-      }
-    },
-    "type": "object",
-    "required": [
-      "id",
-      "description",
-      "match",
-      "buckets",
-      "branches"
-    ]
-  },
-  "uiSchema": {
-    "buckets": {
-      "ui:order": [
-        "start",
-        "count"
-      ]
-    },
-    "description": {
-      "ui:widget": "textarea"
-    },
-    "match": {
-      "ui:order": [
-        "app_id",
-        "app_display_version",
-        "app_min_version",
-        "app_max_version",
-        "locale_language",
-        "locale_country",
-        "device_model",
-        "device_manufacturer",
-        "regions",
-        "debug_tags"
-      ]
-    },
-    "ui:order": [
-      "id",
-      "description",
-      "buckets",
-      "branches",
-      "match"
-    ]
-  },
-  "cache_expires": 0
-}
-```
-  
-## Where to add this
-
-For testing create a collection `mobile-experiments` in the `main` bucket on the [Kinto dev server](https://kinto.dev.mozaws.net/v1/admin/).
-
-## Records list columns
-
-What's added in "Records list columns" is what get's shown in the record lists overview.
-We want:
-- id
-- description
\ No newline at end of file
diff --git a/android-components/components/service/experiments/README.md b/android-components/components/service/experiments/README.md
deleted file mode 100644
index a2784dc4fa9a..000000000000
--- a/android-components/components/service/experiments/README.md
+++ /dev/null
@@ -1,219 +0,0 @@
-# [Android Components](../../../README.md) > Service > Experiments
-
-An Android SDK for running experiments on user segments in multiple branches.
-
-Contents:
-- [Usage](#usage)
-- [Testing experiments](#testing-experiments)
-- [Experiments format for Kinto](#experiments-format-for-kinto)
-
-## Usage
-
-### Setting up the dependency
-
-Use Gradle to download the library from [maven.mozilla.org](https://maven.mozilla.org/) ([Setup repository](../../../README.md#maven-repository)):
-
-```Groovy
-implementation "org.mozilla.components:service-experiments:{latest-version}"
-```
-
-### Initializing the Experiments library
-
-In order to use the library, first you have to initialize it by calling `Experiments.initialize()`. 
-You do this once per app launch (typically in your `Application` class `onCreate` method). You 
-simply have to call `Experiments.initialize()` and provide the `applicationContext` (and optionally 
-a `Configuration` object and callback for when the experiments are updated), like this:
-
-```Kotlin
-class SampleApp : Application() {
-    override fun onCreate() {
-        Experiments.initialize(
-            applicationContext,
-            configuration // This is optional, e.g. for overriding the fetch client.
-        ) {
-            // This is an optional callback that can be provided to inform the application
-            // when the experiments are updated, so that they can check `withExperiment`, etc.
-            doSomething()
-        }
-    }
-}
-```
-
-This library makes use of [Glean](https://mozilla.github.io/glean/book/index.html) for reporting 
-experiment enrollment. If Glean is not used and initialized by the application, the recording 
-methods are a no-op.
-
-### Updating of experiments
-
-The library updates its list of experiments automatically and asynchronously from Kinto on library 
-initialization. As this is asynchronous, it will not have immediate effect.
-
-Afterwards, the list of experiments will be updated in the background every 6 hours.
-
-A consuming application may provide a callback function to the `initialize` function in order to
-receive notification when the experiments have been updated, taking the form of `() -> Unit`.
-
-### Checking if a user is part of an experiment
-
-In order to check if a user is part of a specific experiment, `Experiments` provides a 
-Kotlin-friendly `withExperiment` API. You pass the id of the experiment you want to check and if the 
-client is in the experiment, you get the selected branch name passed:
-
-```Kotlin
-Experiments.withExperiment("button-color-experiment") { branchName ->
-    when(branchName) {
-      "red" -> button.setBackgroundColor(Color.RED)
-      "control" -> button.setBackgroundColor(DEFAULT_COLOR)
-    }
-}
-```
-
-## Testing experiments
-
-### Accessing the Kinto staging server
-
-To test experiments and branching, use the Kinto staging server available. **You** are responsible for cleaning up your experiments when you are finished testing.
-
-There is no way to test branching locally only, unfortunately - you must have the experiment available on a testing server.
-
-The staging server is only for internal testing, and requires additional permissions. Allocate at least a few days to make sure you can get the correct permissions.
-
-You will need:
-- Set up the [VPN](https://mana.mozilla.org/wiki/pages/viewpage.action?spaceKey=SD&title=VPN)
-- Get the relevant experiment creation/approval permissions by reaching out to the Mobile Experiments team.
-
-The staging server interface is [here](https://settings-writer.stage.mozaws.net/v1/admin/#/). Once you have completed the above prerequisites, you'll be able to log in with LDAP.
-
-In the [`mobile-experiments` record list](https://settings-writer.stage.mozaws.net/v1/admin/#/buckets/main-workspace/collections/mobile-experiments/records), create new entries for experiments as needed.
-
-- Use the debug commands below to switch to the `staging` endpoint.
-
-### Using ExperimentsDebugActivity to access staged experiments
-
-Experiments exports the [`ExperimentsDebugActivity`](src/main/java/mozilla/components/service/experiments/debug/ExperimentsDebugActivity.kt)
-that can be used to trigger functionality or toggle debug features on or off. Users can invoke this special activity, at
-run-time, using the following [`adb`](https://developer.android.com/studio/command-line/adb) command:
-
-`adb shell am start -n [applicationId]/mozilla.components.service.experiments.debug.ExperimentsDebugActivity [extra keys]`
-
-In the above:
-
-- `[applicationId]` is the product's application id as defined in the manifest
-  file and/or build script. For the Glean sample application, this is
-  `org.mozilla.samples.glean` for a release build and
-  `org.mozilla.samples.glean.debug` for a debug build.
-
-- `[extra keys]` is a list of extra keys to be passed to the debug activity. See the
-  [documentation](https://developer.android.com/studio/command-line/adb#IntentSpec)
-  for the command line switches used to pass the extra keys. These are the
-  currently supported keys:
-
-    |key|type|description|
-    |---|----|-----------|
-    | updateExperiments | boolean (--ez) | Forces the experiments updater to run and fetch experiments immediately. You must pass `true` or `false` following this switch but either will update experiments if this is present |
-    | setKintoInstance | string (--es) | Sets the Kinto instance to the specified instance ("dev", "staging", "prod" only) |
-    | overrideExperiment | string (--es) | Used to pass in the experiment name to override. Must be followed by the `branch` command below. |
-    | branch | string (--es) | Used to set the branch for overriding the experiment and is meant to be used with the `overrideExperiment` command above. |
-    | clearAllOverrides | boolean (--ez) | Clears any overrides that have been set.  You must pass `true` or `false` following this switch but either will clear the overrides if this is present. Should **not** be used in combination with the `overrideExperiment` command |
-
-#### Examples
-
-To direct a release build of the Glean sample application to (1) update experiments immediately and (2) change the Kinto instance to the staging instance, the following command can be used:
-
-```
-adb shell am start -n org.mozilla.samples.glean.debug/mozilla.components.service.experiments.debug.ExperimentsDebugActivity \
-  --ez updateExperiments true \
-  --es setKintoInstance staging
-```
-
-To direct a release build of the Glean sample application to override the experiment and branch, the following command can be used:
-
-```
-adb shell am start -n org.mozilla.samples.glean.debug/mozilla.components.service.experiments.debug.ExperimentsDebugActivity --es overrideExperiment testExperiment --es branch testBranch
-```
-
-## Experiments format for Kinto
-
-The library loads its list of experiments from Kinto. Kinto provides data in the following JSON format:
-```javascript
-{
-    // The whole list of experiments lives in a Kinto "collection".
-    "data": [
-        // Each experiments data is described in a "record".
-        {
-            "id":"some-experiment",
-            // ... 
-            "last_modified":1523549895713
-        },
-        // ... more records.
-    ]
-}
-```
-
-An individual experiment record looks e.g. like this:
-
-```javascript
-{
-  "id": "button-color-expirement",
-  "description": "The button color experiments tests ... per bug XYZ.",
-  // Enroll 50% of the population in the experiment.
-  "buckets": {
-    "start": 0,
-    "count": 500
-  },
-  // Distribute enrolled clients among two branches.
-  "branches": [
-    {
-      "name": "control",
-      "ratio": 1
-    },
-    {
-      "name": "red-button-color",
-      "ratio": 2 // Two thirds of the enrolled clients get red buttons.
-    }
-  ],
-  "match": {
-    "app_id": "^org.mozilla.firefox${'$'}",
-    "locale_language": "eng|zho|deu"
-    // Possibly more matchers...
-  }
-}
-```
-
-### Experiment fields
-
-The experiments records in Kinto contain the following properties:
-
-| Name                      | Type   | Required | Description                                                                                                                                     | Example                                                         |
-|---------------------------|--------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
-| id                        | string |     x    | The unique id of the experiment.                                                                                                                | `"login-button-color-test"`                                     |
-| description               | string |     x    | A detailed description of the experiment.                                                                                                       |                                                                 |
-| last_modified             | number |     x    | Timestamp of when this experiment was last modified. This is provided by Kinto.                                                                 |                                                                 |
-| schema                    | number |     x    | Timestamp of when the schema was last modified. This is provided by Kinto.                                                                      |                                                                 |
-| buckets                   | object |     x    | Object containing a bucket range to match users. Every user is in one of 1000 buckets (0-999).                                                  |                                                                 |
-|  buckets.start            | number |     x    | The minimum bucket to match.                                                                                                                    |                                                                 |
-| buckets.count             | number |     x    | The number of buckets to match from start. If (start + count >= 999), evaluation will wrap around.                                              |                                                                 |
-| branches                  | object |     x    | Object containing the parameters for ratios for randomized enrollment into different branches.                                                  |                                                                 |
-| branches[i].name          | string |     x    | The name of that branch.                                                                                                                        | `"control"` or `"red-button"`                                   |
-| branches[i].ratio         | number |     x    | The weight to randomly distribute enrolled clients among the branches.                                                                          |                                                                 |
-| match                     | object |     x    | Object containing the filter parameters to match specific user groups.                                                                          |                                                                 |
-| match.app_id              | regex  |          | The app ID (package name)                                                                                                                       | `"^org.mozilla.firefox_beta${'$'}\|^org.mozilla.firefox${'$'}"` |
-| match.device_manufacturer | regex  |          | The Android device manufacturer.                                                                                                                |                                                                 |
-| match.device_model        | regex  |          | The Android device model, [`Build.DEVICE`]. This is the codename for the device's industrial design.                                            | `"^(flame\|coral)$"` (to match Pixel 4 or Pixel 4 XL)           |
-| match.locale_country      |        |          | The default locales country.                                                                                                                    | `"USA\|DEU"`                                                    |
-| match.locale_language     |        |          | The default locales language.                                                                                                                   | `"eng\|zho\|deu"`                                               |
-| match.app_display_version | regex  |          | The application version.                                                                                                                        | `"1.0.0"`                                                       |
-| match.app_min_version     | string |          | The minimum application version, inclusive.                                                                                                     | `"1.0.1"`                                                       |
-| match.app_max_version     | string |          | The maximum application version, inclusive.                                                                                                     | `"1.4.2"`                                                       |
-| match.regions             | array  |          | Array of strings. Not currently supported. Custom regions, different from the one from the default locale (like a GeoIP, or something similar). | `["USA", "GBR"]`                                                |
-| match.debug_tags          | array  |          | Array of strings. Debug tags to match only specific client for QA of experiments launch & targeting.                                            | `["john-test-1"]`                                               |
-
-
-[`Build.DEVICE`]: https://developer.android.com/reference/android/os/Build.html#DEVICE
-
-## License
-
-    This Source Code Form is subject to the terms of the Mozilla Public
-    License, v. 2.0. If a copy of the MPL was not distributed with this
-    file, You can obtain one at http://mozilla.org/MPL/2.0/
-
diff --git a/android-components/components/service/experiments/build.gradle b/android-components/components/service/experiments/build.gradle
deleted file mode 100644
index 5c90402483b6..000000000000
--- a/android-components/components/service/experiments/build.gradle
+++ /dev/null
@@ -1,57 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-apply plugin: 'com.android.library'
-apply plugin: 'kotlin-android'
-
-android {
-    compileSdkVersion config.compileSdkVersion
-
-    defaultConfig {
-        minSdkVersion config.minSdkVersion
-        targetSdkVersion config.targetSdkVersion
-    }
-
-    buildTypes {
-        debug {
-            // Export experiments proguard rules even in debug since consuming apps may still
-            // enable proguard/R8
-            consumerProguardFiles 'proguard-rules-consumer.pro'
-        }
-        release {
-            minifyEnabled false
-            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
-            consumerProguardFiles 'proguard-rules-consumer.pro'
-        }
-    }
-}
-
-dependencies {
-    implementation Dependencies.kotlin_stdlib
-    implementation Dependencies.kotlin_coroutines
-    implementation Dependencies.androidx_work_runtime
-
-    implementation project(':service-glean')
-    implementation project(':support-ktx')
-    implementation project(':support-base')
-    implementation project(':concept-fetch')
-    implementation project(':lib-fetch-httpurlconnection')
-
-    testImplementation Dependencies.androidx_test_core
-
-    testImplementation Dependencies.androidx_test_junit
-    testImplementation Dependencies.testing_robolectric
-    testImplementation Dependencies.testing_mockito
-    testImplementation Dependencies.testing_mockwebserver
-    testImplementation Dependencies.kotlin_reflect
-    testImplementation Dependencies.androidx_work_testing
-    testImplementation Dependencies.androidx_espresso_core
-    testImplementation Dependencies.mozilla_glean_forUnitTests
-
-    testImplementation project(':support-test')
-    testImplementation project(':lib-fetch-httpurlconnection')
-}
-
-apply from: '../../../publish.gradle'
-ext.configurePublish(config.componentsGroupId, archivesBaseName, project.ext.description)
diff --git a/android-components/components/service/experiments/proguard-rules-consumer.pro b/android-components/components/service/experiments/proguard-rules-consumer.pro
deleted file mode 100644
index 60b0307fd7a9..000000000000
--- a/android-components/components/service/experiments/proguard-rules-consumer.pro
+++ /dev/null
@@ -1,4 +0,0 @@
-# ProGuard rules for consumers of this library.
-
-# Experiments specific protections
--keep class mozilla.components.service.experiments.** { *; }
diff --git a/android-components/components/service/experiments/proguard-rules.pro b/android-components/components/service/experiments/proguard-rules.pro
deleted file mode 100644
index f1b424510da5..000000000000
--- a/android-components/components/service/experiments/proguard-rules.pro
+++ /dev/null
@@ -1,21 +0,0 @@
-# Add project specific ProGuard rules here.
-# You can control the set of applied configuration files using the
-# proguardFiles setting in build.gradle.
-#
-# For more details, see
-#   http://developer.android.com/guide/developing/tools/proguard.html
-
-# If your project uses WebView with JS, uncomment the following
-# and specify the fully qualified class name to the JavaScript interface
-# class:
-#-keepclassmembers class fqcn.of.javascript.interface.for.webview {
-#   public *;
-#}
-
-# Uncomment this to preserve the line number information for
-# debugging stack traces.
-#-keepattributes SourceFile,LineNumberTable
-
-# If you keep the line number information, uncomment this to
-# hide the original source file name.
-#-renamesourcefileattribute SourceFile
diff --git a/android-components/components/service/experiments/src/main/AndroidManifest.xml b/android-components/components/service/experiments/src/main/AndroidManifest.xml
deleted file mode 100644
index 51f41777de0e..000000000000
--- a/android-components/components/service/experiments/src/main/AndroidManifest.xml
+++ /dev/null
@@ -1,10 +0,0 @@
-<!-- This Source Code Form is subject to the terms of the Mozilla Public
-   - License, v. 2.0. If a copy of the MPL was not distributed with this
-   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
-<manifest xmlns:android="http://schemas.android.com/apk/res/android"
-    package="mozilla.components.service.experiments">
-    <application>
-        <activity android:name=".debug.ExperimentsDebugActivity"
-            android:exported="true" />
-    </application>
-</manifest>
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ActiveExperiment.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ActiveExperiment.kt
deleted file mode 100644
index fbfd95901be8..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ActiveExperiment.kt
+++ /dev/null
@@ -1,61 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import androidx.annotation.VisibleForTesting
-
-/**
- * An ActiveExperiment is an experiment that has a branch assigned.
- */
-internal data class ActiveExperiment(
-    val experiment: Experiment,
-    val branch: String
-) {
-    fun save(context: Context) {
-        getSharedPreferences(context)
-            .edit()
-            .putString(KEY_ID, experiment.id)
-            .putString(KEY_BRANCH, branch)
-            .apply()
-    }
-
-    companion object {
-        fun load(
-            context: Context,
-            experimentList: List<Experiment>
-        ): ActiveExperiment? {
-            val prefs = getSharedPreferences(context)
-            val id = prefs.getString(KEY_ID, null)
-            val branch = prefs.getString(KEY_BRANCH, null)
-            if (id.isNullOrEmpty() || branch.isNullOrEmpty()) {
-                return null
-            }
-
-            val experiment = experimentList.find {
-                it.id == id && it.branches.any { it.name == branch }
-            } ?: return null
-
-            return ActiveExperiment(experiment, branch)
-        }
-
-        fun clear(context: Context) {
-            getSharedPreferences(context)
-                .edit()
-                .clear()
-                .apply()
-        }
-
-        private fun getSharedPreferences(context: Context) =
-            context.getSharedPreferences(PREF_NAME_ACTIVE_EXPERIMENT, Context.MODE_PRIVATE)
-
-        @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-        internal const val PREF_NAME_ACTIVE_EXPERIMENT = "mozilla.components.service.experiments.active_experiment"
-        @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-        internal const val KEY_ID = "id"
-        @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-        internal const val KEY_BRANCH = "branch"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Configuration.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Configuration.kt
deleted file mode 100644
index 9eb8cff8a991..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Configuration.kt
+++ /dev/null
@@ -1,20 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import mozilla.components.concept.fetch.Client
-
-/**
- * The Configuration class describes how to configure Experiments.
- *
- * @property httpClient The HTTP client implementation to use for uploading pings.
- * @property kintoEndpoint the endpoint to fetch experiments from, must be one of:
- * [ExperimentsUpdater.KINTO_ENDPOINT_DEV], [ExperimentsUpdater.KINTO_ENDPOINT_STAGING], or
- * [ExperimentsUpdater.KINTO_ENDPOINT_PROD]
- */
-data class Configuration(
-    val httpClient: Client,
-    val kintoEndpoint: String = ExperimentsUpdater.KINTO_ENDPOINT_PROD
-)
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/DeviceUuidFactory.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/DeviceUuidFactory.kt
deleted file mode 100644
index c4fcc45eabf7..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/DeviceUuidFactory.kt
+++ /dev/null
@@ -1,44 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import java.util.UUID
-
-/**
- * Class used to generate a random UUID for the device
- * and store it persistent in shared preferences.
- *
- * If the UUID was already generated it returns the stored one
- *
- * @param context context
- */
-internal class DeviceUuidFactory(context: Context) {
-    /**
-     * Unique UUID for the current android device. As with all UUIDs,
-     * this unique ID is "very highly likely" to be unique across all Android
-     * devices. Much more so than ANDROID_ID is
-     *
-     * The UUID is generated with <code>UUID.randomUUID()</code>
-     */
-    val uuid by lazy {
-        val preferences = context
-            .getSharedPreferences(PREFS_FILE, Context.MODE_PRIVATE)
-        val prefUuid = preferences.getString(PREF_UUID_KEY, null)
-
-        if (prefUuid != null) {
-            UUID.fromString(prefUuid).toString()
-        } else {
-            val uuid = UUID.randomUUID()
-            preferences.edit().putString(PREF_UUID_KEY, uuid.toString()).apply()
-            uuid.toString()
-        }
-    }
-
-    companion object {
-        private const val PREFS_FILE = "mozilla.components.service.experiments"
-        private const val PREF_UUID_KEY = "device_uuid"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Experiment.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Experiment.kt
deleted file mode 100644
index 1be814964402..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Experiment.kt
+++ /dev/null
@@ -1,137 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import mozilla.components.service.experiments.util.VersionString
-
-/**
- * Represents an A/B test experiment,
- * independent of the underlying
- * storage mechanism
- */
-internal data class Experiment(
-    /**
-     * Unique identifier of the experiment. Used internally by Kinto. Not exposed to library consumers.
-     */
-    internal val id: String,
-    /**
-     * Detailed description of the experiment.
-     */
-    val description: String,
-    /**
-     * Last modified date, as a UNIX timestamp.
-     */
-    val lastModified: Long?,
-    /**
-     * Last time the experiment schema was modified
-     * (as a UNIX timestamp).
-     */
-    val schemaModified: Long?,
-    /**
-     * Experiment buckets.
-     */
-    val buckets: Buckets,
-    /**
-     * Experiment branches.
-     */
-    val branches: List<Branch>,
-    /**
-     * Filters for enabling the experiment.
-     */
-    val match: Matcher
-) {
-    /**
-     * Object containing a bucket range to match users.
-     * Every user is in one of 1000 buckets (0-999).
-     */
-    data class Buckets(
-        /**
-         * The minimum bucket to match.
-         */
-        val start: Int,
-        /**
-         * The number of buckets to match from start. If (start + count >= 999), evaluation will
-         * wrap around.
-         */
-        val count: Int
-    )
-
-    /**
-     * Object containing the parameters for ratios for randomized enrollment into different
-     * branches.
-     */
-    data class Branch(
-        /**
-         * The name of that branch. "control" is reserved for the control branch.
-         */
-        val name: String,
-        /**
-         * The weight to distribute enrolled clients among the branches.
-         */
-        val ratio: Int
-    )
-
-    data class Matcher(
-        /**
-         * name (package name) of the expected application, as a regex.
-         */
-        val appId: String?,
-        /**
-         * App version, as a regex
-         */
-        val appDisplayVersion: String?,
-        /**
-         * App minimum version, expected dotted numeric version E.g. 1.0.2, or 67.0.1
-         */
-        val appMinVersion: VersionString?,
-        /**
-         * App maximum version, expected dotted numeric version E.g. 1.0.2, or 67.0.1
-         */
-        val appMaxVersion: VersionString?,
-        /**
-         * Locale language, as a regex.
-         */
-        val localeLanguage: String?,
-        /**
-         * Locale country, as a three-letter abbreviation.
-         */
-        val localeCountry: String?,
-        /**
-         * Device manufacturer, as a regex.
-         */
-        val deviceManufacturer: String?,
-        /**
-         * Device model, as a regex.
-         */
-        val deviceModel: String?,
-        /**
-         * Regions where the experiment should be enabled.
-         */
-        val regions: List<String>?,
-        /**
-         * Debug tags for matching QA devices.
-         */
-        val debugTags: List<String>?
-    )
-
-    /**
-     * Compares experiments by their id.
-     *
-     * @return true if the two experiments have the same id, false otherwise.
-     */
-    override fun equals(other: Any?): Boolean {
-        if (this === other) {
-            return true
-        }
-        if (other == null || other !is Experiment) {
-            return false
-        }
-        return other.id == id
-    }
-
-    override fun hashCode(): Int {
-        return id.hashCode()
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentDescriptor.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentDescriptor.kt
deleted file mode 100644
index a0a10bc73e48..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentDescriptor.kt
+++ /dev/null
@@ -1,12 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-/**
- * Class used to identify an experiment
- *
- * @property id experiment id
- */
-internal data class ExperimentDescriptor(val id: String)
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentDownloadException.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentDownloadException.kt
deleted file mode 100644
index f8a44a10c238..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentDownloadException.kt
+++ /dev/null
@@ -1,13 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-/**
- * Exception while downloading experiments from the server
- */
-internal class ExperimentDownloadException : Exception {
-    constructor(message: String?) : super(message)
-    constructor(cause: Throwable) : super(cause)
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentEvaluator.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentEvaluator.kt
deleted file mode 100644
index 5f940f96965f..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentEvaluator.kt
+++ /dev/null
@@ -1,307 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.annotation.SuppressLint
-import android.content.Context
-import android.os.Looper
-import androidx.annotation.VisibleForTesting
-import android.text.TextUtils
-import mozilla.components.service.experiments.util.VersionString
-import mozilla.components.support.base.log.logger.Logger
-import java.util.zip.CRC32
-
-/**
- * Class used to determine if a specific experiment should be enabled or not
- * for the device the app is running in
- *
- * @property valuesProvider provider for the device's values
- */
-@Suppress("TooManyFunctions")
-internal class ExperimentEvaluator(
-    private val valuesProvider: ValuesProvider = ValuesProvider()
-) {
-    private val logger: Logger = Logger(LOG_TAG)
-
-    internal fun findActiveExperiment(context: Context, experiments: List<Experiment>): ActiveExperiment? {
-        for (experiment in experiments) {
-            evaluate(context, ExperimentDescriptor(experiment.id), experiments)?.let {
-                return it
-            }
-        }
-
-        return null
-    }
-
-    /**
-     * Determines if a specific experiment should be enabled or not for the device
-     *
-     * @param context context
-     * @param experimentDescriptor experiment descriptor
-     * @param experiments list of all experiments
-     * @param userBucket device bucket
-     *
-     * @return experiment object if the device is part of the experiment, null otherwise
-     */
-    internal fun evaluate(
-        context: Context,
-        experimentDescriptor: ExperimentDescriptor,
-        experiments: List<Experiment>,
-        userBucket: Int = getUserBucket(context)
-    ): ActiveExperiment? {
-        val experiment = getExperiment(experimentDescriptor, experiments) ?: return null
-        val isEnabled = isInBucket(userBucket, experiment) && matches(context, experiment)
-
-        // If we have an active override for this experiment, return it.
-        getOverride(context, experimentDescriptor, isEnabled)?.let {
-            return if (!it.isEnabled) null else ActiveExperiment(experiment, it.branchName)
-        }
-
-        return if (isEnabled) {
-            val rng = { a: Int, b: Int ->
-                valuesProvider.getRandomBranchValue(a, b) }
-            ActiveExperiment(
-                experiment,
-                pickActiveBranch(experiment, rng).name
-            )
-        } else {
-            null
-        }
-    }
-
-    /**
-     * Finds an experiment given its descriptor
-     *
-     * @param descriptor experiment descriptor
-     * @param experiments experiment list
-     *
-     * @return found experiment or null
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getExperiment(descriptor: ExperimentDescriptor, experiments: List<Experiment>): Experiment? {
-        return experiments.firstOrNull { it.id == descriptor.id }
-    }
-
-    private fun matches(context: Context, experiment: Experiment): Boolean {
-        val match = experiment.match
-        val region = valuesProvider.getRegion(context)
-        val version = VersionString(valuesProvider.getVersion(context) ?: "")
-        val matchesRegion = (region == null) ||
-            match.regions.isNullOrEmpty() ||
-            match.regions.any { it == region }
-        val tag = valuesProvider.getDebugTag()
-        val matchesTag = (tag == null) ||
-            match.debugTags.isNullOrEmpty() ||
-            match.debugTags.any { it == tag }
-
-        val matchesMinVersion = match.appMinVersion == null ||
-                version.isValid() && match.appMinVersion.isValid() && match.appMinVersion <= version
-        val matchesMaxVersion = match.appMaxVersion == null ||
-                version.isValid() && match.appMaxVersion.isValid() && match.appMaxVersion >= version
-
-        return matchesRegion && matchesTag && matchesMinVersion && matchesMaxVersion &&
-            matchesExperiment(match.appId, valuesProvider.getAppId(context)) &&
-            matchesExperiment(match.appDisplayVersion, version.toString()) &&
-            matchesExperiment(match.localeLanguage, valuesProvider.getLanguage(context)) &&
-            matchesExperiment(match.localeCountry, valuesProvider.getCountry(context)) &&
-            matchesExperiment(match.deviceManufacturer, valuesProvider.getManufacturer(context)) &&
-            matchesExperiment(match.deviceModel, valuesProvider.getDevice(context))
-    }
-
-    private fun matchesExperiment(experimentValue: String?, deviceValue: String?): Boolean {
-        return !(experimentValue != null &&
-            !TextUtils.isEmpty(experimentValue) &&
-            !(deviceValue?.matches(experimentValue.toRegex()) ?: false))
-    }
-
-    private fun isInBucket(userBucket: Int, experiment: Experiment): Boolean {
-        if ((experiment.buckets.start + experiment.buckets.count) >= MAX_USER_BUCKET) {
-            logger.warn("Experiment bucket is outside of the bucket range.")
-        }
-        return (userBucket >= experiment.buckets.start &&
-                userBucket < (experiment.buckets.start + experiment.buckets.count))
-    }
-
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getUserBucket(context: Context): Int {
-        val uuid = valuesProvider.getClientId(context)
-        val crc = CRC32()
-        crc.update(uuid.toByteArray())
-        val checksum = crc.value
-        return (checksum % MAX_USER_BUCKET).toInt()
-    }
-
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun pickActiveBranch(
-        experiment: Experiment,
-        randomNumberGenerator: (Int, Int) -> Int
-    ): Experiment.Branch {
-        val sum = experiment.branches.sumBy { it.ratio }
-        val diceRoll = randomNumberGenerator(0, sum)
-        return selectBranchByWeight(diceRoll, experiment.branches)
-    }
-
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun selectBranchByWeight(
-        diceRoll: Int,
-        branches: List<Experiment.Branch>
-    ): Experiment.Branch {
-        var value = diceRoll
-        for (branch in branches) {
-            if (value < branch.ratio) {
-                return branch
-            }
-            value -= branch.ratio
-        }
-
-        return branches.last()
-    }
-
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal data class ExperimentOverride(
-        val isEnabled: Boolean,
-        val branchName: String
-    )
-
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getOverride(
-        context: Context,
-        descriptor: ExperimentDescriptor,
-        isEnabledDefault: Boolean
-    ): ExperimentOverride? {
-        val prefEnabled = getSharedPreferencesEnabled(context)
-        val prefBranch = getSharedPreferencesBranch(context)
-        if (!prefEnabled.contains(descriptor.id) || !prefBranch.contains(descriptor.id)) {
-            return null
-        }
-
-        val branchName = prefBranch.getString(descriptor.id, null) ?: return null
-
-        return ExperimentOverride(
-            prefEnabled.getBoolean(descriptor.id, isEnabledDefault),
-            branchName
-        )
-    }
-
-    /**
-     * Overrides a specified experiment asynchronously
-     *
-     * @param context context
-     * @param descriptor descriptor of the experiment
-     * @param active overridden value for the experiment, true to activate it, false to deactivate
-     * @param branchName overridden branch name for the experiment.
-     */
-    internal fun setOverride(
-        context: Context,
-        descriptor: ExperimentDescriptor,
-        active: Boolean,
-        branchName: String
-    ) {
-        getSharedPreferencesEnabled(context)
-            .edit()
-            .putBoolean(descriptor.id, active)
-            .apply()
-        getSharedPreferencesBranch(context)
-            .edit()
-            .putString(descriptor.id, branchName)
-            .apply()
-    }
-
-    /**
-     * Overrides a specified experiment as a blocking operation
-     *
-     * @param context context
-     * @param descriptor descriptor of the experiment
-     * @param active overridden value for the experiment, true to activate it, false to deactivate
-     * @param branchName overridden branch name for the experiment.
-     */
-    @SuppressLint("ApplySharedPref")
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun setOverrideNow(
-        context: Context,
-        descriptor: ExperimentDescriptor,
-        active: Boolean,
-        branchName: String
-    ) {
-        require(Looper.myLooper() != Looper.getMainLooper()) { "This cannot be used on the main thread" }
-        setOverride(context, descriptor, active, branchName)
-    }
-
-    /**
-     * Clears an override for a specified experiment asynchronously
-     *
-     * @param context context
-     * @param descriptor descriptor of the experiment
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun clearOverride(context: Context, descriptor: ExperimentDescriptor) {
-        getSharedPreferencesEnabled(context)
-            .edit()
-            .remove(descriptor.id)
-            .apply()
-        getSharedPreferencesBranch(context)
-            .edit()
-            .remove(descriptor.id)
-            .apply()
-    }
-
-    /**
-     * Clears an override for a specified experiment as a blocking operation
-     *
-     * @param context context
-     * @param descriptor descriptor of the experiment
-     */
-    @SuppressLint("ApplySharedPref")
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun clearOverrideNow(context: Context, descriptor: ExperimentDescriptor) {
-        require(Looper.myLooper() != Looper.getMainLooper()) { "This cannot be used on the main thread" }
-        clearOverride(context, descriptor)
-    }
-
-    /**
-     * Clears all experiment overrides asynchronously
-     *
-     * @param context context
-     */
-    internal fun clearAllOverrides(context: Context) {
-        getSharedPreferencesEnabled(context)
-            .edit()
-            .clear()
-            .apply()
-        getSharedPreferencesBranch(context)
-            .edit()
-            .clear()
-            .apply()
-    }
-
-    /**
-     * Clears all experiment overrides as a blocking operation
-     *
-     * @param context context
-     */
-    @SuppressLint("ApplySharedPref")
-    internal fun clearAllOverridesNow(context: Context) {
-        require(Looper.myLooper() != Looper.getMainLooper()) { "This cannot be used on the main thread" }
-        clearAllOverrides(context)
-    }
-
-    private fun getSharedPreferencesBranch(context: Context) =
-        context.getSharedPreferences(PREF_NAME_OVERRIDES_BRANCH, Context.MODE_PRIVATE)
-
-    private fun getSharedPreferencesEnabled(context: Context) =
-        context.getSharedPreferences(PREF_NAME_OVERRIDES_ENABLED, Context.MODE_PRIVATE)
-
-    companion object {
-        private const val LOG_TAG = "experiments"
-
-        const val MAX_USER_BUCKET = 1000
-        // This stores a boolean; whether an experiment is active or not.
-        @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-        const val PREF_NAME_OVERRIDES_ENABLED = "mozilla.components.service.experiments.overrides.enabled"
-        // This stores a string; the active branch name for the experiment.
-        @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-        const val PREF_NAME_OVERRIDES_BRANCH = "mozilla.components.service.experiments.overrides.branch"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentPayload.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentPayload.kt
deleted file mode 100644
index 8dd5118365b8..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentPayload.kt
+++ /dev/null
@@ -1,102 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-/**
- * Class which represents an experiment associated data
- */
-internal class ExperimentPayload {
-    private val valuesMap = HashMap<String, Any>()
-
-    /**
-     * Puts a value into the payload
-     *
-     * @param key key
-     * @param value value to put under the key
-     */
-    fun put(key: String, value: Any) {
-        valuesMap[key] = value
-    }
-
-    /**
-     * Gets a value from the payload
-     *
-     * @param key key
-     *
-     * @return value under the specified key
-     */
-    fun get(key: String): Any? {
-        return valuesMap[key]
-    }
-
-    /**
-     * Gets all the payload keys
-     *
-     * @return set of payload keys
-     */
-    fun getKeys(): Set<String> {
-        return valuesMap.keys.toSet()
-    }
-
-    /**
-     * Gets a value from the payload as a list of Boolean
-     *
-     * @param key key
-     *
-     * @return value under the specified key as a list of Boolean
-     */
-    @Suppress("UNCHECKED_CAST")
-    fun getBooleanList(key: String): List<Boolean>? {
-        return get(key) as List<Boolean>?
-    }
-
-    /**
-     * Gets a value from the payload as a list of Int
-     *
-     * @param key key
-     *
-     * @return value under the specified key as a list of Int
-     */
-    @Suppress("UNCHECKED_CAST")
-    fun getIntList(key: String): List<Int>? {
-        return get(key) as List<Int>?
-    }
-
-    /**
-     * Gets a value from the payload as a list of Long
-     *
-     * @param key key
-     *
-     * @return value under the specified key as a list of Long
-     */
-    @Suppress("UNCHECKED_CAST")
-    fun getLongList(key: String): List<Long>? {
-        return get(key) as List<Long>?
-    }
-
-    /**
-     * Gets a value from the payload as a list of Double
-     *
-     * @param key key
-     *
-     * @return value under the specified key as a list of Double
-     */
-    @Suppress("UNCHECKED_CAST")
-    fun getDoubleList(key: String): List<Double>? {
-        return get(key) as List<Double>?
-    }
-
-    /**
-     * Gets a value from the payload as a list of String
-     *
-     * @param key key
-     *
-     * @return value under the specified key as a list of String
-     */
-    @Suppress("UNCHECKED_CAST")
-    fun getStringList(key: String): List<String>? {
-        return get(key) as List<String>?
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Experiments.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Experiments.kt
deleted file mode 100644
index 8a05efa7bcc8..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/Experiments.kt
+++ /dev/null
@@ -1,428 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.annotation.SuppressLint
-import android.content.Context
-import mozilla.components.support.base.log.logger.Logger
-import mozilla.components.service.glean.Glean
-import androidx.annotation.VisibleForTesting
-import kotlinx.coroutines.CoroutineScope
-import kotlinx.coroutines.Job
-import kotlinx.coroutines.ObsoleteCoroutinesApi
-import kotlinx.coroutines.launch
-import kotlinx.coroutines.newSingleThreadContext
-import java.io.File
-
-/**
- * This is the main experiments API, which is exposed through the global [Experiments] object.
- */
-@Suppress("TooManyFunctions")
-open class ExperimentsInternalAPI internal constructor() {
-    private val logger: Logger = Logger(LOG_TAG)
-
-    @Volatile internal var experimentsResult: ExperimentsSnapshot = ExperimentsSnapshot(listOf(), null)
-    private var experimentsLoaded: Boolean = false
-    private var evaluator: ExperimentEvaluator = ExperimentEvaluator(ValuesProvider())
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal var valuesProvider: ValuesProvider = ValuesProvider()
-        set(provider) {
-            field = provider
-            evaluator = ExperimentEvaluator(field)
-        }
-
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal var activeExperiment: ActiveExperiment? = null
-
-    private lateinit var storage: FlatFileExperimentStorage
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal lateinit var updater: ExperimentsUpdater
-
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal var isInitialized = false
-
-    internal lateinit var configuration: Configuration
-
-    private lateinit var context: Context
-
-    private var experimentsUpdatedCallback: (() -> Unit)? = null
-
-    /**
-     * A [CoroutineScope] used to dispatch initialization as to not block the calling thread.
-     */
-    @ObsoleteCoroutinesApi
-    private val coroutineScope by lazy {
-        CoroutineScope(newSingleThreadContext("MakoInitializerThread"))
-    }
-
-    // This is only for tests to be able to properly await initialize to minimize async issues.
-    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
-    internal var testInitJob: Job? = null
-
-    /**
-     * Initialize the experiments library.
-     *
-     * This should only be initialized once by the application.
-     *
-     * @param applicationContext [Context] to access application features, such
-     * as shared preferences.  As we cannot enforce through the compiler that the context pass to
-     * the initialize function is a applicationContext, there could potentially be a memory leak
-     * if the initializing application doesn't comply.
-     * @param configuration [Configuration] containing a HTTP client for fetching experiments and
-     * the experiments endpoint.
-     *
-     * @return Returns a [Job] so that off-thread initialization can be monitored and interacted
-     * with.
-     */
-    fun initialize(
-        applicationContext: Context,
-        configuration: Configuration,
-        onExperimentsUpdated: (() -> Unit)? = null
-    ) {
-        if (isInitialized) {
-            logger.error("Experiments library should not be initialized multiple times")
-            return
-        }
-        this.configuration = configuration
-
-        @Suppress("EXPERIMENTAL_API_USAGE")
-        testInitJob = coroutineScope.launch {
-            experimentsUpdatedCallback = onExperimentsUpdated
-
-            experimentsResult = ExperimentsSnapshot(listOf(), null)
-            experimentsLoaded = false
-            context = applicationContext
-            storage = getExperimentsStorage(applicationContext)
-
-            isInitialized = true
-
-            // Load cached experiments from storage. After this, experiments status is available.
-            loadExperiments()
-
-            // Load the active experiment from cache, if any.
-            activeExperiment = loadActiveExperiment(applicationContext, experiments)
-
-            // If no active experiment was loaded from cache, check the cached experiments list for any
-            // that should be launched now.
-            if (activeExperiment == null) {
-                findAndStartActiveExperiment()
-            }
-
-            // We now have the last known experiment state loaded for product code
-            // that needs to check it early in startup.
-            // Next we need to update the experiments list from the server async,
-            // without blocking the app launch and schedule future periodic
-            // updates.
-            updater = getExperimentsUpdater(applicationContext)
-            updater.initialize(configuration)
-        }
-    }
-
-    /**
-     * Returns the [ExperimentsUpdater] for the given [Context].
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getExperimentsUpdater(context: Context): ExperimentsUpdater {
-        return ExperimentsUpdater(context, this)
-    }
-
-    /**
-     * Returns the [FlatFileExperimentStorage] for the given [Context]
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getExperimentsStorage(context: Context): FlatFileExperimentStorage {
-        return FlatFileExperimentStorage(
-                File(context.getDir(EXPERIMENTS_DATA_DIR, Context.MODE_PRIVATE),
-                    EXPERIMENTS_JSON_FILENAME)
-        )
-    }
-
-    /**
-     * Provides the list of experiments (active or not)
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal val experiments: List<Experiment>
-        get() = experimentsResult.experiments.toList()
-
-    /**
-     * Loads experiments from local storage
-     */
-    @Synchronized
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun loadExperiments() {
-        experimentsResult = storage.retrieve()
-        experimentsLoaded = true
-    }
-
-    /**
-     * Handles the required tasks when new experiments have been fetched from the server.
-     *
-     * This includes:
-     * - Storing the experiments that have been freshly retrieved from the server.
-     * - Updating the active experiment
-     */
-    @Synchronized
-    internal fun onExperimentsUpdated(serverState: ExperimentsSnapshot) {
-        experimentsResult = serverState
-        storage.save(serverState)
-
-        // Choices here:
-        // 1) There currently is an active experiment.
-        // 1a) Should it stop? E.g. because it was deleted. If so, continue with 2.
-        // 1b) Should it continue? Then nothing else happens here.
-        // 2) There is no currently active experiment. Find one in the list, if any.
-        // 2a) If there is one...
-        // 2b) If there is none, nothing else happens.
-
-        activeExperiment?.let { active ->
-            if (experimentsResult.experiments.any { it.id == active.experiment.id }) {
-                // This covers 1b) - the active experiment should continue, no action needed.
-                logger.info("onExperimentsUpdated - currently active experiment will stay active")
-                return
-            } else {
-                // This covers 1a) - the experiment was removed.
-                // Afterwards, fall through to 2) below, which possibly starts a new experiment.
-                logger.info("onExperimentsUpdated - currently active experiment will be stopped")
-                stopActiveExperiment()
-            }
-        }
-
-        // This covers 2) - no experiment is currently active, so activate one if any match.
-        if (activeExperiment == null) {
-            logger.info("onExperimentsUpdated - no experiment currently active, looking for match")
-            findAndStartActiveExperiment()
-        }
-
-        // Invoke the callback provided to `initialize()` to report updated experiment status to
-        // the consuming application.
-        experimentsUpdatedCallback?.invoke()
-    }
-
-    /**
-     * Evaluates the current [experimentsResult] to determine enrollment in any experiments,
-     * including reporting enrollment in an experiment in Glean.
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun findAndStartActiveExperiment() {
-        evaluator.findActiveExperiment(context, experimentsResult.experiments)?.let {
-            logger.info("""Activating experiment - id="${it.experiment.id}", branch="${it.branch}"""")
-            activeExperiment = it
-            it.save(context)
-            Glean.setExperimentActive(it.experiment.id, it.branch)
-        }
-    }
-
-    /**
-     * Performs the necessary tasks to stop the active experiment, including reporting this to
-     * telemetry via Glean.
-     */
-    private fun stopActiveExperiment() {
-        activeExperiment?.let {
-            Glean.setExperimentInactive(it.experiment.id)
-        }
-
-        ActiveExperiment.clear(context)
-        activeExperiment = null
-    }
-
-    /**
-     * This function finds and returns any active experiments from persisted storage.
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun loadActiveExperiment(
-        context: Context,
-        experiments: List<Experiment>
-    ): ActiveExperiment? {
-        val activeExperiment = ActiveExperiment.load(context, experiments)
-
-        activeExperiment?.let {
-            Glean.setExperimentActive(it.experiment.id, it.branch)
-            logger.info("""Loaded active experiment from cache - id="${it.experiment.id}", branch="${it.branch}"""")
-        } ?: logger.info("No active experiment in cache")
-
-        return activeExperiment
-    }
-
-    /**
-     * Checks if the user is part of
-     * the specified experiment
-     *
-     * @param experimentId the id of the experiment
-     * @param branchName the name of the branch for the experiment
-     *
-     * @return true if the user is part of the specified experiment, false otherwise
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
-    internal fun isInExperiment(experimentId: String, branchName: String): Boolean {
-        return activeExperiment?.let {
-            (it.experiment.id == experimentId) &&
-            (it.branch == branchName)
-        } ?: false
-    }
-
-    /**
-     * Performs an action if the user is part of the specified experiment
-     *
-     * @param experimentId the id of the experiment
-     * @param block block of code to be executed if the user is part of the experiment
-     */
-    fun withExperiment(experimentId: String, block: (branch: String) -> Unit) {
-        activeExperiment?.let {
-            if (it.experiment.id == experimentId) {
-                block(it.branch)
-            }
-        }
-    }
-
-    /**
-     * Gets the metadata associated with the specified experiment, even if the user is not part of it
-     *
-     * @param experimentId the id of the experiment
-     *
-     * @return metadata associated with the experiment
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getExperiment(experimentId: String): Experiment? {
-        return evaluator.getExperiment(ExperimentDescriptor(experimentId), experimentsResult.experiments)
-    }
-
-    /**
-     * Helper function to perform the tasks necessary to override the experiment once it has been
-     * set using [setOverride] or [setOverrideNow].
-     */
-    private fun overrideActiveExperiment() {
-        evaluator.findActiveExperiment(context, experimentsResult.experiments)?.let {
-            logger.info("""Setting override experiment - id="${it.experiment.id}", branch="${it.branch}"""")
-            activeExperiment = it
-            Glean.setExperimentActive(it.experiment.id, it.branch)
-        }
-
-        // Invoke the callback provided to `initialize()` to report updated experiment status to
-        // the consuming application.
-        experimentsUpdatedCallback?.invoke()
-    }
-
-    /**
-     * Overrides a specified experiment asynchronously
-     *
-     * @param context context
-     * @param experimentId the id of the experiment
-     * @param active overridden value for the experiment, true to activate it, false to deactivate
-     * @param branchName overridden branch name for the experiment
-     */
-    internal fun setOverride(
-        context: Context,
-        experimentId: String,
-        active: Boolean,
-        branchName: String
-    ) {
-        evaluator.setOverride(context, ExperimentDescriptor(experimentId), active, branchName)
-        overrideActiveExperiment()
-    }
-
-    /**
-     * Overrides a specified experiment as a blocking operation
-     *
-     * @exception IllegalArgumentException when called from the main thread
-     * @param context context
-     * @param experimentId the id of the experiment
-     * @param active overridden value for the experiment, true to activate it, false to deactivate
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun setOverrideNow(
-        context: Context,
-        experimentId: String,
-        active: Boolean,
-        branchName: String
-    ) {
-        evaluator.setOverrideNow(context, ExperimentDescriptor(experimentId), active, branchName)
-        overrideActiveExperiment()
-    }
-
-    /**
-     * Clears an override for a specified experiment asynchronously
-     *
-     * @param context context
-     * @param experimentId the id of the experiment
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun clearOverride(context: Context, experimentId: String) {
-        evaluator.clearOverride(context, ExperimentDescriptor(experimentId))
-        activeExperiment = null
-        findAndStartActiveExperiment()
-    }
-
-    /**
-     * Clears an override for a specified experiment as a blocking operation
-     *
-     *
-     * @exception IllegalArgumentException when called from the main thread
-     * @param context context
-     * @param experimentId the id of the experiment
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun clearOverrideNow(context: Context, experimentId: String) {
-        evaluator.clearOverrideNow(context, ExperimentDescriptor(experimentId))
-        activeExperiment = null
-        findAndStartActiveExperiment()
-    }
-
-    /**
-     * Clears all experiment overrides asynchronously
-     *
-     * @param context context
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun clearAllOverrides(context: Context) {
-        evaluator.clearAllOverrides(context)
-        activeExperiment = null
-        findAndStartActiveExperiment()
-    }
-
-    /**
-     * Clears all experiment overrides as a blocking operation
-     *
-     * @exception IllegalArgumentException when called from the main thread
-     * @param context context
-     */
-    internal fun clearAllOverridesNow(context: Context) {
-        evaluator.clearAllOverridesNow(context)
-        activeExperiment = null
-        findAndStartActiveExperiment()
-    }
-
-    /**
-     * Returns the user bucket number used to determine whether the user
-     * is in or out of the experiment
-     *
-     * @param context context
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getUserBucket(context: Context): Int {
-        return evaluator.getUserBucket(context)
-    }
-
-    companion object {
-        private const val LOG_TAG = "experiments"
-        private const val EXPERIMENTS_DATA_DIR = "experiments-service"
-        private const val EXPERIMENTS_JSON_FILENAME = "experiments.json"
-    }
-}
-
-/**
- * The main Experiments object.
- *
- * This is a global object that must be initialized by the application by calling the [initialize]
- * function before the experiments library can fetch updates from the server or be used to determine
- * experiment enrollment.
- *
- * ```
- * Experiments.initialize(applicationContext)
- * ```
- */
-@SuppressLint("StaticFieldLeak")
-object Experiments : ExperimentsInternalAPI() {
-    internal const val SCHEMA_VERSION = 1
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsSerializer.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsSerializer.kt
deleted file mode 100644
index 95a53ba6273e..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsSerializer.kt
+++ /dev/null
@@ -1,64 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import org.json.JSONArray
-import org.json.JSONException
-import org.json.JSONObject
-
-/**
- * Helper class for serializing experiments
- * into the json format used to save them
- * locally on the device
- */
-internal class ExperimentsSerializer {
-    /**
-     * Transforms the given list of experiments to
-     * its json file representation
-     *
-     * @param snapshot experiment snapshot to serialize
-     *
-     * @return json file representation of the given experiments
-     */
-    fun toJson(snapshot: ExperimentsSnapshot): String {
-        val experimentsJson = JSONObject()
-        val experimentsJSONArray = JSONArray()
-        val jsonParser = JSONExperimentParser()
-        for (experiment in snapshot.experiments)
-            experimentsJSONArray.put(jsonParser.toJson(experiment))
-        experimentsJson.put(EXPERIMENTS_KEY, experimentsJSONArray)
-        experimentsJson.put(LAST_MODIFIED_KEY, snapshot.lastModified)
-        return experimentsJson.toString()
-    }
-
-    /**
-     * Creates a list of experiments given json
-     * representation, as stored locally inside a file
-     *
-     * @param json json file contents
-     *
-     * @return experiment snapshot with the parsed list of experiments
-     */
-    @Throws(JSONException::class)
-    fun fromJson(json: String): ExperimentsSnapshot {
-        val experimentsJson = JSONObject(json)
-        val experimentsJsonArray = experimentsJson.getJSONArray(EXPERIMENTS_KEY)
-        val experiments = ArrayList<Experiment>()
-        val jsonParser = JSONExperimentParser()
-        for (i in 0 until experimentsJsonArray.length())
-            experiments.add(jsonParser.fromJson(experimentsJsonArray[i] as JSONObject))
-        val lastModified = if (experimentsJson.has(LAST_MODIFIED_KEY)) {
-            experimentsJson.getLong(LAST_MODIFIED_KEY)
-        } else {
-            null
-        }
-        return ExperimentsSnapshot(experiments, lastModified)
-    }
-
-    companion object {
-        private const val EXPERIMENTS_KEY = "experiments"
-        private const val LAST_MODIFIED_KEY = "last_modified"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsSnapshot.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsSnapshot.kt
deleted file mode 100644
index e2c615ebd6f7..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsSnapshot.kt
+++ /dev/null
@@ -1,19 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-/**
- * Represents an experiment sync result
- */
-internal data class ExperimentsSnapshot(
-    /**
-     * Downloaded list of experiments
-     */
-    val experiments: List<Experiment>,
-    /**
-     * Last time experiments were modified on the server, as a UNIX timestamp
-     */
-    val lastModified: Long?
-)
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsUpdater.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsUpdater.kt
deleted file mode 100644
index 0c03de73cc61..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ExperimentsUpdater.kt
+++ /dev/null
@@ -1,151 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import androidx.annotation.VisibleForTesting
-import androidx.work.Constraints
-import androidx.work.ExistingPeriodicWorkPolicy
-import androidx.work.NetworkType
-import androidx.work.PeriodicWorkRequest
-import androidx.work.WorkManager
-import androidx.work.Worker
-import androidx.work.WorkerParameters
-import mozilla.components.support.base.log.logger.Logger
-import java.util.concurrent.TimeUnit
-
-/**
- * This class represents a [Worker] object that will fetch updates to the experiments.
- */
-internal class ExperimentsUpdaterWorker(
-    context: Context,
-    workerParameters: WorkerParameters
-) : Worker(context, workerParameters) {
-
-    override fun doWork(): Result {
-        return if (Experiments.updater.updateExperiments()) {
-            Result.success()
-        } else {
-            Result.failure()
-        }
-    }
-}
-
-/**
- * Class used to schedule sync of experiment
- * configuration from the server using WorkManager
- */
-internal class ExperimentsUpdater(
-    private val context: Context,
-    private val experiments: ExperimentsInternalAPI
-) {
-    private val logger: Logger = Logger(LOG_TAG)
-    internal lateinit var config: Configuration
-
-    internal lateinit var source: KintoExperimentSource
-
-    internal fun initialize(configuration: Configuration) {
-        config = configuration
-        source = getExperimentSource(configuration)
-
-        // Schedule the periodic experiment updates
-        scheduleUpdates()
-    }
-
-    /**
-     * Schedule update with the default constraints, but only if the periodic worker is not already
-     * scheduled.
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun scheduleUpdates() {
-        WorkManager.getInstance(context).enqueueUniquePeriodicWork(
-            TAG,
-            // We rely on REPLACE behavior to run immediately and then schedule the next update per
-            // the specified interval.  KEEP behavior does not run immediately and it is desired to
-            // have fresh experiments from the server on startup.
-            ExistingPeriodicWorkPolicy.REPLACE,
-            getWorkRequest())
-    }
-
-    /**
-     * Builds the periodic work request that will control the scheduling of the worker and provide
-     * the tag value so that the worker can be interacted with later.
-     *
-     * @return [PeriodicWorkRequest]
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getWorkRequest(): PeriodicWorkRequest {
-        return PeriodicWorkRequest.Builder(
-            ExperimentsUpdaterWorker::class.java, UPDATE_INTERVAL_HOURS, TimeUnit.HOURS)
-            .addTag(TAG)
-            .setConstraints(getWorkConstraints())
-            .build()
-    }
-
-    /**
-     * Builds the [Constraints] for when the worker is allowed to run.
-     *
-     * @return [Constraints]
-     */
-    @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-    internal fun getWorkConstraints(): Constraints {
-        return Constraints.Builder()
-            .setRequiredNetworkType(NetworkType.CONNECTED)
-            .build()
-    }
-
-    /**
-     * Returns the experiment source for which to update the experiments
-     *
-     * @return [KintoExperimentSource]
-     */
-    internal fun getExperimentSource(configuration: Configuration): KintoExperimentSource {
-        return KintoExperimentSource(
-                configuration.kintoEndpoint,
-                EXPERIMENTS_BUCKET_NAME,
-                EXPERIMENTS_COLLECTION_NAME,
-                configuration.httpClient
-        )
-    }
-
-    /**
-     * Requests new experiments from the server and
-     * saves them to local storage
-     *
-     * @return true if the experiments were updated, false if there was an [ExperimentDownloadException]
-     */
-    @Synchronized
-    internal fun updateExperiments(): Boolean {
-        return try {
-            val serverExperiments = source.getExperiments(experiments.experimentsResult)
-            logger.info("Experiments update from server: $serverExperiments")
-            experiments.onExperimentsUpdated(serverExperiments)
-            true
-        } catch (e: ExperimentDownloadException) {
-            // Keep using the local experiments
-            logger.error("Failed to update experiments: ${e.message}", e)
-            false
-        }
-    }
-
-    companion object {
-        private const val LOG_TAG = "experiments"
-
-        @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-        internal const val TAG = "mozilla.components.service.experiments"
-        @VisibleForTesting(otherwise = VisibleForTesting.PRIVATE)
-        internal const val UPDATE_INTERVAL_HOURS = 6L
-
-        // Where to access the experiments data in Kinto.
-        // Live example: https://firefox.settings.services.mozilla.com/v1/buckets/fennec/collections/experiments/records
-        // There are different base URIs to use:
-        const val KINTO_ENDPOINT_DEV = "https://kinto.dev.mozaws.net/v1"
-        const val KINTO_ENDPOINT_STAGING = "https://settings.stage.mozaws.net/v1"
-        const val KINTO_ENDPOINT_PROD = "https://firefox.settings.services.mozilla.com/v1"
-
-        private const val EXPERIMENTS_BUCKET_NAME = "main"
-        private const val EXPERIMENTS_COLLECTION_NAME = "mobile-experiments"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/FlatFileExperimentStorage.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/FlatFileExperimentStorage.kt
deleted file mode 100644
index c83015c5c3bd..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/FlatFileExperimentStorage.kt
+++ /dev/null
@@ -1,60 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.util.AtomicFile
-import mozilla.components.support.base.log.logger.Logger
-import org.json.JSONException
-import java.io.FileNotFoundException
-import java.io.File
-import java.io.IOException
-
-/**
- * Class which uses a flat JSON file as an experiment storage mechanism
- *
- * @param file file where to store experiments
- */
-internal class FlatFileExperimentStorage(file: File) {
-    private val atomicFile: AtomicFile = AtomicFile(file)
-    private val logger: Logger = Logger(LOG_TAG)
-
-    fun retrieve(): ExperimentsSnapshot {
-        return try {
-            val experimentsJson = String(atomicFile.readFully())
-            ExperimentsSerializer().fromJson(experimentsJson)
-        } catch (e: FileNotFoundException) {
-            logger.error("Caught error trying to retrieve experiments from storage: $e")
-            ExperimentsSnapshot(listOf(), null)
-        } catch (e: JSONException) {
-            // The JSON we read from disk is corrupt. There's nothing we can do here and therefore
-            // we just continue as if the file wouldn't exist.
-            logger.error("Caught error trying to retrieve experiments from storage: $e")
-            ExperimentsSnapshot(listOf(), null)
-        }
-    }
-
-    fun save(snapshot: ExperimentsSnapshot) {
-        val experimentsJson = ExperimentsSerializer().toJson(snapshot)
-
-        val stream = atomicFile.startWrite()
-        try {
-            stream.writer().use {
-                it.append(experimentsJson)
-            }
-
-            atomicFile.finishWrite(stream)
-        } catch (e: IOException) {
-            atomicFile.failWrite(stream)
-        }
-    }
-
-    fun delete() {
-        atomicFile.delete()
-    }
-
-    companion object {
-        private const val LOG_TAG = "experiments"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/JSONExperimentParser.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/JSONExperimentParser.kt
deleted file mode 100644
index 7af4495d7b99..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/JSONExperimentParser.kt
+++ /dev/null
@@ -1,156 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import mozilla.components.service.experiments.util.VersionString
-import mozilla.components.support.ktx.android.org.json.putIfNotNull
-import mozilla.components.support.ktx.android.org.json.toList
-import mozilla.components.support.ktx.android.org.json.tryGetLong
-import mozilla.components.support.ktx.android.org.json.tryGetString
-import org.json.JSONArray
-import org.json.JSONException
-import org.json.JSONObject
-
-/**
- * Default JSON parsing implementation
- */
-internal class JSONExperimentParser {
-    /**
-     * Creates an experiment from its json representation
-     *
-     * @param jsonObject experiment json object
-     * @return created experiment
-     */
-    fun fromJson(jsonObject: JSONObject): Experiment {
-        val bucketsObject: JSONObject = jsonObject.getJSONObject(BUCKETS_KEY)
-        val bucket = Experiment.Buckets(
-            bucketsObject.getInt(BUCKETS_START_KEY),
-            bucketsObject.getInt(BUCKETS_COUNT_KEY)
-        )
-
-        val branchesJSONList: List<JSONObject> = jsonObject.getJSONArray(BRANCHES_KEY).toList()
-        val branches = branchesJSONList.map {
-            Experiment.Branch(
-                it.getString(BRANCHES_NAME_KEY),
-                it.getInt(BRANCHES_RATIO_KEY)
-            )
-        }
-        if (branches.isEmpty()) {
-            throw JSONException("Branches array should not be empty")
-        }
-
-        val matchObject: JSONObject = jsonObject.getJSONObject(MATCH_KEY)
-        val regions: List<String>? = matchObject.optJSONArray(MATCH_REGIONS_KEY)?.toList()
-        val debugTags: List<String>? = matchObject.optJSONArray(MATCH_DEBUG_TAGS_KEY)?.toList()
-        val matcher = Experiment.Matcher(
-                appId = matchObject.tryGetString(MATCH_APP_ID_KEY),
-                appDisplayVersion = matchObject.tryGetString(MATCH_APP_DISPLAY_VERSION_KEY),
-                appMinVersion = matchObject.tryGetVersionString(MATCH_APP_MIN_VERSION_KEY),
-                appMaxVersion = matchObject.tryGetVersionString(MATCH_APP_MAX_VERSION_KEY),
-                localeLanguage = matchObject.tryGetString(MATCH_LOCALE_LANGUAGE_KEY),
-                localeCountry = matchObject.tryGetString(MATCH_LOCALE_COUNTRY_KEY),
-                deviceManufacturer = matchObject.tryGetString(MATCH_DEVICE_MANUFACTURER_KEY),
-                deviceModel = matchObject.tryGetString(MATCH_DEVICE_MODEL_KEY),
-                regions = regions,
-                debugTags = debugTags
-        )
-
-        return Experiment(
-            id = jsonObject.getString(ID_KEY),
-            description = jsonObject.getString(DESCRIPTION_KEY),
-            lastModified = jsonObject.tryGetLong(LAST_MODIFIED_KEY),
-            schemaModified = jsonObject.tryGetLong(SCHEMA_KEY),
-            buckets = bucket,
-            branches = branches,
-            match = matcher
-        )
-    }
-
-    /**
-     * Converts the specified experiment to json
-     *
-     * @param experiment experiment to convert
-     *
-     * @return json representation of the experiment
-     */
-    fun toJson(experiment: Experiment): JSONObject {
-        val jsonObject = JSONObject()
-
-        jsonObject.put(ID_KEY, experiment.id)
-        jsonObject.put(DESCRIPTION_KEY, experiment.description)
-        jsonObject.putIfNotNull(LAST_MODIFIED_KEY, experiment.lastModified)
-        jsonObject.putIfNotNull(SCHEMA_KEY, experiment.schemaModified)
-
-        val bucketsObject = JSONObject()
-        bucketsObject.put(BUCKETS_START_KEY, experiment.buckets.start)
-        bucketsObject.put(BUCKETS_COUNT_KEY, experiment.buckets.count)
-        jsonObject.put(BUCKETS_KEY, bucketsObject)
-
-        val branchesList = JSONArray()
-        experiment.branches.forEach {
-            val branchObject = JSONObject()
-            branchObject.put(BRANCHES_NAME_KEY, it.name)
-            branchObject.put(BRANCHES_RATIO_KEY, it.ratio)
-            branchesList.put(branchObject)
-        }
-        jsonObject.put(BRANCHES_KEY, branchesList)
-
-        val matchObject = matchersToJson(experiment)
-        jsonObject.put(MATCH_KEY, matchObject)
-
-        return jsonObject
-    }
-
-    private fun matchersToJson(experiment: Experiment): JSONObject {
-        val matchObject = JSONObject()
-        matchObject.putIfNotNull(MATCH_APP_ID_KEY, experiment.match.appId)
-        matchObject.putIfNotNull(MATCH_APP_DISPLAY_VERSION_KEY, experiment.match.appDisplayVersion)
-        matchObject.putIfNotNull(MATCH_APP_MIN_VERSION_KEY, experiment.match.appMinVersion)
-        matchObject.putIfNotNull(MATCH_APP_MAX_VERSION_KEY, experiment.match.appMaxVersion)
-        matchObject.putIfNotNull(MATCH_LOCALE_COUNTRY_KEY, experiment.match.localeCountry)
-        matchObject.putIfNotNull(MATCH_LOCALE_LANGUAGE_KEY, experiment.match.localeLanguage)
-        matchObject.putIfNotNull(MATCH_DEVICE_MANUFACTURER_KEY, experiment.match.deviceManufacturer)
-        matchObject.putIfNotNull(MATCH_DEVICE_MODEL_KEY, experiment.match.deviceModel)
-        matchObject.putIfNotNull(MATCH_REGIONS_KEY, experiment.match.regions?.let { JSONArray(it) })
-        matchObject.putIfNotNull(MATCH_DEBUG_TAGS_KEY, experiment.match.debugTags?.let { JSONArray(it) })
-        return matchObject
-    }
-
-    companion object {
-        private const val ID_KEY = "id"
-        private const val DESCRIPTION_KEY = "description"
-        private const val LAST_MODIFIED_KEY = "last_modified"
-        private const val SCHEMA_KEY = "schema"
-
-        private const val BUCKETS_KEY = "buckets"
-        private const val BUCKETS_START_KEY = "start"
-        private const val BUCKETS_COUNT_KEY = "count"
-
-        private const val BRANCHES_KEY = "branches"
-        private const val BRANCHES_NAME_KEY = "name"
-        private const val BRANCHES_RATIO_KEY = "ratio"
-
-        private const val MATCH_KEY = "match"
-        private const val MATCH_APP_ID_KEY = "app_id"
-        private const val MATCH_APP_DISPLAY_VERSION_KEY = "app_display_version"
-        private const val MATCH_APP_MIN_VERSION_KEY = "app_min_version"
-        private const val MATCH_APP_MAX_VERSION_KEY = "app_max_version"
-        private const val MATCH_LOCALE_COUNTRY_KEY = "locale_country"
-        private const val MATCH_LOCALE_LANGUAGE_KEY = "locale_language"
-        private const val MATCH_DEVICE_MANUFACTURER_KEY = "device_manufacturer"
-        private const val MATCH_DEVICE_MODEL_KEY = "device_model"
-        private const val MATCH_REGIONS_KEY = "regions"
-        private const val MATCH_DEBUG_TAGS_KEY = "debug_tags"
-    }
-}
-
-private fun JSONObject.tryGetVersionString(key: String): VersionString? {
-    val s = tryGetString(key)
-    if (s != null) {
-        return VersionString(s)
-    } else {
-        return null
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/KintoClient.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/KintoClient.kt
deleted file mode 100644
index f814e15ce7ba..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/KintoClient.kt
+++ /dev/null
@@ -1,95 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import mozilla.components.concept.fetch.Client
-import mozilla.components.concept.fetch.MutableHeaders
-import mozilla.components.concept.fetch.Request
-import mozilla.components.concept.fetch.isSuccess
-import mozilla.components.support.base.log.logger.Logger
-import java.io.IOException
-
-/**
- * Helper class to make it easier to interact with Kinto
- *
- * @property httpClient http client to use
- * @property baseUrl Kinto server url
- * @property bucketName name of the bucket to fetch
- * @property collectionName name of the collection to fetch
- * @property headers headers to provide along with the request
- */
-internal class KintoClient(
-    private val httpClient: Client,
-    private val baseUrl: String,
-    private val bucketName: String,
-    private val collectionName: String,
-    private val headers: Map<String, String>? = null
-) {
-    private val logger: Logger = Logger(LOG_TAG)
-
-    /**
-     * Returns all records from the collection
-     *
-     * @return Kinto response with all records
-     */
-    fun get(): String {
-        return fetch(recordsUrl())
-    }
-
-    /**
-     * Performs a diff, given the last_modified time
-     *
-     * @param lastModified last modified time as a UNIX timestamp
-     *
-     * @return Kinto diff response
-     */
-    fun diff(lastModified: Long): String {
-        return fetch("${recordsUrl()}?_since=$lastModified")
-    }
-
-    /**
-     * Gets the collection associated metadata
-     *
-     * @return collection metadata
-     */
-    fun getMetadata(): String {
-        return fetch(collectionUrl())
-    }
-
-    @Suppress("TooGenericExceptionCaught", "ThrowsCount")
-    internal fun fetch(url: String): String {
-        try {
-            val headers = MutableHeaders().also {
-                headers?.forEach { (k, v) -> it.append(k, v) }
-            }
-
-            val request = Request(url, headers = headers, useCaches = false)
-
-            logger.info("Fetching experiments from $url")
-            val response = httpClient.fetch(request)
-            if (!response.isSuccess) {
-                logger.error("Error fetching experiments, status code ${response.status} for $url")
-                throw ExperimentDownloadException("Status code: ${response.status}")
-            }
-            val body = response.body.string()
-            logger.debug("Fetched experiments from $url:\n$body")
-            return body
-        } catch (e: IOException) {
-            throw ExperimentDownloadException(e)
-        } catch (e: ArrayIndexOutOfBoundsException) {
-            // On some devices we are seeing an ArrayIndexOutOfBoundsException being thrown
-            // somewhere inside AOSP/okhttp.
-            // See: https://github.com/mozilla-mobile/android-components/issues/964
-            throw ExperimentDownloadException(e)
-        }
-    }
-
-    private fun recordsUrl() = "${collectionUrl()}/records"
-    private fun collectionUrl() = "$baseUrl/buckets/$bucketName/collections/$collectionName"
-
-    companion object {
-        private const val LOG_TAG = "experiments"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/KintoExperimentSource.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/KintoExperimentSource.kt
deleted file mode 100644
index f24b99307abb..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/KintoExperimentSource.kt
+++ /dev/null
@@ -1,86 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import mozilla.components.concept.fetch.Client
-import org.json.JSONException
-import org.json.JSONObject
-
-/**
- * Class responsible for fetching and
- * parsing experiments from a Kinto server
- *
- * @property baseUrl Kinto server url
- * @property bucketName name of the bucket to fetch
- * @property collectionName name of the collection to fetch
- * @param httpClient the http client to use.
- * @property validateSignature specifies whether or not the signature should be
- * validated, defaults to false.
- */
-internal class KintoExperimentSource(
-    internal val baseUrl: String,
-    private val bucketName: String,
-    private val collectionName: String,
-    private val httpClient: Client,
-    private val validateSignature: Boolean = false
-) {
-    private val kintoClient = KintoClient(httpClient, baseUrl, bucketName, collectionName)
-    private val signatureVerifier = SignatureVerifier(httpClient, kintoClient)
-
-    @Throws(ExperimentDownloadException::class)
-    fun getExperiments(snapshot: ExperimentsSnapshot): ExperimentsSnapshot {
-        val experimentsDiff = getExperimentsDiff(snapshot)
-        val updatedSnapshot = mergeExperimentsFromDiff(experimentsDiff, snapshot)
-        if (validateSignature &&
-            !signatureVerifier.validSignature(updatedSnapshot.experiments, updatedSnapshot.lastModified)) {
-            throw ExperimentDownloadException("Signature verification failed")
-        }
-        return updatedSnapshot
-    }
-
-    private fun getExperimentsDiff(snapshot: ExperimentsSnapshot): String {
-        val lastModified = snapshot.lastModified
-        return if (lastModified != null) {
-            kintoClient.diff(lastModified)
-        } else {
-            kintoClient.get()
-        }
-    }
-
-    private fun mergeExperimentsFromDiff(experimentsDiff: String, snapshot: ExperimentsSnapshot): ExperimentsSnapshot {
-        val experiments = snapshot.experiments
-        var maxLastModified: Long? = snapshot.lastModified
-        val mutableExperiments = experiments.toMutableList()
-        val experimentParser = JSONExperimentParser()
-        try {
-            val diffJsonObject = JSONObject(experimentsDiff)
-            val experimentsJsonArray = diffJsonObject.getJSONArray(DATA_KEY)
-            for (i in 0 until experimentsJsonArray.length()) {
-                val experimentJsonObject = experimentsJsonArray.getJSONObject(i)
-                val experiment = mutableExperiments.singleOrNull { it.id == experimentJsonObject.getString(ID_KEY) }
-                if (experiment != null) {
-                    mutableExperiments.remove(experiment)
-                }
-                if (!experimentJsonObject.has(DELETED_KEY)) {
-                    mutableExperiments.add(experimentParser.fromJson(experimentJsonObject))
-                }
-                val lastModifiedDate = experimentJsonObject.getLong(LAST_MODIFIED_KEY)
-                if (maxLastModified == null || lastModifiedDate > maxLastModified) {
-                    maxLastModified = lastModifiedDate
-                }
-            }
-        } catch (e: JSONException) {
-            throw ExperimentDownloadException(e)
-        }
-        return ExperimentsSnapshot(mutableExperiments, maxLastModified)
-    }
-
-    companion object {
-        private const val ID_KEY = "id"
-        private const val DATA_KEY = "data"
-        private const val DELETED_KEY = "deleted"
-        private const val LAST_MODIFIED_KEY = "last_modified"
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/SignatureVerifier.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/SignatureVerifier.kt
deleted file mode 100644
index 3603e0f18d14..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/SignatureVerifier.kt
+++ /dev/null
@@ -1,263 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.util.Base64
-import mozilla.components.concept.fetch.Client
-import mozilla.components.concept.fetch.Request
-import org.json.JSONArray
-import org.json.JSONObject
-import java.io.ByteArrayInputStream
-import java.math.BigInteger
-import java.nio.charset.StandardCharsets
-import java.security.InvalidKeyException
-import java.security.NoSuchAlgorithmException
-import java.security.NoSuchProviderException
-import java.security.PublicKey
-import java.security.Signature
-import java.security.SignatureException
-import java.security.cert.CertificateException
-import java.security.cert.CertificateFactory
-import java.security.cert.X509Certificate
-import java.util.Date
-import java.util.concurrent.TimeUnit
-
-/**
- * This class is used to validate the signature of the downloaded list of experiments
- */
-internal class SignatureVerifier(
-    private val client: Client,
-    private val kintoClient: KintoClient,
-    private val currentDate: Date = Date()
-) {
-    /**
-     * Checks the signature of an experiment list against the signature found on the
-     * metadata JSON object, using the certificates found on the x5u field
-     *
-     * @param experiments experiment list
-     * @param lastModified last modified time of the experiment list
-     *
-     * @return true if the list of experiments validates against the signature, false otherwise
-     */
-    internal fun validSignature(experiments: List<Experiment>, lastModified: Long?): Boolean {
-        val sortedExperiments = experiments.sortedBy { it.id }
-        val resultJson = JSONArray()
-        val parser = JSONExperimentParser()
-        for (experiment in sortedExperiments) {
-            resultJson.put(parser.toJson(experiment))
-        }
-        val metadata: String? = kintoClient.getMetadata()
-        metadata?.let {
-            val metadataJson = JSONObject(metadata).getJSONObject(DATA_KEY)
-            val signatureJson = metadataJson.getJSONObject(SIGNATURE_KEY)
-            val signature = signatureJson.getString(SIGNATURE_KEY)
-            val publicKey = getX5U(signatureJson.getString(X5U_KEY))
-            val resultJsonString = resultJson.toString().replace("\\/", "/")
-            val data = "$SIGNATURE_PREFIX{\"data\":$resultJsonString,\"last_modified\":\"$lastModified\"}"
-            return validSignature(data, signature, publicKey)
-        }
-        return true
-    }
-
-    /**
-     * Retrieves the public key from the end-entity certificate from the certificate chain
-     * located on the given URL from the X5U field
-     *
-     * @param url url of the certificate chain
-     *
-     * @throws ExperimentDownloadException if the certificate chain format is invalid
-     *
-     * @return public key of the end-entity certificate
-     */
-    private fun getX5U(url: String): PublicKey {
-        val certs = ArrayList<X509Certificate>()
-        val cf = CertificateFactory.getInstance("X.509")
-        val response = client.fetch(Request(url))
-        response.body.useBufferedReader {
-            val firstLine = it.readLine()
-            if (firstLine != "-----BEGIN CERTIFICATE-----") {
-                throw ExperimentDownloadException("")
-            }
-            var certPem = firstLine
-            certPem += '\n'
-
-            it.readLines().forEach { line ->
-                certPem += line
-                certPem += '\n'
-                if (line == "-----END CERTIFICATE-----") {
-                    val cert = cf.generateCertificate(ByteArrayInputStream(certPem.toByteArray()))
-                    certs.add(cert as X509Certificate)
-                    certPem = ""
-                }
-            }
-            if (certs.count() < MIN_CERTIFICATES) {
-                throw ExperimentDownloadException("The chain must contain at least 2 certificates")
-            }
-            verifyCertChain(certs)
-        }
-        return certs[0].publicKey
-    }
-
-    /**
-     * Verifies the validity of the certificates on the chain
-     *
-     * @param certificates certificates
-     *
-     * @throws ExperimentDownloadException if any certificate is not valid
-     */
-    private fun verifyCertChain(certificates: List<X509Certificate>) {
-        for (i in 0 until certificates.count()) {
-            val cert = certificates[i]
-            if (!isCertValid(cert)) {
-                throw ExperimentDownloadException("Certificate expired or not yet valid")
-            }
-            if ((i + 1) == certificates.count()) {
-                verifyRoot(cert)
-            } else {
-                verifyCertSignedByParent(cert, i, certificates)
-            }
-        }
-    }
-
-    /**
-     * Verifies that the certificate is signed by its parent on the chain
-     *
-     * @param certificate certificate
-     * @param index index of the certificate on the chain
-     * @param certificates certificate chain
-     *
-     * @throws ExperimentDownloadException if the certificate chain is invalid
-     *
-     * @return true if the certificate is signed by its parent on the chain, false otherwise
-     */
-    private fun verifyCertSignedByParent(
-        certificate: X509Certificate,
-        index: Int,
-        certificates: List<X509Certificate>
-    ) {
-        try {
-            certificate.verify(certificates[index + 1].publicKey)
-        } catch (e: CertificateException) {
-            invalidCertChain(e)
-        } catch (e: NoSuchAlgorithmException) {
-            invalidCertChain(e)
-        } catch (e: InvalidKeyException) {
-            invalidCertChain(e)
-        } catch (e: NoSuchProviderException) {
-            invalidCertChain(e)
-        } catch (e: SignatureException) {
-            invalidCertChain(e)
-        }
-    }
-
-    private fun invalidCertChain(e: Exception) {
-        throw ExperimentDownloadException(e)
-    }
-
-    /**
-     * Checks the certificate validity. It checks against a window of 30 days
-     *
-     * @param certificate certificate to check
-     *
-     * @return true if the certificate is still valid (with a 30-day window), false otherwise
-     */
-    private fun isCertValid(certificate: X509Certificate): Boolean {
-        val notBefore = certificate.notBefore
-        val notAfter = certificate.notAfter
-        return currentDate.time >= (notBefore.time - TimeUnit.DAYS.toMillis(CERT_VALIDITY_ROOM_DAYS)) &&
-            (notAfter.time + TimeUnit.DAYS.toMillis(CERT_VALIDITY_ROOM_DAYS)) >= currentDate.time
-    }
-
-    /**
-     * Verifies the root certificate of the chain, checking that the issuer matches the subject
-     *
-     * @param certificate root certificate
-     *
-     * @throws ExperimentDownloadException if the root certificate fails the verification
-     */
-    private fun verifyRoot(certificate: X509Certificate) {
-        val subject = certificate.subjectDN.name
-        val issuer = certificate.issuerDN.name
-        if (subject != issuer) {
-            throw ExperimentDownloadException("subject does not match issuer")
-        }
-    }
-
-    /**
-     * Validates the signature of a signed data, given a signature and a public key using ECDSA
-     * with curve P-384 and SHA-384
-
-     * @param signedData signed data
-     * @param signature signature
-     * @param publicKey public key
-     *
-     * @return true if the signed data validates against the signature
-     */
-    private fun validSignature(signedData: String, signature: String, publicKey: PublicKey): Boolean {
-        val dsa = Signature.getInstance("SHA384withECDSA")
-        dsa.initVerify(publicKey)
-        dsa.update(signedData.toByteArray(StandardCharsets.UTF_8))
-        val signatureBytes = Base64.decode(signature.replace("-", "+").replace("_", "/"), 0)
-        return dsa.verify(signatureToASN1(signatureBytes))
-    }
-
-    /**
-     * Converts signature bytes into the ASN1 DER format. The provided bytes contain r and s values
-     * concatenated, and the implementation converts these two values into the DER format
-
-     * @param signatureBytes signatures bytes, r and s values concatenated
-     *
-     * @throws ExperimentDownloadException if the signature is not valid
-     *
-     * @return DER-encoded signature bytes
-     */
-    private fun signatureToASN1(signatureBytes: ByteArray): ByteArray {
-        if (signatureBytes.count() == 0 || signatureBytes.count() % 2 != 0) {
-            throw ExperimentDownloadException("Invalid signature")
-        }
-        var rBytes = ByteArray(signatureBytes.count() / 2)
-        for (i in 0 until signatureBytes.count() / 2) {
-            rBytes += signatureBytes[i]
-        }
-        var sBytes = ByteArray(signatureBytes.count() / 2)
-        for (i in signatureBytes.count() / 2 until signatureBytes.count()) {
-            sBytes += signatureBytes[i]
-        }
-        val r = BigInteger(rBytes)
-        val s = BigInteger(sBytes)
-        rBytes = r.toByteArray()
-        sBytes = s.toByteArray()
-        val res = ByteArray(NUMBER_OF_DER_ADDITIONAL_BYTES + rBytes.size + sBytes.size)
-        res[START_POS] = FIRST_DER_NUMBER
-        res[B1_POS] = (REMAINING_DER_ADDITIONAL_BYTES + rBytes.size + sBytes.size).toByte()
-        res[SECOND_NUMBER_POS] = SECOND_DER_NUMBER
-        res[B2_POS] = rBytes.size.toByte()
-        System.arraycopy(rBytes, START_POS, res, R_POS, rBytes.size)
-        res[R_POS + rBytes.size] = SECOND_DER_NUMBER
-        res[B3_POS + rBytes.size] = sBytes.size.toByte()
-        System.arraycopy(sBytes, START_POS, res, S_POS + rBytes.size, sBytes.size)
-        return res
-    }
-
-    companion object {
-        private const val DATA_KEY = "data"
-        private const val SIGNATURE_KEY = "signature"
-        private const val X5U_KEY = "x5u"
-        private const val CERT_VALIDITY_ROOM_DAYS = 30L
-        private const val MIN_CERTIFICATES = 2
-        private const val SIGNATURE_PREFIX = "Content-Signature:\u0000"
-        private const val NUMBER_OF_DER_ADDITIONAL_BYTES = 6
-        private const val FIRST_DER_NUMBER: Byte = 0x30
-        private const val REMAINING_DER_ADDITIONAL_BYTES = 4
-        private const val SECOND_DER_NUMBER: Byte = 0x02
-        private const val START_POS = 0
-        private const val B1_POS = 1
-        private const val SECOND_NUMBER_POS = 2
-        private const val B2_POS = 3
-        private const val R_POS = 4
-        private const val B3_POS = 5
-        private const val S_POS = 6
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ValuesProvider.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ValuesProvider.kt
deleted file mode 100644
index 9ed3f7adb7e2..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/ValuesProvider.kt
+++ /dev/null
@@ -1,123 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import android.os.Build
-import java.util.Locale
-import java.util.MissingResourceException
-import kotlin.random.Random
-
-/**
- * Class used to provide
- * custom filter values
- */
-@Suppress("TooManyFunctions")
-internal open class ValuesProvider {
-    /**
-     * Provides the user's language
-     *
-     * @return user's language as a three-letter abbreviation
-     */
-    open fun getLanguage(context: Context): String {
-        return try {
-            Locale.getDefault().isO3Language
-        } catch (e: MissingResourceException) {
-            Locale.getDefault().language
-        }
-    }
-
-    /**
-     * Provides the app name (package name)
-     *
-     * @return app name (package name)
-     */
-    open fun getAppId(context: Context): String {
-        return context.packageName
-    }
-
-    /**
-     * Provides the user's region
-     *
-     * @return user's region as a three-letter abbreviation
-     */
-    open fun getRegion(context: Context): String? {
-        return null
-    }
-
-    /**
-     * Provides the app version
-     *
-     * @return app version name
-     */
-    open fun getVersion(context: Context): String? {
-        return context.packageManager.getPackageInfo(context.packageName, 0).versionName
-    }
-
-    /**
-     * Provides the device manufacturer
-     *
-     * @return device manufacturer
-     */
-    open fun getManufacturer(context: Context): String {
-        return Build.MANUFACTURER
-    }
-
-    /**
-     * Provides the device model
-     *
-     * @return device model
-     */
-    open fun getDevice(context: Context): String {
-        return Build.DEVICE
-    }
-
-    /**
-     * Provides the user's country
-     *
-     * @return user's country, as a three-letter abbreviation
-     */
-    open fun getCountry(context: Context): String {
-        return try {
-            Locale.getDefault().isO3Country
-        } catch (e: MissingResourceException) {
-            Locale.getDefault().country
-        }
-    }
-
-    /**
-     * Provides the app's release channel (alpha, beta, ...)
-     *
-     * @return release channel of the app
-     */
-    open fun getReleaseChannel(context: Context): String? {
-        return null
-    }
-
-    /**
-     * Provides the client ID (UUID) used for bucketing the users.
-     */
-    open fun getClientId(context: Context): String {
-        return DeviceUuidFactory(context).uuid
-    }
-
-    /**
-     * Provides a random value for choosing an experiment branch within the given boundaries.
-     *
-     * @return a random branch value
-     */
-    open fun getRandomBranchValue(lower: Int, upper: Int): Int {
-        return Random.nextInt(lower, upper)
-    }
-
-    /**
-     * Provides a debug tag for the user if set.
-     *
-     * @return the users debug tag or null.
-     */
-    open fun getDebugTag(): String? {
-        return null
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/debug/ExperimentsDebugActivity.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/debug/ExperimentsDebugActivity.kt
deleted file mode 100644
index 0e53d73c919f..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/debug/ExperimentsDebugActivity.kt
+++ /dev/null
@@ -1,128 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments.debug
-
-import android.app.Activity
-import android.os.Bundle
-import androidx.annotation.VisibleForTesting
-import kotlinx.coroutines.Dispatchers
-import kotlinx.coroutines.GlobalScope
-import kotlinx.coroutines.Job
-import kotlinx.coroutines.launch
-import mozilla.components.service.experiments.Configuration
-import mozilla.components.service.experiments.Experiments
-import mozilla.components.service.experiments.ExperimentsUpdater
-import mozilla.components.support.base.log.logger.Logger
-
-/**
- * Debugging activity exported by service-experiments to allow easier debugging. This accepts
- * commands that can force the library to do the following:
- * - Fetch or update experiments
- * - Change the Kinto endpoint to the `dev`, `staging`, or `prod` endpoint
- * - Override the active experiment to a branch specified by the `branch` command
- * - Clear any overridden experiment
- *
- * See here for more information on using the ExperimentsDebugActivity:
- * https://github.com/mozilla-mobile/android-components/tree/master/components/service/experiments#experimentsdebugactivity-usage
- *
- * See the adb developer docs for more info:
- * https://developer.android.com/studio/command-line/adb#am
- */
-class ExperimentsDebugActivity : Activity() {
-    private val logger = Logger(LOG_TAG)
-
-    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
-    internal var updateJob: Job? = null
-    @VisibleForTesting(otherwise = VisibleForTesting.NONE)
-    internal var clearJob: Job? = null
-
-    companion object {
-        private const val LOG_TAG = "ExperimentsDebugActivity"
-
-        // This is a list of the currently accepted commands
-        /**
-         * Fetch experiments from the server and update the active experiment if necessary.
-         */
-        const val UPDATE_EXPERIMENTS_EXTRA_KEY = "updateExperiments"
-        /**
-         * Sets the Kinto endpoint to the supplied endpoint.
-         * Must be one of: `dev`, `staging`, or `prod`.
-         */
-        const val SET_KINTO_INSTANCE_EXTRA_KEY = "setKintoInstance"
-        /**
-         * Overrides the current experiment and set the active experiment to the given `branch`.
-         * This command requires two parameters to be passed, `overrideExperiment` and `branch` in
-         * order for it to work.
-         */
-        const val OVERRIDE_EXPERIMENT_EXTRA_KEY = "overrideExperiment"
-        /**
-         * Used only with [OVERRIDE_EXPERIMENT_EXTRA_KEY].
-         */
-        const val OVERRIDE_BRANCH_EXTRA_KEY = "branch"
-        /**
-         * Clears any existing overrides.
-         */
-        const val OVERRIDE_CLEAR_ALL_EXTRA_KEY = "clearAllOverrides"
-    }
-
-    /**
-     * On creation of the debug activity, process the command switches
-     */
-    @Suppress("ComplexMethod")
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
-
-        logger.debug("onCreate")
-
-        if (intent.hasExtra(UPDATE_EXPERIMENTS_EXTRA_KEY)) {
-            logger.info("Force update of experiments")
-            updateJob = GlobalScope.launch(Dispatchers.IO) {
-                Experiments.updater.updateExperiments()
-            }
-        }
-
-        if (intent.hasExtra(SET_KINTO_INSTANCE_EXTRA_KEY)) {
-            val config: Configuration? = when (intent.getStringExtra(SET_KINTO_INSTANCE_EXTRA_KEY)) {
-                "dev" -> Experiments.configuration.copy(
-                    kintoEndpoint = ExperimentsUpdater.KINTO_ENDPOINT_DEV)
-                "staging" -> Experiments.configuration.copy(
-                    kintoEndpoint = ExperimentsUpdater.KINTO_ENDPOINT_STAGING)
-                "prod" -> Experiments.configuration.copy(
-                    kintoEndpoint = ExperimentsUpdater.KINTO_ENDPOINT_PROD)
-                else -> null
-            }
-
-            config?.let {
-                logger.info("Changing Kinto instance to ${config.kintoEndpoint}")
-                // Update the default config
-                Experiments.configuration = config
-                // Also update the updater's copy of the config
-                Experiments.updater.config = config
-                // Reset the source to use the new endpoint
-                Experiments.updater.source = Experiments.updater.getExperimentSource(config)
-            }
-        }
-
-        if (intent.hasExtra(OVERRIDE_CLEAR_ALL_EXTRA_KEY)) {
-            logger.info("Clearing all experiment overrides")
-            clearJob = GlobalScope.launch(Dispatchers.IO) {
-                Experiments.clearAllOverridesNow(applicationContext)
-            }
-        } else if (intent.hasExtra(OVERRIDE_EXPERIMENT_EXTRA_KEY) &&
-            intent.hasExtra(OVERRIDE_BRANCH_EXTRA_KEY)) {
-            val experiment = intent.getStringExtra(OVERRIDE_EXPERIMENT_EXTRA_KEY)
-            val branch = intent.getStringExtra(OVERRIDE_BRANCH_EXTRA_KEY)
-            if (experiment != null && branch != null) {
-                logger.info("Override to the following experiment/branch:$experiment/$branch")
-                Experiments.setOverride(applicationContext, experiment, true, branch)
-            }
-        }
-
-        val intent = packageManager.getLaunchIntentForPackage(packageName)
-        startActivity(intent)
-
-        finish()
-    }
-}
diff --git a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/util/VersionString.kt b/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/util/VersionString.kt
deleted file mode 100644
index 644f282da046..000000000000
--- a/android-components/components/service/experiments/src/main/java/mozilla/components/service/experiments/util/VersionString.kt
+++ /dev/null
@@ -1,82 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments.util
-
-import kotlin.math.max
-
-internal class VersionString(
-    val version: String
-) : Comparable<VersionString> {
-    companion object {
-        // Validates that the version matches expected version formatting
-        // This matches any number of digits separated by dots.
-        // Valid examples:
-        //  1.0.1
-        //  1.0
-        //  10.4.123545
-        // Invalid examples:
-        // a.b.c
-        // Not.a.version
-        // 12.1.1A
-        val VERSION_REGEX = "[0-9]+(\\.[0-9]+)*".toRegex()
-    }
-
-    @Suppress("ComplexMethod")
-    override fun compareTo(other: VersionString): Int {
-        if (!isValid()) {
-            throw IllegalArgumentException("Unexpected format in VersionString")
-        }
-        if (!other.isValid()) {
-            throw IllegalArgumentException("Unexpected format in VersionString")
-        }
-        val thisParts = version.split(".")
-        val otherParts = other.version.split(".")
-        val length = max(thisParts.count(), otherParts.count())
-        for (i in 0..length) {
-            // Get the current part, or zero if there isn't a part to compare to for thisPart
-            val thisPart = if (i < thisParts.count()) {
-                thisParts[i].toInt()
-            } else {
-                0
-            }
-            // Get the current part, or zero if there isn't a part to compare to for otherPart
-            val otherPart = if (i < otherParts.count()) {
-                otherParts[i].toInt()
-            } else {
-                0
-            }
-
-            if (thisPart < otherPart) {
-                return -1
-            }
-            if (thisPart > otherPart) {
-                return 1
-            }
-        }
-        return 0
-    }
-
-    override fun equals(other: Any?): Boolean {
-        if (other == null) {
-            return false
-        }
-        if (this.hashCode() == other.hashCode()) {
-            return true
-        }
-        if (this.javaClass != other.javaClass) {
-            return false
-        }
-
-        return this.compareTo(other as VersionString) == 0
-    }
-
-    override fun hashCode(): Int {
-        return version.hashCode()
-    }
-
-    fun isValid(): Boolean = version.matches(VERSION_REGEX)
-
-    override fun toString(): String = version
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ActiveExperimentTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ActiveExperimentTest.kt
deleted file mode 100644
index 0de07a4cc1eb..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ActiveExperimentTest.kt
+++ /dev/null
@@ -1,144 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import android.content.SharedPreferences
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import mozilla.components.support.test.mock
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertNull
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.mockito.ArgumentMatchers.anyString
-import org.mockito.ArgumentMatchers.eq
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.times
-import org.mockito.Mockito.verify
-
-@RunWith(AndroidJUnit4::class)
-class ActiveExperimentTest {
-    private lateinit var context: Context
-    private lateinit var sharedPrefs: SharedPreferences
-    private lateinit var prefsEditor: SharedPreferences.Editor
-    private val prefNameActiveExperiment = ActiveExperiment.PREF_NAME_ACTIVE_EXPERIMENT
-    private val prefKeyId = ActiveExperiment.KEY_ID
-    private val prefKeyBranch = ActiveExperiment.KEY_BRANCH
-
-    private fun testReset() {
-        context = mock()
-        sharedPrefs = mock()
-        prefsEditor = mock()
-
-        `when`(context.getSharedPreferences(eq(prefNameActiveExperiment), eq(Context.MODE_PRIVATE))).thenReturn(sharedPrefs)
-        `when`(sharedPrefs.edit()).thenReturn(prefsEditor)
-        `when`(prefsEditor.putString(anyString(), anyString())).thenReturn(prefsEditor)
-        `when`(prefsEditor.clear()).thenReturn(prefsEditor)
-    }
-
-    private fun setActiveExperimentPrefs(id: String, branch: String) {
-        `when`(sharedPrefs.getString(eq(prefKeyId), eq(null))).thenReturn(id)
-        `when`(sharedPrefs.getString(eq(prefKeyBranch), eq(null))).thenReturn(branch)
-    }
-
-    @Test
-    fun `test basics`() {
-        val experiment = createDefaultExperiment(
-            id = "id",
-            branches = listOf(
-                Experiment.Branch("branch1", 1),
-                Experiment.Branch("branch2", 2)
-            )
-        )
-
-        val activeExperiment = ActiveExperiment(experiment, "branch2")
-        assertEquals(activeExperiment.experiment, experiment)
-        assertEquals(activeExperiment.branch, "branch2")
-    }
-
-    @Test
-    fun `test load from storage`() {
-        testReset()
-        val experiments = listOf(
-            createDefaultExperiment(
-                id = "id1",
-                branches = listOf(
-                    Experiment.Branch("branch1", 2),
-                    Experiment.Branch("branch2", 3)
-                )
-            ),
-            createDefaultExperiment(
-                id = "id2",
-                branches = listOf(
-                    Experiment.Branch("branch3", 2)
-                )
-            )
-        )
-
-        // Start with empty storage.
-        assertNull(ActiveExperiment.load(context, experiments))
-        verify(context).getSharedPreferences(prefNameActiveExperiment, Context.MODE_PRIVATE)
-        verify(sharedPrefs).getString(prefKeyId, null)
-
-        // Test valid experiment id and branch name variations.
-        setActiveExperimentPrefs("id1", "branch1")
-        var active = ActiveExperiment.load(context, experiments)
-        assertEquals(experiments[0], active!!.experiment)
-        assertEquals("branch1", active.branch)
-
-        setActiveExperimentPrefs("id1", "branch2")
-        active = ActiveExperiment.load(context, experiments)
-        assertEquals(experiments[0], active!!.experiment)
-        assertEquals("branch2", active.branch)
-
-        setActiveExperimentPrefs("id2", "branch3")
-        active = ActiveExperiment.load(context, experiments)
-        assertEquals(experiments[1], active!!.experiment)
-        assertEquals("branch3", active.branch)
-
-        // Test invalid experiment id and branch name variations.
-        testReset()
-        setActiveExperimentPrefs("id2", "non-existent")
-        assertNull(ActiveExperiment.load(context, experiments))
-        verify(context).getSharedPreferences(prefNameActiveExperiment, Context.MODE_PRIVATE)
-        verify(sharedPrefs).getString(prefKeyId, null)
-        verify(sharedPrefs).getString(prefKeyBranch, null)
-
-        setActiveExperimentPrefs("non-existent", "branch1")
-        assertNull(ActiveExperiment.load(context, experiments))
-        verify(context, times(2)).getSharedPreferences(prefNameActiveExperiment, Context.MODE_PRIVATE)
-        verify(sharedPrefs, times(2)).getString(prefKeyId, null)
-        verify(sharedPrefs, times(2)).getString(prefKeyBranch, null)
-    }
-
-    @Test
-    fun `test saving state`() {
-        testReset()
-
-        val experiment = createDefaultExperiment(
-            id = "some-id",
-            branches = listOf(Experiment.Branch("some-branch", 3))
-        )
-        val active = ActiveExperiment(experiment, "some-branch")
-
-        active.save(context)
-        verify(context).getSharedPreferences(prefNameActiveExperiment, Context.MODE_PRIVATE)
-        verify(sharedPrefs).edit()
-        verify(prefsEditor).putString(prefKeyId, "some-id")
-        verify(prefsEditor).putString(prefKeyBranch, "some-branch")
-        verify(prefsEditor).apply()
-    }
-
-    @Test
-    fun `test clearing state`() {
-        testReset()
-
-        ActiveExperiment.clear(context)
-        verify(context).getSharedPreferences(prefNameActiveExperiment, Context.MODE_PRIVATE)
-        verify(sharedPrefs).edit()
-        verify(prefsEditor).clear()
-        verify(prefsEditor).apply()
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/DeviceUuidFactoryTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/DeviceUuidFactoryTest.kt
deleted file mode 100644
index ed6eef53fe2b..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/DeviceUuidFactoryTest.kt
+++ /dev/null
@@ -1,46 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import android.content.SharedPreferences
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import org.junit.Assert.assertEquals
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.mockito.ArgumentMatchers
-import org.mockito.ArgumentMatchers.any
-import org.mockito.ArgumentMatchers.anyInt
-import org.mockito.ArgumentMatchers.anyString
-import org.mockito.ArgumentMatchers.eq
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.mock
-import org.mockito.Mockito.verify
-
-@RunWith(AndroidJUnit4::class)
-class DeviceUuidFactoryTest {
-    @Test
-    fun uuidNoPreference() {
-        val context = mock(Context::class.java)
-        val sharedPreferences = mock(SharedPreferences::class.java)
-        val editor = mock(SharedPreferences.Editor::class.java)
-        `when`(editor.putString(anyString(), any())).thenReturn(editor)
-        `when`(sharedPreferences.edit()).thenReturn(editor)
-        `when`(sharedPreferences.getString(eq("device_uuid"), ArgumentMatchers.any())).thenReturn(null)
-        `when`(context.getSharedPreferences(anyString(), anyInt())).thenReturn(sharedPreferences)
-        val uuid = DeviceUuidFactory(context).uuid
-        verify(editor).putString("device_uuid", uuid)
-    }
-
-    @Test
-    fun uuidSavedInPreferences() {
-        val savedUuid = "99111a0f-ca5d-4de1-913a-daba905c53b2"
-        val context = mock(Context::class.java)
-        val sharedPreferences = mock(SharedPreferences::class.java)
-        `when`(sharedPreferences.getString(eq("device_uuid"), any())).thenReturn(savedUuid)
-        `when`(context.getSharedPreferences(anyString(), anyInt())).thenReturn(sharedPreferences)
-        assertEquals(savedUuid, DeviceUuidFactory(context).uuid)
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentEvaluatorTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentEvaluatorTest.kt
deleted file mode 100644
index fdffa5b696f8..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentEvaluatorTest.kt
+++ /dev/null
@@ -1,898 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import android.content.SharedPreferences
-import android.content.pm.PackageInfo
-import android.content.pm.PackageManager
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import mozilla.components.service.experiments.util.VersionString
-import mozilla.components.support.test.mock
-import mozilla.components.support.test.robolectric.testContext
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertNotNull
-import org.junit.Assert.assertNull
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.mockito.ArgumentMatchers.anyBoolean
-import org.mockito.ArgumentMatchers.anyInt
-import org.mockito.ArgumentMatchers.anyString
-import org.mockito.ArgumentMatchers.eq
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.verify
-
-@RunWith(AndroidJUnit4::class)
-class ExperimentEvaluatorTest {
-    private lateinit var context: Context
-    private lateinit var sharedPrefsOverrideEnabled: SharedPreferences
-    private lateinit var sharedPrefsOverrideBranch: SharedPreferences
-    private lateinit var enabledEditor: SharedPreferences.Editor
-    private lateinit var branchEditor: SharedPreferences.Editor
-    private lateinit var packageManager: PackageManager
-    private lateinit var packageInfo: PackageInfo
-    private var currentTime = System.currentTimeMillis() / 1000
-
-    private fun testReset(appId: String = "test.appId", versionName: String = "test.version") {
-        context = mock()
-        sharedPrefsOverrideEnabled = mock()
-        sharedPrefsOverrideBranch = mock()
-        packageManager = mock()
-        packageInfo = PackageInfo()
-
-        `when`(context.packageName).thenReturn(appId)
-
-        packageInfo.versionName = versionName
-        `when`(packageManager.getPackageInfo(anyString(), anyInt())).thenReturn(packageInfo)
-        `when`(context.packageManager).thenReturn(packageManager)
-
-        val prefEnabled = ExperimentEvaluator.PREF_NAME_OVERRIDES_ENABLED
-        val prefBranch = ExperimentEvaluator.PREF_NAME_OVERRIDES_BRANCH
-
-        `when`(context.getSharedPreferences(eq(prefEnabled), eq(Context.MODE_PRIVATE))).thenReturn(sharedPrefsOverrideEnabled)
-        `when`(sharedPrefsOverrideEnabled.getBoolean(anyString(), anyBoolean())).thenAnswer { invocation -> invocation.arguments[1] as Boolean }
-        enabledEditor = mock()
-        `when`(enabledEditor.putBoolean(anyString(), anyBoolean())).thenReturn(enabledEditor)
-        `when`(enabledEditor.remove(anyString())).thenReturn(enabledEditor)
-        `when`(enabledEditor.clear()).thenReturn(enabledEditor)
-        `when`(sharedPrefsOverrideEnabled.edit()).thenReturn(enabledEditor)
-
-        `when`(context.getSharedPreferences(eq(prefBranch), eq(Context.MODE_PRIVATE))).thenReturn(sharedPrefsOverrideBranch)
-        `when`(sharedPrefsOverrideBranch.getString(anyString(), anyString())).thenAnswer { invocation -> invocation.arguments[1] as String }
-        branchEditor = mock()
-        `when`(branchEditor.putString(anyString(), anyString())).thenReturn(branchEditor)
-        `when`(branchEditor.remove(anyString())).thenReturn(branchEditor)
-        `when`(branchEditor.clear()).thenReturn(branchEditor)
-        `when`(sharedPrefsOverrideBranch.edit()).thenReturn(branchEditor)
-    }
-
-    @Suppress("SameParameterValue")
-    private fun setOverride(experimentName: String, isActive: Boolean, branchName: String) {
-        `when`(sharedPrefsOverrideEnabled.getBoolean(eq(experimentName), anyBoolean())).thenReturn(isActive)
-        `when`(sharedPrefsOverrideBranch.getString(eq(experimentName), eq(null))).thenReturn(branchName)
-        `when`(sharedPrefsOverrideEnabled.contains(eq(experimentName))).thenReturn(true)
-        `when`(sharedPrefsOverrideBranch.contains(eq(experimentName))).thenReturn(true)
-    }
-
-    @Test
-    fun `evaluate empty matchers`() {
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            lastModified = currentTime,
-            buckets = Experiment.Buckets(20, 70),
-            match = createDefaultMatcher()
-        )
-
-        testReset(appId = "other.appId")
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate buckets`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                appId = "test.appId",
-                localeLanguage = "eng",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 50),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 21))
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 69))
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 19))
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 70))
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 71))
-    }
-
-    @Test
-    fun `evaluate appId`() {
-        testReset(appId = "other.appId", versionName = "test.version")
-
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "^test$",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-        `when`(context.packageName).thenReturn("test")
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate localeLanguage`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        var experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "esp",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate localeCountry`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        var experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "ESP"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate appDisplayVersion`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "other.version"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate appMinVersion`() {
-        testReset(appId = "test.appId", versionName = "1.0.0")
-
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appMinVersion = VersionString("1.0.0"),
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.0"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.0.1"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.1.18"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.1.18.43123"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.1.18.34.2345"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "0.1.18"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "0.9.9"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate appMaxVersion`() {
-        testReset(appId = "test.appId", versionName = "2.0.0")
-
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appMaxVersion = VersionString("2.0.0"),
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.9"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.9.9999"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.1.18"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "2.0.1"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "2.0.1.2.3"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "67.1.12345678"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate a min and max version together`() {
-        testReset(appId = "test.appId")
-
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appMinVersion = VersionString("1.0.0"),
-                appMaxVersion = VersionString("2.0.0"),
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-
-        packageInfo.versionName = "0.1"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "0.0.1"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "0.9.9"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "0.9.9.9.9.9"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.0.0"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.0.1"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.9.9999"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.9.9999.999.99"
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "2.0.1"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "2.1.18"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate appMinVersion with invalid app version should never match`() {
-        testReset(appId = "test.appId", versionName = "Invalid version")
-
-        val experiment = createDefaultExperiment(
-                id = "testexperiment",
-                match = createDefaultMatcher(
-                        localeLanguage = "eng",
-                        appId = "test.appId",
-                        regions = listOf("USA", "GBR"),
-                        appMinVersion = VersionString("1.0.0"),
-                        deviceManufacturer = "unknown",
-                        deviceModel = "robolectric",
-                        localeCountry = "USA"
-                ),
-                buckets = Experiment.Buckets(20, 70),
-                lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate appMaxVersion with invalid app version should never match`() {
-        testReset(appId = "test.appId", versionName = "Invalid version")
-
-        val experiment = createDefaultExperiment(
-                id = "testexperiment",
-                match = createDefaultMatcher(
-                        localeLanguage = "eng",
-                        appId = "test.appId",
-                        regions = listOf("USA", "GBR"),
-                        appMaxVersion = VersionString("1.0.0"),
-                        deviceManufacturer = "unknown",
-                        deviceModel = "robolectric",
-                        localeCountry = "USA"
-                ),
-                buckets = Experiment.Buckets(20, 70),
-                lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `invalid app version doesn't prevent other matches`() {
-        testReset(appId = "test.appId", versionName = "Invalid version")
-
-        val experiment = createDefaultExperiment(
-                id = "testexperiment",
-                match = createDefaultMatcher(
-                        localeLanguage = "eng",
-                        appId = "test.appId",
-                        regions = listOf("USA", "GBR"),
-                        deviceManufacturer = "unknown",
-                        deviceModel = "robolectric",
-                        localeCountry = "USA"
-                ),
-                buckets = Experiment.Buckets(20, 70),
-                lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `invalid appMinVersion never matches`() {
-        testReset(appId = "test.appId", versionName = "1.0.0")
-
-        val experiment = createDefaultExperiment(
-                id = "testexperiment",
-                match = createDefaultMatcher(
-                        localeLanguage = "eng",
-                        appId = "test.appId",
-                        regions = listOf("USA", "GBR"),
-                        appMinVersion = VersionString("Invalid"),
-                        deviceManufacturer = "unknown",
-                        deviceModel = "robolectric",
-                        localeCountry = "USA"
-                ),
-                buckets = Experiment.Buckets(20, 70),
-                lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.1.0"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "0.9"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `invalid appMaxVersion never matches`() {
-        testReset(appId = "test.appId", versionName = "1.0.0")
-
-        val experiment = createDefaultExperiment(
-                id = "testexperiment",
-                match = createDefaultMatcher(
-                        localeLanguage = "eng",
-                        appId = "test.appId",
-                        regions = listOf("USA", "GBR"),
-                        appMaxVersion = VersionString("Invalid"),
-                        deviceManufacturer = "unknown",
-                        deviceModel = "robolectric",
-                        localeCountry = "USA"
-                ),
-                buckets = Experiment.Buckets(20, 70),
-                lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "1.1.0"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        packageInfo.versionName = "0.9"
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate deviceModel`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        var experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "otherdevice",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate deviceManufacturer`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        var experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "other",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `evaluate region`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        val experiment = createDefaultExperiment(
-            id = "testexperiment",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "test.appId",
-                regions = listOf("USA", "GBR"),
-                appDisplayVersion = "test.version",
-                deviceManufacturer = "unknown",
-                deviceModel = "robolectric",
-                localeCountry = "USA"
-            ),
-            buckets = Experiment.Buckets(20, 70),
-            lastModified = currentTime
-        )
-
-        var evaluator = ExperimentEvaluator(object : ValuesProvider() {
-            override fun getRegion(context: Context): String? {
-                return "USA"
-            }
-        })
-
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-
-        evaluator = ExperimentEvaluator(object : ValuesProvider() {
-            override fun getRegion(context: Context): String? {
-                return "ESP"
-            }
-        })
-
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("testexperiment"), listOf(experiment), 20))
-    }
-
-    @Test
-    fun `override an inactive experiment to active`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        // Use another app id, so this experiment doesn't activate.
-        val experiment = createDefaultExperiment(
-            id = "some-experiment",
-            match = createDefaultMatcher(appId = "other.appId")
-        )
-        val evaluator = ExperimentEvaluator()
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("some-experiment"), listOf(experiment), 0))
-
-        // Now activate the override. The experiment should then evaluate to active.
-        setOverride("some-experiment", true, "branch-3")
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("some-experiment"), listOf(experiment), 0))
-    }
-
-    @Test
-    fun `override an active experiment to inactive`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        // This experiment should activate.
-        val experiment = createDefaultExperiment(
-            id = "some-experiment"
-        )
-        val evaluator = ExperimentEvaluator()
-        assertNotNull(evaluator.evaluate(context, ExperimentDescriptor("some-experiment"), listOf(experiment), 50))
-
-        // Now set an override for it. The experiment should not evaluate to active anymore.
-        setOverride("some-experiment", false, "branch-3")
-        assertNull(evaluator.evaluate(context, ExperimentDescriptor("some-experiment"), listOf(experiment), 50))
-    }
-
-    @Test
-    fun `evaluate no experiment matches descriptor`() {
-        testReset(appId = "test.appId", versionName = "test.version")
-
-        val savedExperiment = createDefaultExperiment(id = "wrongid")
-        val descriptor = ExperimentDescriptor("testname")
-        assertNull(ExperimentEvaluator().evaluate(context, descriptor, listOf(savedExperiment), 20))
-    }
-
-    @Test
-    fun `verify setOverride() activate writes to SharedPreferences`() {
-        testReset()
-
-        val evaluator = ExperimentEvaluator()
-        evaluator.setOverride(context, ExperimentDescriptor("exp-id"), true, "branch-1")
-        verify(enabledEditor).putBoolean("exp-id", true)
-        verify(branchEditor).putString("exp-id", "branch-1")
-    }
-
-    @Test
-    fun `verify setOverride() deactivate writes to SharedPreferences`() {
-        testReset()
-
-        val evaluator = ExperimentEvaluator()
-        evaluator.setOverride(context, ExperimentDescriptor("exp-2-id"), false, "branch-2")
-        verify(enabledEditor).putBoolean("exp-2-id", false)
-        verify(branchEditor).putString("exp-2-id", "branch-2")
-    }
-
-    @Test
-    fun `verify clearOverride() writes to SharedPreferences`() {
-        testReset()
-
-        val evaluator = ExperimentEvaluator()
-        evaluator.clearOverride(context, ExperimentDescriptor("exp-id"))
-        verify(enabledEditor).remove("exp-id")
-        verify(branchEditor).remove("exp-id")
-    }
-
-    @Test
-    fun `verify clearAllOverrides() writes to SharedPreferences`() {
-        testReset()
-
-        val evaluator = ExperimentEvaluator()
-        evaluator.clearAllOverrides(context)
-        verify(enabledEditor).clear()
-        verify(branchEditor).clear()
-    }
-
-    @Test
-    fun `test overriding client id`() {
-        val evaluator1 = ExperimentEvaluator(object : ValuesProvider() {
-            override fun getClientId(context: Context): String = "c641eacf-c30c-4171-b403-f077724e848a"
-        })
-
-        assertEquals(779, evaluator1.getUserBucket(testContext))
-
-        val evaluator2 = ExperimentEvaluator(object : ValuesProvider() {
-            override fun getClientId(context: Context): String = "01a15650-9a5d-4383-a7ba-2f047b25c620"
-        })
-
-        assertEquals(355, evaluator2.getUserBucket(testContext))
-    }
-
-    @Test
-    fun `test selectBranchByWeight()`() {
-        val e = ExperimentEvaluator()
-
-        var branches = listOf(
-            Experiment.Branch("1", 2)
-        )
-
-        assertEquals("1", e.selectBranchByWeight(0, branches).name)
-        assertEquals("1", e.selectBranchByWeight(1, branches).name)
-
-        branches = listOf(
-            Experiment.Branch("1", 1),
-            Experiment.Branch("2", 2)
-        )
-
-        assertEquals("1", e.selectBranchByWeight(0, branches).name)
-        assertEquals("2", e.selectBranchByWeight(1, branches).name)
-        assertEquals("2", e.selectBranchByWeight(2, branches).name)
-
-        branches = listOf(
-            Experiment.Branch("1", 2),
-            Experiment.Branch("2", 4),
-            Experiment.Branch("3", 1)
-        )
-
-        assertEquals("1", e.selectBranchByWeight(0, branches).name)
-        assertEquals("1", e.selectBranchByWeight(1, branches).name)
-        assertEquals("2", e.selectBranchByWeight(2, branches).name)
-        assertEquals("2", e.selectBranchByWeight(3, branches).name)
-        assertEquals("2", e.selectBranchByWeight(4, branches).name)
-        assertEquals("2", e.selectBranchByWeight(5, branches).name)
-        assertEquals("3", e.selectBranchByWeight(6, branches).name)
-    }
-
-    @Test
-    fun `test pickActiveBranch()`() {
-        val e = ExperimentEvaluator()
-
-        var experiment = createDefaultExperiment(
-            branches = listOf(
-                Experiment.Branch("1", 2)
-            )
-        )
-
-        assertEquals("1", e.pickActiveBranch(experiment) { _, _ -> 0 }.name)
-        assertEquals("1", e.pickActiveBranch(experiment) { _, _ -> 1 }.name)
-
-        experiment = createDefaultExperiment(
-            branches = listOf(
-                Experiment.Branch("1", 1),
-                Experiment.Branch("2", 2)
-            )
-        )
-
-        assertEquals("1", e.pickActiveBranch(experiment) { _, _ -> 0 }.name)
-        assertEquals("2", e.pickActiveBranch(experiment) { _, _ -> 1 }.name)
-        assertEquals("2", e.pickActiveBranch(experiment) { _, _ -> 2 }.name)
-    }
-
-    private fun evaluate(
-        diceValue: Int,
-        descriptor: ExperimentDescriptor,
-        experiments: List<Experiment>
-    ): ActiveExperiment? {
-        val e = ExperimentEvaluator(object : ValuesProvider() {
-            override fun getRandomBranchValue(lower: Int, upper: Int): Int {
-                return diceValue
-            }
-            override fun getClientId(context: Context): String = "c641eacf-c30c-4171-b403-f077724e848a"
-        })
-        return e.evaluate(context, descriptor, experiments)
-    }
-
-    @Test
-    fun `test evaluating branch choices`() {
-        testReset()
-
-        var experiments = listOf(
-            createDefaultExperiment(
-                id = "id",
-                branches = listOf(
-                    Experiment.Branch("1", 2)
-                )
-            )
-        )
-        val descriptor = ExperimentDescriptor("id")
-        assertEquals(
-            ActiveExperiment(experiments[0], "1"),
-            evaluate(0, descriptor, experiments)!!
-        )
-        assertEquals(
-            ActiveExperiment(experiments[0], "1"),
-            evaluate(0, descriptor, experiments)!!
-        )
-
-        experiments = listOf(
-            createDefaultExperiment(
-                id = "other"
-            ),
-            createDefaultExperiment(
-                id = "id",
-                branches = listOf(
-                    Experiment.Branch("1", 1),
-                    Experiment.Branch("2", 1)
-                )
-            )
-        )
-        assertEquals(
-            ActiveExperiment(experiments[1], "1"),
-            evaluate(0, descriptor, experiments)!!
-        )
-        assertEquals(
-            ActiveExperiment(experiments[1], "2"),
-            evaluate(1, descriptor, experiments)!!
-        )
-    }
-
-    private fun evaluateWithDebugTag(
-        debugTag: String?,
-        descriptor: ExperimentDescriptor,
-        experiments: List<Experiment>
-    ): ActiveExperiment? {
-        val e = ExperimentEvaluator(object : ValuesProvider() {
-            override fun getDebugTag(): String? {
-                return debugTag
-            }
-            override fun getClientId(context: Context): String = "c641eacf-c30c-4171-b403-f077724e848a"
-        })
-        return e.evaluate(context, descriptor, experiments)
-    }
-
-    @Test
-    fun `evaluate debug tags`() {
-        testReset()
-
-        val experiments = listOf(
-            createDefaultExperiment(
-                id = "id-1",
-                match = createDefaultMatcher(
-                    debugTags = listOf("tag-1")
-                )
-            ),
-            createDefaultExperiment(
-                id = "id-2",
-                match = createDefaultMatcher(
-                    debugTags = listOf("tag-2", "tag-3")
-                )
-            )
-        )
-        val descriptor1 = ExperimentDescriptor("id-1")
-        val descriptor2 = ExperimentDescriptor("id-2")
-
-        assertNull(evaluateWithDebugTag("other-tag", descriptor1, experiments))
-        assertNull(evaluateWithDebugTag("other-tag", descriptor2, experiments))
-        assertEquals(
-            ActiveExperiment(experiments[0], "only-branch"),
-            evaluateWithDebugTag("tag-1", descriptor1, experiments)!!
-        )
-        assertEquals(
-            ActiveExperiment(experiments[1], "only-branch"),
-            evaluateWithDebugTag("tag-2", descriptor2, experiments)!!
-        )
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentPayloadTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentPayloadTest.kt
deleted file mode 100644
index a92cfc7c4865..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentPayloadTest.kt
+++ /dev/null
@@ -1,104 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertNull
-import org.junit.Assert.assertTrue
-import org.junit.Test
-import org.junit.runner.RunWith
-
-@RunWith(AndroidJUnit4::class)
-class ExperimentPayloadTest {
-    @Test
-    fun get() {
-        val payload = ExperimentPayload()
-        payload.put("key", "value")
-        assertEquals("value", payload.get("key"))
-        assertNull("other", payload.get("other"))
-    }
-
-    @Test
-    fun getKeys() {
-        val payload = ExperimentPayload()
-        payload.put("first-key", "first-value")
-        payload.put("second-key", "second-value")
-        val keys = payload.getKeys()
-        assertEquals(2, keys.size)
-        assertTrue(keys.contains("first-key"))
-        assertTrue(keys.contains("second-key"))
-    }
-
-    @Test
-    fun getBooleanList() {
-        val payload = ExperimentPayload()
-        payload.put("boolean-key", listOf(true, false))
-        assertEquals(listOf(true, false), payload.getBooleanList("boolean-key"))
-    }
-
-    @Test(expected = ClassCastException::class)
-    fun getBooleanListInvalidType() {
-        val payload = ExperimentPayload()
-        payload.put("boolean-key", "other-value")
-        payload.getBooleanList("boolean-key")
-    }
-
-    @Test
-    fun getIntList() {
-        val payload = ExperimentPayload()
-        payload.put("int-key", listOf(1, 2))
-        assertEquals(listOf(1, 2), payload.getIntList("int-key"))
-    }
-
-    @Test(expected = ClassCastException::class)
-    fun getIntListInvalidType() {
-        val payload = ExperimentPayload()
-        payload.put("int-key", "other-value")
-        payload.getIntList("int-key")
-    }
-
-    @Test
-    fun getLongList() {
-        val payload = ExperimentPayload()
-        payload.put("long-key", listOf(1L, 2L))
-        assertEquals(listOf(1L, 2L), payload.getLongList("long-key"))
-    }
-
-    @Test(expected = ClassCastException::class)
-    fun getLongListInvalidType() {
-        val payload = ExperimentPayload()
-        payload.put("long-key", "other-value")
-        payload.getLongList("long-key")
-    }
-
-    @Test
-    fun getDoubleList() {
-        val payload = ExperimentPayload()
-        payload.put("double-key", listOf(1, 2.5))
-        assertEquals(listOf(1, 2.5), payload.getDoubleList("double-key"))
-    }
-
-    @Test(expected = ClassCastException::class)
-    fun getDoubleListInvalidType() {
-        val payload = ExperimentPayload()
-        payload.put("double-key", "other-value")
-        payload.getDoubleList("double-key")
-    }
-
-    @Test
-    fun getStringList() {
-        val payload = ExperimentPayload()
-        payload.put("string-key", listOf("first", "second"))
-        assertEquals(listOf("first", "second"), payload.getStringList("string-key"))
-    }
-
-    @Test(expected = ClassCastException::class)
-    fun getStringListInvalidType() {
-        val payload = ExperimentPayload()
-        payload.put("string-key", "other-value")
-        payload.getStringList("string-key")
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentTest.kt
deleted file mode 100644
index 8bffcf94692d..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentTest.kt
+++ /dev/null
@@ -1,48 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertFalse
-import org.junit.Assert.assertTrue
-import org.junit.Test
-import org.junit.runner.RunWith
-
-@RunWith(AndroidJUnit4::class)
-class ExperimentTest {
-    private var currentTime = System.currentTimeMillis() / 1000
-
-    @Test
-    fun `test equals()`() {
-        val experiment = createDefaultExperiment(
-            id = "id",
-            description = "description",
-            buckets = Experiment.Buckets(0, 100),
-            branches = emptyList(),
-            match = createDefaultMatcher(),
-            lastModified = currentTime,
-            schemaModified = null)
-
-        assertTrue(experiment == experiment)
-        assertFalse(experiment.equals(null))
-        assertFalse(experiment.equals(3))
-
-        val secondExperiment = createDefaultExperiment(
-            id = "id",
-            description = "description2",
-            match = createDefaultMatcher(appId = "eng"),
-            lastModified = null,
-            schemaModified = null
-        )
-        assertTrue(secondExperiment == experiment)
-    }
-
-    @Test
-    fun `test hashCode()`() {
-        val experiment = createDefaultExperiment(id = "id")
-        assertEquals(experiment.id.hashCode(), experiment.hashCode())
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsSerializerTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsSerializerTest.kt
deleted file mode 100644
index 1ff7022283aa..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsSerializerTest.kt
+++ /dev/null
@@ -1,219 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import mozilla.components.support.ktx.android.org.json.toList
-import org.json.JSONException
-import org.json.JSONObject
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertNull
-import org.junit.Test
-import org.junit.runner.RunWith
-
-@RunWith(AndroidJUnit4::class)
-class ExperimentsSerializerTest {
-    private var currentTime = System.currentTimeMillis() / 1000
-    private var pastTime = currentTime - 1000
-
-    private val experimentsJson = """
-{
-  "experiments": [
-      {
-          "id":"first",
-          "description":"Description",
-          "last_modified":$pastTime,
-          "buckets":{
-              "start":0,
-              "count":100
-          },
-          "branches":[
-              {
-                  "name":"first-branch",
-                  "ratio":7
-              },
-              {
-                  "name":"second-branch",
-                  "ratio":21
-              }
-          ],
-          "match":{
-              "regions": [
-                  "esp"
-              ],
-              "app_id":"^org.mozilla.firefox_beta${'$'}",
-              "locale_language":"eng|es|deu|fra"
-          }
-      },
-      {
-          "id":"second",
-          "description":"SecondDescription",
-          "last_modified":$currentTime,
-          "buckets":{
-              "start":5,
-              "count":5
-          },
-          "branches":[
-              {
-                  "name":"one-branch",
-                  "ratio":70
-              }
-          ],
-          "match":{
-              "regions": [
-                  "deu"
-              ],
-              "app_id":"^org.mozilla.firefox${'$'}",
-              "locale_language":"es|deu"
-          }
-      }
-  ],
-  "last_modified": $currentTime
-}
-"""
-
-    @Test
-    fun fromJsonValid() {
-        val experimentsResult = ExperimentsSerializer().fromJson(experimentsJson)
-        val experiments = experimentsResult.experiments
-
-        assertEquals(2, experiments.size)
-        assertEquals(currentTime, experimentsResult.lastModified)
-
-        assertEquals("first", experiments[0].id)
-        assertEquals("Description", experiments[0].description)
-        assertEquals(pastTime, experiments[0].lastModified)
-
-        assertEquals("eng|es|deu|fra", experiments[0].match.localeLanguage)
-        assertEquals("^org.mozilla.firefox_beta${'$'}", experiments[0].match.appId)
-        assertEquals(1, experiments[0].match.regions!!.size)
-        assertEquals("esp", experiments[0].match.regions!![0])
-
-        assertEquals(0, experiments[0].buckets.start)
-        assertEquals(100, experiments[0].buckets.count)
-
-        assertEquals(2, experiments[0].branches.size)
-        assertEquals("first-branch", experiments[0].branches[0].name)
-        assertEquals(7, experiments[0].branches[0].ratio)
-        assertEquals("second-branch", experiments[0].branches[1].name)
-        assertEquals(21, experiments[0].branches[1].ratio)
-
-        assertEquals("second", experiments[1].id)
-        assertEquals("SecondDescription", experiments[1].description)
-        assertEquals(currentTime, experiments[1].lastModified)
-
-        assertEquals("es|deu", experiments[1].match.localeLanguage)
-        assertEquals("^org.mozilla.firefox${'$'}", experiments[1].match.appId)
-        assertEquals(1, experiments[1].match.regions!!.size)
-        assertEquals("deu", experiments[1].match.regions!![0])
-
-        assertEquals(5, experiments[1].buckets.start)
-        assertEquals(5, experiments[1].buckets.count)
-
-        assertEquals(1, experiments[1].branches.size)
-        assertEquals("one-branch", experiments[1].branches[0].name)
-        assertEquals(70, experiments[1].branches[0].ratio)
-    }
-
-    @Test(expected = JSONException::class)
-    fun fromJsonEmptyString() {
-        ExperimentsSerializer().fromJson("")
-    }
-
-    @Test
-    fun fromJsonEmptyArray() {
-        val experimentsJson = """ {"experiments":[]} """
-        val experimentsResult = ExperimentsSerializer().fromJson(experimentsJson)
-        assertEquals(0, experimentsResult.experiments.size)
-        assertNull(experimentsResult.lastModified)
-    }
-
-    @Test
-    fun toJsonValid() {
-        val experiments = listOf(
-            createDefaultExperiment(
-                id = "experiment-1-id",
-                description = "Description",
-                match = createDefaultMatcher(
-                    localeLanguage = "eng|es|deu|fra",
-                    appId = "^org.mozilla.firefox_beta${'$'}",
-                    regions = listOf("esp")
-                ),
-                buckets = Experiment.Buckets(0, 100),
-                branches = emptyList(),
-                lastModified = pastTime
-            ),
-            createDefaultExperiment(
-                id = "experiment-2-id",
-                description = "SecondDescription",
-                match = createDefaultMatcher(
-                    localeLanguage = "es|deu",
-                    appId = "^org.mozilla.firefox${'$'}",
-                    regions = listOf("deu")
-                ),
-                branches = listOf(
-                    Experiment.Branch("branch1", 5),
-                    Experiment.Branch("branch2", 7)
-                ),
-                buckets = Experiment.Buckets(5, 5),
-                lastModified = currentTime
-            )
-        )
-
-        val json = JSONObject(ExperimentsSerializer().toJson(ExperimentsSnapshot(experiments, currentTime)))
-        assertEquals(2, json.length())
-        assertEquals(currentTime, json.getLong("last_modified"))
-        val experimentsArray = json.getJSONArray("experiments")
-        assertEquals(2, experimentsArray.length())
-
-        val firstExperiment = experimentsArray[0] as JSONObject
-        assertEquals("experiment-1-id", firstExperiment.getString("id"))
-        assertEquals("Description", firstExperiment.getString("description"))
-        assertEquals(pastTime, firstExperiment.getLong("last_modified"))
-
-        val firstExperimentBuckets = firstExperiment.getJSONObject("buckets")
-        assertEquals(0, firstExperimentBuckets.getInt("start"))
-        assertEquals(100, firstExperimentBuckets.getInt("count"))
-
-        val firstExperimentBranches = firstExperiment.getJSONArray("branches")
-        assertEquals(0, firstExperimentBranches.length())
-
-        val firstExperimentMatch = firstExperiment.getJSONObject("match")
-        val firstExperimentRegions = firstExperimentMatch.getJSONArray("regions")
-        assertEquals(listOf("esp"), firstExperimentRegions.toList<String>())
-        assertEquals("^org.mozilla.firefox_beta${'$'}", firstExperimentMatch.getString("app_id"))
-        assertEquals("eng|es|deu|fra", firstExperimentMatch.getString("locale_language"))
-
-        val secondExperiment = experimentsArray[1] as JSONObject
-        assertEquals("experiment-2-id", secondExperiment.getString("id"))
-        assertEquals("SecondDescription", secondExperiment.getString("description"))
-        assertEquals(currentTime, secondExperiment.getLong("last_modified"))
-
-        val secondExperimentBuckets = secondExperiment.getJSONObject("buckets")
-        assertEquals(5, secondExperimentBuckets.getInt("start"))
-        assertEquals(5, secondExperimentBuckets.getInt("count"))
-
-        val secondExperimentBranches = secondExperiment.getJSONArray("branches").toList<JSONObject>()
-        assertEquals("branch1", secondExperimentBranches[0].getString("name"))
-        assertEquals(5, secondExperimentBranches[0].getInt("ratio"))
-        assertEquals("branch2", secondExperimentBranches[1].getString("name"))
-        assertEquals(7, secondExperimentBranches[1].getInt("ratio"))
-
-        val secondExperimentMatch = secondExperiment.getJSONObject("match")
-        val secondExperimentRegions = secondExperimentMatch.getJSONArray("regions")
-        assertEquals(listOf("deu"), secondExperimentRegions.toList<String>())
-        assertEquals("^org.mozilla.firefox${'$'}", secondExperimentMatch.getString("app_id"))
-        assertEquals("es|deu", secondExperimentMatch.getString("locale_language"))
-    }
-
-    @Test
-    fun toJsonEmptyList() {
-        val experiments = listOf<Experiment>()
-        val experimentsJson = JSONObject(ExperimentsSerializer().toJson(ExperimentsSnapshot(experiments, null)))
-        assertEquals(1, experimentsJson.length())
-        val experimentsJsonArray = experimentsJson.getJSONArray("experiments")
-        assertEquals(0, experimentsJsonArray.length())
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsTest.kt
deleted file mode 100644
index 1a4300df1ea8..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsTest.kt
+++ /dev/null
@@ -1,865 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import android.content.SharedPreferences
-import android.content.pm.PackageInfo
-import android.content.pm.PackageManager
-import androidx.test.core.app.ApplicationProvider
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import androidx.work.testing.WorkManagerTestInitHelper
-import kotlinx.coroutines.Dispatchers
-import kotlinx.coroutines.runBlocking
-import mozilla.components.lib.fetch.httpurlconnection.HttpURLConnectionClient
-import mozilla.components.service.glean.Glean
-import mozilla.components.service.glean.testing.GleanTestRule
-import mozilla.components.support.test.any
-import mozilla.components.support.test.eq
-import mozilla.components.support.test.mock
-import org.junit.After
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertFalse
-import org.junit.Assert.assertNull
-import org.junit.Assert.assertTrue
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.junit.Assert.assertNotNull
-import org.junit.Rule
-import org.mockito.ArgumentMatchers.anyBoolean
-import org.mockito.ArgumentMatchers.anyInt
-import org.mockito.ArgumentMatchers.anyString
-import org.mockito.ArgumentMatchers.isNull
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.doAnswer
-import org.mockito.Mockito.mock
-import org.mockito.Mockito.spy
-import org.mockito.Mockito.times
-import org.mockito.Mockito.verify
-import java.io.File
-
-@RunWith(AndroidJUnit4::class)
-class ExperimentsTest {
-    private var context: Context = ApplicationProvider.getApplicationContext()
-    private var mockContext: Context = getDefaultMockedContext()
-    // Setting the endpoint to a non-existent one to prevent actual experiments from being
-    // downloaded to tests.
-    private val configuration: Configuration = Configuration(
-        httpClient = HttpURLConnectionClient(),
-        kintoEndpoint = "https://example.invalid"
-    )
-    private lateinit var experiments: ExperimentsInternalAPI
-    private lateinit var experimentStorage: FlatFileExperimentStorage
-    private lateinit var experimentSource: KintoExperimentSource
-    private lateinit var experimentsUpdater: ExperimentsUpdater
-
-    private val EXAMPLE_CLIENT_ID = "c641eacf-c30c-4171-b403-f077724e848a"
-
-    @get:Rule
-    val gleanRule = GleanTestRule(context)
-
-    private val experimentsList = listOf(
-        createDefaultExperiment(
-            id = "first-id",
-            match = createDefaultMatcher(
-                deviceManufacturer = "manufacturer-1"
-            )
-        ),
-        createDefaultExperiment(
-            id = "second-id",
-            match = createDefaultMatcher(
-                appId = "test.appId"
-            )
-        ),
-        createDefaultExperiment(
-            id = "third-id",
-            match = createDefaultMatcher(
-                deviceManufacturer = "unknown",
-                appDisplayVersion = "version.name"
-            )
-        )
-    )
-
-    private fun getDefaultMockedContext(): Context {
-        val context: Context = mock()
-        `when`(context.packageName).thenReturn("test.appId")
-        val sharedPrefs: SharedPreferences = mock()
-        val prefsEditor: SharedPreferences.Editor = mock()
-        `when`(prefsEditor.putString(anyString(), anyString())).thenReturn(prefsEditor)
-        `when`(sharedPrefs.edit()).thenReturn(prefsEditor)
-        `when`(sharedPrefs.getBoolean(anyString(), anyBoolean())).thenAnswer { invocation -> invocation.arguments[1] as Boolean }
-        `when`(prefsEditor.clear()).thenReturn(prefsEditor)
-        `when`(context.getSharedPreferences(anyString(), anyInt())).thenReturn(sharedPrefs)
-
-        val packageInfo: PackageInfo = mock()
-        packageInfo.versionName = "version.name"
-        val packageManager: PackageManager = mock()
-        `when`(packageManager.getPackageInfo(anyString(), anyInt())).thenReturn(packageInfo)
-        `when`(context.packageManager).thenReturn(packageManager)
-
-        return context
-    }
-
-    private fun getDefaultExperimentStorageMock(): FlatFileExperimentStorage {
-        val storage: FlatFileExperimentStorage = mock()
-        `when`(storage.retrieve()).thenReturn(ExperimentsSnapshot(emptyList(), null))
-        return storage
-    }
-
-    private fun getDefaultExperimentSourceMock(): KintoExperimentSource {
-        val source: KintoExperimentSource = mock()
-        `when`(source.getExperiments(any())).thenReturn(ExperimentsSnapshot(emptyList(), null))
-        return source
-    }
-
-    private fun resetExperiments(
-        source: KintoExperimentSource = getDefaultExperimentSourceMock(),
-        storage: FlatFileExperimentStorage = getDefaultExperimentStorageMock(),
-        valuesProvider: ValuesProvider = object : ValuesProvider() {
-            override fun getClientId(context: Context): String = EXAMPLE_CLIENT_ID
-            override fun getVersion(context: Context): String = "1.0"
-        }
-    ) {
-        // Initialize WorkManager (early) for instrumentation tests.
-        WorkManagerTestInitHelper.initializeTestWorkManager(context)
-
-        experiments = spy(ExperimentsInternalAPI())
-        experiments.valuesProvider = valuesProvider
-
-        experimentStorage = storage
-        `when`(experiments.getExperimentsStorage(context)).thenReturn(storage)
-        `when`(experimentStorage.save(any())).then {
-            // Do nothing
-        }
-
-        experimentsUpdater = spy(ExperimentsUpdater(context, experiments))
-        `when`(experiments.getExperimentsUpdater(context)).thenReturn(experimentsUpdater)
-        experimentSource = source
-        `when`(experimentsUpdater.getExperimentSource(configuration)).thenReturn(experimentSource)
-
-        // Since WorkManager doesn't support working with robolectric, we need to mock running the
-        // task with a way to execute synchronously to avoid a lot of headaches. For some test cases
-        // we also need to support running from a separate thread, so we use runBlocking and a
-        // coroutine to attempt to await the background thread.
-        `when`(experimentsUpdater.scheduleUpdates()).then {
-            experimentsUpdater.updateExperiments()
-        }
-    }
-
-    @After
-    fun cleanup() {
-        // Make sure there isn't a persisted file.  When using the mockContext, a .json file is
-        // written to the current directory when the flat file persisted storage is written and
-        // can show up as a new file in Git.
-        experiments.getExperimentsStorage(mockContext).delete()
-    }
-
-    @Test
-    fun `initialize experiments`() {
-        // Run this test with experiment updates as async to help validate async library operations
-        resetExperiments()
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        verify(experimentStorage).retrieve()
-        verify(experimentsUpdater).initialize(any())
-        verify(experimentSource).getExperiments(any())
-    }
-
-    @Test
-    fun `updating of experiments on library init`() {
-        // Run this test with experiment updates as async to help validate async library operations
-        resetExperiments()
-
-        // Set up the Kinto-side experiments.
-        val experimentsList = listOf(createDefaultExperiment())
-        val snapshot = ExperimentsSnapshot(experimentsList, null)
-        `when`(experimentSource.getExperiments(any())).thenReturn(snapshot)
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        verify(experimentStorage, times(1)).retrieve()
-        verify(experimentSource, times(1)).getExperiments(any())
-        verify(experiments, times(1)).onExperimentsUpdated(snapshot)
-    }
-
-    @Test
-    fun `update experiments from empty storage`() {
-        resetExperiments()
-
-        val emptySnapshot = ExperimentsSnapshot(listOf(), null)
-        val updateResult = ExperimentsSnapshot(listOf(createDefaultExperiment()), null)
-        `when`(experimentSource.getExperiments(emptySnapshot)).thenReturn(updateResult)
-        `when`(experimentStorage.retrieve()).thenReturn(emptySnapshot)
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        verify(experimentSource).getExperiments(emptySnapshot)
-        verify(experiments).onExperimentsUpdated(updateResult)
-        verify(experimentStorage).save(updateResult)
-    }
-
-    @Test
-    fun `update experiments from non-empty storage`() {
-        resetExperiments()
-
-        val storageSnapshot = ExperimentsSnapshot(
-            listOf(createDefaultExperiment(id = "id1")),
-            null
-        )
-        val updateResult = ExperimentsSnapshot(
-            listOf(createDefaultExperiment(id = "id2")),
-            null)
-        `when`(experimentSource.getExperiments(storageSnapshot)).thenReturn(updateResult)
-        `when`(experimentStorage.retrieve()).thenReturn(storageSnapshot)
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        verify(experimentSource).getExperiments(storageSnapshot)
-        verify(experiments).onExperimentsUpdated(updateResult)
-        verify(experimentStorage).save(updateResult)
-    }
-
-    @Test
-    fun `load two experiments from storage`() {
-        resetExperiments()
-        val experimentsList = listOf(
-            createDefaultExperiment(id = "first-id"),
-            createDefaultExperiment(id = "second-id")
-        )
-        `when`(experimentStorage.retrieve()).thenReturn(ExperimentsSnapshot(experimentsList, null))
-        // Throwing from the Kinto update means we continue with the experiments loaded from
-        // storage.
-        `when`(experimentSource.getExperiments(any())).then {
-            throw ExperimentDownloadException("oops")
-        }
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        val returned = experiments.experiments
-        assertEquals(2, returned.size)
-        assertTrue(returned.contains(experimentsList[0]))
-        assertTrue(returned.contains(experimentsList[1]))
-    }
-
-    @Test
-    fun `load empty experiments list from storage`() {
-        resetExperiments()
-        val experimentsList = emptyList<Experiment>()
-        `when`(experimentStorage.retrieve()).thenReturn(ExperimentsSnapshot(experimentsList, null))
-        // Throwing from the Kinto update means we continue with the experiments loaded from
-        // storage.
-        `when`(experimentSource.getExperiments(any())).then {
-            throw ExperimentDownloadException("oops")
-        }
-        experiments.initialize(context, configuration)
-
-        val returnedExperiments = experiments.experiments
-        assertEquals(0, returnedExperiments.size)
-    }
-
-    @Test
-    fun `load empty experiments list from server`() {
-        resetExperiments()
-        val experimentsList = emptyList<Experiment>()
-        val snapshot = ExperimentsSnapshot(experimentsList, null)
-        `when`(experimentStorage.retrieve()).thenReturn(snapshot)
-        `when`(experimentSource.getExperiments(any())).thenReturn(snapshot)
-        experiments.initialize(context, configuration)
-
-        val returnedExperiments = experiments.experiments
-        assertEquals(0, returnedExperiments.size)
-    }
-
-    @Test
-    fun `second update of experiments`() {
-        resetExperiments()
-
-        // Set up the Kinto-side experiments.
-        val experimentsList1 = listOf(createDefaultExperiment(id = "id"))
-        val snapshot1 = ExperimentsSnapshot(experimentsList1, null)
-        `when`(experimentSource.getExperiments(any())).thenReturn(snapshot1)
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        verify(experimentStorage, times(1)).retrieve()
-        verify(experimentSource, times(1)).getExperiments(any())
-        verify(experiments, times(1)).onExperimentsUpdated(snapshot1)
-        assertEquals(experimentsList1, experiments.experiments)
-        assertEquals(snapshot1, experiments.experimentsResult)
-
-        // Now change the source list, trigger an update and check it propagated.
-        val experimentsList2 = listOf(createDefaultExperiment(id = "id2"))
-        val snapshot2 = ExperimentsSnapshot(experimentsList2, null)
-        `when`(experimentSource.getExperiments(any())).thenReturn(snapshot2)
-
-        experimentsUpdater.updateExperiments()
-        verify(experimentStorage, times(1)).retrieve()
-        verify(experimentSource, times(1)).getExperiments(snapshot1)
-        verify(experiments, times(1)).onExperimentsUpdated(snapshot2)
-        assertEquals(experimentsList2, experiments.experiments)
-        assertEquals(snapshot2, experiments.experimentsResult)
-    }
-
-    @Test
-    fun `updating experiments invokes callback`() {
-        resetExperiments()
-
-        // Set up the Kinto-side experiments.
-        val experimentsList1 = listOf(createDefaultExperiment(id = "id"))
-        val snapshot1 = ExperimentsSnapshot(experimentsList1, null)
-        `when`(experimentSource.getExperiments(any())).thenReturn(snapshot1)
-
-        var canary = false
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration) { canary = true }
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        verify(experimentStorage, times(1)).retrieve()
-        verify(experimentSource, times(1)).getExperiments(any())
-        verify(experiments, times(1)).onExperimentsUpdated(snapshot1)
-        assertEquals(experimentsList1, experiments.experiments)
-        assertEquals(snapshot1, experiments.experimentsResult)
-        assertTrue(canary)
-    }
-
-    @Test
-    fun getActiveExperiments() {
-        resetExperiments()
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(mockContext, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-        experiments.experimentsResult = ExperimentsSnapshot(experimentsList, null)
-        experiments.findAndStartActiveExperiment()
-
-        assertNotNull(experiments.activeExperiment)
-        assertEquals("second-id", experiments.activeExperiment!!.experiment.id)
-    }
-
-    @Test
-    fun `enrollment and unenrollment recorded in Glean`() {
-        resetExperiments()
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(mockContext, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        // Update the experiments with an empty list to unenroll from any experiments
-        experiments.onExperimentsUpdated(ExperimentsSnapshot(listOf(), null))
-
-        // Make sure that we aren't already enrolled
-        assertFalse(Glean.testIsExperimentActive("second-id"))
-
-        // Simulate update from server that should enroll us in 'second-id' experiment
-        experiments.onExperimentsUpdated(ExperimentsSnapshot(experimentsList, null))
-        assertNotNull(experiments.activeExperiment)
-        assertEquals("second-id", experiments.activeExperiment!!.experiment.id)
-
-        // Verify that we are now enrolled in the experiment
-        assertTrue(Glean.testIsExperimentActive("second-id"))
-
-        // Update the experiments with an empty list to unenroll from any experiments
-        experiments.onExperimentsUpdated(ExperimentsSnapshot(listOf(), null))
-
-        // Verify we are now unenrolled
-        assertFalse(Glean.testIsExperimentActive("second-id"))
-    }
-
-    @Test
-    fun isInExperiment() {
-
-        run {
-            resetExperiments()
-
-            val experimentsList = listOf(
-                createDefaultExperiment(
-                    id = "first-id",
-                    match = createDefaultMatcher(
-                        appId = "test.appId"
-                    )
-                )
-            )
-
-            // Since initialization is performed off of the calling thread, we must be careful to
-            // await it in tests to prevent async issues.
-            experiments.initialize(mockContext, configuration)
-            runBlocking {
-                experiments.testInitJob?.join()
-            }
-            experiments.experimentsResult = ExperimentsSnapshot(experimentsList, null)
-            experiments.findAndStartActiveExperiment()
-
-            assertTrue(experiments.isInExperiment("first-id", "only-branch"))
-        }
-
-        run {
-            resetExperiments()
-
-            // Update experiments with the experiment "first-id" not being active anymore.
-            val experimentsList = listOf(
-                createDefaultExperiment(
-                    id = "first-id",
-                    match = createDefaultMatcher(
-                        appId = "other.appId"
-                    )
-                )
-            )
-
-            // Since initialization is performed off of the calling thread, we must be careful to
-            // await it in tests to prevent async issues.
-            experiments.initialize(mockContext, configuration)
-            runBlocking {
-                experiments.testInitJob?.join()
-            }
-            experiments.experimentsResult = ExperimentsSnapshot(experimentsList, null)
-            experiments.findAndStartActiveExperiment()
-
-            assertFalse(experiments.isInExperiment("first-id", "only-branch"))
-            assertFalse(experiments.isInExperiment("other-id", "only-branch"))
-        }
-    }
-
-    @Test
-    fun withExperiment() {
-        // Reset experiments with a mocked RNG for controlling branch choices.
-        var branchDiceRoll = 1
-        val valuesProvider = object : ValuesProvider() {
-            override fun getRandomBranchValue(lower: Int, upper: Int): Int {
-                return branchDiceRoll
-            }
-            override fun getClientId(context: Context): String = EXAMPLE_CLIENT_ID
-        }
-        resetExperiments(valuesProvider = valuesProvider)
-
-        val sharedPrefs = mock(SharedPreferences::class.java)
-        val prefsEditor = mock(SharedPreferences.Editor::class.java)
-
-        `when`(sharedPrefs.edit()).thenReturn(prefsEditor)
-        `when`(prefsEditor.putBoolean(anyString(), anyBoolean())).thenReturn(prefsEditor)
-        `when`(prefsEditor.putString(anyString(), anyString())).thenReturn(prefsEditor)
-        `when`(prefsEditor.clear()).thenReturn(prefsEditor)
-        `when`(mockContext.getSharedPreferences(anyString(), anyInt())).thenReturn(sharedPrefs)
-        `when`(sharedPrefs.getString(eq("id"), isNull())).thenReturn("first-id")
-        `when`(sharedPrefs.getString(eq("branch"), isNull())).thenReturn("branch2")
-        `when`(mockContext.packageName).thenReturn("test.appId")
-
-        // First no experiment should be active.
-        branchDiceRoll = 0
-        `when`(experimentSource.getExperiments(any())).thenReturn(ExperimentsSnapshot(emptyList(), null))
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(mockContext, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        val invocations: MutableList<String> = java.util.ArrayList()
-        experiments.withExperiment("first-id") {
-            invocations.add(it)
-        }
-        assertNull(experiments.activeExperiment)
-
-        // Get an initial experiments list from the servers.
-        var experimentsList = listOf(
-            createDefaultExperiment(
-                id = "first-id",
-                match = createDefaultMatcher(
-                    appId = "test.appId"
-                ),
-                branches = listOf(
-                    Experiment.Branch("branch1", 1),
-                    Experiment.Branch("branch2", 1),
-                    Experiment.Branch("branch3", 1)
-                )
-            )
-        )
-        // This should force choosing branch 2 of the experiment on update.
-        branchDiceRoll = 1
-        experiments.onExperimentsUpdated(ExperimentsSnapshot(experimentsList, null))
-
-        // Test active experiment.
-        invocations.clear()
-        experiments.withExperiment("first-id") {
-            invocations.add(it)
-        }
-        assertNotNull(experiments.activeExperiment)
-        assertEquals(listOf("branch2"), invocations)
-
-        // Restart the library and disable updates. The same experiment and branch should still be
-        // active from the cache.
-        invocations.clear()
-        resetExperiments(valuesProvider = valuesProvider)
-        branchDiceRoll = 0
-        experiments.updater = experimentsUpdater
-        experiments.updater.source = experimentSource
-        doAnswer {
-            throw ExperimentDownloadException("test")
-        }.`when`(experimentSource).getExperiments(any())
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(mockContext, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        experiments.withExperiment("first-id") {
-            invocations.add(it)
-        }
-        assertEquals(listOf("branch2"), invocations)
-
-        // Use an experiments list without the active experiment and trigger an update.
-        // The experiments should deactivate.
-        experimentsList = listOf(
-            createDefaultExperiment(
-                id = "other-id",
-                match = createDefaultMatcher(
-                    appId = "other.appId"
-                )
-            )
-        )
-        experiments.onExperimentsUpdated(ExperimentsSnapshot(experimentsList, null))
-
-        invocations.clear()
-        experiments.withExperiment("first-id") {
-            invocations.add(it)
-        }
-        assertTrue(invocations.isEmpty())
-        assertNull(experiments.activeExperiment)
-
-        // Change experiments list and trigger an update. The matcher now contains a non-matching
-        // app id, so no experiments should activate.
-        experimentsList = listOf(
-            createDefaultExperiment(
-                id = "first-id",
-                match = createDefaultMatcher(
-                    appId = "other.appId"
-                )
-            )
-        )
-        experiments.onExperimentsUpdated(ExperimentsSnapshot(experimentsList, null))
-        assertNull(experiments.activeExperiment)
-
-        invocations.clear()
-        experiments.withExperiment("first-id") {
-            invocations.add(it)
-        }
-        assertTrue(invocations.isEmpty())
-
-        invocations.clear()
-        experiments.withExperiment("other-id") {
-            invocations.add(it)
-        }
-        assertTrue(invocations.isEmpty())
-    }
-
-    @Test
-    fun getExperiment() {
-        resetExperiments()
-
-        val experimentsList = listOf(
-            createDefaultExperiment(
-                id = "first-id",
-                match = createDefaultMatcher(
-                    appId = "test.appId"
-                )
-            )
-        )
-        `when`(experimentSource.getExperiments(any())).thenReturn(ExperimentsSnapshot(experimentsList, null))
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        assertEquals(experimentsList[0], experiments.getExperiment("first-id"))
-        assertNull(experiments.getExperiment("other-id"))
-    }
-
-    private fun mockOverridePreferences(): Triple<Context, SharedPreferences.Editor, SharedPreferences.Editor> {
-        val context: Context = mock()
-        `when`(context.packageName).thenReturn("test.appId")
-        val packageInfo: PackageInfo = mock()
-        packageInfo.versionName = "version.name"
-        val packageManager: PackageManager = mock()
-        `when`(packageManager.getPackageInfo(anyString(), anyInt())).thenReturn(packageInfo)
-        `when`(context.packageManager).thenReturn(packageManager)
-
-        // Mock experiment override prefs for enabled status.
-        val sharedPrefsActive: SharedPreferences = mock()
-        val prefsEditorEnabled: SharedPreferences.Editor = mock()
-        `when`(prefsEditorEnabled.putBoolean(anyString(), anyBoolean())).thenReturn(prefsEditorEnabled)
-        `when`(prefsEditorEnabled.remove(anyString())).thenReturn(prefsEditorEnabled)
-        `when`(prefsEditorEnabled.clear()).thenReturn(prefsEditorEnabled)
-        `when`(sharedPrefsActive.edit()).thenReturn(prefsEditorEnabled)
-        `when`(sharedPrefsActive.getBoolean(anyString(), anyBoolean())).thenAnswer { invocation -> invocation.arguments[1] as Boolean }
-        `when`(context.getSharedPreferences(eq(ExperimentEvaluator.PREF_NAME_OVERRIDES_ENABLED), anyInt())).thenReturn(sharedPrefsActive)
-
-        // Mock experiment override prefs for active branch.
-        val sharedPrefsBranch: SharedPreferences = mock()
-        val prefsEditorBranch: SharedPreferences.Editor = mock()
-        `when`(prefsEditorBranch.putString(anyString(), anyString())).thenReturn(prefsEditorBranch)
-        `when`(prefsEditorBranch.remove(anyString())).thenReturn(prefsEditorBranch)
-        `when`(prefsEditorBranch.clear()).thenReturn(prefsEditorEnabled)
-        `when`(sharedPrefsBranch.edit()).thenReturn(prefsEditorBranch)
-        `when`(sharedPrefsBranch.getString(anyString(), eq(null))).thenAnswer { invocation -> invocation.arguments[1] as String }
-        `when`(context.getSharedPreferences(eq(ExperimentEvaluator.PREF_NAME_OVERRIDES_BRANCH), anyInt())).thenReturn(sharedPrefsBranch)
-
-        return Triple(context, prefsEditorEnabled, prefsEditorBranch)
-    }
-
-    @Test
-    fun setOverride() {
-        resetExperiments()
-
-        val experimentsList = listOf(
-            createDefaultExperiment(
-                id = "first-id"
-            )
-        )
-        `when`(experimentSource.getExperiments(any())).thenReturn(ExperimentsSnapshot(experimentsList, null))
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        val (
-            context: Context,
-            prefsEditorEnabled: SharedPreferences.Editor,
-            prefsEditorBranch: SharedPreferences.Editor
-        ) = mockOverridePreferences()
-
-        assertTrue(experiments.isInExperiment("first-id", "only-branch"))
-        experiments.setOverride(context, "first-id", false, "branch-1")
-        verify(prefsEditorEnabled).putBoolean("first-id", false)
-        verify(prefsEditorBranch).putString("first-id", "branch-1")
-        experiments.setOverride(context, "first-id", true, "branch-1")
-        verify(prefsEditorEnabled).putBoolean("first-id", true)
-        verify(prefsEditorBranch, times(2)).putString("first-id", "branch-1")
-
-        runBlocking(Dispatchers.Default) {
-            assertTrue(experiments.isInExperiment("first-id", "only-branch"))
-            experiments.setOverrideNow(context, "first-id", false, "branch-2")
-            verify(prefsEditorEnabled, times(2)).putBoolean("first-id", false)
-            verify(prefsEditorBranch, times(1)).putString("first-id", "branch-2")
-            experiments.setOverrideNow(context, "first-id", true, "branch-2")
-            verify(prefsEditorEnabled, times(2)).putBoolean("first-id", true)
-            verify(prefsEditorBranch, times(2)).putString("first-id", "branch-2")
-        }
-    }
-
-    @Test
-    fun clearOverride() {
-        resetExperiments()
-
-        val experimentsList = listOf(
-            createDefaultExperiment(
-                id = "first-id"
-            )
-        )
-        `when`(experimentSource.getExperiments(any())).thenReturn(ExperimentsSnapshot(experimentsList, null))
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        val (
-            context: Context,
-            prefsEditorEnabled: SharedPreferences.Editor,
-            prefsEditorBranch: SharedPreferences.Editor
-        ) = mockOverridePreferences()
-
-        assertTrue(experiments.isInExperiment("first-id", "only-branch"))
-        experiments.setOverride(context, "first-id", false, "branch-1")
-        verify(prefsEditorEnabled).putBoolean("first-id", false)
-        verify(prefsEditorBranch).putString("first-id", "branch-1")
-        experiments.clearOverride(context, "first-id")
-        verify(prefsEditorEnabled).remove("first-id")
-        verify(prefsEditorBranch).remove("first-id")
-
-        runBlocking(Dispatchers.Default) {
-            experiments.setOverrideNow(context, "first-id", false, "branch-1")
-            experiments.clearOverrideNow(context, "first-id")
-            verify(prefsEditorEnabled, times(2)).remove("first-id")
-            verify(prefsEditorBranch, times(2)).remove("first-id")
-        }
-    }
-
-    @Test
-    fun clearAllOverrides() {
-        resetExperiments()
-
-        val experimentsList = listOf(
-            createDefaultExperiment(
-                id = "first-id"
-            )
-        )
-        `when`(experimentSource.getExperiments(any())).thenReturn(ExperimentsSnapshot(experimentsList, null))
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-
-        val (
-            context: Context,
-            prefsEditorEnabled: SharedPreferences.Editor,
-            _: SharedPreferences.Editor
-        ) = mockOverridePreferences()
-
-        val packageInfo: PackageInfo = mock()
-        packageInfo.versionName = "version.name"
-        val packageManager: PackageManager = mock()
-        `when`(packageManager.getPackageInfo(anyString(), anyInt())).thenReturn(packageInfo)
-        `when`(context.packageManager).thenReturn(packageManager)
-
-        assertTrue(experiments.isInExperiment("first-id", "only-branch"))
-        experiments.setOverride(context, "first-id", false, "branch-2")
-        experiments.clearAllOverrides(context)
-        verify(prefsEditorEnabled).clear()
-
-        runBlocking(Dispatchers.Default) {
-            experiments.setOverrideNow(context, "first-id", false, "branch-2")
-            experiments.clearAllOverridesNow(context)
-            verify(prefsEditorEnabled, times(2)).clear()
-        }
-    }
-
-    @Test
-    fun updateExperimentsException() {
-        resetExperiments()
-        doAnswer {
-            throw ExperimentDownloadException("test")
-        }.`when`(experimentSource).getExperiments(any())
-        `when`(experimentStorage.retrieve()).thenReturn(ExperimentsSnapshot(listOf(), null))
-        experiments.initialize(context, configuration)
-    }
-
-    @Test
-    fun getUserBucket() {
-        val mockContext = mock(Context::class.java)
-        val sharedPrefs = mock(SharedPreferences::class.java)
-        val prefsEditor = mock(SharedPreferences.Editor::class.java)
-
-        `when`(sharedPrefs.edit()).thenReturn(prefsEditor)
-        `when`(prefsEditor.putBoolean(anyString(), anyBoolean())).thenReturn(prefsEditor)
-        `when`(prefsEditor.putString(anyString(), anyString())).thenReturn(prefsEditor)
-        `when`(mockContext.getSharedPreferences(anyString(), anyInt())).thenReturn(sharedPrefs)
-        `when`(sharedPrefs.getString(anyString(), isNull()))
-                .thenReturn("a94b1dab-030e-4b13-be15-cc80c1eda8b3")
-
-        resetExperiments(valuesProvider = ValuesProvider())
-        experiments.initialize(context, configuration)
-        assertEquals(954, experiments.getUserBucket(mockContext))
-    }
-
-    @Test
-    fun `getUserBucket() with overridden clientId`() {
-        val source = getDefaultExperimentSourceMock()
-        val storage = getDefaultExperimentStorageMock()
-
-        resetExperiments(source, storage, object : ValuesProvider() {
-            override fun getClientId(context: Context): String = EXAMPLE_CLIENT_ID
-        })
-        experiments.initialize(context, configuration)
-
-        assertEquals(779, experiments.getUserBucket(context))
-
-        resetExperiments(source, storage, object : ValuesProvider() {
-            override fun getClientId(context: Context): String = "01a15650-9a5d-4383-a7ba-2f047b25c620"
-        })
-        experiments.initialize(context, configuration)
-
-        assertEquals(355, experiments.getUserBucket(context))
-    }
-
-    @Test
-    fun `loading corrupt JSON`() {
-        val experimentSource: KintoExperimentSource = mock()
-
-        val file = File(ApplicationProvider.getApplicationContext<Context>().filesDir,
-            "corrupt-experiments.json")
-        file.writer().use {
-            it.write("""{"experiment":[""")
-        }
-
-        val experimentStorage = FlatFileExperimentStorage(file)
-
-        // resetExperiments causes an error here due to how we have mocked things with the updater
-        // which ends up calling onExperimentsUpdated with a null parameter causing the error.  In
-        // order to get around this, we need to minimize the mocking of the updater to avoid the
-        // error.
-        WorkManagerTestInitHelper.initializeTestWorkManager(context)
-
-        experiments = spy(ExperimentsInternalAPI())
-        experiments.valuesProvider = ValuesProvider()
-
-        `when`(experiments.getExperimentsStorage(context)).thenReturn(experimentStorage)
-
-        experimentsUpdater = spy(ExperimentsUpdater(context, experiments))
-        `when`(experiments.getExperimentsUpdater(context)).thenReturn(experimentsUpdater)
-        `when`(experimentsUpdater.getExperimentSource(configuration)).thenReturn(experimentSource)
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.
-        experiments.initialize(context, configuration)
-        runBlocking {
-            experiments.testInitJob?.join()
-        }
-        experiments.loadExperiments() // Should not throw
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsUpdaterTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsUpdaterTest.kt
deleted file mode 100644
index 2b8e4b649879..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ExperimentsUpdaterTest.kt
+++ /dev/null
@@ -1,137 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import androidx.test.core.app.ApplicationProvider
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import androidx.work.NetworkType
-import androidx.work.PeriodicWorkRequest
-import androidx.work.WorkerParameters
-import androidx.work.testing.WorkManagerTestInitHelper
-import mozilla.components.lib.fetch.httpurlconnection.HttpURLConnectionClient
-import mozilla.components.support.test.mock
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertFalse
-import org.junit.Assert.assertNotNull
-import org.junit.Assert.assertTrue
-import org.junit.Before
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.spy
-import java.util.concurrent.TimeUnit
-
-@RunWith(AndroidJUnit4::class)
-class ExperimentsUpdaterTest {
-    private var context: Context = ApplicationProvider.getApplicationContext()
-    // Setting the endpoint to a non-existent one to prevent actual experiments from being
-    // downloaded to tests.
-    private val configuration: Configuration = Configuration(httpClient = HttpURLConnectionClient(),
-        kintoEndpoint = "https://example.invalid")
-    private lateinit var experiments: ExperimentsInternalAPI
-    private lateinit var experimentStorage: FlatFileExperimentStorage
-    private lateinit var experimentSource: KintoExperimentSource
-    private lateinit var experimentsUpdater: ExperimentsUpdater
-    private lateinit var workRequest: PeriodicWorkRequest
-
-    private fun getDefaultExperimentStorageMock(): FlatFileExperimentStorage {
-        val storage: FlatFileExperimentStorage = mock()
-        `when`(storage.retrieve()).thenReturn(ExperimentsSnapshot(emptyList(), null))
-        return storage
-    }
-
-    private fun getDefaultExperimentSourceMock(): KintoExperimentSource {
-        val source: KintoExperimentSource = mock()
-        `when`(source.getExperiments(mozilla.components.support.test.any())).thenReturn(ExperimentsSnapshot(emptyList(), null))
-        return source
-    }
-
-    private fun resetExperiments(
-        source: KintoExperimentSource = getDefaultExperimentSourceMock(),
-        storage: FlatFileExperimentStorage = getDefaultExperimentStorageMock(),
-        valuesProvider: ValuesProvider = ValuesProvider()
-    ) {
-        // Initialize WorkManager (early) for instrumentation tests.
-        WorkManagerTestInitHelper.initializeTestWorkManager(context)
-
-        experiments = spy(ExperimentsInternalAPI())
-        experiments.valuesProvider = valuesProvider
-
-        experimentStorage = storage
-        `when`(experiments.getExperimentsStorage(context)).thenReturn(storage)
-
-        experimentsUpdater = spy(ExperimentsUpdater(context, experiments))
-        `when`(experiments.getExperimentsUpdater(context)).thenReturn(experimentsUpdater)
-        experimentSource = source
-        `when`(experimentsUpdater.getExperimentSource(configuration)).thenReturn(experimentSource)
-
-        workRequest = experimentsUpdater.getWorkRequest()
-        `when`(experimentsUpdater.getWorkRequest()).thenReturn(workRequest)
-    }
-
-    @Before
-    fun setUp() {
-        resetExperiments()
-    }
-
-    @Test
-    fun `ExperimentsUpdater initialize schedules ExperimentsUpdateWorker in WorkManager`() {
-        assertFalse("ExperimentsUpdateWorker should not be scheduled yet",
-            isWorkScheduled(context, ExperimentsUpdater.TAG))
-        experimentsUpdater.initialize(configuration)
-        assertTrue("initialize must schedule ExperimentsUpdateWorker",
-            isWorkScheduled(context, ExperimentsUpdater.TAG))
-        val workInfo = getWorkInfoByTag(context, ExperimentsUpdater.TAG)
-        assertNotNull("workInfo must not be null", workInfo)
-        assertEquals("workInfo id must match request id", workRequest.id, workInfo?.id)
-    }
-
-    @Test
-    fun `ExperimentsUpdateWorker doWork returns SUCCESS`() {
-        experiments.initialize(context, configuration)
-        experimentsUpdater.initialize(configuration)
-        // Replace the updater in the singleton with the one built for the test
-        Experiments.updater = experimentsUpdater
-        val workerParameters: WorkerParameters = mock()
-        val worker = ExperimentsUpdaterWorker(context, workerParameters)
-        val result = worker.doWork()
-        assertTrue(result.toString().contains("Success"))
-    }
-
-    @Test
-    fun `ExperimentsUpdateWorker doWork returns FAILURE when download fails`() {
-        experiments.initialize(context, configuration)
-        // Mock the updater in order to be able to return false from updateExperiments()
-        experimentsUpdater = mock()
-        `when`(experimentsUpdater.updateExperiments()).thenReturn(false)
-
-        // Replace the updater in the singleton with the one built for the test
-        Experiments.updater = experimentsUpdater
-        val workerParameters: WorkerParameters = mock()
-        val worker = ExperimentsUpdaterWorker(context, workerParameters)
-        val result = worker.doWork()
-        assertTrue(result.toString().contains("Failure"))
-    }
-
-    @Test
-    fun `getWorkRequest returns request with correct parameters`() {
-        val workRequest = experimentsUpdater.getWorkRequest()
-        assertTrue("work request must be properly tagged",
-            workRequest.tags.contains(ExperimentsUpdater.TAG))
-
-        assertTrue("work request must be periodic", workRequest.workSpec.isPeriodic)
-
-        // Work request converts the initial `HOURS` delay to milliseconds, so we must do the same
-        // when we check this.
-        assertEquals("work request must have correct interval duration",
-            TimeUnit.HOURS.toMillis(ExperimentsUpdater.UPDATE_INTERVAL_HOURS),
-            workRequest.workSpec.intervalDuration)
-
-        val constraints = workRequest.workSpec.constraints
-        assertEquals("work request constraints must have correct network type",
-            NetworkType.CONNECTED, constraints.requiredNetworkType)
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/FlatFileExperimentStorageTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/FlatFileExperimentStorageTest.kt
deleted file mode 100644
index cd853f71cf31..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/FlatFileExperimentStorageTest.kt
+++ /dev/null
@@ -1,207 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import mozilla.components.support.ktx.android.org.json.toList
-import mozilla.components.support.test.robolectric.testContext
-import org.json.JSONObject
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertFalse
-import org.junit.Assert.assertNull
-import org.junit.Assert.assertTrue
-import org.junit.Test
-import org.junit.runner.RunWith
-import java.io.File
-import java.nio.file.Files
-import java.nio.file.Paths
-
-@RunWith(AndroidJUnit4::class)
-class FlatFileExperimentStorageTest {
-    private var currentTime = System.currentTimeMillis() / 1000
-    private var pastTime = currentTime - 1000
-
-    private fun checkSavedExperimentsJson(experimentsJson: JSONObject) {
-        assertEquals(2, experimentsJson.length())
-        val experimentsJsonArray = experimentsJson.getJSONArray("experiments")
-        assertEquals(1, experimentsJsonArray.length())
-        val experiment = experimentsJsonArray[0] as JSONObject
-
-        assertEquals("sample-id", experiment.getString("id"))
-        assertEquals("sample-description", experiment.getString("description"))
-        assertEquals(pastTime, experiment.getLong("last_modified"))
-
-        val buckets = experiment.getJSONObject("buckets")
-        assertEquals(0, buckets.getInt("start"))
-        assertEquals(20, buckets.getInt("count"))
-
-        val branches = experiment.getJSONArray("branches")
-        assertEquals(2, branches.length())
-        val branch1 = branches.getJSONObject(0)
-        assertEquals("branch1", branch1.getString("name"))
-        assertEquals(2, branch1.getInt("ratio"))
-        val branch2 = branches.getJSONObject(1)
-        assertEquals("branch2", branch2.getString("name"))
-        assertEquals(5, branch2.getInt("ratio"))
-
-        val match = experiment.getJSONObject("match")
-        assertEquals("es|en", match.getString("locale_language"))
-        assertEquals("sample-appId", match.getString("app_id"))
-        val regions = match.getJSONArray("regions")
-        assertEquals(listOf("US"), regions.toList<String>())
-    }
-
-    @Test
-    fun save() {
-        val experiments = listOf(
-            createDefaultExperiment(
-                id = "sample-id",
-                description = "sample-description",
-                match = createDefaultMatcher(
-                    localeLanguage = "es|en",
-                    appId = "sample-appId",
-                    regions = listOf("US")
-                ),
-                buckets = Experiment.Buckets(0, 20),
-                branches = listOf(
-                    Experiment.Branch("branch1", 2),
-                    Experiment.Branch("branch2", 5)
-                ),
-                lastModified = pastTime
-            )
-        )
-        val file = File(testContext.filesDir, "experiments.json")
-        assertFalse(file.exists())
-        FlatFileExperimentStorage(file).save(ExperimentsSnapshot(experiments, pastTime))
-        assertTrue(file.exists())
-        val experimentsJson = JSONObject(String(Files.readAllBytes(Paths.get(file.absolutePath))))
-        checkSavedExperimentsJson(experimentsJson)
-        file.delete()
-    }
-
-    @Test
-    fun replacingContent() {
-        val file = File(testContext.filesDir, "experiments.json")
-
-        FlatFileExperimentStorage(file).save(ExperimentsSnapshot(listOf(
-            createDefaultExperiment(
-                id = "sample-id",
-                description = "sample-description",
-                buckets = Experiment.Buckets(0, 20),
-                branches = listOf(
-                    Experiment.Branch("branch1", 2),
-                    Experiment.Branch("branch2", 5)
-                ),
-                lastModified = pastTime
-            )
-        ), pastTime))
-
-        FlatFileExperimentStorage(file).save(ExperimentsSnapshot(listOf(
-            createDefaultExperiment(
-                id = "sample-id-updated",
-                description = "sample-description-updated",
-                buckets = Experiment.Buckets(10, 100),
-                branches = listOf(
-                    Experiment.Branch("some-branch", 42)
-                ),
-                lastModified = currentTime
-            )
-        ), currentTime))
-
-        val loadedExperiments = FlatFileExperimentStorage(file).retrieve().experiments
-
-        assertEquals(1, loadedExperiments.size)
-
-        val loadedExperiment = loadedExperiments[0]
-
-        assertEquals("sample-id-updated", loadedExperiment.id)
-        assertEquals("sample-description-updated", loadedExperiment.description)
-        assertEquals(currentTime, loadedExperiment.lastModified)
-        assertEquals(10, loadedExperiment.buckets.start)
-        assertEquals(100, loadedExperiment.buckets.count)
-        assertEquals(100, loadedExperiment.buckets.count)
-        assertEquals(1, loadedExperiment.branches.size)
-        assertEquals("some-branch", loadedExperiment.branches[0].name)
-        assertEquals(42, loadedExperiment.branches[0].ratio)
-    }
-
-    @Test
-    fun retrieve() {
-        val file = File(testContext.filesDir, "experiments.json")
-        val json = """
-            {
-              "experiments": [
-                {
-                  "id": "sample-id",
-                  "match": {
-                    "locale_language": "es|en",
-                    "app_id": "sample-appId",
-                    "regions": [
-                      "US"
-                    ]
-                  },
-                  "buckets": {
-                    "start": 0,
-                    "count": 20
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 42
-                    }
-                  ],
-                  "description": "sample-description",
-                  "last_modified": $pastTime
-                }
-              ],
-              "last_modified": $pastTime
-            }
-        """.trimIndent()
-
-        file.writer().use {
-            it.write(json)
-        }
-        val experimentsResult = FlatFileExperimentStorage(file).retrieve()
-        val experiments = experimentsResult.experiments
-        file.delete()
-        assertEquals(1, experiments.size)
-
-        val experiment = experiments[0]
-        assertEquals("sample-id", experiment.id)
-        assertEquals("sample-description", experiment.description)
-        assertEquals(listOf("US"), experiment.match.regions)
-        assertEquals("es|en", experiment.match.localeLanguage)
-        assertEquals("sample-appId", experiment.match.appId)
-        assertEquals(0, experiment.buckets.start)
-        assertEquals(20, experiment.buckets.count)
-        assertEquals(pastTime, experiment.lastModified)
-        assertEquals(1, experiment.branches.size)
-        assertEquals("some-branch", experiment.branches[0].name)
-        assertEquals(42, experiment.branches[0].ratio)
-
-        assertEquals(pastTime, experimentsResult.lastModified)
-    }
-
-    @Test
-    fun retrieveFileNotFound() {
-        val file = File(testContext.filesDir, "missingFile.json")
-        val experimentsResult = FlatFileExperimentStorage(file).retrieve()
-        assertEquals(0, experimentsResult.experiments.size)
-        assertNull(experimentsResult.lastModified)
-    }
-
-    @Test
-    fun readingCorruptJSON() {
-        val file = File(testContext.filesDir, "corrupt-experiments.json")
-        file.writer().use {
-            it.write("""{"experiment":[""")
-        }
-
-        val snapshot = FlatFileExperimentStorage(file).retrieve()
-
-        assertNull(snapshot.lastModified)
-        assertEquals(0, snapshot.experiments.size)
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/JSONExperimentParserTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/JSONExperimentParserTest.kt
deleted file mode 100644
index 27a672fa58fc..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/JSONExperimentParserTest.kt
+++ /dev/null
@@ -1,286 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import mozilla.components.service.experiments.util.VersionString
-import mozilla.components.support.ktx.android.org.json.tryGetInt
-import org.json.JSONException
-import org.json.JSONObject
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertFalse
-import org.junit.Assert.assertNotEquals
-import org.junit.Assert.assertNull
-import org.junit.Test
-import org.junit.runner.RunWith
-
-@RunWith(AndroidJUnit4::class)
-class JSONExperimentParserTest {
-    private var currentTime = System.currentTimeMillis() / 1000
-
-    @Test
-    fun toJson() {
-        val experiment = createDefaultExperiment(
-            id = "sample-id",
-            description = "sample-description",
-            match = createDefaultMatcher(
-                appId = "sample-appId",
-                regions = listOf("US"),
-                appDisplayVersion = "1.0",
-                appMinVersion = VersionString("0.1.0"),
-                appMaxVersion = VersionString("1.1.0"),
-                deviceManufacturer = "manufacturer",
-                deviceModel = "device",
-                localeCountry = "country",
-                localeLanguage = "es|en"
-            ),
-            buckets = Experiment.Buckets(0, 20),
-            branches = listOf(
-                Experiment.Branch("branch1", 1),
-                Experiment.Branch("branch2", 2),
-                Experiment.Branch("branch3", 1)
-            ),
-            lastModified = currentTime
-        )
-
-        val jsonObject = JSONExperimentParser().toJson(experiment)
-
-        assertEquals("sample-id", jsonObject.getString("id"))
-        assertEquals("sample-description", jsonObject.getString("description"))
-        assertEquals(currentTime, jsonObject.getLong("last_modified"))
-
-        val buckets = jsonObject.getJSONObject("buckets")
-        assertEquals(0, buckets.getInt("start"))
-        assertEquals(20, buckets.getInt("count"))
-
-        val branches = jsonObject.getJSONArray("branches")
-        assertEquals("branch1", branches.getJSONObject(0).getString("name"))
-        assertEquals(1, branches.getJSONObject(0).getInt("ratio"))
-        assertEquals("branch2", branches.getJSONObject(1).getString("name"))
-        assertEquals(2, branches.getJSONObject(1).getInt("ratio"))
-        assertEquals("branch3", branches.getJSONObject(2).getString("name"))
-        assertEquals(1, branches.getJSONObject(2).getInt("ratio"))
-
-        val match = jsonObject.getJSONObject("match")
-        val regions = match.getJSONArray("regions")
-        assertEquals(1, regions.length())
-        assertEquals("US", regions.get(0))
-        assertEquals("sample-appId", match.getString("app_id"))
-        assertEquals("es|en", match.getString("locale_language"))
-        assertEquals("1.0", match.getString("app_display_version"))
-        assertEquals("0.1.0", match.getString("app_min_version"))
-        assertEquals("1.1.0", match.getString("app_max_version"))
-        assertEquals("manufacturer", match.getString("device_manufacturer"))
-        assertEquals("device", match.getString("device_model"))
-        assertEquals("country", match.getString("locale_country"))
-    }
-
-    @Test
-    fun `toJson for null values`() {
-        val experiment = Experiment(
-            id = "",
-            description = "",
-            lastModified = null,
-            schemaModified = null,
-            buckets = Experiment.Buckets(0, 0),
-            branches = emptyList(),
-            match = Experiment.Matcher(
-                null,
-                null,
-                null,
-                null,
-                null,
-                null,
-                null,
-                null,
-                null,
-                null
-            )
-        )
-
-        val jsonObject = JSONExperimentParser().toJson(experiment)
-        assertEquals("", jsonObject.getString("id"))
-        assertEquals("", jsonObject.getString("description"))
-        assertNull(jsonObject.tryGetInt("last_modified"))
-        assertNull(jsonObject.tryGetInt("schema"))
-
-        val buckets = jsonObject.getJSONObject("buckets")
-        assertEquals(0, buckets.getInt("start"))
-        assertEquals(0, buckets.getInt("count"))
-
-        val branches = jsonObject.getJSONArray("branches")
-        assertEquals(0, branches.length())
-
-        val match = jsonObject.getJSONObject("match")
-        assertFalse(match.keys().hasNext())
-    }
-
-    @Test
-    fun fromJson() {
-        val json = """
-            {
-              "id": "sample-id",
-              "description": "sample-description",
-              "buckets": {
-                "start": 0,
-                "count": 20
-              },
-              "branches": [
-                {
-                  "name": "branch0",
-                  "ratio": "1"
-                }
-              ],
-              "match": {
-                "regions": [
-                  "US"
-                ],
-                "app_id": "sample-appId",
-                "locale_language": "es|en",
-                "app_min_version": "1.0.0",
-                "app_max_version": "1.1.0"
-              },
-              "last_modified": $currentTime
-            }
-        """.trimIndent()
-
-        val expectedExperiment = createDefaultExperiment(
-            id = "sample-id",
-            description = "sample-description",
-            match = createDefaultMatcher(
-                localeLanguage = "es|en",
-                appId = "sample-appId",
-                regions = listOf("US"),
-                appMinVersion = VersionString("1.0.0"),
-                appMaxVersion = VersionString("1.1.0")
-            ),
-            buckets = Experiment.Buckets(0, 20),
-            lastModified = currentTime
-        )
-        assertEquals(expectedExperiment, JSONExperimentParser().fromJson(JSONObject(json)))
-    }
-
-    @Test
-    fun `fromJson() with debug tag`() {
-        val json = """
-            {
-              "id": "sample-id",
-              "description": "sample-description",
-              "buckets": {
-                "start": 0,
-                "count": 20
-              },
-              "branches": [
-                {
-                  "name": "branch0",
-                  "ratio": "1"
-                }
-              ],
-              "match": {
-                "regions": [
-                  "US"
-                ],
-                "app_id": "sample-appId",
-                "locale_language": "es|en"
-              },
-              "last_modified": $currentTime,
-              "debug_tags": ["dummy-tag"]
-            }
-        """.trimIndent()
-
-        val expectedExperiment = createDefaultExperiment(
-            id = "sample-id",
-            description = "sample-description",
-            match = createDefaultMatcher(
-                localeLanguage = "es|en",
-                appId = "sample-appId",
-                regions = listOf("US"),
-                debugTags = listOf("dummy-tags")
-            ),
-            buckets = Experiment.Buckets(0, 20),
-            lastModified = currentTime
-        )
-        assertEquals(expectedExperiment, JSONExperimentParser().fromJson(JSONObject(json)))
-    }
-
-    @Test(expected = JSONException::class)
-    fun `fromJson with non present values`() {
-        val json = """
-            {
-                "id": "id",
-            }
-        """.trimIndent()
-        JSONExperimentParser().fromJson(JSONObject(json))
-    }
-
-    @Test
-    fun `fromJson for null values`() {
-        val json = """
-            {
-              "id": null,
-              "match": {
-              },
-              "buckets": {
-                "start": 0,
-                "count": 0
-              },
-              "branches": [
-                {
-                  "name": "branch0",
-                  "ratio": "1"
-                }
-              ],
-              "description": null,
-              "last_modified": null
-            }
-        """.trimIndent()
-        var experiment = createDefaultExperiment(id = "sample-id")
-        assertNotEquals(experiment, JSONExperimentParser().fromJson(JSONObject(json)))
-
-        val emptyObjects = """
-            {
-              "id": "sample-id",
-              "description": "",
-              "buckets": {
-                "start": 0,
-                "count": 0
-              },
-              "branches": [
-                {
-                  "name": "branch0",
-                  "ratio": "1"
-                }
-              ],
-              "match": {
-                "locale_language": null,
-                "app_id": null,
-                "regions": null
-              }
-            }
-        """.trimIndent()
-        experiment = createDefaultExperiment(id = "sample-id")
-        assertEquals(experiment, JSONExperimentParser().fromJson(JSONObject(emptyObjects)))
-    }
-
-    @Test(expected = JSONException::class)
-    fun `fromJson with empty branches list`() {
-        val json = """
-            {
-              "id": "some-id",
-              "match": {
-              },
-              "buckets": {
-                "start": 0,
-                "count": 0
-              },
-              "branches": [
-              ],
-              "description": "",
-              "last_modified": 1234
-            }
-        """.trimIndent()
-        JSONExperimentParser().fromJson(JSONObject(json))
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/KintoClientTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/KintoClientTest.kt
deleted file mode 100644
index 8a53f8b7e9b2..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/KintoClientTest.kt
+++ /dev/null
@@ -1,84 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import mozilla.components.concept.fetch.Client
-import mozilla.components.concept.fetch.MutableHeaders
-import mozilla.components.concept.fetch.Response
-import mozilla.components.support.test.any
-import mozilla.components.support.test.eq
-import org.junit.Assert.assertEquals
-import org.junit.Test
-import org.mockito.Mockito
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.mock
-import org.mockito.Mockito.spy
-import org.mockito.Mockito.verify
-import java.io.IOException
-
-class KintoClientTest {
-    private val baseUrl = "http://example.test"
-    private val bucketName = "fretboard"
-    private val collectionName = "experiments"
-
-    @Test
-    fun get() {
-        val httpClient = mock(Client::class.java)
-        `when`(httpClient.fetch(any())).thenReturn(
-            Response("", 200, MutableHeaders(), Response.Body("getResult".byteInputStream()))
-        )
-
-        val kintoClient = KintoClient(httpClient, baseUrl, bucketName, collectionName)
-        assertEquals("getResult", kintoClient.get())
-    }
-
-    @Test
-    fun diff() {
-        val httpClient = mock(Client::class.java)
-        `when`(httpClient.fetch(any())).thenReturn(
-                Response("", 200, MutableHeaders(), Response.Body("diffResult".byteInputStream()))
-        )
-
-        val kintoClient = spy(KintoClient(httpClient, baseUrl, bucketName, collectionName))
-        assertEquals("diffResult", kintoClient.diff(1527179995))
-
-        verify(kintoClient).fetch(eq("http://example.test/buckets/fretboard/collections/experiments/records?_since=1527179995"))
-    }
-
-    /**
-     * On some devices we are seeing an ArrayIndexOutOfBoundsException somewhere inside AOSP/okhttp.
-     *
-     * See:
-     * https://github.com/mozilla-mobile/android-components/issues/964
-     */
-    @Test(expected = ExperimentDownloadException::class)
-    fun handlesArrayIndexOutOfBoundsExceptioForFetch() {
-        val httpClient = mock(Client::class.java)
-        val kintoClient = KintoClient(httpClient, baseUrl, bucketName, collectionName)
-
-        Mockito.doThrow(ArrayIndexOutOfBoundsException()).`when`(httpClient).fetch(any())
-
-        kintoClient.fetch("test")
-    }
-
-    @Test(expected = ExperimentDownloadException::class)
-    fun handlesIOExceptionForFetch() {
-        val httpClient = mock(Client::class.java)
-        val kintoClient = KintoClient(httpClient, baseUrl, bucketName, collectionName)
-
-        Mockito.doThrow(IOException()).`when`(httpClient).fetch(any())
-
-        kintoClient.fetch("test")
-    }
-
-    @Test(expected = ExperimentDownloadException::class)
-    fun handlesFetchErrorResponse() {
-        val httpClient = mock(Client::class.java)
-        val kintoClient = KintoClient(httpClient, baseUrl, bucketName, collectionName)
-
-        Mockito.doReturn(Response("", 404, MutableHeaders(), Response.Body.empty())).`when`(httpClient).fetch(any())
-        kintoClient.fetch("test")
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/KintoExperimentSourceTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/KintoExperimentSourceTest.kt
deleted file mode 100644
index 61d44f2f4b60..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/KintoExperimentSourceTest.kt
+++ /dev/null
@@ -1,347 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import mozilla.components.concept.fetch.Client
-import mozilla.components.concept.fetch.MutableHeaders
-import mozilla.components.concept.fetch.Response
-import mozilla.components.support.test.any
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertNull
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.mock
-
-@RunWith(AndroidJUnit4::class)
-class KintoExperimentSourceTest {
-    private val baseUrl = "http://mydomain.test"
-    private val bucketName = "fretboard"
-    private val collectionName = "experiments"
-    private var currentTime = System.currentTimeMillis() / 1000
-    private var pastTime = currentTime - 1000
-
-    @Test
-    fun noExperiments() {
-        val httpClient = mock(Client::class.java)
-        val url = "$baseUrl/buckets/$bucketName/collections/$collectionName/records"
-        val json = """
-            {
-                "data": []
-            }
-        """.trimIndent()
-
-        `when`(httpClient.fetch(any()))
-            .thenReturn(Response(url, 200, MutableHeaders(), Response.Body(json.byteInputStream())))
-        val experimentSource = KintoExperimentSource(baseUrl, bucketName, collectionName, httpClient)
-        val result = experimentSource.getExperiments(ExperimentsSnapshot(listOf(), null))
-        assertEquals(0, result.experiments.size)
-        assertNull(result.lastModified)
-    }
-
-    @Test
-    fun getExperimentsNoDiff() {
-        val httpClient = mock(Client::class.java)
-
-        val url = "$baseUrl/buckets/$bucketName/collections/$collectionName/records"
-        val json = """
-            {
-                "data":[
-                    {
-                        "id": "first-id",
-                        "id": "first-id",
-                        "description": "first-description",
-                        "last_modified": $pastTime,
-                        "match": {
-                            "locale_language": "eng",
-                            "app_id": "first-appId",
-                            "regions": []
-                        },
-                        "schema": 1523549592861,
-                        "buckets": {
-                            "start": "0",
-                            "count": "100"
-                        },
-                        "branches": [
-                            {
-                                "name": "branch1",
-                                "ratio": "1"
-                            }
-                        ]
-                    }
-                ]
-            }
-        """.trimIndent()
-
-        `when`(httpClient.fetch(any())).thenReturn(
-            Response(url,
-                200,
-                MutableHeaders(),
-                Response.Body(json.byteInputStream())))
-
-        val expectedExperiment = createDefaultExperiment(
-            id = "first-id",
-            description = "first-description",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "first-appId",
-                regions = listOf()
-            ),
-            buckets = Experiment.Buckets(0, 100),
-            lastModified = pastTime
-        )
-
-        val experimentSource = KintoExperimentSource(baseUrl, bucketName, collectionName, httpClient)
-        val kintoExperiments = experimentSource.getExperiments(ExperimentsSnapshot(listOf(), null))
-        assertEquals(1, kintoExperiments.experiments.size)
-        assertEquals(expectedExperiment, kintoExperiments.experiments[0])
-        assertEquals(pastTime, kintoExperiments.lastModified)
-    }
-
-    @Test
-    fun getExperimentsDiffAdd() {
-        val httpClient = mock(Client::class.java)
-        val url = "$baseUrl/buckets/$bucketName/collections/$collectionName/records?_since=1523549890000"
-        val json = """
-            {
-                "data": [
-                    {
-                        "id": "first-id",
-                        "description": "first-description",
-                        "last_modified": $pastTime,
-                        "match": {
-                            "locale_language": "eng",
-                            "app_id": "first-appId",
-                            "regions": []
-                        },
-                        "schema": 1523549592861,
-                        "buckets": {
-                            "start": "0",
-                            "count": "100"
-                        },
-                        "branches": [
-                            {
-                                "name": "branch1",
-                                "ratio": "1"
-                            }
-                        ]
-                    }
-                ]
-            }
-        """.trimIndent()
-
-        `when`(httpClient.fetch(any())).thenReturn(
-            Response(url,
-                200,
-                MutableHeaders(),
-                Response.Body(json.byteInputStream())))
-
-        val kintoExperiment = createDefaultExperiment(
-            id = "first-id",
-            description = "first-description",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "first-appId",
-                regions = listOf()
-            ),
-            buckets = Experiment.Buckets(0, 100),
-            lastModified = currentTime
-        )
-
-        val storageExperiment = createDefaultExperiment(
-            id = "id",
-            description = "description",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "appId",
-                regions = listOf("US")
-            ),
-            buckets = Experiment.Buckets(5, 5),
-            lastModified = pastTime
-        )
-
-        val experimentSource = KintoExperimentSource(baseUrl, bucketName, collectionName, httpClient)
-        val kintoExperiments = experimentSource.getExperiments(ExperimentsSnapshot(listOf(storageExperiment), pastTime))
-        assertEquals(2, kintoExperiments.experiments.size)
-        assertEquals(storageExperiment, kintoExperiments.experiments[0])
-        assertEquals(kintoExperiment, kintoExperiments.experiments[1])
-        assertEquals(pastTime, kintoExperiments.lastModified)
-    }
-
-    @Test
-    fun getExperimentsDiffDelete() {
-        val httpClient = mock(Client::class.java)
-
-        val storageExperiment = createDefaultExperiment(
-            id = "id",
-            description = "description",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "appId",
-                regions = listOf("US")
-            ),
-            buckets = Experiment.Buckets(5, 5),
-            lastModified = pastTime
-        )
-
-        val secondExperiment = createDefaultExperiment(
-            id = "id2",
-            description = "description2",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "appId",
-                regions = listOf("US")
-            ),
-            buckets = Experiment.Buckets(5, 5),
-            lastModified = pastTime
-        )
-
-        val json = """
-            {
-                "data": [
-                    {
-                        "deleted": true,
-                        "id": "id",
-                        "last_modified": $currentTime
-                    }
-                ]
-            }
-        """.trimIndent()
-
-        `when`(httpClient.fetch(any())).thenReturn(
-                Response("$baseUrl/buckets/$bucketName/collections/$collectionName/records?_since=$pastTime",
-                        200,
-                        MutableHeaders(),
-                        Response.Body(json.byteInputStream())))
-
-        val experimentSource = KintoExperimentSource(baseUrl, bucketName, collectionName, httpClient)
-        val kintoExperiments = experimentSource.getExperiments(ExperimentsSnapshot(listOf(storageExperiment, secondExperiment), pastTime))
-        assertEquals(1, kintoExperiments.experiments.size)
-        assertEquals(currentTime, kintoExperiments.lastModified)
-
-        val json2 = """
-            {
-                "data": []
-            }
-        """.trimIndent()
-
-        `when`(httpClient.fetch(any())).thenReturn(
-                Response("$baseUrl/buckets/$bucketName/collections/$collectionName/records?_since=1523549899999",
-                        200,
-                        MutableHeaders(),
-                        Response.Body(json2.byteInputStream())))
-
-        val experimentsResult = experimentSource.getExperiments(ExperimentsSnapshot(kintoExperiments.experiments, currentTime))
-        assertEquals(1, experimentsResult.experiments.size)
-        assertEquals(currentTime, experimentsResult.lastModified)
-    }
-
-    @Test
-    fun getExperimentsDiffUpdate() {
-        val httpClient = mock(Client::class.java)
-        val url = "$baseUrl/buckets/$bucketName/collections/$collectionName/records?_since=1523549800000"
-
-        val json = """
-            {
-                "data": [
-                    {
-                        "id": "first-id",
-                        "description": "first-description",
-                        "last_modified": $currentTime,
-                        "match": {
-                            "locale_language": "eng",
-                            "app_id": "first-appId",
-                            "regions": []
-                        },
-                        "schema": 1523549592861,
-                        "buckets": {
-                            "start": "0",
-                            "count": "100"
-                        },
-                        "branches": [
-                            {
-                                "name": "branch1",
-                                "ratio": "1"
-                            }
-                        ]
-                    }
-                ]
-            }
-        """.trimIndent()
-
-        `when`(httpClient.fetch(any())).thenReturn(
-            Response(url,
-                200,
-                MutableHeaders(),
-                Response.Body(json.byteInputStream())))
-
-        val kintoExperiment = createDefaultExperiment(
-            id = "first-id",
-            description = "first-description",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "first-appId",
-                regions = listOf()
-            ),
-            buckets = Experiment.Buckets(0, 100),
-            lastModified = currentTime
-        )
-
-        val storageExperiment = createDefaultExperiment(
-            id = "first-id",
-            description = "description",
-            match = createDefaultMatcher(
-                localeLanguage = "es",
-                appId = "appId",
-                regions = listOf("UK")
-            ),
-            buckets = Experiment.Buckets(20, 180),
-            lastModified = pastTime
-        )
-
-        val experimentSource = KintoExperimentSource(baseUrl, bucketName, collectionName, httpClient)
-        val kintoExperiments = experimentSource.getExperiments(ExperimentsSnapshot(listOf(storageExperiment), pastTime))
-        assertEquals(1, kintoExperiments.experiments.size)
-        assertEquals(kintoExperiment, kintoExperiments.experiments[0])
-        assertEquals(currentTime, kintoExperiments.lastModified)
-    }
-
-    @Test
-    fun getExperimentsEmptyDiff() {
-        val httpClient = mock(Client::class.java)
-        val url = "$baseUrl/buckets/$bucketName/collections/$collectionName/records?_since=$pastTime"
-
-        val json = """
-            {
-                "data": []
-            }
-        """.trimIndent()
-
-        `when`(httpClient.fetch(any())).thenReturn(
-            Response(url,
-                200,
-                MutableHeaders(),
-                Response.Body(json.byteInputStream())))
-
-        val storageExperiment = createDefaultExperiment(
-            id = "first-id",
-            description = "first-description",
-            match = createDefaultMatcher(
-                localeLanguage = "eng",
-                appId = "first-appId",
-                regions = listOf()
-            ),
-            buckets = Experiment.Buckets(0, 100),
-            lastModified = pastTime
-        )
-
-        val experimentSource = KintoExperimentSource(baseUrl, bucketName, collectionName, httpClient)
-        val kintoExperiments = experimentSource.getExperiments(ExperimentsSnapshot(listOf(storageExperiment), pastTime))
-        assertEquals(1, kintoExperiments.experiments.size)
-        assertEquals(storageExperiment, kintoExperiments.experiments[0])
-        assertEquals(pastTime, kintoExperiments.lastModified)
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/SignatureVerifierTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/SignatureVerifierTest.kt
deleted file mode 100644
index 32484c1c3c6c..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/SignatureVerifierTest.kt
+++ /dev/null
@@ -1,1048 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import mozilla.components.lib.fetch.httpurlconnection.HttpURLConnectionClient
-import okhttp3.mockwebserver.Dispatcher
-import okhttp3.mockwebserver.MockResponse
-import okhttp3.mockwebserver.MockWebServer
-import okhttp3.mockwebserver.RecordedRequest
-import org.json.JSONObject
-import org.junit.After
-import org.junit.Assert.assertEquals
-import org.junit.Before
-import org.junit.Test
-import org.junit.runner.RunWith
-import java.util.Calendar
-import java.util.Date
-
-@RunWith(AndroidJUnit4::class)
-class SignatureVerifierTest {
-    private lateinit var server: MockWebServer
-
-    @Before
-    fun setUp() {
-        server = MockWebServer()
-    }
-
-    @After
-    fun tearDown() {
-        server.shutdown()
-    }
-
-    private fun defaultDate(): Date {
-        val calendar = Calendar.getInstance()
-        calendar.set(Calendar.YEAR, 2018)
-        calendar.set(Calendar.MONTH, 6)
-        calendar.set(Calendar.DAY_OF_MONTH, 13)
-        return calendar.time
-    }
-
-    @Test(expected = ExperimentDownloadException::class)
-    fun validSignatureOneCertificate() {
-        val url = server.url("/").url().toString()
-        val metadataBody = """
-            {
-              "data": {
-                "signature": {
-                  "x5u": "$url",
-                  "signature": "kRhyWZdLyjligYHSFhzhbyzUXBoUwoTPvyt9V0e-E7LKGgUYF2MVfqpA2zfIEDdqrImcMABVGHLUx9Nk614zciRBQ-gyaKA5SL2pPdZvoQXk_LLsPhEBgG4VDnxG4SBL"
-                }
-              }
-            }
-        """.trimIndent()
-        val certChainBody = "-----BEGIN CERTIFICATE-----\n" +
-            "MIIGYTCCBEmgAwIBAgIBATANBgkqhkiG9w0BAQwFADB9MQswCQYDVQQGEwJVUzEc\n" +
-            "MBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMmTW96aWxsYSBB\n" +
-            "TU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMTFnJvb3QtY2Et\n" +
-            "cHJvZHVjdGlvbi1hbW8wHhcNMTUwMzE3MjI1MzU3WhcNMjUwMzE0MjI1MzU3WjB9\n" +
-            "MQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0G\n" +
-            "A1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAd\n" +
-            "BgNVBAMTFnJvb3QtY2EtcHJvZHVjdGlvbi1hbW8wggIgMA0GCSqGSIb3DQEBAQUA\n" +
-            "A4ICDQAwggIIAoICAQC0u2HXXbrwy36+MPeKf5jgoASMfMNz7mJWBecJgvlTf4hH\n" +
-            "JbLzMPsIUauzI9GEpLfHdZ6wzSyFOb4AM+D1mxAWhuZJ3MDAJOf3B1Rs6QorHrl8\n" +
-            "qqlNtPGqepnpNJcLo7JsSqqE3NUm72MgqIHRgTRsqUs+7LIPGe7262U+N/T0LPYV\n" +
-            "Le4rZ2RDHoaZhYY7a9+49mHOI/g2YFB+9yZjE+XdplT2kBgA4P8db7i7I0tIi4b0\n" +
-            "B0N6y9MhL+CRZJyxdFe2wBykJX14LsheKsM1azHjZO56SKNrW8VAJTLkpRxCmsiT\n" +
-            "r08fnPyDKmaeZ0BtsugicdipcZpXriIGmsZbI12q5yuwjSELdkDV6Uajo2n+2ws5\n" +
-            "uXrP342X71WiWhC/dF5dz1LKtjBdmUkxaQMOP/uhtXEKBrZo1ounDRQx1j7+SkQ4\n" +
-            "BEwjB3SEtr7XDWGOcOIkoJZWPACfBLC3PJCBWjTAyBlud0C5n3Cy9regAAnOIqI1\n" +
-            "t16GU2laRh7elJ7gPRNgQgwLXeZcFxw6wvyiEcmCjOEQ6PM8UQjthOsKlszMhlKw\n" +
-            "vjyOGDoztkqSBy/v+Asx7OW2Q7rlVfKarL0mREZdSMfoy3zTgtMVCM0vhNl6zcvf\n" +
-            "5HNNopoEdg5yuXo2chZ1p1J+q86b0G5yJRMeT2+iOVY2EQ37tHrqUURncCy4uwIB\n" +
-            "A6OB7TCB6jAMBgNVHRMEBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAWBgNVHSUBAf8E\n" +
-            "DDAKBggrBgEFBQcDAzCBkgYDVR0jBIGKMIGHoYGBpH8wfTELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMR8wHQYDVQQDExZyb290LWNh\n" +
-            "LXByb2R1Y3Rpb24tYW1vggEBMB0GA1UdDgQWBBSzvOpYdKvhbngqsqucIx6oYyyX\n" +
-            "tzANBgkqhkiG9w0BAQwFAAOCAgEAaNSRYAaECAePQFyfk12kl8UPLh8hBNidP2H6\n" +
-            "KT6O0vCVBjxmMrwr8Aqz6NL+TgdPmGRPDDLPDpDJTdWzdj7khAjxqWYhutACTew5\n" +
-            "eWEaAzyErbKQl+duKvtThhV2p6F6YHJ2vutu4KIciOMKB8dslIqIQr90IX2Usljq\n" +
-            "8Ttdyf+GhUmazqLtoB0GOuESEqT4unX6X7vSGu1oLV20t7t5eCnMMYD67ZBn0YIU\n" +
-            "/cm/+pan66hHrja+NeDGF8wabJxdqKItCS3p3GN1zUGuJKrLykxqbOp/21byAGog\n" +
-            "Z1amhz6NHUcfE6jki7sM7LHjPostU5ZWs3PEfVVgha9fZUhOrIDsyXEpCWVa3481\n" +
-            "LlAq3GiUMKZ5DVRh9/Nvm4NwrTfB3QkQQJCwfXvO9pwnPKtISYkZUqhEqvXk5nBg\n" +
-            "QCkDSLDjXTx39naBBGIVIqBtKKuVTla9enngdq692xX/CgO6QJVrwpqdGjebj5P8\n" +
-            "5fNZPABzTezG3Uls5Vp+4iIWVAEDkK23cUj3c/HhE+Oo7kxfUeu5Y1ZV3qr61+6t\n" +
-            "ZARKjbu1TuYQHf0fs+GwID8zeLc2zJL7UzcHFwwQ6Nda9OJN4uPAuC/BKaIpxCLL\n" +
-            "26b24/tRam4SJjqpiq20lynhUrmTtt6hbG3E1Hpy3bmkt2DYnuMFwEx2gfXNcnbT\n" +
-            "wNuvFqc=\n" +
-            "-----END CERTIFICATE-----"
-        testSignature(metadataBody, certChainBody, false)
-    }
-
-    /*
-     * Temporarily disabled.
-     * Renable this per:
-    @Test
-    fun validSignatureCorrect() {
-        val url = server.url("/").url().toString()
-        val metadataBody = """
-            {
-              "data": {
-                "signature": {
-                  "x5u": "$url",
-                  "signature": "kRhyWZdLyjligYHSFhzhbyzUXBoUwoTPvyt9V0e-E7LKGgUYF2MVfqpA2zfIEDdqrImcMABVGHLUx9Nk614zciRBQ-gyaKA5SL2pPdZvoQXk_LLsPhEBgG4VDnxG4SBL"
-                }
-              }
-            }
-        """.trimIndent()
-        val certChainBody = "-----BEGIN CERTIFICATE-----\n" +
-            "MIIEpTCCBCygAwIBAgIEAQAAKTAKBggqhkjOPQQDAzCBpjELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMSUwIwYDVQQDExxDb250ZW50\n" +
-            "IFNpZ25pbmcgSW50ZXJtZWRpYXRlMSEwHwYJKoZIhvcNAQkBFhJmb3hzZWNAbW96\n" +
-            "aWxsYS5jb20wIhgPMjAxODAyMTgwMDAwMDBaGA8yMDE4MDYxODAwMDAwMFowgbEx\n" +
-            "CzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRwwGgYDVQQKExNNb3pp\n" +
-            "bGxhIENvcnBvcmF0aW9uMRcwFQYDVQQLEw5DbG91ZCBTZXJ2aWNlczExMC8GA1UE\n" +
-            "AxMoZmVubmVjLWRsYy5jb250ZW50LXNpZ25hdHVyZS5tb3ppbGxhLm9yZzEjMCEG\n" +
-            "CSqGSIb3DQEJARYUc2VjdXJpdHlAbW96aWxsYS5vcmcwdjAQBgcqhkjOPQIBBgUr\n" +
-            "gQQAIgNiAATpKfWqAyDsh2ISzBycb8Y7JqLygByKI9vI2WZ2VWaGTYfmB1tQ8PFj\n" +
-            "vZrtDqZeO8Dhs2KiMrvs/uoziM2zselYQhd0mz5z3dMui6BD6SPKB83K7xn2r2mW\n" +
-            "plAZxuwnPKujggIYMIICFDAdBgNVHQ4EFgQUTp9+0KSp+vkzbEcXAENBCIyI9eow\n" +
-            "gaoGA1UdIwSBojCBn4AUiHVymVvwUPJguD2xCZYej3l5nu6hgYGkfzB9MQswCQYD\n" +
-            "VQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMm\n" +
-            "TW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMT\n" +
-            "FnJvb3QtY2EtcHJvZHVjdGlvbi1hbW+CAxAABjAMBgNVHRMBAf8EAjAAMA4GA1Ud\n" +
-            "DwEB/wQEAwIHgDAWBgNVHSUBAf8EDDAKBggrBgEFBQcDAzBFBgNVHR8EPjA8MDqg\n" +
-            "OKA2hjRodHRwczovL2NvbnRlbnQtc2lnbmF0dXJlLmNkbi5tb3ppbGxhLm5ldC9j\n" +
-            "YS9jcmwucGVtMEMGCWCGSAGG+EIBBAQ2FjRodHRwczovL2NvbnRlbnQtc2lnbmF0\n" +
-            "dXJlLmNkbi5tb3ppbGxhLm5ldC9jYS9jcmwucGVtME8GCCsGAQUFBwEBBEMwQTA/\n" +
-            "BggrBgEFBQcwAoYzaHR0cHM6Ly9jb250ZW50LXNpZ25hdHVyZS5jZG4ubW96aWxs\n" +
-            "YS5uZXQvY2EvY2EucGVtMDMGA1UdEQQsMCqCKGZlbm5lYy1kbGMuY29udGVudC1z\n" +
-            "aWduYXR1cmUubW96aWxsYS5vcmcwCgYIKoZIzj0EAwMDZwAwZAIwXVe1A+r/yVwR\n" +
-            "DtecWq2DOOIIbq6jPzz/L6GpAw1KHnVMVBnOyrsFNmPyGQb1H60bAjB0dxyh14JB\n" +
-            "FCdPO01+y8I7nGRaWqjkmp/GLrdoginSppQYZInYTZagcfy/nIr5fKk=\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIFfjCCA2agAwIBAgIDEAAGMA0GCSqGSIb3DQEBDAUAMH0xCzAJBgNVBAYTAlVT\n" +
-            "MRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZNb3ppbGxh\n" +
-            "IEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMWcm9vdC1j\n" +
-            "YS1wcm9kdWN0aW9uLWFtbzAeFw0xNzA1MDQwMDEyMzlaFw0xOTA1MDQwMDEyMzla\n" +
-            "MIGmMQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEv\n" +
-            "MC0GA1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2Ux\n" +
-            "JTAjBgNVBAMTHENvbnRlbnQgU2lnbmluZyBJbnRlcm1lZGlhdGUxITAfBgkqhkiG\n" +
-            "9w0BCQEWEmZveHNlY0Btb3ppbGxhLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IA\n" +
-            "BMCmt4C33KfMzsyKokc9SXmMSxozksQglhoGAA1KjlgqEOzcmKEkxtvnGWOA9FLo\n" +
-            "A6U7Wmy+7sqmvmjLboAPQc4G0CEudn5Nfk36uEqeyiyKwKSAT+pZsqS4/maXIC7s\n" +
-            "DqOCAYkwggGFMAwGA1UdEwQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMBYGA1UdJQEB\n" +
-            "/wQMMAoGCCsGAQUFBwMDMB0GA1UdDgQWBBSIdXKZW/BQ8mC4PbEJlh6PeXme7jCB\n" +
-            "qAYDVR0jBIGgMIGdgBSzvOpYdKvhbngqsqucIx6oYyyXt6GBgaR/MH0xCzAJBgNV\n" +
-            "BAYTAlVTMRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZN\n" +
-            "b3ppbGxhIEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMW\n" +
-            "cm9vdC1jYS1wcm9kdWN0aW9uLWFtb4IBATAzBglghkgBhvhCAQQEJhYkaHR0cDov\n" +
-            "L2FkZG9ucy5hbGxpem9tLm9yZy9jYS9jcmwucGVtME4GA1UdHgRHMEWgQzAggh4u\n" +
-            "Y29udGVudC1zaWduYXR1cmUubW96aWxsYS5vcmcwH4IdY29udGVudC1zaWduYXR1\n" +
-            "cmUubW96aWxsYS5vcmcwDQYJKoZIhvcNAQEMBQADggIBAKWhLjJB8XmW3VfLvyLF\n" +
-            "OOUNeNs7Aju+EZl1PMVXf+917LB//FcJKUQLcEo86I6nC3umUNl+kaq4d3yPDpMV\n" +
-            "4DKLHgGmegRsvAyNFQfd64TTxzyfoyfNWH8uy5vvxPmLvWb+jXCoMNF5FgFWEVon\n" +
-            "5GDEK8hoHN/DMVe0jveeJhUSuiUpJhMzEf6Vbo0oNgfaRAZKO+VOY617nkTOPnVF\n" +
-            "LSEcUPIdE8pcd+QP1t/Ysx+mAfkxAbt+5K298s2bIRLTyNUj1eBtTcCbBbFyWsly\n" +
-            "rSMkJihFAWU2MVKqvJ74YI3uNhFzqJ/AAUAPoet14q+ViYU+8a1lqEWj7y8foF3r\n" +
-            "m0ZiQpuHULiYCO4y4NR7g5ijj6KsbruLv3e9NyUAIRBHOZEKOA7EiFmWJgqH1aZv\n" +
-            "/eS7aQ9HMtPKrlbEwUjV0P3K2U2ljs0rNvO8KO9NKQmocXaRpLm+s8PYBGxby92j\n" +
-            "5eelLq55028BSzhJJc6G+cRT9Hlxf1cg2qtqcVJa8i8wc2upCaGycZIlBSX4gj/4\n" +
-            "k9faY4qGuGnuEdzAyvIXWMSkb8jiNHQfZrebSr00vShkUEKOLmfFHbkwIaWNK0+2\n" +
-            "2c3RL4tDnM5u0kvdgWf0B742JskkxqqmEeZVofsOZJLOhXxO9NO/S0hM16/vf/tl\n" +
-            "Tnsnhv0nxUR0B9wxN7XmWmq4\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIGYTCCBEmgAwIBAgIBATANBgkqhkiG9w0BAQwFADB9MQswCQYDVQQGEwJVUzEc\n" +
-            "MBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMmTW96aWxsYSBB\n" +
-            "TU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMTFnJvb3QtY2Et\n" +
-            "cHJvZHVjdGlvbi1hbW8wHhcNMTUwMzE3MjI1MzU3WhcNMjUwMzE0MjI1MzU3WjB9\n" +
-            "MQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0G\n" +
-            "A1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAd\n" +
-            "BgNVBAMTFnJvb3QtY2EtcHJvZHVjdGlvbi1hbW8wggIgMA0GCSqGSIb3DQEBAQUA\n" +
-            "A4ICDQAwggIIAoICAQC0u2HXXbrwy36+MPeKf5jgoASMfMNz7mJWBecJgvlTf4hH\n" +
-            "JbLzMPsIUauzI9GEpLfHdZ6wzSyFOb4AM+D1mxAWhuZJ3MDAJOf3B1Rs6QorHrl8\n" +
-            "qqlNtPGqepnpNJcLo7JsSqqE3NUm72MgqIHRgTRsqUs+7LIPGe7262U+N/T0LPYV\n" +
-            "Le4rZ2RDHoaZhYY7a9+49mHOI/g2YFB+9yZjE+XdplT2kBgA4P8db7i7I0tIi4b0\n" +
-            "B0N6y9MhL+CRZJyxdFe2wBykJX14LsheKsM1azHjZO56SKNrW8VAJTLkpRxCmsiT\n" +
-            "r08fnPyDKmaeZ0BtsugicdipcZpXriIGmsZbI12q5yuwjSELdkDV6Uajo2n+2ws5\n" +
-            "uXrP342X71WiWhC/dF5dz1LKtjBdmUkxaQMOP/uhtXEKBrZo1ounDRQx1j7+SkQ4\n" +
-            "BEwjB3SEtr7XDWGOcOIkoJZWPACfBLC3PJCBWjTAyBlud0C5n3Cy9regAAnOIqI1\n" +
-            "t16GU2laRh7elJ7gPRNgQgwLXeZcFxw6wvyiEcmCjOEQ6PM8UQjthOsKlszMhlKw\n" +
-            "vjyOGDoztkqSBy/v+Asx7OW2Q7rlVfKarL0mREZdSMfoy3zTgtMVCM0vhNl6zcvf\n" +
-            "5HNNopoEdg5yuXo2chZ1p1J+q86b0G5yJRMeT2+iOVY2EQ37tHrqUURncCy4uwIB\n" +
-            "A6OB7TCB6jAMBgNVHRMEBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAWBgNVHSUBAf8E\n" +
-            "DDAKBggrBgEFBQcDAzCBkgYDVR0jBIGKMIGHoYGBpH8wfTELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMR8wHQYDVQQDExZyb290LWNh\n" +
-            "LXByb2R1Y3Rpb24tYW1vggEBMB0GA1UdDgQWBBSzvOpYdKvhbngqsqucIx6oYyyX\n" +
-            "tzANBgkqhkiG9w0BAQwFAAOCAgEAaNSRYAaECAePQFyfk12kl8UPLh8hBNidP2H6\n" +
-            "KT6O0vCVBjxmMrwr8Aqz6NL+TgdPmGRPDDLPDpDJTdWzdj7khAjxqWYhutACTew5\n" +
-            "eWEaAzyErbKQl+duKvtThhV2p6F6YHJ2vutu4KIciOMKB8dslIqIQr90IX2Usljq\n" +
-            "8Ttdyf+GhUmazqLtoB0GOuESEqT4unX6X7vSGu1oLV20t7t5eCnMMYD67ZBn0YIU\n" +
-            "/cm/+pan66hHrja+NeDGF8wabJxdqKItCS3p3GN1zUGuJKrLykxqbOp/21byAGog\n" +
-            "Z1amhz6NHUcfE6jki7sM7LHjPostU5ZWs3PEfVVgha9fZUhOrIDsyXEpCWVa3481\n" +
-            "LlAq3GiUMKZ5DVRh9/Nvm4NwrTfB3QkQQJCwfXvO9pwnPKtISYkZUqhEqvXk5nBg\n" +
-            "QCkDSLDjXTx39naBBGIVIqBtKKuVTla9enngdq692xX/CgO6QJVrwpqdGjebj5P8\n" +
-            "5fNZPABzTezG3Uls5Vp+4iIWVAEDkK23cUj3c/HhE+Oo7kxfUeu5Y1ZV3qr61+6t\n" +
-            "ZARKjbu1TuYQHf0fs+GwID8zeLc2zJL7UzcHFwwQ6Nda9OJN4uPAuC/BKaIpxCLL\n" +
-            "26b24/tRam4SJjqpiq20lynhUrmTtt6hbG3E1Hpy3bmkt2DYnuMFwEx2gfXNcnbT\n" +
-            "wNuvFqc=\n" +
-            "-----END CERTIFICATE-----"
-        testSignature(metadataBody, certChainBody, true)
-    }
-    */
-
-    @Test
-    fun validSignatureIncorrect() {
-        val url = server.url("/").url().toString()
-        val metadataBody = """
-            {
-              "data": {
-                "signature": {
-                  "x5u": "$url",
-                  "signature": "kRyhWZdLyjligYHSFhzhbyzUXBoUwoTPvyt9V0e-E7LKGgUYF2MVfqpA2zfIEDdqrImcMABVGHLUx9Nk614zciRBQ-gyaKA5SL2pPdZvoQXk_LLsPhEBgG4VDnxG4SBL"
-                }
-              }
-            }
-        """.trimIndent()
-        val certChainBody = "-----BEGIN CERTIFICATE-----\n" +
-            "MIIEpTCCBCygAwIBAgIEAQAAKTAKBggqhkjOPQQDAzCBpjELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMSUwIwYDVQQDExxDb250ZW50\n" +
-            "IFNpZ25pbmcgSW50ZXJtZWRpYXRlMSEwHwYJKoZIhvcNAQkBFhJmb3hzZWNAbW96\n" +
-            "aWxsYS5jb20wIhgPMjAxODAyMTgwMDAwMDBaGA8yMDE4MDYxODAwMDAwMFowgbEx\n" +
-            "CzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRwwGgYDVQQKExNNb3pp\n" +
-            "bGxhIENvcnBvcmF0aW9uMRcwFQYDVQQLEw5DbG91ZCBTZXJ2aWNlczExMC8GA1UE\n" +
-            "AxMoZmVubmVjLWRsYy5jb250ZW50LXNpZ25hdHVyZS5tb3ppbGxhLm9yZzEjMCEG\n" +
-            "CSqGSIb3DQEJARYUc2VjdXJpdHlAbW96aWxsYS5vcmcwdjAQBgcqhkjOPQIBBgUr\n" +
-            "gQQAIgNiAATpKfWqAyDsh2ISzBycb8Y7JqLygByKI9vI2WZ2VWaGTYfmB1tQ8PFj\n" +
-            "vZrtDqZeO8Dhs2KiMrvs/uoziM2zselYQhd0mz5z3dMui6BD6SPKB83K7xn2r2mW\n" +
-            "plAZxuwnPKujggIYMIICFDAdBgNVHQ4EFgQUTp9+0KSp+vkzbEcXAENBCIyI9eow\n" +
-            "gaoGA1UdIwSBojCBn4AUiHVymVvwUPJguD2xCZYej3l5nu6hgYGkfzB9MQswCQYD\n" +
-            "VQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMm\n" +
-            "TW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMT\n" +
-            "FnJvb3QtY2EtcHJvZHVjdGlvbi1hbW+CAxAABjAMBgNVHRMBAf8EAjAAMA4GA1Ud\n" +
-            "DwEB/wQEAwIHgDAWBgNVHSUBAf8EDDAKBggrBgEFBQcDAzBFBgNVHR8EPjA8MDqg\n" +
-            "OKA2hjRodHRwczovL2NvbnRlbnQtc2lnbmF0dXJlLmNkbi5tb3ppbGxhLm5ldC9j\n" +
-            "YS9jcmwucGVtMEMGCWCGSAGG+EIBBAQ2FjRodHRwczovL2NvbnRlbnQtc2lnbmF0\n" +
-            "dXJlLmNkbi5tb3ppbGxhLm5ldC9jYS9jcmwucGVtME8GCCsGAQUFBwEBBEMwQTA/\n" +
-            "BggrBgEFBQcwAoYzaHR0cHM6Ly9jb250ZW50LXNpZ25hdHVyZS5jZG4ubW96aWxs\n" +
-            "YS5uZXQvY2EvY2EucGVtMDMGA1UdEQQsMCqCKGZlbm5lYy1kbGMuY29udGVudC1z\n" +
-            "aWduYXR1cmUubW96aWxsYS5vcmcwCgYIKoZIzj0EAwMDZwAwZAIwXVe1A+r/yVwR\n" +
-            "DtecWq2DOOIIbq6jPzz/L6GpAw1KHnVMVBnOyrsFNmPyGQb1H60bAjB0dxyh14JB\n" +
-            "FCdPO01+y8I7nGRaWqjkmp/GLrdoginSppQYZInYTZagcfy/nIr5fKk=\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIFfjCCA2agAwIBAgIDEAAGMA0GCSqGSIb3DQEBDAUAMH0xCzAJBgNVBAYTAlVT\n" +
-            "MRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZNb3ppbGxh\n" +
-            "IEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMWcm9vdC1j\n" +
-            "YS1wcm9kdWN0aW9uLWFtbzAeFw0xNzA1MDQwMDEyMzlaFw0xOTA1MDQwMDEyMzla\n" +
-            "MIGmMQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEv\n" +
-            "MC0GA1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2Ux\n" +
-            "JTAjBgNVBAMTHENvbnRlbnQgU2lnbmluZyBJbnRlcm1lZGlhdGUxITAfBgkqhkiG\n" +
-            "9w0BCQEWEmZveHNlY0Btb3ppbGxhLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IA\n" +
-            "BMCmt4C33KfMzsyKokc9SXmMSxozksQglhoGAA1KjlgqEOzcmKEkxtvnGWOA9FLo\n" +
-            "A6U7Wmy+7sqmvmjLboAPQc4G0CEudn5Nfk36uEqeyiyKwKSAT+pZsqS4/maXIC7s\n" +
-            "DqOCAYkwggGFMAwGA1UdEwQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMBYGA1UdJQEB\n" +
-            "/wQMMAoGCCsGAQUFBwMDMB0GA1UdDgQWBBSIdXKZW/BQ8mC4PbEJlh6PeXme7jCB\n" +
-            "qAYDVR0jBIGgMIGdgBSzvOpYdKvhbngqsqucIx6oYyyXt6GBgaR/MH0xCzAJBgNV\n" +
-            "BAYTAlVTMRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZN\n" +
-            "b3ppbGxhIEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMW\n" +
-            "cm9vdC1jYS1wcm9kdWN0aW9uLWFtb4IBATAzBglghkgBhvhCAQQEJhYkaHR0cDov\n" +
-            "L2FkZG9ucy5hbGxpem9tLm9yZy9jYS9jcmwucGVtME4GA1UdHgRHMEWgQzAggh4u\n" +
-            "Y29udGVudC1zaWduYXR1cmUubW96aWxsYS5vcmcwH4IdY29udGVudC1zaWduYXR1\n" +
-            "cmUubW96aWxsYS5vcmcwDQYJKoZIhvcNAQEMBQADggIBAKWhLjJB8XmW3VfLvyLF\n" +
-            "OOUNeNs7Aju+EZl1PMVXf+917LB//FcJKUQLcEo86I6nC3umUNl+kaq4d3yPDpMV\n" +
-            "4DKLHgGmegRsvAyNFQfd64TTxzyfoyfNWH8uy5vvxPmLvWb+jXCoMNF5FgFWEVon\n" +
-            "5GDEK8hoHN/DMVe0jveeJhUSuiUpJhMzEf6Vbo0oNgfaRAZKO+VOY617nkTOPnVF\n" +
-            "LSEcUPIdE8pcd+QP1t/Ysx+mAfkxAbt+5K298s2bIRLTyNUj1eBtTcCbBbFyWsly\n" +
-            "rSMkJihFAWU2MVKqvJ74YI3uNhFzqJ/AAUAPoet14q+ViYU+8a1lqEWj7y8foF3r\n" +
-            "m0ZiQpuHULiYCO4y4NR7g5ijj6KsbruLv3e9NyUAIRBHOZEKOA7EiFmWJgqH1aZv\n" +
-            "/eS7aQ9HMtPKrlbEwUjV0P3K2U2ljs0rNvO8KO9NKQmocXaRpLm+s8PYBGxby92j\n" +
-            "5eelLq55028BSzhJJc6G+cRT9Hlxf1cg2qtqcVJa8i8wc2upCaGycZIlBSX4gj/4\n" +
-            "k9faY4qGuGnuEdzAyvIXWMSkb8jiNHQfZrebSr00vShkUEKOLmfFHbkwIaWNK0+2\n" +
-            "2c3RL4tDnM5u0kvdgWf0B742JskkxqqmEeZVofsOZJLOhXxO9NO/S0hM16/vf/tl\n" +
-            "Tnsnhv0nxUR0B9wxN7XmWmq4\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIGYTCCBEmgAwIBAgIBATANBgkqhkiG9w0BAQwFADB9MQswCQYDVQQGEwJVUzEc\n" +
-            "MBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMmTW96aWxsYSBB\n" +
-            "TU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMTFnJvb3QtY2Et\n" +
-            "cHJvZHVjdGlvbi1hbW8wHhcNMTUwMzE3MjI1MzU3WhcNMjUwMzE0MjI1MzU3WjB9\n" +
-            "MQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0G\n" +
-            "A1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAd\n" +
-            "BgNVBAMTFnJvb3QtY2EtcHJvZHVjdGlvbi1hbW8wggIgMA0GCSqGSIb3DQEBAQUA\n" +
-            "A4ICDQAwggIIAoICAQC0u2HXXbrwy36+MPeKf5jgoASMfMNz7mJWBecJgvlTf4hH\n" +
-            "JbLzMPsIUauzI9GEpLfHdZ6wzSyFOb4AM+D1mxAWhuZJ3MDAJOf3B1Rs6QorHrl8\n" +
-            "qqlNtPGqepnpNJcLo7JsSqqE3NUm72MgqIHRgTRsqUs+7LIPGe7262U+N/T0LPYV\n" +
-            "Le4rZ2RDHoaZhYY7a9+49mHOI/g2YFB+9yZjE+XdplT2kBgA4P8db7i7I0tIi4b0\n" +
-            "B0N6y9MhL+CRZJyxdFe2wBykJX14LsheKsM1azHjZO56SKNrW8VAJTLkpRxCmsiT\n" +
-            "r08fnPyDKmaeZ0BtsugicdipcZpXriIGmsZbI12q5yuwjSELdkDV6Uajo2n+2ws5\n" +
-            "uXrP342X71WiWhC/dF5dz1LKtjBdmUkxaQMOP/uhtXEKBrZo1ounDRQx1j7+SkQ4\n" +
-            "BEwjB3SEtr7XDWGOcOIkoJZWPACfBLC3PJCBWjTAyBlud0C5n3Cy9regAAnOIqI1\n" +
-            "t16GU2laRh7elJ7gPRNgQgwLXeZcFxw6wvyiEcmCjOEQ6PM8UQjthOsKlszMhlKw\n" +
-            "vjyOGDoztkqSBy/v+Asx7OW2Q7rlVfKarL0mREZdSMfoy3zTgtMVCM0vhNl6zcvf\n" +
-            "5HNNopoEdg5yuXo2chZ1p1J+q86b0G5yJRMeT2+iOVY2EQ37tHrqUURncCy4uwIB\n" +
-            "A6OB7TCB6jAMBgNVHRMEBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAWBgNVHSUBAf8E\n" +
-            "DDAKBggrBgEFBQcDAzCBkgYDVR0jBIGKMIGHoYGBpH8wfTELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMR8wHQYDVQQDExZyb290LWNh\n" +
-            "LXByb2R1Y3Rpb24tYW1vggEBMB0GA1UdDgQWBBSzvOpYdKvhbngqsqucIx6oYyyX\n" +
-            "tzANBgkqhkiG9w0BAQwFAAOCAgEAaNSRYAaECAePQFyfk12kl8UPLh8hBNidP2H6\n" +
-            "KT6O0vCVBjxmMrwr8Aqz6NL+TgdPmGRPDDLPDpDJTdWzdj7khAjxqWYhutACTew5\n" +
-            "eWEaAzyErbKQl+duKvtThhV2p6F6YHJ2vutu4KIciOMKB8dslIqIQr90IX2Usljq\n" +
-            "8Ttdyf+GhUmazqLtoB0GOuESEqT4unX6X7vSGu1oLV20t7t5eCnMMYD67ZBn0YIU\n" +
-            "/cm/+pan66hHrja+NeDGF8wabJxdqKItCS3p3GN1zUGuJKrLykxqbOp/21byAGog\n" +
-            "Z1amhz6NHUcfE6jki7sM7LHjPostU5ZWs3PEfVVgha9fZUhOrIDsyXEpCWVa3481\n" +
-            "LlAq3GiUMKZ5DVRh9/Nvm4NwrTfB3QkQQJCwfXvO9pwnPKtISYkZUqhEqvXk5nBg\n" +
-            "QCkDSLDjXTx39naBBGIVIqBtKKuVTla9enngdq692xX/CgO6QJVrwpqdGjebj5P8\n" +
-            "5fNZPABzTezG3Uls5Vp+4iIWVAEDkK23cUj3c/HhE+Oo7kxfUeu5Y1ZV3qr61+6t\n" +
-            "ZARKjbu1TuYQHf0fs+GwID8zeLc2zJL7UzcHFwwQ6Nda9OJN4uPAuC/BKaIpxCLL\n" +
-            "26b24/tRam4SJjqpiq20lynhUrmTtt6hbG3E1Hpy3bmkt2DYnuMFwEx2gfXNcnbT\n" +
-            "wNuvFqc=\n" +
-            "-----END CERTIFICATE-----"
-        testSignature(metadataBody, certChainBody, false)
-    }
-
-    @Test(expected = ExperimentDownloadException::class)
-    fun validSignatureInvalidChainOrder() {
-        val url = server.url("/").url().toString()
-        val metadataBody = """
-            {
-              "data": {
-                "signature": {
-                  "x5u": "$url",
-                  "signature": "kRhyWZdLyjligYHSFhzhbyzUXBoUwoTPvyt9V0e-E7LKGgUYF2MVfqpA2zfIEDdqrImcMABVGHLUx9Nk614zciRBQ-gyaKA5SL2pPdZvoQXk_LLsPhEBgG4VDnxG4SBL"
-                }
-              }
-            }
-        """.trimIndent()
-        val certChainBody = "-----BEGIN CERTIFICATE-----\n" +
-            "MIIEpTCCBCygAwIBAgIEAQAAKTAKBggqhkjOPQQDAzCBpjELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMSUwIwYDVQQDExxDb250ZW50\n" +
-            "IFNpZ25pbmcgSW50ZXJtZWRpYXRlMSEwHwYJKoZIhvcNAQkBFhJmb3hzZWNAbW96\n" +
-            "aWxsYS5jb20wIhgPMjAxODAyMTgwMDAwMDBaGA8yMDE4MDYxODAwMDAwMFowgbEx\n" +
-            "CzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRwwGgYDVQQKExNNb3pp\n" +
-            "bGxhIENvcnBvcmF0aW9uMRcwFQYDVQQLEw5DbG91ZCBTZXJ2aWNlczExMC8GA1UE\n" +
-            "AxMoZmVubmVjLWRsYy5jb250ZW50LXNpZ25hdHVyZS5tb3ppbGxhLm9yZzEjMCEG\n" +
-            "CSqGSIb3DQEJARYUc2VjdXJpdHlAbW96aWxsYS5vcmcwdjAQBgcqhkjOPQIBBgUr\n" +
-            "gQQAIgNiAATpKfWqAyDsh2ISzBycb8Y7JqLygByKI9vI2WZ2VWaGTYfmB1tQ8PFj\n" +
-            "vZrtDqZeO8Dhs2KiMrvs/uoziM2zselYQhd0mz5z3dMui6BD6SPKB83K7xn2r2mW\n" +
-            "plAZxuwnPKujggIYMIICFDAdBgNVHQ4EFgQUTp9+0KSp+vkzbEcXAENBCIyI9eow\n" +
-            "gaoGA1UdIwSBojCBn4AUiHVymVvwUPJguD2xCZYej3l5nu6hgYGkfzB9MQswCQYD\n" +
-            "VQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMm\n" +
-            "TW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMT\n" +
-            "FnJvb3QtY2EtcHJvZHVjdGlvbi1hbW+CAxAABjAMBgNVHRMBAf8EAjAAMA4GA1Ud\n" +
-            "DwEB/wQEAwIHgDAWBgNVHSUBAf8EDDAKBggrBgEFBQcDAzBFBgNVHR8EPjA8MDqg\n" +
-            "OKA2hjRodHRwczovL2NvbnRlbnQtc2lnbmF0dXJlLmNkbi5tb3ppbGxhLm5ldC9j\n" +
-            "YS9jcmwucGVtMEMGCWCGSAGG+EIBBAQ2FjRodHRwczovL2NvbnRlbnQtc2lnbmF0\n" +
-            "dXJlLmNkbi5tb3ppbGxhLm5ldC9jYS9jcmwucGVtME8GCCsGAQUFBwEBBEMwQTA/\n" +
-            "BggrBgEFBQcwAoYzaHR0cHM6Ly9jb250ZW50LXNpZ25hdHVyZS5jZG4ubW96aWxs\n" +
-            "YS5uZXQvY2EvY2EucGVtMDMGA1UdEQQsMCqCKGZlbm5lYy1kbGMuY29udGVudC1z\n" +
-            "aWduYXR1cmUubW96aWxsYS5vcmcwCgYIKoZIzj0EAwMDZwAwZAIwXVe1A+r/yVwR\n" +
-            "DtecWq2DOOIIbq6jPzz/L6GpAw1KHnVMVBnOyrsFNmPyGQb1H60bAjB0dxyh14JB\n" +
-            "FCdPO01+y8I7nGRaWqjkmp/GLrdoginSppQYZInYTZagcfy/nIr5fKk=\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIGYTCCBEmgAwIBAgIBATANBgkqhkiG9w0BAQwFADB9MQswCQYDVQQGEwJVUzEc\n" +
-            "MBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMmTW96aWxsYSBB\n" +
-            "TU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMTFnJvb3QtY2Et\n" +
-            "cHJvZHVjdGlvbi1hbW8wHhcNMTUwMzE3MjI1MzU3WhcNMjUwMzE0MjI1MzU3WjB9\n" +
-            "MQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0G\n" +
-            "A1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAd\n" +
-            "BgNVBAMTFnJvb3QtY2EtcHJvZHVjdGlvbi1hbW8wggIgMA0GCSqGSIb3DQEBAQUA\n" +
-            "A4ICDQAwggIIAoICAQC0u2HXXbrwy36+MPeKf5jgoASMfMNz7mJWBecJgvlTf4hH\n" +
-            "JbLzMPsIUauzI9GEpLfHdZ6wzSyFOb4AM+D1mxAWhuZJ3MDAJOf3B1Rs6QorHrl8\n" +
-            "qqlNtPGqepnpNJcLo7JsSqqE3NUm72MgqIHRgTRsqUs+7LIPGe7262U+N/T0LPYV\n" +
-            "Le4rZ2RDHoaZhYY7a9+49mHOI/g2YFB+9yZjE+XdplT2kBgA4P8db7i7I0tIi4b0\n" +
-            "B0N6y9MhL+CRZJyxdFe2wBykJX14LsheKsM1azHjZO56SKNrW8VAJTLkpRxCmsiT\n" +
-            "r08fnPyDKmaeZ0BtsugicdipcZpXriIGmsZbI12q5yuwjSELdkDV6Uajo2n+2ws5\n" +
-            "uXrP342X71WiWhC/dF5dz1LKtjBdmUkxaQMOP/uhtXEKBrZo1ounDRQx1j7+SkQ4\n" +
-            "BEwjB3SEtr7XDWGOcOIkoJZWPACfBLC3PJCBWjTAyBlud0C5n3Cy9regAAnOIqI1\n" +
-            "t16GU2laRh7elJ7gPRNgQgwLXeZcFxw6wvyiEcmCjOEQ6PM8UQjthOsKlszMhlKw\n" +
-            "vjyOGDoztkqSBy/v+Asx7OW2Q7rlVfKarL0mREZdSMfoy3zTgtMVCM0vhNl6zcvf\n" +
-            "5HNNopoEdg5yuXo2chZ1p1J+q86b0G5yJRMeT2+iOVY2EQ37tHrqUURncCy4uwIB\n" +
-            "A6OB7TCB6jAMBgNVHRMEBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAWBgNVHSUBAf8E\n" +
-            "DDAKBggrBgEFBQcDAzCBkgYDVR0jBIGKMIGHoYGBpH8wfTELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMR8wHQYDVQQDExZyb290LWNh\n" +
-            "LXByb2R1Y3Rpb24tYW1vggEBMB0GA1UdDgQWBBSzvOpYdKvhbngqsqucIx6oYyyX\n" +
-            "tzANBgkqhkiG9w0BAQwFAAOCAgEAaNSRYAaECAePQFyfk12kl8UPLh8hBNidP2H6\n" +
-            "KT6O0vCVBjxmMrwr8Aqz6NL+TgdPmGRPDDLPDpDJTdWzdj7khAjxqWYhutACTew5\n" +
-            "eWEaAzyErbKQl+duKvtThhV2p6F6YHJ2vutu4KIciOMKB8dslIqIQr90IX2Usljq\n" +
-            "8Ttdyf+GhUmazqLtoB0GOuESEqT4unX6X7vSGu1oLV20t7t5eCnMMYD67ZBn0YIU\n" +
-            "/cm/+pan66hHrja+NeDGF8wabJxdqKItCS3p3GN1zUGuJKrLykxqbOp/21byAGog\n" +
-            "Z1amhz6NHUcfE6jki7sM7LHjPostU5ZWs3PEfVVgha9fZUhOrIDsyXEpCWVa3481\n" +
-            "LlAq3GiUMKZ5DVRh9/Nvm4NwrTfB3QkQQJCwfXvO9pwnPKtISYkZUqhEqvXk5nBg\n" +
-            "QCkDSLDjXTx39naBBGIVIqBtKKuVTla9enngdq692xX/CgO6QJVrwpqdGjebj5P8\n" +
-            "5fNZPABzTezG3Uls5Vp+4iIWVAEDkK23cUj3c/HhE+Oo7kxfUeu5Y1ZV3qr61+6t\n" +
-            "ZARKjbu1TuYQHf0fs+GwID8zeLc2zJL7UzcHFwwQ6Nda9OJN4uPAuC/BKaIpxCLL\n" +
-            "26b24/tRam4SJjqpiq20lynhUrmTtt6hbG3E1Hpy3bmkt2DYnuMFwEx2gfXNcnbT\n" +
-            "wNuvFqc=\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIFfjCCA2agAwIBAgIDEAAGMA0GCSqGSIb3DQEBDAUAMH0xCzAJBgNVBAYTAlVT\n" +
-            "MRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZNb3ppbGxh\n" +
-            "IEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMWcm9vdC1j\n" +
-            "YS1wcm9kdWN0aW9uLWFtbzAeFw0xNzA1MDQwMDEyMzlaFw0xOTA1MDQwMDEyMzla\n" +
-            "MIGmMQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEv\n" +
-            "MC0GA1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2Ux\n" +
-            "JTAjBgNVBAMTHENvbnRlbnQgU2lnbmluZyBJbnRlcm1lZGlhdGUxITAfBgkqhkiG\n" +
-            "9w0BCQEWEmZveHNlY0Btb3ppbGxhLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IA\n" +
-            "BMCmt4C33KfMzsyKokc9SXmMSxozksQglhoGAA1KjlgqEOzcmKEkxtvnGWOA9FLo\n" +
-            "A6U7Wmy+7sqmvmjLboAPQc4G0CEudn5Nfk36uEqeyiyKwKSAT+pZsqS4/maXIC7s\n" +
-            "DqOCAYkwggGFMAwGA1UdEwQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMBYGA1UdJQEB\n" +
-            "/wQMMAoGCCsGAQUFBwMDMB0GA1UdDgQWBBSIdXKZW/BQ8mC4PbEJlh6PeXme7jCB\n" +
-            "qAYDVR0jBIGgMIGdgBSzvOpYdKvhbngqsqucIx6oYyyXt6GBgaR/MH0xCzAJBgNV\n" +
-            "BAYTAlVTMRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZN\n" +
-            "b3ppbGxhIEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMW\n" +
-            "cm9vdC1jYS1wcm9kdWN0aW9uLWFtb4IBATAzBglghkgBhvhCAQQEJhYkaHR0cDov\n" +
-            "L2FkZG9ucy5hbGxpem9tLm9yZy9jYS9jcmwucGVtME4GA1UdHgRHMEWgQzAggh4u\n" +
-            "Y29udGVudC1zaWduYXR1cmUubW96aWxsYS5vcmcwH4IdY29udGVudC1zaWduYXR1\n" +
-            "cmUubW96aWxsYS5vcmcwDQYJKoZIhvcNAQEMBQADggIBAKWhLjJB8XmW3VfLvyLF\n" +
-            "OOUNeNs7Aju+EZl1PMVXf+917LB//FcJKUQLcEo86I6nC3umUNl+kaq4d3yPDpMV\n" +
-            "4DKLHgGmegRsvAyNFQfd64TTxzyfoyfNWH8uy5vvxPmLvWb+jXCoMNF5FgFWEVon\n" +
-            "5GDEK8hoHN/DMVe0jveeJhUSuiUpJhMzEf6Vbo0oNgfaRAZKO+VOY617nkTOPnVF\n" +
-            "LSEcUPIdE8pcd+QP1t/Ysx+mAfkxAbt+5K298s2bIRLTyNUj1eBtTcCbBbFyWsly\n" +
-            "rSMkJihFAWU2MVKqvJ74YI3uNhFzqJ/AAUAPoet14q+ViYU+8a1lqEWj7y8foF3r\n" +
-            "m0ZiQpuHULiYCO4y4NR7g5ijj6KsbruLv3e9NyUAIRBHOZEKOA7EiFmWJgqH1aZv\n" +
-            "/eS7aQ9HMtPKrlbEwUjV0P3K2U2ljs0rNvO8KO9NKQmocXaRpLm+s8PYBGxby92j\n" +
-            "5eelLq55028BSzhJJc6G+cRT9Hlxf1cg2qtqcVJa8i8wc2upCaGycZIlBSX4gj/4\n" +
-            "k9faY4qGuGnuEdzAyvIXWMSkb8jiNHQfZrebSr00vShkUEKOLmfFHbkwIaWNK0+2\n" +
-            "2c3RL4tDnM5u0kvdgWf0B742JskkxqqmEeZVofsOZJLOhXxO9NO/S0hM16/vf/tl\n" +
-            "Tnsnhv0nxUR0B9wxN7XmWmq4\n" +
-            "-----END CERTIFICATE-----\n"
-        testSignature(metadataBody, certChainBody, true)
-    }
-
-    @Test(expected = ExperimentDownloadException::class)
-    fun validSignatureExpiredCertificate() {
-        val url = server.url("/").url().toString()
-        val metadataBody = """
-            {
-              "data": {
-                "signature": {
-                  "x5u": "$url",
-                  "signature": "kRhyWZdLyjligYHSFhzhbyzUXBoUwoTPvyt9V0e-E7LKGgUYF2MVfqpA2zfIEDdqrImcMABVGHLUx9Nk614zciRBQ-gyaKA5SL2pPdZvoQXk_LLsPhEBgG4VDnxG4SBL"
-                }
-              }
-            }
-        """.trimIndent()
-        val certChainBody = "-----BEGIN CERTIFICATE-----\n" +
-            "MIIEpTCCBCygAwIBAgIEAQAAKTAKBggqhkjOPQQDAzCBpjELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMSUwIwYDVQQDExxDb250ZW50\n" +
-            "IFNpZ25pbmcgSW50ZXJtZWRpYXRlMSEwHwYJKoZIhvcNAQkBFhJmb3hzZWNAbW96\n" +
-            "aWxsYS5jb20wIhgPMjAxODAyMTgwMDAwMDBaGA8yMDE4MDYxODAwMDAwMFowgbEx\n" +
-            "CzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRwwGgYDVQQKExNNb3pp\n" +
-            "bGxhIENvcnBvcmF0aW9uMRcwFQYDVQQLEw5DbG91ZCBTZXJ2aWNlczExMC8GA1UE\n" +
-            "AxMoZmVubmVjLWRsYy5jb250ZW50LXNpZ25hdHVyZS5tb3ppbGxhLm9yZzEjMCEG\n" +
-            "CSqGSIb3DQEJARYUc2VjdXJpdHlAbW96aWxsYS5vcmcwdjAQBgcqhkjOPQIBBgUr\n" +
-            "gQQAIgNiAATpKfWqAyDsh2ISzBycb8Y7JqLygByKI9vI2WZ2VWaGTYfmB1tQ8PFj\n" +
-            "vZrtDqZeO8Dhs2KiMrvs/uoziM2zselYQhd0mz5z3dMui6BD6SPKB83K7xn2r2mW\n" +
-            "plAZxuwnPKujggIYMIICFDAdBgNVHQ4EFgQUTp9+0KSp+vkzbEcXAENBCIyI9eow\n" +
-            "gaoGA1UdIwSBojCBn4AUiHVymVvwUPJguD2xCZYej3l5nu6hgYGkfzB9MQswCQYD\n" +
-            "VQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMm\n" +
-            "TW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMT\n" +
-            "FnJvb3QtY2EtcHJvZHVjdGlvbi1hbW+CAxAABjAMBgNVHRMBAf8EAjAAMA4GA1Ud\n" +
-            "DwEB/wQEAwIHgDAWBgNVHSUBAf8EDDAKBggrBgEFBQcDAzBFBgNVHR8EPjA8MDqg\n" +
-            "OKA2hjRodHRwczovL2NvbnRlbnQtc2lnbmF0dXJlLmNkbi5tb3ppbGxhLm5ldC9j\n" +
-            "YS9jcmwucGVtMEMGCWCGSAGG+EIBBAQ2FjRodHRwczovL2NvbnRlbnQtc2lnbmF0\n" +
-            "dXJlLmNkbi5tb3ppbGxhLm5ldC9jYS9jcmwucGVtME8GCCsGAQUFBwEBBEMwQTA/\n" +
-            "BggrBgEFBQcwAoYzaHR0cHM6Ly9jb250ZW50LXNpZ25hdHVyZS5jZG4ubW96aWxs\n" +
-            "YS5uZXQvY2EvY2EucGVtMDMGA1UdEQQsMCqCKGZlbm5lYy1kbGMuY29udGVudC1z\n" +
-            "aWduYXR1cmUubW96aWxsYS5vcmcwCgYIKoZIzj0EAwMDZwAwZAIwXVe1A+r/yVwR\n" +
-            "DtecWq2DOOIIbq6jPzz/L6GpAw1KHnVMVBnOyrsFNmPyGQb1H60bAjB0dxyh14JB\n" +
-            "FCdPO01+y8I7nGRaWqjkmp/GLrdoginSppQYZInYTZagcfy/nIr5fKk=\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIFfjCCA2agAwIBAgIDEAAGMA0GCSqGSIb3DQEBDAUAMH0xCzAJBgNVBAYTAlVT\n" +
-            "MRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZNb3ppbGxh\n" +
-            "IEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMWcm9vdC1j\n" +
-            "YS1wcm9kdWN0aW9uLWFtbzAeFw0xNzA1MDQwMDEyMzlaFw0xOTA1MDQwMDEyMzla\n" +
-            "MIGmMQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEv\n" +
-            "MC0GA1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2Ux\n" +
-            "JTAjBgNVBAMTHENvbnRlbnQgU2lnbmluZyBJbnRlcm1lZGlhdGUxITAfBgkqhkiG\n" +
-            "9w0BCQEWEmZveHNlY0Btb3ppbGxhLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IA\n" +
-            "BMCmt4C33KfMzsyKokc9SXmMSxozksQglhoGAA1KjlgqEOzcmKEkxtvnGWOA9FLo\n" +
-            "A6U7Wmy+7sqmvmjLboAPQc4G0CEudn5Nfk36uEqeyiyKwKSAT+pZsqS4/maXIC7s\n" +
-            "DqOCAYkwggGFMAwGA1UdEwQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMBYGA1UdJQEB\n" +
-            "/wQMMAoGCCsGAQUFBwMDMB0GA1UdDgQWBBSIdXKZW/BQ8mC4PbEJlh6PeXme7jCB\n" +
-            "qAYDVR0jBIGgMIGdgBSzvOpYdKvhbngqsqucIx6oYyyXt6GBgaR/MH0xCzAJBgNV\n" +
-            "BAYTAlVTMRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZN\n" +
-            "b3ppbGxhIEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMW\n" +
-            "cm9vdC1jYS1wcm9kdWN0aW9uLWFtb4IBATAzBglghkgBhvhCAQQEJhYkaHR0cDov\n" +
-            "L2FkZG9ucy5hbGxpem9tLm9yZy9jYS9jcmwucGVtME4GA1UdHgRHMEWgQzAggh4u\n" +
-            "Y29udGVudC1zaWduYXR1cmUubW96aWxsYS5vcmcwH4IdY29udGVudC1zaWduYXR1\n" +
-            "cmUubW96aWxsYS5vcmcwDQYJKoZIhvcNAQEMBQADggIBAKWhLjJB8XmW3VfLvyLF\n" +
-            "OOUNeNs7Aju+EZl1PMVXf+917LB//FcJKUQLcEo86I6nC3umUNl+kaq4d3yPDpMV\n" +
-            "4DKLHgGmegRsvAyNFQfd64TTxzyfoyfNWH8uy5vvxPmLvWb+jXCoMNF5FgFWEVon\n" +
-            "5GDEK8hoHN/DMVe0jveeJhUSuiUpJhMzEf6Vbo0oNgfaRAZKO+VOY617nkTOPnVF\n" +
-            "LSEcUPIdE8pcd+QP1t/Ysx+mAfkxAbt+5K298s2bIRLTyNUj1eBtTcCbBbFyWsly\n" +
-            "rSMkJihFAWU2MVKqvJ74YI3uNhFzqJ/AAUAPoet14q+ViYU+8a1lqEWj7y8foF3r\n" +
-            "m0ZiQpuHULiYCO4y4NR7g5ijj6KsbruLv3e9NyUAIRBHOZEKOA7EiFmWJgqH1aZv\n" +
-            "/eS7aQ9HMtPKrlbEwUjV0P3K2U2ljs0rNvO8KO9NKQmocXaRpLm+s8PYBGxby92j\n" +
-            "5eelLq55028BSzhJJc6G+cRT9Hlxf1cg2qtqcVJa8i8wc2upCaGycZIlBSX4gj/4\n" +
-            "k9faY4qGuGnuEdzAyvIXWMSkb8jiNHQfZrebSr00vShkUEKOLmfFHbkwIaWNK0+2\n" +
-            "2c3RL4tDnM5u0kvdgWf0B742JskkxqqmEeZVofsOZJLOhXxO9NO/S0hM16/vf/tl\n" +
-            "Tnsnhv0nxUR0B9wxN7XmWmq4\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIGYTCCBEmgAwIBAgIBATANBgkqhkiG9w0BAQwFADB9MQswCQYDVQQGEwJVUzEc\n" +
-            "MBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMmTW96aWxsYSBB\n" +
-            "TU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMTFnJvb3QtY2Et\n" +
-            "cHJvZHVjdGlvbi1hbW8wHhcNMTUwMzE3MjI1MzU3WhcNMjUwMzE0MjI1MzU3WjB9\n" +
-            "MQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0G\n" +
-            "A1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAd\n" +
-            "BgNVBAMTFnJvb3QtY2EtcHJvZHVjdGlvbi1hbW8wggIgMA0GCSqGSIb3DQEBAQUA\n" +
-            "A4ICDQAwggIIAoICAQC0u2HXXbrwy36+MPeKf5jgoASMfMNz7mJWBecJgvlTf4hH\n" +
-            "JbLzMPsIUauzI9GEpLfHdZ6wzSyFOb4AM+D1mxAWhuZJ3MDAJOf3B1Rs6QorHrl8\n" +
-            "qqlNtPGqepnpNJcLo7JsSqqE3NUm72MgqIHRgTRsqUs+7LIPGe7262U+N/T0LPYV\n" +
-            "Le4rZ2RDHoaZhYY7a9+49mHOI/g2YFB+9yZjE+XdplT2kBgA4P8db7i7I0tIi4b0\n" +
-            "B0N6y9MhL+CRZJyxdFe2wBykJX14LsheKsM1azHjZO56SKNrW8VAJTLkpRxCmsiT\n" +
-            "r08fnPyDKmaeZ0BtsugicdipcZpXriIGmsZbI12q5yuwjSELdkDV6Uajo2n+2ws5\n" +
-            "uXrP342X71WiWhC/dF5dz1LKtjBdmUkxaQMOP/uhtXEKBrZo1ounDRQx1j7+SkQ4\n" +
-            "BEwjB3SEtr7XDWGOcOIkoJZWPACfBLC3PJCBWjTAyBlud0C5n3Cy9regAAnOIqI1\n" +
-            "t16GU2laRh7elJ7gPRNgQgwLXeZcFxw6wvyiEcmCjOEQ6PM8UQjthOsKlszMhlKw\n" +
-            "vjyOGDoztkqSBy/v+Asx7OW2Q7rlVfKarL0mREZdSMfoy3zTgtMVCM0vhNl6zcvf\n" +
-            "5HNNopoEdg5yuXo2chZ1p1J+q86b0G5yJRMeT2+iOVY2EQ37tHrqUURncCy4uwIB\n" +
-            "A6OB7TCB6jAMBgNVHRMEBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAWBgNVHSUBAf8E\n" +
-            "DDAKBggrBgEFBQcDAzCBkgYDVR0jBIGKMIGHoYGBpH8wfTELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMR8wHQYDVQQDExZyb290LWNh\n" +
-            "LXByb2R1Y3Rpb24tYW1vggEBMB0GA1UdDgQWBBSzvOpYdKvhbngqsqucIx6oYyyX\n" +
-            "tzANBgkqhkiG9w0BAQwFAAOCAgEAaNSRYAaECAePQFyfk12kl8UPLh8hBNidP2H6\n" +
-            "KT6O0vCVBjxmMrwr8Aqz6NL+TgdPmGRPDDLPDpDJTdWzdj7khAjxqWYhutACTew5\n" +
-            "eWEaAzyErbKQl+duKvtThhV2p6F6YHJ2vutu4KIciOMKB8dslIqIQr90IX2Usljq\n" +
-            "8Ttdyf+GhUmazqLtoB0GOuESEqT4unX6X7vSGu1oLV20t7t5eCnMMYD67ZBn0YIU\n" +
-            "/cm/+pan66hHrja+NeDGF8wabJxdqKItCS3p3GN1zUGuJKrLykxqbOp/21byAGog\n" +
-            "Z1amhz6NHUcfE6jki7sM7LHjPostU5ZWs3PEfVVgha9fZUhOrIDsyXEpCWVa3481\n" +
-            "LlAq3GiUMKZ5DVRh9/Nvm4NwrTfB3QkQQJCwfXvO9pwnPKtISYkZUqhEqvXk5nBg\n" +
-            "QCkDSLDjXTx39naBBGIVIqBtKKuVTla9enngdq692xX/CgO6QJVrwpqdGjebj5P8\n" +
-            "5fNZPABzTezG3Uls5Vp+4iIWVAEDkK23cUj3c/HhE+Oo7kxfUeu5Y1ZV3qr61+6t\n" +
-            "ZARKjbu1TuYQHf0fs+GwID8zeLc2zJL7UzcHFwwQ6Nda9OJN4uPAuC/BKaIpxCLL\n" +
-            "26b24/tRam4SJjqpiq20lynhUrmTtt6hbG3E1Hpy3bmkt2DYnuMFwEx2gfXNcnbT\n" +
-            "wNuvFqc=\n" +
-            "-----END CERTIFICATE-----"
-
-        val calendar = Calendar.getInstance()
-        calendar.set(Calendar.YEAR, 2028)
-        calendar.set(Calendar.MONTH, 6)
-        calendar.set(Calendar.DAY_OF_MONTH, 13)
-        testSignature(metadataBody, certChainBody, false, calendar.time)
-    }
-
-    @Test(expected = ExperimentDownloadException::class)
-    fun validSignatureCertificateNotYetValid() {
-        val url = server.url("/").url().toString()
-        val metadataBody = """
-            {
-              "data": {
-                "signature": {
-                  "x5u": "$url",
-                  "signature": "kRhyWZdLyjligYHSFhzhbyzUXBoUwoTPvyt9V0e-E7LKGgUYF2MVfqpA2zfIEDdqrImcMABVGHLUx9Nk614zciRBQ-gyaKA5SL2pPdZvoQXk_LLsPhEBgG4VDnxG4SBL"
-                }
-              }
-            }
-        """.trimIndent()
-        val certChainBody = "-----BEGIN CERTIFICATE-----\n" +
-            "MIIEpTCCBCygAwIBAgIEAQAAKTAKBggqhkjOPQQDAzCBpjELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMSUwIwYDVQQDExxDb250ZW50\n" +
-            "IFNpZ25pbmcgSW50ZXJtZWRpYXRlMSEwHwYJKoZIhvcNAQkBFhJmb3hzZWNAbW96\n" +
-            "aWxsYS5jb20wIhgPMjAxODAyMTgwMDAwMDBaGA8yMDE4MDYxODAwMDAwMFowgbEx\n" +
-            "CzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRwwGgYDVQQKExNNb3pp\n" +
-            "bGxhIENvcnBvcmF0aW9uMRcwFQYDVQQLEw5DbG91ZCBTZXJ2aWNlczExMC8GA1UE\n" +
-            "AxMoZmVubmVjLWRsYy5jb250ZW50LXNpZ25hdHVyZS5tb3ppbGxhLm9yZzEjMCEG\n" +
-            "CSqGSIb3DQEJARYUc2VjdXJpdHlAbW96aWxsYS5vcmcwdjAQBgcqhkjOPQIBBgUr\n" +
-            "gQQAIgNiAATpKfWqAyDsh2ISzBycb8Y7JqLygByKI9vI2WZ2VWaGTYfmB1tQ8PFj\n" +
-            "vZrtDqZeO8Dhs2KiMrvs/uoziM2zselYQhd0mz5z3dMui6BD6SPKB83K7xn2r2mW\n" +
-            "plAZxuwnPKujggIYMIICFDAdBgNVHQ4EFgQUTp9+0KSp+vkzbEcXAENBCIyI9eow\n" +
-            "gaoGA1UdIwSBojCBn4AUiHVymVvwUPJguD2xCZYej3l5nu6hgYGkfzB9MQswCQYD\n" +
-            "VQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMm\n" +
-            "TW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMT\n" +
-            "FnJvb3QtY2EtcHJvZHVjdGlvbi1hbW+CAxAABjAMBgNVHRMBAf8EAjAAMA4GA1Ud\n" +
-            "DwEB/wQEAwIHgDAWBgNVHSUBAf8EDDAKBggrBgEFBQcDAzBFBgNVHR8EPjA8MDqg\n" +
-            "OKA2hjRodHRwczovL2NvbnRlbnQtc2lnbmF0dXJlLmNkbi5tb3ppbGxhLm5ldC9j\n" +
-            "YS9jcmwucGVtMEMGCWCGSAGG+EIBBAQ2FjRodHRwczovL2NvbnRlbnQtc2lnbmF0\n" +
-            "dXJlLmNkbi5tb3ppbGxhLm5ldC9jYS9jcmwucGVtME8GCCsGAQUFBwEBBEMwQTA/\n" +
-            "BggrBgEFBQcwAoYzaHR0cHM6Ly9jb250ZW50LXNpZ25hdHVyZS5jZG4ubW96aWxs\n" +
-            "YS5uZXQvY2EvY2EucGVtMDMGA1UdEQQsMCqCKGZlbm5lYy1kbGMuY29udGVudC1z\n" +
-            "aWduYXR1cmUubW96aWxsYS5vcmcwCgYIKoZIzj0EAwMDZwAwZAIwXVe1A+r/yVwR\n" +
-            "DtecWq2DOOIIbq6jPzz/L6GpAw1KHnVMVBnOyrsFNmPyGQb1H60bAjB0dxyh14JB\n" +
-            "FCdPO01+y8I7nGRaWqjkmp/GLrdoginSppQYZInYTZagcfy/nIr5fKk=\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIFfjCCA2agAwIBAgIDEAAGMA0GCSqGSIb3DQEBDAUAMH0xCzAJBgNVBAYTAlVT\n" +
-            "MRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZNb3ppbGxh\n" +
-            "IEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMWcm9vdC1j\n" +
-            "YS1wcm9kdWN0aW9uLWFtbzAeFw0xNzA1MDQwMDEyMzlaFw0xOTA1MDQwMDEyMzla\n" +
-            "MIGmMQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEv\n" +
-            "MC0GA1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2Ux\n" +
-            "JTAjBgNVBAMTHENvbnRlbnQgU2lnbmluZyBJbnRlcm1lZGlhdGUxITAfBgkqhkiG\n" +
-            "9w0BCQEWEmZveHNlY0Btb3ppbGxhLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IA\n" +
-            "BMCmt4C33KfMzsyKokc9SXmMSxozksQglhoGAA1KjlgqEOzcmKEkxtvnGWOA9FLo\n" +
-            "A6U7Wmy+7sqmvmjLboAPQc4G0CEudn5Nfk36uEqeyiyKwKSAT+pZsqS4/maXIC7s\n" +
-            "DqOCAYkwggGFMAwGA1UdEwQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMBYGA1UdJQEB\n" +
-            "/wQMMAoGCCsGAQUFBwMDMB0GA1UdDgQWBBSIdXKZW/BQ8mC4PbEJlh6PeXme7jCB\n" +
-            "qAYDVR0jBIGgMIGdgBSzvOpYdKvhbngqsqucIx6oYyyXt6GBgaR/MH0xCzAJBgNV\n" +
-            "BAYTAlVTMRwwGgYDVQQKExNNb3ppbGxhIENvcnBvcmF0aW9uMS8wLQYDVQQLEyZN\n" +
-            "b3ppbGxhIEFNTyBQcm9kdWN0aW9uIFNpZ25pbmcgU2VydmljZTEfMB0GA1UEAxMW\n" +
-            "cm9vdC1jYS1wcm9kdWN0aW9uLWFtb4IBATAzBglghkgBhvhCAQQEJhYkaHR0cDov\n" +
-            "L2FkZG9ucy5hbGxpem9tLm9yZy9jYS9jcmwucGVtME4GA1UdHgRHMEWgQzAggh4u\n" +
-            "Y29udGVudC1zaWduYXR1cmUubW96aWxsYS5vcmcwH4IdY29udGVudC1zaWduYXR1\n" +
-            "cmUubW96aWxsYS5vcmcwDQYJKoZIhvcNAQEMBQADggIBAKWhLjJB8XmW3VfLvyLF\n" +
-            "OOUNeNs7Aju+EZl1PMVXf+917LB//FcJKUQLcEo86I6nC3umUNl+kaq4d3yPDpMV\n" +
-            "4DKLHgGmegRsvAyNFQfd64TTxzyfoyfNWH8uy5vvxPmLvWb+jXCoMNF5FgFWEVon\n" +
-            "5GDEK8hoHN/DMVe0jveeJhUSuiUpJhMzEf6Vbo0oNgfaRAZKO+VOY617nkTOPnVF\n" +
-            "LSEcUPIdE8pcd+QP1t/Ysx+mAfkxAbt+5K298s2bIRLTyNUj1eBtTcCbBbFyWsly\n" +
-            "rSMkJihFAWU2MVKqvJ74YI3uNhFzqJ/AAUAPoet14q+ViYU+8a1lqEWj7y8foF3r\n" +
-            "m0ZiQpuHULiYCO4y4NR7g5ijj6KsbruLv3e9NyUAIRBHOZEKOA7EiFmWJgqH1aZv\n" +
-            "/eS7aQ9HMtPKrlbEwUjV0P3K2U2ljs0rNvO8KO9NKQmocXaRpLm+s8PYBGxby92j\n" +
-            "5eelLq55028BSzhJJc6G+cRT9Hlxf1cg2qtqcVJa8i8wc2upCaGycZIlBSX4gj/4\n" +
-            "k9faY4qGuGnuEdzAyvIXWMSkb8jiNHQfZrebSr00vShkUEKOLmfFHbkwIaWNK0+2\n" +
-            "2c3RL4tDnM5u0kvdgWf0B742JskkxqqmEeZVofsOZJLOhXxO9NO/S0hM16/vf/tl\n" +
-            "Tnsnhv0nxUR0B9wxN7XmWmq4\n" +
-            "-----END CERTIFICATE-----\n" +
-            "-----BEGIN CERTIFICATE-----\n" +
-            "MIIGYTCCBEmgAwIBAgIBATANBgkqhkiG9w0BAQwFADB9MQswCQYDVQQGEwJVUzEc\n" +
-            "MBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0GA1UECxMmTW96aWxsYSBB\n" +
-            "TU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAdBgNVBAMTFnJvb3QtY2Et\n" +
-            "cHJvZHVjdGlvbi1hbW8wHhcNMTUwMzE3MjI1MzU3WhcNMjUwMzE0MjI1MzU3WjB9\n" +
-            "MQswCQYDVQQGEwJVUzEcMBoGA1UEChMTTW96aWxsYSBDb3Jwb3JhdGlvbjEvMC0G\n" +
-            "A1UECxMmTW96aWxsYSBBTU8gUHJvZHVjdGlvbiBTaWduaW5nIFNlcnZpY2UxHzAd\n" +
-            "BgNVBAMTFnJvb3QtY2EtcHJvZHVjdGlvbi1hbW8wggIgMA0GCSqGSIb3DQEBAQUA\n" +
-            "A4ICDQAwggIIAoICAQC0u2HXXbrwy36+MPeKf5jgoASMfMNz7mJWBecJgvlTf4hH\n" +
-            "JbLzMPsIUauzI9GEpLfHdZ6wzSyFOb4AM+D1mxAWhuZJ3MDAJOf3B1Rs6QorHrl8\n" +
-            "qqlNtPGqepnpNJcLo7JsSqqE3NUm72MgqIHRgTRsqUs+7LIPGe7262U+N/T0LPYV\n" +
-            "Le4rZ2RDHoaZhYY7a9+49mHOI/g2YFB+9yZjE+XdplT2kBgA4P8db7i7I0tIi4b0\n" +
-            "B0N6y9MhL+CRZJyxdFe2wBykJX14LsheKsM1azHjZO56SKNrW8VAJTLkpRxCmsiT\n" +
-            "r08fnPyDKmaeZ0BtsugicdipcZpXriIGmsZbI12q5yuwjSELdkDV6Uajo2n+2ws5\n" +
-            "uXrP342X71WiWhC/dF5dz1LKtjBdmUkxaQMOP/uhtXEKBrZo1ounDRQx1j7+SkQ4\n" +
-            "BEwjB3SEtr7XDWGOcOIkoJZWPACfBLC3PJCBWjTAyBlud0C5n3Cy9regAAnOIqI1\n" +
-            "t16GU2laRh7elJ7gPRNgQgwLXeZcFxw6wvyiEcmCjOEQ6PM8UQjthOsKlszMhlKw\n" +
-            "vjyOGDoztkqSBy/v+Asx7OW2Q7rlVfKarL0mREZdSMfoy3zTgtMVCM0vhNl6zcvf\n" +
-            "5HNNopoEdg5yuXo2chZ1p1J+q86b0G5yJRMeT2+iOVY2EQ37tHrqUURncCy4uwIB\n" +
-            "A6OB7TCB6jAMBgNVHRMEBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAWBgNVHSUBAf8E\n" +
-            "DDAKBggrBgEFBQcDAzCBkgYDVR0jBIGKMIGHoYGBpH8wfTELMAkGA1UEBhMCVVMx\n" +
-            "HDAaBgNVBAoTE01vemlsbGEgQ29ycG9yYXRpb24xLzAtBgNVBAsTJk1vemlsbGEg\n" +
-            "QU1PIFByb2R1Y3Rpb24gU2lnbmluZyBTZXJ2aWNlMR8wHQYDVQQDExZyb290LWNh\n" +
-            "LXByb2R1Y3Rpb24tYW1vggEBMB0GA1UdDgQWBBSzvOpYdKvhbngqsqucIx6oYyyX\n" +
-            "tzANBgkqhkiG9w0BAQwFAAOCAgEAaNSRYAaECAePQFyfk12kl8UPLh8hBNidP2H6\n" +
-            "KT6O0vCVBjxmMrwr8Aqz6NL+TgdPmGRPDDLPDpDJTdWzdj7khAjxqWYhutACTew5\n" +
-            "eWEaAzyErbKQl+duKvtThhV2p6F6YHJ2vutu4KIciOMKB8dslIqIQr90IX2Usljq\n" +
-            "8Ttdyf+GhUmazqLtoB0GOuESEqT4unX6X7vSGu1oLV20t7t5eCnMMYD67ZBn0YIU\n" +
-            "/cm/+pan66hHrja+NeDGF8wabJxdqKItCS3p3GN1zUGuJKrLykxqbOp/21byAGog\n" +
-            "Z1amhz6NHUcfE6jki7sM7LHjPostU5ZWs3PEfVVgha9fZUhOrIDsyXEpCWVa3481\n" +
-            "LlAq3GiUMKZ5DVRh9/Nvm4NwrTfB3QkQQJCwfXvO9pwnPKtISYkZUqhEqvXk5nBg\n" +
-            "QCkDSLDjXTx39naBBGIVIqBtKKuVTla9enngdq692xX/CgO6QJVrwpqdGjebj5P8\n" +
-            "5fNZPABzTezG3Uls5Vp+4iIWVAEDkK23cUj3c/HhE+Oo7kxfUeu5Y1ZV3qr61+6t\n" +
-            "ZARKjbu1TuYQHf0fs+GwID8zeLc2zJL7UzcHFwwQ6Nda9OJN4uPAuC/BKaIpxCLL\n" +
-            "26b24/tRam4SJjqpiq20lynhUrmTtt6hbG3E1Hpy3bmkt2DYnuMFwEx2gfXNcnbT\n" +
-            "wNuvFqc=\n" +
-            "-----END CERTIFICATE-----"
-
-        val calendar = Calendar.getInstance()
-        calendar.set(Calendar.YEAR, 2010)
-        calendar.set(Calendar.MONTH, 6)
-        calendar.set(Calendar.DAY_OF_MONTH, 13)
-        testSignature(metadataBody, certChainBody, false, calendar.time)
-    }
-
-    private fun testSignature(metadataBody: String, certChainBody: String, expected: Boolean, currentDate: Date = defaultDate()) {
-        val experimentsJsonText = """
-            {
-              "data": [
-                {
-                  "id": "leanplum-start",
-                  "description": "Enable Leanplum SDK - Bug 1351571 \nExpand English Users to more region - Bug 1411066\nEnable  50% eng|zho|deu globally for Leanplum. see https://bugzilla.mozilla.org/show_bug.cgi?id=1411066#c8",
-                  "last_modified": 1523549895713,
-                  "schema": 1523549592861,
-                  "match": {
-                    "lang": "eng|zho|deu|fra|ita|ind|por|spa|pol|rus",
-                    "appId": "^org.mozilla.firefox_beta${'$'}|^org.mozilla.firefox${'$'}",
-                    "regions": []
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "control",
-                      "ratio": 5
-                    },
-                    {
-                      "name": "red-pill",
-                      "ratio": 21
-                    }
-                  ]
-                },
-                {
-                  "id": "5e23b482-8800-47be-b6dc-1a3bb6e455d4",
-                  "name": "cusstom-tabs",
-                  "id": "custom-tabs",
-                  "description": "Allows apps to open tabs in a customized UI.",
-                  "last_modified": 1510211043874,
-                  "match": {
-                    "regions": []
-                  },
-                  "schema": 1510207707840,
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "activity-stream-opt-out",
-                  "description": "Enable Activity stream by default for users in the \"opt out\" group.",
-                  "last_modified": 1500969355986,
-                  "schema": 1498764179980,
-                  "match": {
-                    "appId": "^org.mozilla.fennec.*${'$'}",
-                    "regions": []
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "full-bookmark-management",
-                  "description": "Bug 1232439 - Show full-page edit bookmark dialog",
-                  "last_modified": 1498690258010,
-                  "schema": 1480618438089,
-                  "match": {
-                    "appId": "^org.mozilla.fennec.*${'$'}"
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "top-addons-menu",
-                  "description": "Show addon menu item in top-level.",
-                  "last_modified": 1498599522440,
-                  "match": {},
-                  "schema": 1480618438089,
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "offline-cache",
-                  "description": "",
-                  "last_modified": 1497643056372,
-                  "schema": 1480618438089,
-                  "match": {
-                    "appId": "^org.mozilla.fennec|org.mozilla.firefox_beta"
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "process-background-telemetry",
-                  "description": "Gate flag for controlling if background telemetry processing (sync ping) is enabled or not.",
-                  "last_modified": 1496971360625,
-                  "schema": 1480618438089,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "activity-stream-setting",
-                  "description": "Show a setting in \"experimental features\" for enabling/disabling activity stream.",
-                  "last_modified": 1496331790186,
-                  "schema": 1480618438089,
-                  "match": {
-                    "appId": "^org.mozilla.fennec.*${'$'}"
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "activity-stream",
-                  "description": "Enable/Disable Activity Stream",
-                  "last_modified": 1496331773809,
-                  "schema": 1480618438089,
-                  "match": {
-                    "appId": "^org.mozilla.fennec.*${'$'}"
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "download-content-catalog-sync",
-                  "description": "",
-                  "last_modified": 1485853244635,
-                  "schema": 1480618438089,
-                  "match": {
-                    "appId": ""
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "promote-add-to-homescreen",
-                  "description": "",
-                  "last_modified": 1482264639326,
-                  "schema": 1480618438089,
-                  "match": {
-                    "appId": "^org.mozilla.fennec.*${'$'}|^org.mozilla.firefox_beta${'$'}"
-                  },
-                  "buckets": {
-                    "start": "50",
-                    "count": "50"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "triple-readerview-bookmark-prompt",
-                  "description": "",
-                  "last_modified": 1482262302021,
-                  "schema": 1480618438089,
-                  "match": {
-                    "appId": "^org.mozilla.fennec.*${'$'}|^org.mozilla.firefox_beta${'$'}"
-                  },
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "compact-tabs",
-                  "description": "Arrange tabs in two columns in portrait mode (tabs tray)",
-                  "last_modified": 1482242613284,
-                  "schema": 1480618438089,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "50"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "hls-video-playback",
-                  "description": "",
-                  "last_modified": 1477907551487,
-                  "schema": 1467794476773,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "bookmark-history-menu",
-                  "description": "",
-                  "last_modified": 1467794477013,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "100"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "content-notifications-12hrs",
-                  "description": "",
-                  "last_modified": 1467794476938,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "0"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "whatsnew-notification",
-                  "description": "",
-                  "last_modified": 1467794476893,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "0"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "content-notifications-8am",
-                  "description": "",
-                  "last_modified": 1467794476875,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "0"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                },
-                {
-                  "id": "content-notifications-5pm",
-                  "description": "",
-                  "last_modified": 1467794476838,
-                  "match": {},
-                  "buckets": {
-                    "start": "0",
-                    "count": "0"
-                  },
-                  "branches": [
-                    {
-                      "name": "some-branch",
-                      "ratio": 2
-                    }
-                  ]
-                }
-              ],
-              "last_modified": "1523549895713"
-            }
-        """.trimIndent()
-
-        val url = server.url("/").url().toString()
-        server.setDispatcher(object : Dispatcher() {
-            override fun dispatch(request: RecordedRequest): MockResponse {
-                if (request.path.contains("buckets/testbucket/collections/testcollection")) {
-                    return MockResponse().setBody(metadataBody)
-                }
-                return MockResponse().setBody(certChainBody)
-            }
-        })
-        val experimentsJSON = JSONObject(experimentsJsonText)
-        val experimentsJSONArray = experimentsJSON.getJSONArray("data")
-        val experiments = mutableListOf<Experiment>()
-        val parser = JSONExperimentParser()
-        for (i in 0 until experimentsJSONArray.length()) {
-            experiments.add(parser.fromJson(experimentsJSONArray[i] as JSONObject))
-        }
-        val client = HttpURLConnectionClient()
-        val verifier = SignatureVerifier(client, KintoClient(client, url, "testbucket", "testcollection"), currentDate)
-        assertEquals(expected, verifier.validSignature(experiments, experimentsJSON.getLong("last_modified")))
-        server.shutdown()
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/TestUtil.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/TestUtil.kt
deleted file mode 100644
index ff33ce104060..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/TestUtil.kt
+++ /dev/null
@@ -1,124 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import androidx.work.WorkInfo
-import androidx.work.WorkManager
-import mozilla.components.service.experiments.util.VersionString
-import java.util.concurrent.ExecutionException
-
-/**
- * Helper function to check to see if a worker has been scheduled with the [WorkManager]
- *
- * @param tag a string representing the worker tag
- * @return True if the task found in [WorkManager], false otherwise
- */
-internal fun isWorkScheduled(context: Context, tag: String): Boolean {
-    val instance = WorkManager.getInstance(context)
-    val statuses = instance.getWorkInfosByTag(tag)
-    try {
-        val workInfoList = statuses.get()
-        for (workInfo in workInfoList) {
-            val state = workInfo.state
-            if ((state === WorkInfo.State.RUNNING) || (state === WorkInfo.State.ENQUEUED)) {
-                return true
-            }
-        }
-    } catch (e: ExecutionException) {
-        // Do nothing but will return false
-    } catch (e: InterruptedException) {
-        // Do nothing but will return false
-    }
-
-    return false
-}
-
-/**
- * Helper function to return [WorkInfo] from the associated tag in [WorkManager] or null if no work
- * exists for that tag.
- *
- * @param tag a string representing the worker tag
- * @return [WorkInfo] for the tag that was passed in or null
- */
-internal fun getWorkInfoByTag(context: Context, tag: String): WorkInfo? {
-    val instance = WorkManager.getInstance(context)
-    val statuses = instance.getWorkInfosByTag(tag)
-    try {
-        val workInfoList = statuses.get()
-        return workInfoList.firstOrNull()
-    } catch (e: ExecutionException) {
-        // Do nothing but will return false
-    } catch (e: InterruptedException) {
-        // Do nothing but will return false
-    }
-
-    return null
-}
-
-/**
- * Helper function to create an [Experiment.Matcher] instance with default parameters.
- *
- * @return The matcher object.
- */
-internal fun createDefaultMatcher(
-    appId: String? = null,
-    appDisplayVersion: String? = null,
-    appMinVersion: VersionString? = null,
-    appMaxVersion: VersionString? = null,
-    localeLanguage: String? = null,
-    localeCountry: String? = null,
-    deviceManufacturer: String? = null,
-    deviceModel: String? = null,
-    regions: List<String>? = null,
-    debugTags: List<String>? = null
-): Experiment.Matcher {
-    return Experiment.Matcher(
-        appId,
-        appDisplayVersion,
-        appMinVersion,
-        appMaxVersion,
-        localeLanguage,
-        localeCountry,
-        deviceManufacturer,
-        deviceModel,
-        regions,
-        debugTags
-    )
-}
-
-/**
- * Helper function to easily create a branch list with just one branch for all participants.
- *
- * @return The branch list.
- */
-internal fun createSingleBranchList(): List<Experiment.Branch> {
-    return listOf(Experiment.Branch("only-branch", 1))
-}
-
-/**
- * Helper function to create an [Experiment] instance with default parameters.
- *
- * @return The experiment object.
- */
-internal fun createDefaultExperiment(
-    id: String = "testid",
-    description: String = "description",
-    lastModified: Long? = null,
-    schemaModified: Long? = null,
-    buckets: Experiment.Buckets = Experiment.Buckets(0, ExperimentEvaluator.MAX_USER_BUCKET),
-    branches: List<Experiment.Branch> = createSingleBranchList(),
-    match: Experiment.Matcher = createDefaultMatcher()
-): Experiment {
-    return Experiment(
-        id,
-        description,
-        lastModified,
-        schemaModified,
-        buckets,
-        branches,
-        match
-    )
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ValuesProviderTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ValuesProviderTest.kt
deleted file mode 100644
index 5ae6055528df..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/ValuesProviderTest.kt
+++ /dev/null
@@ -1,46 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments
-
-import android.content.Context
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import org.junit.Assert.assertEquals
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.mockito.Mockito.`when`
-import org.mockito.Mockito.mock
-import org.mockito.Mockito.spy
-import java.util.Locale
-import java.util.MissingResourceException
-
-@RunWith(AndroidJUnit4::class)
-class ValuesProviderTest {
-    @Test
-    fun `get language has three letter code`() {
-        Locale.setDefault(Locale("en", "US"))
-        assertEquals("eng", ValuesProvider().getLanguage(mock(Context::class.java)))
-    }
-
-    @Test
-    fun `get language doesn't have three letter code`() {
-        val locale = spy(Locale.getDefault())
-        `when`(locale.isO3Language).thenThrow(MissingResourceException("", "", ""))
-        `when`(locale.language).thenReturn("language")
-        Locale.setDefault(locale)
-        assertEquals("language", ValuesProvider().getLanguage(mock(Context::class.java)))
-    }
-
-    @Test
-    fun `get country has three letter code`() {
-        Locale.setDefault(Locale("en", "US"))
-        assertEquals("USA", ValuesProvider().getCountry(mock(Context::class.java)))
-    }
-
-    @Test
-    fun `get country doesn't have three letter code`() {
-        Locale.setDefault(Locale("cnr", "CS"))
-        assertEquals("CS", ValuesProvider().getCountry(mock(Context::class.java)))
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/debug/ExperimentsDebugActivityTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/debug/ExperimentsDebugActivityTest.kt
deleted file mode 100644
index 2b4bc73b6982..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/debug/ExperimentsDebugActivityTest.kt
+++ /dev/null
@@ -1,292 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments.debug
-
-import android.content.Context
-import android.content.Intent
-import android.content.pm.ActivityInfo
-import android.content.pm.ResolveInfo
-import androidx.test.core.app.ApplicationProvider
-import androidx.test.ext.junit.runners.AndroidJUnit4
-import androidx.work.testing.WorkManagerTestInitHelper
-import kotlinx.coroutines.runBlocking
-import mozilla.components.lib.fetch.httpurlconnection.HttpURLConnectionClient
-import mozilla.components.service.experiments.Configuration
-import mozilla.components.service.experiments.Experiment
-import mozilla.components.service.experiments.Experiments
-import mozilla.components.service.experiments.ExperimentsSnapshot
-import mozilla.components.service.experiments.ExperimentsUpdater
-import mozilla.components.service.glean.Glean
-import mozilla.components.service.glean.config.Configuration as GleanConfiguration
-import mozilla.components.service.glean.net.ConceptFetchHttpUploader
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertFalse
-import org.junit.Assert.assertNotNull
-import org.junit.Assert.assertTrue
-import org.junit.Before
-import org.junit.Test
-import org.junit.runner.RunWith
-import org.mockito.Mockito.spy
-import org.mockito.Mockito.times
-import org.mockito.Mockito.verify
-import org.robolectric.Robolectric
-import org.robolectric.Shadows
-
-@RunWith(AndroidJUnit4::class)
-class ExperimentsDebugActivityTest {
-
-    private val testPackageName = "mozilla.components.service.experiments.test"
-    private val context: Context = ApplicationProvider.getApplicationContext()
-    private val configuration: Configuration = Configuration(HttpURLConnectionClient())
-
-    @Before
-    fun setup() {
-        WorkManagerTestInitHelper.initializeTestWorkManager(context)
-
-        val httpClient = ConceptFetchHttpUploader(lazy { HttpURLConnectionClient() })
-        val config = GleanConfiguration(httpClient = httpClient)
-        Glean.initialize(context, uploadEnabled = true, configuration = config)
-
-        // This makes sure we have a "launch" intent in our package, otherwise
-        // it will fail looking for it in `GleanDebugActivityTest`.
-        val pm = context.packageManager
-        val launchIntent = Intent(Intent.ACTION_MAIN)
-        launchIntent.setPackage(testPackageName)
-        launchIntent.addCategory(Intent.CATEGORY_LAUNCHER)
-        val resolveInfo = ResolveInfo()
-        resolveInfo.activityInfo = ActivityInfo()
-        resolveInfo.activityInfo.packageName = testPackageName
-        resolveInfo.activityInfo.name = "LauncherActivity"
-        @Suppress("DEPRECATION")
-        Shadows.shadowOf(pm).addResolveInfoForIntent(launchIntent, resolveInfo)
-    }
-
-    @Test
-    fun `the main activity is correctly started`() {
-        // Build the intent that will call our debug activity, with no extra.
-        val intent = Intent(context, ExperimentsDebugActivity::class.java)
-        // Start the activity through our intent.
-        val activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-        activity.create().start().resume()
-
-        // Check that our main activity was launched.
-        assertEquals(testPackageName,
-            Shadows.shadowOf(activity.get()).peekNextStartedActivityForResult().intent.`package`!!)
-    }
-
-    @Test
-    fun `command line extra updateExperiments updates experiments`() {
-        // Set the extra values and start the intent.
-        val intent = Intent(context, ExperimentsDebugActivity::class.java)
-        intent.putExtra(ExperimentsDebugActivity.UPDATE_EXPERIMENTS_EXTRA_KEY, true)
-        val activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-
-        val updater: ExperimentsUpdater = spy(
-            ExperimentsUpdater(ApplicationProvider.getApplicationContext<Context>(), Experiments)
-        )
-        updater.initialize(configuration)
-        Experiments.updater = updater
-
-        activity.create().start().resume()
-
-        // updateJob will not be null if the onCreate method was invoked with the intent extra for
-        // updateExperiments
-        assertNotNull(activity.get().updateJob)
-
-        // Wait for the update task to join
-        runBlocking {
-            activity.get().updateJob?.join()
-        }
-
-        // Verify that updateExperiments() was called exactly once
-        verify(updater, times(1)).updateExperiments()
-    }
-
-    @Test
-    fun `command line extra setKintoInstance updates source endpoint`() {
-        // Set the extra values and start the intent.
-        val intent = Intent(ApplicationProvider.getApplicationContext<Context>(),
-            ExperimentsDebugActivity::class.java)
-        var activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-
-        Experiments.initialize(context, configuration)
-
-        activity.create().start().resume()
-
-        // We default to the prod instance, so make sure that we are on the default if no extra is
-        // used.
-        assertEquals(ExperimentsUpdater.KINTO_ENDPOINT_PROD, Experiments.updater.source.baseUrl)
-
-        // Destroy the activity so we can create a new one with the command added to the intent
-        activity.pause().stop().destroy()
-
-        intent.putExtra(ExperimentsDebugActivity.SET_KINTO_INSTANCE_EXTRA_KEY, "staging")
-        activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-
-        activity.create().start().resume()
-
-        // Make sure we changed to the 'staging' instance
-        assertEquals(ExperimentsUpdater.KINTO_ENDPOINT_STAGING, Experiments.updater.source.baseUrl)
-
-        // Destroy the activity so we can create a new one with a new command added to the intent
-        activity.pause().stop().destroy()
-
-        intent.putExtra(ExperimentsDebugActivity.SET_KINTO_INSTANCE_EXTRA_KEY, "dev")
-        activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-
-        activity.create().start().resume()
-
-        // Make sure we changed to the 'dev' instance
-        assertEquals(ExperimentsUpdater.KINTO_ENDPOINT_DEV, Experiments.updater.source.baseUrl)
-
-        // Destroy the activity so we can create a new one with a new command added to the intent
-        activity.pause().stop().destroy()
-
-        intent.putExtra(ExperimentsDebugActivity.SET_KINTO_INSTANCE_EXTRA_KEY, "prod")
-        activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-
-        activity.create().start().resume()
-
-        // Make sure we changed to the 'developer' instance
-        assertEquals(ExperimentsUpdater.KINTO_ENDPOINT_PROD, Experiments.updater.source.baseUrl)
-    }
-
-    @Test
-    fun `command line extra doesn't update source endpoint if invalid instance name used`() {
-        // Set the extra values and start the intent.
-        val intent = Intent(ApplicationProvider.getApplicationContext<Context>(),
-            ExperimentsDebugActivity::class.java)
-        var activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-
-        val updater: ExperimentsUpdater = spy(ExperimentsUpdater(ApplicationProvider.getApplicationContext<Context>(), Experiments))
-        updater.initialize(configuration)
-        Experiments.updater = updater
-
-        activity.create().start().resume()
-
-        // Right now we default to the prod instance, so make sure that we are on the default if no
-        // extra is used
-        assertEquals(ExperimentsUpdater.KINTO_ENDPOINT_PROD, Experiments.updater.source.baseUrl)
-
-        // Destroy the activity so we can create a new one with the command added to the intent
-        activity.pause().stop().destroy()
-
-        intent.putExtra(ExperimentsDebugActivity.SET_KINTO_INSTANCE_EXTRA_KEY, "bad-endpoint")
-        activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-
-        activity.create().start().resume()
-
-        // Make sure we stayed on the 'production' instance
-        assertEquals(ExperimentsUpdater.KINTO_ENDPOINT_PROD, Experiments.updater.source.baseUrl)
-    }
-
-    @Test
-    fun `command line extra overrideExperiment updates experiments`() {
-        // Fake some experiments to test whether the correct one is active
-        val experiment1 = Experiment(
-            id = "test-id1",
-            branches = listOf(Experiment.Branch(name = "test-branch", ratio = 1)),
-            description = "test experiment 1",
-            buckets = Experiment.Buckets(start = 0, count = 0),
-            match = Experiment.Matcher(
-                appId = null,
-                appDisplayVersion = null,
-                appMinVersion = null,
-                appMaxVersion = null,
-                debugTags = null,
-                deviceManufacturer = null,
-                deviceModel = null,
-                localeCountry = null,
-                localeLanguage = null,
-                regions = null
-            ),
-            lastModified = null,
-            schemaModified = null
-        )
-
-        // Fake some experiments to test whether the correct one is active
-        val experiment2 = Experiment(
-            id = "test-id2",
-            branches = listOf(Experiment.Branch(name = "test-branch", ratio = 1)),
-            description = "test experiment 2",
-            buckets = Experiment.Buckets(start = 0, count = 0),
-            match = Experiment.Matcher(
-                appId = null,
-                appDisplayVersion = null,
-                appMinVersion = null,
-                appMaxVersion = null,
-                debugTags = null,
-                deviceManufacturer = null,
-                deviceModel = null,
-                localeCountry = null,
-                localeLanguage = null,
-                regions = null
-            ),
-            lastModified = null,
-            schemaModified = null
-        )
-
-        val experimentsList = listOf(experiment1, experiment2)
-
-        // Since initialization is performed off of the calling thread, we must be careful to
-        // await it in tests to prevent async issues.  Also, we are passing a canary value here
-        // to ensure that the override triggers the callback.
-        var canary: Boolean
-        Experiments.initialize(context, configuration) {
-            canary = true
-        }
-        runBlocking {
-            Experiments.testInitJob?.join()
-        }
-        Experiments.onExperimentsUpdated(ExperimentsSnapshot(experimentsList, null))
-
-        // Reset the canary since initializing will have triggered the callback.
-        canary = false
-
-        // Set the extra values and start the intent.
-        val intent = Intent(context, ExperimentsDebugActivity::class.java)
-        intent.putExtra(ExperimentsDebugActivity.OVERRIDE_EXPERIMENT_EXTRA_KEY, "test-id1")
-        intent.putExtra(ExperimentsDebugActivity.OVERRIDE_BRANCH_EXTRA_KEY, "test-branch")
-        var activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-        activity.create().start().resume()
-
-        assertTrue("Callback must be executed if override is used", canary)
-
-        // Verify that the experiment exists and is active
-        var ex1 = Experiments.getExperiment("test-id1")
-        assertNotNull("experiment cannot be null", ex1)
-        var ex2 = Experiments.getExperiment("test-id2")
-        assertNotNull("experiment cannot be null", ex2)
-        assertTrue("experiment must be active",
-            Experiments.activeExperiment!!.experiment.id == "test-id1")
-        assertFalse("second experiment must not be active",
-            Experiments.activeExperiment!!.experiment.id == "test-id2")
-        assertTrue("experiment must have correct branch", ex1!!.branches.any {
-            it.name == "test-branch"
-        })
-        activity.pause().stop().destroy()
-
-        // Now clear the experiment using the 'clearAllOverrides' command.
-        intent.extras?.clear()
-        intent.putExtra(ExperimentsDebugActivity.OVERRIDE_CLEAR_ALL_EXTRA_KEY, true)
-        activity = Robolectric.buildActivity(ExperimentsDebugActivity::class.java, intent)
-        activity.create().start().resume()
-
-        // Wait for the clear overrides task to join
-        runBlocking {
-            activity.get().clearJob?.join()
-        }
-
-        // Verify that the experiment exists and is NOT active
-        ex1 = Experiments.getExperiment("test-id1")
-        assertNotNull("experiment cannot be null", ex1)
-        ex2 = Experiments.getExperiment("test-id2")
-        assertNotNull("experiment cannot be null", ex2)
-        Experiments.activeExperiment?.let {
-            assertFalse("first experiment must not be active", it.experiment == ex1!!)
-            assertFalse("second experiment must not be active", it.experiment == ex2!!)
-        }
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/util/VersionStringTest.kt b/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/util/VersionStringTest.kt
deleted file mode 100644
index 97c590e5b619..000000000000
--- a/android-components/components/service/experiments/src/test/java/mozilla/components/service/experiments/util/VersionStringTest.kt
+++ /dev/null
@@ -1,73 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.service.experiments.util
-
-import org.junit.Assert
-import org.junit.Test
-
-class VersionStringTest {
-
-    @Test
-    fun compareTo() {
-        // Comparing two exact versions returns 0
-        Assert.assertEquals(0, VersionString("1.0.0").compareTo(VersionString("1.0.0")))
-
-        // Comparing with left padded zeroes returns 0
-        Assert.assertEquals(0, VersionString("1.0.0").compareTo(VersionString("1.00.00")))
-        Assert.assertEquals(0, VersionString("1.1.1").compareTo(VersionString("1.01.0001")))
-
-        // Comparing to extra dotted sections with zero returns 0
-        Assert.assertEquals(0, VersionString("1").compareTo(VersionString("1.0.000")))
-        Assert.assertEquals(0, VersionString("1.1").compareTo(VersionString("1.1.000.0")))
-
-        // Comparing a higher version to a lower version returns 1
-        Assert.assertEquals(1, VersionString("1.1.0").compareTo(VersionString("1.0.0")))
-        Assert.assertEquals(1, VersionString("1.1.54321").compareTo(VersionString("1.1.12345")))
-        Assert.assertEquals(1, VersionString("51.1.0").compareTo(VersionString("50.1.0")))
-        Assert.assertEquals(1, VersionString("1.1.0").compareTo(VersionString("1.0.1")))
-
-        // Comparing a lower version to a higher version returns -1
-        Assert.assertEquals(-1, VersionString("1.0.0").compareTo(VersionString("1.1.0")))
-        Assert.assertEquals(-1, VersionString("1.1.12345").compareTo(VersionString("1.1.54321")))
-        Assert.assertEquals(-1, VersionString("50.1.0").compareTo(VersionString("51.1.0")))
-        Assert.assertEquals(-1, VersionString("1.0.1").compareTo(VersionString("1.1.0")))
-    }
-
-    @Test(expected = IllegalArgumentException::class)
-    fun `invalid VersionString's throw IllegalArgumentException`() {
-        VersionString("Invalid").compareTo(VersionString("Also_invalid"))
-    }
-
-    @Test(expected = IllegalArgumentException::class)
-    fun `invalid left VersionString makes it throw IllegalArgumentException`() {
-        VersionString("Invalid").compareTo(VersionString("1.0.0"))
-    }
-
-    @Test(expected = IllegalArgumentException::class)
-    fun `invalid right VersionString makes it throw IllegalArgumentException`() {
-        VersionString("1.0.0").compareTo(VersionString("Invalid"))
-    }
-
-    @Test
-    fun equals() {
-        Assert.assertEquals(VersionString("1.0.0"), VersionString("1.0.0"))
-        Assert.assertNotEquals(VersionString("1.0.0"), VersionString("1.0.1"))
-    }
-
-    @Test
-    fun isValid() {
-        Assert.assertTrue(VersionString("1.0.0").isValid())
-        Assert.assertTrue(VersionString("1.0.1").isValid())
-        Assert.assertTrue(VersionString("1.0").isValid())
-        Assert.assertTrue(VersionString("10.4.123545").isValid())
-
-        Assert.assertFalse(VersionString("Invalid").isValid())
-        Assert.assertFalse(VersionString("Nightly 191103 18:03").isValid())
-        Assert.assertFalse(VersionString("a.b.c").isValid())
-        Assert.assertFalse(VersionString("Not.a.version").isValid())
-        Assert.assertFalse(VersionString("12.1.1A").isValid())
-        Assert.assertFalse(VersionString("").isValid())
-    }
-}
diff --git a/android-components/components/service/experiments/src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker b/android-components/components/service/experiments/src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker
deleted file mode 100644
index 1f0955d450f0..000000000000
--- a/android-components/components/service/experiments/src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker
+++ /dev/null
@@ -1 +0,0 @@
-mock-maker-inline
diff --git a/android-components/components/service/experiments/src/test/resources/robolectric.properties b/android-components/components/service/experiments/src/test/resources/robolectric.properties
deleted file mode 100644
index 89a6c8b4c2e7..000000000000
--- a/android-components/components/service/experiments/src/test/resources/robolectric.properties
+++ /dev/null
@@ -1 +0,0 @@
-sdk=28
\ No newline at end of file
