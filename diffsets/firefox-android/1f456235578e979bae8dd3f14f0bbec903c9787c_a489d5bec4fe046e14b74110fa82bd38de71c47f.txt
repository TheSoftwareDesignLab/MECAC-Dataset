diff --git a/android-components/README.md b/android-components/README.md
index 9add6f814d77..fcbaf721063d 100644
--- a/android-components/README.md
+++ b/android-components/README.md
@@ -84,6 +84,8 @@ High-level components for building browser(-like) apps.
 
 * âšª [**Menu**](components/browser/menu/README.md) - A generic menu with customizable items primarily for browser toolbars.
 
+* âšª [**Menu 2**](components/browser/menu2/README.md) - A generic menu with customizable items primarily for browser toolbars.
+
 * ðŸ”µ [**Search**](components/browser/search/README.md) - Search plugins and companion code to load, parse and use them.
 
 * ðŸ”µ [**Session**](components/browser/session/README.md) - A generic representation of a browser session.
diff --git a/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/BrowserMenu.kt b/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/BrowserMenu.kt
index d2034d548a78..0584efffbf44 100644
--- a/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/BrowserMenu.kt
+++ b/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/BrowserMenu.kt
@@ -146,9 +146,9 @@ open class BrowserMenu internal constructor(
         }
     }
 
-    enum class Orientation {
-        UP,
-        DOWN
+    enum class Orientation(val concept: mozilla.components.concept.menu.Orientation) {
+        UP(mozilla.components.concept.menu.Orientation.UP),
+        DOWN(mozilla.components.concept.menu.Orientation.DOWN)
     }
 
     override fun onViewDetachedFromWindow(v: View?) {
diff --git a/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/view/MenuButton.kt b/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/view/MenuButton.kt
index 0f2c5eff15ac..76833b7ad9a8 100644
--- a/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/view/MenuButton.kt
+++ b/android-components/components/browser/menu/src/main/java/mozilla/components/browser/menu/view/MenuButton.kt
@@ -12,12 +12,21 @@ import android.widget.FrameLayout
 import android.widget.ImageView
 import androidx.annotation.ColorInt
 import androidx.annotation.VisibleForTesting
-import androidx.core.content.ContextCompat
 import mozilla.components.browser.menu.BrowserMenu
 import mozilla.components.browser.menu.BrowserMenu.Orientation
 import mozilla.components.browser.menu.BrowserMenuBuilder
 import mozilla.components.browser.menu.BrowserMenuHighlight
 import mozilla.components.browser.menu.R
+import mozilla.components.concept.menu.MenuButton
+import mozilla.components.concept.menu.MenuController
+import mozilla.components.concept.menu.candidate.HighPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.LowPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.MenuCandidate
+import mozilla.components.concept.menu.candidate.MenuEffect
+import mozilla.components.concept.menu.ext.effects
+import mozilla.components.concept.menu.ext.max
+import mozilla.components.support.base.observer.Observable
+import mozilla.components.support.base.observer.ObserverRegistry
 
 /**
  * A `three-dot` button used for expanding menus.
@@ -28,24 +37,63 @@ class MenuButton @JvmOverloads constructor(
     context: Context,
     attrs: AttributeSet? = null,
     defStyleAttr: Int = 0
-) : FrameLayout(context, attrs, defStyleAttr), View.OnClickListener {
+) : FrameLayout(context, attrs, defStyleAttr),
+    MenuButton,
+    View.OnClickListener,
+    Observable<MenuButton.Observer> by ObserverRegistry() {
+
+    private val menuControllerObserver = object : MenuController.Observer {
+        /**
+         * Change the menu button appearance when the menu list changes.
+         */
+        override fun onMenuListSubmit(list: List<MenuCandidate>) {
+            val effect = list.effects().max()
+
+            // If a highlighted item is found, show the indicator
+            setEffect(effect)
+        }
+
+        override fun onDismiss() = notifyObservers { onDismiss() }
+    }
 
     /**
      * Listener called when the menu is shown.
      */
+    @Deprecated("Use the Observable interface to listen for onShow")
     var onShow: () -> Unit = {}
     /**
      * Listener called when the menu is dismissed.
      */
+    @Deprecated("Use the Observable interface to listen for onDismiss")
     var onDismiss: () -> Unit = {}
+
     /**
      * Callback to get the orientation for the menu.
      * This is called every time the menu should be displayed.
+     * This has no effect when a [MenuController] is set.
      */
     var getOrientation: () -> Orientation = {
         BrowserMenu.determineMenuOrientation(parent as? View?)
     }
 
+    /**
+     * Sets a [MenuController] that will be used to create a menu when this button is clicked.
+     * If present, [menuBuilder] will be ignored.
+     */
+    override var menuController: MenuController? = null
+        set(value) {
+            // Clean up old controller
+            field?.dismiss()
+            field?.unregister(menuControllerObserver)
+
+            // Attach new controller
+            field = value
+            value?.register(menuControllerObserver, this)
+        }
+
+    /**
+     * Sets a [BrowserMenuBuilder] that will be used to create a menu when this button is clicked.
+     */
     var menuBuilder: BrowserMenuBuilder? = null
         set(value) {
             field = value
@@ -65,52 +113,66 @@ class MenuButton @JvmOverloads constructor(
         menuIcon = findViewById(R.id.icon)
         highlightView = findViewById(R.id.highlight)
         notificationIconView = findViewById(R.id.notification_dot)
+
+        // Hook up deprecated callbacks using new observer system
+        @Suppress("Deprecation")
+        val internalObserver = object : MenuButton.Observer {
+            override fun onShow() = this@MenuButton.onShow()
+            override fun onDismiss() = this@MenuButton.onDismiss()
+        }
+        register(internalObserver)
     }
 
     /**
      * Shows the menu, or dismisses it if already open.
      */
     override fun onClick(v: View) {
+        // If a legacy menu is open, dismiss it.
         if (menu != null) {
             menu?.dismiss()
             return
         }
 
-        menu = menuBuilder?.build(context)
-        val endAlwaysVisible = menuBuilder?.endOfMenuAlwaysVisible ?: false
-        menu?.show(
-            anchor = this,
-            orientation = getOrientation(),
-            endOfMenuAlwaysVisible = endAlwaysVisible
-        ) {
-            menu = null
-            onDismiss()
+        val menuController = menuController
+        if (menuController != null) {
+            // Use the newer menu controller if set
+            menuController.show(anchor = this)
+        } else {
+            menu = menuBuilder?.build(context)
+            val endAlwaysVisible = menuBuilder?.endOfMenuAlwaysVisible ?: false
+            menu?.show(
+                anchor = this,
+                orientation = getOrientation(),
+                endOfMenuAlwaysVisible = endAlwaysVisible
+            ) {
+                menu = null
+                notifyObservers { onDismiss() }
+            }
         }
-        onShow()
+        notifyObservers { onShow() }
     }
 
     /**
      * Show the indicator for a browser menu highlight.
      */
-    @Suppress("Deprecation")
-    fun setHighlight(highlight: BrowserMenuHighlight?) {
-        when (highlight) {
-            is BrowserMenuHighlight.HighPriority -> {
-                highlightView.imageTintList = ColorStateList.valueOf(highlight.backgroundTint)
+    fun setHighlight(highlight: BrowserMenuHighlight?) =
+        setEffect(highlight?.asEffect(context))
+
+    /**
+     * Show the indicator for a browser menu effect.
+     */
+    override fun setEffect(effect: MenuEffect?) {
+        when (effect) {
+            is HighPriorityHighlightEffect -> {
+                highlightView.imageTintList = ColorStateList.valueOf(effect.backgroundTint)
                 highlightView.visibility = View.VISIBLE
                 notificationIconView.visibility = View.GONE
             }
-            is BrowserMenuHighlight.LowPriority -> {
-                notificationIconView.setColorFilter(highlight.notificationTint)
+            is LowPriorityHighlightEffect -> {
+                notificationIconView.setColorFilter(effect.notificationTint)
                 highlightView.visibility = View.GONE
                 notificationIconView.visibility = View.VISIBLE
             }
-            is BrowserMenuHighlight.ClassicHighlight -> {
-                val color = ContextCompat.getColor(context, highlight.colorResource)
-                highlightView.imageTintList = ColorStateList.valueOf(color)
-                highlightView.visibility = View.VISIBLE
-                notificationIconView.visibility = View.GONE
-            }
             null -> {
                 highlightView.visibility = View.GONE
                 notificationIconView.visibility = View.GONE
@@ -121,7 +183,7 @@ class MenuButton @JvmOverloads constructor(
     /**
      * Sets the tint of the 3-dot menu icon.
      */
-    fun setColorFilter(@ColorInt color: Int) {
+    override fun setColorFilter(@ColorInt color: Int) {
         menuIcon.setColorFilter(color)
     }
 
@@ -129,6 +191,7 @@ class MenuButton @JvmOverloads constructor(
      * Dismiss the menu, if open.
      */
     fun dismissMenu() {
+        menuController?.dismiss()
         menu?.dismiss()
     }
 
diff --git a/android-components/components/browser/menu/src/main/res/values/style.xml b/android-components/components/browser/menu/src/main/res/values/style.xml
index 83bfdd80b16a..31d6c40a6e4d 100644
--- a/android-components/components/browser/menu/src/main/res/values/style.xml
+++ b/android-components/components/browser/menu/src/main/res/values/style.xml
@@ -26,6 +26,11 @@
         <item name="android:background">?android:attr/selectableItemBackground</item>
     </style>
 
+    <style name="Mozac.Browser.Menu.Item.CandidateContainer" parent="Mozac.Browser.Menu.Item.Container">
+        <item name="android:paddingStart">16dp</item>
+        <item name="android:paddingEnd">16dp</item>
+    </style>
+
     <style name="Mozac.Browser.Menu.Item.Text" parent="@android:style/TextAppearance.Material.Menu">
         <item name="android:background">?android:attr/selectableItemBackground</item>
         <item name="android:textSize">@dimen/mozac_browser_menu_item_text_size</item>
@@ -51,12 +56,22 @@
         <item name="android:layout_height">@dimen/mozac_browser_menu_item_image_text_icon_height</item>
     </style>
 
+    <style name="Mozac.Browser.Menu.Item.CandidateIcon" parent="Mozac.Browser.Menu.Item.ImageText.Icon">
+        <item name="android:layout_width">24dp</item>
+        <item name="android:layout_height">24dp</item>
+    </style>
+
     <style name="Mozac.Browser.Menu.Item.ImageText.Label" parent="Mozac.Browser.Menu.Item.Text">
         <item name="android:layout_width">wrap_content</item>
         <item name="android:layout_height">wrap_content</item>
         <item name="android:paddingStart">@dimen/mozac_browser_menu_item_image_text_label_padding_start</item>
         <item name="android:paddingEnd">@dimen/mozac_browser_menu_item_image_text_label_padding_start</item>
     </style>
+
+    <style name="Mozac.Browser.Menu.Item.CandidateLabel" parent="Mozac.Browser.Menu.Item.Text">
+        <item name="android:layout_width">wrap_content</item>
+        <item name="android:layout_height">wrap_content</item>
+    </style>
     <!-- BrowserMenuImageText -->
 
     <!-- Animation -->
diff --git a/android-components/components/browser/menu/src/test/java/mozilla/components/browser/menu/view/MenuButtonTest.kt b/android-components/components/browser/menu/src/test/java/mozilla/components/browser/menu/view/MenuButtonTest.kt
index 7281dcb9a235..f0d5389a3a14 100644
--- a/android-components/components/browser/menu/src/test/java/mozilla/components/browser/menu/view/MenuButtonTest.kt
+++ b/android-components/components/browser/menu/src/test/java/mozilla/components/browser/menu/view/MenuButtonTest.kt
@@ -16,6 +16,7 @@ import androidx.test.ext.junit.runners.AndroidJUnit4
 import mozilla.components.browser.menu.BrowserMenu
 import mozilla.components.browser.menu.BrowserMenuBuilder
 import mozilla.components.browser.menu.BrowserMenuHighlight
+import mozilla.components.concept.menu.MenuController
 import mozilla.components.support.test.any
 import mozilla.components.support.test.eq
 import mozilla.components.support.test.mock
@@ -30,11 +31,13 @@ import org.junit.Test
 import org.junit.runner.RunWith
 import org.mockito.ArgumentMatchers.anyBoolean
 import org.mockito.Mockito.doReturn
+import org.mockito.Mockito.never
 import org.mockito.Mockito.times
 import org.mockito.Mockito.verify
 
 @RunWith(AndroidJUnit4::class)
 class MenuButtonTest {
+    private lateinit var menuController: MenuController
     private lateinit var menuBuilder: BrowserMenuBuilder
     private lateinit var menu: BrowserMenu
     private lateinit var menuButton: MenuButton
@@ -44,6 +47,7 @@ class MenuButtonTest {
 
     @Before
     fun setup() {
+        menuController = mock()
         menu = mock()
         menuBuilder = mock()
         doReturn(menu).`when`(menuBuilder).build(testContext)
@@ -55,6 +59,17 @@ class MenuButtonTest {
         notificationIconView = images[2]
     }
 
+    @Test
+    fun `changing menu controller dismisses old menu`() {
+        menuButton.menuController = menuController
+        menuButton.performClick()
+
+        verify(menuController).show(menuButton)
+
+        menuButton.menuController = mock()
+        verify(menuController).dismiss()
+    }
+
     @Test
     fun `changing menu builder dismisses old menu`() {
         menuButton.menuBuilder = menuBuilder
@@ -66,6 +81,18 @@ class MenuButtonTest {
         verify(menu).dismiss()
     }
 
+    @Test
+    fun `opening a new menu will prefer using the controller`() {
+        menuButton.menuController = menuController
+        menuButton.menuBuilder = menuBuilder
+
+        menuButton.performClick()
+
+        verify(menuController).show(menuButton)
+        verify(menuBuilder, never()).build(testContext)
+        verify(menu, never()).show(any(), any(), anyBoolean(), any())
+    }
+
     @Test
     fun `trying to open a new menu when we already have one will dismiss the current`() {
         menuButton.menuBuilder = menuBuilder
@@ -134,10 +161,12 @@ class MenuButtonTest {
 
     @Test
     fun `menu can be dismissed`() {
+        menuButton.menuController = menuController
         menuButton.menu = menu
 
         menuButton.dismissMenu()
 
+        verify(menuButton.menuController)?.dismiss()
         verify(menuButton.menu)?.dismiss()
     }
 }
diff --git a/android-components/components/browser/menu2/README.md b/android-components/components/browser/menu2/README.md
index ebee64e25724..f215e5c57db7 100644
--- a/android-components/components/browser/menu2/README.md
+++ b/android-components/components/browser/menu2/README.md
@@ -2,7 +2,8 @@
 
 A generic menu with customizable items primarily for browser toolbars.
 
-This replaces the [browser-menu](../menu) component.
+This replaces the [browser-menu](../menu) component with a new API using immutable objects,
+designed to work well with [lib-state](../../lib/state).
 
 ## Usage
 
@@ -15,28 +16,34 @@ implementation "org.mozilla.components:browser-menu2:{latest-version}"
 ```
 
 ### MenuController
+The menu controller is used to control the items in the menu as well as displaying the menu popup.
+
 Sample code can be found in [Sample Toolbar app](https://github.com/mozilla-mobile/android-components/tree/master/samples/toolbar).
 
-There are multiple properties that you customize of the menu browser by just adding them into your dimens.xml file.
+There are multiple properties that you customize of the browser menu by just adding them into your dimens.xml file.
 
 ```xml
 <resources xmlns:tools="http://schemas.android.com/tools">
 
    <!--Change how rounded the corners of the menu should be-->
-    <dimen name="mozac_browser_menu_corner_radius" tools:ignore="UnusedResources">4dp</dimen>
+    <dimen name="mozac_browser_menu2_corner_radius" tools:ignore="UnusedResources">4dp</dimen>
 
     <!--Change how much shadow the menu should have-->
-    <dimen name="mozac_browser_menu_elevation" tools:ignore="UnusedResources">4dp</dimen>
+    <dimen name="mozac_browser_menu2_elevation" tools:ignore="UnusedResources">4dp</dimen>
 
-    <!--Change the width of the menu-->
-    <dimen name="mozac_browser_menu_width" tools:ignore="UnusedResources">250dp</dimen>
+    <!--Change the width of the menu - can also be set in MenuController#show()-->
+    <dimen name="mozac_browser_menu2_width" tools:ignore="UnusedResources">250dp</dimen>
 
     <!--Change the top and bottom padding of the menu-->
-    <dimen name="mozac_browser_menu_padding_vertical" tools:ignore="UnusedResources">8dp</dimen>
+    <dimen name="mozac_browser_menu2_padding_vertical" tools:ignore="UnusedResources">8dp</dimen>
 
 </resources>
 ```
 
+Options displayed in the menu are configured by using a list of `MenuCandidate` objects.
+The list of options can be sent to the menu by calling `MenuController#submitList()`.
+To change the displayed options, simply call `submitList` again with a new list.
+
 ## License
 
     This Source Code Form is subject to the terms of the Mozilla Public
diff --git a/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/BrowserMenuController.kt b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/BrowserMenuController.kt
new file mode 100644
index 000000000000..6c5fadf56885
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/BrowserMenuController.kt
@@ -0,0 +1,92 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2
+
+import mozilla.components.concept.menu.Side
+import android.view.View
+import android.view.ViewGroup.LayoutParams.WRAP_CONTENT
+import android.widget.PopupWindow
+import androidx.annotation.Px
+import androidx.coordinatorlayout.widget.CoordinatorLayout
+import mozilla.components.browser.menu2.ext.displayPopup
+import mozilla.components.browser.menu2.view.MenuView
+import mozilla.components.concept.menu.MenuController
+import mozilla.components.concept.menu.Orientation
+import mozilla.components.concept.menu.candidate.MenuCandidate
+import mozilla.components.support.base.observer.Observable
+import mozilla.components.support.base.observer.ObserverRegistry
+
+/**
+ * Controls a popup menu composed of MenuCandidate objects.
+ * @param visibleSide Sets the menu to open with either the start or end visible.
+ */
+class BrowserMenuController(
+    private val visibleSide: Side = Side.START
+) : MenuController, Observable<MenuController.Observer> by ObserverRegistry() {
+
+    private var menuCandidates: List<MenuCandidate> = emptyList()
+    private var currentPopup: PopupWindow? = null
+
+    /**
+     * @param anchor The view on which to pin the popup window.
+     * @param orientation The preferred orientation to show the popup window.
+     * @param width The width of the popup menu. The height is always set to wrap content.
+     */
+    fun show(
+        anchor: View,
+        orientation: Orientation = determineMenuOrientation(anchor.parent as? View?),
+        @Px width: Int = anchor.resources.getDimensionPixelSize(R.dimen.mozac_browser_menu2_width)
+    ): PopupWindow {
+        val view = MenuView(anchor.context).apply {
+            submitList(menuCandidates)
+            setVisibleSide(visibleSide)
+        }
+
+        return PopupWindow(view, width, WRAP_CONTENT, true).apply {
+            view.onDismiss = ::dismiss
+            setOnDismissListener {
+                currentPopup = null
+                notifyObservers { onDismiss() }
+            }
+
+            displayPopup(view, anchor, orientation)
+        }.also {
+            currentPopup = it
+        }
+    }
+
+    override fun show(anchor: View): PopupWindow =
+        show(anchor, orientation = determineMenuOrientation(anchor.parent as? View?))
+
+    /**
+     * Dismiss the menu popup if the menu is visible.
+     */
+    override fun dismiss() {
+        currentPopup?.dismiss()
+    }
+
+    /**
+     * Changes the contents of the menu.
+     */
+    override fun submitList(list: List<MenuCandidate>) {
+        menuCandidates = list
+
+        val openMenu = currentPopup?.contentView as MenuView?
+        openMenu?.submitList(list)
+
+        notifyObservers { onMenuListSubmit(list) }
+    }
+}
+
+/**
+ * Determines the orientation to be used for a menu
+ * based on the positioning of the [parent] in the layout.
+ */
+fun determineMenuOrientation(parent: View?): Orientation {
+    val params = parent?.layoutParams as? CoordinatorLayout.LayoutParams
+        ?: return Orientation.DOWN
+
+    return Orientation.fromGravity(params.gravity)
+}
diff --git a/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/MenuController.kt b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/MenuController.kt
deleted file mode 100644
index 86be67abbd78..000000000000
--- a/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/MenuController.kt
+++ /dev/null
@@ -1,15 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.browser.menu2
-
-import mozilla.components.concept.menu.Side
-
-/**
- * Controls a popup menu composed of MenuCandidate objects.
- * @param visibleSide Sets the menu to open with either the start or end visible.
- */
-class MenuController(
-    private val visibleSide: Side = Side.START
-)
diff --git a/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/ext/PopupWindow.kt b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/ext/PopupWindow.kt
new file mode 100644
index 000000000000..9396af1b59e9
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/ext/PopupWindow.kt
@@ -0,0 +1,109 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2.ext
+
+import android.graphics.Rect
+import android.view.Gravity
+import android.view.View
+import android.widget.PopupWindow
+import androidx.core.widget.PopupWindowCompat
+import mozilla.components.browser.menu2.R
+import mozilla.components.concept.menu.Orientation
+import mozilla.components.support.ktx.android.view.isRTL
+
+internal fun PopupWindow.displayPopup(
+    containerView: View,
+    anchor: View,
+    preferredOrientation: Orientation
+) {
+    // Measure menu
+    val spec = View.MeasureSpec.makeMeasureSpec(0, View.MeasureSpec.UNSPECIFIED)
+    containerView.measure(spec, spec)
+
+    val topAndBottomPair = getMaxAvailableHeightToTopAndBottom(anchor)
+    val availableHeightToTop = topAndBottomPair.first
+    val availableHeightToBottom = topAndBottomPair.second
+    val containerHeight = containerView.measuredHeight
+
+    val fitsUp = availableHeightToTop >= containerHeight
+    val fitsDown = availableHeightToBottom >= containerHeight
+
+    // Try to use the preferred orientation, if doesn't fit fallback to the best fit.
+    when {
+        preferredOrientation == Orientation.DOWN && fitsDown ->
+            showPopupWithDownOrientation(anchor)
+        preferredOrientation == Orientation.UP && fitsUp ->
+            showPopupWithUpOrientation(anchor, availableHeightToBottom, containerHeight)
+        else ->
+            showPopupWhereBestFits(anchor, fitsUp, fitsDown, availableHeightToBottom, containerHeight)
+    }
+}
+
+private fun PopupWindow.showPopupWhereBestFits(
+    anchor: View,
+    fitsUp: Boolean,
+    fitsDown: Boolean,
+    availableHeightToBottom: Int,
+    containerHeight: Int
+) {
+    // We don't have enough space to show the menu UP neither DOWN.
+    // Let's just show the popup at the location of the anchor.
+    if (!fitsUp && !fitsDown) {
+        showAtAnchorLocation(anchor)
+    } else {
+        if (fitsDown) {
+            showPopupWithDownOrientation(anchor)
+        } else {
+            showPopupWithUpOrientation(anchor, availableHeightToBottom, containerHeight)
+        }
+    }
+}
+
+private fun PopupWindow.showPopupWithUpOrientation(anchor: View, availableHeightToBottom: Int, containerHeight: Int) {
+    val xOffset = if (anchor.isRTL) -anchor.width else 0
+    animationStyle = R.style.Mozac_Browser_Menu2_Animation_OverflowMenuBottom
+
+    // Positioning the menu above and overlapping the anchor.
+    val yOffset = if (availableHeightToBottom < 0) {
+        // The anchor is partially below of the bottom of the screen, let's make the menu completely visible.
+        availableHeightToBottom - containerHeight
+    } else {
+        -containerHeight
+    }
+    showAsDropDown(anchor, xOffset, yOffset)
+}
+
+private fun PopupWindow.showPopupWithDownOrientation(anchor: View) {
+    val xOffset = if (anchor.isRTL) -anchor.width else 0
+    animationStyle = R.style.Mozac_Browser_Menu2_Animation_OverflowMenuTop
+    // Menu should overlay the anchor.
+    showAsDropDown(anchor, xOffset, -anchor.height)
+}
+
+private fun PopupWindow.showAtAnchorLocation(anchor: View) {
+    val anchorPosition = IntArray(2)
+    anchor.getLocationOnScreen(anchorPosition)
+    val x = anchorPosition[0]
+    val y = anchorPosition[1]
+    PopupWindowCompat.setOverlapAnchor(this, true)
+    showAtLocation(anchor, Gravity.START or Gravity.TOP, x, y)
+}
+
+private fun getMaxAvailableHeightToTopAndBottom(anchor: View): Pair<Int, Int> {
+    val anchorPosition = IntArray(2)
+    val displayFrame = Rect()
+
+    val appView = anchor.rootView
+    appView.getWindowVisibleDisplayFrame(displayFrame)
+
+    anchor.getLocationOnScreen(anchorPosition)
+
+    val bottomEdge = displayFrame.bottom
+
+    val distanceToBottom = bottomEdge - (anchorPosition[1] + anchor.height)
+    val distanceToTop = anchorPosition[1] - displayFrame.top
+
+    return distanceToTop to distanceToBottom
+}
diff --git a/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/view/MenuButton2.kt b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/view/MenuButton2.kt
new file mode 100644
index 000000000000..66efb6b10bd1
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/view/MenuButton2.kt
@@ -0,0 +1,116 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2.view
+
+import android.content.Context
+import android.content.res.ColorStateList
+import android.util.AttributeSet
+import android.view.View
+import android.widget.FrameLayout
+import android.widget.ImageView
+import androidx.annotation.ColorInt
+import mozilla.components.browser.menu2.R
+import mozilla.components.concept.menu.MenuButton
+import mozilla.components.concept.menu.MenuController
+import mozilla.components.concept.menu.candidate.HighPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.LowPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.MenuCandidate
+import mozilla.components.concept.menu.candidate.MenuEffect
+import mozilla.components.concept.menu.ext.effects
+import mozilla.components.concept.menu.ext.max
+import mozilla.components.support.base.observer.Observable
+import mozilla.components.support.base.observer.ObserverRegistry
+
+/**
+ * A `three-dot` button used for expanding menus.
+ *
+ * If you are using a browser toolbar, do not use this class directly.
+ */
+class MenuButton2 @JvmOverloads constructor(
+    context: Context,
+    attrs: AttributeSet? = null,
+    defStyleAttr: Int = 0
+) : FrameLayout(context, attrs, defStyleAttr),
+    MenuButton,
+    View.OnClickListener,
+    Observable<MenuButton.Observer> by ObserverRegistry() {
+
+    /**
+     * Sets a [MenuController] that will be used to create a menu when this button is clicked.
+     */
+    override var menuController: MenuController? = null
+        set(value) {
+            // Clean up old controller
+            field?.dismiss()
+            field?.unregister(menuControllerObserver)
+
+            // Attach new controller
+            field = value
+            value?.register(menuControllerObserver, this)
+        }
+
+    private val menuControllerObserver = object : MenuController.Observer {
+        /**
+         * Change the menu button appearance when the menu list changes.
+         */
+        override fun onMenuListSubmit(list: List<MenuCandidate>) {
+            val effect = list.effects().max()
+
+            // If a highlighted item is found, show the indicator
+            setEffect(effect)
+        }
+
+        override fun onDismiss() = notifyObservers { onDismiss() }
+    }
+
+    private val menuIcon: ImageView
+    private val highlightView: ImageView
+    private val notificationIconView: ImageView
+
+    init {
+        View.inflate(context, R.layout.mozac_browser_menu2_button, this)
+        setOnClickListener(this)
+        menuIcon = findViewById(R.id.icon)
+        highlightView = findViewById(R.id.highlight)
+        notificationIconView = findViewById(R.id.notification_dot)
+    }
+
+    /**
+     * Shows the menu.
+     */
+    override fun onClick(v: View) {
+        val menuController = menuController ?: return
+
+        menuController.show(anchor = this)
+        notifyObservers { onShow() }
+    }
+
+    /**
+     * Show the indicator for a browser menu effect.
+     */
+    override fun setEffect(effect: MenuEffect?) {
+        when (effect) {
+            is HighPriorityHighlightEffect -> {
+                highlightView.imageTintList = ColorStateList.valueOf(effect.backgroundTint)
+                highlightView.visibility = View.VISIBLE
+                notificationIconView.visibility = View.GONE
+            }
+            is LowPriorityHighlightEffect -> {
+                notificationIconView.setColorFilter(effect.notificationTint)
+                highlightView.visibility = View.GONE
+                notificationIconView.visibility = View.VISIBLE
+            }
+            null -> {
+                highlightView.visibility = View.GONE
+                notificationIconView.visibility = View.GONE
+            }
+        }
+    }
+
+    /**
+     * Sets the tint of the 3-dot menu icon.
+     */
+    override fun setColorFilter(@ColorInt color: Int) = menuIcon.setColorFilter(color)
+}
diff --git a/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/view/MenuView.kt b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/view/MenuView.kt
new file mode 100644
index 000000000000..e53d0dd3fc5c
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/java/mozilla/components/browser/menu2/view/MenuView.kt
@@ -0,0 +1,74 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2.view
+
+import android.content.Context
+import android.os.Build
+import android.os.Build.VERSION.SDK_INT
+import android.util.AttributeSet
+import android.view.LayoutInflater
+import android.view.View
+import android.widget.FrameLayout
+import androidx.annotation.VisibleForTesting
+import androidx.recyclerview.widget.LinearLayoutManager
+import androidx.recyclerview.widget.RecyclerView
+import mozilla.components.browser.menu2.R
+import mozilla.components.browser.menu2.adapter.MenuCandidateListAdapter
+import mozilla.components.concept.menu.Side
+import mozilla.components.concept.menu.candidate.MenuCandidate
+import mozilla.components.support.ktx.android.view.onNextGlobalLayout
+
+/**
+ * A popup menu composed of [MenuCandidate] objects.
+ */
+class MenuView @JvmOverloads constructor(
+    context: Context,
+    attrs: AttributeSet? = null,
+    defStyleAttr: Int = 0
+) : FrameLayout(context, attrs, defStyleAttr) {
+
+    private val layoutManager = LinearLayoutManager(context, RecyclerView.VERTICAL, false)
+    private val menuAdapter = MenuCandidateListAdapter(LayoutInflater.from(context)) { onDismiss() }
+    private val recyclerView: RecyclerView
+
+    /**
+     * Called when the menu is clicked and should be dismissed.
+     */
+    var onDismiss: () -> Unit = {}
+
+    init {
+        View.inflate(context, R.layout.mozac_browser_menu2_view, this)
+
+        recyclerView = findViewById(R.id.mozac_browser_menu_recyclerView)
+        recyclerView.layoutManager = layoutManager
+        recyclerView.adapter = menuAdapter
+    }
+
+    /**
+     * Changes the contents of the menu.
+     */
+    fun submitList(list: List<MenuCandidate>) = menuAdapter.submitList(list)
+
+    /**
+     * Displays either the start or the end of the list.
+     */
+    fun setVisibleSide(side: Side) {
+        if (SDK_INT >= Build.VERSION_CODES.N) {
+            layoutManager.stackFromEnd = side == Side.END
+        } else {
+            // In devices with Android 6 and below stackFromEnd is not working properly,
+            // as a result, we have to provided a backwards support.
+            // See: https://github.com/mozilla-mobile/android-components/issues/3211
+            if (side == Side.END) scrollOnceToTheBottom(recyclerView)
+        }
+    }
+
+    @VisibleForTesting
+    internal fun scrollOnceToTheBottom(recyclerView: RecyclerView) {
+        recyclerView.onNextGlobalLayout {
+            recyclerView.adapter?.let { recyclerView.scrollToPosition(it.itemCount - 1) }
+        }
+    }
+}
diff --git a/android-components/components/browser/menu2/src/main/res/anim-ldrtl/menu_enter_bottom.xml b/android-components/components/browser/menu2/src/main/res/anim-ldrtl/menu_enter_bottom.xml
new file mode 100644
index 000000000000..6d27c410ead6
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/res/anim-ldrtl/menu_enter_bottom.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<set xmlns:android="http://schemas.android.com/apk/res/android">
+    <scale android:interpolator="@android:anim/accelerate_decelerate_interpolator"
+        android:fromXScale="0"
+        android:toXScale="1"
+        android:fromYScale="0"
+        android:toYScale="1"
+        android:pivotX="5%"
+        android:pivotY="100%"
+        android:duration="@android:integer/config_shortAnimTime" />
+    <alpha android:interpolator="@android:anim/linear_interpolator"
+        android:fromAlpha="0"
+        android:toAlpha="1"
+        android:duration="@android:integer/config_shortAnimTime" />
+    <translate android:interpolator="@android:anim/accelerate_decelerate_interpolator"
+        android:fromYDelta="0"
+        android:toYDelta="0"
+        android:duration="@android:integer/config_shortAnimTime" />
+</set>
diff --git a/android-components/components/browser/menu2/src/main/res/anim-ldrtl/menu_enter_top.xml b/android-components/components/browser/menu2/src/main/res/anim-ldrtl/menu_enter_top.xml
new file mode 100644
index 000000000000..fc141bdbd048
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/res/anim-ldrtl/menu_enter_top.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<set xmlns:android="http://schemas.android.com/apk/res/android">
+    <scale android:interpolator="@android:anim/accelerate_decelerate_interpolator"
+        android:fromXScale="0"
+        android:toXScale="1"
+        android:fromYScale="0"
+        android:toYScale="1"
+        android:pivotX="5%"
+        android:pivotY="5%"
+        android:duration="@android:integer/config_shortAnimTime" />
+    <alpha android:interpolator="@android:anim/linear_interpolator"
+        android:fromAlpha="0"
+        android:toAlpha="1"
+        android:duration="@android:integer/config_shortAnimTime" />
+    <translate android:interpolator="@android:anim/accelerate_decelerate_interpolator"
+        android:fromYDelta="0"
+        android:toYDelta="0"
+        android:duration="@android:integer/config_shortAnimTime" />
+</set>
diff --git a/android-components/components/browser/menu2/src/main/res/layout/mozac_browser_menu2_button.xml b/android-components/components/browser/menu2/src/main/res/layout/mozac_browser_menu2_button.xml
new file mode 100644
index 000000000000..a4d5523b7b88
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/res/layout/mozac_browser_menu2_button.xml
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<merge xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:layout_height="match_parent"
+    android:layout_width="match_parent"
+    android:clickable="true"
+    android:focusable="true"
+    android:background="?android:selectableItemBackgroundBorderless"
+    tools:parentTag="android.widget.FrameLayout">
+
+    <androidx.appcompat.widget.AppCompatImageView
+        android:id="@+id/highlight"
+        app:srcCompat="@drawable/mozac_browser_menu2_indicator"
+        android:layout_height="match_parent"
+        android:layout_width="match_parent"
+        android:scaleType="center"
+        android:contentDescription="@string/mozac_browser_menu2_highlighted"
+        android:visibility="gone" />
+    <androidx.appcompat.widget.AppCompatImageView
+        android:id="@+id/icon"
+        app:srcCompat="@drawable/mozac_ic_menu"
+        android:layout_height="match_parent"
+        android:layout_width="match_parent"
+        android:scaleType="center"
+        android:contentDescription="@string/mozac_browser_menu2_button" />
+    <androidx.appcompat.widget.AppCompatImageView
+        android:id="@+id/notification_dot"
+        app:srcCompat="@drawable/mozac_browser_menu2_notification"
+        android:layout_height="match_parent"
+        android:layout_width="match_parent"
+        android:scaleType="center"
+        android:contentDescription="@string/mozac_browser_menu2_highlighted"
+        android:visibility="gone" />
+
+</merge>
diff --git a/android-components/components/browser/menu2/src/main/res/layout/mozac_browser_menu2_view.xml b/android-components/components/browser/menu2/src/main/res/layout/mozac_browser_menu2_view.xml
new file mode 100644
index 000000000000..e624bd88f3e1
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/res/layout/mozac_browser_menu2_view.xml
@@ -0,0 +1,29 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<merge xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    xmlns:tools="http://schemas.android.com/tools"
+    tools:parentTag="FrameLayout"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content">
+
+    <androidx.cardview.widget.CardView
+        style="@style/Mozac.Browser.Menu2"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        app:cardCornerRadius="@dimen/mozac_browser_menu2_corner_radius"
+        app:cardElevation="@dimen/mozac_browser_menu2_elevation"
+        app:cardUseCompatPadding="true">
+
+        <androidx.recyclerview.widget.RecyclerView
+            android:id="@+id/mozac_browser_menu_recyclerView"
+            android:paddingTop="@dimen/mozac_browser_menu2_padding_vertical"
+            android:paddingBottom="@dimen/mozac_browser_menu2_padding_vertical"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            tools:listitem="@layout/mozac_browser_menu2_candidate_text" />
+
+    </androidx.cardview.widget.CardView>
+</merge>
diff --git a/android-components/components/browser/menu2/src/main/res/values/colors.xml b/android-components/components/browser/menu2/src/main/res/values/colors.xml
new file mode 100644
index 000000000000..a77289bfe303
--- /dev/null
+++ b/android-components/components/browser/menu2/src/main/res/values/colors.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<resources>
+    <!-- Empty by default, allows others to theme as they see fit -->
+    <color name="mozac_browser_menu2_background"></color>
+</resources>
diff --git a/android-components/components/browser/menu2/src/main/res/values/style.xml b/android-components/components/browser/menu2/src/main/res/values/style.xml
index deb23fafa0c3..2cf73cfe7d85 100644
--- a/android-components/components/browser/menu2/src/main/res/values/style.xml
+++ b/android-components/components/browser/menu2/src/main/res/values/style.xml
@@ -4,6 +4,10 @@
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 <resources>
 
+    <style name="Mozac.Browser.Menu2" parent="">
+        <item name="cardBackgroundColor">@color/mozac_browser_menu2_background</item>
+    </style>
+
     <!-- Item Divider -->
     <style name="Mozac.Browser.Menu2.Candidate.Divider" parent="">
         <item name="android:background">?android:attr/listDivider</item>
diff --git a/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/BrowserMenuControllerTest.kt b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/BrowserMenuControllerTest.kt
new file mode 100644
index 000000000000..5f14a1ea00dd
--- /dev/null
+++ b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/BrowserMenuControllerTest.kt
@@ -0,0 +1,115 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2
+
+import android.view.Gravity
+import android.view.View
+import android.widget.Button
+import androidx.coordinatorlayout.widget.CoordinatorLayout
+import androidx.test.ext.junit.runners.AndroidJUnit4
+import mozilla.components.concept.menu.MenuController
+import mozilla.components.concept.menu.Orientation
+import mozilla.components.concept.menu.candidate.DecorativeTextMenuCandidate
+import mozilla.components.concept.menu.candidate.MenuCandidate
+import mozilla.components.support.test.mock
+import mozilla.components.support.test.robolectric.testContext
+import org.junit.Assert.assertEquals
+import org.junit.Assert.assertFalse
+import org.junit.Assert.assertNull
+import org.junit.Assert.assertTrue
+import org.junit.Test
+import org.junit.runner.RunWith
+
+@RunWith(AndroidJUnit4::class)
+class BrowserMenuControllerTest {
+
+    @Test
+    fun `created popup window is displayed automatically`() {
+        val menu: MenuController = BrowserMenuController()
+
+        val anchor = Button(testContext)
+        val popup = menu.show(anchor)
+
+        assertTrue(popup.isShowing)
+    }
+
+    @Test
+    fun `observer is notified when submitList is called`() {
+        var submitted: List<MenuCandidate>? = null
+        val menu: MenuController = BrowserMenuController()
+        menu.register(object : MenuController.Observer {
+            override fun onMenuListSubmit(list: List<MenuCandidate>) {
+                submitted = list
+            }
+
+            override fun onDismiss() = Unit
+        })
+
+        assertNull(submitted)
+
+        menu.submitList(listOf(DecorativeTextMenuCandidate("Hello")))
+        assertEquals(listOf(DecorativeTextMenuCandidate("Hello")), submitted)
+    }
+
+    @Test
+    fun `dismissing the browser menu will dismiss the popup`() {
+        var dismissed = false
+        val menu: MenuController = BrowserMenuController()
+        menu.register(object : MenuController.Observer {
+            override fun onDismiss() {
+                dismissed = true
+            }
+
+            override fun onMenuListSubmit(list: List<MenuCandidate>) = Unit
+        })
+
+        val anchor = Button(testContext)
+        val popup = menu.show(anchor)
+
+        assertTrue(popup.isShowing)
+        assertFalse(dismissed)
+
+        menu.dismiss()
+
+        assertFalse(popup.isShowing)
+        assertTrue(dismissed)
+    }
+
+    @Test
+    fun `determineMenuOrientation returns Orientation-DOWN by default`() {
+        assertEquals(
+            Orientation.DOWN,
+            determineMenuOrientation(mock())
+        )
+    }
+
+    @Test
+    fun `determineMenuOrientation returns Orientation-UP for views with bottom gravity in CoordinatorLayout`() {
+        val params = CoordinatorLayout.LayoutParams(100, 100)
+        params.gravity = Gravity.BOTTOM
+
+        val view = View(testContext)
+        view.layoutParams = params
+
+        assertEquals(
+            Orientation.UP,
+            determineMenuOrientation(view)
+        )
+    }
+
+    @Test
+    fun `determineMenuOrientation returns Orientation-DOWN for views with top gravity in CoordinatorLayout`() {
+        val params = CoordinatorLayout.LayoutParams(100, 100)
+        params.gravity = Gravity.TOP
+
+        val view = View(testContext)
+        view.layoutParams = params
+
+        assertEquals(
+            Orientation.DOWN,
+            determineMenuOrientation(view)
+        )
+    }
+}
diff --git a/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/MenuControllerTest.kt b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/MenuControllerTest.kt
deleted file mode 100644
index d57fa77146d4..000000000000
--- a/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/MenuControllerTest.kt
+++ /dev/null
@@ -1,16 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package mozilla.components.browser.menu2
-
-import mozilla.components.concept.menu.Side
-import org.junit.Test
-
-class MenuControllerTest {
-
-    @Test
-    fun `can construct without errors`() {
-        MenuController(Side.END)
-    }
-}
diff --git a/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/ext/PopupWindowTest.kt b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/ext/PopupWindowTest.kt
new file mode 100644
index 000000000000..95256a26826d
--- /dev/null
+++ b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/ext/PopupWindowTest.kt
@@ -0,0 +1,153 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2.ext
+
+import android.view.Gravity
+import android.view.View
+import android.widget.PopupWindow
+import androidx.test.ext.junit.runners.AndroidJUnit4
+import mozilla.components.browser.menu2.R
+import mozilla.components.concept.menu.Orientation
+import mozilla.components.support.test.any
+import mozilla.components.support.test.robolectric.testContext
+import org.junit.Assert.assertEquals
+import org.junit.Test
+import org.junit.runner.RunWith
+import org.mockito.Mockito.doAnswer
+import org.mockito.Mockito.doReturn
+import org.mockito.Mockito.spy
+import org.mockito.Mockito.verify
+import org.robolectric.Shadows
+import org.robolectric.shadows.ShadowDisplay
+
+@RunWith(AndroidJUnit4::class)
+class PopupWindowTest {
+
+    @Test
+    fun `displayPopup that fitsDown with preferredOrientation DOWN`() {
+        val menuContentView = createMockViewWith(y = 0)
+        val anchor = createMockViewWith(y = 10)
+        val popupWindow = spy(PopupWindow())
+
+        // Makes the availableHeightToBottom bigger than the menuContentView
+        setScreenHeight(200)
+        doReturn(11).`when`(menuContentView).measuredHeight
+        doReturn(-10).`when`(anchor).height
+
+        popupWindow.displayPopup(menuContentView, anchor, Orientation.DOWN)
+
+        assertEquals(popupWindow.animationStyle, R.style.Mozac_Browser_Menu2_Animation_OverflowMenuTop)
+        verify(popupWindow).showAsDropDown(anchor, 0, 10)
+    }
+
+    @Test
+    fun `displayPopup that fitsDown with preferredOrientation UP`() {
+        val menuContentView = createMockViewWith(y = 0)
+        val anchor = createMockViewWith(y = 10)
+        val popupWindow = spy(PopupWindow())
+
+        // Makes the availableHeightToBottom bigger than the menuContentView
+        setScreenHeight(200)
+        doReturn(11).`when`(menuContentView).measuredHeight
+        doReturn(-10).`when`(anchor).height
+
+        popupWindow.displayPopup(menuContentView, anchor, Orientation.UP)
+
+        assertEquals(popupWindow.animationStyle, R.style.Mozac_Browser_Menu2_Animation_OverflowMenuTop)
+        verify(popupWindow).showAsDropDown(anchor, 0, 10)
+    }
+
+    @Test
+    fun `displayPopup that fitsUp with preferredOrientation UP`() {
+        val containerView = createMockViewWith(y = 0)
+        // Makes the availableHeightToTop 10
+        val anchor = createMockViewWith(y = 10)
+        val popupWindow = spy(PopupWindow())
+
+        // Makes the availableHeightToBottom smaller than the availableHeightToTop
+        setScreenHeight(0)
+        doReturn(-10).`when`(anchor).height
+
+        // Makes the content of the menu smaller than the availableHeightToTop
+        doReturn(9).`when`(containerView).measuredHeight
+
+        popupWindow.displayPopup(containerView, anchor, Orientation.UP)
+
+        assertEquals(popupWindow.animationStyle, R.style.Mozac_Browser_Menu2_Animation_OverflowMenuBottom)
+        verify(popupWindow).showAsDropDown(anchor, 0, -9)
+    }
+
+    @Test
+    fun `displayPopup that fitsUp with preferredOrientation DOWN`() {
+        val containerView = createMockViewWith(y = 0)
+        // Makes the availableHeightToTop 10
+        val anchor = createMockViewWith(y = 10)
+        val popupWindow = spy(PopupWindow())
+        val contentHeight = 9
+
+        // Makes the availableHeightToBottom smaller than the availableHeightToTop
+        setScreenHeight(0)
+        doReturn(-10).`when`(anchor).height
+
+        // Makes the content of the menu smaller than the availableHeightToTop
+        doReturn(contentHeight).`when`(containerView).measuredHeight
+
+        popupWindow.displayPopup(containerView, anchor, Orientation.DOWN)
+
+        assertEquals(popupWindow.animationStyle, R.style.Mozac_Browser_Menu2_Animation_OverflowMenuBottom)
+        verify(popupWindow).showAsDropDown(anchor, 0, -contentHeight)
+    }
+
+    @Test
+    fun `displayPopup that fitsUp when anchor is partially below of the bottom of the screen`() {
+        val containerView = createMockViewWith(y = 0)
+        // Makes the availableHeightToTop 10
+        val anchor = createMockViewWith(y = 10)
+        val popupWindow = spy(PopupWindow())
+        val screenHeight = -1
+        val contentHeight = -9
+
+        // Makes the availableHeightToBottom smaller than the availableHeightToTop
+        setScreenHeight(screenHeight)
+        doReturn(-10).`when`(anchor).height
+
+        // Makes the content of the menu smaller than the availableHeightToTop
+        doReturn(contentHeight).`when`(containerView).measuredHeight
+
+        popupWindow.displayPopup(containerView, anchor, Orientation.UP)
+
+        assertEquals(popupWindow.animationStyle, R.style.Mozac_Browser_Menu2_Animation_OverflowMenuBottom)
+        verify(popupWindow).showAsDropDown(anchor, 0, screenHeight - contentHeight)
+    }
+
+    @Test
+    fun `displayPopup that don't fitUp neither fitDown`() {
+        val containerView = createMockViewWith(y = 0)
+        val anchor = createMockViewWith(y = 0)
+        val popupWindow = spy(PopupWindow())
+        doReturn(Int.MAX_VALUE).`when`(containerView).measuredHeight
+
+        popupWindow.displayPopup(containerView, anchor, Orientation.DOWN)
+        assertEquals(popupWindow.animationStyle, -1)
+        verify(popupWindow).showAtLocation(anchor, Gravity.START or Gravity.TOP, 0, 0)
+    }
+
+    private fun createMockViewWith(y: Int): View {
+        val view = spy(View(testContext))
+        doAnswer { invocation ->
+            val locationInWindow = (invocation.getArgument(0) as IntArray)
+            locationInWindow[0] = 0
+            locationInWindow[1] = y
+            locationInWindow
+        }.`when`(view).getLocationInWindow(any())
+        return view
+    }
+
+    private fun setScreenHeight(value: Int) {
+        val display = ShadowDisplay.getDefaultDisplay()
+        val shadow = Shadows.shadowOf(display)
+        shadow.setHeight(value)
+    }
+}
diff --git a/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/view/MenuButton2Test.kt b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/view/MenuButton2Test.kt
new file mode 100644
index 000000000000..eab104f2cdb0
--- /dev/null
+++ b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/view/MenuButton2Test.kt
@@ -0,0 +1,120 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2.view
+
+import android.content.res.ColorStateList
+import android.graphics.Color
+import android.graphics.PorterDuff
+import android.graphics.PorterDuffColorFilter
+import android.widget.ImageView
+import androidx.appcompat.widget.AppCompatImageView
+import androidx.core.view.children
+import androidx.core.view.isVisible
+import androidx.test.ext.junit.runners.AndroidJUnit4
+import mozilla.components.concept.menu.MenuController
+import mozilla.components.concept.menu.candidate.HighPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.LowPriorityHighlightEffect
+import mozilla.components.support.test.any
+import mozilla.components.support.test.eq
+import mozilla.components.support.test.mock
+import mozilla.components.support.test.robolectric.testContext
+import org.junit.Assert.assertEquals
+import org.junit.Assert.assertFalse
+import org.junit.Assert.assertNotNull
+import org.junit.Assert.assertNull
+import org.junit.Assert.assertTrue
+import org.junit.Before
+import org.junit.Test
+import org.junit.runner.RunWith
+import org.mockito.Mockito.verify
+
+@RunWith(AndroidJUnit4::class)
+class MenuButton2Test {
+    private lateinit var menuController: MenuController
+    private lateinit var menuButton: MenuButton2
+    private lateinit var menuIcon: ImageView
+    private lateinit var highlightView: ImageView
+    private lateinit var notificationIconView: ImageView
+
+    @Before
+    fun setup() {
+        menuController = mock()
+        menuButton = MenuButton2(testContext)
+
+        val images = menuButton.children.mapNotNull { it as? AppCompatImageView }.toList()
+        highlightView = images[0]
+        menuIcon = images[1]
+        notificationIconView = images[2]
+    }
+
+    @Test
+    fun `changing menu controller dismisses old menu`() {
+        menuButton.menuController = menuController
+        menuButton.performClick()
+
+        verify(menuController).register(any(), eq(menuButton))
+        verify(menuController).show(menuButton)
+
+        menuButton.menuController = mock()
+        verify(menuController).dismiss()
+        verify(menuController).unregister(any())
+    }
+
+    @Test
+    fun `changing menu controller to null dismisses old menu`() {
+        menuButton.menuController = menuController
+        menuButton.performClick()
+
+        verify(menuController).register(any(), eq(menuButton))
+
+        menuButton.menuController = null
+        verify(menuController).dismiss()
+        verify(menuController).unregister(any())
+    }
+
+    @Test
+    fun `icon has content description`() {
+        assertEquals("Menu", menuIcon.contentDescription)
+        assertNotNull(menuIcon.drawable)
+    }
+
+    @Test
+    fun `icon color filter can be changed`() {
+        assertNull(menuIcon.colorFilter)
+
+        menuButton.setColorFilter(0xffffff)
+        assertEquals(PorterDuffColorFilter(0xffffff, PorterDuff.Mode.SRC_ATOP), menuIcon.colorFilter)
+    }
+
+    @Test
+    fun `icon displays high priority highlight`() {
+        assertFalse(highlightView.isVisible)
+        assertFalse(notificationIconView.isVisible)
+
+        menuButton.setEffect(
+            HighPriorityHighlightEffect(Color.RED)
+        )
+
+        assertTrue(highlightView.isVisible)
+        assertFalse(notificationIconView.isVisible)
+
+        assertEquals(ColorStateList.valueOf(Color.RED), highlightView.imageTintList)
+    }
+
+    @Test
+    fun `icon displays low priority highlight`() {
+        assertFalse(highlightView.isVisible)
+        assertFalse(notificationIconView.isVisible)
+
+        menuButton.setEffect(
+            LowPriorityHighlightEffect(Color.BLUE)
+        )
+
+        assertFalse(highlightView.isVisible)
+        assertTrue(notificationIconView.isVisible)
+
+        assertEquals(PorterDuffColorFilter(Color.BLUE, PorterDuff.Mode.SRC_ATOP), notificationIconView.colorFilter)
+    }
+}
diff --git a/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/view/MenuViewTest.kt b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/view/MenuViewTest.kt
new file mode 100644
index 000000000000..22d690d5a3bf
--- /dev/null
+++ b/android-components/components/browser/menu2/src/test/java/mozilla/components/browser/menu2/view/MenuViewTest.kt
@@ -0,0 +1,80 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.browser.menu2.view
+
+import android.os.Build
+import androidx.recyclerview.widget.LinearLayoutManager
+import androidx.recyclerview.widget.RecyclerView
+import androidx.test.ext.junit.runners.AndroidJUnit4
+import mozilla.components.browser.menu2.R
+import mozilla.components.concept.menu.Side
+import mozilla.components.concept.menu.candidate.DecorativeTextMenuCandidate
+import mozilla.components.support.test.any
+import mozilla.components.support.test.robolectric.testContext
+import org.junit.Assert.assertEquals
+import org.junit.Assert.assertFalse
+import org.junit.Assert.assertNotNull
+import org.junit.Assert.assertTrue
+import org.junit.Before
+import org.junit.Test
+import org.junit.runner.RunWith
+import org.mockito.Mockito.doNothing
+import org.mockito.Mockito.never
+import org.mockito.Mockito.spy
+import org.mockito.Mockito.verify
+import org.robolectric.annotation.Config
+
+@RunWith(AndroidJUnit4::class)
+class MenuViewTest {
+
+    private val items = listOf(
+        DecorativeTextMenuCandidate("Hello"),
+        DecorativeTextMenuCandidate("World")
+    )
+    private lateinit var menuView: MenuView
+    private lateinit var recyclerView: RecyclerView
+
+    @Before
+    fun setup() {
+        menuView = spy(MenuView(testContext))
+        recyclerView = menuView.findViewById(R.id.mozac_browser_menu_recyclerView)
+    }
+
+    @Test
+    fun `recyclerview adapter will have items for every menu item`() {
+        assertNotNull(recyclerView)
+
+        val recyclerAdapter = recyclerView.adapter!!
+        assertNotNull(recyclerAdapter)
+        assertEquals(0, recyclerAdapter.itemCount)
+
+        menuView.submitList(items)
+        assertEquals(2, recyclerAdapter.itemCount)
+    }
+
+    @Test
+    @Config(sdk = [Build.VERSION_CODES.M])
+    fun `setVisibleSide will be forwarded to scrollOnceToTheBottom on devices with Android M and below`() {
+        doNothing().`when`(menuView).scrollOnceToTheBottom(any())
+
+        menuView.setVisibleSide(Side.END)
+        val layoutManager = recyclerView.layoutManager as LinearLayoutManager
+
+        assertFalse(layoutManager.stackFromEnd)
+        verify(menuView).scrollOnceToTheBottom(any())
+    }
+
+    @Test
+    @Config(sdk = [Build.VERSION_CODES.N])
+    fun `setVisibleSide changes stackFromEnd on devices with Android N and above`() {
+        doNothing().`when`(menuView).scrollOnceToTheBottom(any())
+
+        menuView.setVisibleSide(Side.END)
+        val layoutManager = recyclerView.layoutManager as LinearLayoutManager
+
+        assertTrue(layoutManager.stackFromEnd)
+        verify(menuView, never()).scrollOnceToTheBottom(any())
+    }
+}
diff --git a/android-components/components/browser/toolbar/build.gradle b/android-components/components/browser/toolbar/build.gradle
index 2fcf7da6a2ac..1a4fd7d85f4c 100644
--- a/android-components/components/browser/toolbar/build.gradle
+++ b/android-components/components/browser/toolbar/build.gradle
@@ -27,7 +27,9 @@ dependencies {
     api project(':support-base')
 
     implementation project(':concept-engine')
+    implementation project(':concept-menu')
     implementation project(':browser-menu')
+    implementation project(':browser-menu2')
     implementation project(':ui-icons')
     implementation project(':ui-colors')
     implementation project(':support-ktx')
diff --git a/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/DisplayToolbar.kt b/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/DisplayToolbar.kt
index 27971b23c76e..4c0e1fae6cef 100644
--- a/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/DisplayToolbar.kt
+++ b/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/DisplayToolbar.kt
@@ -24,6 +24,7 @@ import mozilla.components.browser.menu.BrowserMenuBuilder
 import mozilla.components.browser.toolbar.BrowserToolbar
 import mozilla.components.browser.toolbar.R
 import mozilla.components.browser.toolbar.internal.ActionContainer
+import mozilla.components.concept.menu.MenuController
 import mozilla.components.concept.toolbar.Toolbar
 
 /**
@@ -373,8 +374,8 @@ class DisplayToolbar internal constructor(
         }
 
     /**
-     * Sets a BrowserMenuBuilder that will be used to create a menu when the menu button is clicked.
-     * The menu button will only be visible if a builder has been set.
+     * Sets a [BrowserMenuBuilder] that will be used to create a menu when the menu button is clicked.
+     * The menu button will only be visible if a builder or controller has been set.
      */
     var menuBuilder: BrowserMenuBuilder?
         get() = views.menu.menuBuilder
@@ -382,6 +383,17 @@ class DisplayToolbar internal constructor(
             views.menu.menuBuilder = value
         }
 
+    /**
+     * Sets a [MenuController] that will be used to create a menu when the menu button is clicked.
+     * The menu button will only be visible if a builder or controller has been set.
+     * If both a [menuBuilder] and controller are present, only the controller will be used.
+     */
+    var menuController: MenuController?
+        get() = views.menu.menuController
+        set(value) {
+            views.menu.menuController = value
+        }
+
     /**
      * Set a LongClickListener to the urlView of the toolbar.
      */
diff --git a/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/MenuButton.kt b/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/MenuButton.kt
index 81a5a8606772..fe2ba111fe31 100644
--- a/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/MenuButton.kt
+++ b/android-components/components/browser/toolbar/src/main/java/mozilla/components/browser/toolbar/display/MenuButton.kt
@@ -8,45 +8,88 @@ import androidx.annotation.ColorInt
 import androidx.annotation.VisibleForTesting
 import androidx.core.view.isVisible
 import mozilla.components.browser.menu.BrowserMenuBuilder
+import mozilla.components.browser.menu.ext.asCandidateList
 import mozilla.components.browser.menu.ext.getHighlight
 import mozilla.components.browser.toolbar.facts.emitOpenMenuFact
+import mozilla.components.concept.menu.MenuController
 
 internal class MenuButton(
-    @VisibleForTesting
-    internal val impl: mozilla.components.browser.menu.view.MenuButton
+    @VisibleForTesting internal val impl: mozilla.components.browser.menu.view.MenuButton
 ) {
 
     init {
         impl.isVisible = false
-        impl.onShow = {
-            emitOpenMenuFact(impl.menuBuilder?.extras)
-        }
+        impl.register(object : mozilla.components.concept.menu.MenuButton.Observer {
+            override fun onShow() {
+                emitOpenMenuFact(impl.menuBuilder?.extras)
+            }
+        })
     }
 
+    /**
+     * Reference to the [MenuController].
+     * If present, [menuBuilder] will be ignored.
+     */
+    var menuController: MenuController?
+        get() = impl.menuController
+        set(value) {
+            impl.menuController = value
+            impl.isVisible = shouldBeVisible()
+        }
+
+    /**
+     * Legacy [BrowserMenuBuilder] reference.
+     * Used to build the menu.
+     */
     var menuBuilder: BrowserMenuBuilder?
         get() = impl.menuBuilder
         set(value) {
             impl.menuBuilder = value
-            impl.isVisible = value != null
+            impl.isVisible = shouldBeVisible()
         }
 
     /**
      * Declare that the menu items should be updated if needed.
+     * This should only be used once a [menuBuilder] is set.
+     * To update items in the [menuController], call [MenuController.submitList] directly.
      */
-    @Suppress("Deprecation")
     fun invalidateMenu() {
-        impl.invalidateBrowserMenu()
-        impl.setHighlight(menuBuilder?.items?.getHighlight())
+        val menuController = menuController
+        if (menuController != null) {
+            // Convert the menu builder items into a menu candidate list,
+            // if the menu builder is present
+            menuBuilder?.items?.let { items ->
+                val list = items.asCandidateList(impl.context)
+                menuController.submitList(list)
+            }
+        } else {
+            // Invalidate the BrowserMenu
+            impl.invalidateBrowserMenu()
+            impl.setHighlight(menuBuilder?.items?.getHighlight())
+        }
     }
 
-    fun dismissMenu() = impl.dismissMenu()
+    fun dismissMenu() {
+        val menuController = menuController
+        if (menuController != null) {
+            // Use the controller to dismiss the menu
+            menuController.dismiss()
+        } else {
+            // Use the button to dismiss the legacy menu
+            impl.dismissMenu()
+        }
+    }
 
     /**
      * Sets a lambda to be invoked when the menu is dismissed
      */
+    @Suppress("Deprecation")
     fun setMenuDismissAction(onDismiss: () -> Unit) {
         impl.onDismiss = onDismiss
     }
 
     fun setColorFilter(@ColorInt color: Int) = impl.setColorFilter(color)
+
+    @VisibleForTesting
+    internal fun shouldBeVisible() = impl.menuBuilder != null || impl.menuController != null
 }
diff --git a/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/DisplayToolbarTest.kt b/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/DisplayToolbarTest.kt
index 34758021b5fb..dd2a7c480101 100644
--- a/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/DisplayToolbarTest.kt
+++ b/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/DisplayToolbarTest.kt
@@ -15,6 +15,7 @@ import mozilla.components.browser.menu.BrowserMenuBuilder
 import mozilla.components.browser.menu.item.SimpleBrowserMenuItem
 import mozilla.components.browser.toolbar.BrowserToolbar
 import mozilla.components.browser.toolbar.R
+import mozilla.components.concept.menu.MenuButton
 import mozilla.components.concept.toolbar.Toolbar.SiteSecurity
 import mozilla.components.concept.toolbar.Toolbar.SiteTrackingProtection
 import mozilla.components.support.base.Component
@@ -677,7 +678,11 @@ class DisplayToolbarTest {
         var wasDismissed = false
         val (_, displayToolbar) = createDisplayToolbar()
         val menuView = displayToolbar.views.menu
-        menuView.impl.onDismiss = { wasDismissed = true }
+        menuView.impl.register(object : MenuButton.Observer {
+            override fun onDismiss() {
+                wasDismissed = true
+            }
+        })
         menuView.menuBuilder = BrowserMenuBuilder(emptyList())
         menuView.impl.performClick()
 
diff --git a/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/MenuButtonTest.kt b/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/MenuButtonTest.kt
index 26d471b207c8..1fc8d318e8a8 100644
--- a/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/MenuButtonTest.kt
+++ b/android-components/components/browser/toolbar/src/test/java/mozilla/components/browser/toolbar/display/MenuButtonTest.kt
@@ -17,13 +17,14 @@ import mozilla.components.support.test.mock
 import mozilla.components.support.test.robolectric.testContext
 import mozilla.components.support.test.whenever
 import org.junit.Assert.assertEquals
+import org.junit.Assert.assertFalse
+import org.junit.Assert.assertTrue
 import org.junit.Before
 import org.junit.Test
 import org.junit.runner.RunWith
 import org.mockito.Mockito.doReturn
 import org.mockito.Mockito.never
 import org.mockito.Mockito.spy
-import org.mockito.Mockito.times
 import org.mockito.Mockito.verify
 
 @RunWith(AndroidJUnit4::class)
@@ -47,13 +48,14 @@ class MenuButtonTest {
     fun `menu button is visible only if menu builder attached`() {
         verify(menuButtonInternal).visibility = View.GONE
 
-        menuButton.menuBuilder = mock()
-        verify(menuButtonInternal).visibility = View.VISIBLE
+        doReturn(mock<BrowserMenuBuilder>()).`when`(menuButtonInternal).menuBuilder
+        assertTrue(menuButton.shouldBeVisible())
 
-        menuButton.menuBuilder = null
-        verify(menuButtonInternal, times(2)).visibility = View.GONE
+        doReturn(null).`when`(menuButtonInternal).menuBuilder
+        assertFalse(menuButton.shouldBeVisible())
     }
 
+    @Suppress("Deprecation")
     @Test
     fun `menu button sets onDismiss action`() {
         val action = {}
diff --git a/android-components/components/concept/menu/build.gradle b/android-components/components/concept/menu/build.gradle
index 159b497ae6d9..14e1e65acc8d 100644
--- a/android-components/components/concept/menu/build.gradle
+++ b/android-components/components/concept/menu/build.gradle
@@ -26,6 +26,7 @@ dependencies {
 
     implementation Dependencies.androidx_annotation
     implementation Dependencies.androidx_appcompat
+    implementation project(':support-base')
     implementation project(':support-ktx')
 
     testImplementation Dependencies.androidx_test_junit
diff --git a/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/MenuButton.kt b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/MenuButton.kt
new file mode 100644
index 000000000000..c59f25cb7029
--- /dev/null
+++ b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/MenuButton.kt
@@ -0,0 +1,47 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.concept.menu
+
+import androidx.annotation.ColorInt
+import mozilla.components.concept.menu.candidate.MenuEffect
+import mozilla.components.support.base.observer.Observable
+
+/**
+ * A `three-dot` button used for expanding menus.
+ *
+ * If you are using a browser toolbar, do not use this class directly.
+ */
+interface MenuButton : Observable<MenuButton.Observer> {
+
+    /**
+     * Sets a [MenuController] that will be used to create a menu when this button is clicked.
+     */
+    var menuController: MenuController?
+
+    /**
+     * Show the indicator for a browser menu effect.
+     */
+    fun setEffect(effect: MenuEffect?)
+
+    /**
+     * Sets the tint of the 3-dot menu icon.
+     */
+    fun setColorFilter(@ColorInt color: Int)
+
+    /**
+     * Observer for the menu button.
+     */
+    interface Observer {
+        /**
+         * Listener called when the menu is shown.
+         */
+        fun onShow() = Unit
+
+        /**
+         * Listener called when the menu is dismissed.
+         */
+        fun onDismiss() = Unit
+    }
+}
diff --git a/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/MenuController.kt b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/MenuController.kt
new file mode 100644
index 000000000000..9a2b6f5014e2
--- /dev/null
+++ b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/MenuController.kt
@@ -0,0 +1,46 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.concept.menu
+
+import android.view.View
+import android.widget.PopupWindow
+import mozilla.components.concept.menu.candidate.MenuCandidate
+import mozilla.components.support.base.observer.Observable
+
+/**
+ * Controls a popup menu composed of MenuCandidate objects.
+ */
+interface MenuController : Observable<MenuController.Observer> {
+
+    /**
+     * @param anchor The view on which to pin the popup window.
+     */
+    fun show(anchor: View): PopupWindow
+
+    /**
+     * Dismiss the menu popup if the menu is visible.
+     */
+    fun dismiss()
+
+    /**
+     * Changes the contents of the menu.
+     */
+    fun submitList(list: List<MenuCandidate>)
+
+    /**
+     * Observer for the menu controller.
+     */
+    interface Observer {
+        /**
+         * Called when the menu contents have changed.
+         */
+        fun onMenuListSubmit(list: List<MenuCandidate>) = Unit
+
+        /**
+         * Called when the menu has been dismissed.
+         */
+        fun onDismiss() = Unit
+    }
+}
diff --git a/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/Orientation.kt b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/Orientation.kt
new file mode 100644
index 000000000000..8d86f031739d
--- /dev/null
+++ b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/Orientation.kt
@@ -0,0 +1,36 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.concept.menu
+
+import android.view.Gravity
+
+/**
+ * Indicates the preferred orientation to show the menu.
+ */
+enum class Orientation {
+    /**
+     * Position the menu above the toolbar.
+     */
+    UP,
+    /**
+     * Position the menu below the toolbar.
+     */
+    DOWN;
+
+    companion object {
+
+        /**
+         * Returns an orientation that matches the given [Gravity] value.
+         * Meant to be used with a CoordinatorLayout's gravity.
+         */
+        fun fromGravity(gravity: Int): Orientation {
+            return if ((gravity and Gravity.BOTTOM) == Gravity.BOTTOM) {
+                UP
+            } else {
+                DOWN
+            }
+        }
+    }
+}
diff --git a/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/ext/MenuCandidate.kt b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/ext/MenuCandidate.kt
new file mode 100644
index 000000000000..1459cf929573
--- /dev/null
+++ b/android-components/components/concept/menu/src/main/java/mozilla/components/concept/menu/ext/MenuCandidate.kt
@@ -0,0 +1,52 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.concept.menu.ext
+
+import mozilla.components.concept.menu.candidate.CompoundMenuCandidate
+import mozilla.components.concept.menu.candidate.DecorativeTextMenuCandidate
+import mozilla.components.concept.menu.candidate.DividerMenuCandidate
+import mozilla.components.concept.menu.candidate.DrawableMenuIcon
+import mozilla.components.concept.menu.candidate.HighPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.LowPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.MenuCandidate
+import mozilla.components.concept.menu.candidate.MenuEffect
+import mozilla.components.concept.menu.candidate.MenuIcon
+import mozilla.components.concept.menu.candidate.MenuIconEffect
+import mozilla.components.concept.menu.candidate.RowMenuCandidate
+import mozilla.components.concept.menu.candidate.TextMenuCandidate
+
+private fun MenuIcon?.effect(): MenuIconEffect? =
+    if (this is DrawableMenuIcon) effect else null
+
+/**
+ * Find the effects used by the menu.
+ * Disabled and invisible menu items are not included.
+ */
+fun List<MenuCandidate>.effects(): Sequence<MenuEffect> = this.asSequence()
+    .filter { option -> option.containerStyle.isVisible && option.containerStyle.isEnabled }
+    .flatMap { option ->
+        when (option) {
+            is TextMenuCandidate ->
+                sequenceOf(option.effect, option.start.effect(), option.end.effect()).filterNotNull()
+            is CompoundMenuCandidate ->
+                sequenceOf(option.effect, option.start.effect()).filterNotNull()
+            is RowMenuCandidate ->
+                option.items.asSequence()
+                    .filter { it.containerStyle.isVisible && it.containerStyle.isEnabled }
+                    .mapNotNull { it.icon.effect }
+            is DecorativeTextMenuCandidate, is DividerMenuCandidate -> emptySequence()
+        }
+    }
+
+/**
+ * Select the highlight with the highest priority.
+ */
+fun Sequence<MenuEffect>.max() = maxBy {
+    // Select the highlight with the highest priority
+    when (it) {
+        is HighPriorityHighlightEffect -> 2
+        is LowPriorityHighlightEffect -> 1
+    }
+}
diff --git a/android-components/components/concept/menu/src/test/java/mozilla/components/concept/menu/ext/MenuCandidateTest.kt b/android-components/components/concept/menu/src/test/java/mozilla/components/concept/menu/ext/MenuCandidateTest.kt
new file mode 100644
index 000000000000..3052ff2ea1b2
--- /dev/null
+++ b/android-components/components/concept/menu/src/test/java/mozilla/components/concept/menu/ext/MenuCandidateTest.kt
@@ -0,0 +1,175 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package mozilla.components.concept.menu.ext
+
+import android.graphics.Color
+import mozilla.components.concept.menu.candidate.CompoundMenuCandidate
+import mozilla.components.concept.menu.candidate.ContainerStyle
+import mozilla.components.concept.menu.candidate.DecorativeTextMenuCandidate
+import mozilla.components.concept.menu.candidate.DividerMenuCandidate
+import mozilla.components.concept.menu.candidate.DrawableMenuIcon
+import mozilla.components.concept.menu.candidate.HighPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.LowPriorityHighlightEffect
+import mozilla.components.concept.menu.candidate.RowMenuCandidate
+import mozilla.components.concept.menu.candidate.SmallMenuCandidate
+import mozilla.components.concept.menu.candidate.TextMenuCandidate
+import org.junit.Assert.assertEquals
+import org.junit.Test
+
+class MenuCandidateTest {
+
+    @Test
+    fun `higher priority items will be selected by max`() {
+        assertEquals(
+            HighPriorityHighlightEffect(Color.BLACK),
+            sequenceOf(
+                LowPriorityHighlightEffect(Color.BLUE),
+                HighPriorityHighlightEffect(Color.BLACK)
+            ).max()
+        )
+    }
+
+    @Test
+    fun `items earlier in sequence will be selected by max`() {
+        assertEquals(
+            LowPriorityHighlightEffect(Color.BLUE),
+            sequenceOf(
+                LowPriorityHighlightEffect(Color.BLUE),
+                LowPriorityHighlightEffect(Color.YELLOW)
+            ).max()
+        )
+    }
+
+    @Test
+    fun `effects returns effects from row candidate`() {
+        assertEquals(
+            listOf(
+                LowPriorityHighlightEffect(Color.BLUE),
+                LowPriorityHighlightEffect(Color.YELLOW)
+            ),
+            listOf(RowMenuCandidate(listOf(
+                SmallMenuCandidate(
+                    "",
+                    icon = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.BLUE)
+                    )
+                ),
+                SmallMenuCandidate(
+                    "",
+                    icon = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.RED)
+                    ),
+                    containerStyle = ContainerStyle(isVisible = false)
+                ),
+                SmallMenuCandidate(
+                    "",
+                    icon = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.RED)
+                    ),
+                    containerStyle = ContainerStyle(isEnabled = false)
+                ),
+                SmallMenuCandidate(
+                    "",
+                    icon = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.YELLOW)
+                    )
+                )
+            ))).effects().toList()
+        )
+    }
+
+    @Test
+    fun `effects returns effects from text candidates`() {
+        assertEquals(
+            listOf(
+                HighPriorityHighlightEffect(Color.BLUE),
+                LowPriorityHighlightEffect(Color.YELLOW),
+                HighPriorityHighlightEffect(Color.BLACK),
+                HighPriorityHighlightEffect(Color.BLUE),
+                LowPriorityHighlightEffect(Color.RED)
+            ),
+            listOf(
+                TextMenuCandidate(
+                    "",
+                    start = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.YELLOW)
+                    ),
+                    effect = HighPriorityHighlightEffect(Color.BLUE)
+                ),
+                DecorativeTextMenuCandidate(""),
+                TextMenuCandidate(""),
+                DividerMenuCandidate(),
+                TextMenuCandidate(
+                    "",
+                    effect = HighPriorityHighlightEffect(Color.BLACK)
+                ),
+                TextMenuCandidate(
+                    "",
+                    containerStyle = ContainerStyle(isVisible = false),
+                    effect = HighPriorityHighlightEffect(Color.BLACK)
+                ),
+                TextMenuCandidate(
+                    "",
+                    end = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.RED)
+                    ),
+                    effect = HighPriorityHighlightEffect(Color.BLUE)
+                )
+            ).effects().toList()
+        )
+    }
+
+    @Test
+    fun `effects returns effects from compound candidates`() {
+        assertEquals(
+            listOf(
+                HighPriorityHighlightEffect(Color.BLUE),
+                LowPriorityHighlightEffect(Color.YELLOW),
+                HighPriorityHighlightEffect(Color.BLACK),
+                LowPriorityHighlightEffect(Color.RED)
+            ),
+            listOf(
+                CompoundMenuCandidate(
+                    "",
+                    isChecked = true,
+                    start = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.YELLOW)
+                    ),
+                    end = CompoundMenuCandidate.ButtonType.CHECKBOX,
+                    effect = HighPriorityHighlightEffect(Color.BLUE)
+                ),
+                CompoundMenuCandidate(
+                    "",
+                    isChecked = false,
+                    end = CompoundMenuCandidate.ButtonType.SWITCH,
+                    effect = HighPriorityHighlightEffect(Color.BLACK)
+                ),
+                CompoundMenuCandidate(
+                    "",
+                    isChecked = false,
+                    end = CompoundMenuCandidate.ButtonType.SWITCH,
+                    containerStyle = ContainerStyle(isEnabled = false),
+                    effect = HighPriorityHighlightEffect(Color.BLACK)
+                ),
+                CompoundMenuCandidate(
+                    "",
+                    isChecked = true,
+                    start = DrawableMenuIcon(
+                        null,
+                        effect = LowPriorityHighlightEffect(Color.RED)
+                    ),
+                    end = CompoundMenuCandidate.ButtonType.CHECKBOX
+                )
+            ).effects().toList()
+        )
+    }
+}
diff --git a/android-components/docs/changelog.md b/android-components/docs/changelog.md
index 73981355d7d8..89395b21a849 100644
--- a/android-components/docs/changelog.md
+++ b/android-components/docs/changelog.md
@@ -198,6 +198,17 @@ permalink: /changelog/
 * **feature-addons**
   * Add `Addon.createdAtDate` and `Addon.updatedAtDate` extensions to get `Addon.createdAt` and `Addon.updatedAt` as a `Date`.
 
+* **browser-menu2**
+  * Added new component to replace **browser-menu**. menu2 uses immutable data types and better integrates with `BrowserStore`.
+
+* **concept-menu**
+  * Added concept component to contain data classes for menu items and interfaces for menu controllers.
+
+* **browser-toolbar**
+  * Added support for the new `MenuController` interface for menu2.
+    When a menu controller is added to a toolbar, it will be used in place of the `BrowserMenuBuilder`.
+    The builder will supply items to the `MenuController` in `invalidateMenu` if it is kept.
+
 # 47.0.0
 
 * [Commits](https://github.com/mozilla-mobile/android-components/compare/v46.0.0...v47.0.0)
@@ -1177,6 +1188,19 @@ permalink: /changelog/
 * **browser-menu**
   * Added `MenuButton` to let the browser menu be used outside of `BrowserToolbar`.
 
+* **browser-menu**
+  * Added new `MenuController` and `MenuCandidate` items that replace `BrowserMenuBuilder` and `BrowserMenuItem`.
+    * Menu candidates are pure data classes and state changes are done by submitting a new list of menu candidates, rather than mutating menu items.
+    * The current state of a `BrowserMenuItem` can be converted to a menu candidate with `asCandidate(Context)`.
+    * `MenuController` replaces both `BrowserMenuBuilder` and `BrowserMenu`, and handles showing the menu and adjusting the displayed items.
+    * `MenuView` lets the menu be used outside of popups.
+    * Menu candidates add support for buttons inside menu options, text to the side of a menu option, and improved a11y.
+  * âš ï¸ **This is a breaking change**: Added `asCandidate` method to `BrowserMenuItem` interface.
+
+* **browser-toolbar**
+  * Added support for the new menu controller through the `DisplayToolbar.menuController` property.
+
+
 # 27.0.0
 
 * [Commits](https://github.com/mozilla-mobile/android-components/compare/v26.0.0...v27.0.0)
diff --git a/android-components/samples/toolbar/build.gradle b/android-components/samples/toolbar/build.gradle
index 7d771cafe470..5385a6e54eb2 100644
--- a/android-components/samples/toolbar/build.gradle
+++ b/android-components/samples/toolbar/build.gradle
@@ -30,8 +30,10 @@ android {
 
 dependencies {
     implementation project(':concept-engine')
+    implementation project(':concept-menu')
     implementation project(':browser-toolbar')
     implementation project(':browser-menu')
+    implementation project(':browser-menu2')
     implementation project(':browser-domains')
 
     implementation project(':ui-colors')
diff --git a/android-components/samples/toolbar/src/main/java/org/mozilla/samples/toolbar/ToolbarActivity.kt b/android-components/samples/toolbar/src/main/java/org/mozilla/samples/toolbar/ToolbarActivity.kt
index 2dff7e6c7d43..ca27e8470f2b 100644
--- a/android-components/samples/toolbar/src/main/java/org/mozilla/samples/toolbar/ToolbarActivity.kt
+++ b/android-components/samples/toolbar/src/main/java/org/mozilla/samples/toolbar/ToolbarActivity.kt
@@ -29,18 +29,22 @@ import mozilla.components.browser.domains.autocomplete.ShippedDomainsProvider
 import mozilla.components.browser.menu.BrowserMenu
 import mozilla.components.browser.menu.BrowserMenuBuilder
 import mozilla.components.browser.menu.BrowserMenuItem
-import mozilla.components.browser.menu.item.BrowserMenuDivider
-import mozilla.components.browser.menu.item.BrowserMenuImageText
+import mozilla.components.browser.menu.ext.asCandidateList
 import mozilla.components.browser.menu.item.BrowserMenuItemToolbar
 import mozilla.components.browser.menu.item.SimpleBrowserMenuItem
+import mozilla.components.browser.menu2.BrowserMenuController
 import mozilla.components.browser.toolbar.BrowserToolbar
 import mozilla.components.browser.toolbar.display.DisplayToolbar
+import mozilla.components.concept.menu.Side
+import mozilla.components.concept.menu.candidate.DividerMenuCandidate
+import mozilla.components.concept.menu.candidate.DrawableMenuIcon
+import mozilla.components.concept.menu.candidate.TextMenuCandidate
 import mozilla.components.concept.toolbar.Toolbar
 import mozilla.components.feature.toolbar.ToolbarAutocompleteFeature
 import mozilla.components.support.ktx.android.content.res.resolveAttribute
 import mozilla.components.support.ktx.android.view.hideKeyboard
-import mozilla.components.ui.tabcounter.TabCounter
 import mozilla.components.support.utils.URLStringUtils
+import mozilla.components.ui.tabcounter.TabCounter
 
 /**
  * This sample application shows how to use and customize the browser-toolbar component.
@@ -152,8 +156,8 @@ class ToolbarActivity : AppCompatActivity() {
         val open = SimpleBrowserMenuItem("Open inâ€¦") { /* Do nothing */ }
         val settings = SimpleBrowserMenuItem("Settings") { /* Do nothing */ }
 
-        val builder = BrowserMenuBuilder(listOf(fenix, share, homeScreen, open, settings))
-        toolbar.display.menuBuilder = builder
+        val items = listOf(fenix, share, homeScreen, open, settings)
+        toolbar.display.menuBuilder = BrowserMenuBuilder(items)
 
         // //////////////////////////////////////////////////////////////////////////////////////////
         // Display a URL
@@ -173,18 +177,19 @@ class ToolbarActivity : AppCompatActivity() {
         // Create a menu with text and icons
         // //////////////////////////////////////////////////////////////////////////////////////////
 
-        val share = BrowserMenuImageText(
+        val share = TextMenuCandidate(
             "Share",
-            R.drawable.mozac_ic_share
+            start = DrawableMenuIcon(this, R.drawable.mozac_ic_share)
         ) { /* Do nothing */ }
 
-        val search = BrowserMenuImageText(
+        val search = TextMenuCandidate(
             "Search",
-            R.drawable.mozac_ic_search
+            start = DrawableMenuIcon(this, R.drawable.mozac_ic_search)
         ) { /* Do nothing */ }
 
-        val builder = BrowserMenuBuilder(listOf(share, BrowserMenuDivider(), search))
-        toolbar.display.menuBuilder = builder
+        toolbar.display.menuController = BrowserMenuController(Side.START).apply {
+            submitList(listOf(share, DividerMenuCandidate(), search))
+        }
 
         // //////////////////////////////////////////////////////////////////////////////////////////
         // Display a URL
@@ -260,8 +265,9 @@ class ToolbarActivity : AppCompatActivity() {
         val open = SimpleBrowserMenuItem("Open inâ€¦") { /* Do nothing */ }
         val settings = SimpleBrowserMenuItem("Settings") { /* Do nothing */ }
 
-        val builder = BrowserMenuBuilder(listOf(menuToolbar, blocking, share, homeScreen, open, settings))
-        toolbar.display.menuBuilder = builder
+        val items = listOf(menuToolbar, blocking, share, homeScreen, open, settings)
+        toolbar.display.menuBuilder = BrowserMenuBuilder(items)
+        toolbar.invalidateActions()
 
         // //////////////////////////////////////////////////////////////////////////////////////////
         // Display a URL
@@ -316,12 +322,15 @@ class ToolbarActivity : AppCompatActivity() {
             true
         }
 
-        val share = SimpleBrowserMenuItem("Shareâ€¦") { /* Do nothing */ }
-        val homeScreen = SimpleBrowserMenuItem("Add to Home screen") { /* Do nothing */ }
-        val open = SimpleBrowserMenuItem("Open inâ€¦") { /* Do nothing */ }
-        val settings = SimpleBrowserMenuItem("Settings") { /* Do nothing */ }
+        val share = TextMenuCandidate("Shareâ€¦") { /* Do nothing */ }
+        val homeScreen = TextMenuCandidate("Add to Home screen") { /* Do nothing */ }
+        val open = TextMenuCandidate("Open inâ€¦") { /* Do nothing */ }
+        val settings = TextMenuCandidate("Settings") { /* Do nothing */ }
 
-        toolbar.display.menuBuilder = BrowserMenuBuilder(listOf(share, homeScreen, open, settings))
+        val items = listOf(share, homeScreen, open, settings)
+        toolbar.display.menuController = BrowserMenuController().apply {
+            submitList(items)
+        }
 
         toolbar.url = "https://www.mozilla.org/en-US/firefox/mobile/"
 
@@ -375,7 +384,11 @@ class ToolbarActivity : AppCompatActivity() {
         val open = SimpleBrowserMenuItem("Open inâ€¦") { /* Do nothing */ }
         val settings = SimpleBrowserMenuItem("Settings") { /* Do nothing */ }
 
-        toolbar.display.menuBuilder = BrowserMenuBuilder(listOf(share, homeScreen, open, settings))
+        val items = listOf(share, homeScreen, open, settings)
+        toolbar.display.menuBuilder = BrowserMenuBuilder(items)
+        toolbar.display.menuController = BrowserMenuController().apply {
+            submitList(items.asCandidateList(this@ToolbarActivity))
+        }
 
         toolbar.url = "https://www.mozilla.org/en-US/firefox/mobile/"
 
diff --git a/android-components/samples/toolbar/src/main/res/values/dimens.xml b/android-components/samples/toolbar/src/main/res/values/dimens.xml
index b7f2c5d63ed7..dff0755716f6 100644
--- a/android-components/samples/toolbar/src/main/res/values/dimens.xml
+++ b/android-components/samples/toolbar/src/main/res/values/dimens.xml
@@ -4,4 +4,5 @@
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 <resources xmlns:tools="http://schemas.android.com/tools">
     <dimen tools:ignore="UnusedResources" name="mozac_browser_menu_corner_radius">20dp</dimen>
+    <dimen tools:ignore="UnusedResources" name="mozac_browser_menu2_corner_radius">20dp</dimen>
 </resources>
