diff --git a/focus-android/.taskcluster.yml b/focus-android/.taskcluster.yml
index 27066ce285ec..902efd0ee0c9 100644
--- a/focus-android/.taskcluster.yml
+++ b/focus-android/.taskcluster.yml
@@ -36,8 +36,9 @@ tasks:
           && git config advice.detachedHead false
           && git checkout {{event.head.sha}}
           && echo "--" > .adjust_token
+          && tools/taskcluster/accept-license.sh
           && python tools/l10n/check_locales.py
-          && ./gradlew --no-daemon clean assemble assembleFocusX86DebugAndroidTest detektCheck ktlint lint pmd checkstyle spotbugs test
+          && ./gradlew --no-daemon clean assembleFocusX86DebugAndroidTest assembleKlarX86NightlyAndroidTest detektCheck ktlint lint pmd checkstyle spotbugs testFocusX86DebugUnitTest testKlarX86NightlyUnitTest
       artifacts:
         'public':
           type: 'directory'
diff --git a/focus-android/.travis.yml b/focus-android/.travis.yml
index 0857fda5fe47..7badf448c80b 100644
--- a/focus-android/.travis.yml
+++ b/focus-android/.travis.yml
@@ -7,8 +7,8 @@ android:
   components:
     - tools
     - platform-tools
-    - build-tools-27.0.3
-    - android-27
+    - build-tools-28.0.2
+    - android-28
     - extra-google-google_play_services
     - extra-google-m2repository
     - extra-android-m2repository
@@ -17,12 +17,12 @@ sudo: false
 
 before_install:
   - touch local.properties
-  - yes | sdkmanager "platforms;android-27"
+  - tools/taskcluster/accept-license.sh
 
 script:
   - ./gradlew -Pcoverage --no-daemon clean assembleFocusX86Nightly
   - echo "--" > .adjust_token
-  - ./gradlew -Pcoverage --no-daemon jacocoTestReport
+  - ./gradlew -Pcoverage --no-daemon jacocoTestFocusX86NightlyUnitTestReport
 
 after_success:
   - python <(curl -s https://raw.githubusercontent.com/TouK/sputnik-ci/master/sputnik-ci.py)
diff --git a/focus-android/app/build.gradle b/focus-android/app/build.gradle
index 2fc684bb2d05..c60ebd236ba9 100644
--- a/focus-android/app/build.gradle
+++ b/focus-android/app/build.gradle
@@ -11,12 +11,12 @@ apply plugin: 'kotlin-android-extensions'
 apply from: "$project.rootDir/tools/gradle/versionCode.gradle"
 
 android {
-    compileSdkVersion 27
-    buildToolsVersion '27.0.3'
+    compileSdkVersion 28
+    buildToolsVersion '28.0.2'
     defaultConfig {
         applicationId "org.mozilla"
         minSdkVersion 21
-        targetSdkVersion 27
+        targetSdkVersion 28
         versionCode 11 // This versionCode is "frozen" for local builds. For "release" builds we
                        // override this with a generated versionCode at build time.
         versionName "6.3"
@@ -193,18 +193,18 @@ dependencies {
     implementation "org.mozilla.components:fretboard:$mozilla_components_version"
 
     implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
-    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:0.22.5"
+    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:0.23.4"
 
     focusImplementation 'com.adjust.sdk:adjust-android:4.11.4'
-    focusImplementation 'com.google.android.gms:play-services-analytics:10.2.6' // Required by Adjust
+    focusImplementation 'com.google.android.gms:play-services-analytics:16.0.1' // Required by Adjust
 
     armImplementation "org.mozilla:geckoview-beta-armeabi-v7a:${geckoview_version}"
     x86Implementation "org.mozilla:geckoview-beta-x86:${geckoview_version}"
     aarch64Implementation "org.mozilla:geckoview-beta-arm64-v8a:${geckoview_version}"
 
     testImplementation 'junit:junit:4.12'
-    testImplementation "org.robolectric:robolectric:3.8"
-    testImplementation 'org.mockito:mockito-core:2.12.0'
+    testImplementation "org.robolectric:robolectric:4.0-alpha-3" // required to support api level 28
+    testImplementation 'org.mockito:mockito-core:2.19.0'
 
     androidTestImplementation 'com.android.support.test.uiautomator:uiautomator-v18:2.1.3'
 
@@ -216,8 +216,8 @@ dependencies {
         exclude group: 'com.android.support', module: 'support-annotations'
     }
 
-    androidTestImplementation 'com.squareup.okhttp3:mockwebserver:3.7.0'
-    testImplementation 'com.squareup.okhttp3:mockwebserver:3.7.0'
+    androidTestImplementation 'com.squareup.okhttp3:mockwebserver:3.10.0'
+    testImplementation 'com.squareup.okhttp3:mockwebserver:3.10.0'
 
     androidTestImplementation "tools.fastlane:screengrab:1.1.0", {
         exclude group: 'com.android.support', module: 'support-annotations'
@@ -231,8 +231,8 @@ dependencies {
     implementation 'com.android.support.test:runner:1.0.2'
     testImplementation 'com.android.support.test:rules:1.0.2'
 
-    implementation 'com.android.support.constraint:constraint-layout:1.1.0'
-    implementation 'com.android.support:preference-v7:27.1.1'
+    implementation 'com.android.support.constraint:constraint-layout:1.1.2'
+    implementation 'com.android.support:preference-v7:28.0.0-beta01'
     implementation 'com.jakewharton:process-phoenix:2.0.0'
     debugImplementation 'com.facebook.stetho:stetho:1.5.0'
 }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/activity/SettingsActivity.kt b/focus-android/app/src/main/java/org/mozilla/focus/activity/SettingsActivity.kt
index 7b6b6ae6952d..5cb6f664a961 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/activity/SettingsActivity.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/activity/SettingsActivity.kt
@@ -28,7 +28,7 @@ class SettingsActivity : LocaleAwareAppCompatActivity(), BaseSettingsFragment.Ac
         supportActionBar?.setDisplayHomeAsUpEnabled(true)
 
         if (savedInstanceState == null) {
-            fragmentManager.beginTransaction()
+            supportFragmentManager.beginTransaction()
                     .add(R.id.container, SettingsFragment.newInstance())
                     .commit()
         }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt
index 487394393599..f1abe92d9061 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt
@@ -4,7 +4,7 @@
 
 package org.mozilla.focus.autocomplete
 
-import android.app.Fragment
+import android.support.v4.app.Fragment
 import android.content.Context
 import android.os.Bundle
 import android.view.LayoutInflater
@@ -40,16 +40,16 @@ class AutocompleteAddFragment : Fragment() {
         updater.updateIcon(R.drawable.ic_close)
     }
 
-    override fun onCreateView(inflater: LayoutInflater?, container: ViewGroup?, savedInstanceState: Bundle?): View =
-            inflater!!.inflate(R.layout.fragment_autocomplete_add_domain, container, false)
+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View =
+            inflater.inflate(R.layout.fragment_autocomplete_add_domain, container, false)
 
-    override fun onViewCreated(view: View?, savedInstanceState: Bundle?) {
+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         ViewUtils.showKeyboard(domainView)
     }
 
     override fun onPause() {
         super.onPause()
-        ViewUtils.hideKeyboard(activity.currentFocus)
+        ViewUtils.hideKeyboard(activity?.currentFocus)
     }
 
     override fun onCreateOptionsMenu(menu: Menu?, inflater: MenuInflater?) {
@@ -64,7 +64,7 @@ class AutocompleteAddFragment : Fragment() {
                     .toLowerCase()
 
             launch(IO) {
-                val domains = CustomDomains.load(activity)
+                val domains = CustomDomains.load(activity!!)
                 val error = when {
                     domain.isEmpty() -> getString(R.string.preference_autocomplete_add_error)
                     domains.contains(domain) -> getString(R.string.preference_autocomplete_duplicate_url_error)
@@ -75,7 +75,7 @@ class AutocompleteAddFragment : Fragment() {
                     if (error != null) {
                         domainView.error = error
                     } else {
-                        saveDomainAndClose(activity.applicationContext, domain)
+                        saveDomainAndClose(activity!!.applicationContext, domain)
                     }
                 }
             }
@@ -95,6 +95,6 @@ class AutocompleteAddFragment : Fragment() {
 
         ViewUtils.showBrandedSnackbar(view, R.string.preference_autocomplete_add_confirmation, 0)
 
-        fragmentManager.popBackStack()
+        fragmentManager?.popBackStack()
     }
 }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt
index b5c1a158712c..8d1729db5098 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt
@@ -4,7 +4,7 @@
 
 package org.mozilla.focus.autocomplete
 
-import android.app.Fragment
+import android.support.v4.app.Fragment
 import android.content.Context
 import android.graphics.Color
 import android.os.Bundle
@@ -45,14 +45,10 @@ open class AutocompleteListFragment : Fragment() {
     val itemTouchHelper: ItemTouchHelper = ItemTouchHelper(
             object : SimpleCallback(ItemTouchHelper.UP or ItemTouchHelper.DOWN, 0) {
                 override fun onMove(
-                    recyclerView: RecyclerView?,
-                    viewHolder: RecyclerView.ViewHolder?,
-                    target: RecyclerView.ViewHolder?
+                    recyclerView: RecyclerView,
+                    viewHolder: RecyclerView.ViewHolder,
+                    target: RecyclerView.ViewHolder
                 ): Boolean {
-                    if (recyclerView == null || viewHolder == null || target == null) {
-                        return false
-                    }
-
                     val from = viewHolder.adapterPosition
                     val to = target.adapterPosition
 
@@ -61,9 +57,9 @@ open class AutocompleteListFragment : Fragment() {
                     return true
                 }
 
-                override fun onSwiped(viewHolder: RecyclerView.ViewHolder?, direction: Int) {}
+                override fun onSwiped(viewHolder: RecyclerView.ViewHolder, direction: Int) {}
 
-                override fun getMovementFlags(recyclerView: RecyclerView?, viewHolder: RecyclerView.ViewHolder?): Int {
+                override fun getMovementFlags(recyclerView: RecyclerView, viewHolder: RecyclerView.ViewHolder): Int {
                     if (viewHolder is AddActionViewHolder) {
                         return ItemTouchHelper.Callback.makeMovementFlags(0, 0)
                     }
@@ -79,7 +75,7 @@ open class AutocompleteListFragment : Fragment() {
                     }
                 }
 
-                override fun clearView(recyclerView: RecyclerView?, viewHolder: RecyclerView.ViewHolder?) {
+                override fun clearView(recyclerView: RecyclerView, viewHolder: RecyclerView.ViewHolder) {
                     super.clearView(recyclerView, viewHolder)
 
                     if (viewHolder is DomainViewHolder) {
@@ -88,9 +84,9 @@ open class AutocompleteListFragment : Fragment() {
                 }
 
                 override fun canDropOver(
-                    recyclerView: RecyclerView?,
-                    current: RecyclerView.ViewHolder?,
-                    target: RecyclerView.ViewHolder?
+                    recyclerView: RecyclerView,
+                    current: RecyclerView.ViewHolder,
+                    target: RecyclerView.ViewHolder
                 ): Boolean {
                     if (target is AddActionViewHolder) {
                         return false
@@ -111,10 +107,10 @@ open class AutocompleteListFragment : Fragment() {
      */
     open fun isSelectionMode() = false
 
-    override fun onCreateView(inflater: LayoutInflater?, container: ViewGroup?, savedInstanceState: Bundle?): View =
-            inflater!!.inflate(R.layout.fragment_autocomplete_customdomains, container, false)
+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View =
+            inflater.inflate(R.layout.fragment_autocomplete_customdomains, container, false)
 
-    override fun onViewCreated(view: View?, savedInstanceState: Bundle?) {
+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         domainList.layoutManager = LinearLayoutManager(activity, LinearLayoutManager.VERTICAL, false)
         domainList.adapter = DomainListAdapter()
         domainList.setHasFixedSize(true)
@@ -132,7 +128,7 @@ open class AutocompleteListFragment : Fragment() {
             updateIcon(R.drawable.ic_back)
         }
 
-        (domainList.adapter as DomainListAdapter).refresh(activity) {
+        (domainList.adapter as DomainListAdapter).refresh(activity!!) {
             activity?.invalidateOptionsMenu()
         }
     }
@@ -145,7 +141,7 @@ open class AutocompleteListFragment : Fragment() {
         val removeItem = menu?.findItem(R.id.remove)
 
         removeItem?.let {
-            it.isVisible = isSelectionMode() || domainList.adapter.itemCount > 1
+            it.isVisible = isSelectionMode() || domainList.adapter!!.itemCount > 1
             val isEnabled = !isSelectionMode() || (domainList.adapter as DomainListAdapter).selection().isNotEmpty()
             ViewUtils.setMenuItemEnabled(it, isEnabled)
         }
@@ -153,7 +149,7 @@ open class AutocompleteListFragment : Fragment() {
 
     override fun onOptionsItemSelected(item: MenuItem?): Boolean = when (item?.itemId) {
         R.id.remove -> {
-            fragmentManager
+            fragmentManager!!
                     .beginTransaction()
                     .replace(R.id.container, AutocompleteRemoveFragment())
                     .addToBackStack(null)
@@ -228,7 +224,7 @@ open class AutocompleteListFragment : Fragment() {
             notifyItemMoved(from, to)
 
             launch(IO) {
-                CustomDomains.save(activity.applicationContext, domains)
+                CustomDomains.save(activity!!.applicationContext, domains)
 
                 TelemetryWrapper.reorderAutocompleteDomainEvent(from, to)
             }
@@ -261,7 +257,7 @@ open class AutocompleteListFragment : Fragment() {
 
             checkBoxView.visibility = if (isSelectionMode) View.VISIBLE else View.GONE
             checkBoxView.isChecked = selectedDomains.contains(domain)
-            checkBoxView.setOnCheckedChangeListener({ _: CompoundButton, isChecked: Boolean ->
+            checkBoxView.setOnCheckedChangeListener { _: CompoundButton, isChecked: Boolean ->
                 if (isChecked) {
                     selectedDomains.add(domain)
                 } else {
@@ -269,20 +265,20 @@ open class AutocompleteListFragment : Fragment() {
                 }
 
                 fragment.activity?.invalidateOptionsMenu()
-            })
+            }
 
             handleView.visibility = if (isSelectionMode) View.GONE else View.VISIBLE
-            handleView.setOnTouchListener({ _, event ->
+            handleView.setOnTouchListener { _, event ->
                 if (event.actionMasked == MotionEvent.ACTION_DOWN) {
                     itemTouchHelper.startDrag(this)
                 }
                 false
-            })
+            }
 
             if (isSelectionMode) {
-                itemView.setOnClickListener({
+                itemView.setOnClickListener {
                     checkBoxView.isChecked = !checkBoxView.isChecked
-                })
+                }
             }
         }
 
@@ -304,7 +300,7 @@ open class AutocompleteListFragment : Fragment() {
     ) : RecyclerView.ViewHolder(itemView) {
         init {
             itemView.setOnClickListener {
-                fragment.fragmentManager
+                fragment.fragmentManager!!
                         .beginTransaction()
                         .replace(R.id.container, AutocompleteAddFragment())
                         .addToBackStack(null)
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompletePreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompletePreference.kt
index 1a27e7fbd926..edb45e85addd 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompletePreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompletePreference.kt
@@ -5,9 +5,9 @@
 package org.mozilla.focus.autocomplete
 
 import android.content.Context
-import android.preference.Preference
+import android.support.v7.preference.Preference
+import android.support.v7.preference.PreferenceViewHolder
 import android.util.AttributeSet
-import android.view.View
 import android.widget.TextView
 import org.mozilla.focus.R
 import org.mozilla.focus.utils.Settings
@@ -18,17 +18,17 @@ import org.mozilla.focus.utils.Settings
 class AutocompletePreference(context: Context?, attrs: AttributeSet?) : Preference(context, attrs) {
     var summaryView: TextView? = null
 
-    override fun onBindView(view: View?) {
-        super.onBindView(view)
+    override fun onBindViewHolder(holder: PreferenceViewHolder?) {
+        super.onBindViewHolder(holder)
 
         val settings = Settings.getInstance(context)
 
-        summaryView = view?.findViewById(android.R.id.summary)
+        summaryView = holder!!.findViewById(android.R.id.summary) as TextView
         summaryView?.setText(
-                if (settings.shouldAutocompleteFromShippedDomainList() ||
-                    settings.shouldAutocompleteFromCustomDomainList())
-                    R.string.preference_state_on
-                else
-                    R.string.preference_state_off)
+            if (settings.shouldAutocompleteFromShippedDomainList() ||
+                settings.shouldAutocompleteFromCustomDomainList())
+                R.string.preference_state_on
+            else
+                R.string.preference_state_off)
     }
 }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt
index e82ed015c6a6..c8fbd22713e4 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt
@@ -24,7 +24,7 @@ class AutocompleteRemoveFragment : AutocompleteListFragment() {
 
     override fun onOptionsItemSelected(item: MenuItem?): Boolean = when (item?.itemId) {
         R.id.remove -> {
-            removeSelectedDomains(activity.applicationContext)
+            removeSelectedDomains(activity!!.applicationContext)
             true
         }
         else -> super.onOptionsItemSelected(item)
@@ -40,7 +40,7 @@ class AutocompleteRemoveFragment : AutocompleteListFragment() {
                     TelemetryWrapper.removeAutocompleteDomainsEvent(domains.size)
                 }.await()
 
-                fragmentManager.popBackStack()
+                fragmentManager!!.popBackStack()
             }
         }
     }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteSettingsFragment.kt
index f6411d304b7c..fef11f665e3f 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteSettingsFragment.kt
@@ -6,9 +6,6 @@ package org.mozilla.focus.autocomplete
 
 import android.content.SharedPreferences
 import android.os.Bundle
-import android.preference.Preference
-import android.preference.PreferenceFragment
-import android.preference.PreferenceScreen
 import org.mozilla.focus.R
 import org.mozilla.focus.settings.BaseSettingsFragment
 import org.mozilla.focus.telemetry.TelemetryWrapper
@@ -16,10 +13,8 @@ import org.mozilla.focus.telemetry.TelemetryWrapper
 /**
  * Settings UI for configuring autocomplete.
  */
-class AutocompleteSettingsFragment : PreferenceFragment(), SharedPreferences.OnSharedPreferenceChangeListener {
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
-
+class AutocompleteSettingsFragment : BaseSettingsFragment(), SharedPreferences.OnSharedPreferenceChangeListener {
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
         addPreferencesFromResource(R.xml.autocomplete)
     }
 
@@ -39,17 +34,13 @@ class AutocompleteSettingsFragment : PreferenceFragment(), SharedPreferences.OnS
         preferenceManager.sharedPreferences.unregisterOnSharedPreferenceChangeListener(this)
     }
 
-    override fun onPreferenceTreeClick(preferenceScreen: PreferenceScreen?, preference: Preference?): Boolean {
+    override fun onPreferenceTreeClick(preference: android.support.v7.preference.Preference?): Boolean {
         preference?.let {
             if (it.key == getString(R.string.pref_key_screen_custom_domains)) {
-                fragmentManager.beginTransaction()
-                        .replace(R.id.container, AutocompleteListFragment())
-                        .addToBackStack(null)
-                        .commit()
+                navigateToFragment(AutocompleteListFragment())
             }
         }
-
-        return super.onPreferenceTreeClick(preferenceScreen, preference)
+        return super.onPreferenceTreeClick(preference)
     }
 
     override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences?, key: String?) {
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/biometrics/BiometricAuthenticationDialogFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/biometrics/BiometricAuthenticationDialogFragment.kt
index c4ac5e4e6151..ee4e6a7f3590 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/biometrics/BiometricAuthenticationDialogFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/biometrics/BiometricAuthenticationDialogFragment.kt
@@ -4,13 +4,13 @@
 
 package org.mozilla.focus.biometrics
 
-import android.app.DialogFragment
 import android.arch.lifecycle.LifecycleObserver
 import android.content.DialogInterface
 import android.content.Intent
 import android.os.Build
 import android.os.Bundle
 import android.support.annotation.RequiresApi
+import android.support.v4.app.DialogFragment
 import android.support.v4.content.ContextCompat
 import android.support.v7.app.AppCompatDialogFragment
 import android.view.LayoutInflater
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/ext/String.kt b/focus-android/app/src/main/java/org/mozilla/focus/ext/String.kt
index 71a360bff411..0b8e7f979118 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/ext/String.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/ext/String.kt
@@ -44,7 +44,7 @@ fun String.beautifyUrl(): String {
     val query = uri.query
     if (!query.isNullOrEmpty()) {
         beautifulUrl.append("?")
-        beautifulUrl.append(query.split("&").first())
+        beautifulUrl.append(query!!.split("&").first())
     }
 
     // We always append a fragment if there's one
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt b/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt
index 95083092ca1a..323eb63e74ad 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt
@@ -31,7 +31,7 @@ fun Uri.truncatedHost(): String? {
     //   www.tomshardware.co.uk -> tomshardware.co.uk
     // * If there's no host then just remove the URL as is.
 
-    val hostSegments = host.split(".")
+    val hostSegments = host!!.split(".")
     val usedHostSegments = mutableListOf<String>()
 
     for (segment in hostSegments.reversed()) {
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/fragment/FirstrunFragment.java b/focus-android/app/src/main/java/org/mozilla/focus/fragment/FirstrunFragment.java
index 141aa2f13845..56fca7b06cff 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/fragment/FirstrunFragment.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/fragment/FirstrunFragment.java
@@ -100,7 +100,7 @@ public void onPageScrollStateChanged(int state) {}
         final TabLayout tabLayout = view.findViewById(R.id.tabs);
         tabLayout.setupWithViewPager(viewPager, true);
 
-        final FragmentManager fragmentManager = getFragmentManager();
+        final FragmentManager fragmentManager = getActivity().getSupportFragmentManager();
         final UrlInputFragment urlInputFragment = (UrlInputFragment) fragmentManager.findFragmentByTag(UrlInputFragment.FRAGMENT_TAG);
         if (urlInputFragment != null) {
             fragmentManager.beginTransaction().detach(urlInputFragment).commit();
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineStore.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineStore.kt
index 0cfa48c92706..e1ae5559df30 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineStore.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineStore.kt
@@ -78,7 +78,7 @@ object CustomSearchEngineStore {
     }
 
     fun getRemovedSearchEngines(context: Context): Set<String> =
-            pref(context).getStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, emptySet())
+            pref(context).getStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, emptySet())!!
 
     fun isCustomSearchEngine(engineId: String, context: Context): Boolean {
         for (e in loadCustomSearchEngines(context)) {
@@ -97,7 +97,7 @@ object CustomSearchEngineStore {
 
         try {
             for (engine in engines!!) {
-                val engineInputStream = prefs.getString(engine, "").byteInputStream().buffered()
+                val engineInputStream = prefs.getString(engine, "")!!.byteInputStream().buffered()
                 // Search engine identifier is the search engine name.
                 customEngines.add(parser.load(engine, engineInputStream))
             }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt
index 025129cba731..7898f7b3a1bc 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt
@@ -7,21 +7,22 @@ package org.mozilla.focus.search
 import android.content.Context
 import android.os.Bundle
 import android.os.Parcelable
-import android.preference.Preference
 import android.support.design.widget.TextInputLayout
+import android.support.v7.preference.Preference
+import android.support.v7.preference.PreferenceViewHolder
 import android.text.Editable
 import android.text.TextUtils
 import android.text.TextWatcher
 import android.util.AttributeSet
 import android.view.View
-import android.view.ViewGroup
 import android.widget.EditText
 import android.widget.ProgressBar
 import org.mozilla.focus.R
 import org.mozilla.focus.utils.UrlUtils
 import org.mozilla.focus.utils.ViewUtils
 
-class ManualAddSearchEnginePreference(context: Context, attrs: AttributeSet) : Preference(context, attrs) {
+class ManualAddSearchEnginePreference(context: Context, attrs: AttributeSet) :
+    Preference(context, attrs) {
     private var engineNameEditText: EditText? = null
     private var searchQueryEditText: EditText? = null
     private var engineNameErrorLayout: TextInputLayout? = null
@@ -32,24 +33,32 @@ class ManualAddSearchEnginePreference(context: Context, attrs: AttributeSet) : P
     private var savedSearchEngineName: String? = null
     private var savedSearchQuery: String? = null
 
-    override fun onCreateView(parent: ViewGroup?): View {
-        val view = super.onCreateView(parent)
-
-        engineNameErrorLayout = view.findViewById(R.id.edit_engine_name_layout)
-        searchQueryErrorLayout = view.findViewById(R.id.edit_search_string_layout)
-
-        engineNameEditText = view.findViewById(R.id.edit_engine_name)
-        engineNameEditText?.addTextChangedListener(buildTextWatcherForErrorLayout(engineNameErrorLayout!!))
-        searchQueryEditText = view.findViewById(R.id.edit_search_string)
-        searchQueryEditText?.addTextChangedListener(buildTextWatcherForErrorLayout(searchQueryErrorLayout!!))
-
-        progressView = view.findViewById(R.id.progress)
+    override fun onBindViewHolder(holder: PreferenceViewHolder?) {
+        super.onBindViewHolder(holder)
+
+        engineNameErrorLayout =
+                holder!!.findViewById(R.id.edit_engine_name_layout) as TextInputLayout
+        searchQueryErrorLayout =
+                holder.findViewById(R.id.edit_search_string_layout) as TextInputLayout
+
+        engineNameEditText = holder.findViewById(R.id.edit_engine_name) as EditText
+        engineNameEditText?.addTextChangedListener(
+            buildTextWatcherForErrorLayout(
+                engineNameErrorLayout!!
+            )
+        )
+        searchQueryEditText = holder.findViewById(R.id.edit_search_string) as EditText
+        searchQueryEditText?.addTextChangedListener(
+            buildTextWatcherForErrorLayout(
+                searchQueryErrorLayout!!
+            )
+        )
+
+        progressView = holder.findViewById(R.id.progress) as ProgressBar
 
         updateState()
 
         ViewUtils.showKeyboard(engineNameEditText)
-
-        return view
     }
 
     override fun onRestoreInstanceState(state: Parcelable?) {
@@ -102,6 +111,7 @@ class ManualAddSearchEnginePreference(context: Context, attrs: AttributeSet) : P
     fun setProgressViewShown(isShown: Boolean) {
         progressView?.visibility = if (isShown) View.VISIBLE else View.GONE
     }
+
     private fun updateState() {
         if (engineNameEditText != null) engineNameEditText?.setText(savedSearchEngineName)
         if (searchQueryEditText != null) searchQueryEditText?.setText(savedSearchQuery)
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java
index ee9075761895..2f3a797f8c91 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java
@@ -6,11 +6,12 @@
 
 import android.app.Activity;
 import android.content.Context;
+import android.support.v7.preference.PreferenceViewHolder;
+import android.view.ContextThemeWrapper;
 import android.util.AttributeSet;
-import android.view.View;
-import android.view.ViewGroup;
 import android.widget.CompoundButton;
 
+import org.jetbrains.annotations.Nullable;
 import org.mozilla.focus.R;
 
 import java.util.HashSet;
@@ -27,10 +28,9 @@ public MultiselectSearchEngineListPreference(Context context, AttributeSet attrs
     }
 
     @Override
-    protected View onCreateView(ViewGroup parent) {
-        View view = super.onCreateView(parent);
+    public void onBindViewHolder(@Nullable PreferenceViewHolder holder) {
+        super.onBindViewHolder(holder);
         this.bindEngineCheckboxesToMenu();
-        return view;
     }
 
     @Override
@@ -66,7 +66,14 @@ protected void bindEngineCheckboxesToMenu() {
             engineButton.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
                 @Override
                 public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
-                    ((Activity) getContext()).invalidateOptionsMenu();
+                    final Context context = getContext();
+                    if (context instanceof ContextThemeWrapper) {
+                        if (((ContextThemeWrapper) context).getBaseContext() instanceof Activity) {
+                            ((Activity) ((ContextThemeWrapper) context).getBaseContext()).invalidateOptionsMenu();
+                        }
+                    } else {
+                        ((Activity) context).invalidateOptionsMenu();
+                    }
                 }
             });
         }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.kt
index dd2a3064ceb0..67bcec618fd0 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.kt
@@ -5,9 +5,8 @@
 package org.mozilla.focus.search
 
 import android.content.Context
+import android.support.v7.preference.PreferenceViewHolder
 import android.util.AttributeSet
-import android.view.View
-import android.view.ViewGroup
 import android.widget.CompoundButton
 import android.widget.RadioGroup
 import org.mozilla.focus.R
@@ -25,10 +24,9 @@ class RadioSearchEngineListPreference : SearchEngineListPreference, RadioGroup.O
     @Suppress("unused")
     constructor(context: Context, attrs: AttributeSet, defStyleAttr: Int) : super(context, attrs, defStyleAttr)
 
-    override fun onCreateView(parent: ViewGroup): View {
-        val view = super.onCreateView(parent)
+    override fun onBindViewHolder(holder: PreferenceViewHolder?) {
+        super.onBindViewHolder(holder)
         searchEngineGroup!!.setOnCheckedChangeListener(this)
-        return view
     }
 
     override fun updateDefaultItem(defaultButton: CompoundButton) {
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.kt
index fd5ae4433602..74eaabf874a1 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.kt
@@ -7,11 +7,11 @@ package org.mozilla.focus.search
 import android.content.Context
 import android.content.res.Resources
 import android.graphics.drawable.BitmapDrawable
-import android.preference.Preference
+import android.support.v7.preference.Preference
+import android.support.v7.preference.PreferenceViewHolder
 import android.support.v7.widget.RecyclerView
 import android.util.AttributeSet
 import android.view.LayoutInflater
-import android.view.View
 import android.view.ViewGroup
 import android.widget.CompoundButton
 import android.widget.RadioGroup
@@ -36,17 +36,15 @@ abstract class SearchEngineListPreference : Preference {
         layoutResource = R.layout.preference_search_engine_chooser
     }
 
-    override fun onCreateView(parent: ViewGroup): View {
-        val layoutView = super.onCreateView(parent)
-        searchEngineGroup = layoutView.findViewById(R.id.search_engine_group)
+    override fun onBindViewHolder(holder: PreferenceViewHolder?) {
+        super.onBindViewHolder(holder)
+        searchEngineGroup = holder!!.itemView.findViewById(R.id.search_engine_group)
         val context = searchEngineGroup!!.context
 
         searchEngines = Components.searchEngineManager.getSearchEngines(context)
-                .sortedBy { it.name }
+            .sortedBy { it.name }
 
         refreshSearchEngineViews(context)
-
-        return layoutView
     }
 
     protected abstract fun updateDefaultItem(defaultButton: CompoundButton)
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.kt
index 0f37a9d90a66..8b2326da60ee 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.kt
@@ -7,7 +7,7 @@ package org.mozilla.focus.search
 
 import android.content.Context
 import android.content.SharedPreferences
-import android.preference.Preference
+import android.support.v7.preference.Preference
 import android.util.AttributeSet
 import org.mozilla.focus.Components
 import org.mozilla.focus.R
@@ -27,10 +27,10 @@ class SearchEnginePreference : Preference, SharedPreferences.OnSharedPreferenceC
         this.context = context
     }
 
-    override fun onAttachedToActivity() {
+    override fun onAttached() {
         title = defaultSearchEngineName
         preferenceManager.sharedPreferences.registerOnSharedPreferenceChangeListener(this)
-        super.onAttachedToActivity()
+        super.onAttached()
     }
 
     override fun onPrepareForRemoval() {
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/AdvancedSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/AdvancedSettingsFragment.kt
index 2beebbafa5d2..159471618ee9 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/AdvancedSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/AdvancedSettingsFragment.kt
@@ -12,8 +12,7 @@ import org.mozilla.focus.telemetry.TelemetryWrapper
 class AdvancedSettingsFragment : BaseSettingsFragment(),
         SharedPreferences.OnSharedPreferenceChangeListener {
 
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
         addPreferencesFromResource(R.xml.advanced_settings)
     }
 
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt
index 51ac259e379a..beb4a86d26a3 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt
@@ -4,26 +4,27 @@
 
 package org.mozilla.focus.settings
 
-import android.app.Fragment
 import android.content.Context
 import android.os.Bundle
-import android.preference.PreferenceFragment
+import android.support.v4.app.Fragment
+import android.support.v7.preference.PreferenceFragmentCompat
 import android.view.View
 import android.widget.ListView
 import org.mozilla.focus.R
 
-abstract class BaseSettingsFragment : PreferenceFragment() {
+abstract class BaseSettingsFragment : PreferenceFragmentCompat() {
 
     interface ActionBarUpdater {
         fun updateTitle(titleResId: Int)
         fun updateIcon(iconResId: Int)
     }
 
-    override fun onViewCreated(view: View?, savedInstanceState: Bundle?) {
+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
         super.onViewCreated(view, savedInstanceState)
-        val list = view?.findViewById<View>(android.R.id.list) as ListView
-        list.setDivider(null)
+        val list = view.findViewById<View>(android.R.id.list) as? ListView
+        list?.divider = null
     }
+
     override fun onAttach(context: Context?) {
         super.onAttach(context)
         if (activity !is ActionBarUpdater) {
@@ -34,7 +35,7 @@ abstract class BaseSettingsFragment : PreferenceFragment() {
     protected fun getActionBarUpdater() = activity as ActionBarUpdater
 
     protected fun navigateToFragment(fragment: Fragment) {
-        fragmentManager.beginTransaction()
+        fragmentManager!!.beginTransaction()
             .replace(R.id.container, fragment)
             .addToBackStack(null)
             .commit()
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/ExperimentsSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/ExperimentsSettingsFragment.kt
index febda68664be..1288b3952710 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/ExperimentsSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/ExperimentsSettingsFragment.kt
@@ -7,6 +7,7 @@ package org.mozilla.focus.settings
 import android.content.SharedPreferences
 import android.os.Bundle
 import android.support.v14.preference.SwitchPreference
+import android.support.v7.preference.SwitchPreferenceCompat
 import android.support.v7.preference.PreferenceFragmentCompat
 import com.jakewharton.processphoenix.ProcessPhoenix
 import org.mozilla.focus.R
@@ -15,7 +16,8 @@ import org.mozilla.focus.utils.experimentDescriptor
 import org.mozilla.focus.utils.isInExperiment
 import org.mozilla.focus.web.ENGINE_PREF_STRING_KEY
 
-class ExperimentsSettingsFragment : PreferenceFragmentCompat(), SharedPreferences.OnSharedPreferenceChangeListener {
+class ExperimentsSettingsFragment : PreferenceFragmentCompat(),
+    SharedPreferences.OnSharedPreferenceChangeListener {
     companion object {
         const val FRAGMENT_TAG = "ExperimentSettings"
     }
@@ -25,9 +27,9 @@ class ExperimentsSettingsFragment : PreferenceFragmentCompat(), SharedPreference
 
     override fun onCreatePreferences(savedInstanceState: Bundle?, rootKey: String?) {
         addPreferencesFromResource(R.xml.experiments_settings)
-        enginePreference = preferenceManager
-                .findPreference(ENGINE_PREF_STRING_KEY) as SwitchPreference
-        enginePreference.isChecked = activity!!.isInExperiment(experimentDescriptor)
+        val enginePref: SwitchPreferenceCompat? = preferenceManager
+            .findPreference(ENGINE_PREF_STRING_KEY) as SwitchPreferenceCompat?
+        enginePref?.isChecked = activity!!.isInExperiment(experimentDescriptor)
     }
 
     override fun onResume() {
@@ -41,7 +43,7 @@ class ExperimentsSettingsFragment : PreferenceFragmentCompat(), SharedPreference
         if (rendererPreferenceChanged) {
             activity?.app?.fretboard?.setOverride(
                     activity!!.app, experimentDescriptor, enginePreference.isChecked)
-            val launcherIntent = activity?.packageManager?.getLaunchIntentForPackage(activity?.packageName)
+            val launcherIntent = activity?.packageManager?.getLaunchIntentForPackage(activity!!.packageName)
             ProcessPhoenix.triggerRebirth(context, launcherIntent)
         }
     }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt
index ba4d8043eecd..3bc69d686360 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt
@@ -5,8 +5,7 @@
 package org.mozilla.focus.settings
 
 import android.os.Bundle
-import android.preference.Preference
-import android.preference.PreferenceScreen
+import android.support.v7.preference.Preference
 import android.view.Menu
 import android.view.MenuInflater
 import android.view.MenuItem
@@ -16,16 +15,14 @@ import org.mozilla.focus.search.RadioSearchEngineListPreference
 import org.mozilla.focus.telemetry.TelemetryWrapper
 
 class InstalledSearchEnginesSettingsFragment : BaseSettingsFragment() {
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
+        setHasOptionsMenu(true)
+    }
 
     companion object {
         fun newInstance() = InstalledSearchEnginesSettingsFragment()
     }
 
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
-        setHasOptionsMenu(true)
-    }
-
     override fun onResume() {
         super.onResume()
         getActionBarUpdater().apply {
@@ -44,7 +41,7 @@ class InstalledSearchEnginesSettingsFragment : BaseSettingsFragment() {
     override fun onPrepareOptionsMenu(menu: Menu?) {
         super.onPrepareOptionsMenu(menu)
         menu?.findItem(R.id.menu_restore_default_engines)?.let {
-            it.isEnabled = !CustomSearchEngineStore.hasAllDefaultSearchEngines(activity)
+            it.isEnabled = !CustomSearchEngineStore.hasAllDefaultSearchEngines(activity!!)
         }
     }
 
@@ -56,7 +53,7 @@ class InstalledSearchEnginesSettingsFragment : BaseSettingsFragment() {
                 true
             }
             R.id.menu_restore_default_engines -> {
-                CustomSearchEngineStore.restoreDefaultSearchEngines(activity)
+                CustomSearchEngineStore.restoreDefaultSearchEngines(activity!!)
                 refetchSearchEngines()
                 TelemetryWrapper.menuRestoreEnginesEvent()
                 true
@@ -65,15 +62,15 @@ class InstalledSearchEnginesSettingsFragment : BaseSettingsFragment() {
         }
     }
 
-    override fun onPreferenceTreeClick(preferenceScreen: PreferenceScreen?, preference: Preference?): Boolean {
-        return when (preference?.key) {
+    override fun onPreferenceTreeClick(preference: Preference): Boolean {
+        return when (preference.key) {
             resources.getString(R.string.pref_key_manual_add_search_engine) -> {
                 navigateToFragment(ManualAddSearchEngineSettingsFragment())
                 TelemetryWrapper.menuAddSearchEngineEvent()
                 return true
             }
             else -> {
-                super.onPreferenceTreeClick(preferenceScreen, preference)
+                super.onPreferenceTreeClick(preference)
             }
         }
     }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/LearnMoreSwitchPreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/LearnMoreSwitchPreference.kt
index f3e8efe25ca3..b73a4f5f9e7e 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/LearnMoreSwitchPreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/LearnMoreSwitchPreference.kt
@@ -3,44 +3,51 @@ package org.mozilla.focus.settings
 import android.app.Activity
 import android.content.Context
 import android.graphics.Paint
-import android.preference.SwitchPreference
 import android.support.v4.content.ContextCompat
+import android.support.v7.preference.PreferenceViewHolder
+import android.support.v7.preference.SwitchPreferenceCompat
 import android.util.AttributeSet
+import android.view.ContextThemeWrapper
 import android.view.View
 import android.widget.TextView
 import org.mozilla.focus.R
 import org.mozilla.focus.session.SessionManager
 import org.mozilla.focus.session.Source
 
-abstract class LearnMoreSwitchPreference(context: Context?, attrs: AttributeSet?) : SwitchPreference(context, attrs) {
+abstract class LearnMoreSwitchPreference(context: Context?, attrs: AttributeSet?) :
+    SwitchPreferenceCompat(context, attrs) {
+
     init {
         layoutResource = R.layout.preference_switch_learn_more
     }
 
-    override fun onBindView(view: View?) {
-        super.onBindView(view)
-
-        if (view == null) {
-            return
-        }
+    override fun onBindViewHolder(holder: PreferenceViewHolder?) {
+        super.onBindViewHolder(holder)
 
         getDescription()?.let {
-            val summaryView = view.findViewById<TextView>(android.R.id.summary)
+            val summaryView = holder!!.findViewById(android.R.id.summary) as TextView
             summaryView.text = it
             summaryView.visibility = View.VISIBLE
         }
 
-        val learnMoreLink = view.findViewById<TextView>(R.id.link)
+        val learnMoreLink = holder!!.findViewById(R.id.link) as TextView
         learnMoreLink.paintFlags = learnMoreLink.paintFlags or Paint.UNDERLINE_TEXT_FLAG
-        learnMoreLink.setTextColor(ContextCompat.getColor(view.context, R.color.colorAction))
+        learnMoreLink.setTextColor(ContextCompat.getColor(context, R.color.colorAction))
         learnMoreLink.setOnClickListener {
             // This is a hardcoded link: if we ever end up needing more of these links, we should
             // move the link into an xml parameter, but there's no advantage to making it configurable now.
             SessionManager.getInstance().createSession(Source.MENU, getLearnMoreUrl())
-            (context as Activity).finish()
+            if (context is ContextThemeWrapper) {
+                if ((context as ContextThemeWrapper).baseContext is Activity) {
+                    ((context as ContextThemeWrapper).baseContext as Activity).finish()
+                }
+            } else {
+                (context as? Activity)?.finish()
+            }
         }
 
-        val backgroundDrawableArray = view.context.obtainStyledAttributes(intArrayOf(R.attr.selectableItemBackground))
+        val backgroundDrawableArray =
+            context.obtainStyledAttributes(intArrayOf(R.attr.selectableItemBackground))
         val backgroundDrawable = backgroundDrawableArray.getDrawable(0)
         backgroundDrawableArray.recycle()
         learnMoreLink.background = backgroundDrawable
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt
index 291c4077f84d..877a4dff832d 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt
@@ -34,6 +34,12 @@ import java.net.MalformedURLException
 import java.net.URL
 
 class ManualAddSearchEngineSettingsFragment : BaseSettingsFragment() {
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
+        setHasOptionsMenu(true)
+
+        addPreferencesFromResource(R.xml.manual_add_search_engine)
+    }
+
     /**
      * A reference to an active async task, if applicable, used to manage the task for lifecycle changes.
      * See {@link #onPause()} for details.
@@ -42,13 +48,6 @@ class ManualAddSearchEngineSettingsFragment : BaseSettingsFragment() {
     private var menuItemForActiveAsyncTask: MenuItem? = null
     private val handler = Handler()
 
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
-        setHasOptionsMenu(true)
-
-        addPreferencesFromResource(R.xml.manual_add_search_engine)
-    }
-
     override fun onResume() {
         super.onResume()
 
@@ -87,13 +86,13 @@ class ManualAddSearchEngineSettingsFragment : BaseSettingsFragment() {
         val openLearnMore = {
             SessionManager.getInstance().createSession(Source.MENU, SupportUtils
                 .getSumoURLForTopic(activity, SupportUtils.SumoTopic.ADD_SEARCH_ENGINE))
-            activity.finish()
+            activity!!.finish()
             TelemetryWrapper.addSearchEngineLearnMoreEvent()
         }
 
         val saveSearchEngine = {
-            val engineName = view.findViewById<EditText>(R.id.edit_engine_name).text.toString()
-            val searchQuery = view.findViewById<EditText>(R.id.edit_search_string).text.toString()
+            val engineName = view!!.findViewById<EditText>(R.id.edit_engine_name).text.toString()
+            val searchQuery = view!!.findViewById<EditText>(R.id.edit_search_string).text.toString()
 
             val pref = findManualAddSearchEnginePreference(R.string.pref_key_manual_add_search_engine)
             val engineValid = pref.validateEngineNameAndShowError(engineName)
@@ -128,13 +127,13 @@ class ManualAddSearchEngineSettingsFragment : BaseSettingsFragment() {
         val pref = findManualAddSearchEnginePreference(R.string.pref_key_manual_add_search_engine)
 
         if (isValidating) {
-            view.alpha = DISABLED_ALPHA
+            view?.alpha = DISABLED_ALPHA
             // Delay showing the loading indicator to prevent it flashing on the screen
             handler.postDelayed({
                 pref.setProgressViewShown(isValidating)
             }, LOADING_INDICATOR_DELAY)
         } else {
-            view.alpha = 1f
+            view?.alpha = 1f
             handler.removeCallbacksAndMessages(null)
             pref.setProgressViewShown(isValidating)
         }
@@ -234,10 +233,10 @@ class ManualAddSearchEngineSettingsFragment : BaseSettingsFragment() {
             }
 
             if (isValidSearchQuery == true) {
-                CustomSearchEngineStore.addSearchEngine(that.activity, engineName, query)
-                Snackbar.make(that.view, R.string.search_add_confirmation, Snackbar.LENGTH_SHORT).show()
-                Settings.getInstance(that.activity).setDefaultSearchEngineByName(engineName)
-                that.fragmentManager.popBackStack()
+                CustomSearchEngineStore.addSearchEngine(that.activity!!, engineName, query)
+                Snackbar.make(that.view!!, R.string.search_add_confirmation, Snackbar.LENGTH_SHORT).show()
+                Settings.getInstance(that.activity!!).setDefaultSearchEngineByName(engineName)
+                that.fragmentManager!!.popBackStack()
             } else {
                 showServerError(that)
             }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/MozillaSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/MozillaSettingsFragment.kt
index 9c501b8972d8..1b5cd38c770f 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/MozillaSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/MozillaSettingsFragment.kt
@@ -6,8 +6,7 @@ package org.mozilla.focus.settings
 
 import android.content.SharedPreferences
 import android.os.Bundle
-import android.preference.Preference
-import android.preference.PreferenceScreen
+import android.support.v7.preference.Preference
 import org.mozilla.focus.R
 import org.mozilla.focus.browser.LocalizedContent
 import org.mozilla.focus.session.SessionManager
@@ -18,9 +17,7 @@ import org.mozilla.focus.utils.SupportUtils
 
 class MozillaSettingsFragment : BaseSettingsFragment(),
         SharedPreferences.OnSharedPreferenceChangeListener {
-
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
         addPreferencesFromResource(R.xml.mozilla_settings)
     }
 
@@ -40,32 +37,32 @@ class MozillaSettingsFragment : BaseSettingsFragment(),
         super.onPause()
     }
 
-    override fun onPreferenceTreeClick(preferenceScreen: PreferenceScreen?, preference: Preference?): Boolean {
+    override fun onPreferenceTreeClick(preference: Preference): Boolean {
         // AppCompatActivity has a Toolbar that is used as the ActionBar, and it conflicts with the ActionBar
         // used by PreferenceScreen to create the headers (with title, back navigation), so we wrap all these
         // "preference screens" into separate activities.
-        when (preference?.key) {
+        when (preference.key) {
             resources.getString(R.string.pref_key_about) -> run {
                 SessionManager.getInstance().createSession(Source.MENU, LocalizedContent.URL_ABOUT)
-                activity.finish()
+                activity!!.finish()
             }
             resources.getString(R.string.pref_key_help) -> run {
                 SessionManager.getInstance().createSession(Source.MENU, SupportUtils.HELP_URL)
-                activity.finish()
+                activity!!.finish()
             }
             resources.getString(R.string.pref_key_rights) -> run {
                 SessionManager.getInstance().createSession(Source.MENU, LocalizedContent.URL_RIGHTS)
-                activity.finish()
+                activity!!.finish()
             }
             resources.getString(R.string.pref_key_privacy_notice) -> {
                 SessionManager.getInstance().createSession(Source.MENU, if (AppConstants.isKlarBuild)
                     SupportUtils.PRIVACY_NOTICE_KLAR_URL
                 else
                     SupportUtils.PRIVACY_NOTICE_URL)
-                activity.finish()
+                activity!!.finish()
             }
         }
-        return super.onPreferenceTreeClick(preferenceScreen, preference)
+        return super.onPreferenceTreeClick(preference)
     }
 
     override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences, key: String) {
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/PrivacySecuritySettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/PrivacySecuritySettingsFragment.kt
index 486bc00c14de..34b01721a850 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/PrivacySecuritySettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/PrivacySecuritySettingsFragment.kt
@@ -7,29 +7,22 @@ package org.mozilla.focus.settings
 import android.content.SharedPreferences
 import android.os.Build
 import android.os.Bundle
-import android.preference.Preference
-import android.preference.PreferenceCategory
-import android.preference.SwitchPreference
+import android.support.v7.preference.SwitchPreferenceCompat
 import org.mozilla.focus.R
-import org.mozilla.focus.R.string.pref_key_biometric
-import org.mozilla.focus.R.string.preference_category_switching_apps
 import org.mozilla.focus.biometrics.Biometrics
 import org.mozilla.focus.telemetry.TelemetryWrapper
 
 class PrivacySecuritySettingsFragment : BaseSettingsFragment(),
-        SharedPreferences.OnSharedPreferenceChangeListener {
-
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
+    SharedPreferences.OnSharedPreferenceChangeListener {
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
         addPreferencesFromResource(R.xml.privacy_security_settings)
 
         // Remove the biometric toggle if the software or hardware do not support it
-        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.M || !Biometrics.hasFingerprintHardware(context)) {
-            val biometricPreference = findPreference(getString(pref_key_biometric)) as Preference
-            val switchingAppsCategory = findPreference(getString(
-                preference_category_switching_apps)) as PreferenceCategory
-
-            switchingAppsCategory.removePreference(biometricPreference)
+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.M || !Biometrics.hasFingerprintHardware(
+                context!!
+            )
+        ) {
+            preferenceScreen.removePreference(findPreference(getString(R.string.pref_key_biometric)))
         }
 
         updateStealthToggleAvailability()
@@ -57,13 +50,19 @@ class PrivacySecuritySettingsFragment : BaseSettingsFragment(),
     }
 
     private fun updateStealthToggleAvailability() {
-        val switch = preferenceScreen.findPreference(resources.getString(R.string.pref_key_secure)) as SwitchPreference
+        val switch =
+            preferenceScreen.findPreference(resources.getString(R.string.pref_key_secure)) as SwitchPreferenceCompat
         if (preferenceManager.sharedPreferences
-                        .getBoolean(resources.getString(R.string.pref_key_biometric),
-                                false)) {
+                .getBoolean(
+                    resources.getString(R.string.pref_key_biometric),
+                    false
+                )
+        ) {
             preferenceManager.sharedPreferences
-                    .edit().putBoolean(resources.getString(R.string.pref_key_secure),
-                            true).apply()
+                .edit().putBoolean(
+                    resources.getString(R.string.pref_key_secure),
+                    true
+                ).apply()
             // Disable the stealth switch
             switch.isChecked = true
             switch.isEnabled = false
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt
index c06d64e36be3..3dec49868580 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt
@@ -15,18 +15,16 @@ import org.mozilla.focus.telemetry.TelemetryWrapper
 import org.mozilla.focus.utils.ViewUtils
 
 class RemoveSearchEnginesSettingsFragment : BaseSettingsFragment() {
-
-    companion object {
-        fun newInstance() = RemoveSearchEnginesSettingsFragment()
-    }
-
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
         setHasOptionsMenu(true)
 
         addPreferencesFromResource(R.xml.remove_search_engines)
     }
 
+    companion object {
+        fun newInstance() = RemoveSearchEnginesSettingsFragment()
+    }
+
     override fun onResume() {
         super.onResume()
         getActionBarUpdater().apply {
@@ -45,7 +43,7 @@ class RemoveSearchEnginesSettingsFragment : BaseSettingsFragment() {
         view?.post({
             val pref = preferenceScreen
                 .findPreference(resources.getString(R.string.pref_key_multiselect_search_engine_list))
-                as MultiselectSearchEngineListPreference
+                    as MultiselectSearchEngineListPreference
 
             menu?.findItem(R.id.menu_delete_items)?.let {
                 ViewUtils.setMenuItemEnabled(it, pref.atLeastOneEngineChecked())
@@ -59,10 +57,11 @@ class RemoveSearchEnginesSettingsFragment : BaseSettingsFragment() {
                 val pref = preferenceScreen
                     .findPreference(resources.getString(R.string.pref_key_multiselect_search_engine_list))
 
-                val enginesToRemove = (pref as MultiselectSearchEngineListPreference).checkedEngineIds
+                val enginesToRemove =
+                    (pref as MultiselectSearchEngineListPreference).checkedEngineIds
                 TelemetryWrapper.removeSearchEnginesEvent(enginesToRemove.size)
-                CustomSearchEngineStore.removeSearchEngines(activity, enginesToRemove)
-                fragmentManager.popBackStack()
+                CustomSearchEngineStore.removeSearchEngines(activity!!, enginesToRemove)
+                fragmentManager!!.popBackStack()
                 true
             }
             else -> super.onOptionsItemSelected(item)
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/SearchSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/SearchSettingsFragment.kt
index 8eff18fbeaf3..e933d65f8969 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/SearchSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/SearchSettingsFragment.kt
@@ -6,17 +6,14 @@ package org.mozilla.focus.settings
 
 import android.content.SharedPreferences
 import android.os.Bundle
-import android.preference.Preference
-import android.preference.PreferenceScreen
+import android.support.v7.preference.Preference
 import org.mozilla.focus.R
 import org.mozilla.focus.autocomplete.AutocompleteSettingsFragment
 import org.mozilla.focus.telemetry.TelemetryWrapper
 
 class SearchSettingsFragment : BaseSettingsFragment(),
         SharedPreferences.OnSharedPreferenceChangeListener {
-
-    override fun onCreate(savedInstanceState: Bundle?) {
-        super.onCreate(savedInstanceState)
+    override fun onCreatePreferences(p0: Bundle?, p1: String?) {
         addPreferencesFromResource(R.xml.search_settings)
     }
 
@@ -36,8 +33,8 @@ class SearchSettingsFragment : BaseSettingsFragment(),
         super.onPause()
     }
 
-    override fun onPreferenceTreeClick(preferenceScreen: PreferenceScreen?, preference: Preference?): Boolean {
-        when (preference?.key) {
+    override fun onPreferenceTreeClick(preference: Preference): Boolean {
+        when (preference.key) {
             resources.getString(R.string.pref_key_search_engine) -> run {
                 navigateToFragment(InstalledSearchEnginesSettingsFragment())
                 TelemetryWrapper.openSearchSettingsEvent()
@@ -45,7 +42,7 @@ class SearchSettingsFragment : BaseSettingsFragment(),
             resources.getString(R.string.pref_key_screen_autocomplete) ->
                 navigateToFragment(AutocompleteSettingsFragment())
         }
-        return super.onPreferenceTreeClick(preferenceScreen, preference)
+        return super.onPreferenceTreeClick(preference)
     }
 
     override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences, key: String) {
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/SettingsFragment.java b/focus-android/app/src/main/java/org/mozilla/focus/settings/SettingsFragment.java
index 9d9944e33a96..90b66339e4ec 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/SettingsFragment.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/SettingsFragment.java
@@ -7,10 +7,7 @@
 import android.content.SharedPreferences;
 import android.content.res.Resources;
 import android.os.Bundle;
-import android.preference.ListPreference;
-import android.preference.Preference;
-import android.preference.PreferenceScreen;
-import android.support.annotation.Nullable;
+import android.support.v7.preference.ListPreference;
 import android.text.TextUtils;
 import org.mozilla.focus.R;
 import org.mozilla.focus.activity.SettingsActivity;
@@ -30,8 +27,7 @@ public static SettingsFragment newInstance() {
     }
 
     @Override
-    public void onCreate(@Nullable Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
+    public void onCreatePreferences(Bundle bundle, String s) {
         addPreferencesFromResource(R.xml.settings);
         // TODO: #2869 Enable Debugging and Expose Advanced Setting
         getPreferenceScreen().removePreference(findPreference(getString(R.string.pref_key_advanced_screen)));
@@ -60,9 +56,8 @@ public void onPause() {
         super.onPause();
     }
 
-
     @Override
-    public boolean onPreferenceTreeClick(PreferenceScreen preferenceScreen, Preference preference) {
+    public boolean onPreferenceTreeClick(android.support.v7.preference.Preference preference) {
         final Resources resources = getResources();
 
         if (preference.getKey().equals(resources.getString(R.string
@@ -79,7 +74,7 @@ public boolean onPreferenceTreeClick(PreferenceScreen preferenceScreen, Preferen
             navigateToFragment(new MozillaSettingsFragment());
         }
 
-        return super.onPreferenceTreeClick(preferenceScreen, preference);
+        return super.onPreferenceTreeClick(preference);
     }
 
     @Override
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt b/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt
index 8400ee917342..115fe4c58f25 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt
@@ -35,7 +35,7 @@ class Settings private constructor(context: Context) {
     private val resources: Resources = context.resources
 
     val defaultSearchEngineName: String
-        get() = preferences.getString(getPreferenceKey(R.string.pref_key_search_engine), "")
+        get() = preferences.getString(getPreferenceKey(R.string.pref_key_search_engine), "")!!
 
     fun shouldBlockImages(): Boolean =
             // Not shipping in v1 (#188)
@@ -62,7 +62,7 @@ class Settings private constructor(context: Context) {
     fun shouldBlockCookiesValue(): String =
             preferences.getString(getPreferenceKey(R.string
                     .pref_key_performance_enable_cookies),
-                    resources.getString(R.string.preference_privacy_should_block_cookies_no_option))
+                    resources.getString(R.string.preference_privacy_should_block_cookies_no_option))!!
 
     fun shouldBlockCookies(): Boolean =
             shouldBlockCookiesValue().equals(resources.getString(
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/utils/ViewUtils.java b/focus-android/app/src/main/java/org/mozilla/focus/utils/ViewUtils.java
index a34226304f89..913415afaacf 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/utils/ViewUtils.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/utils/ViewUtils.java
@@ -15,6 +15,7 @@
 import android.support.design.widget.Snackbar;
 import android.support.v4.content.ContextCompat;
 import android.support.v4.view.ViewCompat;
+import android.view.ContextThemeWrapper;
 import android.view.Gravity;
 import android.view.MenuItem;
 import android.view.View;
@@ -42,13 +43,13 @@ public class ViewUtils {
     private static class ShowKeyboard implements Runnable {
         private static final int INTERVAL_MS = 100;
 
-        private final WeakReference<View> viewReferemce;
+        private final WeakReference<View> viewReference;
         private final Handler handler;
 
         private int tries;
 
         private ShowKeyboard(View view) {
-            this.viewReferemce = new WeakReference<>(view);
+            this.viewReference = new WeakReference<>(view);
             this.handler = new Handler(Looper.getMainLooper());
             this.tries = 10;
         }
@@ -59,7 +60,7 @@ public void run() {
                 return;
             }
 
-            final View view = viewReferemce.get();
+            final View view = viewReference.get();
             if (view == null) {
                 // The view is gone. No need to continue.
                 return;
@@ -76,7 +77,17 @@ public void run() {
                 return;
             }
 
-            final Activity activity = (Activity) view.getContext();
+            final Activity activity;
+            if (!(view.getContext() instanceof Activity)) {
+                if (view.getContext() instanceof ContextThemeWrapper) {
+                    activity = (Activity) ((ContextThemeWrapper) view.getContext()).getBaseContext();
+                } else {
+                    return;
+                }
+            } else {
+                activity = (Activity) view.getContext();
+            }
+
             if (activity == null) {
                 return;
             }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/webview/TelemetryAutofillCallback.kt b/focus-android/app/src/main/java/org/mozilla/focus/webview/TelemetryAutofillCallback.kt
index 4de799a4b5a0..5c63cb9748cd 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/webview/TelemetryAutofillCallback.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/webview/TelemetryAutofillCallback.kt
@@ -27,7 +27,7 @@ object TelemetryAutofillCallback : AutofillManager.AutofillCallback() {
     }
 
     override fun onAutofillEvent(view: View?, virtualId: Int, event: Int) {
-        super.onAutofillEvent(view, virtualId, event)
+        super.onAutofillEvent(view!!, virtualId, event)
 
         if (event == EVENT_INPUT_SHOWN) {
             TelemetryWrapper.autofillShownEvent()
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/widget/AboutPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/widget/AboutPreference.java
index f2a9dec92051..2c142635d018 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/widget/AboutPreference.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/widget/AboutPreference.java
@@ -1,7 +1,7 @@
 package org.mozilla.focus.widget;
 
 import android.content.Context;
-import android.preference.Preference;
+import android.support.v7.preference.Preference;
 import android.util.AttributeSet;
 
 import org.mozilla.focus.R;
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/widget/CookiesPreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/widget/CookiesPreference.kt
index eb36a13222f3..f871dcc9e3bd 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/widget/CookiesPreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/widget/CookiesPreference.kt
@@ -5,9 +5,9 @@
 package org.mozilla.focus.widget
 
 import android.content.Context
-import android.preference.ListPreference
+import android.support.v7.preference.ListPreference
+import android.support.v7.preference.PreferenceViewHolder
 import android.util.AttributeSet
-import android.view.View
 import org.mozilla.focus.utils.Settings
 
 /**
@@ -15,8 +15,8 @@ import org.mozilla.focus.utils.Settings
  */
 class CookiesPreference(context: Context?, attrs: AttributeSet?) : ListPreference(context, attrs) {
 
-    override fun onBindView(view: View?) {
-        super.onBindView(view)
+    override fun onBindViewHolder(holder: PreferenceViewHolder?) {
+        super.onBindViewHolder(holder)
         updateSummary()
     }
 
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/widget/DefaultBrowserPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/widget/DefaultBrowserPreference.java
index cc7dbcbf07e7..a0dbf62b38ba 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/widget/DefaultBrowserPreference.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/widget/DefaultBrowserPreference.java
@@ -10,10 +10,10 @@
 import android.content.Context;
 import android.content.Intent;
 import android.os.Build;
-import android.preference.Preference;
 import android.provider.Settings;
+import android.support.v7.preference.Preference;
+import android.support.v7.preference.PreferenceViewHolder;
 import android.util.AttributeSet;
-import android.view.View;
 import android.widget.Switch;
 
 import org.mozilla.focus.R;
@@ -47,10 +47,10 @@ private void init() {
     }
 
     @Override
-    protected void onBindView(View view) {
-        super.onBindView(view);
+    public void onBindViewHolder(PreferenceViewHolder holder) {
+        super.onBindViewHolder(holder);
 
-        switchView = view.findViewById(R.id.switch_widget);
+        switchView = (Switch) holder.findViewById(R.id.switch_widget);
 
         update();
     }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/widget/LocaleListPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/widget/LocaleListPreference.java
index 0fc89c94c428..830ded33b579 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/widget/LocaleListPreference.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/widget/LocaleListPreference.java
@@ -9,7 +9,7 @@
 import android.graphics.Canvas;
 import android.graphics.Paint;
 import android.os.AsyncTask;
-import android.preference.ListPreference;
+import android.support.v7.preference.ListPreference;
 import android.text.TextUtils;
 import android.util.AttributeSet;
 import android.util.Log;
@@ -63,6 +63,10 @@ public class LocaleListPreference extends ListPreference {
         languageCodeToNameMap.put("tsz", "P'urhepecha");
     }
 
+    public LocaleListPreference(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {
+        super(context, attrs, defStyleAttr, defStyleRes);
+    }
+
     /**
      * With thanks to <http://stackoverflow.com/a/22679283/22003> for the
      * initial solution.
@@ -138,9 +142,8 @@ public LocaleListPreference(Context context, AttributeSet attributes) {
     }
 
     @Override
-    protected void onAttachedToActivity() {
-        super.onAttachedToActivity();
-
+    public void onAttached() {
+        super.onAttached();
         // Thus far, missing glyphs are replaced by whitespace, not a box
         // or other Unicode codepoint.
         this.characterValidator = new CharacterValidator(" ");
@@ -297,9 +300,8 @@ public boolean isUsable(CharacterValidator validator) {
     }
 
     @Override
-    protected void onDialogClosed(boolean positiveResult) {
-        // The superclass will take care of persistence.
-        super.onDialogClosed(positiveResult);
+    protected void onClick() {
+        super.onClick();
 
         // Use this hook to try to fix up the environment ASAP.
         // Do this so that the redisplayed fragment is inflated
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/widget/MozillaPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/widget/MozillaPreference.java
index ad001ae0d296..7b2c13295541 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/widget/MozillaPreference.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/widget/MozillaPreference.java
@@ -4,7 +4,7 @@
 package org.mozilla.focus.widget;
 
 import android.content.Context;
-import android.preference.Preference;
+import android.support.v7.preference.Preference;
 import android.util.AttributeSet;
 
 import org.mozilla.focus.R;
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/widget/TelemetrySwitchPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/widget/TelemetrySwitchPreference.java
deleted file mode 100644
index 4ffdf1eafc93..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/widget/TelemetrySwitchPreference.java
+++ /dev/null
@@ -1,101 +0,0 @@
-/* -*- Mode: Java; c-basic-offset: 4; tab-width: 4; indent-tabs-mode: nil; -*-
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.widget;
-
-import android.app.Activity;
-import android.content.Context;
-import android.content.res.Resources;
-import android.content.res.TypedArray;
-import android.graphics.Paint;
-import android.graphics.drawable.Drawable;
-import android.preference.Preference;
-import android.support.v4.content.ContextCompat;
-import android.util.AttributeSet;
-import android.view.View;
-import android.widget.CompoundButton;
-import android.widget.Switch;
-import android.widget.TextView;
-
-import org.mozilla.focus.R;
-import org.mozilla.focus.session.SessionManager;
-import org.mozilla.focus.session.Source;
-import org.mozilla.focus.telemetry.TelemetryWrapper;
-import org.mozilla.focus.utils.SupportUtils;
-
-/**
- * Ideally we'd extend SwitchPreference, and only do the summary modification. Unfortunately
- * that results in us using an older Switch which animates differently to the (seemingly AppCompat)
- * switches used in the remaining preferences. There's no AppCompat SwitchPreference to extend,
- * so instead we just build our own preference.
- */
-class TelemetrySwitchPreference extends Preference {
-    public TelemetrySwitchPreference(Context context, AttributeSet attrs) {
-        super(context, attrs);
-        init();
-    }
-
-    public TelemetrySwitchPreference(Context context, AttributeSet attrs, int defStyle) {
-        super(context, attrs, defStyle);
-        init();
-    }
-
-    private void init() {
-        setLayoutResource(R.layout.preference_telemetry);
-
-        // We are keeping track of the preference value ourselves.
-        setPersistent(false);
-    }
-
-    @Override
-    protected void onBindView(final View view) {
-        super.onBindView(view);
-
-        final Switch switchWidget = view.findViewById(R.id.switch_widget);
-
-        switchWidget.setChecked(TelemetryWrapper.isTelemetryEnabled(getContext()));
-
-        switchWidget.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
-            @Override
-            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
-                TelemetryWrapper.setTelemetryEnabled(getContext(), isChecked);
-            }
-        });
-
-        final Resources resources = view.getResources();
-
-        final TextView summary = view.findViewById(android.R.id.summary);
-        summary.setText(resources.getString(R.string.preference_mozilla_telemetry_summary2, resources.getString(R.string.app_name)));
-
-        final TextView learnMoreLink = view.findViewById(R.id.link);
-        learnMoreLink.setPaintFlags(learnMoreLink.getPaintFlags() | Paint.UNDERLINE_TEXT_FLAG);
-        learnMoreLink.setTextColor(ContextCompat.getColor(view.getContext(), R.color.colorAction));
-        learnMoreLink.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                // This is a hardcoded link: if we ever end up needing more of these links, we should
-                // move the link into an xml parameter, but there's no advantage to making it configurable now.
-                final String url = SupportUtils.getSumoURLForTopic(getContext(), SupportUtils.SumoTopic.USAGE_DATA);
-                SessionManager.getInstance().createSession(Source.MENU, url);
-                ((Activity) getContext()).finish();
-            }
-        });
-
-        final TypedArray backgroundDrawableArray = view.getContext().obtainStyledAttributes(new int[]{R.attr.selectableItemBackground});
-        final Drawable backgroundDrawable = backgroundDrawableArray.getDrawable(0);
-        backgroundDrawableArray.recycle();
-        learnMoreLink.setBackground(backgroundDrawable);
-
-        // We still want to allow toggling the pref by touching any part of the pref (except for
-        // the "learn more" link)
-        setOnPreferenceClickListener(new OnPreferenceClickListener() {
-            @Override
-            public boolean onPreferenceClick(Preference preference) {
-                switchWidget.toggle();
-                return true;
-            }
-        });
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/widget/TelemetrySwitchPreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/widget/TelemetrySwitchPreference.kt
new file mode 100644
index 000000000000..ce9a654984cf
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/widget/TelemetrySwitchPreference.kt
@@ -0,0 +1,35 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.widget
+
+import android.content.Context
+import android.util.AttributeSet
+import org.mozilla.focus.R
+import org.mozilla.focus.settings.LearnMoreSwitchPreference
+import org.mozilla.focus.telemetry.TelemetryWrapper
+import org.mozilla.focus.utils.SupportUtils
+
+/**
+ * Switch preference for enabling/disabling telemetry
+ */
+internal class TelemetrySwitchPreference(context: Context?, attrs: AttributeSet?) :
+    LearnMoreSwitchPreference(context, attrs) {
+
+    override fun onClick() {
+        super.onClick()
+        TelemetryWrapper.setTelemetryEnabled(context, isChecked)
+    }
+
+    override fun getDescription(): String? {
+        return context.resources.getString(
+            R.string.preference_mozilla_telemetry_summary2,
+            context.resources.getString(R.string.app_name)
+        )
+    }
+
+    override fun getLearnMoreUrl(): String {
+        return SupportUtils.getSumoURLForTopic(context, SupportUtils.SumoTopic.USAGE_DATA)
+    }
+}
diff --git a/focus-android/app/src/main/res/layout/focus_preference_category.xml b/focus-android/app/src/main/res/layout/focus_preference_category.xml
new file mode 100644
index 000000000000..0b358dae0ee2
--- /dev/null
+++ b/focus-android/app/src/main/res/layout/focus_preference_category.xml
@@ -0,0 +1,16 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
+   - License, v. 2.0. If a copy of the MPL was not distributed with this
+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
+<TextView xmlns:android="http://schemas.android.com/apk/res/android"
+    android:id="@android:id/title"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    android:gravity="center_vertical"
+    android:layout_marginStart="16dp"
+    android:layout_marginTop="12dp"
+    android:textAllCaps="false"
+    android:textColor="@color/colorAccent"
+    android:textSize="14sp"
+    android:textStyle="bold" />
+
diff --git a/focus-android/app/src/main/res/layout/preference_telemetry.xml b/focus-android/app/src/main/res/layout/focus_preference_no_icon.xml
similarity index 59%
rename from focus-android/app/src/main/res/layout/preference_telemetry.xml
rename to focus-android/app/src/main/res/layout/focus_preference_no_icon.xml
index 235cd5681602..32372237daba 100644
--- a/focus-android/app/src/main/res/layout/preference_telemetry.xml
+++ b/focus-android/app/src/main/res/layout/focus_preference_no_icon.xml
@@ -5,13 +5,11 @@
 <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
     android:layout_width="match_parent"
     android:layout_height="wrap_content"
-    xmlns:tools="http://schemas.android.com/tools"
     android:minHeight="?android:attr/listPreferredItemHeightSmall"
     android:gravity="center_vertical"
     android:baselineAligned="false"
     android:paddingStart="?android:attr/listPreferredItemPaddingStart"
-    android:paddingEnd="?android:attr/listPreferredItemPaddingEnd"
-    android:orientation="horizontal">
+    android:paddingEnd="?android:attr/listPreferredItemPaddingEnd">
 
     <RelativeLayout
         android:layout_width="0dp"
@@ -23,8 +21,7 @@
         <TextView android:id="@android:id/title"
             android:layout_width="wrap_content"
             android:layout_height="wrap_content"
-            android:textAppearance="?android:attr/textAppearanceListItem"
-            tools:text="@string/preference_mozilla_telemetry2" />
+            android:textAppearance="?android:attr/textAppearanceListItem" />
 
         <TextView android:id="@android:id/summary"
             android:layout_width="wrap_content"
@@ -33,38 +30,16 @@
             android:layout_alignStart="@android:id/title"
             android:textAppearance="?android:attr/textAppearanceListItemSecondary"
             android:textColor="?android:attr/textColorSecondary"
-            tools:text="@string/preference_mozilla_telemetry_summary2"
             android:maxLines="10" />
 
-        <TextView
-            android:id="@+id/link"
-            android:layout_below="@android:id/summary"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:layout_alignStart="@android:id/title"
-            android:text="@string/preference_mozilla_telemetry_summary"
-            android:paddingTop="4dp"
-            android:paddingBottom="4dp"
-            android:textColor="@color/colorAction" />
-
     </RelativeLayout>
 
-    <LinearLayout
+    <!-- Preference should place its actual preference widget here. -->
+    <LinearLayout android:id="@android:id/widget_frame"
         android:layout_width="wrap_content"
         android:layout_height="match_parent"
         android:minWidth="58dip"
         android:gravity="end|center_vertical"
-        android:orientation="vertical">
-
-        <Switch xmlns:android="http://schemas.android.com/apk/res/android"
-            android:id="@+id/switch_widget"
-            android:layout_width="wrap_content"
-            android:layout_height="match_parent"
-            android:gravity="center_vertical"
-            android:orientation="vertical"
-            android:clickable="false"
-            android:focusable="false" />
-
-    </LinearLayout>
+        android:orientation="vertical" />
 
-</LinearLayout>
+</LinearLayout>
\ No newline at end of file
diff --git a/focus-android/app/src/main/res/xml/advanced_settings.xml b/focus-android/app/src/main/res/xml/advanced_settings.xml
index f959e6ffc4f7..285620402d7a 100644
--- a/focus-android/app/src/main/res/xml/advanced_settings.xml
+++ b/focus-android/app/src/main/res/xml/advanced_settings.xml
@@ -1,12 +1,15 @@
-<?xml version="1.0" encoding="utf-8"?><!-- This Source Code Form is subject to the terms of the Mozilla Public
+<?xml version="1.0" encoding="utf-8"?>
+<!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
-    <PreferenceCategory android:title="@string/preference_advanced_summary">
-        <SwitchPreference
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+    <android.support.v7.preference.PreferenceCategory
+        android:layout="@layout/focus_preference_category"
+        android:title="@string/preference_advanced_summary">
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="false"
             android:key="@string/pref_key_remote_debugging"
-            android:layout="@layout/focus_preference"
+            android:layout="@layout/focus_preference_no_icon"
             android:title="@string/preference_remote_debugging" />
-    </PreferenceCategory>
-</PreferenceScreen>
+    </android.support.v7.preference.PreferenceCategory>
+</android.support.v7.preference.PreferenceScreen>
diff --git a/focus-android/app/src/main/res/xml/autocomplete.xml b/focus-android/app/src/main/res/xml/autocomplete.xml
index 4e6a016bef7f..a247e1caf705 100644
--- a/focus-android/app/src/main/res/xml/autocomplete.xml
+++ b/focus-android/app/src/main/res/xml/autocomplete.xml
@@ -1,32 +1,32 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!-- This Source Code Form is subject to the terms of the Mozilla Public
+<?xml version="1.0" encoding="utf-8"?><!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
 
-    <PreferenceCategory
+    <android.support.v7.preference.PreferenceCategory  android:layout="@layout/focus_preference_category"
         android:title="@string/preference_category_autocomplete_preinstalled">
 
         <org.mozilla.focus.autocomplete.AutocompleteDefaultDomainsPreference
+            android:defaultValue="true"
             android:key="@string/pref_key_autocomplete_preinstalled"
-            android:title="@string/preference_switch_autocomplete"
-            android:defaultValue="true" />
+            android:title="@string/preference_switch_autocomplete" />
 
-    </PreferenceCategory>
+    </android.support.v7.preference.PreferenceCategory>
 
-    <PreferenceCategory
+    <android.support.v7.preference.PreferenceCategory  android:layout="@layout/focus_preference_category"
         android:title="@string/preference_category_autocomplete_custom_urls">
 
         <org.mozilla.focus.autocomplete.AutocompleteCustomDomainsPreference
             android:key="@string/pref_key_autocomplete_custom"
-            android:title="@string/preference_switch_autocomplete"
-            android:summary="@string/preference_autocomplete_custom_summary" />
+            android:summary="@string/preference_autocomplete_custom_summary"
+            android:title="@string/preference_switch_autocomplete" />
 
-        <Preference
+        <android.support.v7.preference.Preference
+            android:layout="@layout/focus_preference_no_icon"
+            android:dependency="@string/pref_key_autocomplete_custom"
             android:key="@string/pref_key_screen_custom_domains"
-            android:title="@string/preference_autocomplete_subitem_customlist"
-            android:dependency="@string/pref_key_autocomplete_custom" />
+            android:title="@string/preference_autocomplete_subitem_customlist" />
 
-    </PreferenceCategory>
+    </android.support.v7.preference.PreferenceCategory>
 
-</PreferenceScreen>
\ No newline at end of file
+</android.support.v7.preference.PreferenceScreen>
\ No newline at end of file
diff --git a/focus-android/app/src/main/res/xml/experiments_settings.xml b/focus-android/app/src/main/res/xml/experiments_settings.xml
index de6f79ed4bd3..85abcc375e3c 100644
--- a/focus-android/app/src/main/res/xml/experiments_settings.xml
+++ b/focus-android/app/src/main/res/xml/experiments_settings.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="utf-8"?>
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
-    <SwitchPreference
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+    <android.support.v7.preference.SwitchPreferenceCompat
         android:key="use_gecko_engine"
         android:summary="Use the newest GeckoView renderer to take advantage of the latest features"
         android:title="Use new renderer?" />
-</PreferenceScreen>
\ No newline at end of file
+</android.support.v7.preference.PreferenceScreen>
\ No newline at end of file
diff --git a/focus-android/app/src/main/res/xml/manual_add_search_engine.xml b/focus-android/app/src/main/res/xml/manual_add_search_engine.xml
index 961597336311..04735cb93df5 100644
--- a/focus-android/app/src/main/res/xml/manual_add_search_engine.xml
+++ b/focus-android/app/src/main/res/xml/manual_add_search_engine.xml
@@ -3,8 +3,8 @@
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
     <org.mozilla.focus.search.ManualAddSearchEnginePreference
         android:key="@string/pref_key_manual_add_search_engine"
         android:layout="@layout/preference_manual_add_search_engine"/>
-</PreferenceScreen>
\ No newline at end of file
+</android.support.v7.preference.PreferenceScreen>
\ No newline at end of file
diff --git a/focus-android/app/src/main/res/xml/mozilla_settings.xml b/focus-android/app/src/main/res/xml/mozilla_settings.xml
index ee05a9f79a14..c98edf37524d 100644
--- a/focus-android/app/src/main/res/xml/mozilla_settings.xml
+++ b/focus-android/app/src/main/res/xml/mozilla_settings.xml
@@ -2,7 +2,7 @@
 <!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
     <!-- AboutPreference performs some string substitutions, so that we can show "About <AppName>".
              We keep a plain "About" as the title here in xml as a fallback, but AboutPreference
              will use the substitution regardless of what is set here. -->
@@ -12,22 +12,22 @@
         android:layout="@layout/focus_preference_new_tab"
         android:title="@string/menu_about" />
 
-    <Preference
+    <android.support.v7.preference.Preference
         android:icon="@drawable/ic_tab_new"
         android:key="@string/pref_key_help"
         android:layout="@layout/focus_preference_new_tab"
         android:title="@string/menu_help" />
 
-    <Preference
+    <android.support.v7.preference.Preference
         android:icon="@drawable/ic_tab_new"
         android:key="@string/pref_key_rights"
         android:layout="@layout/focus_preference_new_tab"
         android:title="@string/menu_rights" />
 
-    <Preference
+    <android.support.v7.preference.Preference
         android:icon="@drawable/ic_tab_new"
         android:key="@string/pref_key_privacy_notice"
         android:layout="@layout/focus_preference_new_tab"
         android:title="@string/preference_privacy_notice" />
 
-</PreferenceScreen>
+</android.support.v7.preference.PreferenceScreen>
diff --git a/focus-android/app/src/main/res/xml/privacy_security_settings.xml b/focus-android/app/src/main/res/xml/privacy_security_settings.xml
index eb3f4d481449..02590bf80410 100644
--- a/focus-android/app/src/main/res/xml/privacy_security_settings.xml
+++ b/focus-android/app/src/main/res/xml/privacy_security_settings.xml
@@ -2,50 +2,60 @@
 <!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
     <!--- <Preference
         android:layout="@layout/focus_preference"
         android:summary="@string/preference_privacy_and_security_description"/> -->
 
-    <PreferenceCategory android:title="@string/preference_category_tracking_protection">
+    <android.support.v7.preference.PreferenceCategory
+        android:layout="@layout/focus_preference_category"
+        android:title="@string/preference_category_tracking_protection">
 
-        <SwitchPreference
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="true"
             android:key="@string/pref_key_privacy_block_ads"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_privacy_block_ads_summary"
             android:title="@string/preference_privacy_block_ads" />
 
-        <SwitchPreference
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="true"
             android:key="@string/pref_key_privacy_block_analytics"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_privacy_block_analytics_summary"
             android:title="@string/preference_privacy_block_analytics" />
 
-        <SwitchPreference
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="true"
             android:key="@string/pref_key_privacy_block_social"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_privacy_block_social_summary"
             android:title="@string/preference_privacy_block_social" />
 
-        <SwitchPreference
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="false"
             android:key="@string/pref_key_privacy_block_other"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_privacy_block_content_summary2"
             android:title="@string/preference_privacy_block_content" />
 
-    </PreferenceCategory>
+    </android.support.v7.preference.PreferenceCategory>
 
-    <PreferenceCategory android:title="@string/preference_category_web_content">
+    <android.support.v7.preference.PreferenceCategory
+        android:layout="@layout/focus_preference_category"
+        android:title="@string/preference_category_web_content">
 
-        <SwitchPreference
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="false"
             android:key="@string/pref_key_performance_block_webfonts"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_performance_block_webfonts_summary"
             android:title="@string/preference_performance_block_webfonts" />
 
-        <SwitchPreference
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="false"
             android:key="@string/pref_key_performance_block_javascript"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_performance_block_javascript_summary"
             android:title="@string/preference_performance_block_javascript" />
 
@@ -56,39 +66,46 @@
             android:defaultValue="@string/preference_performance_block_images" />
         -->
 
-    </PreferenceCategory>
+    </android.support.v7.preference.PreferenceCategory>
 
-    <PreferenceCategory android:title="@string/preference_category_cookies">
+    <android.support.v7.preference.PreferenceCategory
+        android:layout="@layout/focus_preference_category"
+        android:title="@string/preference_category_cookies">
         <org.mozilla.focus.widget.CookiesPreference
             android:defaultValue="@string/preference_privacy_should_block_cookies_no_option"
             android:entries="@array/preference_privacy_cookies_options"
             android:entryValues="@array/preference_privacy_cookies_options"
             android:key="@string/pref_key_performance_enable_cookies"
+            android:layout="@layout/focus_preference_no_icon"
             android:title="@string/preference_privacy_category_cookies" />
-    </PreferenceCategory>
+    </android.support.v7.preference.PreferenceCategory>
 
-    <PreferenceCategory android:title="@string/preference_category_switching_apps"
-        android:key="@string/preference_category_switching_apps">
-        <SwitchPreference
+    <android.support.v7.preference.PreferenceCategory
+        android:layout="@layout/focus_preference_category"
+        android:title="@string/preference_category_switching_apps">
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="false"
             android:key="@string/pref_key_biometric"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_security_biometric_summary"
             android:title="@string/preference_security_biometric" />
-        <SwitchPreference
+        <android.support.v7.preference.SwitchPreferenceCompat
             android:defaultValue="false"
             android:key="@string/pref_key_secure"
+            android:layout="@layout/focus_preference_no_icon"
             android:summary="@string/preference_privacy_stealth_summary"
             android:title="@string/preference_privacy_secure_mode" />
-    </PreferenceCategory>
+    </android.support.v7.preference.PreferenceCategory>
 
-    <PreferenceCategory android:title="@string/preference_category_data_choices">
+    <android.support.v7.preference.PreferenceCategory
+        android:layout="@layout/focus_preference_category"
+        android:title="@string/preference_category_data_choices">
 
         <org.mozilla.focus.widget.TelemetrySwitchPreference
             android:layout="@layout/focus_preference"
             android:persistent="false"
             android:summary="@string/preference_mozilla_telemetry_summary2"
             android:title="@string/preference_mozilla_telemetry2" />
-    </PreferenceCategory>
-
+    </android.support.v7.preference.PreferenceCategory>
 
-</PreferenceScreen>
+</android.support.v7.preference.PreferenceScreen>
diff --git a/focus-android/app/src/main/res/xml/remove_search_engines.xml b/focus-android/app/src/main/res/xml/remove_search_engines.xml
index 64045d38a1ba..01f8cbedb122 100644
--- a/focus-android/app/src/main/res/xml/remove_search_engines.xml
+++ b/focus-android/app/src/main/res/xml/remove_search_engines.xml
@@ -3,7 +3,7 @@
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
     <org.mozilla.focus.search.MultiselectSearchEngineListPreference
         android:key="@string/pref_key_multiselect_search_engine_list"/>
-</PreferenceScreen>
\ No newline at end of file
+</android.support.v7.preference.PreferenceScreen>
\ No newline at end of file
diff --git a/focus-android/app/src/main/res/xml/search_engine_settings.xml b/focus-android/app/src/main/res/xml/search_engine_settings.xml
index 283a35011551..c8781940129a 100644
--- a/focus-android/app/src/main/res/xml/search_engine_settings.xml
+++ b/focus-android/app/src/main/res/xml/search_engine_settings.xml
@@ -5,10 +5,10 @@
 
 <!-- This preffed off by feature flag FLAG_MANUAL_SEARCH_ENGINE and corresponds to
 search_engine_settings.xml -->
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
     <org.mozilla.focus.search.RadioSearchEngineListPreference
         android:key="@string/pref_key_radio_search_engine_list"/>
-    <Preference
+    <android.support.v7.preference.Preference
         android:title="@string/preference_search_add2"
         android:key="@string/pref_key_manual_add_search_engine"/>
-</PreferenceScreen>
\ No newline at end of file
+</android.support.v7.preference.PreferenceScreen>
\ No newline at end of file
diff --git a/focus-android/app/src/main/res/xml/search_settings.xml b/focus-android/app/src/main/res/xml/search_settings.xml
index 15d49eb8003b..f4ecb86bbae3 100644
--- a/focus-android/app/src/main/res/xml/search_settings.xml
+++ b/focus-android/app/src/main/res/xml/search_settings.xml
@@ -3,20 +3,23 @@
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
 
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
 
     <org.mozilla.focus.search.SearchEnginePreference
         android:key="@string/pref_key_search_engine"
+        android:layout="@layout/focus_preference_no_icon"
         android:summary="@string/preference_search_engine_default" />
 
-    <CheckBoxPreference
+    <android.support.v7.preference.CheckBoxPreference
         android:defaultValue="false"
         android:key="@string/pref_key_show_search_suggestions"
+        android:layout="@layout/focus_preference_no_icon"
         android:title="@string/preference_show_search_suggestions" />
 
     <org.mozilla.focus.autocomplete.AutocompletePreference
         android:key="@string/pref_key_screen_autocomplete"
+        android:layout="@layout/focus_preference_no_icon"
         android:summary="WHAT?"
         android:title="@string/preference_subitem_autocomplete" />
 
-</PreferenceScreen>
+</android.support.v7.preference.PreferenceScreen>
diff --git a/focus-android/app/src/main/res/xml/settings.xml b/focus-android/app/src/main/res/xml/settings.xml
index 0acb6e7b9ce6..f9e34d0f21f0 100644
--- a/focus-android/app/src/main/res/xml/settings.xml
+++ b/focus-android/app/src/main/res/xml/settings.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="utf-8"?><!-- This Source Code Form is subject to the terms of the Mozilla Public
    - License, v. 2.0. If a copy of the MPL was not distributed with this
    - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
-<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+<android.support.v7.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
     <!-- Empty default: we use an empty string to indicate "system default" language being selected -->
     <!--suppress AndroidDomInspection -->
     <org.mozilla.focus.widget.LocaleListPreference
@@ -11,21 +11,21 @@
         android:layout="@layout/focus_preference"
         android:title="@string/preference_language" />
 
-    <Preference
+    <android.support.v7.preference.Preference
         android:icon="@drawable/ic_lock"
         android:key="@string/pref_key_privacy_security_screen"
         android:layout="@layout/focus_preference"
         android:summary="@string/preference_privacy_and_security_summary"
         android:title="@string/preference_privacy_and_security_header" />
 
-    <Preference
+    <android.support.v7.preference.Preference
         android:icon="@drawable/ic_search"
         android:key="@string/pref_key_search_screen"
         android:layout="@layout/focus_preference"
         android:summary="@string/preference_search_summary"
         android:title="@string/preference_category_search" />
 
-    <Preference
+    <android.support.v7.preference.Preference
         android:key="@string/pref_key_advanced_screen"
         android:layout="@layout/focus_preference"
         android:summary="@string/preference_advanced_summary"
@@ -43,4 +43,4 @@
         android:summary="@string/preference_mozilla_summary"
         android:title="@string/preference_category_mozilla" />
 
-</PreferenceScreen>
+</android.support.v7.preference.PreferenceScreen>
diff --git a/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java b/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java
index 078ce71c7d74..3b3803b05aef 100644
--- a/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java
+++ b/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java
@@ -13,7 +13,6 @@
 import org.junit.After;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.mozilla.focus.BuildConfig;
 import org.mozilla.focus.R;
 import org.robolectric.RobolectricTestRunner;
 import org.robolectric.RuntimeEnvironment;
@@ -31,7 +30,7 @@
 import static org.junit.Assert.assertTrue;
 
 @RunWith(RobolectricTestRunner.class)
-@Config(constants = BuildConfig.class, packageName = "org.mozilla.focus")
+@Config(packageName = "org.mozilla.focus")
 public class CustomTabConfigTest {
 
     @After
diff --git a/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/TrackingProtectionWebViewClientTest.java b/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/TrackingProtectionWebViewClientTest.java
index 22606413d799..985f160729cb 100644
--- a/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/TrackingProtectionWebViewClientTest.java
+++ b/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/TrackingProtectionWebViewClientTest.java
@@ -10,7 +10,6 @@
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.mozilla.focus.BuildConfig;
 import org.robolectric.RobolectricTestRunner;
 import org.robolectric.RuntimeEnvironment;
 import org.robolectric.annotation.Config;
@@ -27,7 +26,7 @@
 // http://robolectric.org/getting-started/#note-for-linux-and-mac-users
 
 @RunWith(RobolectricTestRunner.class)
-@Config(constants = BuildConfig.class, packageName = "org.mozilla.focus")
+@Config(packageName = "org.mozilla.focus")
 public class TrackingProtectionWebViewClientTest {
 
     private TrackingProtectionWebViewClient trackingProtectionWebViewClient;
diff --git a/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/matcher/DisconnectTest.java b/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/matcher/DisconnectTest.java
index 315dd96c19ee..d05fc674b9f8 100644
--- a/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/matcher/DisconnectTest.java
+++ b/focus-android/app/src/testWebview/java/org/mozilla/focus/webview/matcher/DisconnectTest.java
@@ -12,7 +12,6 @@
 import org.junit.After;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.mozilla.focus.BuildConfig;
 import org.mozilla.focus.R;
 import org.robolectric.RobolectricTestRunner;
 import org.robolectric.RuntimeEnvironment;
@@ -32,7 +31,7 @@
  * This test also verifies that the entity lists (whitelists for specific domains) actually work
  */
 @RunWith(RobolectricTestRunner.class)
-@Config(constants = BuildConfig.class, packageName = "org.mozilla.focus")
+@Config(packageName = "org.mozilla.focus")
 public class DisconnectTest {
 
     @After
diff --git a/focus-android/build.gradle b/focus-android/build.gradle
index 44c273845089..61f6dde249e7 100644
--- a/focus-android/build.gradle
+++ b/focus-android/build.gradle
@@ -2,9 +2,9 @@
 
 buildscript {
     ext.architecture_components_version = '1.1.0'
-    ext.support_libraries_version = '27.1.1'
+    ext.support_libraries_version = '28.0.0-beta01'
     ext.espresso_version = '3.0.1'
-    ext.kotlin_version = '1.2.50'
+    ext.kotlin_version = '1.2.60'
     ext.geckoview_revision = '3a3725e292e129729b50c60989a4e2012cf8112a'
     ext.geckoview_version = '62.0.20180802174131' // 62.0b14
     ext.spotbugs_version = '3.1.2'
@@ -17,7 +17,7 @@ buildscript {
 
     dependencies {
         classpath 'com.android.tools.build:gradle:3.0.1'
-        classpath 'com.dicedmelon.gradle:jacoco-android:0.1.2'
+        classpath 'com.dicedmelon.gradle:jacoco-android:0.1.3'
 
         classpath 'org.ajoberstar:grgit:1.5.0'
         classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
diff --git a/focus-android/tools/taskcluster/accept-license.sh b/focus-android/tools/taskcluster/accept-license.sh
new file mode 100755
index 000000000000..3b63e201c361
--- /dev/null
+++ b/focus-android/tools/taskcluster/accept-license.sh
@@ -0,0 +1,15 @@
+#!/usr/bin/env bash
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+# If a command fails, do not fail the script
+set -ex
+
+# Accept SDK license
+if [[ $(type -P "sdkmanager") ]]; then
+    yes | sdkmanager "platforms;android-28" "build-tools;28.0.2"
+elif [[ $(type -P "android") ]]; then
+    (while sleep 3; do echo "y"; done) | android update sdk --no-ui --all --filter android-28
+    (while sleep 3; do echo "y"; done) | android update sdk --no-ui --all --filter build-tools-28.0.2
+fi
