diff --git a/focus-android/app/build.gradle b/focus-android/app/build.gradle
index 9381f7e86a89..24fbc644c526 100644
--- a/focus-android/app/build.gradle
+++ b/focus-android/app/build.gradle
@@ -350,10 +350,11 @@ dependencies {
     implementation "org.mozilla.components:utils:$mozilla_components_version"
     implementation "org.mozilla.components:domains:$mozilla_components_version"
     implementation "org.mozilla.components:autocomplete:$mozilla_components_version"
+    implementation "org.mozilla.components:search:$mozilla_components_version"
     implementation "org.mozilla.photon:colors:$mozilla_components_version"
 
     implementation "org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version"
-    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:0.19.3"
+    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:0.22.5"
 
     focusImplementation 'com.adjust.sdk:adjust-android:4.11.4'
     focusImplementation 'com.google.android.gms:play-services-analytics:10.2.6' // Required by Adjust
diff --git a/focus-android/app/src/androidTest/java/org/mozilla/focus/helpers/MainActivityFirstrunTestRule.java b/focus-android/app/src/androidTest/java/org/mozilla/focus/helpers/MainActivityFirstrunTestRule.java
index 6e195bde9793..f6cd561b62a4 100644
--- a/focus-android/app/src/androidTest/java/org/mozilla/focus/helpers/MainActivityFirstrunTestRule.java
+++ b/focus-android/app/src/androidTest/java/org/mozilla/focus/helpers/MainActivityFirstrunTestRule.java
@@ -13,7 +13,7 @@
 import org.mozilla.focus.activity.MainActivity;
 import org.mozilla.focus.session.SessionManager;
 
-import mozilla.components.utils.ThreadUtils;
+import mozilla.components.support.utils.ThreadUtils;
 
 import static org.mozilla.focus.fragment.FirstrunFragment.FIRSTRUN_PREF;
 
diff --git a/focus-android/app/src/androidTestWebview/java/org/mozilla/focus/screenshots/SettingsScreenshots.java b/focus-android/app/src/androidTestWebview/java/org/mozilla/focus/screenshots/SettingsScreenshots.java
index f2a096b07742..58173b1e3167 100644
--- a/focus-android/app/src/androidTestWebview/java/org/mozilla/focus/screenshots/SettingsScreenshots.java
+++ b/focus-android/app/src/androidTestWebview/java/org/mozilla/focus/screenshots/SettingsScreenshots.java
@@ -50,7 +50,7 @@
 import static junit.framework.Assert.assertTrue;
 import static org.hamcrest.Matchers.allOf;
 import static org.hamcrest.Matchers.endsWith;
-import mozilla.components.domains.CustomDomains;
+import mozilla.components.browser.domains.CustomDomains;
 import static org.mozilla.focus.helpers.EspressoHelper.assertToolbarMatchesText;
 import static org.mozilla.focus.helpers.EspressoHelper.openSettings;
 
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/Components.kt b/focus-android/app/src/main/java/org/mozilla/focus/Components.kt
new file mode 100644
index 000000000000..6cee3a733935
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/Components.kt
@@ -0,0 +1,28 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus
+
+import mozilla.components.browser.search.SearchEngineManager
+import mozilla.components.browser.search.provider.AssetsSearchEngineProvider
+import mozilla.components.browser.search.provider.localization.LocaleSearchLocalizationProvider
+import org.mozilla.focus.search.BingSearchEngineFilter
+import org.mozilla.focus.search.CustomSearchEngineProvider
+import org.mozilla.focus.search.HiddenSearchEngineFilter
+
+/**
+ * Helper object for lazily initializing components.
+ */
+object Components {
+    val searchEngineManager by lazy {
+        val assetsProvider = AssetsSearchEngineProvider(
+                LocaleSearchLocalizationProvider(),
+                filters = listOf(BingSearchEngineFilter(), HiddenSearchEngineFilter()),
+                additionalIdentifiers = listOf("ddg"))
+
+        val customProvider = CustomSearchEngineProvider()
+
+        SearchEngineManager(listOf(assetsProvider, customProvider))
+    }
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/FocusApplication.java b/focus-android/app/src/main/java/org/mozilla/focus/FocusApplication.java
deleted file mode 100644
index 1e2461845e18..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/FocusApplication.java
+++ /dev/null
@@ -1,70 +0,0 @@
-/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus;
-
-import android.arch.lifecycle.LiveData;
-import android.os.StrictMode;
-import android.preference.PreferenceManager;
-
-import org.mozilla.focus.locale.LocaleAwareApplication;
-import org.mozilla.focus.search.SearchEngineManager;
-import org.mozilla.focus.session.NotificationSessionObserver;
-import org.mozilla.focus.session.Session;
-import org.mozilla.focus.session.SessionManager;
-import org.mozilla.focus.session.VisibilityLifeCycleCallback;
-import org.mozilla.focus.telemetry.TelemetrySessionObserver;
-import org.mozilla.focus.telemetry.TelemetryWrapper;
-import org.mozilla.focus.utils.AdjustHelper;
-import org.mozilla.focus.utils.AppConstants;
-import org.mozilla.focus.web.CleanupSessionObserver;
-
-import java.util.List;
-
-public class FocusApplication extends LocaleAwareApplication {
-    private VisibilityLifeCycleCallback visibilityLifeCycleCallback;
-
-    @Override
-    public void onCreate() {
-        super.onCreate();
-
-        PreferenceManager.setDefaultValues(this, R.xml.settings, false);
-
-        enableStrictMode();
-
-        SearchEngineManager.getInstance().init(this);
-
-        TelemetryWrapper.init(this);
-        AdjustHelper.setupAdjustIfNeeded(this);
-
-        registerActivityLifecycleCallbacks(visibilityLifeCycleCallback = new VisibilityLifeCycleCallback(this));
-
-        final LiveData<List<Session>> sessions = SessionManager.getInstance().getSessions();
-        sessions.observeForever(new NotificationSessionObserver(this));
-        sessions.observeForever(new TelemetrySessionObserver());
-        sessions.observeForever(new CleanupSessionObserver(this));
-    }
-
-    public VisibilityLifeCycleCallback getVisibilityLifeCycleCallback() {
-        return visibilityLifeCycleCallback;
-    }
-
-    private void enableStrictMode() {
-        // Android/WebView sometimes commit strict mode violations, see e.g.
-        // https://github.com/mozilla-mobile/focus-android/issues/660
-        if (AppConstants.isReleaseBuild()) {
-            return;
-        }
-
-        final StrictMode.ThreadPolicy.Builder threadPolicyBuilder = new StrictMode.ThreadPolicy.Builder().detectAll();
-        final StrictMode.VmPolicy.Builder vmPolicyBuilder = new StrictMode.VmPolicy.Builder().detectAll();
-
-        threadPolicyBuilder.penaltyLog();
-        vmPolicyBuilder.penaltyLog();
-
-        StrictMode.setThreadPolicy(threadPolicyBuilder.build());
-        StrictMode.setVmPolicy(vmPolicyBuilder.build());
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/FocusApplication.kt b/focus-android/app/src/main/java/org/mozilla/focus/FocusApplication.kt
new file mode 100644
index 000000000000..600d0a043124
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/FocusApplication.kt
@@ -0,0 +1,68 @@
+/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-
+ * This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus
+
+import android.os.StrictMode
+import android.preference.PreferenceManager
+import kotlinx.coroutines.experimental.CommonPool
+import kotlinx.coroutines.experimental.launch
+import org.mozilla.focus.locale.LocaleAwareApplication
+import org.mozilla.focus.session.NotificationSessionObserver
+import org.mozilla.focus.session.SessionManager
+import org.mozilla.focus.session.VisibilityLifeCycleCallback
+import org.mozilla.focus.telemetry.TelemetrySessionObserver
+import org.mozilla.focus.telemetry.TelemetryWrapper
+import org.mozilla.focus.utils.AdjustHelper
+import org.mozilla.focus.utils.AppConstants
+import org.mozilla.focus.web.CleanupSessionObserver
+
+class FocusApplication : LocaleAwareApplication() {
+    var visibilityLifeCycleCallback: VisibilityLifeCycleCallback? = null
+        private set
+
+    override fun onCreate() {
+        super.onCreate()
+
+        PreferenceManager.setDefaultValues(this, R.xml.settings, false)
+
+        enableStrictMode()
+
+        Components.searchEngineManager.apply {
+            launch(CommonPool) {
+                load(this@FocusApplication)
+            }
+
+            registerForLocaleUpdates(this@FocusApplication)
+        }
+
+        TelemetryWrapper.init(this)
+        AdjustHelper.setupAdjustIfNeeded(this)
+
+        registerActivityLifecycleCallbacks(VisibilityLifeCycleCallback(this))
+
+        val sessions = SessionManager.getInstance().sessions
+        sessions.observeForever(NotificationSessionObserver(this))
+        sessions.observeForever(TelemetrySessionObserver())
+        sessions.observeForever(CleanupSessionObserver(this))
+    }
+
+    private fun enableStrictMode() {
+        // Android/WebView sometimes commit strict mode violations, see e.g.
+        // https://github.com/mozilla-mobile/focus-android/issues/660
+        if (AppConstants.isReleaseBuild()) {
+            return
+        }
+
+        val threadPolicyBuilder = StrictMode.ThreadPolicy.Builder().detectAll()
+        val vmPolicyBuilder = StrictMode.VmPolicy.Builder().detectAll()
+
+        threadPolicyBuilder.penaltyLog()
+        vmPolicyBuilder.penaltyLog()
+
+        StrictMode.setThreadPolicy(threadPolicyBuilder.build())
+        StrictMode.setVmPolicy(vmPolicyBuilder.build())
+    }
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/activity/CustomTabActivity.kt b/focus-android/app/src/main/java/org/mozilla/focus/activity/CustomTabActivity.kt
index b1923d76d759..4faa941bf918 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/activity/CustomTabActivity.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/activity/CustomTabActivity.kt
@@ -5,7 +5,7 @@
 package org.mozilla.focus.activity
 
 import android.os.Bundle
-import mozilla.components.utils.SafeIntent
+import mozilla.components.support.utils.SafeIntent
 import org.mozilla.focus.customtabs.CustomTabConfig
 import org.mozilla.focus.session.Session
 import org.mozilla.focus.session.SessionManager
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/activity/IntentReceiverActivity.kt b/focus-android/app/src/main/java/org/mozilla/focus/activity/IntentReceiverActivity.kt
index 5b12fa002f0d..3ae930fab351 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/activity/IntentReceiverActivity.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/activity/IntentReceiverActivity.kt
@@ -7,7 +7,7 @@ package org.mozilla.focus.activity
 import android.app.Activity
 import android.content.Intent
 import android.os.Bundle
-import mozilla.components.utils.SafeIntent
+import mozilla.components.support.utils.SafeIntent
 import org.mozilla.focus.customtabs.CustomTabConfig
 import java.util.UUID
 
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/activity/MainActivity.java b/focus-android/app/src/main/java/org/mozilla/focus/activity/MainActivity.java
index a692e5173e72..28fe680931f6 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/activity/MainActivity.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/activity/MainActivity.java
@@ -33,7 +33,7 @@
 
 import java.util.List;
 
-import mozilla.components.utils.SafeIntent;
+import mozilla.components.support.utils.SafeIntent;
 
 public class MainActivity extends LocaleAwareAppCompatActivity {
     public static final String ACTION_ERASE = "erase";
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/activity/TextActionActivity.java b/focus-android/app/src/main/java/org/mozilla/focus/activity/TextActionActivity.java
index 37de997333f4..512037c8c828 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/activity/TextActionActivity.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/activity/TextActionActivity.java
@@ -15,7 +15,7 @@
 
 import org.mozilla.focus.utils.UrlUtils;
 
-import mozilla.components.utils.SafeIntent;
+import mozilla.components.support.utils.SafeIntent;
 
 /**
  * Activity for receiving and processing an ACTION_PROCESS_TEXT intent.
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt
index 6ae9be0e48a7..c47cc9feb99d 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteAddFragment.kt
@@ -17,7 +17,7 @@ import kotlinx.android.synthetic.main.fragment_autocomplete_add_domain.*
 import kotlinx.coroutines.experimental.CommonPool
 import kotlinx.coroutines.experimental.android.UI
 import kotlinx.coroutines.experimental.launch
-import mozilla.components.domains.CustomDomains
+import mozilla.components.browser.domains.CustomDomains
 import org.mozilla.focus.R
 import org.mozilla.focus.ext.removePrefixesIgnoreCase
 import org.mozilla.focus.settings.BaseSettingsFragment
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt
index 682a1eeb7f5c..4ba29c6b71b7 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteListFragment.kt
@@ -27,7 +27,7 @@ import kotlinx.coroutines.experimental.CommonPool
 import kotlinx.coroutines.experimental.android.UI
 import kotlinx.coroutines.experimental.async
 import kotlinx.coroutines.experimental.launch
-import mozilla.components.domains.CustomDomains
+import mozilla.components.browser.domains.CustomDomains
 import org.mozilla.focus.R
 import org.mozilla.focus.settings.BaseSettingsFragment
 import org.mozilla.focus.telemetry.TelemetryWrapper
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt
index 4b80384c4773..e82ed015c6a6 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/autocomplete/AutocompleteRemoveFragment.kt
@@ -12,7 +12,7 @@ import kotlinx.android.synthetic.main.fragment_autocomplete_customdomains.*
 import kotlinx.coroutines.experimental.android.UI
 import kotlinx.coroutines.experimental.async
 import kotlinx.coroutines.experimental.launch
-import mozilla.components.domains.CustomDomains
+import mozilla.components.browser.domains.CustomDomains
 import org.mozilla.focus.R
 import org.mozilla.focus.settings.BaseSettingsFragment
 import org.mozilla.focus.telemetry.TelemetryWrapper
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/customtabs/CustomTabConfig.java b/focus-android/app/src/main/java/org/mozilla/focus/customtabs/CustomTabConfig.java
index 23a3a04cb9cb..d094021f1de6 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/customtabs/CustomTabConfig.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/customtabs/CustomTabConfig.java
@@ -22,8 +22,8 @@
 import java.util.LinkedList;
 import java.util.List;
 
-import mozilla.components.utils.SafeBundle;
-import mozilla.components.utils.SafeIntent;
+import mozilla.components.support.utils.SafeBundle;
+import mozilla.components.support.utils.SafeIntent;
 
 public class CustomTabConfig {
     private static final String LOGTAG = "CustomTabConfig";
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt b/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt
index a4128f6ba8e3..95083092ca1a 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/ext/Uri.kt
@@ -5,7 +5,7 @@
 package org.mozilla.focus.ext
 
 import android.net.Uri
-import mozilla.components.ktx.kotlin.ELLIPSIS
+import mozilla.components.support.ktx.kotlin.ELLIPSIS
 
 // Extension functions for the android.net.Uri class
 
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/fragment/BrowserFragment.java b/focus-android/app/src/main/java/org/mozilla/focus/fragment/BrowserFragment.java
index 52e5e24408ba..7b63180b34d5 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/fragment/BrowserFragment.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/fragment/BrowserFragment.java
@@ -79,9 +79,9 @@
 import java.lang.ref.WeakReference;
 import java.util.List;
 
-import mozilla.components.utils.ColorUtils;
-import mozilla.components.utils.DownloadUtils;
-import mozilla.components.utils.DrawableUtils;
+import mozilla.components.support.utils.ColorUtils;
+import mozilla.components.support.utils.DownloadUtils;
+import mozilla.components.support.utils.DrawableUtils;
 
 /**
  * Fragment for displaying the browser UI.
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/fragment/DownloadDialogFragment.java b/focus-android/app/src/main/java/org/mozilla/focus/fragment/DownloadDialogFragment.java
index 37dd6989feab..694d3bed2212 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/fragment/DownloadDialogFragment.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/fragment/DownloadDialogFragment.java
@@ -20,7 +20,7 @@
 import org.mozilla.focus.telemetry.TelemetryWrapper;
 import org.mozilla.focus.web.Download;
 
-import mozilla.components.utils.DownloadUtils;
+import mozilla.components.support.utils.DownloadUtils;
 
 /**
  * Fragment displaying a download dialog
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/fragment/UrlInputFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/fragment/UrlInputFragment.kt
index 95b404195ccf..c28744dfeab9 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/fragment/UrlInputFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/fragment/UrlInputFragment.kt
@@ -17,10 +17,10 @@ import android.view.ViewGroup
 import android.view.ViewTreeObserver
 import android.widget.FrameLayout
 import kotlinx.android.synthetic.main.fragment_urlinput.*
-import mozilla.components.domains.DomainAutoCompleteProvider
+import mozilla.components.browser.domains.DomainAutoCompleteProvider
 import mozilla.components.ui.autocomplete.InlineAutocompleteEditText
 import mozilla.components.ui.autocomplete.InlineAutocompleteEditText.AutocompleteResult
-import mozilla.components.utils.ThreadUtils
+import mozilla.components.support.utils.ThreadUtils
 import org.mozilla.focus.R
 import org.mozilla.focus.locale.LocaleAwareAppCompatActivity
 import org.mozilla.focus.locale.LocaleAwareFragment
@@ -536,7 +536,7 @@ class UrlInputFragment :
         }
 
         view?.let {
-            autoCompleteProvider.autocomplete(searchText, { result, source, size ->
+            autoCompleteProvider.autocomplete(searchText, { result, _, source, size ->
                 view.onAutocomplete(AutocompleteResult(result, source, size))
             })
         }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/menu/browser/BlockingItemViewHolder.java b/focus-android/app/src/main/java/org/mozilla/focus/menu/browser/BlockingItemViewHolder.java
index 218726867a58..6e29204fb8c6 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/menu/browser/BlockingItemViewHolder.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/menu/browser/BlockingItemViewHolder.java
@@ -14,7 +14,7 @@
 import org.mozilla.focus.fragment.BrowserFragment;
 import org.mozilla.focus.telemetry.TelemetryWrapper;
 
-import mozilla.components.utils.ThreadUtils;
+import mozilla.components.support.utils.ThreadUtils;
 
 /* package */ class BlockingItemViewHolder extends BrowserMenuViewHolder implements CompoundButton.OnCheckedChangeListener {
     /* package */ static final int LAYOUT_ID = R.layout.menu_blocking_switch;
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/popup/PopupUtils.kt b/focus-android/app/src/main/java/org/mozilla/focus/popup/PopupUtils.kt
index 25a032a32ba5..cbe471383128 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/popup/PopupUtils.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/popup/PopupUtils.kt
@@ -16,8 +16,8 @@ import android.webkit.URLUtil
 import android.widget.ImageView
 import android.widget.PopupWindow
 import android.widget.TextView
-import mozilla.components.ktx.android.graphics.drawable.toBitmap
-import mozilla.components.utils.DrawableUtils
+import mozilla.components.support.ktx.android.graphics.drawable.toBitmap
+import mozilla.components.support.utils.DrawableUtils
 import org.mozilla.focus.R
 import org.mozilla.focus.session.Session
 import java.net.MalformedURLException
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/BingSearchEngineFilter.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/BingSearchEngineFilter.kt
new file mode 100644
index 000000000000..1b79ed86754c
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/BingSearchEngineFilter.kt
@@ -0,0 +1,17 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.content.Context
+import mozilla.components.browser.search.SearchEngine
+import mozilla.components.browser.search.provider.filter.SearchEngineFilter
+
+/**
+ * SearchEngineFilter implementation to hide Bing from the default list.
+ */
+class BingSearchEngineFilter : SearchEngineFilter {
+    override fun filter(context: Context, searchEngine: SearchEngine): Boolean =
+            searchEngine.identifier != "bing"
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineProvider.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineProvider.kt
new file mode 100644
index 000000000000..26eb7f090093
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineProvider.kt
@@ -0,0 +1,19 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.content.Context
+import mozilla.components.browser.search.SearchEngine
+import mozilla.components.browser.search.provider.SearchEngineProvider
+
+/**
+ * SearchEngineProvider implementation to load user entered custom search engines.
+ */
+class CustomSearchEngineProvider : SearchEngineProvider {
+    // Our version of ktlint enforces the wrong modifier order. We need to update the plugin: #2488
+    /* ktlint-disable modifier-order */
+    override suspend fun loadSearchEngines(context: Context): List<SearchEngine> =
+            CustomSearchEngineStore.loadCustomSearchEngines(context)
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineStore.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineStore.kt
new file mode 100644
index 000000000000..bc1aaf6c008d
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/CustomSearchEngineStore.kt
@@ -0,0 +1,125 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.content.Context
+import android.util.Log
+import mozilla.components.browser.search.SearchEngine
+import mozilla.components.browser.search.SearchEngineParser
+import org.mozilla.focus.shortcut.IconGenerator
+import org.xmlpull.v1.XmlPullParserException
+import java.io.IOException
+
+object CustomSearchEngineStore {
+    fun isSearchEngineNameUnique(context: Context, engineName: String): Boolean {
+        val sharedPreferences = context.getSharedPreferences(PREF_FILE_SEARCH_ENGINES,
+                Context.MODE_PRIVATE)
+
+        return !sharedPreferences.contains(engineName)
+    }
+
+    fun restoreDefaultSearchEngines(context: Context) {
+        pref(context)
+                .edit()
+                .remove(PREF_KEY_HIDDEN_DEFAULT_ENGINES)
+                .apply()
+    }
+
+    fun hasAllDefaultSearchEngines(context: Context): Boolean {
+        return !pref(context)
+                .contains(PREF_KEY_HIDDEN_DEFAULT_ENGINES)
+    }
+
+    fun addSearchEngine(context: Context, engineName: String, searchQuery: String): Boolean {
+        // This is not for a homescreen shortcut so we don't want an adaptive launcher icon.
+        val iconBitmap = IconGenerator.generateLauncherIconPreOreo(context, engineName[0])
+        val searchEngineXml = SearchEngineWriter.buildSearchEngineXML(engineName, searchQuery, iconBitmap)
+                ?: return false
+        val existingEngines = pref(context).getStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, emptySet())
+        val newEngines = LinkedHashSet<String>()
+        newEngines.addAll(existingEngines!!)
+        newEngines.add(engineName)
+
+        pref(context)
+                .edit()
+                .putInt(PREF_KEY_CUSTOM_SEARCH_VERSION, CUSTOM_SEARCH_VERSION)
+                .putStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, newEngines)
+                .putString(engineName, searchEngineXml)
+                .apply()
+
+        return true
+    }
+
+    fun removeSearchEngines(context: Context, engineIdsToRemove: MutableSet<String>) {
+        // Check custom engines first.
+        val customEngines = pref(context).getStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, emptySet())
+        val remainingCustomEngines = LinkedHashSet<String>()
+        val enginesEditor = pref(context).edit()
+
+        for (engineId in customEngines!!) {
+            if (engineIdsToRemove.contains(engineId)) {
+                enginesEditor.remove(engineId)
+                // Handled engine removal.
+                engineIdsToRemove.remove(engineId)
+            } else {
+                remainingCustomEngines.add(engineId)
+            }
+        }
+        enginesEditor.putStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, remainingCustomEngines)
+
+        // Everything else must be a default engine.
+        val hiddenDefaultEngines = pref(context).getStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, emptySet())
+        engineIdsToRemove.addAll(hiddenDefaultEngines!!)
+        enginesEditor.putStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, engineIdsToRemove)
+
+        enginesEditor.apply()
+    }
+
+    fun getRemovedSearchEngines(context: Context): Set<String> =
+            pref(context).getStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, emptySet())
+
+    fun isCustomSearchEngine(engineId: String, context: Context): Boolean {
+        for (e in loadCustomSearchEngines(context)) {
+            if (e.identifier == engineId) {
+                return true
+            }
+        }
+        return false
+    }
+
+    fun loadCustomSearchEngines(context: Context): List<SearchEngine> {
+        val customEngines = mutableListOf<SearchEngine>()
+        val parser = SearchEngineParser()
+        val prefs = context.getSharedPreferences(PREF_FILE_SEARCH_ENGINES, Context.MODE_PRIVATE)
+        val engines = prefs.getStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, emptySet())
+
+        try {
+            for (engine in engines!!) {
+                val engineInputStream = prefs.getString(engine, "").byteInputStream().buffered()
+                // Search engine identifier is the search engine name.
+                customEngines.add(parser.load(engine, engineInputStream))
+            }
+        } catch (e: IOException) {
+            Log.e(LOG_TAG, "IOException while loading custom search engines", e)
+        } catch (e: XmlPullParserException) {
+            Log.e(LOG_TAG, "Couldn't load custom search engines", e)
+        }
+
+        return customEngines
+    }
+
+    private fun pref(context: Context) =
+            context.getSharedPreferences(PREF_FILE_SEARCH_ENGINES, Context.MODE_PRIVATE)
+
+    const val ENGINE_TYPE_CUSTOM = "custom"
+    const val ENGINE_TYPE_BUNDLED = "bundled"
+
+    private const val LOG_TAG = "CustomSearchEngineStore"
+    private const val PREF_KEY_CUSTOM_SEARCH_ENGINES = "pref_custom_search_engines"
+    private const val PREF_KEY_HIDDEN_DEFAULT_ENGINES = "hidden_default_engines"
+    private const val PREF_KEY_CUSTOM_SEARCH_VERSION = "pref_custom_search_version"
+    private const val CUSTOM_SEARCH_VERSION = 1
+    private const val PREF_FILE_SEARCH_ENGINES = "custom-search-engines"
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/HiddenSearchEngineFilter.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/HiddenSearchEngineFilter.kt
new file mode 100644
index 000000000000..c9340df255b8
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/HiddenSearchEngineFilter.kt
@@ -0,0 +1,19 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.content.Context
+import mozilla.components.browser.search.SearchEngine
+import mozilla.components.browser.search.provider.filter.SearchEngineFilter
+
+/**
+ * SearchEngineFilter implementation for hiding removed search engines.
+ */
+class HiddenSearchEngineFilter : SearchEngineFilter {
+    override fun filter(context: Context, searchEngine: SearchEngine): Boolean {
+        val hiddenSearchEngines: Set<String> = CustomSearchEngineStore.getRemovedSearchEngines(context)
+        return !hiddenSearchEngines.contains(searchEngine.identifier)
+    }
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt
index abc114337a7a..025129cba731 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/ManualAddSearchEnginePreference.kt
@@ -71,8 +71,12 @@ class ManualAddSearchEnginePreference(context: Context, attrs: AttributeSet) : P
 
     fun validateEngineNameAndShowError(engineName: String): Boolean {
         val errorMessage = when {
-            TextUtils.isEmpty(engineName) -> context.getString(R.string.search_add_error_empty_name)
-            !engineNameIsUnique(engineName) -> context.getString(R.string.search_add_error_duplicate_name)
+            TextUtils.isEmpty(engineName) ->
+                context.getString(R.string.search_add_error_empty_name)
+
+            !CustomSearchEngineStore.isSearchEngineNameUnique(context, engineName) ->
+                context.getString(R.string.search_add_error_duplicate_name)
+
             else -> null
         }
 
@@ -103,13 +107,6 @@ class ManualAddSearchEnginePreference(context: Context, attrs: AttributeSet) : P
         if (searchQueryEditText != null) searchQueryEditText?.setText(savedSearchQuery)
     }
 
-    private fun engineNameIsUnique(engineName: String): Boolean {
-        val sharedPreferences = context.getSharedPreferences(SearchEngineManager.PREF_FILE_SEARCH_ENGINES,
-                Context.MODE_PRIVATE)
-
-        return !sharedPreferences.contains(engineName)
-    }
-
     private fun buildTextWatcherForErrorLayout(errorLayout: TextInputLayout): TextWatcher {
         return object : TextWatcher {
             override fun beforeTextChanged(charSequence: CharSequence, i: Int, i1: Int, i2: Int) {}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java
index bf7926b1376e..ee9075761895 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/MultiselectSearchEngineListPreference.java
@@ -50,8 +50,8 @@ protected void updateDefaultItem(CompoundButton defaultButton) {
     public Set<String> getCheckedEngineIds() {
         final Set<String> engineIdSet = new HashSet<>();
 
-        for (int i = 0; i < searchEngineGroup.getChildCount(); i++) {
-            final CompoundButton engineButton = (CompoundButton) searchEngineGroup.getChildAt(i);
+        for (int i = 0; i < getSearchEngineGroup().getChildCount(); i++) {
+            final CompoundButton engineButton = (CompoundButton) getSearchEngineGroup().getChildAt(i);
             if (engineButton.isChecked()) {
                 engineIdSet.add((String) engineButton.getTag());
             }
@@ -61,8 +61,8 @@ public Set<String> getCheckedEngineIds() {
 
     // Whenever an engine is checked or unchecked, we notify the menu
     protected void bindEngineCheckboxesToMenu() {
-        for (int i = 0; i < searchEngineGroup.getChildCount(); i++) {
-            final CompoundButton engineButton = (CompoundButton) searchEngineGroup.getChildAt(i);
+        for (int i = 0; i < getSearchEngineGroup().getChildCount(); i++) {
+            final CompoundButton engineButton = (CompoundButton) getSearchEngineGroup().getChildAt(i);
             engineButton.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
                 @Override
                 public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
@@ -73,8 +73,8 @@ public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
     }
 
     public boolean atLeastOneEngineChecked() {
-        for (int i = 0; i < searchEngineGroup.getChildCount(); i++) {
-            final CompoundButton engineButton = (CompoundButton) searchEngineGroup.getChildAt(i);
+        for (int i = 0; i < getSearchEngineGroup().getChildCount(); i++) {
+            final CompoundButton engineButton = (CompoundButton) getSearchEngineGroup().getChildAt(i);
             if (engineButton.isChecked()) {
                return true;
             }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.java
deleted file mode 100644
index dd7552964031..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.java
+++ /dev/null
@@ -1,54 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.search;
-
-import android.content.Context;
-import android.util.AttributeSet;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.CompoundButton;
-import android.widget.RadioGroup;
-
-import org.mozilla.focus.R;
-import org.mozilla.focus.telemetry.TelemetryWrapper;
-import org.mozilla.focus.utils.Settings;
-
-public class RadioSearchEngineListPreference extends SearchEngineListPreference implements RadioGroup.OnCheckedChangeListener {
-
-    public RadioSearchEngineListPreference(Context context, AttributeSet attrs) {
-        super(context, attrs);
-    }
-
-    public RadioSearchEngineListPreference(Context context, AttributeSet attrs, int defStyleAttr) {
-        super(context, attrs, defStyleAttr);
-    }
-
-    @Override
-    protected View onCreateView(ViewGroup parent) {
-        final View view = super.onCreateView(parent);
-        searchEngineGroup.setOnCheckedChangeListener(this);
-        return view;
-    }
-
-    @Override
-    protected int getItemResId() {
-        return R.layout.search_engine_radio_button;
-    }
-
-    @Override
-    protected void updateDefaultItem(CompoundButton defaultButton) {
-        defaultButton.setChecked(true);
-    }
-
-
-    @Override
-    public void onCheckedChanged (RadioGroup group, int checkedId) {
-        final SearchEngine newDefaultEngine = searchEngines.get(checkedId);
-        Settings.getInstance(group.getContext()).setDefaultSearchEngine(newDefaultEngine);
-        final String source = SearchEngineManager.getInstance().isCustomSearchEngine(newDefaultEngine.getIdentifier(), getContext()) ?
-                SearchEngineManager.ENGINE_TYPE_CUSTOM : SearchEngineManager.ENGINE_TYPE_BUNDLED;
-        TelemetryWrapper.setDefaultSearchEngineEvent(source);
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.kt
new file mode 100644
index 000000000000..315efc171099
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/RadioSearchEngineListPreference.kt
@@ -0,0 +1,47 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.content.Context
+import android.util.AttributeSet
+import android.view.View
+import android.view.ViewGroup
+import android.widget.CompoundButton
+import android.widget.RadioGroup
+import org.mozilla.focus.R
+import org.mozilla.focus.telemetry.TelemetryWrapper
+import org.mozilla.focus.utils.Settings
+
+class RadioSearchEngineListPreference : SearchEngineListPreference, RadioGroup.OnCheckedChangeListener {
+
+    override val itemResId: Int
+        get() = R.layout.search_engine_radio_button
+
+    @Suppress("unused")
+    constructor(context: Context, attrs: AttributeSet) : super(context, attrs)
+
+    @Suppress("unused")
+    constructor(context: Context, attrs: AttributeSet, defStyleAttr: Int) : super(context, attrs, defStyleAttr)
+
+    override fun onCreateView(parent: ViewGroup): View {
+        val view = super.onCreateView(parent)
+        searchEngineGroup!!.setOnCheckedChangeListener(this)
+        return view
+    }
+
+    override fun updateDefaultItem(defaultButton: CompoundButton) {
+        defaultButton.isChecked = true
+    }
+
+    override fun onCheckedChanged(group: RadioGroup, checkedId: Int) {
+        val newDefaultEngine = searchEngines[checkedId]
+        Settings.getInstance(group.context).setDefaultSearchEngine(newDefaultEngine)
+        val source = if (CustomSearchEngineStore.isCustomSearchEngine(newDefaultEngine.identifier, context))
+            CustomSearchEngineStore.ENGINE_TYPE_CUSTOM
+        else
+            CustomSearchEngineStore.ENGINE_TYPE_BUNDLED
+        TelemetryWrapper.setDefaultSearchEngineEvent(source)
+    }
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngine.java b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngine.java
deleted file mode 100644
index b96fc2ac17c3..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngine.java
+++ /dev/null
@@ -1,108 +0,0 @@
-/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.search;
-
-import android.graphics.Bitmap;
-import android.net.Uri;
-
-import java.util.ArrayList;
-import java.util.List;
-import java.util.Locale;
-
-import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
-import org.mozilla.focus.utils.UrlUtils;
-
-public class SearchEngine {
-
-    // Parameters copied from nsSearchService.js
-    private static final String MOZ_PARAM_LOCALE = "\\{moz:locale\\}";
-    private static final String MOZ_PARAM_DIST_ID = "\\{moz:distributionID\\}";
-    private static final String MOZ_PARAM_OFFICIAL = "\\{moz:official\\}";
-
-    // Supported OpenSearch parameters
-    // See http://opensearch.a9.com/spec/1.1/querysyntax/#core
-    private static final String OS_PARAM_USER_DEFINED = "\\{searchTerms\\??\\}";
-    private static final String OS_PARAM_INPUT_ENCODING = "\\{inputEncoding\\??\\}";
-    private static final String OS_PARAM_LANGUAGE = "\\{language\\??\\}";
-    private static final String OS_PARAM_OUTPUT_ENCODING = "\\{outputEncoding\\??\\}";
-    private static final String OS_PARAM_OPTIONAL = "\\{(?:\\w+:)?\\w+\\?\\}";
-
-    private final String identifier; // For custom search engines, this is the same as name.
-    /* package */ String name;
-    /* package */ Bitmap icon;
-    /* package */ List<Uri> resultsUris;
-    // We don't currently support search suggestions, however that's something that we might
-    // need to support in future, moreover this is already stored in the input files that we're merely
-    // moving into memory - hence we probably want to keep this field for now:
-    @SuppressFBWarnings(value = "URF_UNREAD_FIELD", justification = "Needed for future versions, reflects on-disk format")
-    /* package */ Uri suggestUri;
-
-    /* package */ SearchEngine(String identifier) {
-        this.identifier = identifier;
-        this.resultsUris = new ArrayList<>();
-    }
-
-    public String getName() {
-        return name;
-    }
-
-    public String getIdentifier() {
-        return identifier;
-    }
-
-    public Bitmap getIcon() {
-        return icon;
-    }
-
-    public String buildSearchUrl(final String searchTerm) {
-        if (resultsUris.isEmpty()) {
-            return searchTerm;
-        }
-
-        // The parse should have put the best URL for this device at the beginning of the list.
-        final Uri searchUri = resultsUris.get(0);
-
-        final String template = Uri.decode(searchUri.toString());
-        final String urlWithSubstitutions = paramSubstitution(template, Uri.encode(searchTerm));
-        return UrlUtils.normalize(urlWithSubstitutions); // User-entered search engines may need normalization.
-    }
-
-    public String getBaseSearchUrl() {
-        if (!resultsUris.isEmpty()) {
-            return resultsUris.get(0).toString();
-        } else {
-            return null;
-        }
-    }
-
-    /**
-     * Formats template string with proper parameters. Modeled after
-     * ParamSubstitution in nsSearchService.js
-     *
-     * @param template
-     * @param query
-     * @return
-     */
-    private String paramSubstitution(String template, String query) {
-        final String locale = Locale.getDefault().toString();
-
-        template = template.replaceAll(MOZ_PARAM_LOCALE, locale);
-        template = template.replaceAll(MOZ_PARAM_DIST_ID, "");
-        template = template.replaceAll(MOZ_PARAM_OFFICIAL, "unofficial");
-
-        template = template.replaceAll(OS_PARAM_USER_DEFINED, query);
-        template = template.replaceAll(OS_PARAM_INPUT_ENCODING, "UTF-8");
-
-        template = template.replaceAll(OS_PARAM_LANGUAGE, locale);
-        template = template.replaceAll(OS_PARAM_OUTPUT_ENCODING, "UTF-8");
-
-        // Replace any optional parameters
-        template = template.replaceAll(OS_PARAM_OPTIONAL, "");
-
-        return template;
-    }
-
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.java b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.java
deleted file mode 100644
index 343a401617a6..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.java
+++ /dev/null
@@ -1,108 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.search;
-
-import android.content.Context;
-import android.content.res.Resources;
-import android.graphics.drawable.BitmapDrawable;
-import android.graphics.drawable.Drawable;
-import android.preference.Preference;
-import android.support.v7.widget.RecyclerView;
-import android.util.AttributeSet;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.CompoundButton;
-import android.widget.RadioGroup;
-
-import org.mozilla.focus.R;
-
-import java.util.Collections;
-import java.util.Comparator;
-import java.util.List;
-
-public abstract class SearchEngineListPreference extends Preference {
-    protected List<SearchEngine> searchEngines;
-    protected RadioGroup searchEngineGroup;
-
-    public SearchEngineListPreference(Context context, AttributeSet attrs) {
-        super(context, attrs);
-        setLayoutResource(R.layout.preference_search_engine_chooser);
-    }
-
-    public SearchEngineListPreference(Context context, AttributeSet attrs, int defStyleAttr) {
-        super(context, attrs, defStyleAttr);
-        setLayoutResource(R.layout.preference_search_engine_chooser);
-    }
-
-    @Override
-    protected View onCreateView(ViewGroup parent) {
-        final View layoutView = super.onCreateView(parent);
-        searchEngineGroup = layoutView.findViewById(R.id.search_engine_group);
-        final Context context = searchEngineGroup.getContext();
-        final SearchEngineManager sem = SearchEngineManager.getInstance();
-        searchEngines = sem.getSearchEngines();
-
-        Collections.sort(this.searchEngines, new Comparator<SearchEngine>() {
-            @Override
-            public int compare(SearchEngine engine1, SearchEngine engine2) {
-                return engine1.getName().compareToIgnoreCase(engine2.getName());
-            }
-        });
-
-        refreshSearchEngineViews(context, sem);
-
-        return layoutView;
-    }
-
-    protected abstract int getItemResId();
-    protected abstract void updateDefaultItem(CompoundButton defaultButton);
-
-    public void refetchSearchEngines() {
-        final SearchEngineManager sem = SearchEngineManager.getInstance();
-        sem.loadSearchEngines(getContext());
-        searchEngines = sem.getSearchEngines();
-        refreshSearchEngineViews(getContext(), sem);
-    }
-
-    private void refreshSearchEngineViews(Context context, SearchEngineManager sem) {
-        if (searchEngineGroup == null) {
-            // We want to refresh the search engine list of this preference in onResume,
-            // but the first time this preference is created onResume is called before onCreateView
-            // so searchEngineGroup is not set yet.
-            return;
-        }
-
-        final String defaultSearchEngine = sem.getDefaultSearchEngine(context).getIdentifier();
-
-        searchEngineGroup.removeAllViews();
-
-        final LayoutInflater layoutInflater = LayoutInflater.from(context);
-        final RecyclerView.LayoutParams layoutParams = new RecyclerView.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT);
-
-        for (int i = 0; i < searchEngines.size(); i++) {
-            final SearchEngine engine = searchEngines.get(i);
-            final String engineId = engine.getIdentifier();
-            final CompoundButton engineItem = makeButtonFromSearchEngine(engine, layoutInflater, context.getResources());
-            engineItem.setId(i);
-            engineItem.setTag(engineId);
-            if (engineId.equals(defaultSearchEngine)) {
-                updateDefaultItem(engineItem);
-            }
-            searchEngineGroup.addView(engineItem, layoutParams);
-        }
-    }
-
-    private CompoundButton makeButtonFromSearchEngine(SearchEngine engine, LayoutInflater layoutInflater, Resources res) {
-        final CompoundButton buttonItem = (CompoundButton) layoutInflater.inflate(getItemResId(), null);
-        buttonItem.setText(engine.getName());
-        final int iconSize = (int) res.getDimension(R.dimen.preference_icon_drawable_size);
-        final BitmapDrawable engineIcon = new BitmapDrawable(res, engine.getIcon());
-        engineIcon.setBounds(0, 0, iconSize, iconSize);
-        final Drawable[] drawables = buttonItem.getCompoundDrawables();
-        buttonItem.setCompoundDrawables(engineIcon, null, drawables[2], null);
-        return buttonItem;
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.kt
new file mode 100644
index 000000000000..4d17f068968d
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineListPreference.kt
@@ -0,0 +1,111 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.content.Context
+import android.content.res.Resources
+import android.graphics.drawable.BitmapDrawable
+import android.preference.Preference
+import android.support.v7.widget.RecyclerView
+import android.util.AttributeSet
+import android.view.LayoutInflater
+import android.view.View
+import android.view.ViewGroup
+import android.widget.CompoundButton
+import android.widget.RadioGroup
+import kotlinx.coroutines.experimental.android.UI
+import kotlinx.coroutines.experimental.launch
+import mozilla.components.browser.search.SearchEngine
+import org.mozilla.focus.Components
+import org.mozilla.focus.R
+import org.mozilla.focus.utils.Settings
+
+abstract class SearchEngineListPreference : Preference {
+    protected var searchEngines: List<SearchEngine> = emptyList()
+    protected var searchEngineGroup: RadioGroup? = null
+
+    protected abstract val itemResId: Int
+
+    constructor(context: Context, attrs: AttributeSet) : super(context, attrs) {
+        layoutResource = R.layout.preference_search_engine_chooser
+    }
+
+    constructor(context: Context, attrs: AttributeSet, defStyleAttr: Int) : super(context, attrs, defStyleAttr) {
+        layoutResource = R.layout.preference_search_engine_chooser
+    }
+
+    override fun onCreateView(parent: ViewGroup): View {
+        val layoutView = super.onCreateView(parent)
+        searchEngineGroup = layoutView.findViewById(R.id.search_engine_group)
+        val context = searchEngineGroup!!.context
+
+        searchEngines = Components.searchEngineManager.getSearchEngines(context)
+                .sortedBy { it.name }
+
+        refreshSearchEngineViews(context)
+
+        return layoutView
+    }
+
+    protected abstract fun updateDefaultItem(defaultButton: CompoundButton)
+
+    fun refetchSearchEngines() {
+        launch (UI) {
+            searchEngines = Components.searchEngineManager
+                    .load(this@SearchEngineListPreference.context)
+                    .await()
+                    .sortedBy { it.name }
+            refreshSearchEngineViews(this@SearchEngineListPreference.context)
+        }
+    }
+
+    private fun refreshSearchEngineViews(context: Context) {
+        if (searchEngineGroup == null) {
+            // We want to refresh the search engine list of this preference in onResume,
+            // but the first time this preference is created onResume is called before onCreateView
+            // so searchEngineGroup is not set yet.
+            return
+        }
+
+        val defaultSearchEngine = Components.searchEngineManager.getDefaultSearchEngine(
+                context,
+                Settings.getInstance(context).defaultSearchEngineName
+        ).identifier
+
+        searchEngineGroup!!.removeAllViews()
+
+        val layoutInflater = LayoutInflater.from(context)
+        val layoutParams = RecyclerView.LayoutParams(
+                ViewGroup.LayoutParams.MATCH_PARENT,
+                ViewGroup.LayoutParams.WRAP_CONTENT)
+
+        for (i in searchEngines.indices) {
+            val engine = searchEngines[i]
+            val engineId = engine.identifier
+            val engineItem = makeButtonFromSearchEngine(engine, layoutInflater, context.resources)
+            engineItem.id = i
+            engineItem.tag = engineId
+            if (engineId == defaultSearchEngine) {
+                updateDefaultItem(engineItem)
+            }
+            searchEngineGroup!!.addView(engineItem, layoutParams)
+        }
+    }
+
+    private fun makeButtonFromSearchEngine(
+            engine: SearchEngine,
+            layoutInflater: LayoutInflater,
+            res: Resources
+    ): CompoundButton {
+        val buttonItem = layoutInflater.inflate(itemResId, null) as CompoundButton
+        buttonItem.text = engine.name
+        val iconSize = res.getDimension(R.dimen.preference_icon_drawable_size).toInt()
+        val engineIcon = BitmapDrawable(res, engine.icon)
+        engineIcon.setBounds(0, 0, iconSize, iconSize)
+        val drawables = buttonItem.compoundDrawables
+        buttonItem.setCompoundDrawables(engineIcon, null, drawables[2], null)
+        return buttonItem
+    }
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineManager.java b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineManager.java
deleted file mode 100644
index 71c6b1061909..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineManager.java
+++ /dev/null
@@ -1,365 +0,0 @@
-/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.search;
-
-import android.content.BroadcastReceiver;
-import android.content.Context;
-import android.content.Intent;
-import android.content.IntentFilter;
-import android.content.SharedPreferences;
-import android.content.res.AssetManager;
-import android.graphics.Bitmap;
-import android.support.annotation.WorkerThread;
-import android.util.Log;
-
-import org.json.JSONArray;
-import org.json.JSONException;
-import org.json.JSONObject;
-import org.mozilla.focus.locale.Locales;
-import org.mozilla.focus.shortcut.IconGenerator;
-import org.mozilla.focus.utils.BitmapUtils;
-import org.mozilla.focus.utils.Settings;
-import org.w3c.dom.Document;
-import org.w3c.dom.Element;
-import org.xmlpull.v1.XmlPullParserException;
-
-import java.io.ByteArrayInputStream;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.StringWriter;
-import java.io.Writer;
-import java.nio.charset.StandardCharsets;
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Collections;
-import java.util.LinkedHashSet;
-import java.util.LinkedList;
-import java.util.List;
-import java.util.Locale;
-import java.util.Set;
-
-import javax.xml.parsers.DocumentBuilderFactory;
-import javax.xml.parsers.ParserConfigurationException;
-import javax.xml.transform.OutputKeys;
-import javax.xml.transform.Transformer;
-import javax.xml.transform.TransformerConfigurationException;
-import javax.xml.transform.TransformerException;
-import javax.xml.transform.TransformerFactory;
-import javax.xml.transform.dom.DOMSource;
-import javax.xml.transform.stream.StreamResult;
-
-import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
-import mozilla.components.ktx.android.content.res.AssetManagerKt;
-
-public class SearchEngineManager extends BroadcastReceiver {
-    private static final String LOG_TAG = SearchEngineManager.class.getSimpleName();
-
-    public static final String PREF_FILE_SEARCH_ENGINES = "custom-search-engines";
-    public static final String PREF_KEY_CUSTOM_SEARCH_ENGINES = "pref_custom_search_engines";
-    public static final String PREF_KEY_HIDDEN_DEFAULT_ENGINES = "hidden_default_engines";
-    private static final String PREF_KEY_CUSTOM_SEARCH_VERSION = "pref_custom_search_version";
-    private static final int CUSTOM_SEARCH_VERSION = 1;
-
-    public static final String ENGINE_TYPE_CUSTOM = "custom";
-    public static final String ENGINE_TYPE_BUNDLED = "bundled";
-
-    private static SearchEngineManager instance = new SearchEngineManager();
-
-    private List<SearchEngine> searchEngines;
-
-    /**
-     * A flag indicating that data has been loaded, or is loading. This lets us detect if data
-     * has been requested without a preceeding init().
-     */
-    private boolean loadHasBeenTriggered = false;
-
-    public static SearchEngineManager getInstance() {
-        return instance;
-    }
-
-    private SearchEngineManager() {}
-
-    public static boolean addSearchEngine(SharedPreferences sharedPreferences, Context context, String engineName, String searchQuery) {
-        // This is not for a homescreen shortcut so we don't want an adaptive launcher icon.
-        final Bitmap iconBitmap = IconGenerator.generateLauncherIconPreOreo(context, engineName.charAt(0));
-        final String searchEngineXml = buildSearchEngineXML(engineName, searchQuery, iconBitmap);
-        if (searchEngineXml == null) {
-            return false;
-        }
-        final Set<String> existingEngines = sharedPreferences.getStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, Collections.<String>emptySet());
-        final Set<String> newEngines = new LinkedHashSet<>();
-        newEngines.addAll(existingEngines);
-        newEngines.add(engineName);
-
-        sharedPreferences.edit().putInt(PREF_KEY_CUSTOM_SEARCH_VERSION, CUSTOM_SEARCH_VERSION)
-                .putStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, newEngines)
-                .putString(engineName, searchEngineXml)
-                .apply();
-
-        return true;
-    }
-
-    public static String buildSearchEngineXML(String engineName, String searchQuery, Bitmap iconBitmap) {
-        Document document = null;
-        try {
-            document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
-            final Element rootElement = document.createElement("OpenSearchDescription");
-            rootElement.setAttribute("xmlns", "http://a9.com/-/spec/opensearch/1.1/");
-            document.appendChild(rootElement);
-
-            final Element shortNameElement = document.createElement("ShortName");
-            shortNameElement.setTextContent(engineName);
-            rootElement.appendChild(shortNameElement);
-
-            final Element imageElement = document.createElement("Image");
-            imageElement.setAttribute("width", "16");
-            imageElement.setAttribute("height", "16");
-            imageElement.setTextContent(BitmapUtils.getBase64EncodedDataUriFromBitmap(iconBitmap));
-            rootElement.appendChild(imageElement);
-
-            final Element descriptionElement = document.createElement("Description");
-            descriptionElement.setTextContent(engineName);
-            rootElement.appendChild(descriptionElement);
-
-            final Element urlElement = document.createElement("Url");
-            urlElement.setAttribute("type", "text/html");
-            // Simple implementation that assumes "%s" terminator from UrlUtils.isValidSearchEngineQueryUrl
-            final String templateSearchString = searchQuery.substring(0, searchQuery.length() - 2) + "{searchTerms}";
-            urlElement.setAttribute("template", templateSearchString);
-            rootElement.appendChild(urlElement);
-
-        } catch (ParserConfigurationException e) {
-            Log.e(LOG_TAG, "Couldn't create new Document for building search engine XML", e);
-            return null;
-        }
-        return XMLtoString(document);
-    }
-
-    private static String XMLtoString(Document doc) {
-        if (doc == null) {
-            return null;
-        }
-
-        final Writer writer = new StringWriter();
-        try {
-            final Transformer tf = TransformerFactory.newInstance().newTransformer();
-            tf.setOutputProperty(OutputKeys.ENCODING, "UTF-8");
-            tf.transform(new DOMSource(doc), new StreamResult(writer));
-        } catch (TransformerConfigurationException e) {
-            return null;
-        } catch (TransformerException e) {
-            return null;
-        }
-        return writer.toString();
-    }
-
-    public void init(Context context) {
-        context.registerReceiver(this, new IntentFilter(Intent.ACTION_LOCALE_CHANGED));
-
-        loadSearchEngines(context);
-    }
-
-    @Override
-    public void onReceive(Context context, Intent intent) {
-        if (!Intent.ACTION_LOCALE_CHANGED.equals(intent.getAction())) {
-            // This is not the broadcast you are looking for.
-            return;
-        }
-
-        loadSearchEngines(context.getApplicationContext());
-    }
-
-    public void loadSearchEngines(final Context context) {
-        invalidateSearchEngines();
-        new Thread("SearchEngines-Load") {
-            @Override
-            public void run() {
-                loadFromDisk(context);
-            }
-        }.start();
-    }
-
-    @WorkerThread
-    private synchronized void loadFromDisk(Context context) {
-        loadHasBeenTriggered = true;
-        final AssetManager assetManager = context.getAssets();
-        final Locale locale = Locale.getDefault();
-        final List<SearchEngine> searchEngines = new ArrayList<>();
-
-        try {
-            final JSONArray engineNames = loadSearchEngineListForLocale(context);
-
-            final String localePath = "search/" + Locales.getLanguageTag(locale);
-            final String languagePath = "search/" + Locales.getLanguage(locale);
-            final String defaultPath = "search/default";
-
-            final List<String> localeEngines = Arrays.asList(assetManager.list(localePath));
-            final List<String> languageEngines = Arrays.asList(assetManager.list(languagePath));
-            final List<String> defaultEngines = Arrays.asList(assetManager.list(defaultPath));
-
-           final SharedPreferences sharedPreferences = context.getSharedPreferences(
-                   SearchEngineManager.PREF_FILE_SEARCH_ENGINES, Context.MODE_PRIVATE);
-            final Set<String> hiddenEngines = sharedPreferences.getStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, Collections.<String>emptySet());
-
-            for (int i = 0; i < engineNames.length(); i++) {
-                final String engineName = engineNames.getString(i);
-                // Engine names are reused as engine ids, so they are the same.
-                if (hiddenEngines.contains(engineName)) {
-                    continue;
-                }
-                final String fileName = engineName + ".xml";
-
-                if (localeEngines.contains(fileName)) {
-                    searchEngines.add(SearchEngineParser.load(assetManager, engineName, localePath + "/" + fileName));
-                } else if (languageEngines.contains(fileName)) {
-                    searchEngines.add(SearchEngineParser.load(assetManager, engineName, languagePath + "/" + fileName));
-                } else if (defaultEngines.contains(fileName)) {
-                    searchEngines.add(SearchEngineParser.load(assetManager, engineName, defaultPath + "/" + fileName));
-                } else {
-                    Log.e(LOG_TAG, "Couldn't find configuration for engine: " + engineName);
-                }
-            }
-        } catch (IOException e) {
-            Log.e(LOG_TAG, "IOException while loading search engines", e);
-        } catch (JSONException e) {
-            throw new AssertionError("Reading search engine failed: ", e);
-        } finally {
-            searchEngines.addAll(loadCustomSearchEngines(context));
-            this.searchEngines = searchEngines;
-
-            notifyAll();
-        }
-    }
-
-    private List<SearchEngine> loadCustomSearchEngines(Context context) {
-        final List<SearchEngine> customEngines = new LinkedList<>();
-        final SharedPreferences prefs = context.getSharedPreferences(PREF_FILE_SEARCH_ENGINES, Context.MODE_PRIVATE);
-        final Set<String> engines = prefs.getStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, Collections.<String>emptySet());
-        try {
-            for (String engine : engines) {
-                final InputStream engineInputStream = new ByteArrayInputStream(prefs.getString(engine, "").getBytes(StandardCharsets.UTF_8));
-                // Search engine identifier is the search engine name.
-                customEngines.add(SearchEngineParser.load(engine, engineInputStream));
-            }
-        } catch (IOException e) {
-            Log.e(LOG_TAG, "IOException while loading custom search engines", e);
-        } catch (XmlPullParserException e) {
-            Log.e(LOG_TAG, "Couldn't load custom search engines", e);
-        }
-        return customEngines;
-    }
-
-    public boolean isCustomSearchEngine(String engineId, Context context) {
-        for (SearchEngine e : loadCustomSearchEngines(context)) {
-            if (e.getIdentifier().equals(engineId)) {
-                return true;
-            }
-        }
-        return false;
-    }
-
-    private JSONArray loadSearchEngineListForLocale(Context context) throws IOException {
-        try {
-            final Locale locale = Locale.getDefault();
-
-            final JSONObject configuration = AssetManagerKt.readJSONObject(context.getAssets(), "search/search_configuration.json");
-
-            // Try to find a configuration for the language tag first (de-DE)
-            final String languageTag = Locales.getLanguageTag(locale);
-            if (configuration.has(languageTag)) {
-                return configuration.getJSONArray(languageTag);
-            }
-
-            // Try to find a configuration for just the language (de)
-            final String language = Locales.getLanguage(locale);
-            if (configuration.has(language)) {
-                return configuration.getJSONArray(language);
-            }
-
-            // No configuration for the current locale found. Let's use the default configuration.
-            return configuration.getJSONArray("default");
-        } catch (JSONException e) {
-            // Assertion error because this shouldn't happen: We check whether a key exists before
-            // reading it. An error here would mean the JSON file is corrupt.
-            throw new AssertionError("Reading search configuration failed", e);
-        }
-    }
-
-    public synchronized List<SearchEngine> getSearchEngines() {
-        awaitLoadingSearchEnginesLocked();
-
-        return searchEngines;
-    }
-
-    public synchronized SearchEngine getDefaultSearchEngine(Context context) {
-        awaitLoadingSearchEnginesLocked();
-
-        final String defaultSearch = Settings.getInstance(context).getDefaultSearchEngineName();
-        if (defaultSearch != null) {
-            for (SearchEngine searchEngine : searchEngines) {
-                if (defaultSearch.equals(searchEngine.getName())) {
-                    return searchEngine;
-                }
-            }
-        }
-
-        return searchEngines.get(0);
-    }
-
-    // Our (searchEngines == null) check is deemed to be an unsynchronised access. Similarly loadHasBeenTriggered
-    // also doesn't need synchronisation:
-    @SuppressFBWarnings(value = "IS2_INCONSISTENT_SYNC", justification = "Variable is not being accessed, it is merely being tested for existence")
-    public void awaitLoadingSearchEnginesLocked() {
-        if (!loadHasBeenTriggered) {
-            throw new IllegalStateException("Attempting to retrieve search engines without a corresponding init()");
-        }
-
-        while (searchEngines == null) {
-            try {
-                wait();
-            } catch (InterruptedException ignored) {
-                // Ignore
-            }
-        }
-    }
-
-    public static void removeSearchEngines(Set<String> engineIdsToRemove, SharedPreferences sharedPreferences) {
-        // Check custom engines first.
-        final Set<String> customEngines = sharedPreferences.getStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, Collections.<String>emptySet());
-        final Set<String> remainingCustomEngines = new LinkedHashSet<>();
-        final SharedPreferences.Editor enginesEditor = sharedPreferences.edit();
-
-        for (String engineId : customEngines) {
-            if (engineIdsToRemove.contains(engineId)) {
-                enginesEditor.remove(engineId);
-                // Handled engine removal.
-                engineIdsToRemove.remove(engineId);
-            } else {
-                remainingCustomEngines.add(engineId);
-            }
-        }
-        enginesEditor.putStringSet(PREF_KEY_CUSTOM_SEARCH_ENGINES, remainingCustomEngines);
-
-        // Everything else must be a default engine.
-        final Set<String> hiddenDefaultEngines = sharedPreferences.getStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, Collections.<String>emptySet());
-        engineIdsToRemove.addAll(hiddenDefaultEngines);
-        enginesEditor.putStringSet(PREF_KEY_HIDDEN_DEFAULT_ENGINES, engineIdsToRemove);
-
-        enginesEditor.apply();
-    }
-
-    public static boolean hasAllDefaultSearchEngines(SharedPreferences sharedPreferences) {
-        return !sharedPreferences.contains(PREF_KEY_HIDDEN_DEFAULT_ENGINES);
-    }
-
-    public static synchronized void restoreDefaultSearchEngines(SharedPreferences sharedPreferences) {
-        sharedPreferences.edit().remove(PREF_KEY_HIDDEN_DEFAULT_ENGINES).apply();
-    }
-
-    private synchronized void invalidateSearchEngines() {
-        searchEngines = null;
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineParser.java b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineParser.java
deleted file mode 100644
index 732d30a3677d..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineParser.java
+++ /dev/null
@@ -1,167 +0,0 @@
-/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.search;
-
-import android.content.res.AssetManager;
-import android.graphics.BitmapFactory;
-import android.net.Uri;
-import android.support.annotation.VisibleForTesting;
-import android.util.Base64;
-
-import org.xmlpull.v1.XmlPullParser;
-import org.xmlpull.v1.XmlPullParserException;
-import org.xmlpull.v1.XmlPullParserFactory;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.InputStreamReader;
-import java.nio.charset.StandardCharsets;
-
-/**
- * A very simple parser for search plugins.
- */
-/* package */ class SearchEngineParser {
-    private static final String URLTYPE_SUGGEST_JSON = "application/x-suggestions+json";
-    private static final String URLTYPE_SEARCH_HTML  = "text/html";
-    private static final String URL_REL_MOBILE = "mobile";
-    private static final String SEARCH_TERM_VALUE = "{searchTerms}";
-
-    private static final String IMAGE_URI_PREFIX = "data:image/png;base64,";
-
-    public static SearchEngine load(AssetManager assetManager, String identifier, String path) throws IOException {
-        try (final InputStream stream = assetManager.open(path)) {
-            return load(identifier, stream);
-        } catch (XmlPullParserException e) {
-            throw new AssertionError("Parser exception while reading " + path, e);
-        }
-    }
-
-    /* package */ @VisibleForTesting static SearchEngine load(String identifier, InputStream stream) throws IOException, XmlPullParserException {
-        final SearchEngine searchEngine = new SearchEngine(identifier);
-
-        XmlPullParser parser = XmlPullParserFactory.newInstance().newPullParser();
-        parser.setInput(new InputStreamReader(stream, StandardCharsets.UTF_8));
-        parser.next();
-
-        readSearchPlugin(parser, searchEngine);
-
-        return searchEngine;
-    }
-
-    private static void readSearchPlugin(XmlPullParser parser, SearchEngine searchEngine) throws XmlPullParserException, IOException {
-        if (XmlPullParser.START_TAG != parser.getEventType()) {
-            throw new XmlPullParserException("Expected start tag: " + parser.getPositionDescription());
-        }
-
-        final String name = parser.getName();
-        if (!"SearchPlugin".equals(name) && !"OpenSearchDescription".equals(name)) {
-            throw new XmlPullParserException("Expected <SearchPlugin> or <OpenSearchDescription> as root tag: "
-                    + parser.getPositionDescription());
-        }
-
-        while (parser.next() != XmlPullParser.END_TAG) {
-            if (parser.getEventType() != XmlPullParser.START_TAG) {
-                continue;
-            }
-
-            final String tag = parser.getName();
-
-            if (tag.equals("ShortName")) {
-                readShortName(parser, searchEngine);
-            } else if (tag.equals("Url")) {
-                readUrl(parser, searchEngine);
-            } else if (tag.equals("Image")) {
-                readImage(parser, searchEngine);
-            } else {
-                skip(parser);
-            }
-        }
-    }
-
-    private static void readUrl(XmlPullParser parser, SearchEngine searchEngine) throws XmlPullParserException, IOException {
-        parser.require(XmlPullParser.START_TAG, null, "Url");
-
-        final String type = parser.getAttributeValue(null, "type");
-        final String template = parser.getAttributeValue(null, "template");
-        final String rel = parser.getAttributeValue(null, "rel");
-
-        Uri uri = Uri.parse(template);
-
-        while (parser.next() != XmlPullParser.END_TAG) {
-            if (parser.getEventType() != XmlPullParser.START_TAG) {
-                continue;
-            }
-
-            final String tag = parser.getName();
-
-            if (tag.equals("Param")) {
-                final String name = parser.getAttributeValue(null, "name");
-                final String value = parser.getAttributeValue(null, "value");
-                uri = uri.buildUpon().appendQueryParameter(name, value).build();
-                parser.nextTag();
-            } else {
-                skip(parser);
-            }
-        }
-
-        if (type.equals(URLTYPE_SEARCH_HTML)) {
-            // Prefer mobile URIs.
-            if (rel != null && rel.equals(URL_REL_MOBILE)) {
-                searchEngine.resultsUris.add(0, uri);
-            } else {
-                searchEngine.resultsUris.add(uri);
-            }
-        } else if (type.equals(URLTYPE_SUGGEST_JSON)) {
-            searchEngine.suggestUri = uri;
-        }
-    }
-
-    private static void skip(XmlPullParser parser) throws XmlPullParserException, IOException {
-        if (parser.getEventType() != XmlPullParser.START_TAG) {
-            throw new IllegalStateException();
-        }
-        int depth = 1;
-        while (depth != 0) {
-            switch (parser.next()) {
-                case XmlPullParser.END_TAG:
-                    depth--;
-                    break;
-                case XmlPullParser.START_TAG:
-                    depth++;
-                    break;
-                default:
-                    // Do nothing - we're skipping content
-            }
-        }
-    }
-
-    private static void readShortName(XmlPullParser parser, SearchEngine searchEngine) throws IOException, XmlPullParserException {
-        parser.require(XmlPullParser.START_TAG, null, "ShortName");
-        if (parser.next() == XmlPullParser.TEXT) {
-            searchEngine.name = parser.getText();
-            parser.nextTag();
-        }
-    }
-
-    private static void readImage(XmlPullParser parser, SearchEngine searchEngine) throws IOException, XmlPullParserException {
-        parser.require(XmlPullParser.START_TAG, null, "Image");
-
-        if (parser.next() != XmlPullParser.TEXT) {
-            return;
-        }
-
-        final String uri = parser.getText();
-        if (!uri.startsWith(IMAGE_URI_PREFIX)) {
-            return;
-        }
-
-        final byte[] raw = Base64.decode(uri.substring(IMAGE_URI_PREFIX.length()), Base64.DEFAULT);
-
-        searchEngine.icon = BitmapFactory.decodeByteArray(raw, 0, raw.length);
-
-        parser.nextTag();
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.java b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.java
deleted file mode 100644
index c413d94ea3d9..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.java
+++ /dev/null
@@ -1,51 +0,0 @@
-/* -*- Mode: Java; c-basic-offset: 4; tab-width: 4; indent-tabs-mode: nil; -*-
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.search;
-
-import android.content.Context;
-import android.content.SharedPreferences;
-import android.preference.Preference;
-import android.util.AttributeSet;
-
-import org.mozilla.focus.R;
-import org.mozilla.focus.utils.Settings;
-
-/**
- * Preference for setting the default search engine.
- */
-public class SearchEnginePreference extends Preference implements SharedPreferences.OnSharedPreferenceChangeListener {
-    final Context context;
-
-    public SearchEnginePreference(Context context, AttributeSet attrs) {
-        super(context, attrs);
-        this.context = context;
-    }
-
-    public SearchEnginePreference(Context context, AttributeSet attrs, int defStyleAttr) {
-        super(context, attrs, defStyleAttr);
-        this.context = context;
-    }
-
-    @Override
-    protected void onAttachedToActivity() {
-        setTitle(SearchEngineManager.getInstance().getDefaultSearchEngine(getContext()).getName());
-        getPreferenceManager().getSharedPreferences().registerOnSharedPreferenceChangeListener(this);
-        super.onAttachedToActivity();
-    }
-
-    @Override
-    protected void onPrepareForRemoval() {
-        getPreferenceManager().getSharedPreferences().unregisterOnSharedPreferenceChangeListener(this);
-        super.onPrepareForRemoval();
-    }
-
-    @Override
-    public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {
-        if (key.equals(context.getResources().getString(R.string.pref_key_search_engine))) {
-            setTitle(Settings.getInstance(context).getDefaultSearchEngineName());
-        }
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.kt
new file mode 100644
index 000000000000..0f37a9d90a66
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEnginePreference.kt
@@ -0,0 +1,51 @@
+/* -*- Mode: Java; c-basic-offset: 4; tab-width: 4; indent-tabs-mode: nil; -*-
+ * This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.content.Context
+import android.content.SharedPreferences
+import android.preference.Preference
+import android.util.AttributeSet
+import org.mozilla.focus.Components
+import org.mozilla.focus.R
+import org.mozilla.focus.utils.Settings
+
+/**
+ * Preference for setting the default search engine.
+ */
+class SearchEnginePreference : Preference, SharedPreferences.OnSharedPreferenceChangeListener {
+    internal val context: Context
+
+    constructor(context: Context, attrs: AttributeSet) : super(context, attrs) {
+        this.context = context
+    }
+
+    constructor(context: Context, attrs: AttributeSet, defStyleAttr: Int) : super(context, attrs, defStyleAttr) {
+        this.context = context
+    }
+
+    override fun onAttachedToActivity() {
+        title = defaultSearchEngineName
+        preferenceManager.sharedPreferences.registerOnSharedPreferenceChangeListener(this)
+        super.onAttachedToActivity()
+    }
+
+    override fun onPrepareForRemoval() {
+        preferenceManager.sharedPreferences.unregisterOnSharedPreferenceChangeListener(this)
+        super.onPrepareForRemoval()
+    }
+
+    override fun onSharedPreferenceChanged(sharedPreferences: SharedPreferences, key: String) {
+        if (key == context.resources.getString(R.string.pref_key_search_engine)) {
+            title = defaultSearchEngineName
+        }
+    }
+
+    private val defaultSearchEngineName: String
+        get() = Components.searchEngineManager.getDefaultSearchEngine(
+                getContext(),
+                Settings.getInstance(context).defaultSearchEngineName).name
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineWriter.kt b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineWriter.kt
new file mode 100644
index 000000000000..024320c52f16
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/search/SearchEngineWriter.kt
@@ -0,0 +1,76 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.search
+
+import android.graphics.Bitmap
+import android.util.Log
+import org.mozilla.focus.utils.BitmapUtils
+import org.w3c.dom.Document
+import java.io.StringWriter
+import javax.xml.parsers.DocumentBuilderFactory
+import javax.xml.parsers.ParserConfigurationException
+import javax.xml.transform.OutputKeys
+import javax.xml.transform.TransformerConfigurationException
+import javax.xml.transform.TransformerException
+import javax.xml.transform.TransformerFactory
+import javax.xml.transform.dom.DOMSource
+import javax.xml.transform.stream.StreamResult
+
+internal class SearchEngineWriter {
+    companion object {
+        private const val LOG_TAG = "SearchEngineWriter"
+
+        fun buildSearchEngineXML(engineName: String, searchQuery: String, iconBitmap: Bitmap): String? {
+            try {
+                val document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument()
+                val rootElement = document!!.createElement("OpenSearchDescription")
+                rootElement.setAttribute("xmlns", "http://a9.com/-/spec/opensearch/1.1/")
+                document.appendChild(rootElement)
+
+                val shortNameElement = document.createElement("ShortName")
+                shortNameElement.setTextContent(engineName)
+                rootElement.appendChild(shortNameElement)
+
+                val imageElement = document.createElement("Image")
+                imageElement.setAttribute("width", "16")
+                imageElement.setAttribute("height", "16")
+                imageElement.setTextContent(BitmapUtils.getBase64EncodedDataUriFromBitmap(iconBitmap))
+                rootElement.appendChild(imageElement)
+
+                val descriptionElement = document.createElement("Description")
+                descriptionElement.setTextContent(engineName)
+                rootElement.appendChild(descriptionElement)
+
+                val urlElement = document.createElement("Url")
+                urlElement.setAttribute("type", "text/html")
+
+                // Simple implementation that assumes "%s" terminator from UrlUtils.isValidSearchEngineQueryUrl
+                val templateSearchString = searchQuery.substring(0, searchQuery.length - 2) + "{searchTerms}"
+                urlElement.setAttribute("template", templateSearchString)
+                rootElement.appendChild(urlElement)
+
+                return xmlToString(document)
+            } catch (e: ParserConfigurationException) {
+                Log.e(LOG_TAG, "Couldn't create new Document for building search engine XML", e)
+                return null
+            }
+        }
+
+        private fun xmlToString(doc: Document): String? {
+            val writer = StringWriter()
+            try {
+                val tf = TransformerFactory.newInstance().newTransformer()
+                tf.setOutputProperty(OutputKeys.ENCODING, "UTF-8")
+                tf.transform(DOMSource(doc), StreamResult(writer))
+            } catch (e: TransformerConfigurationException) {
+                return null
+            } catch (e: TransformerException) {
+                return null
+            }
+
+            return writer.toString()
+        }
+    }
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/session/SessionManager.java b/focus-android/app/src/main/java/org/mozilla/focus/session/SessionManager.java
index 2e41c3519bad..48bd4129162d 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/session/SessionManager.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/session/SessionManager.java
@@ -22,8 +22,8 @@
 import java.util.Collections;
 import java.util.List;
 
-import mozilla.components.utils.SafeIntent;
-import mozilla.components.utils.WebURLFinder;
+import mozilla.components.support.utils.SafeIntent;
+import mozilla.components.support.utils.WebURLFinder;
 
 
 /**
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt
index f2192f2e3c89..07ad83f0c515 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/BaseSettingsFragment.kt
@@ -6,10 +6,8 @@ package org.mozilla.focus.settings
 
 import android.app.Fragment
 import android.content.Context
-import android.content.SharedPreferences
 import android.preference.PreferenceFragment
 import org.mozilla.focus.R
-import org.mozilla.focus.search.SearchEngineManager
 
 abstract class BaseSettingsFragment : PreferenceFragment() {
 
@@ -27,10 +25,6 @@ abstract class BaseSettingsFragment : PreferenceFragment() {
 
     protected fun getActionBarUpdater() = activity as ActionBarUpdater
 
-    protected fun getSearchEngineSharedPreferences(): SharedPreferences {
-        return activity.getSharedPreferences(SearchEngineManager.PREF_FILE_SEARCH_ENGINES, Context.MODE_PRIVATE)
-    }
-
     protected fun navigateToFragment(fragment: Fragment) {
         fragmentManager.beginTransaction()
             .replace(R.id.container, fragment)
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt
index c70a2b4df459..795a9e4d0764 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/InstalledSearchEnginesSettingsFragment.kt
@@ -11,8 +11,8 @@ import android.view.Menu
 import android.view.MenuInflater
 import android.view.MenuItem
 import org.mozilla.focus.R
+import org.mozilla.focus.search.CustomSearchEngineStore
 import org.mozilla.focus.search.RadioSearchEngineListPreference
-import org.mozilla.focus.search.SearchEngineManager
 import org.mozilla.focus.telemetry.TelemetryWrapper
 
 class InstalledSearchEnginesSettingsFragment : BaseSettingsFragment() {
@@ -44,7 +44,7 @@ class InstalledSearchEnginesSettingsFragment : BaseSettingsFragment() {
     override fun onPrepareOptionsMenu(menu: Menu?) {
         super.onPrepareOptionsMenu(menu)
         menu?.findItem(R.id.menu_restore_default_engines)?.let {
-            it.isEnabled = !SearchEngineManager.hasAllDefaultSearchEngines(getSearchEngineSharedPreferences())
+            it.isEnabled = !CustomSearchEngineStore.hasAllDefaultSearchEngines(context)
         }
     }
 
@@ -56,7 +56,7 @@ class InstalledSearchEnginesSettingsFragment : BaseSettingsFragment() {
                 true
             }
             R.id.menu_restore_default_engines -> {
-                SearchEngineManager.restoreDefaultSearchEngines(getSearchEngineSharedPreferences())
+                CustomSearchEngineStore.restoreDefaultSearchEngines(context)
                 refetchSearchEngines()
                 TelemetryWrapper.menuRestoreEnginesEvent()
                 true
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt
index a69e83e24305..f390de458384 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/ManualAddSearchEngineSettingsFragment.kt
@@ -16,8 +16,8 @@ import android.view.MenuInflater
 import android.view.MenuItem
 import android.widget.EditText
 import org.mozilla.focus.R
+import org.mozilla.focus.search.CustomSearchEngineStore
 import org.mozilla.focus.search.ManualAddSearchEnginePreference
-import org.mozilla.focus.search.SearchEngineManager
 import org.mozilla.focus.session.SessionManager
 import org.mozilla.focus.session.Source
 import org.mozilla.focus.telemetry.TelemetryWrapper
@@ -199,8 +199,7 @@ class ManualAddSearchEngineSettingsFragment : BaseSettingsFragment() {
             }
 
             if (isValidSearchQuery == true) {
-                val sharedPreferences = that.getSearchEngineSharedPreferences()
-                SearchEngineManager.addSearchEngine(sharedPreferences, that.activity, engineName, query)
+                CustomSearchEngineStore.addSearchEngine(that.activity, engineName, query)
                 Snackbar.make(that.view, R.string.search_add_confirmation, Snackbar.LENGTH_SHORT).show()
                 that.fragmentManager.popBackStack()
             } else {
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt b/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt
index 317b7980b86f..c06d64e36be3 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/settings/RemoveSearchEnginesSettingsFragment.kt
@@ -9,8 +9,8 @@ import android.view.Menu
 import android.view.MenuInflater
 import android.view.MenuItem
 import org.mozilla.focus.R
+import org.mozilla.focus.search.CustomSearchEngineStore
 import org.mozilla.focus.search.MultiselectSearchEngineListPreference
-import org.mozilla.focus.search.SearchEngineManager
 import org.mozilla.focus.telemetry.TelemetryWrapper
 import org.mozilla.focus.utils.ViewUtils
 
@@ -61,7 +61,7 @@ class RemoveSearchEnginesSettingsFragment : BaseSettingsFragment() {
 
                 val enginesToRemove = (pref as MultiselectSearchEngineListPreference).checkedEngineIds
                 TelemetryWrapper.removeSearchEnginesEvent(enginesToRemove.size)
-                SearchEngineManager.removeSearchEngines(enginesToRemove, getSearchEngineSharedPreferences())
+                CustomSearchEngineStore.removeSearchEngines(activity, enginesToRemove)
                 fragmentManager.popBackStack()
                 true
             }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetrySettingsProvider.java b/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetrySettingsProvider.java
deleted file mode 100644
index c1ea07b296bc..000000000000
--- a/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetrySettingsProvider.java
+++ /dev/null
@@ -1,73 +0,0 @@
-/* This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.telemetry;
-
-import android.content.Context;
-import android.content.res.Resources;
-
-import org.mozilla.focus.R;
-import org.mozilla.focus.search.SearchEngineManager;
-import org.mozilla.focus.utils.Browsers;
-import org.mozilla.telemetry.TelemetryHolder;
-import org.mozilla.telemetry.measurement.SettingsMeasurement;
-
-/**
- * SharedPreferenceSettingsProvider implementation that additionally injects settings value for
- * runtime preferences like "default browser" and "search engine".
- */
-/* package */ class TelemetrySettingsProvider extends SettingsMeasurement.SharedPreferenceSettingsProvider {
-    private final Context context;
-    private final String prefKeyDefaultBrowser;
-    private final String prefKeySearchEngine;
-
-    /* package */ TelemetrySettingsProvider(Context context) {
-        this.context = context;
-
-        final Resources resources = context.getResources();
-        prefKeyDefaultBrowser = resources.getString(R.string.pref_key_default_browser);
-        prefKeySearchEngine = resources.getString(R.string.pref_key_search_engine);
-    }
-
-    public boolean containsKey(String key) {
-        if (key.equals(prefKeyDefaultBrowser)) {
-            // Not actually a setting - but we want to report this like a setting.
-            return true;
-        }
-
-        if (key.equals(prefKeySearchEngine)) {
-            // We always want to report the current search engine - even if it's not in settings yet.
-            return true;
-        }
-
-        return super.containsKey(key);
-    }
-
-    @Override
-    public java.lang.Object getValue(String key) {
-        if (key.equals(prefKeyDefaultBrowser)) {
-            // The default browser is not actually a setting. We determine if we are the
-            // default and then inject this into telemetry.
-            final Context context = TelemetryHolder.get().getConfiguration().getContext();
-            final Browsers browsers = new Browsers(context, Browsers.TRADITIONAL_BROWSER_URL);
-            return Boolean.toString(browsers.isDefaultBrowser(context));
-        }
-
-        if (key.equals(prefKeySearchEngine)) {
-            java.lang.Object value = super.getValue(key);
-            if (value == null) {
-                // If the user has never selected a search engine then this value is null.
-                // However we still want to report the current search engine of the user.
-                // Therefore we inject this value at runtime.
-                value = SearchEngineManager.getInstance().getDefaultSearchEngine(context).getName();
-            } else if (SearchEngineManager.getInstance().isCustomSearchEngine((String) value, context)) {
-                // Don't collect possibly sensitive info for custom search engines, send "custom" instead
-                value = SearchEngineManager.ENGINE_TYPE_CUSTOM;
-            }
-            return value;
-        }
-
-        return super.getValue(key);
-    }
-}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetrySettingsProvider.kt b/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetrySettingsProvider.kt
new file mode 100644
index 000000000000..cda9fb7d95d6
--- /dev/null
+++ b/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetrySettingsProvider.kt
@@ -0,0 +1,72 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this
+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
+
+package org.mozilla.focus.telemetry
+
+import android.content.Context
+import org.mozilla.focus.Components
+import org.mozilla.focus.R
+import org.mozilla.focus.search.CustomSearchEngineStore
+import org.mozilla.focus.utils.Browsers
+import org.mozilla.focus.utils.Settings
+import org.mozilla.telemetry.TelemetryHolder
+import org.mozilla.telemetry.measurement.SettingsMeasurement
+
+/**
+ * SharedPreferenceSettingsProvider implementation that additionally injects settings value for
+ * runtime preferences like "default browser" and "search engine".
+ */
+internal class TelemetrySettingsProvider(
+        private val context: Context
+) : SettingsMeasurement.SharedPreferenceSettingsProvider() {
+    private val prefKeyDefaultBrowser: String
+    private val prefKeySearchEngine: String
+
+    init {
+        val resources = context.resources
+        prefKeyDefaultBrowser = resources.getString(R.string.pref_key_default_browser)
+        prefKeySearchEngine = resources.getString(R.string.pref_key_search_engine)
+    }
+
+    override fun containsKey(key: String): Boolean {
+        if (key == prefKeyDefaultBrowser) {
+            // Not actually a setting - but we want to report this like a setting.
+            return true
+        }
+
+        return if (key == prefKeySearchEngine) {
+            // We always want to report the current search engine - even if it's not in settings yet.
+            true
+        } else super.containsKey(key)
+    }
+
+    override fun getValue(key: String): Any {
+        if (key == prefKeyDefaultBrowser) {
+            // The default browser is not actually a setting. We determine if we are the
+            // default and then inject this into telemetry.
+            val context = TelemetryHolder.get().configuration.context
+            val browsers = Browsers(context, Browsers.TRADITIONAL_BROWSER_URL)
+            return java.lang.Boolean.toString(browsers.isDefaultBrowser(context))
+        }
+
+        if (key == prefKeySearchEngine) {
+            var value: Any? = super.getValue(key)
+            if (value == null) {
+                // If the user has never selected a search engine then this value is null.
+                // However we still want to report the current search engine of the user.
+                // Therefore we inject this value at runtime.
+                value = Components.searchEngineManager.getDefaultSearchEngine(
+                        context,
+                        Settings.getInstance(context).defaultSearchEngineName
+                ).name
+            } else if (CustomSearchEngineStore.isCustomSearchEngine((value as String?)!!, context)) {
+                // Don't collect possibly sensitive info for custom search engines, send "custom" instead
+                value = CustomSearchEngineStore.ENGINE_TYPE_CUSTOM
+            }
+            return value
+        }
+
+        return super.getValue(key)
+    }
+}
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetryWrapper.kt b/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetryWrapper.kt
index d1cc7b9e91f7..5e75b40bd045 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetryWrapper.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/telemetry/TelemetryWrapper.kt
@@ -10,12 +10,15 @@ import android.net.http.SslError
 import android.os.StrictMode
 import android.preference.PreferenceManager
 import android.support.annotation.CheckResult
+import kotlinx.coroutines.experimental.runBlocking
 import org.mozilla.focus.BuildConfig
 import org.mozilla.focus.R
-import org.mozilla.focus.search.SearchEngineManager
 import org.mozilla.focus.session.SessionManager
 import org.mozilla.focus.utils.AppConstants
 import mozilla.components.ui.autocomplete.InlineAutocompleteEditText.AutocompleteResult
+import org.mozilla.focus.Components
+import org.mozilla.focus.search.CustomSearchEngineStore
+import org.mozilla.focus.utils.Settings
 import org.mozilla.telemetry.Telemetry
 import org.mozilla.telemetry.TelemetryHolder
 import org.mozilla.telemetry.config.TelemetryConfiguration
@@ -227,7 +230,9 @@ object TelemetryWrapper {
 
     private fun createDefaultSearchProvider(context: Context): DefaultSearchMeasurement.DefaultSearchEngineProvider {
         return DefaultSearchMeasurement.DefaultSearchEngineProvider {
-            getDefaultSearchEngineIdentifierForTelemetry(context)
+            runBlocking {
+                getDefaultSearchEngineIdentifierForTelemetry(context)
+            }
         }
     }
 
@@ -396,14 +401,17 @@ object TelemetryWrapper {
     }
 
     private fun getDefaultSearchEngineIdentifierForTelemetry(context: Context): String {
-        val searchEngine = SearchEngineManager.getInstance()
-                    .getDefaultSearchEngine(context).identifier
-            if (SearchEngineManager.getInstance().isCustomSearchEngine(searchEngine, context)) {
-                // Don't collect possibly sensitive info for custom search engines, send "custom" instead
-                return SearchEngineManager.ENGINE_TYPE_CUSTOM
-            } else {
-                return searchEngine
-            }
+        val searchEngine = Components.searchEngineManager.getDefaultSearchEngine(
+                context,
+                Settings.getInstance(context).defaultSearchEngineName
+        ).identifier
+
+        return if (CustomSearchEngineStore.isCustomSearchEngine(searchEngine, context)) {
+            // Don't collect possibly sensitive info for custom search engines, send "custom" instead
+            CustomSearchEngineStore.ENGINE_TYPE_CUSTOM
+        } else {
+            searchEngine
+        }
     }
 
     @JvmStatic
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt b/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt
index 8d31405d2815..e98797f24e4a 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/utils/Settings.kt
@@ -8,10 +8,10 @@ import android.content.Context
 import android.content.SharedPreferences
 import android.content.res.Resources
 import android.preference.PreferenceManager
+import mozilla.components.browser.search.SearchEngine
 
 import org.mozilla.focus.R
 import org.mozilla.focus.fragment.FirstrunFragment
-import org.mozilla.focus.search.SearchEngine
 
 /**
  * A simple wrapper for SharedPreferences that makes reading preference a little bit easier.
@@ -34,8 +34,8 @@ class Settings private constructor(context: Context) {
     private val preferences: SharedPreferences = PreferenceManager.getDefaultSharedPreferences(context)
     private val resources: Resources = context.resources
 
-    val defaultSearchEngineName: String?
-        get() = preferences.getString(getPreferenceKey(R.string.pref_key_search_engine), null)
+    val defaultSearchEngineName: String
+        get() = preferences.getString(getPreferenceKey(R.string.pref_key_search_engine), "")
 
     fun shouldBlockImages(): Boolean =
             // Not shipping in v1 (#188)
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/utils/UrlUtils.java b/focus-android/app/src/main/java/org/mozilla/focus/utils/UrlUtils.java
index 70dc0a9950f9..c06fcde0d231 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/utils/UrlUtils.java
+++ b/focus-android/app/src/main/java/org/mozilla/focus/utils/UrlUtils.java
@@ -12,12 +12,13 @@
 import android.text.TextUtils;
 import android.webkit.URLUtil;
 
-import org.mozilla.focus.search.SearchEngine;
-import org.mozilla.focus.search.SearchEngineManager;
+import org.mozilla.focus.Components;
 
 import java.net.URI;
 import java.net.URISyntaxException;
 
+import mozilla.components.browser.search.SearchEngine;
+
 public class UrlUtils {
     public static String normalize(@NonNull String input) {
         String trimmedInput = input.trim();
@@ -70,8 +71,10 @@ public static boolean isSearchQuery(String text) {
     }
 
     public static String createSearchUrl(Context context, String searchTerm) {
-        final SearchEngine searchEngine = SearchEngineManager.getInstance()
-                .getDefaultSearchEngine(context);
+        final String defaultIdentifier = Settings.getInstance(context).getDefaultSearchEngineName();
+
+        final SearchEngine searchEngine = Components.INSTANCE.getSearchEngineManager()
+                .getDefaultSearchEngine(context, defaultIdentifier);
 
         return searchEngine.buildSearchUrl(searchTerm);
     }
diff --git a/focus-android/app/src/main/java/org/mozilla/focus/whatsnew/WhatsNewVersion.kt b/focus-android/app/src/main/java/org/mozilla/focus/whatsnew/WhatsNewVersion.kt
index 13fabde8bb59..9d7020635c9b 100644
--- a/focus-android/app/src/main/java/org/mozilla/focus/whatsnew/WhatsNewVersion.kt
+++ b/focus-android/app/src/main/java/org/mozilla/focus/whatsnew/WhatsNewVersion.kt
@@ -5,7 +5,7 @@
 package org.mozilla.focus.whatsnew
 
 import android.content.Context
-import mozilla.components.ktx.android.content.appVersionName
+import mozilla.components.support.ktx.android.content.appVersionName
 
 /**
 * Convenience class to deal with the application version number
diff --git a/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java b/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java
index 1627f88ea5d1..078ce71c7d74 100644
--- a/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java
+++ b/focus-android/app/src/test/java/org/mozilla/focus/customtabs/CustomTabConfigTest.java
@@ -22,7 +22,7 @@
 import java.lang.reflect.Field;
 import java.util.UUID;
 
-import mozilla.components.utils.SafeIntent;
+import mozilla.components.support.utils.SafeIntent;
 
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
diff --git a/focus-android/app/src/test/java/org/mozilla/focus/search/SearchEngineParserTest.java b/focus-android/app/src/test/java/org/mozilla/focus/search/SearchEngineParserTest.java
deleted file mode 100644
index d87e3b7595d1..000000000000
--- a/focus-android/app/src/test/java/org/mozilla/focus/search/SearchEngineParserTest.java
+++ /dev/null
@@ -1,90 +0,0 @@
-/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-
- * This Source Code Form is subject to the terms of the Mozilla Public
- * License, v. 2.0. If a copy of the MPL was not distributed with this
- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
-
-package org.mozilla.focus.search;
-
-import android.text.TextUtils;
-
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.robolectric.ParameterizedRobolectricTestRunner;
-
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.InputStream;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.UUID;
-
-import static org.junit.Assert.assertEquals;
-import static org.junit.Assert.assertFalse;
-import static org.junit.Assert.assertNotNull;
-import static org.junit.Assert.assertTrue;
-
-@RunWith(ParameterizedRobolectricTestRunner.class)
-public class SearchEngineParserTest {
-    @ParameterizedRobolectricTestRunner.Parameters(name = "{1}")
-    public static Collection<Object[]> searchPlugins() {
-        final Collection<Object[]> searchPlugins = new ArrayList<>();
-        collectSearchPlugins(searchPlugins, getBasePath());
-        return searchPlugins;
-    }
-
-    private String searchPluginPath;
-    private String searchEngineIdentifier;
-
-    public SearchEngineParserTest(String searchPluginPath, String searchEngineIdentifier) {
-        this.searchPluginPath = searchPluginPath;
-        this.searchEngineIdentifier = searchEngineIdentifier;
-    }
-
-    @Test
-    public void testParser() throws Exception {
-        final InputStream stream = new FileInputStream(searchPluginPath);
-        final SearchEngine searchEngine = SearchEngineParser.load(searchEngineIdentifier, stream);
-        assertEquals(searchEngineIdentifier, searchEngine.getIdentifier());
-
-        assertNotNull(searchEngine.getName());
-        assertFalse(TextUtils.isEmpty(searchEngine.getName()));
-
-        assertNotNull(searchEngine.getIcon());
-
-        final String searchTerm = UUID.randomUUID().toString();
-        final String searchUrl = searchEngine.buildSearchUrl(searchTerm);
-
-        assertNotNull(searchUrl);
-        assertFalse(TextUtils.isEmpty(searchUrl));
-        assertTrue(searchUrl.contains(searchTerm));
-
-        stream.close();
-    }
-
-    private static void collectSearchPlugins(Collection<Object[]> searchPlugins, File path) {
-        if (!path.isDirectory()) {
-            throw new AssertionError("Not a directory: " + path.getAbsolutePath());
-        }
-
-        final String[] entries = path.list();
-
-        if (entries == null) {
-            throw new AssertionError("No files in directory " + path.getAbsolutePath());
-        }
-
-        for (String entry : entries) {
-            final File file = new File(path, entry);
-
-            if (file.isDirectory()) {
-                collectSearchPlugins(searchPlugins, file);
-            } else if (entry.endsWith(".xml")) {
-                searchPlugins.add(new Object[] { file.getAbsolutePath(), entry.substring(0, entry.length() - 4) });
-            }
-        }
-    }
-
-    private static File getBasePath() {
-        final ClassLoader classLoader = SearchEngineParserTest.class.getClassLoader();
-        return new File(classLoader.getResource("search").getFile());
-    }
-}
\ No newline at end of file
diff --git a/focus-android/app/src/test/java/org/mozilla/focus/session/SessionManagerTest.java b/focus-android/app/src/test/java/org/mozilla/focus/session/SessionManagerTest.java
index b537aab58538..74a59da6abf5 100644
--- a/focus-android/app/src/test/java/org/mozilla/focus/session/SessionManagerTest.java
+++ b/focus-android/app/src/test/java/org/mozilla/focus/session/SessionManagerTest.java
@@ -20,7 +20,7 @@
 import java.util.List;
 import java.util.UUID;
 
-import mozilla.components.utils.SafeIntent;
+import mozilla.components.support.utils.SafeIntent;
 
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
diff --git a/focus-android/app/src/test/java/org/mozilla/focus/session/SessionTest.java b/focus-android/app/src/test/java/org/mozilla/focus/session/SessionTest.java
index 1f6b4a837131..59c0c5cad9c6 100644
--- a/focus-android/app/src/test/java/org/mozilla/focus/session/SessionTest.java
+++ b/focus-android/app/src/test/java/org/mozilla/focus/session/SessionTest.java
@@ -22,7 +22,7 @@
 
 import java.util.UUID;
 
-import mozilla.components.utils.SafeIntent;
+import mozilla.components.support.utils.SafeIntent;
 
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
diff --git a/focus-android/app/src/webview/java/org/mozilla/focus/webview/SystemWebView.java b/focus-android/app/src/webview/java/org/mozilla/focus/webview/SystemWebView.java
index 8cfd086f3c8f..fc9dda35bde0 100644
--- a/focus-android/app/src/webview/java/org/mozilla/focus/webview/SystemWebView.java
+++ b/focus-android/app/src/webview/java/org/mozilla/focus/webview/SystemWebView.java
@@ -43,7 +43,7 @@
 import java.util.HashMap;
 import java.util.Map;
 
-import mozilla.components.utils.ThreadUtils;
+import mozilla.components.support.utils.ThreadUtils;
 
 public class SystemWebView extends NestedWebView implements IWebView, SharedPreferences.OnSharedPreferenceChangeListener {
     private static final String TAG = "WebkitView";
diff --git a/focus-android/build.gradle b/focus-android/build.gradle
index 7c9a7d0349f8..1799fed531d3 100644
--- a/focus-android/build.gradle
+++ b/focus-android/build.gradle
@@ -9,7 +9,7 @@ buildscript {
     ext.geckoview_revision = '6276ec7ebbf33e3484997b189f20fc1511534187'
     ext.geckoview_nightly_version ='61.0.20180416100101'
     ext.spotbugs_version = '3.1.2'
-    ext.mozilla_components_version = '0.3'
+    ext.mozilla_components_version = '0.4'
 
     repositories {
         google()
