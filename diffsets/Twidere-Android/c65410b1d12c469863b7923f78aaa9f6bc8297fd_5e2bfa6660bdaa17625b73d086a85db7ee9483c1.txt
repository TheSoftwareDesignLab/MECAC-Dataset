diff --git a/twidere/src/main/AndroidManifest.xml b/twidere/src/main/AndroidManifest.xml
index 959dc8caf0..38a12c861f 100644
--- a/twidere/src/main/AndroidManifest.xml
+++ b/twidere/src/main/AndroidManifest.xml
@@ -210,7 +210,7 @@
         <activity
             android:name=".activity.SignInActivity"
             android:label="@string/sign_in"
-            android:theme="@style/Theme.Twidere.DialogWhenLarge.NoActionBar"
+            android:theme="@style/Theme.Twidere"
             android:windowSoftInputMode="adjustResize">
             <intent-filter>
                 <action android:name="org.mariotaku.twidere.TWITTER_LOGIN"/>
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/ImageCropperActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/ImageCropperActivity.java
index 15f5e241a9..66d9a3a0fc 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/ImageCropperActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/ImageCropperActivity.java
@@ -20,22 +20,15 @@
 package org.mariotaku.twidere.activity;
 
 import android.content.res.Resources;
-import android.os.Build;
 import android.os.Bundle;
 import android.support.annotation.NonNull;
-import android.support.v4.view.ViewCompat;
-import android.view.View;
-import android.view.WindowManager;
+import android.support.v7.widget.Toolbar;
 
 import com.soundcloud.android.crop.CropImageActivity;
 
 import org.mariotaku.twidere.R;
 import org.mariotaku.twidere.activity.iface.IThemedActivity;
 import org.mariotaku.twidere.util.ThemeUtils;
-import org.mariotaku.twidere.util.Utils;
-import org.mariotaku.twidere.util.support.ViewSupport;
-import org.mariotaku.twidere.view.ShapedImageView;
-import org.mariotaku.twidere.view.TintedStatusFrameLayout;
 
 /**
  * Created by mariotaku on 15/6/16.
@@ -45,38 +38,20 @@ public class ImageCropperActivity extends CropImageActivity implements IThemedAc
     // Data fields
     private int mCurrentThemeColor;
     private int mCurrentThemeBackgroundAlpha;
-    @ShapedImageView.ShapeStyle
-    private int mProfileImageStyle;
     private String mCurrentThemeBackgroundOption;
-    private String mCurrentThemeFontFamily;
 
-
-    private TintedStatusFrameLayout mMainContent;
-    private View mDoneCancelBar;
+    private Toolbar mDoneCancelBar;
 
     @Override
     public void onContentChanged() {
         super.onContentChanged();
-        mMainContent = (TintedStatusFrameLayout) findViewById(R.id.main_content);
-        mDoneCancelBar = findViewById(R.id.done_cancel_bar);
+        mDoneCancelBar = (Toolbar) findViewById(R.id.done_cancel_bar);
     }
 
     @Override
     public void onCreate(final Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
-        if (Build.VERSION.SDK_INT > Build.VERSION_CODES.KITKAT) {
-            getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
-        }
-        final int themeColor = getThemeColor();
-        final String backgroundOption = getCurrentThemeBackgroundOption();
-        mMainContent.setDrawColor(true);
-        mMainContent.setDrawShadow(false);
-        mMainContent.setColor(themeColor);
-        ViewSupport.setBackground(mDoneCancelBar, ThemeUtils.getActionBarBackground(this,
-                themeColor, backgroundOption, true));
-        ViewCompat.setElevation(mDoneCancelBar, ThemeUtils.getSupportActionBarElevation(this));
-        final View windowOverlay = findViewById(R.id.window_overlay);
-        ViewSupport.setBackground(windowOverlay, ThemeUtils.getNormalWindowContentOverlay(this));
+
     }
 
     @Override
@@ -90,18 +65,6 @@ public void setContentView(final int layoutResID) {
     }
 
 
-    @Override
-    public void setTheme(final int resId) {
-        super.setTheme(resId);
-        ThemeUtils.applyWindowBackground(this, getWindow(),
-                mCurrentThemeBackgroundOption, mCurrentThemeBackgroundAlpha);
-    }
-
-    @Override
-    public String getCurrentThemeFontFamily() {
-        return mCurrentThemeFontFamily;
-    }
-
     @Override
     public int getCurrentThemeBackgroundAlpha() {
         return mCurrentThemeBackgroundAlpha;
@@ -132,19 +95,11 @@ public String getThemeFontFamily() {
         return ThemeUtils.getThemeFontFamily(this);
     }
 
-    @Override
-    @ShapedImageView.ShapeStyle
-    public int getCurrentProfileImageStyle() {
-        return mProfileImageStyle;
-    }
-
     @Override
     protected void onApplyThemeResource(@NonNull Resources.Theme theme, int resId, boolean first) {
         mCurrentThemeColor = getThemeColor();
-        mCurrentThemeFontFamily = getThemeFontFamily();
         mCurrentThemeBackgroundAlpha = getThemeBackgroundAlpha();
         mCurrentThemeBackgroundOption = getThemeBackgroundOption();
-        mProfileImageStyle = Utils.getProfileImageStyle(this);
         super.onApplyThemeResource(theme, resId, first);
     }
 
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/LinkHandlerActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/LinkHandlerActivity.java
index 4676f80891..5923daa213 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/LinkHandlerActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/LinkHandlerActivity.java
@@ -19,7 +19,6 @@
 
 package org.mariotaku.twidere.activity;
 
-import android.annotation.SuppressLint;
 import android.content.Intent;
 import android.graphics.Rect;
 import android.net.Uri;
@@ -28,29 +27,25 @@
 import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentTransaction;
 import android.support.v4.app.NavUtils;
+import android.support.v4.view.WindowCompat;
 import android.support.v7.app.ActionBar;
-import android.support.v7.app.AppCompatDelegate;
-import android.support.v7.widget.ActionBarContainer;
-import android.support.v7.widget.ActionMenuView;
 import android.support.v7.widget.Toolbar;
 import android.view.KeyEvent;
 import android.view.MenuItem;
 import android.view.View;
+import android.view.Window;
 
 import org.mariotaku.twidere.R;
 import org.mariotaku.twidere.activity.iface.IControlBarActivity;
 import org.mariotaku.twidere.fragment.iface.IBaseFragment;
 import org.mariotaku.twidere.fragment.iface.IBaseFragment.SystemWindowsInsetsCallback;
+import org.mariotaku.twidere.fragment.iface.IToolBarSupportFragment;
 import org.mariotaku.twidere.fragment.iface.SupportFragmentCallback;
-import org.mariotaku.twidere.fragment.support.UserFragment;
-import org.mariotaku.twidere.graphic.EmptyDrawable;
 import org.mariotaku.twidere.util.KeyboardShortcutsHandler;
 import org.mariotaku.twidere.util.KeyboardShortcutsHandler.KeyboardShortcutCallback;
 import org.mariotaku.twidere.util.MultiSelectEventHandler;
 import org.mariotaku.twidere.util.ThemeUtils;
 import org.mariotaku.twidere.util.Utils;
-import org.mariotaku.twidere.util.support.ActivitySupport;
-import org.mariotaku.twidere.util.support.ActivitySupport.TaskDescriptionCompat;
 import org.mariotaku.twidere.util.support.ViewSupport;
 
 import static org.mariotaku.twidere.util.Utils.createFragmentForIntent;
@@ -59,8 +54,6 @@
 public class LinkHandlerActivity extends BaseAppCompatActivity implements SystemWindowsInsetsCallback,
         IControlBarActivity, SupportFragmentCallback {
 
-    private ControlBarShowHideHelper mControlBarShowHideHelper = new ControlBarShowHideHelper(this);
-    private MultiSelectEventHandler mMultiSelectHandler;
     private final View.OnLayoutChangeListener mLayoutChangeListener = new View.OnLayoutChangeListener() {
 
         private final Rect tempInsets = new Rect();
@@ -75,9 +68,11 @@ public void onLayoutChange(View v, int left, int top, int right, int bottom, int
             }
         }
     };
-
+    private ControlBarShowHideHelper mControlBarShowHideHelper = new ControlBarShowHideHelper(this);
+    private MultiSelectEventHandler mMultiSelectHandler;
     private boolean mFinishOnly;
     private int mActionBarHeight;
+    private CharSequence mSubtitle;
 
 
     @Override
@@ -165,25 +160,34 @@ private boolean isFragmentKeyboardShortcutHandled(final KeyboardShortcutsHandler
 
     @Override
     protected void onCreate(final Bundle savedInstanceState) {
-        supportRequestWindowFeature(AppCompatDelegate.FEATURE_SUPPORT_ACTION_BAR_OVERLAY);
         mMultiSelectHandler = new MultiSelectEventHandler(this);
         mMultiSelectHandler.dispatchOnCreate();
         final Intent intent = getIntent();
-        final Uri data = intent.getData();
-        final int linkId = matchLinkId(data);
-        super.onCreate(savedInstanceState);
-        ThemeUtils.setCompatContentViewOverlay(this, new EmptyDrawable());
-        final ActionBar actionBar = getSupportActionBar();
-        if (actionBar != null) {
-            actionBar.setDisplayHomeAsUpEnabled(true);
-            setActionBarTheme(linkId);
+        final Uri uri = intent.getData();
+        final int linkId = matchLinkId(uri);
+        intent.setExtrasClassLoader(getClassLoader());
+        final Fragment fragment = createFragmentForIntent(this, linkId, intent);
+        if (fragment instanceof IToolBarSupportFragment) {
+            if (!((IToolBarSupportFragment) fragment).setupWindow(this)) {
+                supportRequestWindowFeature(Window.FEATURE_NO_TITLE);
+                supportRequestWindowFeature(WindowCompat.FEATURE_ACTION_MODE_OVERLAY);
+            }
         }
-        Utils.logOpenNotificationFromUri(this, data);
-        if (!showFragment(linkId, data)) {
+        super.onCreate(savedInstanceState);
+
+        if (fragment == null) {
             finish();
+            return;
         }
-    }
 
+        setupActionBarOption();
+        Utils.logOpenNotificationFromUri(this, uri);
+        final FragmentTransaction ft = getSupportFragmentManager().beginTransaction();
+        ft.replace(android.R.id.content, fragment);
+        ft.commit();
+        showFragment(linkId, uri);
+        mFinishOnly = Boolean.parseBoolean(uri.getQueryParameter(QUERY_PARAM_FINISH_ONLY));
+    }
 
     @Override
     protected void onStart() {
@@ -191,78 +195,76 @@ protected void onStart() {
         mMultiSelectHandler.dispatchOnStart();
     }
 
+
     @Override
     protected void onStop() {
         mMultiSelectHandler.dispatchOnStop();
         super.onStop();
     }
 
-    private void setupToolbarMenuItemColor() {
-        final Toolbar toolbar = peekActionBarToolbar();
-        if (toolbar != null) {
-            final int themeColor = getCurrentThemeColor();
-            final int itemColor = ThemeUtils.getContrastForegroundColor(this, themeColor);
-            ThemeUtils.wrapToolbarMenuIcon(ViewSupport.findViewByType(toolbar, ActionMenuView.class), itemColor, itemColor);
-        }
+    @Override
+    public void setSupportActionBar(Toolbar toolbar) {
+        super.setSupportActionBar(toolbar);
+        setupActionBarOption();
     }
 
     public final void setSubtitle(CharSequence subtitle) {
-        final ActionBar actionBar = getSupportActionBar();
-        if (actionBar == null) return;
-        actionBar.setSubtitle(subtitle);
+        mSubtitle = subtitle;
+        setupActionBarOption();
     }
 
-    protected boolean shouldSetActionItemColor() {
-        return !(getCurrentVisibleFragment() instanceof UserFragment);
+    @Override
+    public void setControlBarVisibleAnimate(boolean visible) {
+        // Currently only search page needs this pattern, so we only enable this feature for it.
+        if (!(getCurrentVisibleFragment() instanceof HideUiOnScroll)) return;
+        mControlBarShowHideHelper.setControlBarVisibleAnimate(visible);
     }
 
-    private boolean handleFragmentKeyboardShortcutRepeat(KeyboardShortcutsHandler handler, int keyCode,
-                                                         int repeatCount, @NonNull KeyEvent event, int metaState) {
-        final Fragment fragment = getCurrentVisibleFragment();
-        if (fragment instanceof KeyboardShortcutCallback) {
-            return ((KeyboardShortcutCallback) fragment).handleKeyboardShortcutRepeat(handler, keyCode,
-                    repeatCount, event, metaState);
+    @Override
+    public void setControlBarVisibleAnimate(boolean visible, ControlBarShowHideHelper.ControlBarAnimationListener listener) {
+        // Currently only search page needs this pattern, so we only enable this feature for it.
+        if (!(getCurrentVisibleFragment() instanceof HideUiOnScroll)) return;
+        mControlBarShowHideHelper.setControlBarVisibleAnimate(visible, listener);
+    }
+
+    @Override
+    public float getControlBarOffset() {
+        Fragment fragment = getCurrentVisibleFragment();
+        ActionBar actionBar = getSupportActionBar();
+        if (fragment instanceof IToolBarSupportFragment) {
+            return ((IToolBarSupportFragment) fragment).getControlBarOffset();
+        } else if (actionBar != null) {
+            return actionBar.getHideOffset() / (float) getControlBarHeight();
         }
-        return false;
+        return 0;
     }
 
-    private boolean handleFragmentKeyboardShortcutSingle(KeyboardShortcutsHandler handler, int keyCode,
-                                                         @NonNull KeyEvent event, int metaState) {
-        final Fragment fragment = getCurrentVisibleFragment();
-        if (fragment instanceof KeyboardShortcutCallback) {
-            if (((KeyboardShortcutCallback) fragment).handleKeyboardShortcutSingle(handler, keyCode,
-                    event, metaState)) {
-                return true;
-            }
+    @Override
+    public void setControlBarOffset(float offset) {
+        Fragment fragment = getCurrentVisibleFragment();
+        ActionBar actionBar = getSupportActionBar();
+        if (fragment instanceof IToolBarSupportFragment) {
+            ((IToolBarSupportFragment) fragment).setControlBarOffset(offset);
+        } else if (actionBar != null) {
+            actionBar.setHideOffset((int) (getControlBarHeight() * offset));
         }
-        return false;
+        notifyControlBarOffsetChanged();
     }
 
-    @SuppressLint("AppCompatMethod")
-    private void setActionBarTheme(int linkId) {
-        final int themeColor = getCurrentThemeColor();
-        final String option = getThemeBackgroundOption();
-        final ActionBarContainer actionBarContainer = (ActionBarContainer) findViewById(R.id.twidere_action_bar_container);
-        switch (linkId) {
-            case LINK_ID_SEARCH:
-            case LINK_ID_USER_LISTS:
-            case LINK_ID_USER_LIST:
-            case LINK_ID_FILTERS: {
-                ThemeUtils.applyActionBarBackground(actionBarContainer, this, themeColor, option, false);
-                break;
-            }
-            default: {
-                ThemeUtils.applyActionBarBackground(actionBarContainer, this, themeColor, option, true);
-                break;
-            }
+    @Override
+    public int getControlBarHeight() {
+        Fragment fragment = getCurrentVisibleFragment();
+        ActionBar actionBar = getSupportActionBar();
+        if (fragment instanceof IToolBarSupportFragment) {
+            return ((IToolBarSupportFragment) fragment).getControlBarHeight();
+        } else if (actionBar != null) {
+            return actionBar.getHeight();
         }
+        if (mActionBarHeight != 0) return mActionBarHeight;
+        return mActionBarHeight = ThemeUtils.getActionBarHeight(this);
     }
 
     private boolean showFragment(final int linkId, final Uri uri) {
-        final Intent intent = getIntent();
-        intent.setExtrasClassLoader(getClassLoader());
-        final Fragment fragment = createFragmentForIntent(this, linkId, intent);
-        if (uri == null || fragment == null) return false;
         setSubtitle(null);
         switch (linkId) {
             case LINK_ID_STATUS: {
@@ -411,55 +413,37 @@ private boolean showFragment(final int linkId, final Uri uri) {
                 break;
             }
         }
-        mFinishOnly = Boolean.parseBoolean(uri.getQueryParameter(QUERY_PARAM_FINISH_ONLY));
-        final FragmentTransaction ft = getSupportFragmentManager().beginTransaction();
-        ft.replace(android.R.id.content, fragment);
-        ft.commit();
         return true;
     }
 
-    @Override
-    public void setControlBarVisibleAnimate(boolean visible) {
-        // Currently only search page needs this pattern, so we only enable this feature for it.
-        if (!(getCurrentVisibleFragment() instanceof HideUiOnScroll)) return;
-        mControlBarShowHideHelper.setControlBarVisibleAnimate(visible);
-    }
-
-    @Override
-    public void setControlBarVisibleAnimate(boolean visible, ControlBarShowHideHelper.ControlBarAnimationListener listener) {
-        // Currently only search page needs this pattern, so we only enable this feature for it.
-        if (!(getCurrentVisibleFragment() instanceof HideUiOnScroll)) return;
-        mControlBarShowHideHelper.setControlBarVisibleAnimate(visible, listener);
-    }
-
-    @Override
-    public float getControlBarOffset() {
-        return 0;
-    }
-
-    @Override
-    public void setControlBarOffset(float offset) {
-        final int translationY = -Math.round((1 - offset) * getControlBarHeight());
-        notifyControlBarOffsetChanged();
-    }
-
-    @Override
-    public int getControlBarHeight() {
-        if (mActionBarHeight != 0) return mActionBarHeight;
-        return mActionBarHeight = ThemeUtils.getActionBarHeight(this);
+    private boolean handleFragmentKeyboardShortcutRepeat(KeyboardShortcutsHandler handler, int keyCode,
+                                                         int repeatCount, @NonNull KeyEvent event, int metaState) {
+        final Fragment fragment = getCurrentVisibleFragment();
+        if (fragment instanceof KeyboardShortcutCallback) {
+            return ((KeyboardShortcutCallback) fragment).handleKeyboardShortcutRepeat(handler, keyCode,
+                    repeatCount, event, metaState);
+        }
+        return false;
     }
 
-    @Override
-    protected void onResume() {
-        super.onResume();
-        if (ThemeUtils.isColoredActionBar(this)) {
-            ActivitySupport.setTaskDescription(this, new TaskDescriptionCompat(null, null,
-                    getCurrentThemeColor()));
+    private boolean handleFragmentKeyboardShortcutSingle(KeyboardShortcutsHandler handler, int keyCode,
+                                                         @NonNull KeyEvent event, int metaState) {
+        final Fragment fragment = getCurrentVisibleFragment();
+        if (fragment instanceof KeyboardShortcutCallback) {
+            if (((KeyboardShortcutCallback) fragment).handleKeyboardShortcutSingle(handler, keyCode,
+                    event, metaState)) {
+                return true;
+            }
         }
+        return false;
     }
 
-    public ActionBarContainer getActionBarContainer() {
-        return null;
+    private void setupActionBarOption() {
+        final ActionBar actionBar = getSupportActionBar();
+        if (actionBar != null) {
+            actionBar.setDisplayHomeAsUpEnabled(true);
+            actionBar.setSubtitle(mSubtitle);
+        }
     }
 
     public interface HideUiOnScroll {
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/SettingsActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/SettingsActivity.java
index 08fde661be..ed69e06cc9 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/SettingsActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/SettingsActivity.java
@@ -59,7 +59,6 @@
 import org.mariotaku.twidere.preference.iface.IDialogPreference;
 import org.mariotaku.twidere.util.KeyboardShortcutsHandler;
 import org.mariotaku.twidere.util.ThemeUtils;
-import org.mariotaku.twidere.view.TintedStatusNativeActionModeAwareLayout;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -74,7 +73,6 @@ public class SettingsActivity extends BaseAppCompatActivity implements OnItemCli
 
     private boolean mShouldNotifyChange;
     private EntriesAdapter mEntriesAdapter;
-    private TintedStatusNativeActionModeAwareLayout mMainContent;
     private View mDetailFragmentContainer;
 
     public static void setShouldNotifyChange(Activity activity) {
@@ -87,7 +85,6 @@ public void onContentChanged() {
         super.onContentChanged();
         mEntriesListView = (ListView) findViewById(R.id.entries_list);
         mSlidingPaneLayout = (SlidingPaneLayout) findViewById(R.id.sliding_pane);
-        mMainContent = (TintedStatusNativeActionModeAwareLayout) findViewById(R.id.main_content);
         mDetailFragmentContainer = findViewById(R.id.detail_fragment_container);
     }
 
@@ -98,10 +95,6 @@ protected void onCreate(Bundle savedInstanceState) {
         setContentView(R.layout.activity_settings);
 
         final int backgroundAlpha = getCurrentThemeBackgroundAlpha();
-        final int alpha = ThemeUtils.getActionBarAlpha(getThemeBackgroundOption(), backgroundAlpha);
-        final int statusBarColor = ThemeUtils.getActionBarColor(this, getCurrentThemeColor(), getThemeBackgroundOption());
-        mMainContent.setDrawColor(true);
-        mMainContent.setColor(statusBarColor, alpha);
 
         mDetailFragmentContainer.setBackgroundColor((backgroundAlpha << 24 | 0xFFFFFF) & ThemeUtils.getThemeBackgroundColor(this));
 
@@ -180,7 +173,7 @@ public void finish() {
         if (shouldNotifyChange()) {
             final Intent data = new Intent();
             data.putExtra(EXTRA_CHANGED, true);
-            setResult(isTopSettings() ? RESULT_OK : RESULT_SETTINGS_CHANGED, data);
+            setResult(RESULT_SETTINGS_CHANGED, data);
         }
         super.finish();
     }
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/SignInActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/SignInActivity.java
index 9ef98a6235..245535e702 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/SignInActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/SignInActivity.java
@@ -31,7 +31,6 @@
 import android.graphics.Color;
 import android.net.Uri;
 import android.os.AsyncTask;
-import android.os.Build;
 import android.os.Bundle;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
@@ -42,7 +41,6 @@
 import android.support.v4.app.FragmentTransaction;
 import android.support.v4.view.ViewCompat;
 import android.support.v7.app.AlertDialog;
-import android.support.v7.widget.Toolbar;
 import android.text.Editable;
 import android.text.InputType;
 import android.text.TextUtils;
@@ -53,7 +51,6 @@
 import android.view.MenuItem;
 import android.view.View;
 import android.view.View.OnClickListener;
-import android.view.WindowManager;
 import android.widget.Button;
 import android.widget.EditText;
 import android.widget.LinearLayout;
@@ -107,7 +104,6 @@
 import org.mariotaku.twidere.util.support.ViewSupport;
 import org.mariotaku.twidere.util.support.view.ViewOutlineProviderCompat;
 import org.mariotaku.twidere.util.view.ConsumerKeySecretValidator;
-import org.mariotaku.twidere.view.iface.TintedStatusLayout;
 
 import java.lang.ref.WeakReference;
 
@@ -136,7 +132,6 @@ public class SignInActivity extends BaseAppCompatActivity implements OnClickList
     private LinearLayout mSignInSignUpContainer, mUsernamePasswordContainer;
     private ContentResolver mResolver;
     private AbstractSignInTask mTask;
-    private TintedStatusLayout mMainContent;
 
     @Override
     public void afterTextChanged(final Editable s) {
@@ -208,8 +203,6 @@ public void onContentChanged() {
         mSignUpButton = (Button) findViewById(R.id.sign_up);
         mSignInSignUpContainer = (LinearLayout) findViewById(R.id.sign_in_sign_up);
         mUsernamePasswordContainer = (LinearLayout) findViewById(R.id.username_password);
-        mMainContent = (TintedStatusLayout) findViewById(R.id.main_content);
-        setupTintStatusBar();
     }
 
     @Override
@@ -305,18 +298,9 @@ public void onTextChanged(final CharSequence s, final int start, final int befor
 
     @Override
     protected void onCreate(final Bundle savedInstanceState) {
-        setupWindow();
         super.onCreate(savedInstanceState);
         mResolver = getContentResolver();
         setContentView(R.layout.activity_sign_in);
-        setSupportActionBar((Toolbar) findViewById(R.id.action_bar));
-
-        ThemeUtils.setCompatContentViewOverlay(this, new EmptyDrawable());
-        final View actionBarContainer = findViewById(R.id.twidere_action_bar_container);
-        ViewCompat.setElevation(actionBarContainer, ThemeUtils.getSupportActionBarElevation(this));
-        ViewSupport.setOutlineProvider(actionBarContainer, ViewOutlineProviderCompat.BACKGROUND);
-        final View windowOverlay = findViewById(R.id.window_overlay);
-        ViewSupport.setBackground(windowOverlay, ThemeUtils.getNormalWindowContentOverlay(this));
 
         if (savedInstanceState != null) {
             mAPIUrlFormat = savedInstanceState.getString(Accounts.API_URL_FORMAT);
@@ -508,34 +492,6 @@ public void execute(IExtendedActivity activity) {
         });
     }
 
-    protected boolean isActionBarOutlineEnabled() {
-        return true;
-    }
-
-    protected boolean shouldSetActionItemColor() {
-        return true;
-    }
-
-    private void setupTintStatusBar() {
-        if (mMainContent == null) return;
-
-        final int alpha = ThemeUtils.isTransparentBackground(getThemeBackgroundOption()) ?
-                getCurrentThemeBackgroundAlpha() : 0xFF;
-        final int statusBarColor = ThemeUtils.getActionBarColor(this, getCurrentThemeColor(),
-                getThemeBackgroundOption());
-        mMainContent.setColor(statusBarColor, alpha);
-
-        mMainContent.setDrawShadow(false);
-        mMainContent.setDrawColor(true);
-        mMainContent.setFactor(1);
-    }
-
-    private void setupWindow() {
-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
-            getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
-        }
-    }
-
     @Nullable
     private static Pair<String, String> detectAccountType(Twitter twitter, User user) {
         try {
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedAppCompatActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedAppCompatActivity.java
index 4af509c0ed..3d70049c2d 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedAppCompatActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedAppCompatActivity.java
@@ -28,7 +28,6 @@
 import android.view.View;
 import android.view.Window;
 
-import com.afollestad.appthemeengine.ATE;
 import com.afollestad.appthemeengine.ATEActivity;
 
 import org.mariotaku.twidere.BuildConfig;
@@ -53,11 +52,6 @@ public abstract class ThemedAppCompatActivity extends ATEActivity implements Con
 
     private Toolbar mToolbar;
 
-    @Override
-    public String getCurrentThemeFontFamily() {
-        return mCurrentThemeFontFamily;
-    }
-
     @Override
     public int getCurrentThemeBackgroundAlpha() {
         return mCurrentThemeBackgroundAlpha;
@@ -88,12 +82,6 @@ public String getThemeFontFamily() {
         return ThemeUtils.getThemeFontFamily(this);
     }
 
-    @Override
-    @ShapeStyle
-    public int getCurrentProfileImageStyle() {
-        return mProfileImageStyle;
-    }
-
     @Override
     protected void onCreate(final Bundle savedInstanceState) {
         if (BuildConfig.DEBUG) {
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedFragmentActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedFragmentActivity.java
index 6b96ff0d7d..a1f5691dde 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedFragmentActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/ThemedFragmentActivity.java
@@ -77,11 +77,6 @@ public abstract class ThemedFragmentActivity extends FragmentActivity implements
     private String mCurrentThemeFontFamily;
     private int mMetaState;
 
-    @Override
-    public String getCurrentThemeFontFamily() {
-        return mCurrentThemeFontFamily;
-    }
-
     @Override
     public int getCurrentThemeBackgroundAlpha() {
         return mCurrentThemeBackgroundAlpha;
@@ -112,12 +107,6 @@ public String getThemeFontFamily() {
         return ThemeUtils.getThemeFontFamily(this);
     }
 
-    @Override
-    @ShapeStyle
-    public int getCurrentProfileImageStyle() {
-        return mProfileImageStyle;
-    }
-
     @Override
     protected void onCreate(final Bundle savedInstanceState) {
         if (BuildConfig.DEBUG) {
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IControlBarActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IControlBarActivity.java
index 7381a35457..d10abef949 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IControlBarActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IControlBarActivity.java
@@ -11,6 +11,9 @@
  */
 public interface IControlBarActivity {
 
+    /**
+     * @param offset 0: invisible, 1: visible
+     */
     void setControlBarOffset(float offset);
 
     void setControlBarVisibleAnimate(boolean visible);
diff --git a/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IThemedActivity.java b/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IThemedActivity.java
index 7dc004cd80..4a60efaf71 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IThemedActivity.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/activity/iface/IThemedActivity.java
@@ -19,8 +19,6 @@
 
 package org.mariotaku.twidere.activity.iface;
 
-import org.mariotaku.twidere.view.ShapedImageView;
-
 public interface IThemedActivity {
 
     int getCurrentThemeBackgroundAlpha();
@@ -37,9 +35,4 @@ public interface IThemedActivity {
 
     String getThemeFontFamily();
 
-    String getCurrentThemeFontFamily();
-
-    @ShapedImageView.ShapeStyle
-    int getCurrentProfileImageStyle();
-
 }
diff --git a/twidere/src/main/java/org/mariotaku/twidere/app/TwidereApplication.java b/twidere/src/main/java/org/mariotaku/twidere/app/TwidereApplication.java
index ce6a455d61..88178da406 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/app/TwidereApplication.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/app/TwidereApplication.java
@@ -35,9 +35,11 @@
 import android.os.Handler;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
+import android.support.design.widget.FloatingActionButton;
 import android.support.multidex.MultiDex;
 import android.support.v4.content.ContextCompat;
 import android.support.v7.app.AppCompatDelegate;
+import android.support.v7.widget.ActionBarContextView;
 
 import com.afollestad.appthemeengine.ATE;
 
@@ -61,6 +63,8 @@
 import org.mariotaku.twidere.util.dagger.ApplicationModule;
 import org.mariotaku.twidere.util.dagger.DependencyHolder;
 import org.mariotaku.twidere.util.net.TwidereDns;
+import org.mariotaku.twidere.util.theme.ActionBarContextViewViewProcessor;
+import org.mariotaku.twidere.util.theme.FloatingActionButtonViewProcessor;
 import org.mariotaku.twidere.util.theme.TabPagerIndicatorViewProcessor;
 import org.mariotaku.twidere.view.TabPagerIndicator;
 
@@ -121,6 +125,8 @@ public void onCreate() {
             StrictModeUtils.detectAllVmPolicy();
         }
         ATE.registerViewProcessor(TabPagerIndicator.class, new TabPagerIndicatorViewProcessor());
+        ATE.registerViewProcessor(FloatingActionButton.class, new FloatingActionButtonViewProcessor());
+        ATE.registerViewProcessor(ActionBarContextView.class, new ActionBarContextViewViewProcessor());
         final SharedPreferences preferences = getSharedPreferences();
         if (!ATE.config(this, null).isConfigured()) {
             final int themeColor = preferences.getInt(KEY_THEME_COLOR, ContextCompat.getColor(this,
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/iface/IToolBarSupportFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/iface/IToolBarSupportFragment.java
new file mode 100644
index 0000000000..3b27d746b5
--- /dev/null
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/iface/IToolBarSupportFragment.java
@@ -0,0 +1,20 @@
+package org.mariotaku.twidere.fragment.iface;
+
+import android.support.v4.app.FragmentActivity;
+import android.support.v7.widget.Toolbar;
+
+/**
+ * Created by mariotaku on 16/3/16.
+ */
+public interface IToolBarSupportFragment {
+
+    Toolbar getToolbar();
+
+    float getControlBarOffset();
+
+    void setControlBarOffset(float offset);
+
+    int getControlBarHeight();
+
+    boolean setupWindow(FragmentActivity activity);
+}
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/AbsToolbarTabPagesFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/AbsToolbarTabPagesFragment.java
new file mode 100644
index 0000000000..6f58790ae6
--- /dev/null
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/AbsToolbarTabPagesFragment.java
@@ -0,0 +1,296 @@
+package org.mariotaku.twidere.fragment.support;
+
+import android.content.Context;
+import android.content.Intent;
+import android.graphics.Rect;
+import android.os.Bundle;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.support.v4.app.Fragment;
+import android.support.v4.app.FragmentActivity;
+import android.support.v4.view.ViewPager;
+import android.support.v4.view.ViewPager.OnPageChangeListener;
+import android.support.v7.app.AppCompatActivity;
+import android.support.v7.widget.Toolbar;
+import android.view.KeyEvent;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+
+import org.mariotaku.twidere.R;
+import org.mariotaku.twidere.activity.LinkHandlerActivity;
+import org.mariotaku.twidere.activity.LinkHandlerActivity.HideUiOnScroll;
+import org.mariotaku.twidere.activity.iface.IControlBarActivity;
+import org.mariotaku.twidere.activity.iface.IControlBarActivity.ControlBarOffsetListener;
+import org.mariotaku.twidere.adapter.SupportTabsAdapter;
+import org.mariotaku.twidere.fragment.iface.IBaseFragment;
+import org.mariotaku.twidere.fragment.iface.IToolBarSupportFragment;
+import org.mariotaku.twidere.fragment.iface.RefreshScrollTopInterface;
+import org.mariotaku.twidere.fragment.iface.SupportFragmentCallback;
+import org.mariotaku.twidere.util.KeyboardShortcutsHandler;
+import org.mariotaku.twidere.util.KeyboardShortcutsHandler.KeyboardShortcutCallback;
+import org.mariotaku.twidere.view.ExtendedLinearLayout;
+import org.mariotaku.twidere.view.TabPagerIndicator;
+import org.mariotaku.twidere.view.iface.IExtendedView;
+
+/**
+ * Created by mariotaku on 16/3/16.
+ */
+public abstract class AbsToolbarTabPagesFragment extends BaseSupportFragment implements
+        RefreshScrollTopInterface, SupportFragmentCallback, IBaseFragment.SystemWindowsInsetsCallback,
+        ControlBarOffsetListener, HideUiOnScroll, OnPageChangeListener, IToolBarSupportFragment,
+        KeyboardShortcutCallback {
+
+    private SupportTabsAdapter mPagerAdapter;
+    private TabPagerIndicator mPagerIndicator;
+    private ViewPager mViewPager;
+    private View mPagerOverlay;
+    private Toolbar mToolbar;
+    private int mControlBarHeight;
+    private ExtendedLinearLayout mToolbarContainer;
+
+    @Override
+    public void onActivityCreated(final Bundle savedInstanceState) {
+        super.onActivityCreated(savedInstanceState);
+        final FragmentActivity activity = getActivity();
+        mPagerAdapter = new SupportTabsAdapter(activity, getChildFragmentManager(), null, 1);
+        mViewPager.setAdapter(mPagerAdapter);
+        mViewPager.setOffscreenPageLimit(2);
+        mViewPager.addOnPageChangeListener(this);
+        mPagerIndicator.setViewPager(mViewPager);
+        mPagerIndicator.setTabDisplayOption(TabPagerIndicator.LABEL);
+
+
+        addTabs(mPagerAdapter);
+        mToolbarContainer.setOnSizeChangedListener(new IExtendedView.OnSizeChangedListener() {
+            @Override
+            public void onSizeChanged(View view, int w, int h, int oldw, int oldh) {
+                final int pageLimit = mViewPager.getOffscreenPageLimit();
+                final int currentItem = mViewPager.getCurrentItem();
+                final int count = mPagerAdapter.getCount();
+                for (int i = 0; i < count; i++) {
+                    if (i > currentItem - pageLimit - 1 || i < currentItem + pageLimit) {
+                        Object obj = mPagerAdapter.instantiateItem(mViewPager, i);
+                        if (obj instanceof IBaseFragment) {
+                            ((IBaseFragment) obj).requestFitSystemWindows();
+                        }
+                    }
+                }
+            }
+        });
+    }
+
+    protected abstract void addTabs(SupportTabsAdapter adapter);
+
+    @Override
+    public void onDestroy() {
+        mViewPager.removeOnPageChangeListener(this);
+        super.onDestroy();
+    }
+
+    @Override
+    public void onAttach(Context context) {
+        super.onAttach(context);
+        if (context instanceof IControlBarActivity) {
+            ((IControlBarActivity) context).registerControlBarOffsetListener(this);
+        }
+    }
+
+    @Override
+    public void onDetach() {
+        final FragmentActivity activity = getActivity();
+        if (activity instanceof IControlBarActivity) {
+            ((IControlBarActivity) activity).unregisterControlBarOffsetListener(this);
+        }
+        super.onDetach();
+    }
+
+    @Nullable
+    @Override
+    public final View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
+        return inflater.inflate(R.layout.fragment_toolbar_tab_pages, container, false);
+    }
+
+    @Override
+    public void onViewCreated(View view, Bundle savedInstanceState) {
+        super.onViewCreated(view, savedInstanceState);
+        mViewPager = (ViewPager) view.findViewById(R.id.view_pager);
+        mToolbarContainer = (ExtendedLinearLayout) view.findViewById(R.id.toolbar_container);
+        mPagerIndicator = (TabPagerIndicator) view.findViewById(R.id.toolbar_tabs);
+        mPagerOverlay = view.findViewById(R.id.pager_window_overlay);
+        mToolbar = (Toolbar) view.findViewById(R.id.toolbar);
+
+        final Object host = getHost();
+        if (host instanceof AppCompatActivity) {
+            ((AppCompatActivity) host).setSupportActionBar(mToolbar);
+        }
+    }
+
+    @Override
+    public void onActivityResult(int requestCode, int resultCode, Intent data) {
+        final Object o = mPagerAdapter.instantiateItem(mViewPager, mViewPager.getCurrentItem());
+        if (o instanceof Fragment) {
+            ((Fragment) o).onActivityResult(requestCode, resultCode, data);
+        }
+    }
+
+    @Override
+    public boolean scrollToStart() {
+        final Fragment fragment = getCurrentVisibleFragment();
+        if (!(fragment instanceof RefreshScrollTopInterface)) return false;
+        ((RefreshScrollTopInterface) fragment).scrollToStart();
+        return true;
+    }
+
+    @Override
+    public boolean triggerRefresh() {
+        return false;
+    }
+
+    @Override
+    public Fragment getCurrentVisibleFragment() {
+        final int currentItem = mViewPager.getCurrentItem();
+        if (currentItem < 0 || currentItem >= mPagerAdapter.getCount()) return null;
+        return (Fragment) mPagerAdapter.instantiateItem(mViewPager, currentItem);
+    }
+
+    @Override
+    public boolean triggerRefresh(int position) {
+        return false;
+    }
+
+    @Override
+    protected void fitSystemWindows(Rect insets) {
+    }
+
+    @Override
+    public boolean getSystemWindowsInsets(Rect insets) {
+        if (mPagerIndicator == null) return false;
+        insets.set(0, mToolbarContainer.getHeight(), 0, 0);
+        return true;
+    }
+
+    @Override
+    public void onControlBarOffsetChanged(IControlBarActivity activity, float offset) {
+        mControlBarHeight = activity.getControlBarHeight();
+    }
+
+    @Override
+    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {
+
+    }
+
+    @Override
+    public void onPageSelected(int position) {
+
+    }
+
+    @Override
+    public void onPageScrollStateChanged(int state) {
+        final FragmentActivity activity = getActivity();
+        if (activity instanceof LinkHandlerActivity) {
+            ((LinkHandlerActivity) activity).setControlBarVisibleAnimate(true);
+        }
+    }
+
+    @Override
+    public Toolbar getToolbar() {
+        return mToolbar;
+    }
+
+    @Override
+    public float getControlBarOffset() {
+        if (mToolbarContainer == null) return 0;
+        return 1 + mToolbarContainer.getTranslationY() / getControlBarHeight();
+    }
+
+    @Override
+    public int getControlBarHeight() {
+        if (mToolbar == null) return 0;
+        return mToolbar.getMeasuredHeight();
+    }
+
+    @Override
+    public void setControlBarOffset(float offset) {
+        if (mToolbarContainer == null) return;
+        mToolbarContainer.setTranslationY((offset - 1) * getControlBarHeight());
+    }
+
+    @Override
+    public boolean setupWindow(FragmentActivity activity) {
+        return false;
+    }
+
+    @Override
+    public boolean handleKeyboardShortcutSingle(@NonNull KeyboardShortcutsHandler handler, int keyCode, @NonNull KeyEvent event, int metaState) {
+        if (handleFragmentKeyboardShortcutSingle(handler, keyCode, event, metaState)) return true;
+        final String action = handler.getKeyAction(CONTEXT_TAG_NAVIGATION, keyCode, event, metaState);
+        if (action != null) {
+            switch (action) {
+                case ACTION_NAVIGATION_PREVIOUS_TAB: {
+                    final int previous = mViewPager.getCurrentItem() - 1;
+                    if (previous >= 0 && previous < mPagerAdapter.getCount()) {
+                        mViewPager.setCurrentItem(previous, true);
+                    }
+                    return true;
+                }
+                case ACTION_NAVIGATION_NEXT_TAB: {
+                    final int next = mViewPager.getCurrentItem() + 1;
+                    if (next >= 0 && next < mPagerAdapter.getCount()) {
+                        mViewPager.setCurrentItem(next, true);
+                    }
+                    return true;
+                }
+            }
+        }
+        return handler.handleKey(getActivity(), null, keyCode, event, metaState);
+    }
+
+    @Override
+    public boolean isKeyboardShortcutHandled(@NonNull KeyboardShortcutsHandler handler, int keyCode,
+                                             @NonNull KeyEvent event, int metaState) {
+        if (isFragmentKeyboardShortcutHandled(handler, keyCode, event, metaState)) return true;
+        final String action = handler.getKeyAction(CONTEXT_TAG_NAVIGATION, keyCode, event, metaState);
+        return ACTION_NAVIGATION_PREVIOUS_TAB.equals(action) || ACTION_NAVIGATION_NEXT_TAB.equals(action);
+    }
+
+    @Override
+    public boolean handleKeyboardShortcutRepeat(@NonNull KeyboardShortcutsHandler handler, int keyCode,
+                                                int repeatCount, @NonNull KeyEvent event, int metaState) {
+        return handleFragmentKeyboardShortcutRepeat(handler, keyCode, repeatCount, event, metaState);
+    }
+
+    private Fragment getKeyboardShortcutRecipient() {
+        return getCurrentVisibleFragment();
+    }
+
+    private boolean handleFragmentKeyboardShortcutRepeat(KeyboardShortcutsHandler handler, int keyCode,
+                                                         int repeatCount, @NonNull KeyEvent event, int metaState) {
+        final Fragment fragment = getKeyboardShortcutRecipient();
+        if (fragment instanceof KeyboardShortcutCallback) {
+            return ((KeyboardShortcutCallback) fragment).handleKeyboardShortcutRepeat(handler, keyCode,
+                    repeatCount, event, metaState);
+        }
+        return false;
+    }
+
+    private boolean handleFragmentKeyboardShortcutSingle(KeyboardShortcutsHandler handler, int keyCode,
+                                                         @NonNull KeyEvent event, int metaState) {
+        final Fragment fragment = getKeyboardShortcutRecipient();
+        if (fragment instanceof KeyboardShortcutCallback) {
+            return ((KeyboardShortcutCallback) fragment).handleKeyboardShortcutSingle(handler, keyCode,
+                    event, metaState);
+        }
+        return false;
+    }
+
+    private boolean isFragmentKeyboardShortcutHandled(KeyboardShortcutsHandler handler, int keyCode,
+                                                      @NonNull KeyEvent event, int metaState) {
+        final Fragment fragment = getKeyboardShortcutRecipient();
+        if (fragment instanceof KeyboardShortcutCallback) {
+            return ((KeyboardShortcutCallback) fragment).isKeyboardShortcutHandled(handler, keyCode,
+                    event, metaState);
+        }
+        return false;
+    }
+}
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/AddStatusFilterDialogFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/AddStatusFilterDialogFragment.java
index c0ea74a5ce..d2473e8bd9 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/AddStatusFilterDialogFragment.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/AddStatusFilterDialogFragment.java
@@ -25,12 +25,12 @@
 import android.content.Context;
 import android.content.DialogInterface;
 import android.content.DialogInterface.OnClickListener;
-import android.content.DialogInterface.OnMultiChoiceClickListener;
 import android.os.Bundle;
 import android.support.annotation.NonNull;
 import android.support.v4.app.FragmentManager;
-import android.support.v7.app.AlertDialog;
 
+import com.afollestad.materialdialogs.AlertDialogWrapper;
+import com.afollestad.materialdialogs.MaterialDialog;
 import com.twitter.Extractor;
 
 import org.mariotaku.twidere.R;
@@ -49,24 +49,27 @@
 import java.util.HashSet;
 import java.util.Set;
 
-public class AddStatusFilterDialogFragment extends BaseSupportDialogFragment implements OnMultiChoiceClickListener,
-        OnClickListener {
+public class AddStatusFilterDialogFragment extends BaseSupportDialogFragment implements OnClickListener {
 
     public static final String FRAGMENT_TAG = "add_status_filter";
 
     private final Extractor mExtractor = new Extractor();
     private FilterItemInfo[] mFilterItems;
-    private final Set<FilterItemInfo> mCheckedFilterItems = new HashSet<>();
 
     @Override
     public void onClick(final DialogInterface dialog, final int which) {
+        final MaterialDialog materialDialog = (MaterialDialog) dialog;
+        final Integer[] selectedIndices = materialDialog.getSelectedIndices();
+        assert selectedIndices != null;
+
         final Set<UserKey> userKeys = new HashSet<>();
         final Set<String> keywords = new HashSet<>();
         final Set<String> sources = new HashSet<>();
         final ArrayList<ContentValues> userValues = new ArrayList<>();
         final ArrayList<ContentValues> keywordValues = new ArrayList<>();
         final ArrayList<ContentValues> sourceValues = new ArrayList<>();
-        for (final FilterItemInfo info : mCheckedFilterItems) {
+        for (final int idx : selectedIndices) {
+            final FilterItemInfo info = mFilterItems[idx];
             final Object value = info.value;
             if (value instanceof ParcelableUserMention) {
                 final ParcelableUserMention mention = (ParcelableUserMention) value;
@@ -103,20 +106,11 @@ public void onClick(final DialogInterface dialog, final int which) {
         ContentResolverUtils.bulkInsert(resolver, Filters.Sources.CONTENT_URI, sourceValues);
     }
 
-    @Override
-    public void onClick(final DialogInterface dialog, final int which, final boolean isChecked) {
-        if (isChecked) {
-            mCheckedFilterItems.add(mFilterItems[which]);
-        } else {
-            mCheckedFilterItems.remove(mFilterItems[which]);
-        }
-    }
-
     @NonNull
     @Override
     public Dialog onCreateDialog(final Bundle savedInstanceState) {
         final Context wrapped = ThemeUtils.getDialogThemedContext(getActivity());
-        final AlertDialog.Builder builder = new AlertDialog.Builder(wrapped);
+        final AlertDialogWrapper.Builder builder = new AlertDialogWrapper.Builder(wrapped);
         mFilterItems = getFilterItemsInfo();
         final String[] entries = new String[mFilterItems.length];
         final boolean nameFirst = mPreferences.getBoolean(KEY_NAME_FIRST);
@@ -135,9 +129,10 @@ public Dialog onCreateDialog(final Bundle savedInstanceState) {
             }
         }
         builder.setTitle(R.string.add_to_filter);
-        builder.setMultiChoiceItems(entries, null, this);
+        builder.setMultiChoiceItems(entries, null, null);
         builder.setPositiveButton(android.R.string.ok, this);
         builder.setNegativeButton(android.R.string.cancel, null);
+        builder.alwaysCallMultiChoiceCallback();
         return builder.create();
     }
 
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/BaseFiltersFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/BaseFiltersFragment.java
index ca6c25271b..322036923d 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/BaseFiltersFragment.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/BaseFiltersFragment.java
@@ -26,7 +26,6 @@
 import android.content.DialogInterface;
 import android.content.DialogInterface.OnClickListener;
 import android.content.Intent;
-import android.content.res.Resources;
 import android.database.Cursor;
 import android.net.Uri;
 import android.os.Bundle;
@@ -35,17 +34,16 @@
 import android.support.v4.app.LoaderManager;
 import android.support.v4.content.CursorLoader;
 import android.support.v4.content.Loader;
+import android.support.v4.view.ViewCompat;
 import android.support.v4.widget.SimpleCursorAdapter;
 import android.support.v7.app.AlertDialog;
 import android.text.TextUtils;
 import android.util.SparseBooleanArray;
 import android.view.ActionMode;
-import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.MenuInflater;
 import android.view.MenuItem;
 import android.view.View;
-import android.view.ViewGroup;
 import android.widget.AbsListView;
 import android.widget.AbsListView.MultiChoiceModeListener;
 import android.widget.AutoCompleteTextView;
@@ -57,6 +55,7 @@
 import org.mariotaku.sqliteqb.library.RawItemArray;
 import org.mariotaku.twidere.R;
 import org.mariotaku.twidere.activity.UserListSelectorActivity;
+import org.mariotaku.twidere.activity.iface.IControlBarActivity;
 import org.mariotaku.twidere.adapter.ComposeAutoCompleteAdapter;
 import org.mariotaku.twidere.adapter.SourceAutoCompleteAdapter;
 import org.mariotaku.twidere.model.ParcelableUser;
@@ -97,17 +96,17 @@ public void onActivityCreated(final Bundle savedInstanceState) {
         showProgress();
     }
 
-    @Override
-    public View onCreateView(final LayoutInflater inflater, final ViewGroup container, final Bundle savedInstanceState) {
-        final View view = super.onCreateView(inflater, container, savedInstanceState);
-        assert view != null;
-        final ListView listView = (ListView) view.findViewById(R.id.list_view);
-        final Resources res = getResources();
-        final float density = res.getDisplayMetrics().density;
-        final int padding = (int) density * 16;
-        listView.setPadding(padding, 0, padding, 0);
-        return view;
-    }
+//    @Override
+//    public View onCreateView(final LayoutInflater inflater, final ViewGroup container, final Bundle savedInstanceState) {
+//        final View view = super.onCreateView(inflater, container, savedInstanceState);
+//        assert view != null;
+//        final ListView listView = (ListView) view.findViewById(R.id.list_view);
+//        final Resources res = getResources();
+//        final float density = res.getDisplayMetrics().density;
+//        final int padding = (int) density * 16;
+//        listView.setPadding(padding, 0, padding, 0);
+//        return view;
+//    }
 
     @Override
     public void setUserVisibleHint(final boolean isVisibleToUser) {
@@ -123,8 +122,7 @@ public void setControlVisible(boolean visible) {
     }
 
     private boolean isQuickReturnEnabled() {
-        final int firstVisiblePosition = getListView().getFirstVisiblePosition();
-        return mActionMode == null && firstVisiblePosition >= 1;
+        return mActionMode == null;
     }
 
     @Override
@@ -146,7 +144,8 @@ public boolean onActionItemClicked(final ActionMode mode, final MenuItem item) {
         final ListView listView = getListView();
         switch (item.getItemId()) {
             case R.id.delete: {
-                final Expression where = Expression.in(new Column(Filters._ID), new RawItemArray(listView.getCheckedItemIds()));
+                final Expression where = Expression.in(new Column(Filters._ID),
+                        new RawItemArray(listView.getCheckedItemIds()));
                 mResolver.delete(getContentUri(), where.getSQL(), null);
                 break;
             }
@@ -170,10 +169,30 @@ public void onDestroyActionMode(final ActionMode mode) {
         mActionMode = null;
     }
 
+    @Override
+    public void onItemCheckedStateChanged(final ActionMode mode, final int position, final long id,
+                                          final boolean checked) {
+        updateTitle(mode);
+    }
+
     @Override
     public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) {
         super.onScroll(view, firstVisibleItem, visibleItemCount, totalItemCount);
-        setControlVisible(firstVisibleItem < 1);
+        if (ViewCompat.isLaidOut(view)) {
+            int childCount = view.getChildCount();
+            if (childCount > 0) {
+                final View firstChild = view.getChildAt(0);
+                final FragmentActivity activity = getActivity();
+                int controlBarHeight = 0;
+                if (activity instanceof IControlBarActivity) {
+                    controlBarHeight = ((IControlBarActivity) activity).getControlBarHeight();
+                }
+                final boolean visible = firstChild.getTop() > controlBarHeight;
+                setControlVisible(visible);
+            } else {
+                setControlVisible(true);
+            }
+        }
     }
 
     @Override
@@ -203,6 +222,7 @@ public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
         inflater.inflate(R.menu.menu_filters, menu);
     }
 
+
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {
         switch (item.getItemId()) {
@@ -218,11 +238,6 @@ public boolean onOptionsItemSelected(MenuItem item) {
         return super.onOptionsItemSelected(item);
     }
 
-    @Override
-    public void onItemCheckedStateChanged(final ActionMode mode, final int position, final long id,
-                                          final boolean checked) {
-        updateTitle(mode);
-    }
 
     @Override
     public boolean isRefreshing() {
@@ -269,7 +284,6 @@ public Dialog onCreateDialog(final Bundle savedInstanceState) {
             final FragmentActivity activity = getActivity();
             final Context wrapped = ThemeUtils.getDialogThemedContext(activity);
             final AlertDialog.Builder builder = new AlertDialog.Builder(wrapped);
-            buildDialog(builder);
             builder.setView(R.layout.dialog_auto_complete_textview);
 
             builder.setTitle(R.string.add_rule);
@@ -307,9 +321,6 @@ protected String getText() {
             return ParseUtils.parseString(editText.getText());
         }
 
-        private void buildDialog(final AlertDialog.Builder builder) {
-
-        }
     }
 
     private static final class FilterListAdapter extends SimpleCursorAdapter {
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/FiltersFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/FiltersFragment.java
index 1315ca416d..7dfaac8a51 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/FiltersFragment.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/FiltersFragment.java
@@ -19,202 +19,29 @@
 
 package org.mariotaku.twidere.fragment.support;
 
-import android.content.Context;
-import android.content.Intent;
-import android.graphics.Rect;
 import android.os.Bundle;
-import android.support.annotation.Nullable;
-import android.support.v4.app.Fragment;
-import android.support.v4.app.FragmentActivity;
-import android.support.v4.view.ViewPager;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
 
 import org.mariotaku.twidere.R;
-import org.mariotaku.twidere.activity.iface.IControlBarActivity;
-import org.mariotaku.twidere.activity.iface.IThemedActivity;
-import org.mariotaku.twidere.activity.LinkHandlerActivity;
 import org.mariotaku.twidere.adapter.SupportTabsAdapter;
-import org.mariotaku.twidere.fragment.iface.IBaseFragment;
-import org.mariotaku.twidere.fragment.iface.RefreshScrollTopInterface;
-import org.mariotaku.twidere.fragment.iface.SupportFragmentCallback;
 import org.mariotaku.twidere.fragment.support.BaseFiltersFragment.FilteredKeywordsFragment;
 import org.mariotaku.twidere.fragment.support.BaseFiltersFragment.FilteredLinksFragment;
 import org.mariotaku.twidere.fragment.support.BaseFiltersFragment.FilteredSourcesFragment;
 import org.mariotaku.twidere.fragment.support.BaseFiltersFragment.FilteredUsersFragment;
-import org.mariotaku.twidere.graphic.EmptyDrawable;
-import org.mariotaku.twidere.util.ThemeUtils;
-import org.mariotaku.twidere.util.Utils;
-import org.mariotaku.twidere.view.TabPagerIndicator;
 
-public class FiltersFragment extends BaseSupportFragment implements RefreshScrollTopInterface,
-        SupportFragmentCallback, IBaseFragment.SystemWindowsInsetsCallback,
-        IControlBarActivity.ControlBarOffsetListener, LinkHandlerActivity.HideUiOnScroll, ViewPager.OnPageChangeListener {
-
-    private SupportTabsAdapter mPagerAdapter;
-
-    private TabPagerIndicator mPagerIndicator;
-    private ViewPager mViewPager;
-    private View mPagerOverlay;
-
-    private int mControlBarHeight;
-    private int mControlBarOffsetPixels;
+public class FiltersFragment extends AbsToolbarTabPagesFragment {
 
     @Override
-    public void onActivityCreated(final Bundle savedInstanceState) {
+    public void onActivityCreated(Bundle savedInstanceState) {
         super.onActivityCreated(savedInstanceState);
-        final FragmentActivity activity = getActivity();
-        mPagerAdapter = new SupportTabsAdapter(activity, getChildFragmentManager(), null, 1);
-        mViewPager.setAdapter(mPagerAdapter);
-        mViewPager.setOffscreenPageLimit(2);
-        mViewPager.addOnPageChangeListener(this);
-        mPagerIndicator.setViewPager(mViewPager);
-        mPagerIndicator.setTabDisplayOption(TabPagerIndicator.LABEL);
-
-
-        mPagerAdapter.addTab(FilteredUsersFragment.class, null, getString(R.string.users), null, 0, null);
-        mPagerAdapter.addTab(FilteredKeywordsFragment.class, null, getString(R.string.keywords), null, 1, null);
-        mPagerAdapter.addTab(FilteredSourcesFragment.class, null, getString(R.string.sources), null, 2, null);
-        mPagerAdapter.addTab(FilteredLinksFragment.class, null, getString(R.string.links), null, 3, null);
-
-        ThemeUtils.initPagerIndicatorAsActionBarTab(activity, mPagerIndicator, mPagerOverlay);
-        ThemeUtils.setCompatToolbarOverlay(activity, new EmptyDrawable());
-        ThemeUtils.setCompatContentViewOverlay(activity, new EmptyDrawable());
-        ThemeUtils.setWindowOverlayViewOverlay(activity, new EmptyDrawable());
-
-        if (activity instanceof IThemedActivity) {
-            final String backgroundOption = ((IThemedActivity) activity).getCurrentThemeBackgroundOption();
-            final boolean isTransparent = ThemeUtils.isTransparentBackground(backgroundOption);
-            final int actionBarAlpha = isTransparent ? ThemeUtils.getActionBarAlpha(ThemeUtils.getUserThemeBackgroundAlpha(activity)) : 0xFF;
-            mPagerIndicator.setAlpha(actionBarAlpha / 255f);
-        }
-    }
-
-    @Override
-    public void onDestroy() {
-        mViewPager.removeOnPageChangeListener(this);
-        super.onDestroy();
-    }
-
-    @Override
-    public void onAttach(Context context) {
-        super.onAttach(context);
-        if (context instanceof IControlBarActivity) {
-            ((IControlBarActivity) context).registerControlBarOffsetListener(this);
-        }
-    }
-
-    @Override
-    public void onDetach() {
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof IControlBarActivity) {
-            ((IControlBarActivity) activity).unregisterControlBarOffsetListener(this);
-        }
-        super.onDetach();
-    }
-
-
-    @Nullable
-    @Override
-    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
-        return inflater.inflate(R.layout.fragment_content_pages, container, false);
-    }
-
-    @Override
-    public void onViewCreated(View view, Bundle savedInstanceState) {
-        super.onViewCreated(view, savedInstanceState);
-        mViewPager = (ViewPager) view.findViewById(R.id.view_pager);
-        mPagerIndicator = (TabPagerIndicator) view.findViewById(R.id.view_pager_tabs);
-        mPagerOverlay = view.findViewById(R.id.pager_window_overlay);
-    }
-
-    @Override
-    public void onActivityResult(int requestCode, int resultCode, Intent data) {
-        final Object o = mPagerAdapter.instantiateItem(mViewPager, mViewPager.getCurrentItem());
-        if (o instanceof Fragment) {
-            ((Fragment) o).onActivityResult(requestCode, resultCode, data);
-        }
-    }
-
-    @Override
-    public boolean scrollToStart() {
-        final Fragment fragment = getCurrentVisibleFragment();
-        if (!(fragment instanceof RefreshScrollTopInterface)) return false;
-        ((RefreshScrollTopInterface) fragment).scrollToStart();
-        return true;
+        setHasOptionsMenu(true);
     }
 
     @Override
-    public boolean triggerRefresh() {
-        return false;
+    protected void addTabs(SupportTabsAdapter adapter) {
+        adapter.addTab(FilteredUsersFragment.class, null, getString(R.string.users), null, 0, null);
+        adapter.addTab(FilteredKeywordsFragment.class, null, getString(R.string.keywords), null, 1, null);
+        adapter.addTab(FilteredSourcesFragment.class, null, getString(R.string.sources), null, 2, null);
+        adapter.addTab(FilteredLinksFragment.class, null, getString(R.string.links), null, 3, null);
     }
 
-    @Override
-    public Fragment getCurrentVisibleFragment() {
-        final int currentItem = mViewPager.getCurrentItem();
-        if (currentItem < 0 || currentItem >= mPagerAdapter.getCount()) return null;
-        return (Fragment) mPagerAdapter.instantiateItem(mViewPager, currentItem);
-    }
-
-    @Override
-    public boolean triggerRefresh(int position) {
-        return false;
-    }
-
-    @Override
-    protected void fitSystemWindows(Rect insets) {
-        final View view = getView();
-        if (view != null) {
-            final int top = Utils.getInsetsTopWithoutActionBarHeight(getActivity(), insets.top);
-            view.setPadding(insets.left, top, insets.right, insets.bottom);
-        }
-        updateTabOffset();
-    }
-
-    @Override
-    public boolean getSystemWindowsInsets(Rect insets) {
-        if (mPagerIndicator == null) return false;
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof LinkHandlerActivity) {
-            ((LinkHandlerActivity) activity).getSystemWindowsInsets(insets);
-            insets.top = getControlBarHeight();
-            return true;
-        }
-        return false;
-    }
-
-    @Override
-    public void onControlBarOffsetChanged(IControlBarActivity activity, float offset) {
-        mControlBarHeight = activity.getControlBarHeight();
-        mControlBarOffsetPixels = Math.round(mControlBarHeight * (1 - offset));
-        updateTabOffset();
-    }
-
-    @Override
-    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {
-
-    }
-
-    @Override
-    public void onPageSelected(int position) {
-
-    }
-
-    @Override
-    public void onPageScrollStateChanged(int state) {
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof LinkHandlerActivity) {
-            ((LinkHandlerActivity) activity).setControlBarVisibleAnimate(true);
-        }
-    }
-
-    private int getControlBarHeight() {
-        return ThemeUtils.getControlBarHeight(getActivity(), mControlBarHeight);
-    }
-
-    private void updateTabOffset() {
-        ThemeUtils.updateControlBarUi(getActivity(), getControlBarHeight(), mControlBarOffsetPixels,
-                mPagerIndicator, mPagerOverlay);
-    }
 }
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/ListsFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/ListsFragment.java
index a12abb4091..d7b8fa56a2 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/ListsFragment.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/ListsFragment.java
@@ -19,176 +19,23 @@
 
 package org.mariotaku.twidere.fragment.support;
 
-import android.content.Context;
-import android.graphics.Rect;
 import android.os.Bundle;
-import android.support.v4.app.Fragment;
-import android.support.v4.app.FragmentActivity;
-import android.support.v4.view.ViewPager;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
 
 import org.mariotaku.twidere.R;
-import org.mariotaku.twidere.activity.iface.IControlBarActivity;
-import org.mariotaku.twidere.activity.iface.IThemedActivity;
-import org.mariotaku.twidere.activity.LinkHandlerActivity;
 import org.mariotaku.twidere.adapter.SupportTabsAdapter;
-import org.mariotaku.twidere.fragment.iface.IBaseFragment.SystemWindowsInsetsCallback;
-import org.mariotaku.twidere.fragment.iface.RefreshScrollTopInterface;
-import org.mariotaku.twidere.fragment.iface.SupportFragmentCallback;
-import org.mariotaku.twidere.graphic.EmptyDrawable;
-import org.mariotaku.twidere.util.ThemeUtils;
-import org.mariotaku.twidere.util.Utils;
-import org.mariotaku.twidere.view.TabPagerIndicator;
 
-public class ListsFragment extends BaseSupportFragment implements RefreshScrollTopInterface,
-        SupportFragmentCallback, SystemWindowsInsetsCallback,
-        IControlBarActivity.ControlBarOffsetListener, LinkHandlerActivity.HideUiOnScroll, ViewPager.OnPageChangeListener {
-
-    private ViewPager mViewPager;
-    private TabPagerIndicator mPagerIndicator;
-    private View mPagerOverlay;
-
-    private SupportTabsAdapter mPagerAdapter;
-    private int mControlBarHeight;
-    private int mControlBarOffsetPixels;
+public class ListsFragment extends AbsToolbarTabPagesFragment {
 
     @Override
-    public void onActivityCreated(final Bundle savedInstanceState) {
+    public void onActivityCreated(Bundle savedInstanceState) {
         super.onActivityCreated(savedInstanceState);
-        final Bundle args = getArguments();
-        final FragmentActivity activity = getActivity();
-        mPagerAdapter = new SupportTabsAdapter(activity, getChildFragmentManager(), null, 1);
-        mViewPager.setAdapter(mPagerAdapter);
-        mViewPager.setOffscreenPageLimit(2);
-        mViewPager.addOnPageChangeListener(this);
-        mPagerIndicator.setViewPager(mViewPager);
-        mPagerIndicator.setTabDisplayOption(TabPagerIndicator.LABEL);
-
-        mPagerAdapter.addTab(UserListsFragment.class, args, getString(R.string.follows), null, 0, null);
-        mPagerAdapter.addTab(UserListMembershipsFragment.class, args, getString(R.string.belongs_to), 0, 1, null);
-
-        ThemeUtils.initPagerIndicatorAsActionBarTab(activity, mPagerIndicator, mPagerOverlay);
-        ThemeUtils.setCompatToolbarOverlay(activity, new EmptyDrawable());
-        ThemeUtils.setCompatContentViewOverlay(activity, new EmptyDrawable());
-        ThemeUtils.setWindowOverlayViewOverlay(activity, new EmptyDrawable());
-
-        if (activity instanceof IThemedActivity) {
-            final String backgroundOption = ((IThemedActivity) activity).getCurrentThemeBackgroundOption();
-            final boolean isTransparent = ThemeUtils.isTransparentBackground(backgroundOption);
-            final int actionBarAlpha = isTransparent ? ThemeUtils.getActionBarAlpha(ThemeUtils.getUserThemeBackgroundAlpha(activity)) : 0xFF;
-            mPagerIndicator.setAlpha(actionBarAlpha / 255f);
-        }
-        updateTabOffset();
-    }
-
-    @Override
-    public void onDestroy() {
-        mViewPager.removeOnPageChangeListener(this);
-        super.onDestroy();
-    }
-
-    @Override
-    public void onAttach(Context context) {
-        super.onAttach(context);
-        if (context instanceof IControlBarActivity) {
-            ((IControlBarActivity) context).registerControlBarOffsetListener(this);
-        }
-    }
-
-    @Override
-    public void onDetach() {
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof IControlBarActivity) {
-            ((IControlBarActivity) activity).unregisterControlBarOffsetListener(this);
-        }
-        super.onDetach();
-    }
-
-    @Override
-    public View onCreateView(final LayoutInflater inflater, final ViewGroup container, final Bundle savedInstanceState) {
-        return inflater.inflate(R.layout.fragment_content_pages, container, false);
-    }
-
-    @Override
-    public void onViewCreated(final View view, final Bundle savedInstanceState) {
-        super.onViewCreated(view, savedInstanceState);
-        mViewPager = (ViewPager) view.findViewById(R.id.view_pager);
-        mPagerIndicator = (TabPagerIndicator) view.findViewById(R.id.view_pager_tabs);
-        mPagerOverlay = view.findViewById(R.id.pager_window_overlay);
+        setHasOptionsMenu(true);
     }
 
     @Override
-    public boolean scrollToStart() {
-        final Fragment fragment = getCurrentVisibleFragment();
-        if (!(fragment instanceof RefreshScrollTopInterface)) return false;
-        ((RefreshScrollTopInterface) fragment).scrollToStart();
-        return true;
-    }
-
-    @Override
-    public boolean triggerRefresh() {
-        final Fragment fragment = getCurrentVisibleFragment();
-        if (!(fragment instanceof RefreshScrollTopInterface)) return false;
-        ((RefreshScrollTopInterface) fragment).triggerRefresh();
-        return true;
-    }
-
-    @Override
-    public Fragment getCurrentVisibleFragment() {
-        final int currentItem = mViewPager.getCurrentItem();
-        if (currentItem < 0 || currentItem >= mPagerAdapter.getCount()) return null;
-        return (Fragment) mPagerAdapter.instantiateItem(mViewPager, currentItem);
-    }
-
-    @Override
-    public boolean triggerRefresh(final int position) {
-        return false;
-    }
-
-    @Override
-    protected void fitSystemWindows(Rect insets) {
-        super.fitSystemWindows(insets);
-        updateTabOffset();
-    }
-
-    @Override
-    public boolean getSystemWindowsInsets(Rect insets) {
-        return false;
-    }
-
-    @Override
-    public void onControlBarOffsetChanged(IControlBarActivity activity, float offset) {
-        mControlBarHeight = activity.getControlBarHeight();
-        mControlBarOffsetPixels = Math.round(mControlBarHeight * (1 - offset));
-        updateTabOffset();
-    }
-
-    @Override
-    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {
-
-    }
-
-    @Override
-    public void onPageSelected(int position) {
-
-    }
-
-    @Override
-    public void onPageScrollStateChanged(int state) {
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof LinkHandlerActivity) {
-            ((LinkHandlerActivity) activity).setControlBarVisibleAnimate(true);
-        }
-    }
-
-    private int getControlBarHeight() {
-        return ThemeUtils.getControlBarHeight(getActivity(), mControlBarHeight);
-    }
-
-    private void updateTabOffset() {
-        ThemeUtils.updateControlBarUi(getActivity(), getControlBarHeight(), mControlBarOffsetPixels,
-                mPagerIndicator, mPagerOverlay);
+    protected void addTabs(SupportTabsAdapter adapter) {
+        final Bundle args = getArguments();
+        adapter.addTab(UserListsFragment.class, args, getString(R.string.follows), null, 0, null);
+        adapter.addTab(UserListMembershipsFragment.class, args, getString(R.string.belongs_to), 0, 1, null);
     }
 }
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/SearchFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/SearchFragment.java
index 6eed8d8a9d..e839a45800 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/SearchFragment.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/SearchFragment.java
@@ -19,20 +19,13 @@
 
 package org.mariotaku.twidere.fragment.support;
 
-import android.app.ActionBar;
 import android.content.ContentResolver;
 import android.content.ContentValues;
-import android.content.Context;
 import android.content.Intent;
-import android.graphics.Rect;
 import android.os.Bundle;
 import android.provider.SearchRecentSuggestions;
-import android.support.annotation.NonNull;
-import android.support.v4.app.Fragment;
-import android.support.v4.app.FragmentActivity;
-import android.support.v4.view.ViewPager;
 import android.support.v4.view.ViewPager.OnPageChangeListener;
-import android.view.KeyEvent;
+import android.text.TextUtils;
 import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.MenuInflater;
@@ -41,148 +34,29 @@
 import android.view.ViewGroup;
 
 import org.mariotaku.twidere.R;
-import org.mariotaku.twidere.activity.iface.IControlBarActivity;
-import org.mariotaku.twidere.activity.iface.IControlBarActivity.ControlBarOffsetListener;
-import org.mariotaku.twidere.activity.iface.IThemedActivity;
 import org.mariotaku.twidere.activity.ComposeActivity;
 import org.mariotaku.twidere.activity.LinkHandlerActivity;
+import org.mariotaku.twidere.activity.iface.IControlBarActivity.ControlBarOffsetListener;
 import org.mariotaku.twidere.adapter.SupportTabsAdapter;
 import org.mariotaku.twidere.fragment.iface.IBaseFragment.SystemWindowsInsetsCallback;
 import org.mariotaku.twidere.fragment.iface.RefreshScrollTopInterface;
 import org.mariotaku.twidere.fragment.iface.SupportFragmentCallback;
-import org.mariotaku.twidere.graphic.EmptyDrawable;
 import org.mariotaku.twidere.model.UserKey;
 import org.mariotaku.twidere.provider.RecentSearchProvider;
 import org.mariotaku.twidere.provider.TwidereDataStore.SearchHistory;
 import org.mariotaku.twidere.util.AsyncTwitterWrapper;
-import org.mariotaku.twidere.util.KeyboardShortcutsHandler;
-import org.mariotaku.twidere.util.KeyboardShortcutsHandler.KeyboardShortcutCallback;
-import org.mariotaku.twidere.util.ThemeUtils;
-import org.mariotaku.twidere.util.Utils;
-import org.mariotaku.twidere.view.TabPagerIndicator;
 
-public class SearchFragment extends BaseSupportFragment implements RefreshScrollTopInterface,
+public class SearchFragment extends AbsToolbarTabPagesFragment implements RefreshScrollTopInterface,
         SupportFragmentCallback, SystemWindowsInsetsCallback, ControlBarOffsetListener,
-        OnPageChangeListener, KeyboardShortcutCallback, LinkHandlerActivity.HideUiOnScroll {
-
-    private ViewPager mViewPager;
-    private View mPagerWindowOverlay;
-    private TabPagerIndicator mPagerIndicator;
-
-    private SupportTabsAdapter mPagerAdapter;
-
-    private int mControlBarOffsetPixels;
-    private int mControlBarHeight;
-
-    public UserKey getAccountKey() {
-        return getArguments().getParcelable(EXTRA_ACCOUNT_KEY);
-    }
-
-    @Override
-    public Fragment getCurrentVisibleFragment() {
-        final int currentItem = mViewPager.getCurrentItem();
-        if (currentItem < 0 || currentItem >= mPagerAdapter.getCount()) return null;
-        return (Fragment) mPagerAdapter.instantiateItem(mViewPager, currentItem);
-    }
-
-    @Override
-    public boolean triggerRefresh(final int position) {
-        return false;
-    }
-
-    public String getQuery() {
-        return getArguments().getString(EXTRA_QUERY);
-    }
-
-    @Override
-    public boolean getSystemWindowsInsets(Rect insets) {
-        if (mPagerIndicator == null) return false;
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof LinkHandlerActivity) {
-            ((LinkHandlerActivity) activity).getSystemWindowsInsets(insets);
-            insets.top = mPagerIndicator.getHeight() + getControlBarHeight();
-            return true;
-        }
-        return false;
-    }
-
-    @Override
-    public boolean handleKeyboardShortcutSingle(@NonNull KeyboardShortcutsHandler handler, int keyCode, @NonNull KeyEvent event, int metaState) {
-        if (handleFragmentKeyboardShortcutSingle(handler, keyCode, event, metaState)) return true;
-        final String action = handler.getKeyAction(CONTEXT_TAG_NAVIGATION, keyCode, event, metaState);
-        if (action != null) {
-            switch (action) {
-                case ACTION_NAVIGATION_PREVIOUS_TAB: {
-                    final int previous = mViewPager.getCurrentItem() - 1;
-                    if (previous >= 0 && previous < mPagerAdapter.getCount()) {
-                        mViewPager.setCurrentItem(previous, true);
-                    }
-                    return true;
-                }
-                case ACTION_NAVIGATION_NEXT_TAB: {
-                    final int next = mViewPager.getCurrentItem() + 1;
-                    if (next >= 0 && next < mPagerAdapter.getCount()) {
-                        mViewPager.setCurrentItem(next, true);
-                    }
-                    return true;
-                }
-            }
-        }
-        return handler.handleKey(getActivity(), null, keyCode, event, metaState);
-    }
-
-    @Override
-    public boolean isKeyboardShortcutHandled(@NonNull KeyboardShortcutsHandler handler, int keyCode, @NonNull KeyEvent event, int metaState) {
-        if (isFragmentKeyboardShortcutHandled(handler, keyCode, event, metaState)) return true;
-        final String action = handler.getKeyAction(CONTEXT_TAG_NAVIGATION, keyCode, event, metaState);
-        return ACTION_NAVIGATION_PREVIOUS_TAB.equals(action) || ACTION_NAVIGATION_NEXT_TAB.equals(action);
-    }
-
-    @Override
-    public boolean handleKeyboardShortcutRepeat(@NonNull KeyboardShortcutsHandler handler, int keyCode, int repeatCount, @NonNull KeyEvent event, int metaState) {
-        return handleFragmentKeyboardShortcutRepeat(handler, keyCode, repeatCount, event, metaState);
-    }
-
-    @Override
-    public void onAttach(Context context) {
-        super.onAttach(context);
-        if (context instanceof IControlBarActivity) {
-            ((IControlBarActivity) context).registerControlBarOffsetListener(this);
-        }
-    }
-
-    @Override
-    public View onCreateView(final LayoutInflater inflater, final ViewGroup container, final Bundle savedInstanceState) {
-        return inflater.inflate(R.layout.fragment_content_pages, container, false);
-    }
+        OnPageChangeListener, LinkHandlerActivity.HideUiOnScroll {
 
     @Override
     public void onActivityCreated(final Bundle savedInstanceState) {
         super.onActivityCreated(savedInstanceState);
         setHasOptionsMenu(true);
-        final Bundle args = getArguments();
-        final FragmentActivity activity = getActivity();
-        mPagerAdapter = new SupportTabsAdapter(activity, getChildFragmentManager(), null, 1);
-        mPagerAdapter.addTab(StatusesSearchFragment.class, args, getString(R.string.statuses), R.drawable.ic_action_twitter, 0, null);
-        mPagerAdapter.addTab(SearchUsersFragment.class, args, getString(R.string.users), R.drawable.ic_action_user, 1, null);
-        mViewPager.setAdapter(mPagerAdapter);
-        mViewPager.setOffscreenPageLimit(2);
-        mPagerIndicator.setViewPager(mViewPager);
-        mPagerIndicator.setTabDisplayOption(TabPagerIndicator.LABEL);
-        mPagerIndicator.setOnPageChangeListener(this);
-        ThemeUtils.initPagerIndicatorAsActionBarTab(activity, mPagerIndicator, mPagerWindowOverlay);
-        ThemeUtils.setCompatToolbarOverlay(activity, new EmptyDrawable());
-        ThemeUtils.setCompatContentViewOverlay(activity, new EmptyDrawable());
-        ThemeUtils.setWindowOverlayViewOverlay(activity, new EmptyDrawable());
 
-        if (activity instanceof IThemedActivity) {
-            final String backgroundOption = ((IThemedActivity) activity).getCurrentThemeBackgroundOption();
-            final boolean isTransparent = ThemeUtils.isTransparentBackground(backgroundOption);
-            final int actionBarAlpha = isTransparent ? ThemeUtils.getActionBarAlpha(ThemeUtils.getUserThemeBackgroundAlpha(activity)) : 0xFF;
-            mPagerIndicator.setAlpha(actionBarAlpha / 255f);
-        }
-        if (savedInstanceState == null && args != null && args.containsKey(EXTRA_QUERY)) {
-            final String query = args.getString(EXTRA_QUERY);
+        final String query = getQuery();
+        if (savedInstanceState == null && !TextUtils.isEmpty(query)) {
             final SearchRecentSuggestions suggestions = new SearchRecentSuggestions(getActivity(),
                     RecentSearchProvider.AUTHORITY, RecentSearchProvider.MODE);
             suggestions.saveRecentQuery(query, null);
@@ -190,23 +64,7 @@ public void onActivityCreated(final Bundle savedInstanceState) {
             final ContentValues values = new ContentValues();
             values.put(SearchHistory.QUERY, query);
             cr.insert(SearchHistory.CONTENT_URI, values);
-            if (activity instanceof LinkHandlerActivity) {
-                final ActionBar ab = activity.getActionBar();
-                if (ab != null) {
-                    ab.setSubtitle(query);
-                }
-            }
-        }
-        updateTabOffset();
-    }
-
-    @Override
-    public void onDetach() {
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof IControlBarActivity) {
-            ((IControlBarActivity) activity).unregisterControlBarOffsetListener(this);
         }
-        super.onDetach();
     }
 
     @Override
@@ -245,105 +103,25 @@ public boolean onOptionsItemSelected(final MenuItem item) {
     }
 
     @Override
-    public void onViewCreated(final View view, final Bundle savedInstanceState) {
-        super.onViewCreated(view, savedInstanceState);
-        mViewPager = (ViewPager) view.findViewById(R.id.view_pager);
-        mPagerWindowOverlay = view.findViewById(R.id.pager_window_overlay);
-        mPagerIndicator = (TabPagerIndicator) view.findViewById(R.id.view_pager_tabs);
-    }
-
-    @Override
-    protected void fitSystemWindows(Rect insets) {
-        final View view = getView();
-        if (view != null) {
-            final int top = Utils.getInsetsTopWithoutActionBarHeight(getActivity(), insets.top);
-//            view.setPadding(insets.left, top, insets.right, insets.bottom);
-        }
-        updateTabOffset();
-    }
-
-    @Override
-    public void onControlBarOffsetChanged(IControlBarActivity activity, float offset) {
-        mControlBarHeight = activity.getControlBarHeight();
-        mControlBarOffsetPixels = Math.round(mControlBarHeight * (1 - offset));
-        updateTabOffset();
-    }
-
-    @Override
-    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {
-
+    public boolean triggerRefresh(final int position) {
+        return false;
     }
 
-    @Override
-    public void onPageSelected(int position) {
-
+    public UserKey getAccountKey() {
+        return getArguments().getParcelable(EXTRA_ACCOUNT_KEY);
     }
 
-    @Override
-    public void onPageScrollStateChanged(int state) {
-        final FragmentActivity activity = getActivity();
-        if (activity instanceof LinkHandlerActivity) {
-            ((LinkHandlerActivity) activity).setControlBarVisibleAnimate(true);
-        }
+    public String getQuery() {
+        return getArguments().getString(EXTRA_QUERY);
     }
 
-    @Override
-    public boolean scrollToStart() {
-        final Fragment fragment = getCurrentVisibleFragment();
-        if (!(fragment instanceof RefreshScrollTopInterface)) return false;
-        ((RefreshScrollTopInterface) fragment).scrollToStart();
-        return true;
-    }
 
     @Override
-    public boolean triggerRefresh() {
-        final Fragment fragment = getCurrentVisibleFragment();
-        if (!(fragment instanceof RefreshScrollTopInterface)) return false;
-        ((RefreshScrollTopInterface) fragment).triggerRefresh();
-        return true;
-    }
-
-    private int getControlBarHeight() {
-        return ThemeUtils.getControlBarHeight(getActivity(), mControlBarHeight);
-    }
-
-    private Fragment getKeyboardShortcutRecipient() {
-        return getCurrentVisibleFragment();
-    }
-
-    private boolean handleFragmentKeyboardShortcutRepeat(KeyboardShortcutsHandler handler, int keyCode,
-                                                         int repeatCount, @NonNull KeyEvent event, int metaState) {
-        final Fragment fragment = getKeyboardShortcutRecipient();
-        if (fragment instanceof KeyboardShortcutCallback) {
-            return ((KeyboardShortcutCallback) fragment).handleKeyboardShortcutRepeat(handler, keyCode,
-                    repeatCount, event, metaState);
-        }
-        return false;
-    }
-
-    private boolean handleFragmentKeyboardShortcutSingle(KeyboardShortcutsHandler handler, int keyCode,
-                                                         @NonNull KeyEvent event, int metaState) {
-        final Fragment fragment = getKeyboardShortcutRecipient();
-        if (fragment instanceof KeyboardShortcutCallback) {
-            return ((KeyboardShortcutCallback) fragment).handleKeyboardShortcutSingle(handler, keyCode,
-                    event, metaState);
-        }
-        return false;
-    }
-
-    private boolean isFragmentKeyboardShortcutHandled(KeyboardShortcutsHandler handler, int keyCode,
-                                                      @NonNull KeyEvent event, int metaState) {
-        final Fragment fragment = getKeyboardShortcutRecipient();
-        if (fragment instanceof KeyboardShortcutCallback) {
-            return ((KeyboardShortcutCallback) fragment).isKeyboardShortcutHandled(handler, keyCode,
-                    event, metaState);
-        }
-        return false;
+    protected void addTabs(SupportTabsAdapter adapter) {
+        final Bundle args = getArguments();
+        adapter.addTab(StatusesSearchFragment.class, args, getString(R.string.statuses), R.drawable.ic_action_twitter, 0, null);
+        adapter.addTab(SearchUsersFragment.class, args, getString(R.string.users), R.drawable.ic_action_user, 1, null);
     }
 
-    private void updateTabOffset() {
-        ThemeUtils.updateControlBarUi(getActivity(), getControlBarHeight(), mControlBarOffsetPixels,
-                mPagerIndicator, mPagerWindowOverlay);
-    }
 
 }
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserFragment.java
index dec94bc792..b221bcef3c 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserFragment.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserFragment.java
@@ -53,9 +53,12 @@
 import android.support.v4.content.Loader;
 import android.support.v4.content.res.ResourcesCompat;
 import android.support.v4.graphics.ColorUtils;
+import android.support.v4.view.OnApplyWindowInsetsListener;
 import android.support.v4.view.ViewCompat;
 import android.support.v4.view.ViewPager;
 import android.support.v4.view.ViewPager.OnPageChangeListener;
+import android.support.v4.view.WindowCompat;
+import android.support.v4.view.WindowInsetsCompat;
 import android.support.v7.app.ActionBar;
 import android.support.v7.app.AppCompatActivity;
 import android.support.v7.widget.Toolbar;
@@ -72,12 +75,15 @@
 import android.view.View.OnClickListener;
 import android.view.View.OnTouchListener;
 import android.view.ViewGroup;
+import android.view.Window;
 import android.view.animation.AnimationUtils;
 import android.widget.Button;
 import android.widget.ImageView;
 import android.widget.ProgressBar;
 import android.widget.TextView;
 
+import com.afollestad.appthemeengine.Config;
+import com.afollestad.appthemeengine.util.ATEUtil;
 import com.squareup.otto.Subscribe;
 
 import org.apache.commons.lang3.ObjectUtils;
@@ -95,6 +101,7 @@
 import org.mariotaku.twidere.api.twitter.model.FriendshipUpdate;
 import org.mariotaku.twidere.api.twitter.model.Relationship;
 import org.mariotaku.twidere.fragment.iface.IBaseFragment.SystemWindowsInsetsCallback;
+import org.mariotaku.twidere.fragment.iface.IToolBarSupportFragment;
 import org.mariotaku.twidere.fragment.iface.RefreshScrollTopInterface;
 import org.mariotaku.twidere.fragment.iface.SupportFragmentCallback;
 import org.mariotaku.twidere.graphic.ActionBarColorDrawable;
@@ -138,18 +145,21 @@
 import org.mariotaku.twidere.util.TwidereLinkify.OnLinkClickListener;
 import org.mariotaku.twidere.util.TwidereMathUtils;
 import org.mariotaku.twidere.util.TwitterAPIFactory;
-import org.mariotaku.twidere.util.UserColorNameManager;
+import org.mariotaku.twidere.util.UserColorNameManager.UserColorChangedListener;
+import org.mariotaku.twidere.util.UserColorNameManager.UserNicknameChangedListener;
 import org.mariotaku.twidere.util.Utils;
 import org.mariotaku.twidere.util.menu.TwidereMenuInfo;
 import org.mariotaku.twidere.util.support.ActivitySupport;
 import org.mariotaku.twidere.util.support.ActivitySupport.TaskDescriptionCompat;
 import org.mariotaku.twidere.util.support.ViewSupport;
+import org.mariotaku.twidere.util.support.WindowSupport;
 import org.mariotaku.twidere.view.ColorLabelRelativeLayout;
 import org.mariotaku.twidere.view.HeaderDrawerLayout;
 import org.mariotaku.twidere.view.HeaderDrawerLayout.DrawerCallback;
 import org.mariotaku.twidere.view.ProfileBannerImageView;
 import org.mariotaku.twidere.view.ShapedImageView;
 import org.mariotaku.twidere.view.TabPagerIndicator;
+import org.mariotaku.twidere.view.iface.IExtendedView;
 import org.mariotaku.twidere.view.iface.IExtendedView.OnSizeChangedListener;
 
 import java.util.Calendar;
@@ -162,7 +172,7 @@
 public class UserFragment extends BaseSupportFragment implements OnClickListener, OnLinkClickListener,
         OnSizeChangedListener, OnTouchListener, DrawerCallback, SupportFragmentCallback,
         SystemWindowsInsetsCallback, RefreshScrollTopInterface, OnPageChangeListener, KeyboardShortcutCallback,
-        UserColorNameManager.UserColorChangedListener, UserColorNameManager.UserNicknameChangedListener {
+        UserColorChangedListener, UserNicknameChangedListener, IToolBarSupportFragment {
 
     public static final String TRANSITION_NAME_PROFILE_IMAGE = "profile_image";
     public static final String TRANSITION_NAME_PROFILE_TYPE = "profile_type";
@@ -198,6 +208,7 @@ public class UserFragment extends BaseSupportFragment implements OnClickListener
     private View mPagerOverlay;
     private View mErrorOverlay;
     private View mProfileBannerContainer;
+    private View mProfileContentContainer;
     private Button mFollowButton;
     private ProgressBar mFollowProgress;
     private View mPagesContent, mPagesErrorContainer;
@@ -206,6 +217,7 @@ public class UserFragment extends BaseSupportFragment implements OnClickListener
     private View mProfileNameBackground;
     private View mProfileDetailsContainer;
     private View mFollowingYouIndicator;
+    private Toolbar mToolbar;
 
     private ActionBarDrawable mActionBarBackground;
     private SupportTabsAdapter mPagerAdapter;
@@ -817,7 +829,6 @@ public void onSharedElementEnd(List<String> sharedElementNames, List<View> share
 
         if (activity instanceof IThemedActivity) {
             ViewSupport.setBackground(mPagerOverlay, ThemeUtils.getNormalWindowContentOverlay(activity));
-//            ViewSupport.setBackground(mErrorOverlay, ThemeUtils.getNormalWindowContentOverlay(activity));
             setUiColor(((IThemedActivity) activity).getCurrentThemeColor());
         }
 
@@ -1126,6 +1137,8 @@ public boolean onOptionsItemSelected(final MenuItem item) {
     @Override
     public void onViewCreated(final View view, final Bundle savedInstanceState) {
         super.onViewCreated(view, savedInstanceState);
+
+        mToolbar = (Toolbar) view.findViewById(R.id.toolbar);
         mHeaderDrawerLayout = (HeaderDrawerLayout) view.findViewById(R.id.user_profile_drawer);
         final View headerView = mHeaderDrawerLayout.getHeader();
         final View contentView = mHeaderDrawerLayout.getContent();
@@ -1137,6 +1150,7 @@ public void onViewCreated(final View view, final Bundle savedInstanceState) {
         mProfileBannerView = (ProfileBannerImageView) view.findViewById(R.id.profile_banner);
         mProfileBirthdayBannerView = view.findViewById(R.id.profile_birthday_banner);
         mProfileBannerContainer = view.findViewById(R.id.profile_banner_container);
+        mProfileContentContainer = view.findViewById(R.id.profile_content_container);
         mNameView = (TextView) headerView.findViewById(R.id.name);
         mScreenNameView = (TextView) headerView.findViewById(R.id.screen_name);
         mDescriptionView = (TextView) headerView.findViewById(R.id.description);
@@ -1159,7 +1173,7 @@ public void onViewCreated(final View view, final Bundle savedInstanceState) {
         mURLContainer = headerView.findViewById(R.id.url_container);
         mProfileBannerSpace = headerView.findViewById(R.id.profile_banner_space);
         mViewPager = (ViewPager) contentView.findViewById(R.id.view_pager);
-        mPagerIndicator = (TabPagerIndicator) contentView.findViewById(R.id.view_pager_tabs);
+        mPagerIndicator = (TabPagerIndicator) contentView.findViewById(R.id.toolbar_tabs);
         mPagerOverlay = contentView.findViewById(R.id.pager_window_overlay);
         mErrorOverlay = contentView.findViewById(R.id.error_window_overlay);
         mFollowButton = (Button) headerView.findViewById(R.id.follow);
@@ -1171,6 +1185,38 @@ public void onViewCreated(final View view, final Bundle savedInstanceState) {
         mProfileNameBackground = view.findViewById(R.id.profile_name_background);
         mProfileDetailsContainer = view.findViewById(R.id.profile_details_container);
         mFollowingYouIndicator = view.findViewById(R.id.following_you_indicator);
+
+        final Object host = getHost();
+        if (host instanceof AppCompatActivity) {
+            ((AppCompatActivity) host).setSupportActionBar(mToolbar);
+        }
+
+//        ((IExtendedView) view).setOnFitSystemWindowsListener(new IExtendedView.OnFitSystemWindowsListener() {
+//            @Override
+//            public void onFitSystemWindows(Rect insets) {
+//                mProfileContentContainer.setPadding(0, insets.top, 0, 0);
+//            }
+//        });
+        ((IExtendedView) view).setOnSizeChangedListener(new OnSizeChangedListener() {
+            @Override
+            public void onSizeChanged(View view, int w, int h, int oldw, int oldh) {
+                final int paddingTop = mToolbar.getMeasuredHeight();
+                mHeaderDrawerLayout.setPadding(0, paddingTop, 0, 0);
+            }
+        });
+        //TODO FUCK STATUS BAR COLOR
+        if (ViewCompat.getFitsSystemWindows(view)) {
+            view.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN |
+                    View.SYSTEM_UI_FLAG_LAYOUT_STABLE);
+            ViewCompat.setOnApplyWindowInsetsListener(view, new OnApplyWindowInsetsListener() {
+                @Override
+                public WindowInsetsCompat onApplyWindowInsets(View v, WindowInsetsCompat insets) {
+                    mProfileContentContainer.setPadding(0, insets.getSystemWindowInsetTop(), 0, 0);
+                    return insets.consumeSystemWindowInsets();
+                }
+            });
+        }
+
     }
 
     @Override
@@ -1252,11 +1298,15 @@ private Fragment getKeyboardShortcutRecipient() {
 
     @Override
     protected void fitSystemWindows(Rect insets) {
-        final ThemedAppCompatActivity activity = (ThemedAppCompatActivity) getActivity();
-        mHeaderDrawerLayout.setPadding(insets.left, insets.top, insets.right, insets.bottom);
-        final String backgroundOption = activity.getCurrentThemeBackgroundOption();
-        final boolean isTransparentBackground = ThemeUtils.isTransparentBackground(backgroundOption);
-        mHeaderDrawerLayout.setClipToPadding(isTransparentBackground);
+    }
+
+    @Override
+    public boolean setupWindow(FragmentActivity activity) {
+        if (activity instanceof AppCompatActivity) {
+            ((AppCompatActivity) activity).supportRequestWindowFeature(Window.FEATURE_NO_TITLE);
+            ((AppCompatActivity) activity).supportRequestWindowFeature(WindowCompat.FEATURE_ACTION_MODE_OVERLAY);
+        }
+        return true;
     }
 
     @Override
@@ -1570,6 +1620,19 @@ private void updateScrollOffset(int offset) {
         profileBannerView.setTranslationY(offset / 2);
         profileBirthdayBannerView.setTranslationY(offset / 2);
 
+        final ThemedAppCompatActivity activity = (ThemedAppCompatActivity) getActivity();
+
+
+        final int statusBarColor;
+        if (Config.coloredStatusBar(activity, activity.getATEKey())) {
+            statusBarColor = (int) sArgbEvaluator.evaluate(factor, ATEUtil.darkenColor(0xA0000000),
+                    ATEUtil.darkenColor(mUiColor));
+        } else {
+            statusBarColor = (int) sArgbEvaluator.evaluate(factor, ATEUtil.darkenColor(0xA0000000),
+                    Color.BLACK);
+        }
+        WindowSupport.setStatusBarColor(activity.getWindow(), statusBarColor);
+
         if (mActionBarBackground != null) {
             mActionBarBackground.setFactor(factor);
 
@@ -1582,7 +1645,6 @@ private void updateScrollOffset(int offset) {
             }
             mActionBarBackground.setOutlineAlphaFactor(tabOutlineAlphaFactor);
 
-            final ThemedAppCompatActivity activity = (ThemedAppCompatActivity) getActivity();
 
             if (Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {
                 setCompatToolbarOverlayAlpha(activity, factor * tabOutlineAlphaFactor);
@@ -1646,6 +1708,26 @@ private void updateTitleAlpha() {
         }
     }
 
+    @Override
+    public Toolbar getToolbar() {
+        return mToolbar;
+    }
+
+    @Override
+    public float getControlBarOffset() {
+        return 0;
+    }
+
+    @Override
+    public void setControlBarOffset(float offset) {
+
+    }
+
+    @Override
+    public int getControlBarHeight() {
+        return 0;
+    }
+
     @StringDef({Referral.SEARCH_RESULT, Referral.USER_MENTION, Referral.STATUS,
             Referral.TIMELINE_STATUS, Referral.DIRECT, Referral.EXTERNAL, Referral.SELF_PROFILE})
     public @interface Referral {
diff --git a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserListFragment.java b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserListFragment.java
index 281839ba49..962a7a4782 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserListFragment.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/fragment/support/UserListFragment.java
@@ -394,7 +394,7 @@ public void onLoaderReset(final Loader<SingleResponse<ParcelableUserList>> loade
     public void onViewCreated(final View view, final Bundle savedInstanceState) {
         super.onViewCreated(view, savedInstanceState);
         mViewPager = (ViewPager) view.findViewById(R.id.view_pager);
-        mPagerIndicator = (TabPagerIndicator) view.findViewById(R.id.view_pager_tabs);
+        mPagerIndicator = (TabPagerIndicator) view.findViewById(R.id.toolbar_tabs);
         mPagerOverlay = view.findViewById(R.id.pager_window_overlay);
     }
 
diff --git a/twidere/src/main/java/org/mariotaku/twidere/util/ThemeUtils.java b/twidere/src/main/java/org/mariotaku/twidere/util/ThemeUtils.java
index 5a98831cee..bc690d4b46 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/util/ThemeUtils.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/util/ThemeUtils.java
@@ -38,8 +38,6 @@
 import android.support.v4.view.ViewCompat;
 import android.support.v7.app.AppCompatDelegate;
 import android.support.v7.view.menu.ActionMenuItemView;
-import android.support.v7.widget.ActionBarContainer;
-import android.support.v7.widget.ActionBarContextView;
 import android.support.v7.widget.ActionBarOverlayLayout;
 import android.support.v7.widget.ActionMenuView;
 import android.support.v7.widget.ContentFrameLayout;
@@ -89,14 +87,6 @@ private ThemeUtils() {
     }
 
 
-    public static void applyActionBarBackground(final ActionBarContainer actionBar, final Context context,
-                                                final int accentColor, String backgroundOption, boolean outlineEnabled) {
-        if (actionBar == null || context == null) return;
-        actionBar.setPrimaryBackground(getActionBarBackground(context, accentColor, backgroundOption, outlineEnabled));
-        actionBar.setSplitBackground(getActionBarSplitBackground(context));
-        actionBar.setStackedBackground(getActionBarStackedBackground(context, accentColor, backgroundOption, outlineEnabled));
-    }
-
     public static void applyColorFilterToMenuIcon(final Menu menu, final int color, final int popupColor,
                                                   final int highlightColor, final Mode mode,
                                                   final int... excludedGroups) {
@@ -123,13 +113,6 @@ public static void applyColorFilterToMenuIcon(final Menu menu, final int color,
         }
     }
 
-    public static void setActionBarContextViewBackground(@NonNull ActionBarContextView contextView,
-                                                         int accentColor,
-                                                         String backgroundOption, boolean outlineEnabled) {
-        ViewSupport.setBackground(contextView, getActionBarBackground(contextView.getContext(),
-                accentColor, backgroundOption, outlineEnabled));
-    }
-
     public static void applyWindowBackground(@NonNull Context context, @NonNull Window window, String option, int alpha) {
         if (isWindowFloating(context)) return;
         if (VALUE_THEME_BACKGROUND_TRANSPARENT.equals(option)) {
@@ -168,15 +151,6 @@ public static Drawable getActionBarBackground(final Context context, final int a
         return ActionBarColorDrawable.create(actionBarColor, outlineEnabled);
     }
 
-    public static Drawable getActionBarSplitBackground(final Context context) {
-        final TypedArray a = context.obtainStyledAttributes(new int[]{android.R.attr.backgroundSplit});
-        try {
-            return a.getDrawable(0);
-        } finally {
-            a.recycle();
-        }
-    }
-
     @NonNull
     public static Drawable getActionBarStackedBackground(final Context context,
                                                          final int accentColor, String backgroundOption,
@@ -345,16 +319,6 @@ public static void getDarkLightForegroundColors(final Context context, int[] col
         }
     }
 
-    public static void getColorForegroundAndInverse(final Context context, int[] colors) {
-        final TypedArray a = context.obtainStyledAttributes(ATTRS_COLOR_FOREGROUND_AND_INVERSE);
-        try {
-            colors[0] = a.getColor(0, Color.WHITE);
-            colors[1] = a.getColor(1, Color.BLACK);
-        } finally {
-            a.recycle();
-        }
-    }
-
     public static int getThemeBackgroundColor(final Context context) {
         final TypedArray a = context.obtainStyledAttributes(new int[]{android.R.attr.colorBackground});
         try {
@@ -841,10 +805,6 @@ public static int getActionBarColor(Context context, int themeColor, String back
         return ContextCompat.getColor(context, R.color.background_color_action_bar_dark);
     }
 
-    public static boolean isDarkTheme(final String name) {
-        return VALUE_THEME_NAME_DARK.equals(name);
-    }
-
     public static void applyToolbarItemColor(Context context, Toolbar toolbar, int toolbarColor) {
         if (toolbar == null || isDarkTheme(context)) {
             return;
@@ -867,33 +827,6 @@ public static void applyToolbarItemColor(Context context, Toolbar toolbar, int t
         }
     }
 
-    public static void updateControlBarUi(FragmentActivity activity, int controlBarHeight,
-                                          int controlBarOffsetPixels, View pagerIndicator,
-                                          View pagerWindowOverlay) {
-        final int translationY = controlBarHeight - controlBarOffsetPixels;
-        if (activity instanceof LinkHandlerActivity) {
-            final View view = activity.getWindow().findViewById(android.support.v7.appcompat.R.id.action_bar);
-            if (view != null && controlBarHeight != 0) {
-                view.setAlpha(translationY / (float) controlBarHeight);
-            }
-        }
-        pagerIndicator.setTranslationY(translationY);
-        pagerWindowOverlay.setTranslationY(translationY);
-    }
-
-    public static int getControlBarHeight(FragmentActivity activity, int defaultControlBarHeight) {
-        final int controlBarHeight;
-        if (activity instanceof LinkHandlerActivity) {
-            controlBarHeight = ((LinkHandlerActivity) activity).getControlBarHeight();
-        } else {
-            controlBarHeight = defaultControlBarHeight;
-        }
-        if (controlBarHeight == 0) {
-            return getActionBarHeight(activity);
-        }
-        return controlBarHeight;
-    }
-
     public static int getLocalNightMode(SharedPreferences preferences) {
         switch (Utils.getNonEmptyString(preferences, KEY_THEME, VALUE_THEME_NAME_LIGHT)) {
             case VALUE_THEME_NAME_DARK: {
diff --git a/twidere/src/main/java/org/mariotaku/twidere/util/theme/ActionBarContextViewViewProcessor.java b/twidere/src/main/java/org/mariotaku/twidere/util/theme/ActionBarContextViewViewProcessor.java
new file mode 100644
index 0000000000..8edf4851f5
--- /dev/null
+++ b/twidere/src/main/java/org/mariotaku/twidere/util/theme/ActionBarContextViewViewProcessor.java
@@ -0,0 +1,20 @@
+package org.mariotaku.twidere.util.theme;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.v7.widget.ActionBarContextView;
+
+import com.afollestad.appthemeengine.Config;
+import com.afollestad.appthemeengine.viewprocessors.ViewProcessor;
+
+/**
+ * Created by mariotaku on 16/3/16.
+ */
+public class ActionBarContextViewViewProcessor implements ViewProcessor<ActionBarContextView, Object> {
+    @Override
+    public void process(@NonNull Context context, String key, ActionBarContextView target,
+                        Object extra) {
+        final int primaryColor = Config.primaryColor(context, key);
+        target.setBackgroundColor(primaryColor);
+    }
+}
diff --git a/twidere/src/main/java/org/mariotaku/twidere/util/theme/FloatingActionButtonViewProcessor.java b/twidere/src/main/java/org/mariotaku/twidere/util/theme/FloatingActionButtonViewProcessor.java
new file mode 100644
index 0000000000..3a42759436
--- /dev/null
+++ b/twidere/src/main/java/org/mariotaku/twidere/util/theme/FloatingActionButtonViewProcessor.java
@@ -0,0 +1,25 @@
+package org.mariotaku.twidere.util.theme;
+
+import android.content.Context;
+import android.content.res.ColorStateList;
+import android.graphics.Color;
+import android.support.annotation.NonNull;
+import android.support.design.widget.FloatingActionButton;
+
+import com.afollestad.appthemeengine.Config;
+import com.afollestad.appthemeengine.util.ATEUtil;
+import com.afollestad.appthemeengine.viewprocessors.ViewProcessor;
+
+/**
+ * Created by mariotaku on 16/3/16.
+ */
+public class FloatingActionButtonViewProcessor implements ViewProcessor<FloatingActionButton, Object> {
+    @Override
+    public void process(@NonNull Context context, String key, FloatingActionButton target, Object extra) {
+        final int primaryColor = Config.primaryColor(context, key);
+        final boolean isDark = !ATEUtil.isColorLight(primaryColor);
+        final int primaryColorDependent = isDark ? Color.WHITE : Color.BLACK;
+        target.setBackgroundTintList(ColorStateList.valueOf(primaryColor));
+        target.setColorFilter(primaryColorDependent);
+    }
+}
diff --git a/twidere/src/main/java/org/mariotaku/twidere/util/theme/TabPagerIndicatorViewProcessor.java b/twidere/src/main/java/org/mariotaku/twidere/util/theme/TabPagerIndicatorViewProcessor.java
index 6d2f11d85b..58f1078742 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/util/theme/TabPagerIndicatorViewProcessor.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/util/theme/TabPagerIndicatorViewProcessor.java
@@ -15,17 +15,17 @@
  */
 public class TabPagerIndicatorViewProcessor implements ViewProcessor<TabPagerIndicator, Object> {
     @Override
-    public void process(@NonNull Context context, String key, TabPagerIndicator view, Object extra) {
+    public void process(@NonNull Context context, String key, TabPagerIndicator target, Object extra) {
         final int primaryColor = Config.primaryColor(context, key);
         final boolean isDark = !ATEUtil.isColorLight(primaryColor);
         final int primaryColorDependent = isDark ? Color.WHITE : Color.BLACK;
-        view.setIconColor(primaryColorDependent);
-        view.setLabelColor(primaryColorDependent);
+        target.setIconColor(primaryColorDependent);
+        target.setLabelColor(primaryColorDependent);
         if (Config.coloredActionBar(context, key)) {
-            view.setStripColor(primaryColorDependent);
+            target.setStripColor(primaryColorDependent);
         } else {
-            view.setStripColor(Config.accentColor(context, key));
+            target.setStripColor(Config.accentColor(context, key));
         }
-        view.updateAppearance();
+        target.updateAppearance();
     }
 }
diff --git a/twidere/src/main/java/org/mariotaku/twidere/view/TabPagerIndicator.java b/twidere/src/main/java/org/mariotaku/twidere/view/TabPagerIndicator.java
index efeddbcdef..0cc89c077a 100644
--- a/twidere/src/main/java/org/mariotaku/twidere/view/TabPagerIndicator.java
+++ b/twidere/src/main/java/org/mariotaku/twidere/view/TabPagerIndicator.java
@@ -528,7 +528,7 @@ public void setTabExpandEnabled(boolean tabExpandEnabled) {
 
     public void updateAppearance() {
         final int positionStart = mLayoutManager.findFirstVisibleItemPosition();
-        final int itemCount = mLayoutManager.findLastVisibleItemPosition() - positionStart;
+        final int itemCount = mLayoutManager.findLastVisibleItemPosition() - positionStart + 1;
         mIndicatorAdapter.notifyItemRangeChanged(positionStart, itemCount);
     }
 
@@ -598,27 +598,22 @@ public void clearBadge() {
 
         public void setDisplayBadge(boolean display) {
             mDisplayBadge = display;
-//            notifyDataSetChanged();
         }
 
         public void setIconColor(int color) {
             mIconColor = color;
-//            notifyDataSetChanged();
         }
 
         public void setLabelColor(int color) {
             mLabelColor = color;
-            notifyDataSetChanged();
         }
 
         public void setStripColor(int color) {
             mStripColor = color;
-//            notifyDataSetChanged();
         }
 
         public void setTabProvider(TabProvider tabProvider) {
             mTabProvider = tabProvider;
-//            notifyDataSetChanged();
         }
     }
 
diff --git a/twidere/src/main/java/org/mariotaku/twidere/view/TwidereActionBarContainer.java b/twidere/src/main/java/org/mariotaku/twidere/view/TwidereActionBarContainer.java
deleted file mode 100644
index f82c430a14..0000000000
--- a/twidere/src/main/java/org/mariotaku/twidere/view/TwidereActionBarContainer.java
+++ /dev/null
@@ -1,53 +0,0 @@
-/*
-* Twidere - Twitter client for Android
-*
-*  Copyright (C) 2012-2015 Mariotaku Lee <mariotaku.lee@gmail.com>
-*
-*  This program is free software: you can redistribute it and/or modify
-*  it under the terms of the GNU General Public License as published by
-*  the Free Software Foundation, either version 3 of the License, or
-*  (at your option) any later version.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  GNU General Public License for more details.
-*
-*  You should have received a copy of the GNU General Public License
-*  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-*/
-
-package org.mariotaku.twidere.view;
-
-import android.content.Context;
-import android.content.res.TypedArray;
-import android.support.v7.widget.ActionBarContainer;
-import android.util.AttributeSet;
-
-import org.mariotaku.twidere.R;
-import org.mariotaku.twidere.activity.iface.IThemedActivity;
-import org.mariotaku.twidere.util.ThemeUtils;
-
-/**
- * Wraps context with ActionBar context
- * Created by mariotaku on 15/4/28.
- */
-public class TwidereActionBarContainer extends ActionBarContainer {
-
-    private static final int[] ATTRS = {android.R.attr.layout};
-
-    public TwidereActionBarContainer(Context context, AttributeSet attrs) {
-        super(wrapContext(context), attrs);
-        final TypedArray a = getContext().obtainStyledAttributes(attrs, ATTRS);
-        inflate(getContext(), a.getResourceId(0, R.layout.layout_actionbar_content), this);
-        a.recycle();
-    }
-
-    private static Context wrapContext(Context context) {
-        if (context instanceof IThemedActivity) {
-            return ThemeUtils.getActionBarThemedContext(context,
-                    ((IThemedActivity) context).getCurrentThemeColor());
-        }
-        return ThemeUtils.getActionBarThemedContext(context);
-    }
-}
diff --git a/twidere/src/main/res/layout/activity_home_content.xml b/twidere/src/main/res/layout/activity_home_content.xml
index f570ab7cef..7fe21ef2ed 100644
--- a/twidere/src/main/res/layout/activity_home_content.xml
+++ b/twidere/src/main/res/layout/activity_home_content.xml
@@ -21,6 +21,7 @@
     android:id="@+id/home_content"
     xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:app="http://schemas.android.com/apk/res-auto"
+    xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
     android:layout_height="match_parent">
 
@@ -46,7 +47,8 @@
             android:layout_height="match_parent"
             app:tabDisplayOption="icon"
             app:tabExpandEnabled="true"
-            app:tabHorizontalPadding="@dimen/element_spacing_normal"/>
+            app:tabHorizontalPadding="@dimen/element_spacing_normal"
+            tools:listitem="@layout/layout_tab_item"/>
     </android.support.v7.widget.Toolbar>
 
     <android.support.design.widget.FloatingActionButton
diff --git a/twidere/src/main/res/layout/activity_image_cropper.xml b/twidere/src/main/res/layout/activity_image_cropper.xml
index 73271ff1b1..5bea558afc 100644
--- a/twidere/src/main/res/layout/activity_image_cropper.xml
+++ b/twidere/src/main/res/layout/activity_image_cropper.xml
@@ -18,43 +18,38 @@
   ~  along with this program.  If not, see <http://www.gnu.org/licenses/>.
   -->
 
-<org.mariotaku.twidere.view.TintedStatusFrameLayout
-    android:id="@+id/main_content"
+<RelativeLayout
     xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:app="http://schemas.android.com/apk/res-auto"
     xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
-    android:layout_height="match_parent"
-    app:setPadding="true">
+    android:layout_height="match_parent">
 
-    <RelativeLayout
+    <com.soundcloud.android.crop.CropImageView
+        android:id="@+id/crop_image"
         android:layout_width="match_parent"
-        android:layout_height="match_parent">
-
-        <com.soundcloud.android.crop.CropImageView
-            android:id="@+id/crop_image"
-            android:layout_width="match_parent"
-            android:layout_height="match_parent"
-            android:layout_below="@+id/done_cancel_bar"
-            android:background="@drawable/crop__texture"/>
-
-        <org.mariotaku.twidere.view.TwidereActionBarContextFrameLayout
-            android:id="@+id/done_cancel_bar"
-            style="?attr/actionBarStyle"
-            android:layout_width="match_parent"
-            android:layout_height="?actionBarSize"
-            android:layout_alignParentTop="true"
-            android:layout="@layout/layout_image_cropper_done_cancel"
-            android:touchscreenBlocksFocus="true"
-            tools:ignore="UnusedAttribute"/>
+        android:layout_height="match_parent"
+        android:layout_below="@+id/done_cancel_bar"
+        android:background="@drawable/crop__texture"/>
 
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/done_cancel_bar"
+        style="?attr/actionBarStyle"
+        android:layout_width="match_parent"
+        android:layout_height="?actionBarSize"
+        android:layout_alignParentTop="true"
+        android:touchscreenBlocksFocus="true"
+        app:contentInsetEnd="0dp"
+        app:contentInsetStart="0dp"
+        tools:ignore="UnusedAttribute">
 
-        <View
-            android:id="@+id/window_overlay"
-            android:layout_width="match_parent"
-            android:layout_height="wrap_content"
-            android:layout_below="@+id/done_cancel_bar"
-            android:background="?android:windowContentOverlay"/>
-    </RelativeLayout>
+        <include layout="@layout/layout_image_cropper_done_cancel"/>
+    </android.support.v7.widget.Toolbar>
 
-</org.mariotaku.twidere.view.TintedStatusFrameLayout>
\ No newline at end of file
+    <View
+        android:id="@+id/window_overlay"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:layout_below="@+id/done_cancel_bar"
+        android:background="?android:windowContentOverlay"/>
+</RelativeLayout>
diff --git a/twidere/src/main/res/layout/activity_settings.xml b/twidere/src/main/res/layout/activity_settings.xml
index cf4d5011e7..980b870edf 100644
--- a/twidere/src/main/res/layout/activity_settings.xml
+++ b/twidere/src/main/res/layout/activity_settings.xml
@@ -17,42 +17,34 @@
   ~  along with this program.  If not, see <http://www.gnu.org/licenses/>.
   -->
 
-<org.mariotaku.twidere.view.TintedStatusNativeActionModeAwareLayout
-    android:id="@+id/main_content"
+<android.support.v4.widget.SlidingPaneLayout
+    android:id="@+id/sliding_pane"
     xmlns:android="http://schemas.android.com/apk/res/android"
-    xmlns:app="http://schemas.android.com/apk/res-auto"
     xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
-    android:layout_height="match_parent"
-    app:setPadding="true">
+    android:layout_height="match_parent">
 
-    <android.support.v4.widget.SlidingPaneLayout
-        android:id="@+id/sliding_pane"
-        android:layout_width="match_parent"
-        android:layout_height="match_parent">
-
-        <FrameLayout
-            android:layout_width="240dp"
-            android:layout_height="match_parent"
-            android:layout_gravity="start">
+    <FrameLayout
+        android:layout_width="240dp"
+        android:layout_height="match_parent"
+        android:layout_gravity="start">
 
-            <ListView
-                android:id="@+id/entries_list"
-                android:layout_width="match_parent"
-                android:layout_height="match_parent"
-                android:divider="@null"
-                android:dividerHeight="0dp"
-                tools:listitem="@layout/list_item_preference_header_item"/>
-        </FrameLayout>
-
-        <FrameLayout
-            android:id="@+id/detail_fragment_container"
+        <ListView
+            android:id="@+id/entries_list"
             android:layout_width="match_parent"
             android:layout_height="match_parent"
-            android:layout_gravity="end"
-            android:layout_marginLeft="@dimen/element_size_normal"
-            android:layout_marginStart="@dimen/element_size_normal"
-            android:clickable="true"
-            tools:background="?android:colorBackground"/>
-    </android.support.v4.widget.SlidingPaneLayout>
-</org.mariotaku.twidere.view.TintedStatusNativeActionModeAwareLayout>
+            android:divider="@null"
+            android:dividerHeight="0dp"
+            tools:listitem="@layout/list_item_preference_header_item"/>
+    </FrameLayout>
+
+    <FrameLayout
+        android:id="@+id/detail_fragment_container"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"
+        android:layout_gravity="end"
+        android:layout_marginLeft="@dimen/element_size_normal"
+        android:layout_marginStart="@dimen/element_size_normal"
+        android:clickable="true"
+        tools:background="?android:colorBackground"/>
+</android.support.v4.widget.SlidingPaneLayout>
diff --git a/twidere/src/main/res/layout/activity_sign_in.xml b/twidere/src/main/res/layout/activity_sign_in.xml
index e02bea07a7..29fae208f8 100644
--- a/twidere/src/main/res/layout/activity_sign_in.xml
+++ b/twidere/src/main/res/layout/activity_sign_in.xml
@@ -16,122 +16,91 @@
   ~  You should have received a copy of the GNU General Public License
   ~  along with this program.  If not, see <http://www.gnu.org/licenses/>.
   -->
-<org.mariotaku.twidere.view.TintedStatusNativeActionModeAwareLayout
-    android:id="@+id/main_content"
+
+<ScrollView
     xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:app="http://schemas.android.com/apk/res-auto"
-    xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
-    android:layout_height="match_parent"
-    app:setPadding="true">
+    android:layout_height="match_parent">
 
-    <RelativeLayout
-        android:layout_width="match_parent"
-        android:layout_height="match_parent">
+    <LinearLayout
+        android:layout_width="300dp"
+        android:layout_height="wrap_content"
+        android:layout_gravity="center"
+        android:clipChildren="false"
+        android:gravity="center"
+        android:orientation="vertical">
 
-        <ScrollView
+        <LinearLayout
+            android:id="@+id/username_password"
             android:layout_width="match_parent"
-            android:layout_height="match_parent"
-            android:layout_below="@+id/twidere_action_bar_container"
-            android:layout_gravity="center">
+            android:layout_height="wrap_content"
+            android:orientation="vertical"
+            android:padding="8dp">
 
-            <LinearLayout
-                android:layout_width="300dp"
+            <EditText
+                android:id="@+id/username"
+                android:layout_width="match_parent"
                 android:layout_height="wrap_content"
-                android:layout_gravity="center"
-                android:clipChildren="false"
-                android:gravity="center"
-                android:orientation="vertical">
-
-                <LinearLayout
-                    android:id="@+id/username_password"
-                    android:layout_width="match_parent"
-                    android:layout_height="wrap_content"
-                    android:orientation="vertical"
-                    android:padding="8dp">
-
-                    <EditText
-                        android:id="@+id/username"
-                        android:layout_width="match_parent"
-                        android:layout_height="wrap_content"
-                        android:ems="10"
-                        android:hint="@string/username"
-                        android:inputType="textEmailAddress"
-                        android:singleLine="true"
-                        android:typeface="normal"/>
+                android:ems="10"
+                android:hint="@string/username"
+                android:inputType="textEmailAddress"
+                android:singleLine="true"
+                android:typeface="normal"/>
 
-                    <EditText
-                        android:id="@+id/password"
-                        android:layout_width="match_parent"
-                        android:layout_height="wrap_content"
-                        android:layout_marginTop="8dp"
-                        android:ems="10"
-                        android:hint="@string/password"
-                        android:inputType="textPassword"
-                        android:singleLine="true"
-                        android:typeface="normal"/>
-                </LinearLayout>
-
-                <LinearLayout
-                    android:id="@+id/sign_in_sign_up"
-                    android:layout_width="match_parent"
-                    android:layout_height="wrap_content"
-                    android:clipChildren="false"
-                    android:orientation="horizontal"
-                    android:padding="8dp">
-
-                    <android.support.v7.widget.AppCompatButton
-                        android:id="@+id/sign_up"
-                        style="?android:buttonStyleSmall"
-                        android:layout_width="match_parent"
-                        android:layout_height="wrap_content"
-                        android:layout_weight="1"
-                        android:minHeight="@dimen/element_size_normal"
-                        android:text="@string/register"/>
+            <EditText
+                android:id="@+id/password"
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:layout_marginTop="8dp"
+                android:ems="10"
+                android:hint="@string/password"
+                android:inputType="textPassword"
+                android:singleLine="true"
+                android:typeface="normal"/>
+        </LinearLayout>
 
-                    <android.support.v7.widget.AppCompatButton
-                        android:id="@+id/sign_in"
-                        style="?android:buttonStyleSmall"
-                        android:layout_width="match_parent"
-                        android:layout_height="wrap_content"
-                        android:layout_weight="1"
-                        android:minHeight="@dimen/element_size_normal"
-                        android:onClick="onClick"
-                        android:text="@string/sign_in"
-                        app:backgroundTint="@color/material_light_green"/>
+        <LinearLayout
+            android:id="@+id/sign_in_sign_up"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:clipChildren="false"
+            android:orientation="horizontal"
+            android:padding="8dp">
 
-                </LinearLayout>
+            <android.support.v7.widget.AppCompatButton
+                android:id="@+id/sign_up"
+                style="?android:buttonStyleSmall"
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:layout_weight="1"
+                android:minHeight="@dimen/element_size_normal"
+                android:text="@string/register"/>
 
-                <Button
-                    android:id="@+id/sign_in_method_introduction"
-                    style="?android:borderlessButtonStyle"
-                    android:layout_width="match_parent"
-                    android:layout_height="wrap_content"
-                    android:layout_margin="8dp"
-                    android:clickable="true"
-                    android:gravity="center_vertical"
-                    android:minHeight="36dp"
-                    android:onClick="onClick"
-                    android:text="@string/sign_in_method_introduction_title"
-                    android:textAppearance="?android:textAppearanceSmall"/>
-            </LinearLayout>
-        </ScrollView>
+            <android.support.v7.widget.AppCompatButton
+                android:id="@+id/sign_in"
+                style="?android:buttonStyleSmall"
+                android:layout_width="match_parent"
+                android:layout_height="wrap_content"
+                android:layout_weight="1"
+                android:minHeight="@dimen/element_size_normal"
+                android:onClick="onClick"
+                android:text="@string/sign_in"
+                app:backgroundTint="@color/material_light_green"/>
 
-        <org.mariotaku.twidere.view.TwidereActionBarContainer
-            android:id="@+id/twidere_action_bar_container"
-            style="?attr/actionBarStyle"
-            android:layout_width="match_parent"
-            android:layout_height="?actionBarSize"
-            android:layout_alignParentTop="true"
-            android:touchscreenBlocksFocus="true"
-            tools:ignore="UnusedAttribute"/>
+        </LinearLayout>
 
-        <View
-            android:id="@+id/window_overlay"
+        <Button
+            android:id="@+id/sign_in_method_introduction"
+            style="?android:borderlessButtonStyle"
             android:layout_width="match_parent"
             android:layout_height="wrap_content"
-            android:layout_below="@+id/twidere_action_bar_container"
-            android:background="?android:windowContentOverlay"/>
-    </RelativeLayout>
-
-</org.mariotaku.twidere.view.TintedStatusNativeActionModeAwareLayout>
\ No newline at end of file
+            android:layout_margin="8dp"
+            android:clickable="true"
+            android:gravity="center_vertical"
+            android:minHeight="36dp"
+            android:onClick="onClick"
+            android:text="@string/sign_in_method_introduction_title"
+            android:textAppearance="?android:textAppearanceSmall"/>
+    </LinearLayout>
+</ScrollView>
diff --git a/twidere/src/main/res/layout/activity_content_fragment_action_bar.xml b/twidere/src/main/res/layout/fragment_toolbar_tab_pages.xml
similarity index 54%
rename from twidere/src/main/res/layout/activity_content_fragment_action_bar.xml
rename to twidere/src/main/res/layout/fragment_toolbar_tab_pages.xml
index eee80578b9..287ef9b646 100644
--- a/twidere/src/main/res/layout/activity_content_fragment_action_bar.xml
+++ b/twidere/src/main/res/layout/fragment_toolbar_tab_pages.xml
@@ -1,4 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?><!--
+<?xml version="1.0" encoding="utf-8"?>
+<!--
   ~ Twidere - Twitter client for Android
   ~
   ~  Copyright (C) 2012-2014 Mariotaku Lee <mariotaku.lee@gmail.com>
@@ -16,39 +17,42 @@
   ~  You should have received a copy of the GNU General Public License
   ~  along with this program.  If not, see <http://www.gnu.org/licenses/>.
   -->
-
-<org.mariotaku.twidere.view.TintedStatusNativeActionModeAwareLayout
-    android:id="@+id/main_content"
+<FrameLayout
     xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
     xmlns:tools="http://schemas.android.com/tools"
     android:layout_width="match_parent"
     android:layout_height="match_parent">
 
-    <FrameLayout
-        android:id="@+id/content_fragment"
+    <org.mariotaku.twidere.view.ExtendedViewPager
+        android:id="@+id/view_pager"
         android:layout_width="match_parent"
         android:layout_height="match_parent"/>
 
-    <RelativeLayout
-        android:id="@+id/twidere_action_bar_with_overlay"
+    <org.mariotaku.twidere.view.ExtendedLinearLayout
+        android:id="@+id/toolbar_container"
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
-        android:orientation="vertical">
+        android:elevation="@dimen/toolbar_elevation"
+        android:orientation="vertical"
+        android:tag="background|primary_color">
 
-        <org.mariotaku.twidere.view.TwidereActionBarContainer
-            android:id="@+id/twidere_action_bar_container"
-            style="?attr/actionBarStyle"
+        <android.support.v7.widget.Toolbar
+            android:id="@+id/toolbar"
             android:layout_width="match_parent"
             android:layout_height="?actionBarSize"
-            android:layout_alignParentTop="true"
-            android:touchscreenBlocksFocus="true"
-            tools:ignore="UnusedAttribute"/>
+            app:popupTheme="?actionBarPopupTheme"/>
 
-        <View
-            android:id="@+id/window_overlay"
+        <org.mariotaku.twidere.view.TabPagerIndicator
+            android:id="@+id/toolbar_tabs"
             android:layout_width="match_parent"
-            android:layout_height="wrap_content"
-            android:layout_below="@+id/twidere_action_bar_container"
-            android:background="?android:windowContentOverlay"/>
-    </RelativeLayout>
-</org.mariotaku.twidere.view.TintedStatusNativeActionModeAwareLayout>
+            android:layout_height="@dimen/element_size_normal"
+            app:tabDividerVerticalPadding="@dimen/element_spacing_mlarge"
+            app:tabExpandEnabled="true"
+            app:tabHorizontalPadding="@dimen/element_spacing_large"
+            app:tabShowDivider="true"
+            tools:ignore="UnusedAttribute"
+            tools:listitem="@layout/layout_tab_item"/>
+    </org.mariotaku.twidere.view.ExtendedLinearLayout>
+
+</FrameLayout>
\ No newline at end of file
diff --git a/twidere/src/main/res/layout/fragment_user.xml b/twidere/src/main/res/layout/fragment_user.xml
index 907cce8be7..9590fd2164 100644
--- a/twidere/src/main/res/layout/fragment_user.xml
+++ b/twidere/src/main/res/layout/fragment_user.xml
@@ -17,50 +17,65 @@
   ~  along with this program.  If not, see <http://www.gnu.org/licenses/>.
   -->
 
-<FrameLayout
+<org.mariotaku.twidere.view.ExtendedFrameLayout
     xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:app="http://schemas.android.com/apk/res-auto"
     android:layout_width="match_parent"
     android:layout_height="match_parent"
-    android:fitsSystemWindows="true">
+    android:fitsSystemWindows="false">
 
-    <org.mariotaku.twidere.view.ExtendedFrameLayout
-        android:id="@+id/details_container"
+    <RelativeLayout
+        android:id="@+id/profile_banner_container"
         android:layout_width="match_parent"
-        android:layout_height="match_parent">
+        android:layout_height="wrap_content"
+        android:layout_gravity="top">
 
-        <RelativeLayout
-            android:id="@+id/profile_banner_container"
+        <org.mariotaku.twidere.view.ProfileBannerImageView
+            android:id="@+id/profile_banner"
             android:layout_width="match_parent"
             android:layout_height="wrap_content"
-            android:layout_gravity="top">
+            android:scaleType="centerCrop"/>
 
-            <org.mariotaku.twidere.view.ProfileBannerImageView
-                android:id="@+id/profile_banner"
-                android:layout_width="match_parent"
-                android:layout_height="wrap_content"
-                android:scaleType="centerCrop"/>
+        <FrameLayout
+            android:id="@+id/profile_birthday_banner"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_alignBottom="@+id/profile_banner"
+            android:layout_alignTop="@+id/profile_banner"
+            android:visibility="gone">
 
-            <FrameLayout
-                android:id="@+id/profile_birthday_banner"
+            <org.mariotaku.twidere.view.BirthdayView
                 android:layout_width="match_parent"
-                android:layout_height="wrap_content"
-                android:layout_alignBottom="@+id/profile_banner"
-                android:layout_alignTop="@+id/profile_banner"
-                android:visibility="gone">
+                android:layout_height="match_parent"/>
+        </FrameLayout>
+    </RelativeLayout>
+
+    <RelativeLayout
+        android:id="@+id/profile_content_container"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent">
 
-                <org.mariotaku.twidere.view.BirthdayView
-                    android:layout_width="match_parent"
-                    android:layout_height="match_parent"/>
-            </FrameLayout>
-        </RelativeLayout>
+        <org.mariotaku.twidere.view.ExtendedFrameLayout
+            android:id="@+id/details_container"
+            android:layout_width="match_parent"
+            android:layout_height="match_parent">
+
+            <org.mariotaku.twidere.view.HeaderDrawerLayout
+                android:id="@+id/user_profile_drawer"
+                android:layout_width="match_parent"
+                android:layout_height="match_parent"
+                app:hdl_contentLayout="@layout/fragment_content_pages"
+                app:hdl_headerLayout="@layout/header_user"/>
+        </org.mariotaku.twidere.view.ExtendedFrameLayout>
 
-        <org.mariotaku.twidere.view.HeaderDrawerLayout
-            android:id="@+id/user_profile_drawer"
+        <android.support.v7.widget.Toolbar
+            android:id="@+id/toolbar"
             android:layout_width="match_parent"
-            android:layout_height="match_parent"
-            app:hdl_contentLayout="@layout/fragment_content_pages"
-            app:hdl_headerLayout="@layout/header_user"/>
-    </org.mariotaku.twidere.view.ExtendedFrameLayout>
+            android:layout_height="?actionBarSize"
+            android:layout_alignParentTop="true"
+            android:elevation="@dimen/toolbar_elevation"
+            android:tag="ate_ignore"
+            app:popupTheme="?actionBarPopupTheme"/>
+    </RelativeLayout>
 
-</FrameLayout>
\ No newline at end of file
+</org.mariotaku.twidere.view.ExtendedFrameLayout>
\ No newline at end of file
diff --git a/twidere/src/main/res/layout/header_drawer_account_selector.xml b/twidere/src/main/res/layout/header_drawer_account_selector.xml
index 5a1f3ccfc4..4da6aa8604 100644
--- a/twidere/src/main/res/layout/header_drawer_account_selector.xml
+++ b/twidere/src/main/res/layout/header_drawer_account_selector.xml
@@ -134,7 +134,6 @@
                         android:focusable="true"/>
                 </FrameLayout>
 
-
             </LinearLayout>
         </RelativeLayout>
 
diff --git a/twidere/src/main/res/layout/layout_content_pages_common.xml b/twidere/src/main/res/layout/layout_content_pages_common.xml
index 0467f5dcab..9fa49aa666 100644
--- a/twidere/src/main/res/layout/layout_content_pages_common.xml
+++ b/twidere/src/main/res/layout/layout_content_pages_common.xml
@@ -34,10 +34,10 @@
             android:id="@+id/view_pager"
             android:layout_width="match_parent"
             android:layout_height="match_parent"
-            android:layout_below="@+id/view_pager_tabs"/>
+            android:layout_below="@+id/toolbar_tabs"/>
 
         <org.mariotaku.twidere.view.TabPagerIndicator
-            android:id="@+id/view_pager_tabs"
+            android:id="@+id/toolbar_tabs"
             android:layout_width="match_parent"
             android:layout_height="@dimen/element_size_normal"
             android:outlineProvider="background"
@@ -47,7 +47,8 @@
             app:tabHorizontalPadding="@dimen/element_spacing_large"
             app:tabIconColor="?android:colorForeground"
             app:tabShowDivider="true"
-            tools:ignore="UnusedAttribute"/>
+            tools:ignore="UnusedAttribute"
+            tools:listitem="@layout/layout_tab_item"/>
 
         <View
             android:id="@+id/pager_window_overlay"
diff --git a/twidere/src/main/res/values-notnight/themes.xml b/twidere/src/main/res/values-notnight/themes.xml
index 96d0ef4fbb..5b3748fbee 100644
--- a/twidere/src/main/res/values-notnight/themes.xml
+++ b/twidere/src/main/res/values-notnight/themes.xml
@@ -1,32 +1,7 @@
 <?xml version="1.0" encoding="utf-8"?>
 <resources>
-    <style name="Theme.Twidere" parent="Theme.AppCompat.Light">
 
-        <!-- Widget styles -->
-        <item name="android:listSeparatorTextViewStyle">@style/Widget.Light.TextView.ListSeparator
-        </item>
-        <item name="actionModeBackground">?colorPrimary</item>
-        <item name="actionBarPopupTheme">@style/ThemeOverlay.AppCompat</item>
-
-        <!-- Card UI styles -->
-        <item name="cardActionButtonStyle">@style/Widget.Light.CardActionButton</item>
-        <item name="profileImageStyle">@style/Widget.Light.ProfileImage</item>
-        <item name="profileImageStyleLarge">@style/Widget.Light.ProfileImage.Large</item>
-        <item name="cardItemBackgroundColor">#f8f8f8</item>
-
-        <!-- Twidere specific styles -->
-        <item name="menuIconColor">@color/action_icon_dark</item>
-        <item name="messageBubbleColor">@color/message_bubble_color_light</item>
-        <item name="quoteIndicatorBackgroundColor">@color/quote_indicator_background_light</item>
-        <item name="coloredActionBar">true</item>
-
-        <!-- ATE attributes -->
-        <item name="ateThemeKey">light</item>
-
-        <item name="preferenceTheme">@style/PreferenceThemeOverlay.v14.Material</item>
-    </style>
-
-    <style name="Theme.Twidere.NoActionBar" parent="Theme.AppCompat.Light.NoActionBar">
+    <style name="Theme.Twidere" parent="Theme.AppCompat.Light">
 
         <!-- Widget styles -->
         <item name="android:listSeparatorTextViewStyle">@style/Widget.Light.TextView.ListSeparator
@@ -50,7 +25,6 @@
         <item name="preferenceTheme">@style/PreferenceThemeOverlay.v14.Material</item>
     </style>
 
-
     <style name="Theme.Twidere.DialogWhenLarge.NoActionBar" parent="Theme.AppCompat.Light.DialogWhenLarge">
 
         <item name="windowNoTitle">true</item>
diff --git a/twidere/src/main/res/values/themes.xml b/twidere/src/main/res/values/themes.xml
index fd7ead01f7..2d16d22977 100644
--- a/twidere/src/main/res/values/themes.xml
+++ b/twidere/src/main/res/values/themes.xml
@@ -7,8 +7,6 @@
         <!-- Widget styles -->
         <item name="android:listSeparatorTextViewStyle">@style/Widget.Dark.TextView.ListSeparator
         </item>
-        <item name="actionModeStyle">@style/Widget.AppCompat.ActionBar</item>
-        <item name="actionModeBackground">?colorPrimary</item>
 
         <!-- Card UI styles -->
         <item name="cardActionButtonStyle">@style/Widget.CardActionButton</item>
@@ -28,31 +26,11 @@
         <item name="preferenceTheme">@style/PreferenceThemeOverlay.v14.Material</item>
     </style>
 
-    <style name="Theme.Twidere.NoActionBar" parent="Theme.AppCompat.NoActionBar">
+    <style name="Theme.Twidere.NoActionBar" parent="Theme.Twidere">
 
-        <!-- Window attributes -->
-        <item name="android:windowBackground">@color/background_color_window_dark</item>
-
-        <!-- Widget styles -->
-        <item name="android:listSeparatorTextViewStyle">@style/Widget.Dark.TextView.ListSeparator
-        </item>
-
-        <!-- Card UI styles -->
-        <item name="cardActionButtonStyle">@style/Widget.CardActionButton</item>
-        <item name="profileImageStyle">@style/Widget.ProfileImage</item>
-        <item name="profileImageStyleLarge">@style/Widget.ProfileImage.Large</item>
-        <item name="cardItemBackgroundColor">@color/background_color_card_item_dark</item>
-
-        <!-- Twidere specific styles -->
-        <item name="menuIconColor">@color/action_icon_light</item>
-        <item name="messageBubbleColor">@color/message_bubble_color_dark</item>
-        <item name="quoteIndicatorBackgroundColor">@color/quote_indicator_background_dark</item>
-        <item name="darkTheme">true</item>
-
-        <!-- ATE attributes -->
-        <item name="ateThemeKey">dark</item>
+        <item name="windowActionBar">false</item>
+        <item name="windowNoTitle">true</item>
 
-        <item name="preferenceTheme">@style/PreferenceThemeOverlay.v14.Material</item>
     </style>
 
     <style name="Theme.Twidere.DialogWhenLarge.NoActionBar" parent="Theme.AppCompat.DialogWhenLarge">
