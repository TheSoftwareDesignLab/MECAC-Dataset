diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index f46d6c7c1aec..5bc7399c426b 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -101,7 +101,7 @@
             android:label="@string/create_a_link"
             android:theme="@style/WordPress.Dialog" />
         <activity
-            android:name=".ui.posts.EditPostActivity"
+            android:name=".ui.posts.NewEditPostActivity"
             android:configChanges="orientation|keyboardHidden|screenSize"
             android:windowSoftInputMode="stateHidden|adjustResize" >
         </activity>
diff --git a/res/drawable-hdpi/ab_icon_accept.png b/res/drawable-hdpi/ab_icon_accept.png
new file mode 100644
index 000000000000..0332a2f2deec
Binary files /dev/null and b/res/drawable-hdpi/ab_icon_accept.png differ
diff --git a/res/drawable-hdpi/tab_icon_preview.png b/res/drawable-hdpi/tab_icon_preview.png
new file mode 100644
index 000000000000..af0c31de8ac3
Binary files /dev/null and b/res/drawable-hdpi/tab_icon_preview.png differ
diff --git a/res/drawable-hdpi/tab_icon_settings.png b/res/drawable-hdpi/tab_icon_settings.png
new file mode 100644
index 000000000000..c87ae4391177
Binary files /dev/null and b/res/drawable-hdpi/tab_icon_settings.png differ
diff --git a/res/drawable-hdpi/tab_icon_write.png b/res/drawable-hdpi/tab_icon_write.png
new file mode 100644
index 000000000000..e48b544ba0f2
Binary files /dev/null and b/res/drawable-hdpi/tab_icon_write.png differ
diff --git a/res/drawable-hdpi/write.png b/res/drawable-hdpi/write.png
new file mode 100644
index 000000000000..3693d1409d84
Binary files /dev/null and b/res/drawable-hdpi/write.png differ
diff --git a/res/drawable-mdpi/ab_icon_accept.png b/res/drawable-mdpi/ab_icon_accept.png
new file mode 100644
index 000000000000..d1a9832153b2
Binary files /dev/null and b/res/drawable-mdpi/ab_icon_accept.png differ
diff --git a/res/drawable-mdpi/tab_icon_preview.png b/res/drawable-mdpi/tab_icon_preview.png
new file mode 100644
index 000000000000..46ee83473144
Binary files /dev/null and b/res/drawable-mdpi/tab_icon_preview.png differ
diff --git a/res/drawable-mdpi/tab_icon_settings.png b/res/drawable-mdpi/tab_icon_settings.png
new file mode 100644
index 000000000000..1c0ea22aa4bb
Binary files /dev/null and b/res/drawable-mdpi/tab_icon_settings.png differ
diff --git a/res/drawable-mdpi/tab_icon_write.png b/res/drawable-mdpi/tab_icon_write.png
new file mode 100644
index 000000000000..a5f72bb4954f
Binary files /dev/null and b/res/drawable-mdpi/tab_icon_write.png differ
diff --git a/res/drawable-xhdpi/ab_icon_accept.png b/res/drawable-xhdpi/ab_icon_accept.png
new file mode 100644
index 000000000000..f903567b506f
Binary files /dev/null and b/res/drawable-xhdpi/ab_icon_accept.png differ
diff --git a/res/drawable-xhdpi/tab_icon_preview.png b/res/drawable-xhdpi/tab_icon_preview.png
new file mode 100644
index 000000000000..c3dea3d6916e
Binary files /dev/null and b/res/drawable-xhdpi/tab_icon_preview.png differ
diff --git a/res/drawable-xhdpi/tab_icon_settings.png b/res/drawable-xhdpi/tab_icon_settings.png
new file mode 100644
index 000000000000..614bf19a5aae
Binary files /dev/null and b/res/drawable-xhdpi/tab_icon_settings.png differ
diff --git a/res/drawable-xhdpi/tab_icon_write.png b/res/drawable-xhdpi/tab_icon_write.png
new file mode 100644
index 000000000000..e1f2b9958bc8
Binary files /dev/null and b/res/drawable-xhdpi/tab_icon_write.png differ
diff --git a/res/drawable-xxhdpi/ab_icon_accept.png b/res/drawable-xxhdpi/ab_icon_accept.png
new file mode 100644
index 000000000000..dbf82aa8abdc
Binary files /dev/null and b/res/drawable-xxhdpi/ab_icon_accept.png differ
diff --git a/res/drawable-xxhdpi/tab_icon_preview.png b/res/drawable-xxhdpi/tab_icon_preview.png
new file mode 100644
index 000000000000..a737e1e9eb95
Binary files /dev/null and b/res/drawable-xxhdpi/tab_icon_preview.png differ
diff --git a/res/drawable-xxhdpi/tab_icon_settings.png b/res/drawable-xxhdpi/tab_icon_settings.png
new file mode 100644
index 000000000000..f567be265cee
Binary files /dev/null and b/res/drawable-xxhdpi/tab_icon_settings.png differ
diff --git a/res/drawable-xxhdpi/tab_icon_write.png b/res/drawable-xxhdpi/tab_icon_write.png
new file mode 100644
index 000000000000..898a434c65bd
Binary files /dev/null and b/res/drawable-xxhdpi/tab_icon_write.png differ
diff --git a/res/layout/activity_new_edit_post.xml b/res/layout/activity_new_edit_post.xml
new file mode 100644
index 000000000000..bc9db83670b5
--- /dev/null
+++ b/res/layout/activity_new_edit_post.xml
@@ -0,0 +1,6 @@
+<android.support.v4.view.ViewPager xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:id="@+id/pager"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    tools:context=".NewEditPostActivity" />
diff --git a/res/layout/edit_post_content_action_bar.xml b/res/layout/edit_post_content_action_bar.xml
new file mode 100644
index 000000000000..51576cc96159
--- /dev/null
+++ b/res/layout/edit_post_content_action_bar.xml
@@ -0,0 +1,20 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="wrap_content"
+    android:layout_height="wrap_content"
+    android:orientation="horizontal"
+    android:background="@drawable/ab_solid_wordpress">
+
+    <Button
+        android:id="@+id/action_bar_done"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:textColor="@color/white"
+        android:textSize="14sp"
+        android:padding="8dp"
+        android:background="@drawable/selectable_background_wordpress"
+        android:drawableLeft="@drawable/ab_icon_accept"
+        android:text="@string/done" />
+
+</LinearLayout>
\ No newline at end of file
diff --git a/res/layout/fragment_edit_post_content.xml b/res/layout/fragment_edit_post_content.xml
new file mode 100644
index 000000000000..321cdb10e8b1
--- /dev/null
+++ b/res/layout/fragment_edit_post_content.xml
@@ -0,0 +1,143 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="fill_parent"
+    android:layout_height="wrap_content"
+    android:orientation="vertical">
+
+    <EditText
+        android:id="@+id/post_title"
+        android:layout_width="fill_parent"
+        android:layout_height="wrap_content"
+        android:layout_marginLeft="8dp"
+        android:layout_marginRight="8dp"
+        android:layout_marginTop="8dp"
+        android:textSize="22sp"
+        android:hint="@string/title"
+        android:inputType="textCapSentences|textAutoCorrect" />
+
+    <org.wordpress.android.util.WPEditText
+        android:id="@+id/post_content"
+        android:layout_width="fill_parent"
+        android:layout_height="fill_parent"
+        android:layout_marginLeft="8dp"
+        android:layout_marginRight="8dp"
+        android:layout_marginTop="8dp"
+        android:gravity="top"
+        android:hint="@string/post_content"
+        android:lineSpacingExtra="4dp"
+        android:textSize="18sp"
+        android:inputType="textMultiLine|textCapSentences|textAutoCorrect"
+        android:textColorLink="#21759b"
+        android:layout_weight="1"/>
+
+    <RelativeLayout
+        android:id="@+id/format_bar"
+        android:layout_width="fill_parent"
+        android:layout_height="@dimen/format_bar_height"
+        android:layout_gravity="bottom"
+        android:background="@drawable/format_bar_bg"
+        android:orientation="horizontal"
+        android:padding="4dp"
+        android:visibility="gone">
+
+        <HorizontalScrollView
+            android:layout_width="fill_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginRight="34dp">
+
+            <RelativeLayout
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content">
+
+                <ToggleButton
+                    android:id="@+id/bold"
+                    style="@style/WordPress.ToggleButton"
+                    android:layout_width="wrap_content"
+                    android:layout_height="fill_parent"
+                    android:textOff="B"
+                    android:textOn="B"
+                    android:textStyle="bold" />
+
+                <ToggleButton
+                    android:id="@+id/em"
+                    style="@style/WordPress.ToggleButton"
+                    android:layout_width="wrap_content"
+                    android:layout_height="fill_parent"
+                    android:layout_marginLeft="6dp"
+                    android:layout_toRightOf="@id/bold"
+                    android:textOff="I "
+                    android:textOn="I "
+                    android:textStyle="italic" />
+
+                <ToggleButton
+                    android:id="@+id/underline"
+                    style="@style/WordPress.ToggleButton"
+                    android:layout_width="wrap_content"
+                    android:layout_height="fill_parent"
+                    android:layout_marginLeft="6dp"
+                    android:layout_toRightOf="@id/em"
+                    android:textOff="@string/underline"
+                    android:textOn="@string/underline" />
+
+                <ToggleButton
+                    android:id="@+id/strike"
+                    style="@style/WordPress.ToggleButton"
+                    android:layout_width="wrap_content"
+                    android:layout_height="fill_parent"
+                    android:layout_marginLeft="6dp"
+                    android:layout_toRightOf="@id/underline"
+                    android:textOff="@string/strike"
+                    android:textOn="@string/strike" />
+
+                <Button
+                    android:id="@+id/link"
+                    android:layout_width="wrap_content"
+                    android:layout_height="fill_parent"
+                    android:layout_marginLeft="6dp"
+                    android:layout_toRightOf="@id/strike"
+                    android:background="@drawable/wp_button_toggle"
+                    android:paddingLeft="@dimen/format_bar_button_padding"
+                    android:paddingRight="@dimen/format_bar_button_padding"
+                    android:text="@string/link"
+                    android:textColor="#21759b"
+                    android:textSize="@dimen/format_bar_font_size" />
+
+                <ToggleButton
+                    android:id="@+id/bquote"
+                    style="@style/WordPress.ToggleButton"
+                    android:layout_width="wrap_content"
+                    android:layout_height="fill_parent"
+                    android:layout_marginLeft="6dp"
+                    android:layout_toRightOf="@id/link"
+                    android:textOff="&quot;"
+                    android:textOn="&quot;"
+                    android:textStyle="bold"
+                    android:typeface="serif" />
+
+                <Button
+                    android:id="@+id/more"
+                    android:layout_width="wrap_content"
+                    android:layout_height="fill_parent"
+                    android:layout_marginLeft="6dp"
+                    android:layout_toRightOf="@id/bquote"
+                    android:background="@drawable/wp_button_toggle"
+                    android:paddingLeft="@dimen/format_bar_button_padding"
+                    android:paddingRight="@dimen/format_bar_button_padding"
+                    android:text="@string/more_tag"
+                    android:textColor="#464646"
+                    android:textSize="@dimen/format_bar_font_size" />
+            </RelativeLayout>
+        </HorizontalScrollView>
+
+        <ImageButton
+            android:id="@+id/addPictureButton"
+            android:layout_width="30dp"
+            android:layout_height="fill_parent"
+            android:layout_alignParentRight="true"
+            android:background="@drawable/wp_button_toggle"
+            android:contentDescription="@string/content_description_add_media"
+            android:scaleType="centerInside"
+            android:src="@drawable/camera" />
+    </RelativeLayout>
+
+</LinearLayout>
\ No newline at end of file
diff --git a/res/layout/fragment_edit_post_settings.xml b/res/layout/fragment_edit_post_settings.xml
new file mode 100644
index 000000000000..708a0c10faa2
--- /dev/null
+++ b/res/layout/fragment_edit_post_settings.xml
@@ -0,0 +1,183 @@
+<?xml version="1.0" encoding="utf-8"?>
+<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+<LinearLayout
+    android:layout_width="fill_parent"
+    android:layout_height="wrap_content"
+    android:orientation="vertical"
+    android:padding="8dp">
+
+    <LinearLayout
+        android:id="@+id/sectionTags"
+        android:layout_width="fill_parent"
+        android:layout_height="wrap_content"
+        android:orientation="vertical">
+
+        <EditText
+            android:id="@+id/tags"
+            android:layout_width="fill_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="4dp"
+            android:hint="@string/tags_separate_with_commas"
+            android:inputType="textAutoCorrect" />
+
+        <TextView
+            android:id="@+id/categoryLabel"
+            style="@style/WordPressSubHeader"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:text="@string/categories"
+            android:layout_marginBottom="8dp"/>
+    </LinearLayout>
+
+    <org.wordpress.android.util.FlowLayout
+        android:id="@+id/sectionCategories"
+        android:layout_width="fill_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp" />
+
+    <TextView
+        android:id="@+id/postFormatLabel"
+        style="@style/WordPressSubHeader"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:text="@string/post_format" />
+
+    <Spinner
+        android:id="@+id/postFormat"
+        android:layout_width="fill_parent"
+        android:layout_height="wrap_content"
+        android:prompt="@string/post_format" />
+
+    <EditText
+        android:id="@+id/postExcerpt"
+        android:layout_width="fill_parent"
+        android:layout_height="wrap_content"
+        android:gravity="top"
+        android:hint="@string/post_excerpt"
+        android:inputType="textMultiLine|textCapSentences|textAutoCorrect"
+        android:minLines="1" />
+
+    <RelativeLayout
+        android:id="@+id/sectionLocation"
+        android:layout_width="fill_parent"
+        android:layout_height="fill_parent"
+        android:layout_marginTop="2dp"
+        android:layout_marginBottom="10dp"
+        android:layout_marginLeft="8dp"
+        android:orientation="vertical"
+        android:visibility="gone">
+
+        <TextView
+            android:drawableLeft="@drawable/ic_action_location_searching"
+            android:gravity="center_vertical"
+            android:id="@+id/locationText"
+            android:layout_width="fill_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginLeft="4dp"
+            android:layout_marginBottom="4dp"
+            android:layout_marginRight="4dp"
+            android:layout_marginTop="4dp"
+            android:text="@string/loading" />
+
+        <LinearLayout
+            android:id="@+id/sectionLocationButtons"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_below="@+id/locationText"
+            android:orientation="horizontal">
+
+            <Button
+                android:id="@+id/viewMap"
+                android:layout_width="0dp"
+                android:layout_height="wrap_content"
+                android:layout_weight="1"
+                android:ellipsize="end"
+                android:lines="1"
+                android:text="@string/view_map" />
+
+            <Button
+                android:id="@+id/updateLocation"
+                android:layout_width="0dp"
+                android:layout_height="wrap_content"
+                android:layout_weight="1"
+                android:ellipsize="end"
+                android:lines="1"
+                android:text="@string/update_location" />
+
+            <Button
+                android:id="@+id/removeLocation"
+                android:layout_width="0dp"
+                android:layout_height="wrap_content"
+                android:layout_weight="1"
+                android:ellipsize="end"
+                android:lines="1"
+                android:text="@string/remove_location" />
+        </LinearLayout>
+
+    </RelativeLayout>
+
+    <LinearLayout
+        android:id="@+id/sectionSettings"
+        android:layout_width="fill_parent"
+        android:layout_height="wrap_content"
+        android:orientation="vertical"
+        android:layout_marginTop="16dp">
+
+        <TextView
+            android:id="@+id/statusLabel"
+            style="@style/WordPressSubHeader"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:text="@string/status" />
+
+        <Spinner
+            android:id="@+id/status"
+            android:layout_width="fill_parent"
+            android:layout_height="wrap_content" />
+
+        <RelativeLayout
+            android:layout_width="fill_parent"
+            android:layout_height="wrap_content">
+
+            <TextView
+                android:id="@+id/pubDateLabel"
+                style="@style/WordPressSubHeader"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:text="@string/publish_date" />
+
+            <Button
+                android:id="@+id/pubDateButton"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:layout_alignParentRight="true"
+                android:layout_below="@id/pubDateLabel"
+                android:paddingLeft="20dp"
+                android:paddingRight="20dp"
+                android:text="@string/edit" />
+
+            <TextView
+                android:id="@+id/pubDate"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:layout_alignParentLeft="true"
+                android:layout_below="@id/pubDateLabel"
+                android:layout_margin="4dp"
+                android:layout_toLeftOf="@id/pubDateButton"
+                android:paddingLeft="8dp"
+                android:paddingTop="8dp"
+                android:text="@string/immediately" />
+        </RelativeLayout>
+
+        <EditText
+            android:id="@+id/post_password"
+            android:layout_width="fill_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginBottom="@dimen/format_bar_height"
+            android:hint="@string/post_password"
+            android:inputType="textPassword" />
+    </LinearLayout>
+</LinearLayout>
+</ScrollView>
\ No newline at end of file
diff --git a/res/layout/fragment_new_edit_post.xml b/res/layout/fragment_new_edit_post.xml
new file mode 100644
index 000000000000..5c57063346d5
--- /dev/null
+++ b/res/layout/fragment_new_edit_post.xml
@@ -0,0 +1,16 @@
+<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    android:paddingLeft="@dimen/reader_margin_large"
+    android:paddingRight="@dimen/reader_margin_large"
+    android:paddingTop="@dimen/reader_margin_large"
+    android:paddingBottom="@dimen/reader_margin_large"
+    tools:context=".NewEditPostActivity$PlaceholderFragment">
+
+    <TextView
+        android:id="@+id/section_label"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content" />
+
+</RelativeLayout>
diff --git a/res/layout/row_post_page.xml b/res/layout/row_post_page.xml
index ccc883a123ac..cd16a0536bba 100644
--- a/res/layout/row_post_page.xml
+++ b/res/layout/row_post_page.xml
@@ -34,7 +34,6 @@
             android:layout_height="wrap_content"
             android:textColor="#777777"
             android:textSize="12sp"
-            android:text="@string/publish"
             android:gravity="right" />
     </LinearLayout>
 
diff --git a/res/menu/edit.xml b/res/menu/edit_post.xml
similarity index 100%
rename from res/menu/edit.xml
rename to res/menu/edit_post.xml
diff --git a/res/menu/new_edit_post.xml b/res/menu/new_edit_post.xml
new file mode 100644
index 000000000000..8f777657b055
--- /dev/null
+++ b/res/menu/new_edit_post.xml
@@ -0,0 +1,9 @@
+<menu xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:tools="http://schemas.android.com/tools"
+    tools:context=".NewEditPostActivity" >
+    
+    <item android:id="@+id/action_settings"
+        android:title="@string/settings"
+        android:orderInCategory="100"
+        android:showAsAction="never" />
+</menu>
diff --git a/res/values/strings.xml b/res/values/strings.xml
index 843352b8237d..e9a9041a6f14 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -55,7 +55,7 @@
     <string name="save">Save</string>
     <string name="add">Add</string>
     <string name="selected_categories">Selected categories:</string>
-    <string name="publish">Publish? </string>
+    <string name="publish">Publish</string>
     <string name="add_account">Add Blog</string>
     <string name="notification_sound">Play notification sound</string>
     <string name="notification_vibrate">Vibrate</string>
@@ -809,6 +809,8 @@
     <string name="nux_welcome_create_account">Create Account</string>
     <string name="nux_swipe_to_continue">SWIPE TO CONTINUE</string>
     <string name="nux_tutorial_tap_to_start">Tap to start using WordPress</string>
+    <string name="done">DONE</string>
+    <string name="post_settings">Post Settings</string>
 
     <string-array name="privacy_array">
          <item>Public</item>
diff --git a/src/org/wordpress/android/WordPressDB.java b/src/org/wordpress/android/WordPressDB.java
index 50d05104931f..dcac148604c6 100644
--- a/src/org/wordpress/android/WordPressDB.java
+++ b/src/org/wordpress/android/WordPressDB.java
@@ -296,7 +296,7 @@ private void migrateDrafts() {
                             c.getString(6), 0, 0, true, "", false, false);
                     post.setLocalDraft(true);
                     post.setPost_status("localdraft");
-                    post.setPage(true);
+                    post.setIsPage(true);
                     savePost(post, c.getInt(0));
                 }
                 c.moveToNext();
diff --git a/src/org/wordpress/android/models/Post.java b/src/org/wordpress/android/models/Post.java
index 06d9a217ac20..96d4ff2c60a6 100644
--- a/src/org/wordpress/android/models/Post.java
+++ b/src/org/wordpress/android/models/Post.java
@@ -2,6 +2,7 @@
 
 import android.util.Log;
 
+import java.util.Date;
 import java.util.List;
 import java.util.Vector;
 
@@ -10,6 +11,7 @@
 
 import org.wordpress.android.WordPress;
 import org.wordpress.android.util.StringUtils;
+import org.wordpress.android.util.WPHtml;
 
 public class Post {
 
@@ -49,7 +51,6 @@ public class Post {
     private Blog blog;
 
     public List<String> imageUrl = new Vector<String>();
-    List<String> selectedCategories = new Vector<String>();
 
     public Post(int blog_id, long post_id, boolean isPage) {
         // load an existing post
@@ -98,6 +99,12 @@ public Post(int blog_id, long post_id, boolean isPage) {
         }
     }
 
+    public Post(int blogId, boolean isPage) {
+        // creates a new, empty post for the passed in blogId
+        this(blogId, "", "", "", "", 0, "", "", "","", 0, 0, isPage, "", true, false);
+        this.localDraft = true;
+    }
+
     public Post(int blog_id, String title, String content, String excerpt, String picturePaths, long date, String categories, String tags, String status,
             String password, double latitude, double longitude, boolean isPage, String postFormat,
             boolean createBlogReference, boolean isLocalChange) {
@@ -363,7 +370,7 @@ public boolean isPage() {
         return isPage;
     }
 
-    public void setPage(boolean isPage) {
+    public void setIsPage(boolean isPage) {
         this.isPage = isPage;
     }
 
@@ -450,4 +457,26 @@ public boolean equals(Object other) {
                 this.blogID == otherPost.blogID
                 );
       }
+
+    /**
+     * Get the entire post content
+     * Joins description and mt_text_more fields if both are valid
+     * @return post content as String
+     */
+    public String getContent() {
+        String postContent;
+        if (!getMt_text_more().equals("")) {
+            if (isLocalDraft())
+                postContent = getDescription() + "\n&lt;!--more--&gt;\n" + getMt_text_more();
+            else
+                postContent = getDescription() + "\n<!--more-->\n" + getMt_text_more();
+        } else
+            postContent = getDescription();
+
+        return postContent;
+    }
+
+    public boolean isNew() {
+        return getId() >= 0;
+    }
 }
\ No newline at end of file
diff --git a/src/org/wordpress/android/ui/media/MediaUtils.java b/src/org/wordpress/android/ui/media/MediaUtils.java
index 1fabe1a5a0a4..0cea24ed99d7 100644
--- a/src/org/wordpress/android/ui/media/MediaUtils.java
+++ b/src/org/wordpress/android/ui/media/MediaUtils.java
@@ -1,14 +1,20 @@
 package org.wordpress.android.ui.media;
 
 import java.io.File;
+import java.io.FileOutputStream;
 import java.io.IOException;
+import java.io.InputStream;
+import java.io.OutputStream;
+import java.net.URL;
 import java.text.SimpleDateFormat;
 import java.util.Date;
 import java.util.Locale;
+import java.util.Random;
 import java.util.TimeZone;
 
 import android.app.Activity;
 import android.app.AlertDialog;
+import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
 import android.database.Cursor;
@@ -18,6 +24,8 @@
 import android.support.v4.app.Fragment;
 import android.support.v4.content.CursorLoader;
 
+import org.wordpress.android.util.ImageHelper;
+import org.wordpress.android.util.WPImageSpan;
 import org.wordpress.passcodelock.AppLockManager;
 
 import org.wordpress.android.R;
@@ -110,12 +118,19 @@ public static String getDate(long ms) {
  
     
     public static void launchPictureLibrary(Activity activity) {
+        /*Intent intent = new Intent(Intent.ACTION_PICK);
+        intent.setType("image/*");
+        intent.putExtra(Intent.EXTRA_LOCAL_ONLY, true);*/
+
         Intent intent = new Intent(Intent.ACTION_PICK);
         intent.setType("image/*");
-        intent.putExtra(Intent.EXTRA_LOCAL_ONLY, true);
-        
+        intent.setAction(Intent.ACTION_GET_CONTENT);
+
         AppLockManager.getInstance().setExtendedTimeout();
-        activity.startActivityForResult(intent, RequestCode.ACTIVITY_REQUEST_CODE_PICTURE_LIBRARY);
+
+        activity.startActivityForResult(Intent.createChooser(intent, "Select Picture:"), RequestCode.ACTIVITY_REQUEST_CODE_PICTURE_LIBRARY);
+
+        //activity.startActivityForResult(intent, RequestCode.ACTIVITY_REQUEST_CODE_PICTURE_LIBRARY);
     }
     
     public static void launchPictureLibrary(Fragment fragment) {
@@ -280,4 +295,129 @@ public static boolean canDeleteMedia(String blogId, String mediaID) {
         }
         return true;
     }
+
+    public static WPImageSpan prepareWPImageSpan(Context context, String blogId, final String mediaId) {
+        Cursor cursor = WordPress.wpDB.getMediaFile(blogId, mediaId);
+        if (cursor == null || !cursor.moveToFirst()){
+            if (cursor != null)
+                cursor.close();
+            return null;
+        }
+
+        String url = cursor.getString(cursor.getColumnIndex("fileURL"));
+        if (url == null) {
+            cursor.close();
+            return null;
+        }
+
+        Uri uri = Uri.parse(url);
+        WPImageSpan imageSpan = new WPImageSpan(context, R.drawable.remote_image, uri);
+        imageSpan.setMediaId(mediaId);
+        imageSpan.setCaption(cursor.getString(cursor.getColumnIndex("caption")));
+        imageSpan.setDescription(cursor.getString(cursor.getColumnIndex("description")));
+        imageSpan.setTitle(cursor.getString(cursor.getColumnIndex("title")));
+        imageSpan.setWidth(cursor.getInt(cursor.getColumnIndex("width")));
+        imageSpan.setHeight(cursor.getInt(cursor.getColumnIndex("height")));
+        imageSpan.setMimeType(cursor.getString(cursor.getColumnIndex("mimeType")));
+        imageSpan.setFileName(cursor.getString(cursor.getColumnIndex("fileName")));
+        imageSpan.setThumbnailURL(cursor.getString(cursor.getColumnIndex("thumbnailURL")));
+        imageSpan.setDateCreatedGMT(cursor.getLong(cursor.getColumnIndex("date_created_gmt")));
+
+        boolean isVideo = false;
+        String mimeType = cursor.getString(cursor.getColumnIndex("mimeType"));
+        if (mimeType != null && mimeType.contains("video"))
+            isVideo = true;
+        imageSpan.setVideo(isVideo);
+        cursor.close();
+
+        return imageSpan;
+    }
+
+    // Calculate the minimun width between the blog setting and picture real width
+    public static int getMinimumImageWitdh(Context context, Uri curStream) {
+        String imageWidth = WordPress.getCurrentBlog().getMaxImageWidth();
+        int imageWidthBlogSetting = Integer.MAX_VALUE;
+
+        if (!imageWidth.equals("Original Size")) {
+            try {
+                imageWidthBlogSetting = Integer.valueOf(imageWidth);
+            } catch (NumberFormatException e) {
+                e.printStackTrace();
+            }
+        }
+
+        int[] dimensions = ImageHelper.getImageSize(curStream, context);
+        int imageWidthPictureSetting = dimensions[0] == 0 ? Integer.MAX_VALUE : dimensions[0];
+
+        if (Math.min(imageWidthPictureSetting, imageWidthBlogSetting) == Integer.MAX_VALUE) {
+            //Default value in case of errors reading the picture size and the blog settings is set to Original size
+            return 1024;
+        } else {
+            return Math.min(imageWidthPictureSetting, imageWidthBlogSetting);
+        }
+    }
+
+    public static void setWPImageSpanWidth(Context context, Uri curStream, WPImageSpan is) {
+        is.setWidth(getMinimumImageWitdh(context, curStream));
+    }
+
+    public static boolean isPicasaImage(Uri imageUri) {
+        // Check if the imageUri returned is of picasa or not
+        if (imageUri.toString().startsWith("content://com.android.gallery3d.provider")) {
+            // Use the com.google provider for devices prior to 3.0
+            imageUri = Uri.parse(imageUri.toString().replace("com.android.gallery3d", "com.google.android.gallery3d"));
+        }
+
+        if (imageUri.toString().startsWith("content://com.google.android.gallery3d"))
+            return true;
+        else
+            return false;
+    }
+
+    public static Uri downloadExternalImage(Context context, Uri imageUri) {
+        File cacheDir;
+
+        // If the device has an SD card
+        if (android.os.Environment.getExternalStorageState().equals(android.os.Environment.MEDIA_MOUNTED))
+            cacheDir = new File(android.os.Environment.getExternalStorageDirectory() + "/WordPress/images");
+        else {
+            // If no SD card
+            cacheDir = context.getApplicationContext().getCacheDir();
+        }
+
+        if (!cacheDir.exists())
+            cacheDir.mkdirs();
+        Random r = new Random();
+        final String path = "wp-" + r.nextInt(400) + r.nextInt(400) + ".jpg";
+
+        File f = new File(cacheDir, path);
+
+        try {
+            InputStream input;
+            // Download the file
+            if (imageUri.toString().startsWith("content://com.google.android.gallery3d")) {
+                input = context.getContentResolver().openInputStream(imageUri);
+            } else {
+                input = new URL(imageUri.toString()).openStream();
+            }
+            OutputStream output = new FileOutputStream(f);
+
+            byte data[] = new byte[1024];
+            int count;
+            while ((count = input.read(data)) != -1) {
+                output.write(data, 0, count);
+            }
+
+            output.flush();
+            output.close();
+            input.close();
+
+            Uri newUri = Uri.fromFile(f);
+            return newUri;
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+
+        return null;
+    }
 }
diff --git a/src/org/wordpress/android/ui/posts/EditPostActivity.java b/src/org/wordpress/android/ui/posts/EditPostActivity.java
index eddb994df135..556c96469dd3 100644
--- a/src/org/wordpress/android/ui/posts/EditPostActivity.java
+++ b/src/org/wordpress/android/ui/posts/EditPostActivity.java
@@ -593,7 +593,7 @@ public boolean onContextItemSelected(MenuItem item) {
     public boolean onCreateOptionsMenu(com.actionbarsherlock.view.Menu menu) {
         super.onCreateOptionsMenu(menu);
         MenuInflater inflater = getSupportMenuInflater();
-        inflater.inflate(R.menu.edit, menu);
+        inflater.inflate(R.menu.edit_post, menu);
         return true;
     }
 
@@ -939,7 +939,7 @@ public void onClick(DialogInterface dialog, int whichButton) {
                     if (selectionStart >= 0 && mContentEditText.getSelectionEnd() >= selectionStart);
                         mContentEditText.setSelection(selectionStart, mContentEditText.getSelectionEnd());
                 }
-                
+
                 // get media gallery spans
 
                 MediaGalleryImageSpan[] gallerySpans = s.getSpans(charPosition, charPosition, MediaGalleryImageSpan.class);
@@ -947,7 +947,7 @@ public void onClick(DialogInterface dialog, int whichButton) {
                     final MediaGalleryImageSpan gallerySpan = gallerySpans[0];
                     startMediaGalleryActivity(gallerySpan.getMediaGallery());
                 }
-                
+
             }
         } else if (event.getAction() == 1) {
             mScrollDetected = false;
diff --git a/src/org/wordpress/android/ui/posts/EditPostContentFragment.java b/src/org/wordpress/android/ui/posts/EditPostContentFragment.java
new file mode 100644
index 000000000000..908074558f55
--- /dev/null
+++ b/src/org/wordpress/android/ui/posts/EditPostContentFragment.java
@@ -0,0 +1,1479 @@
+package org.wordpress.android.ui.posts;
+
+import android.app.Activity;
+import android.app.AlertDialog;
+import android.content.Context;
+import android.content.DialogInterface;
+import android.content.Intent;
+import android.graphics.Bitmap;
+import android.net.Uri;
+import android.os.AsyncTask;
+import android.os.Bundle;
+import android.os.Environment;
+import android.text.Editable;
+import android.text.Layout;
+import android.text.Selection;
+import android.text.Spannable;
+import android.text.SpannableStringBuilder;
+import android.text.TextUtils;
+import android.text.TextWatcher;
+import android.text.method.ArrowKeyMovementMethod;
+import android.text.style.AlignmentSpan;
+import android.text.style.CharacterStyle;
+import android.text.style.QuoteSpan;
+import android.text.style.StrikethroughSpan;
+import android.text.style.StyleSpan;
+import android.text.style.URLSpan;
+import android.view.ContextMenu;
+import android.view.KeyEvent;
+import android.view.LayoutInflater;
+import android.view.MenuItem;
+import android.view.MotionEvent;
+import android.view.View;
+import android.view.ViewGroup;
+import android.view.WindowManager;
+import android.view.animation.AlphaAnimation;
+import android.view.animation.Animation;
+import android.view.animation.DecelerateInterpolator;
+import android.view.inputmethod.InputMethodManager;
+import android.widget.ArrayAdapter;
+import android.widget.Button;
+import android.widget.CheckBox;
+import android.widget.CompoundButton;
+import android.widget.EditText;
+import android.widget.ImageButton;
+import android.widget.RelativeLayout;
+import android.widget.SeekBar;
+import android.widget.Spinner;
+import android.widget.TextView;
+import android.widget.Toast;
+import android.widget.ToggleButton;
+
+import com.actionbarsherlock.app.ActionBar;
+import com.actionbarsherlock.app.SherlockFragment;
+import com.android.volley.VolleyError;
+import com.android.volley.toolbox.ImageLoader;
+
+import org.wordpress.android.R;
+import org.wordpress.android.WordPress;
+import org.wordpress.android.models.Blog;
+import org.wordpress.android.models.MediaFile;
+import org.wordpress.android.models.MediaGallery;
+import org.wordpress.android.models.Post;
+import org.wordpress.android.ui.media.MediaGalleryActivity;
+import org.wordpress.android.ui.media.MediaGalleryPickerActivity;
+import org.wordpress.android.ui.media.MediaUtils;
+import org.wordpress.android.util.DeviceUtils;
+import org.wordpress.android.util.ImageHelper;
+import org.wordpress.android.util.MediaGalleryImageSpan;
+import org.wordpress.android.util.StringUtils;
+import org.wordpress.android.util.WPEditText;
+import org.wordpress.android.util.WPHtml;
+import org.wordpress.android.util.WPImageSpan;
+import org.wordpress.android.util.WPUnderlineSpan;
+import org.wordpress.passcodelock.AppLockManager;
+import org.xmlrpc.android.ApiHelper;
+
+import java.io.ByteArrayOutputStream;
+import java.io.File;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+
+/**
+ * Created by dan on 11/20/13.
+ */
+public class EditPostContentFragment extends SherlockFragment implements TextWatcher,
+        WPEditText.OnSelectionChangedListener, View.OnTouchListener {
+
+    NewEditPostActivity mActivity;
+
+    private static final int ACTIVITY_REQUEST_CODE_CREATE_LINK = 4;
+    public static final String NEW_MEDIA_POST_EXTRA = "NEW_MEDIA_POST_ID";
+
+    private Post mPost;
+
+    private WPEditText mContentEditText;
+    private ImageButton mAddPictureButton;
+    private EditText mTitleEditText;
+    private ToggleButton mBoldToggleButton, mEmToggleButton, mBquoteToggleButton;
+    private ToggleButton mUnderlineToggleButton, mStrikeToggleButton;
+    private Button mLinkButton, mMoreButton;
+    private RelativeLayout mFormatBar;
+    private boolean mIsBackspace;
+    private boolean mScrollDetected;
+
+    private String mMediaCapturePath = "";
+
+    private int mStyleStart, mSelectionStart, mSelectionEnd;
+    private int mLastPosition = -1;
+    private int mCurrentActivityRequest = -1;
+
+    private float mLastYPos = 0;
+
+    @Override
+    public View onCreateView(LayoutInflater inflater, ViewGroup container,
+                             Bundle savedInstanceState) {
+        mActivity = (NewEditPostActivity)getActivity();
+
+        ViewGroup rootView = (ViewGroup) inflater
+                .inflate(R.layout.fragment_edit_post_content, container, false);
+
+        mFormatBar = (RelativeLayout) rootView.findViewById(R.id.format_bar);
+        mTitleEditText = (EditText)rootView.findViewById(R.id.post_title);
+        mContentEditText = (WPEditText)rootView.findViewById(R.id.post_content);
+        mBoldToggleButton = (ToggleButton) rootView.findViewById(R.id.bold);
+        mEmToggleButton = (ToggleButton) rootView.findViewById(R.id.em);
+        mBquoteToggleButton = (ToggleButton) rootView.findViewById(R.id.bquote);
+        mUnderlineToggleButton = (ToggleButton) rootView.findViewById(R.id.underline);
+        mStrikeToggleButton = (ToggleButton) rootView.findViewById(R.id.strike);
+        mAddPictureButton = (ImageButton) rootView.findViewById(R.id.addPictureButton);
+        mLinkButton = (Button) rootView.findViewById(R.id.link);
+        mMoreButton = (Button) rootView.findViewById(R.id.more);
+
+        registerForContextMenu(mAddPictureButton);
+        mContentEditText.setOnSelectionChangedListener(this);
+        mContentEditText.setOnTouchListener(this);
+        mContentEditText.addTextChangedListener(this);
+        mAddPictureButton.setOnClickListener(mFormatBarButtonClickListener);
+        mBoldToggleButton.setOnClickListener(mFormatBarButtonClickListener);
+        mLinkButton.setOnClickListener(mFormatBarButtonClickListener);
+        mEmToggleButton.setOnClickListener(mFormatBarButtonClickListener);
+        mUnderlineToggleButton.setOnClickListener(mFormatBarButtonClickListener);
+        mStrikeToggleButton.setOnClickListener(mFormatBarButtonClickListener);
+        mBquoteToggleButton.setOnClickListener(mFormatBarButtonClickListener);
+        mMoreButton.setOnClickListener(mFormatBarButtonClickListener);
+
+        mPost = mActivity.getPost();
+        if (mPost != null) {
+            if (!TextUtils.isEmpty(mPost.getContent())) {
+                if (mPost.isLocalDraft())
+                    mContentEditText.setText(WPHtml.fromHtml(mPost.getContent().replaceAll("\uFFFC", ""), mActivity, mPost));
+                else
+                    mContentEditText.setText(mPost.getContent().replaceAll("\uFFFC", ""));
+            }
+            if (!TextUtils.isEmpty(mPost.getTitle())) {
+                mTitleEditText.setText(mPost.getTitle());
+            }
+        }
+
+        mContentEditText.setOnFocusChangeListener(new View.OnFocusChangeListener() {
+            @Override
+            public void onFocusChange(View v, boolean hasFocus) {
+                if (mPost != null && hasFocus) {
+                    setContentEditingModeVisible(true);
+                }
+            }
+        });
+
+        setContentEditTextFocusable(true);
+
+        return rootView;
+    }
+
+    public void setContentEditTextFocusable(boolean canFocus) {
+        if (mContentEditText != null) {
+            mContentEditText.setFocusableInTouchMode(canFocus);
+            mContentEditText.setFocusable(canFocus);
+        }
+    }
+
+    private void setContentEditingModeVisible(boolean isVisible) {
+        if (mActivity == null)
+            return;
+        ActionBar actionBar = mActivity.getSupportActionBar();
+        if (isVisible) {
+
+            //actionBar.hide();
+
+            actionBar.setDisplayShowHomeEnabled(false);
+            actionBar.setDisplayShowTitleEnabled(false);
+            actionBar.setDisplayShowCustomEnabled(true);
+            ViewGroup actionBarLayout = (ViewGroup) mActivity.getLayoutInflater().inflate(R.layout.edit_post_content_action_bar, null);
+            actionBar.setCustomView(actionBarLayout);
+            Button doneButton = (Button) mActivity.findViewById(R.id.action_bar_done);
+            doneButton.setOnClickListener(new View.OnClickListener() {
+                @Override
+                public void onClick(View v) {
+                    setContentEditingModeVisible(false);
+                }
+            });
+
+            actionBar.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);
+            mTitleEditText.setVisibility(View.GONE);
+
+            mActivity.supportInvalidateOptionsMenu();
+            //actionBar.show();
+
+            Animation fadeIn = new AlphaAnimation(0, 1);
+            fadeIn.setInterpolator(new DecelerateInterpolator()); //add this
+            fadeIn.setDuration(300);
+            fadeIn.setStartOffset(300);
+            mFormatBar.setVisibility(View.VISIBLE);
+            mFormatBar.startAnimation(fadeIn);
+
+        } else {
+            //actionBar.hide();
+
+            actionBar.setDisplayShowHomeEnabled(true);
+            actionBar.setDisplayShowTitleEnabled(true);
+            actionBar.setDisplayShowCustomEnabled(false);
+            actionBar.setNavigationMode(ActionBar.NAVIGATION_MODE_TABS);
+            mTitleEditText.setVisibility(View.VISIBLE);
+            mFormatBar.setVisibility(View.GONE);
+            mActivity.supportInvalidateOptionsMenu();
+
+            //actionBar.show();
+        }
+    }
+
+    public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {
+        menu.add(0, 0, 0, getResources().getText(R.string.select_photo));
+        if (DeviceUtils.getInstance().hasCamera(getActivity())) {
+            menu.add(0, 1, 0, getResources().getText(R.string.media_add_popup_capture_photo));
+        }
+        menu.add(0, 2, 0, getResources().getText(R.string.select_video));
+        if (DeviceUtils.getInstance().hasCamera(getActivity())) {
+            menu.add(0, 3, 0, getResources().getText(R.string.media_add_popup_capture_video));
+        }
+
+        menu.add(0, 4, 0, getResources().getText(R.string.media_add_new_media_gallery));
+        menu.add(0, 5, 0, getResources().getText(R.string.select_from_media_library));
+    }
+
+    @Override
+    public void onActivityResult(int requestCode, int resultCode, Intent data) {
+        super.onActivityResult(requestCode, resultCode, data);
+
+        if (data != null || ((requestCode == MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_PHOTO || requestCode == MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_VIDEO))) {
+            Bundle extras;
+
+            switch (requestCode) {
+                case MediaGalleryActivity.REQUEST_CODE:
+                    if (resultCode == Activity.RESULT_OK) {
+                        handleMediaGalleryResult(data);
+                    }
+                    break;
+                case MediaGalleryPickerActivity.REQUEST_CODE:
+                    if (resultCode == Activity.RESULT_OK) {
+                        handleMediaGalleryPickerResult(data);
+                    }
+                    break;
+                case MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_PICTURE_LIBRARY:
+                    Uri imageUri = data.getData();
+                    verifyImage(imageUri);
+                    break;
+                case MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_PHOTO:
+                    if (resultCode == Activity.RESULT_OK) {
+                        try {
+                            File f = new File(mMediaCapturePath);
+                            Uri capturedImageUri = Uri.fromFile(f);
+                            f = null;
+                            if (!addMedia(capturedImageUri, null))
+                                Toast.makeText(getActivity(), getResources().getText(R.string.gallery_error), Toast.LENGTH_SHORT).show();
+                            getActivity().sendBroadcast(new Intent(Intent.ACTION_MEDIA_MOUNTED, Uri.parse("file://"
+                                    + Environment.getExternalStorageDirectory())));
+                        } catch (Exception e) {
+                            e.printStackTrace();
+                        } catch (OutOfMemoryError e) {
+                            e.printStackTrace();
+                        }
+                    }
+                    break;
+                case MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_VIDEO_LIBRARY:
+                    Uri videoUri = data.getData();
+                    if (!addMedia(videoUri, null))
+                        Toast.makeText(getActivity(), getResources().getText(R.string.gallery_error), Toast.LENGTH_SHORT).show();
+                    break;
+                case MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_VIDEO:
+                    if (resultCode == Activity.RESULT_OK) {
+                        Uri capturedVideoUri = MediaUtils.getLastRecordedVideoUri(getActivity());
+                        if (!addMedia(capturedVideoUri, null))
+                            Toast.makeText(getActivity(), getResources().getText(R.string.gallery_error), Toast.LENGTH_SHORT).show();
+                    }
+                    break;
+                case ACTIVITY_REQUEST_CODE_CREATE_LINK:
+                    try {
+                        extras = data.getExtras();
+                        String linkURL = extras.getString("linkURL");
+                        if (!linkURL.equals("http://") && !linkURL.equals("")) {
+
+                            if (mSelectionStart > mSelectionEnd) {
+                                int temp = mSelectionEnd;
+                                mSelectionEnd = mSelectionStart;
+                                mSelectionStart = temp;
+                            }
+                            Editable str = mContentEditText.getText();
+                            if (mPost.isLocalDraft()) {
+                                if (extras.getString("linkText") == null) {
+                                    if (mSelectionStart < mSelectionEnd)
+                                        str.delete(mSelectionStart, mSelectionEnd);
+                                    str.insert(mSelectionStart, linkURL);
+                                    str.setSpan(new URLSpan(linkURL), mSelectionStart, mSelectionStart + linkURL.length(),
+                                            Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                                    mContentEditText.setSelection(mSelectionStart + linkURL.length());
+                                } else {
+                                    String linkText = extras.getString("linkText");
+                                    if (mSelectionStart < mSelectionEnd)
+                                        str.delete(mSelectionStart, mSelectionEnd);
+                                    str.insert(mSelectionStart, linkText);
+                                    str.setSpan(new URLSpan(linkURL), mSelectionStart, mSelectionStart + linkText.length(),
+                                            Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                                    mContentEditText.setSelection(mSelectionStart + linkText.length());
+                                }
+                            } else {
+                                if (extras.getString("linkText") == null) {
+                                    if (mSelectionStart < mSelectionEnd)
+                                        str.delete(mSelectionStart, mSelectionEnd);
+                                    String urlHTML = "<a href=\"" + linkURL + "\">" + linkURL + "</a>";
+                                    str.insert(mSelectionStart, urlHTML);
+                                    mContentEditText.setSelection(mSelectionStart + urlHTML.length());
+                                } else {
+                                    String linkText = extras.getString("linkText");
+                                    if (mSelectionStart < mSelectionEnd)
+                                        str.delete(mSelectionStart, mSelectionEnd);
+                                    String urlHTML = "<a href=\"" + linkURL + "\">" + linkText + "</a>";
+                                    str.insert(mSelectionStart, urlHTML);
+                                    mContentEditText.setSelection(mSelectionStart + urlHTML.length());
+                                }
+                            }
+                        }
+                    } catch (Exception e) {
+                        e.printStackTrace();
+                    }
+                    break;
+            }
+        }
+    }
+
+    @Override
+    public boolean onContextItemSelected(MenuItem item) {
+        switch (item.getItemId()) {
+            case 0:
+                launchPictureLibrary();
+                return true;
+            case 1:
+                launchCamera();
+                return true;
+            case 2:
+                launchVideoLibrary();
+                return true;
+            case 3:
+                launchVideoCamera();
+                return true;
+            case 4:
+                startMediaGalleryActivity(null);
+                return true;
+            case 5:
+                startMediaGalleryAddActivity();
+                return true;
+        }
+        return false;
+    }
+
+    /**
+     * Media
+     */
+
+    private void launchPictureLibrary() {
+        mCurrentActivityRequest = MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_PICTURE_LIBRARY;
+        MediaUtils.launchPictureLibrary(this);
+        AppLockManager.getInstance().setExtendedTimeout();
+    }
+
+    private void launchCamera() {
+        MediaUtils.launchCamera(this, new MediaUtils.LaunchCameraCallback() {
+
+            @Override
+            public void onMediaCapturePathReady(String mediaCapturePath) {
+                mMediaCapturePath = mediaCapturePath;
+                mCurrentActivityRequest = MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_PHOTO;
+                AppLockManager.getInstance().setExtendedTimeout();
+            }
+        });
+    }
+
+    private void launchVideoLibrary() {
+        mCurrentActivityRequest = MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_VIDEO_LIBRARY;
+        MediaUtils.launchVideoLibrary(this);
+        AppLockManager.getInstance().setExtendedTimeout();
+    }
+
+    private void launchVideoCamera() {
+        mCurrentActivityRequest = MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_VIDEO;
+        MediaUtils.launchVideoCamera(this);
+        AppLockManager.getInstance().setExtendedTimeout();
+    }
+
+    private void verifyImage(Uri imageUri) {
+        if (MediaUtils.isPicasaImage(imageUri)) {
+            // Create an AsyncTask to download the file
+            new DownloadImageTask().execute(imageUri);
+        } else {
+            // It is a regular local image file
+            if (!addMedia(imageUri, null))
+                Toast.makeText(getActivity(), getResources().getText(R.string.gallery_error), Toast.LENGTH_SHORT).show();
+        }
+    }
+
+    public void savePostContent(boolean isAutoSave) {
+
+        if (mPost == null)
+            return;
+
+        String title = mTitleEditText.getText().toString();
+        String content;
+
+        if (mPost.isLocalDraft() || !isAutoSave) {
+            Editable e = mContentEditText.getText();
+            if (android.os.Build.VERSION.SDK_INT >= 14) {
+                // remove suggestion spans, they cause craziness in
+                // WPHtml.toHTML().
+                CharacterStyle[] style = e.getSpans(0, e.length(), CharacterStyle.class);
+                for (int i = 0; i < style.length; i++) {
+                    if (style[i].getClass().getName().equals("android.text.style.SuggestionSpan"))
+                        e.removeSpan(style[i]);
+                }
+            }
+            content = WPHtml.toHtml(e);
+            // replace duplicate <p> tags so there's not duplicates, trac #86
+            content = content.replace("<p><p>", "<p>");
+            content = content.replace("</p></p>", "</p>");
+            content = content.replace("<br><br>", "<br>");
+            // sometimes the editor creates extra tags
+            content = content.replace("</strong><strong>", "").replace("</em><em>", "").replace("</u><u>", "")
+                    .replace("</strike><strike>", "").replace("</blockquote><blockquote>", "");
+        } else {
+            content = mContentEditText.getText().toString();
+        }
+
+        String images = "";
+        // update the images
+        mPost.deleteMediaFiles();
+
+        Editable s = mContentEditText.getText();
+
+        // Add gallery shortcode
+        MediaGalleryImageSpan[] gallerySpans = s.getSpans(0, s.length(), MediaGalleryImageSpan.class);
+        for (MediaGalleryImageSpan gallerySpan : gallerySpans) {
+            int start = s.getSpanStart(gallerySpan);
+            s.removeSpan(gallerySpan);
+            s.insert(start, WPHtml.getGalleryShortcode(gallerySpan));
+        }
+
+        WPImageSpan[] imageSpans = s.getSpans(0, s.length(), WPImageSpan.class);
+        if (imageSpans.length != 0) {
+
+            for (int i = 0; i < imageSpans.length; i++) {
+                WPImageSpan wpIS = imageSpans[i];
+                images += wpIS.getImageSource().toString() + ",";
+
+                if (wpIS.getMediaId() != null) {
+                    updateMediaFileOnServer(wpIS);
+                } else {
+                    MediaFile mf = new MediaFile();
+                    mf.setBlogId(WordPress.getCurrentBlog().getBlogId() + "");
+                    mf.setPostID(mPost.getId());
+                    mf.setTitle(wpIS.getTitle());
+                    mf.setCaption(wpIS.getCaption());
+                    // mf.setDescription(wpIS.getDescription());
+                    mf.setFeatured(wpIS.isFeatured());
+                    mf.setFeaturedInPost(wpIS.isFeaturedInPost());
+                    mf.setFileName(wpIS.getImageSource().toString());
+                    mf.setFilePath(wpIS.getImageSource().toString());
+                    mf.setHorizontalAlignment(wpIS.getHorizontalAlignment());
+                    mf.setWidth(wpIS.getWidth());
+                    mf.setVideo(wpIS.isVideo());
+                    mf.save();
+                }
+
+                int tagStart = s.getSpanStart(wpIS);
+                if (!isAutoSave) {
+                    s.removeSpan(wpIS);
+
+                    // network image has a mediaId
+                    if (wpIS.getMediaId() != null && wpIS.getMediaId().length() > 0) {
+                        s.insert(tagStart, WPHtml.getContent(wpIS));
+
+                    } else { // local image for upload
+                        s.insert(tagStart, "<img android-uri=\"" + wpIS.getImageSource().toString() + "\" />");
+                    }
+                }
+            }
+        }
+
+        String moreTag = "<!--more-->";
+
+        mPost.setTitle(title);
+        // split up the post content if there's a more tag
+        if (mPost.isLocalDraft() && content.indexOf(moreTag) >= 0) {
+            mPost.setDescription(content.substring(0, content.indexOf(moreTag)));
+            mPost.setMt_text_more(content.substring(content.indexOf(moreTag) + moreTag.length(), content.length()));
+        } else {
+            mPost.setDescription(content);
+            mPost.setMt_text_more("");
+        }
+        mPost.setMediaPaths(images);
+        if (!mPost.isLocalDraft())
+            mPost.setLocalChange(true);
+        mPost.update();
+    }
+
+    public boolean hasEmptyContentFields() {
+        return TextUtils.isEmpty(mTitleEditText.getText()) && TextUtils.isEmpty(mContentEditText.getText());
+    }
+
+    private class DownloadImageTask extends AsyncTask<Uri, Integer, Uri> {
+
+        @Override
+        protected Uri doInBackground(Uri... uris) {
+            Uri imageUri = uris[0];
+            return MediaUtils.downloadExternalImage(getActivity(), imageUri);
+        }
+
+        @Override
+        protected void onPreExecute() {
+            //TODO: Show a toast instead?
+            //showDialog(ID_DIALOG_DOWNLOAD);
+        }
+
+        protected void onPostExecute(Uri newUri) {
+            //dismissDialog(ID_DIALOG_DOWNLOAD);
+            if (newUri != null)
+                addMedia(newUri, null);
+            else
+                Toast.makeText(getActivity(), getString(R.string.error_downloading_image), Toast.LENGTH_SHORT).show();
+        }
+    }
+
+    private void prepareMediaGallery() {
+        MediaGallery mediaGallery = new MediaGallery();
+        mediaGallery.setIds(getActivity().getIntent().getStringArrayListExtra("NEW_MEDIA_GALLERY_EXTRA_IDS"));
+
+        startMediaGalleryActivity(mediaGallery);
+    }
+
+    private void prepareMediaPost() {
+        String mediaId = getActivity().getIntent().getStringExtra(NEW_MEDIA_POST_EXTRA);
+        addExistingMediaToEditor(mediaId);
+    }
+
+    private void addExistingMediaToEditor(String mediaId) {
+        if (WordPress.getCurrentBlog() == null)
+            return;
+
+        String blogId = String.valueOf(WordPress.getCurrentBlog().getBlogId());
+
+        WPImageSpan imageSpan = MediaUtils.prepareWPImageSpan(getActivity(), blogId, mediaId);
+        if (imageSpan == null)
+            return;
+
+        // based on addMedia()
+
+        int selectionStart = mContentEditText.getSelectionStart();
+        int selectionEnd = mContentEditText.getSelectionEnd();
+
+        if (selectionStart > selectionEnd) {
+            int temp = selectionEnd;
+            selectionEnd = selectionStart;
+            selectionStart = temp;
+        }
+
+        int line = 0, column = 0;
+        try {
+            line = mContentEditText.getLayout().getLineForOffset(selectionStart);
+            column = mContentEditText.getSelectionStart() - mContentEditText.getLayout().getLineStart(line);
+        } catch (Exception ex) {
+        }
+
+        Editable s = mContentEditText.getText();
+        WPImageSpan[] gallerySpans = s.getSpans(selectionStart, selectionEnd, WPImageSpan.class);
+        if (gallerySpans.length != 0) {
+            // insert a few line breaks if the cursor is already on an image
+            s.insert(selectionEnd, "\n\n");
+            selectionStart = selectionStart + 2;
+            selectionEnd = selectionEnd + 2;
+        } else if (column != 0) {
+            // insert one line break if the cursor is not at the first column
+            s.insert(selectionEnd, "\n");
+            selectionStart = selectionStart + 1;
+            selectionEnd = selectionEnd + 1;
+        }
+
+        s.insert(selectionStart, " ");
+        s.setSpan(imageSpan, selectionStart, selectionEnd + 1, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+        AlignmentSpan.Standard as = new AlignmentSpan.Standard(Layout.Alignment.ALIGN_CENTER);
+        s.setSpan(as, selectionStart, selectionEnd + 1, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+        s.insert(selectionEnd + 1, "\n\n");
+        try {
+            mContentEditText.setSelection(s.length());
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+
+        // load image from server
+        loadWPImageSpanThumbnail(imageSpan);
+    }
+
+    private void updateMediaFileOnServer(WPImageSpan wpIS) {
+
+        Blog currentBlog = WordPress.getCurrentBlog();
+        if (currentBlog == null || wpIS == null)
+            return;
+
+        MediaFile mf = getMediaFileFromWPImageSpan(wpIS);
+
+        final String mediaId = mf.getMediaId();
+        final String title = mf.getTitle();
+        final String description = mf.getDescription();
+        final String caption = mf.getCaption();
+
+        ApiHelper.EditMediaItemTask task = new ApiHelper.EditMediaItemTask(mf.getMediaId(), mf.getTitle(),
+                mf.getDescription(), mf.getCaption(),
+                new ApiHelper.EditMediaItemTask.Callback() {
+
+                    @Override
+                    public void onSuccess() {
+                        String blogId = String.valueOf(WordPress.getCurrentBlog().getBlogId());
+                        WordPress.wpDB.updateMediaFile(blogId, mediaId, title, description, caption);
+                    }
+
+                    @Override
+                    public void onFailure() {
+                        Toast.makeText(getActivity(), R.string.media_edit_failure, Toast.LENGTH_LONG).show();
+                    }
+                });
+
+        List<Object> apiArgs = new ArrayList<Object>();
+        apiArgs.add(currentBlog);
+        task.execute(apiArgs);
+    }
+
+    private MediaFile getMediaFileFromWPImageSpan(WPImageSpan wpIS) {
+        MediaFile mf = new MediaFile();
+        mf.setMediaId(wpIS.getMediaId());
+        if (mPost != null)
+            mf.setPostID(mPost.getId());
+        mf.setMIMEType(wpIS.getMimeType());
+        mf.setHeight(wpIS.getHeight());
+        mf.setFileName(wpIS.getFileName());
+        mf.setTitle(wpIS.getTitle());
+        mf.setCaption(wpIS.getCaption());
+        mf.setDescription(wpIS.getDescription());
+        mf.setFeatured(wpIS.isFeatured());
+        mf.setFeaturedInPost(wpIS.isFeaturedInPost());
+        mf.setHorizontalAlignment(wpIS.getHorizontalAlignment());
+        mf.setWidth(wpIS.getWidth());
+        mf.setBlogId(WordPress.getCurrentBlog().getBlogId() + "");
+        mf.setDateCreatedGMT(wpIS.getDateCreatedGMT());
+        mf.save();
+        return mf;
+    }
+
+    /** Loads the thumbnail url in the imagespan from a server **/
+    private void loadWPImageSpanThumbnail(WPImageSpan imageSpan) {
+        final String mediaId = imageSpan.getMediaId();
+        String imageUrl = imageSpan.getThumbnailURL();
+        if (imageUrl == null || mediaId == null)
+            return;
+
+        if (WordPress.getCurrentBlog() != null && WordPress.getCurrentBlog().isPhotonCapable()) {
+            String photonUrl = imageSpan.getImageSource().toString();
+            imageUrl = StringUtils.getPhotonUrl(photonUrl, 400);
+        }
+
+        WordPress.imageLoader.get(imageUrl, new ImageLoader.ImageListener() {
+
+            @Override
+            public void onErrorResponse(VolleyError arg0) {
+
+            }
+
+            @Override
+            public void onResponse(ImageLoader.ImageContainer container, boolean arg1) {
+                if (container.getBitmap() != null) {
+
+                    Bitmap bitmap = container.getBitmap();
+
+                    ImageHelper ih = new ImageHelper();
+                    ByteArrayOutputStream stream = new ByteArrayOutputStream();
+                    bitmap.compress(Bitmap.CompressFormat.PNG, 100, stream);
+                    byte[] bitmapByteArray = stream.toByteArray();
+                    Bitmap resizedBitmap = ih.getResizedImageThumbnail(getActivity(), bitmapByteArray, null);
+                    if (resizedBitmap == null)
+                        return;
+                    Editable s = mContentEditText.getText();
+                    WPImageSpan[] spans = s.getSpans(0, s.length(), WPImageSpan.class);
+                    if (spans.length != 0) {
+                        for (WPImageSpan is : spans) {
+                            if (mediaId != null && mediaId.equals(is.getMediaId()) && !is.isNetworkImageLoaded()) {
+
+                                // replace the existing span with a new one with the correct image, re-add it to the same position.
+                                int spanStart = s.getSpanStart(is);
+                                int spanEnd = s.getSpanEnd(is);
+                                WPImageSpan imageSpan = new WPImageSpan(getActivity(), resizedBitmap, is.getImageSource());
+                                imageSpan.setCaption(is.getCaption());
+                                imageSpan.setDescription(is.getDescription());
+                                imageSpan.setFeatured(is.isFeatured());
+                                imageSpan.setFeaturedInPost(is.isFeaturedInPost());
+                                imageSpan.setHeight(is.getHeight());
+                                imageSpan.setHorizontalAlignment(is.getHorizontalAlignment());
+                                imageSpan.setMediaId(is.getMediaId());
+                                imageSpan.setMimeType(is.getMimeType());
+                                imageSpan.setTitle(is.getTitle());
+                                imageSpan.setVideo(is.isVideo());
+                                imageSpan.setWidth(is.getWidth());
+                                imageSpan.setFileName(is.getFileName());
+                                imageSpan.setThumbnailURL(is.getThumbnailURL());
+                                imageSpan.setDateCreatedGMT(is.getDateCreatedGMT());
+                                imageSpan.setNetworkImageLoaded(true);
+                                s.removeSpan(is);
+                                s.setSpan(imageSpan, spanStart, spanEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                                break;
+                            }
+                        }
+                    }
+                }
+            }
+        }, 0, 0);
+    }
+
+    private void startMediaGalleryActivity(MediaGallery mediaGallery) {
+        Intent intent = new Intent(getActivity(), MediaGalleryActivity.class);
+        intent.putExtra(MediaGalleryActivity.PARAMS_MEDIA_GALLERY, mediaGallery);
+        startActivityForResult(intent, MediaGalleryActivity.REQUEST_CODE);
+    }
+
+    private void startMediaGalleryAddActivity() {
+        Intent intent = new Intent(getActivity(), MediaGalleryPickerActivity.class);
+        intent.putExtra(MediaGalleryPickerActivity.PARAM_SELECT_ONE_ITEM, true);
+        startActivityForResult(intent, MediaGalleryPickerActivity.REQUEST_CODE);
+    }
+
+    private void handleMediaGalleryPickerResult(Intent data) {
+        ArrayList<String> ids = data.getStringArrayListExtra(MediaGalleryPickerActivity.RESULT_IDS);
+        if (ids == null || ids.size() == 0)
+            return;
+
+        String mediaId = ids.get(0);
+        addExistingMediaToEditor(mediaId);
+    }
+
+    private void handleMediaGalleryResult(Intent data) {
+        MediaGallery gallery = (MediaGallery) data.getSerializableExtra(MediaGalleryActivity.RESULT_MEDIA_GALLERY);
+
+        // if blank gallery returned, don't add to span
+        if (gallery == null || gallery.getIds().size() == 0)
+            return;
+
+
+        int selectionStart = mContentEditText.getSelectionStart();
+        int selectionEnd = mContentEditText.getSelectionEnd();
+
+        if (selectionStart > selectionEnd) {
+            int temp = selectionEnd;
+            selectionEnd = selectionStart;
+            selectionStart = temp;
+        }
+
+        int line = 0, column = 0;
+        try {
+            line = mContentEditText.getLayout().getLineForOffset(selectionStart);
+            column = mContentEditText.getSelectionStart() - mContentEditText.getLayout().getLineStart(line);
+        } catch (Exception ex) {
+        }
+
+        Editable s = mContentEditText.getText();
+        MediaGalleryImageSpan[] gallerySpans = s.getSpans(selectionStart, selectionEnd, MediaGalleryImageSpan.class);
+        if (gallerySpans.length != 0) {
+            for (int i = 0; i < gallerySpans.length; i++) {
+                if (gallerySpans[i].getMediaGallery().getUniqueId() == gallery.getUniqueId()) {
+
+                    // replace the existing span with a new gallery, re-add it to the same position.
+                    gallerySpans[i].setMediaGallery(gallery);
+                    int spanStart = s.getSpanStart(gallerySpans[i]);
+                    int spanEnd = s.getSpanEnd(gallerySpans[i]);
+                    s.setSpan(gallerySpans[i], spanStart, spanEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                }
+            }
+            return;
+        } else if (column != 0) {
+            // insert one line break if the cursor is not at the first column
+            s.insert(selectionEnd, "\n");
+            selectionStart = selectionStart + 1;
+            selectionEnd = selectionEnd + 1;
+        }
+
+        s.insert(selectionStart, " ");
+        MediaGalleryImageSpan is = new MediaGalleryImageSpan(getActivity(), gallery);
+        s.setSpan(is, selectionStart, selectionEnd + 1, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+        AlignmentSpan.Standard as = new AlignmentSpan.Standard(Layout.Alignment.ALIGN_CENTER);
+        s.setSpan(as, selectionStart, selectionEnd + 1, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+        s.insert(selectionEnd + 1, "\n\n");
+        try {
+            mContentEditText.setSelection(s.length());
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+    }
+
+    private boolean addMedia(Uri imageUri, SpannableStringBuilder ssb) {
+
+        //if (mFormatBar.getVisibility() == View.VISIBLE)
+        //    hideFormatBar();
+
+        if (ssb != null && MediaUtils.isPicasaImage(imageUri))
+            imageUri = MediaUtils.downloadExternalImage(getActivity(), imageUri);
+
+        if (imageUri == null) {
+            return false;
+        }
+
+        ImageHelper ih = new ImageHelper();
+        Map<String, Object> mediaData = ih.getImageBytesForPath(imageUri.getEncodedPath(), getActivity());
+
+        if (mediaData == null) {
+            // data stream not returned
+            return false;
+        }
+
+        Bitmap resizedBitmap = ih.getResizedImageThumbnail(getActivity(), (byte[]) mediaData.get("bytes"), (String) mediaData.get("orientation"));
+        if (resizedBitmap == null)
+            return false;
+
+        if (ssb != null) {
+            WPImageSpan is = new WPImageSpan(getActivity(), resizedBitmap, imageUri);
+
+            MediaUtils.setWPImageSpanWidth(getActivity(), imageUri, is);
+
+            is.setTitle((String) mediaData.get("title"));
+            is.setImageSource(imageUri);
+            is.setVideo(imageUri.getEncodedPath().contains("video"));
+            ssb.append(" ");
+            ssb.setSpan(is, ssb.length() - 1, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+            AlignmentSpan.Standard as = new AlignmentSpan.Standard(Layout.Alignment.ALIGN_CENTER);
+            ssb.setSpan(as, ssb.length() - 1, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+            ssb.append("\n");
+        } else {
+            int selectionStart = mContentEditText.getSelectionStart();
+            mStyleStart = selectionStart;
+            int selectionEnd = mContentEditText.getSelectionEnd();
+
+            if (selectionStart > selectionEnd) {
+                int temp = selectionEnd;
+                selectionEnd = selectionStart;
+                selectionStart = temp;
+            }
+
+            Editable s = mContentEditText.getText();
+            WPImageSpan is = new WPImageSpan(getActivity(), resizedBitmap, imageUri);
+
+            MediaUtils.setWPImageSpanWidth(getActivity(), imageUri, is);
+
+            is.setTitle((String) mediaData.get("title"));
+            is.setImageSource(imageUri);
+            if (imageUri.getEncodedPath().contains("video")) {
+                is.setVideo(true);
+            }
+
+            int line = 0, column = 0;
+            try {
+                line = mContentEditText.getLayout().getLineForOffset(selectionStart);
+                column = mContentEditText.getSelectionStart() - mContentEditText.getLayout().getLineStart(line);
+            } catch (Exception ex) {
+            }
+
+            WPImageSpan[] image_spans = s.getSpans(selectionStart, selectionEnd, WPImageSpan.class);
+            if (image_spans.length != 0) {
+                // insert a few line breaks if the cursor is already on an image
+                s.insert(selectionEnd, "\n\n");
+                selectionStart = selectionStart + 2;
+                selectionEnd = selectionEnd + 2;
+            } else if (column != 0) {
+                // insert one line break if the cursor is not at the first column
+                s.insert(selectionEnd, "\n");
+                selectionStart = selectionStart + 1;
+                selectionEnd = selectionEnd + 1;
+            }
+
+            s.insert(selectionStart, " ");
+            s.setSpan(is, selectionStart, selectionEnd + 1, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+            AlignmentSpan.Standard as = new AlignmentSpan.Standard(Layout.Alignment.ALIGN_CENTER);
+            s.setSpan(as, selectionStart, selectionEnd + 1, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+            s.insert(selectionEnd + 1, "\n\n");
+            try {
+                mContentEditText.setSelection(s.length());
+            } catch (Exception e) {
+                e.printStackTrace();
+            }
+        }
+        return true;
+    }
+
+    /**
+     * Formatting bar
+     */
+
+    private View.OnClickListener mFormatBarButtonClickListener = new View.OnClickListener() {
+        @Override
+        public void onClick(View v) {
+            int id = v.getId();
+            if (id == R.id.bold) {
+                formatBtnClick(mBoldToggleButton, "strong");
+            } else if (id == R.id.em) {
+                formatBtnClick(mEmToggleButton, "em");
+            } else if (id == R.id.underline) {
+                formatBtnClick(mUnderlineToggleButton, "u");
+            } else if (id == R.id.strike) {
+                formatBtnClick(mStrikeToggleButton, "strike");
+            } else if (id == R.id.bquote) {
+                formatBtnClick(mBquoteToggleButton, "blockquote");
+            } else if (id == R.id.more) {
+                mSelectionEnd = mContentEditText.getSelectionEnd();
+                Editable str = mContentEditText.getText();
+                str.insert(mSelectionEnd, "\n<!--more-->\n");
+            } else if (id == R.id.link) {
+                mSelectionStart = mContentEditText.getSelectionStart();
+                mStyleStart = mSelectionStart;
+                mSelectionEnd = mContentEditText.getSelectionEnd();
+                if (mSelectionStart > mSelectionEnd) {
+                    int temp = mSelectionEnd;
+                    mSelectionEnd = mSelectionStart;
+                    mSelectionStart = temp;
+                }
+                Intent i = new Intent(getActivity(), EditLinkActivity.class);
+                if (mSelectionEnd > mSelectionStart) {
+                    String selectedText = mContentEditText.getText().subSequence(mSelectionStart, mSelectionEnd).toString();
+                    i.putExtra("selectedText", selectedText);
+                }
+                startActivityForResult(i, ACTIVITY_REQUEST_CODE_CREATE_LINK);
+            } else if (id == R.id.addPictureButton) {
+                mAddPictureButton.performLongClick();
+            } else if (id == R.id.post) {
+                // TODO: uploading happens from new activity
+                /*if (mAutoSaveHandler != null)
+                    mAutoSaveHandler.removeCallbacks(autoSaveRunnable);
+                if (savePost(false, false)) {
+                    if (mPost.isUploaded() || !mPost.getPost_status().equals("localdraft")) {
+                        if (mQuickMediaType >= 0) {
+                            if (mQuickMediaType == Constants.QUICK_POST_PHOTO_CAMERA || mQuickMediaType == Constants.QUICK_POST_PHOTO_LIBRARY)
+                                mPost.setQuickPostType("QuickPhoto");
+                            else if (mQuickMediaType == Constants.QUICK_POST_VIDEO_CAMERA || mQuickMediaType == Constants.QUICK_POST_VIDEO_LIBRARY)
+                                mPost.setQuickPostType("QuickVideo");
+                        }
+
+                        WordPress.currentPost = mPost;
+                        PostUploadService.addPostToUpload(mPost);
+                        startService(new Intent(this, PostUploadService.class));
+                    }
+                    getActivity().finish();*/
+                }
+            }
+    };
+
+    private void formatBtnClick(ToggleButton toggleButton, String tag) {
+        try {
+            Spannable s = mContentEditText.getText();
+            int selectionStart = mContentEditText.getSelectionStart();
+            mStyleStart = selectionStart;
+            int selectionEnd = mContentEditText.getSelectionEnd();
+
+            if (selectionStart > selectionEnd) {
+                int temp = selectionEnd;
+                selectionEnd = selectionStart;
+                selectionStart = temp;
+            }
+
+            if (mPost.isLocalDraft()) {
+                if (selectionEnd > selectionStart) {
+                    Spannable str = mContentEditText.getText();
+                    if (tag.equals("strong")) {
+                        StyleSpan[] ss = str.getSpans(selectionStart, selectionEnd, StyleSpan.class);
+
+                        boolean exists = false;
+                        for (int i = 0; i < ss.length; i++) {
+                            int style = ((StyleSpan) ss[i]).getStyle();
+                            if (style == android.graphics.Typeface.BOLD) {
+                                str.removeSpan(ss[i]);
+                                exists = true;
+                            }
+                        }
+
+                        if (!exists) {
+                            str.setSpan(new StyleSpan(android.graphics.Typeface.BOLD), selectionStart, selectionEnd,
+                                    Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+                        toggleButton.setChecked(false);
+                    } else if (tag.equals("em")) {
+                        StyleSpan[] ss = str.getSpans(selectionStart, selectionEnd, StyleSpan.class);
+
+                        boolean exists = false;
+                        for (int i = 0; i < ss.length; i++) {
+                            int style = ((StyleSpan) ss[i]).getStyle();
+                            if (style == android.graphics.Typeface.ITALIC) {
+                                str.removeSpan(ss[i]);
+                                exists = true;
+                            }
+                        }
+
+                        if (!exists) {
+                            str.setSpan(new StyleSpan(android.graphics.Typeface.ITALIC), selectionStart, selectionEnd,
+                                    Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+                        toggleButton.setChecked(false);
+                    } else if (tag.equals("u")) {
+
+                        WPUnderlineSpan[] ss = str.getSpans(selectionStart, selectionEnd, WPUnderlineSpan.class);
+
+                        boolean exists = false;
+                        for (int i = 0; i < ss.length; i++) {
+                            str.removeSpan(ss[i]);
+                            exists = true;
+                        }
+
+                        if (!exists) {
+                            str.setSpan(new WPUnderlineSpan(), selectionStart, selectionEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+
+                        toggleButton.setChecked(false);
+                    } else if (tag.equals("strike")) {
+
+                        StrikethroughSpan[] ss = str.getSpans(selectionStart, selectionEnd, StrikethroughSpan.class);
+
+                        boolean exists = false;
+                        for (int i = 0; i < ss.length; i++) {
+                            str.removeSpan(ss[i]);
+                            exists = true;
+                        }
+
+                        if (!exists) {
+                            str.setSpan(new StrikethroughSpan(), selectionStart, selectionEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+
+                        toggleButton.setChecked(false);
+                    } else if (tag.equals("blockquote")) {
+
+                        QuoteSpan[] ss = str.getSpans(selectionStart, selectionEnd, QuoteSpan.class);
+
+                        boolean exists = false;
+                        for (int i = 0; i < ss.length; i++) {
+                            str.removeSpan(ss[i]);
+                            exists = true;
+                        }
+
+                        if (!exists) {
+                            str.setSpan(new QuoteSpan(), selectionStart, selectionEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+
+                        toggleButton.setChecked(false);
+                    }
+                } else if (!toggleButton.isChecked()) {
+
+                    if (tag.equals("strong") || tag.equals("em")) {
+
+                        StyleSpan[] ss = s.getSpans(mStyleStart - 1, mStyleStart, StyleSpan.class);
+
+                        for (int i = 0; i < ss.length; i++) {
+                            int tagStart = s.getSpanStart(ss[i]);
+                            int tagEnd = s.getSpanEnd(ss[i]);
+                            if (ss[i].getStyle() == android.graphics.Typeface.BOLD && tag.equals("strong")) {
+                                tagStart = s.getSpanStart(ss[i]);
+                                tagEnd = s.getSpanEnd(ss[i]);
+                                s.removeSpan(ss[i]);
+                                s.setSpan(new StyleSpan(android.graphics.Typeface.BOLD), tagStart, tagEnd,
+                                        Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                            }
+                            if (ss[i].getStyle() == android.graphics.Typeface.ITALIC && tag.equals("em")) {
+                                tagStart = s.getSpanStart(ss[i]);
+                                tagEnd = s.getSpanEnd(ss[i]);
+                                s.removeSpan(ss[i]);
+                                s.setSpan(new StyleSpan(android.graphics.Typeface.ITALIC), tagStart, tagEnd,
+                                        Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                            }
+                        }
+                    } else if (tag.equals("u")) {
+                        WPUnderlineSpan[] us = s.getSpans(mStyleStart - 1, mStyleStart, WPUnderlineSpan.class);
+                        for (int i = 0; i < us.length; i++) {
+                            int tagStart = s.getSpanStart(us[i]);
+                            int tagEnd = s.getSpanEnd(us[i]);
+                            s.removeSpan(us[i]);
+                            s.setSpan(new WPUnderlineSpan(), tagStart, tagEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+                    } else if (tag.equals("strike")) {
+                        StrikethroughSpan[] ss = s.getSpans(mStyleStart - 1, mStyleStart, StrikethroughSpan.class);
+                        for (int i = 0; i < ss.length; i++) {
+                            int tagStart = s.getSpanStart(ss[i]);
+                            int tagEnd = s.getSpanEnd(ss[i]);
+                            s.removeSpan(ss[i]);
+                            s.setSpan(new StrikethroughSpan(), tagStart, tagEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+                    } else if (tag.equals("blockquote")) {
+                        QuoteSpan[] ss = s.getSpans(mStyleStart - 1, mStyleStart, QuoteSpan.class);
+                        for (int i = 0; i < ss.length; i++) {
+                            int tagStart = s.getSpanStart(ss[i]);
+                            int tagEnd = s.getSpanEnd(ss[i]);
+                            s.removeSpan(ss[i]);
+                            s.setSpan(new QuoteSpan(), tagStart, tagEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
+                        }
+                    }
+                }
+            } else {
+                String startTag = "<" + tag + ">";
+                String endTag = "</" + tag + ">";
+                Editable content = mContentEditText.getText();
+                if (selectionEnd > selectionStart) {
+                    content.insert(selectionStart, startTag);
+                    content.insert(selectionEnd + startTag.length(), endTag);
+                    toggleButton.setChecked(false);
+                    mContentEditText.setSelection(selectionEnd + startTag.length() + endTag.length());
+                } else if (toggleButton.isChecked()) {
+                    content.insert(selectionStart, startTag);
+                    mContentEditText.setSelection(selectionEnd + startTag.length());
+                } else if (!toggleButton.isChecked()) {
+                    content.insert(selectionEnd, endTag);
+                    mContentEditText.setSelection(selectionEnd + endTag.length());
+                }
+            }
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+    }
+
+    /**
+     * Rich Text Editor
+     */
+
+    @Override
+    public boolean onTouch(View v, MotionEvent event) {
+        float pos = event.getY();
+
+        if (event.getAction() == 0)
+            mLastYPos = pos;
+
+        if (event.getAction() > 1) {
+            if (((mLastYPos - pos) > 2.0f) || ((pos - mLastYPos) > 2.0f))
+                mScrollDetected = true;
+        }
+
+        mLastYPos = pos;
+
+        if (event.getAction() == 1 && !mScrollDetected) {
+            Layout layout = ((TextView) v).getLayout();
+            int x = (int) event.getX();
+            int y = (int) event.getY();
+
+            x += v.getScrollX();
+            y += v.getScrollY();
+            if (layout != null) {
+                int line = layout.getLineForVertical(y);
+                int charPosition = layout.getOffsetForHorizontal(line, x);
+
+                final Spannable s = mContentEditText.getText();
+                // check if image span was tapped
+                WPImageSpan[] image_spans = s.getSpans(charPosition, charPosition, WPImageSpan.class);
+
+                if (image_spans.length != 0) {
+                    final WPImageSpan span = image_spans[0];
+                    if (!span.isVideo()) {
+                        LayoutInflater factory = LayoutInflater.from(getActivity());
+                        final View alertView = factory.inflate(R.layout.alert_image_options, null);
+                        final EditText imageWidthText = (EditText) alertView.findViewById(R.id.imageWidthText);
+                        final EditText titleText = (EditText) alertView.findViewById(R.id.title);
+                        // final EditText descText = (EditText)
+                        // alertView.findViewById(R.id.description);
+                        final EditText caption = (EditText) alertView.findViewById(R.id.caption);
+                        final CheckBox featuredCheckBox = (CheckBox) alertView.findViewById(R.id.featuredImage);
+                        final CheckBox featuredInPostCheckBox = (CheckBox) alertView.findViewById(R.id.featuredInPost);
+
+                        // show featured image checkboxes if theme support it
+                        if (WordPress.getCurrentBlog().isFeaturedImageCapable()) {
+                            featuredCheckBox.setVisibility(View.VISIBLE);
+                            featuredInPostCheckBox.setVisibility(View.VISIBLE);
+                        }
+
+                        featuredCheckBox.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
+                            @Override
+                            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
+                                if (isChecked) {
+                                    featuredInPostCheckBox.setVisibility(View.VISIBLE);
+                                } else {
+                                    featuredInPostCheckBox.setVisibility(View.GONE);
+                                }
+
+                            }
+                        });
+
+                        final SeekBar seekBar = (SeekBar) alertView.findViewById(R.id.imageWidth);
+                        final Spinner alignmentSpinner = (Spinner) alertView.findViewById(R.id.alignment_spinner);
+                        ArrayAdapter<CharSequence> adapter = ArrayAdapter.createFromResource(getActivity(), R.array.alignment_array,
+                                android.R.layout.simple_spinner_item);
+                        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
+                        alignmentSpinner.setAdapter(adapter);
+
+                        imageWidthText.setText(String.valueOf(span.getWidth()) + "px");
+                        seekBar.setProgress(span.getWidth());
+                        titleText.setText(span.getTitle());
+                        // descText.setText(span.getDescription());
+                        caption.setText(span.getCaption());
+                        featuredCheckBox.setChecked(span.isFeatured());
+
+                        if (span.isFeatured())
+                            featuredInPostCheckBox.setVisibility(View.VISIBLE);
+                        else
+                            featuredInPostCheckBox.setVisibility(View.GONE);
+
+                        featuredInPostCheckBox.setChecked(span.isFeaturedInPost());
+
+                        alignmentSpinner.setSelection(span.getHorizontalAlignment(), true);
+
+                        final int maxWidth = MediaUtils.getMinimumImageWitdh(getActivity(), span.getImageSource());
+                        seekBar.setMax(maxWidth / 10);
+                        if (span.getWidth() != 0)
+                            seekBar.setProgress(span.getWidth() / 10);
+                        seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
+
+                            @Override
+                            public void onStopTrackingTouch(SeekBar seekBar) {
+                            }
+
+                            @Override
+                            public void onStartTrackingTouch(SeekBar seekBar) {
+                            }
+
+                            @Override
+                            public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
+                                if (progress == 0)
+                                    progress = 1;
+                                imageWidthText.setText(progress * 10 + "px");
+                            }
+                        });
+
+                        imageWidthText.setOnFocusChangeListener(new View.OnFocusChangeListener() {
+                            @Override
+                            public void onFocusChange(View v, boolean hasFocus) {
+                                if (hasFocus) {
+                                    imageWidthText.setText("");
+                                }
+                            }
+                        });
+
+                        imageWidthText.setOnEditorActionListener(new TextView.OnEditorActionListener() {
+                            @Override
+                            public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
+                                int width = getEditTextIntegerClamped(imageWidthText, 10, maxWidth);
+                                seekBar.setProgress(width / 10);
+                                imageWidthText.setSelection((String.valueOf(width).length()));
+
+                                InputMethodManager imm = (InputMethodManager) getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);
+                                imm.hideSoftInputFromWindow(imageWidthText.getWindowToken(),
+                                        InputMethodManager.RESULT_UNCHANGED_SHOWN);
+
+                                return true;
+                            }
+                        });
+
+                        AlertDialog ad = new AlertDialog.Builder(getActivity()).setTitle(getString(R.string.image_settings))
+                                .setView(alertView).setPositiveButton(getString(R.string.ok), new DialogInterface.OnClickListener() {
+                                    public void onClick(DialogInterface dialog, int whichButton) {
+
+                                        span.setTitle(titleText.getText().toString());
+                                        // span.setDescription(descText.getText().toString());
+                                        span.setHorizontalAlignment(alignmentSpinner.getSelectedItemPosition());
+                                        span.setWidth(getEditTextIntegerClamped(imageWidthText, 10, maxWidth));
+                                        span.setCaption(caption.getText().toString());
+                                        span.setFeatured(featuredCheckBox.isChecked());
+                                        if (featuredCheckBox.isChecked()) {
+                                            // remove featured flag from all
+                                            // other images
+                                            WPImageSpan[] click_spans = s.getSpans(0, s.length(), WPImageSpan.class);
+                                            if (click_spans.length > 1) {
+                                                for (int i = 0; i < click_spans.length; i++) {
+                                                    WPImageSpan verifySpan = click_spans[i];
+                                                    if (verifySpan != span) {
+                                                        verifySpan.setFeatured(false);
+                                                        verifySpan.setFeaturedInPost(false);
+                                                    }
+                                                }
+                                            }
+                                        }
+                                        span.setFeaturedInPost(featuredInPostCheckBox.isChecked());
+                                    }
+                                }).setNegativeButton(getString(R.string.cancel), new DialogInterface.OnClickListener() {
+                                    public void onClick(DialogInterface dialog, int whichButton) {
+                                        dialog.dismiss();
+                                    }
+                                }).create();
+                        ad.getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_HIDDEN);
+                        ad.show();
+                        mScrollDetected = false;
+                        return true;
+                    }
+
+                } else {
+                    mContentEditText.setMovementMethod(ArrowKeyMovementMethod.getInstance());
+                    int selectionStart = mContentEditText.getSelectionStart();
+                    if (selectionStart >= 0 && mContentEditText.getSelectionEnd() >= selectionStart);
+                    mContentEditText.setSelection(selectionStart, mContentEditText.getSelectionEnd());
+                }
+
+                // get media gallery spans
+
+                MediaGalleryImageSpan[] gallerySpans = s.getSpans(charPosition, charPosition, MediaGalleryImageSpan.class);
+                if (gallerySpans.length > 0) {
+                    final MediaGalleryImageSpan gallerySpan = gallerySpans[0];
+                    startMediaGalleryActivity(gallerySpan.getMediaGallery());
+                }
+
+            }
+        } else if (event.getAction() == 1) {
+            mScrollDetected = false;
+        }
+        return false;
+    }
+
+    @Override
+    public void afterTextChanged(Editable s) {
+
+        try {
+            int position = Selection.getSelectionStart(mContentEditText.getText());
+            if ((mIsBackspace && position != 1) || mLastPosition == position || !mPost.isLocalDraft())
+                return;
+
+            if (position < 0) {
+                position = 0;
+            }
+            mLastPosition = position;
+            if (position > 0) {
+
+                if (mStyleStart > position) {
+                    mStyleStart = position - 1;
+                }
+                boolean exists = false;
+                if (mBoldToggleButton.isChecked()) {
+                    StyleSpan[] ss = s.getSpans(mStyleStart, position, StyleSpan.class);
+                    exists = false;
+                    for (int i = 0; i < ss.length; i++) {
+                        if (ss[i].getStyle() == android.graphics.Typeface.BOLD) {
+                            exists = true;
+                        }
+                    }
+                    if (!exists)
+                        s.setSpan(new StyleSpan(android.graphics.Typeface.BOLD), mStyleStart, position, Spannable.SPAN_INCLUSIVE_INCLUSIVE);
+                }
+                if (mEmToggleButton.isChecked()) {
+                    StyleSpan[] ss = s.getSpans(mStyleStart, position, StyleSpan.class);
+                    exists = false;
+                    for (int i = 0; i < ss.length; i++) {
+                        if (ss[i].getStyle() == android.graphics.Typeface.ITALIC) {
+                            exists = true;
+                        }
+                    }
+                    if (!exists)
+                        s.setSpan(new StyleSpan(android.graphics.Typeface.ITALIC), mStyleStart, position,
+                                Spannable.SPAN_INCLUSIVE_INCLUSIVE);
+                }
+                if (mEmToggleButton.isChecked()) {
+                    StyleSpan[] ss = s.getSpans(mStyleStart, position, StyleSpan.class);
+                    exists = false;
+                    for (int i = 0; i < ss.length; i++) {
+                        if (ss[i].getStyle() == android.graphics.Typeface.ITALIC) {
+                            exists = true;
+                        }
+                    }
+                    if (!exists)
+                        s.setSpan(new StyleSpan(android.graphics.Typeface.ITALIC), mStyleStart, position,
+                                Spannable.SPAN_INCLUSIVE_INCLUSIVE);
+                }
+                if (mUnderlineToggleButton.isChecked()) {
+                    WPUnderlineSpan[] ss = s.getSpans(mStyleStart, position, WPUnderlineSpan.class);
+                    exists = false;
+                    for (int i = 0; i < ss.length; i++) {
+                        exists = true;
+                    }
+                    if (!exists)
+                        s.setSpan(new WPUnderlineSpan(), mStyleStart, position, Spannable.SPAN_INCLUSIVE_INCLUSIVE);
+                }
+                if (mStrikeToggleButton.isChecked()) {
+                    StrikethroughSpan[] ss = s.getSpans(mStyleStart, position, StrikethroughSpan.class);
+                    exists = false;
+                    for (int i = 0; i < ss.length; i++) {
+                        exists = true;
+                    }
+                    if (!exists)
+                        s.setSpan(new StrikethroughSpan(), mStyleStart, position, Spannable.SPAN_INCLUSIVE_INCLUSIVE);
+                }
+                if (mBquoteToggleButton.isChecked()) {
+
+                    QuoteSpan[] ss = s.getSpans(mStyleStart, position, QuoteSpan.class);
+                    exists = false;
+                    for (int i = 0; i < ss.length; i++) {
+                        exists = true;
+                    }
+                    if (!exists)
+                        s.setSpan(new QuoteSpan(), mStyleStart, position, Spannable.SPAN_INCLUSIVE_INCLUSIVE);
+                }
+            }
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+    }
+
+    @Override
+    public void beforeTextChanged(CharSequence s, int start, int count, int after) {
+        if ((count - after == 1) || (s.length() == 0))
+            mIsBackspace = true;
+        else
+            mIsBackspace = false;
+    }
+
+    @Override
+    public void onTextChanged(CharSequence s, int start, int before, int count) {
+    }
+
+    @Override
+    public void onSelectionChanged() {
+        if (!mPost.isLocalDraft())
+            return;
+
+        final Spannable s = mContentEditText.getText();
+        // set toggle buttons if cursor is inside of a matching span
+        mStyleStart = mContentEditText.getSelectionStart();
+        Object[] spans = s.getSpans(mContentEditText.getSelectionStart(), mContentEditText.getSelectionStart(), Object.class);
+
+        mBoldToggleButton.setChecked(false);
+        mEmToggleButton.setChecked(false);
+        mBquoteToggleButton.setChecked(false);
+        mUnderlineToggleButton.setChecked(false);
+        mStrikeToggleButton.setChecked(false);
+        for (Object span : spans) {
+            if (span instanceof StyleSpan) {
+                StyleSpan ss = (StyleSpan) span;
+                if (ss.getStyle() == android.graphics.Typeface.BOLD) {
+                    mBoldToggleButton.setChecked(true);
+                }
+                if (ss.getStyle() == android.graphics.Typeface.ITALIC) {
+                    mEmToggleButton.setChecked(true);
+                }
+            }
+            if (span instanceof QuoteSpan) {
+                mBquoteToggleButton.setChecked(true);
+            }
+            if (span instanceof WPUnderlineSpan) {
+                mUnderlineToggleButton.setChecked(true);
+            }
+            if (span instanceof StrikethroughSpan) {
+                mStrikeToggleButton.setChecked(true);
+            }
+        }
+    }
+
+    private int getEditTextIntegerClamped(EditText editText, int min, int max) {
+        int width = 10;
+        try {
+            width = Integer.parseInt(editText.getText().toString().replace("px", ""));
+        } catch (NumberFormatException e) {
+        }
+        width = Math.min(max, Math.max(width, min));
+        return width;
+    }
+}
diff --git a/src/org/wordpress/android/ui/posts/EditPostSettingsFragment.java b/src/org/wordpress/android/ui/posts/EditPostSettingsFragment.java
new file mode 100644
index 000000000000..de266613b9bf
--- /dev/null
+++ b/src/org/wordpress/android/ui/posts/EditPostSettingsFragment.java
@@ -0,0 +1,658 @@
+package org.wordpress.android.ui.posts;
+
+import android.app.Activity;
+import android.app.DatePickerDialog;
+import android.app.TimePickerDialog;
+import android.content.Intent;
+import android.location.Address;
+import android.location.Geocoder;
+import android.location.Location;
+import android.location.LocationManager;
+import android.net.Uri;
+import android.os.AsyncTask;
+import android.os.Bundle;
+import android.text.Html;
+import android.text.format.DateUtils;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.view.animation.Animation;
+import android.view.animation.AnimationUtils;
+import android.widget.ArrayAdapter;
+import android.widget.Button;
+import android.widget.DatePicker;
+import android.widget.EditText;
+import android.widget.Spinner;
+import android.widget.TextView;
+import android.widget.TimePicker;
+import android.widget.Toast;
+
+import com.actionbarsherlock.app.SherlockFragment;
+import com.google.gson.Gson;
+import com.google.gson.reflect.TypeToken;
+
+import org.apache.commons.lang.StringEscapeUtils;
+import org.json.JSONArray;
+import org.wordpress.android.R;
+import org.wordpress.android.models.Post;
+import org.wordpress.android.ui.media.MediaUtils;
+import org.wordpress.android.util.JSONUtil;
+import org.wordpress.android.util.LocationHelper;
+import org.xmlrpc.android.ApiHelper;
+
+import java.io.IOException;
+import java.lang.reflect.Type;
+import java.util.ArrayList;
+import java.util.Calendar;
+import java.util.Date;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Locale;
+import java.util.Map;
+import java.util.Vector;
+
+/**
+ * Created by dan on 11/20/13.
+ */
+public class EditPostSettingsFragment extends SherlockFragment implements View.OnClickListener {
+
+    private static final int ACTIVITY_REQUEST_CODE_SELECT_CATEGORIES = 5;
+
+    private static final String CATEGORY_PREFIX_TAG = "category-";
+
+    private Post mPost;
+
+    private NewEditPostActivity mActivity;
+
+
+    private Spinner mStatusSpinner;
+    private EditText mPasswordEditText, mTagsEditText, mExcerptEditText;
+    private TextView mLocationText, mPubDateText;
+    private Button mPubDateButton;
+    private ViewGroup mSectionCategories;
+
+    private ArrayList<String> mCategories;
+
+    private Location mCurrentLocation;
+    private LocationHelper mLocationHelper;
+
+    private int mYear, mMonth, mDay, mHour, mMinute;
+    private long mCustomPubDate = 0;
+    private boolean mIsCustomPubDate;
+
+    private String[] mPostFormats;
+    private String[] mPostFormatTitles;
+
+    private static enum LocationStatus { NONE, FOUND, NOT_FOUND, SEARCHING }
+
+    @Override
+    public void onClick(View v) {
+        int id = v.getId();
+        if (id == R.id.pubDateButton) {
+            DatePickerDialog d = new DatePickerDialog(getActivity(),
+                    R.style.WordPress, mDateSetListener, mYear, mMonth, mDay);
+            d.show();
+        } else if (id == R.id.selectCategories) {
+            Bundle bundle = new Bundle();
+            bundle.putInt("id", mPost.getBlogID());
+            if (mCategories.size() > 0) {
+                bundle.putSerializable("categories", new HashSet<String>(mCategories));
+            }
+            Intent categoriesIntent = new Intent(getActivity(), SelectCategoriesActivity.class);
+            categoriesIntent.putExtras(bundle);
+            startActivityForResult(categoriesIntent, ACTIVITY_REQUEST_CODE_SELECT_CATEGORIES);
+        } else if (id == R.id.categoryButton) {
+            onCategoryButtonClick(v);
+        } else if (id == R.id.viewMap) {
+            Double latitude = 0.0;
+            try {
+                latitude = mCurrentLocation.getLatitude();
+            } catch (Exception e) {
+                e.printStackTrace();
+            }
+            if (latitude != 0.0) {
+                String uri = "geo:" + latitude + "," + mCurrentLocation.getLongitude();
+                startActivity(new Intent(android.content.Intent.ACTION_VIEW, Uri.parse(uri)));
+            } else {
+                Toast.makeText(getActivity(), getResources().getText(R.string.location_toast), Toast.LENGTH_SHORT).show();
+            }
+        } else if (id == R.id.updateLocation) {
+            getLocation();
+        } else if (id == R.id.removeLocation) {
+            removeLocation();
+        }
+    }
+
+    @Override
+    public View onCreateView(LayoutInflater inflater, ViewGroup container,
+                             Bundle savedInstanceState) {
+
+        Calendar c = Calendar.getInstance();
+        mYear = c.get(Calendar.YEAR);
+        mMonth = c.get(Calendar.MONTH);
+        mDay = c.get(Calendar.DAY_OF_MONTH);
+        mHour = c.get(Calendar.HOUR_OF_DAY);
+        mMinute = c.get(Calendar.MINUTE);
+        mCategories = new ArrayList<String>();
+
+        ViewGroup rootView = (ViewGroup) inflater
+                .inflate(R.layout.fragment_edit_post_settings, container, false);
+
+        mActivity = (NewEditPostActivity) getActivity();
+
+        mExcerptEditText = (EditText) rootView.findViewById(R.id.postExcerpt);
+        mPasswordEditText = (EditText) rootView.findViewById(R.id.post_password);
+        mLocationText = (TextView) rootView.findViewById(R.id.locationText);
+        mPubDateButton = (Button) rootView.findViewById(R.id.pubDateButton);
+        mPubDateText = (TextView) rootView.findViewById(R.id.pubDate);
+        mStatusSpinner = (Spinner) rootView.findViewById(R.id.status);
+        mTagsEditText = (EditText) rootView.findViewById(R.id.tags);
+        mSectionCategories = ((ViewGroup) rootView.findViewById(R.id.sectionCategories));
+
+        mPubDateButton.setOnClickListener(this);
+
+        // Set header labels to upper case
+        ((TextView) rootView.findViewById(R.id.categoryLabel)).setText(getResources().getString(R.string.categories).toUpperCase());
+        ((TextView) rootView.findViewById(R.id.statusLabel)).setText(getResources().getString(R.string.status).toUpperCase());
+        ((TextView) rootView.findViewById(R.id.postFormatLabel)).setText(getResources().getString(R.string.post_format).toUpperCase());
+        ((TextView) rootView.findViewById(R.id.pubDateLabel)).setText(getResources().getString(R.string.publish_date).toUpperCase());
+
+        if (mActivity.getPost().isPage()) { // remove post specific views
+            mExcerptEditText.setVisibility(View.GONE);
+            (rootView.findViewById(R.id.sectionTags)).setVisibility(View.GONE);
+            (rootView.findViewById(R.id.sectionCategories)).setVisibility(View.GONE);
+            (rootView.findViewById(R.id.sectionLocation)).setVisibility(View.GONE);
+            (rootView.findViewById(R.id.postFormatLabel)).setVisibility(View.GONE);
+            (rootView.findViewById(R.id.postFormat)).setVisibility(View.GONE);
+        } else {
+            if (mActivity.getPost().getBlog().getPostFormats().equals("")) {
+                List<Object> args = new Vector<Object>();
+                args.add(mActivity.getPost().getBlog());
+                args.add(this);
+                new ApiHelper.getPostFormatsTask().execute(args);
+                mPostFormatTitles = getResources().getStringArray(R.array.post_formats_array);
+                String defaultPostFormatTitles[] = {"aside", "audio", "chat", "gallery", "image", "link", "quote", "standard", "status", "video"};
+                mPostFormats = defaultPostFormatTitles;
+            } else {
+                try {
+                    Gson gson = new Gson();
+                    Type type = new TypeToken<Map<String, String>>() {
+                    }.getType();
+                    Map<String, String> jsonPostFormats = gson.fromJson(mActivity.getPost().getBlog().getPostFormats(), type);
+                    mPostFormats = new String[jsonPostFormats.size()];
+                    mPostFormatTitles = new String[jsonPostFormats.size()];
+                    int i = 0;
+                    for (Map.Entry<String, String> entry : jsonPostFormats.entrySet()) {
+                        String key = entry.getKey();
+                        String val = entry.getValue();
+                        mPostFormats[i] = key;
+                        mPostFormatTitles[i] = StringEscapeUtils.unescapeHtml(val);
+                        i++;
+                    }
+                } catch (Exception e) {
+                    e.printStackTrace();
+                }
+            }
+            Spinner pfSpinner = (Spinner) rootView.findViewById(R.id.postFormat);
+            ArrayAdapter<String> pfAdapter = new ArrayAdapter<String>(getActivity(), android.R.layout.simple_spinner_item, mPostFormatTitles);
+            pfAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
+            pfSpinner.setAdapter(pfAdapter);
+            String activePostFormat = "standard";
+
+
+            if (!mActivity.getPost().getWP_post_format().equals(""))
+                activePostFormat = mActivity.getPost().getWP_post_format();
+            for (int i = 0; i < mPostFormats.length; i++) {
+                if (mPostFormats[i].equals(activePostFormat))
+                    pfSpinner.setSelection(i);
+            }
+        }
+
+        mPost = mActivity.getPost();
+        if (mPost != null) {
+            mExcerptEditText.setText(mPost.getMt_excerpt());
+
+            String[] items = new String[]{getResources().getString(R.string.publish_post), getResources().getString(R.string.draft),
+                    getResources().getString(R.string.pending_review), getResources().getString(R.string.post_private)};
+
+            ArrayAdapter<String> adapter = new ArrayAdapter<String>(getActivity(), android.R.layout.simple_spinner_item, items);
+            adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
+            mStatusSpinner.setAdapter(adapter);
+
+            if (mPost.isUploaded()) {
+                items = new String[]{
+                        getResources().getString(R.string.publish_post),
+                        getResources().getString(R.string.draft),
+                        getResources().getString(R.string.pending_review),
+                        getResources().getString(R.string.post_private)
+                };
+                adapter = new ArrayAdapter<String>(getActivity(), android.R.layout.simple_spinner_item, items);
+                mStatusSpinner.setAdapter(adapter);
+            }
+
+            long pubDate = mPost.getDate_created_gmt();
+            if (pubDate != 0) {
+                try {
+                    int flags = 0;
+                    flags |= android.text.format.DateUtils.FORMAT_SHOW_DATE;
+                    flags |= android.text.format.DateUtils.FORMAT_ABBREV_MONTH;
+                    flags |= android.text.format.DateUtils.FORMAT_SHOW_YEAR;
+                    flags |= android.text.format.DateUtils.FORMAT_SHOW_TIME;
+                    String formattedDate = DateUtils.formatDateTime(getActivity(), pubDate,
+                            flags);
+                    mPubDateText.setText(formattedDate);
+                } catch (Exception e) {
+                    e.printStackTrace();
+                }
+            }
+
+            if (mPost.getWP_password() != null)
+                mPasswordEditText.setText(mPost.getWP_password());
+
+            if (mPost.getPost_status() != null) {
+                String status = mPost.getPost_status();
+
+                if (status.equals("publish")) {
+                    mStatusSpinner.setSelection(0, true);
+                } else if (status.equals("draft")) {
+                    mStatusSpinner.setSelection(1, true);
+                } else if (status.equals("pending")) {
+                    mStatusSpinner.setSelection(2, true);
+                } else if (status.equals("private")) {
+                    mStatusSpinner.setSelection(3, true);
+                } else if (status.equals("localdraft")) {
+                    mStatusSpinner.setSelection(0, true);
+                }
+            }
+
+            if (!mPost.isPage()) {
+                if (mPost.getJSONCategories() != null) {
+                    mCategories = JSONUtil.fromJSONArrayToStringList(mPost.getJSONCategories());
+                }
+
+                Double latitude = mPost.getLatitude();
+                Double longitude = mPost.getLongitude();
+
+                // if this post has location attached to it, look up the location address
+                if (latitude != 0.0) {
+                    setLocationStatus(LocationStatus.SEARCHING);
+                    new GetAddressTask().execute(latitude, longitude);
+                }
+            }
+            String tags = mPost.getMt_keywords();
+            if (!tags.equals("")) {
+                mTagsEditText.setText(tags);
+            }
+
+            populateSelectedCategories();
+        }
+
+        return rootView;
+    }
+
+    @Override
+    public void onActivityResult(int requestCode, int resultCode, Intent data) {
+        super.onActivityResult(requestCode, resultCode, data);
+
+        if (data != null || ((requestCode == MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_PHOTO || requestCode == MediaUtils.RequestCode.ACTIVITY_REQUEST_CODE_TAKE_VIDEO))) {
+            Bundle extras;
+
+            switch (requestCode) {
+                case ACTIVITY_REQUEST_CODE_SELECT_CATEGORIES:
+                    extras = data.getExtras();
+                    mCategories = (ArrayList<String>) extras.getSerializable("selectedCategories");
+                    populateSelectedCategories();
+                    break;
+            }
+        }
+    }
+
+    public void savePostSettings(boolean isAutoSave) {
+        if (mPost == null)
+            return;
+
+        String password = mPasswordEditText.getText().toString();
+        String pubDate = mPubDateText.getText().toString();
+        String excerpt = mExcerptEditText.getText().toString();
+
+        long pubDateTimestamp = 0;
+        if (!pubDate.equals(getResources().getText(R.string.immediately))) {
+            if (mIsCustomPubDate)
+                pubDateTimestamp = mCustomPubDate;
+            else if (mPost.getDate_created_gmt() > 0)
+                pubDateTimestamp = mPost.getDate_created_gmt();
+        }
+
+        String tags = "", postFormat = "";
+        if (!mPost.isPage()) {
+            tags = mTagsEditText.getText().toString();
+            // post format
+            Spinner postFormatSpinner = (Spinner) getActivity().findViewById(R.id.postFormat);
+            postFormat = mPostFormats[postFormatSpinner.getSelectedItemPosition()];
+        }
+
+        int selectedStatus = mStatusSpinner.getSelectedItemPosition();
+        String status = "";
+
+        switch (selectedStatus) {
+            case 0:
+                status = "publish";
+                break;
+            case 1:
+                status = "draft";
+                break;
+            case 2:
+                status = "pending";
+                break;
+            case 3:
+                status = "private";
+                break;
+        }
+
+        Double latitude = 0.0;
+        Double longitude = 0.0;
+        if (mPost.getBlog().isLocation()) {
+            try {
+                latitude = mCurrentLocation.getLatitude();
+                longitude = mCurrentLocation.getLongitude();
+            } catch (Exception e) {
+                e.printStackTrace();
+            }
+        }
+
+        if (mCurrentLocation == null) {
+            latitude = mPost.getLatitude();
+            longitude = mPost.getLongitude();
+        }
+
+        mPost.setMt_excerpt(excerpt);
+        mPost.setDate_created_gmt(pubDateTimestamp);
+        mPost.setJSONCategories(new JSONArray(mCategories));
+        mPost.setMt_keywords(tags);
+        mPost.setPost_status(status);
+        mPost.setWP_password(password);
+        mPost.setLatitude(latitude);
+        mPost.setLongitude(longitude);
+        mPost.setWP_post_form(postFormat);
+        mPost.update();
+    }
+
+    /**
+     * Location methods
+     */
+
+    /*
+     * retrieves and displays the friendly address for a lat/long location
+     */
+    private class GetAddressTask extends AsyncTask<Double, Void, String> {
+        double latitude;
+        double longitude;
+
+        @Override
+        protected String doInBackground(Double... args) {
+            // args will be the latitude, longitude to look up
+            latitude = args[0];
+            longitude = args[1];
+
+            // first make sure a Geocoder service exists on this device (requires API 9)
+            if (!Geocoder.isPresent())
+                return null;
+
+            Geocoder gcd = new Geocoder(getActivity(), Locale.getDefault());
+            List<Address> addresses;
+            try {
+                addresses = gcd.getFromLocation(latitude, longitude, 1);
+
+                // addresses may be null or empty if network isn't connected
+                if (addresses==null || addresses.size()==0)
+                    return null;
+
+                String locality = "", adminArea = "", country = "";
+                if (addresses.get(0).getLocality() != null)
+                    locality = addresses.get(0).getLocality();
+                if (addresses.get(0).getAdminArea() != null)
+                    adminArea = addresses.get(0).getAdminArea();
+                if (addresses.get(0).getCountryName() != null)
+                    country = addresses.get(0).getCountryName();
+
+                return ((locality.equals("")) ? locality : locality + ", ")
+                        + ((adminArea.equals("")) ? adminArea : adminArea + " ") + country;
+            } catch (IOException e) {
+                // may get "Unable to parse response from server" IOException here if Geocoder
+                // service is hit too frequently
+                e.printStackTrace();
+                return null;
+            }
+        }
+
+        protected void onPostExecute(String result) {
+            setLocationStatus(LocationStatus.FOUND);
+            if (result==null || result.isEmpty()) {
+                // show lat/long when Geocoder fails (ugly, but better than not showing anything
+                // or showing an error since the location has been assigned to the post already)
+                mLocationText.setText(Double.toString(latitude) + ", " + Double.toString(longitude));
+            } else {
+                mLocationText.setText(result);
+            }
+        }
+    }
+
+    private LocationHelper.LocationResult locationResult = new LocationHelper.LocationResult() {
+        @Override
+        public void gotLocation(final Location location) {
+            // note that location will be null when requesting location fails
+            getActivity().runOnUiThread(new Runnable() {
+                public void run() {
+                    setLocation(location);
+                }
+            });
+        }
+    };
+
+    /*
+     * called when activity is created to initialize the location provider, show views related
+     * to location if enabled for this blog, and retrieve the current location if necessary
+     */
+    private void initLocation() {
+        boolean hasLocationProvider = false;
+        LocationManager locationManager = (LocationManager) getActivity().getSystemService(Activity.LOCATION_SERVICE);
+        List<String> providers = locationManager.getProviders(true);
+        if (providers != null) {
+            for (String providerName : providers) {
+                if (providerName.equals(LocationManager.GPS_PROVIDER) || providerName.equals(LocationManager.NETWORK_PROVIDER)) {
+                    hasLocationProvider = true;
+                }
+            }
+        }
+
+        // show the location views if a provider was found and this is a post on a blog that has location enabled
+        if (hasLocationProvider && mPost.getBlog().isLocation() && !mPost.isPage()) {
+            getActivity().findViewById(R.id.sectionLocation).setVisibility(View.VISIBLE);
+            Button viewMap = (Button) getActivity().findViewById(R.id.viewMap);
+            Button updateLocation = (Button) getActivity().findViewById(R.id.updateLocation);
+            Button removeLocation = (Button) getActivity().findViewById(R.id.removeLocation);
+            updateLocation.setOnClickListener(this);
+            removeLocation.setOnClickListener(this);
+            viewMap.setOnClickListener(this);
+
+            // if this is a new post, get the user's current location
+            if (mPost.isNew()) {
+                // TODO this is broken now
+                getLocation();
+            }
+        }
+    }
+
+    /*
+     * get the current location
+     */
+    private void getLocation() {
+        if (mLocationHelper==null)
+            mLocationHelper = new LocationHelper();
+        boolean canGetLocation = mLocationHelper.getLocation(getActivity(), locationResult);
+        if (canGetLocation) {
+            setLocationStatus(LocationStatus.SEARCHING);
+            mLocationText.setText(getString(R.string.loading));
+        } else {
+            setLocation(null);
+        }
+    }
+
+    /*
+     * called when location is retrieved/updated for this post - looks up the address to
+     * display for the lat/long
+     */
+    private void setLocation(Location location) {
+        if (location != null) {
+            mCurrentLocation = location;
+            new GetAddressTask().execute(mCurrentLocation.getLatitude(), mCurrentLocation.getLongitude());
+        } else {
+            mLocationText.setText(getString(R.string.location_not_found));
+            setLocationStatus(LocationStatus.NOT_FOUND);
+        }
+    }
+
+    private void removeLocation() {
+        if (mCurrentLocation != null) {
+            mCurrentLocation.setLatitude(0.0);
+            mCurrentLocation.setLongitude(0.0);
+        }
+        if (mPost != null) {
+            mPost.setLatitude(0.0);
+            mPost.setLongitude(0.0);
+        }
+        mLocationText.setText("");
+        setLocationStatus(LocationStatus.NONE);
+    }
+
+    /*
+     * changes the left drawable on the location text to match the passed status
+     */
+    private void setLocationStatus(LocationStatus status) {
+        // animate location text when searching
+        if (status==LocationStatus.SEARCHING) {
+            Animation aniBlink = AnimationUtils.loadAnimation(getActivity(), R.anim.blink);
+            mLocationText.startAnimation(aniBlink);
+        } else {
+            mLocationText.clearAnimation();
+        }
+
+        final int drawableId;
+        switch (status) {
+            case FOUND:
+                drawableId = R.drawable.ic_action_location_found;
+                break;
+            case NOT_FOUND:
+                drawableId = R.drawable.ic_action_location_off;
+                break;
+            case SEARCHING:
+                drawableId = R.drawable.ic_action_location_searching;
+                break;
+            case NONE :
+                drawableId = 0;
+                break;
+            default :
+                return;
+        }
+
+        mLocationText.setCompoundDrawablesWithIntrinsicBounds(drawableId, 0, 0, 0);
+    }
+
+    /**
+     * Categories
+     */
+
+    private void onCategoryButtonClick(View v) {
+        // Get category name by removing prefix from the tag
+        boolean listChanged = false;
+        String categoryName = (String) v.getTag();
+        categoryName = categoryName.replaceFirst(CATEGORY_PREFIX_TAG, "");
+
+        // Remove clicked category from list
+        for (int i = 0; i < mCategories.size(); i++) {
+            if (mCategories.get(i).equals(categoryName)) {
+                mCategories.remove(i);
+                listChanged = true;
+                break;
+            }
+        }
+
+        // Recreate category views
+        if (listChanged) {
+            populateSelectedCategories();
+        }
+    }
+
+    private void populateSelectedCategories() {
+        // Remove previous category buttons if any + select category button
+        List<View> viewsToRemove = new ArrayList<View>();
+        for (int i = 0; i < mSectionCategories.getChildCount(); i++) {
+            View v = mSectionCategories.getChildAt(i);
+            Object tag = v.getTag();
+            if (tag != null && tag.getClass() == String.class &&
+                    (((String) tag).startsWith(CATEGORY_PREFIX_TAG) || tag.equals("select-category"))) {
+                viewsToRemove.add(v);
+            }
+        }
+        for (int i = 0; i < viewsToRemove.size(); i++) {
+            mSectionCategories.removeView(viewsToRemove.get(i));
+        }
+        viewsToRemove.clear();
+
+        // New category buttons
+        LayoutInflater layoutInflater = getActivity().getLayoutInflater();
+        for (int i = 0; i < mCategories.size(); i++) {
+            String categoryName = mCategories.get(i);
+            Button buttonCategory = (Button) layoutInflater.inflate(R.layout.category_button, null);
+            buttonCategory.setText(Html.fromHtml(categoryName));
+            buttonCategory.setTag(CATEGORY_PREFIX_TAG + categoryName);
+            buttonCategory.setOnClickListener(this);
+            mSectionCategories.addView(buttonCategory);
+        }
+
+        // Add select category button
+        Button selectCategory = (Button) layoutInflater.inflate(R.layout.category_select_button, null);
+        selectCategory.setOnClickListener(this);
+        mSectionCategories.addView(selectCategory);
+    }
+
+    /**
+     * Date/Time
+     */
+
+    private DatePickerDialog.OnDateSetListener mDateSetListener = new DatePickerDialog.OnDateSetListener() {
+        public void onDateSet(DatePicker view, int year, int monthOfYear, int dayOfMonth) {
+            mYear = year;
+            mMonth = monthOfYear;
+            mDay = dayOfMonth;
+            TimePickerDialog tpd = new TimePickerDialog(getActivity(), mTimeSetListener, mHour, mMinute, false);
+            tpd.setTitle("");
+            tpd.show();
+        }
+    };
+
+    private TimePickerDialog.OnTimeSetListener mTimeSetListener = new TimePickerDialog.OnTimeSetListener() {
+
+        public void onTimeSet(TimePicker view, int hour, int minute) {
+            mHour = hour;
+            mMinute = minute;
+
+            Date d = new Date(mYear - 1900, mMonth, mDay, mHour, mMinute);
+            long timestamp = d.getTime();
+
+            try {
+                int flags = 0;
+                flags |= android.text.format.DateUtils.FORMAT_SHOW_DATE;
+                flags |= android.text.format.DateUtils.FORMAT_ABBREV_MONTH;
+                flags |= android.text.format.DateUtils.FORMAT_SHOW_YEAR;
+                flags |= android.text.format.DateUtils.FORMAT_SHOW_TIME;
+                String formattedDate = DateUtils.formatDateTime(getActivity(), timestamp, flags);
+                mCustomPubDate = timestamp;
+                mPubDateText.setText(formattedDate);
+                mIsCustomPubDate = true;
+            } catch (Exception e) {
+                e.printStackTrace();
+            }
+        }
+    };
+}
diff --git a/src/org/wordpress/android/ui/posts/NewEditPostActivity.java b/src/org/wordpress/android/ui/posts/NewEditPostActivity.java
new file mode 100644
index 000000000000..be4c1e4fba35
--- /dev/null
+++ b/src/org/wordpress/android/ui/posts/NewEditPostActivity.java
@@ -0,0 +1,333 @@
+package org.wordpress.android.ui.posts;
+
+import com.actionbarsherlock.app.ActionBar;
+import com.actionbarsherlock.app.SherlockFragmentActivity;
+import com.actionbarsherlock.view.Menu;
+import com.actionbarsherlock.view.MenuInflater;
+
+import java.util.Locale;
+
+import android.app.AlertDialog;
+import android.content.DialogInterface;
+import android.content.Intent;
+import android.support.v4.app.Fragment;
+import android.support.v4.app.FragmentManager;
+import android.support.v4.app.FragmentTransaction;
+import android.support.v4.app.FragmentPagerAdapter;
+import android.os.Bundle;
+import android.support.v4.view.ViewPager;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.TextView;
+import android.widget.Toast;
+
+import org.wordpress.android.R;
+import org.wordpress.android.WordPress;
+import org.wordpress.android.models.Post;
+import org.wordpress.android.util.PostUploadService;
+
+public class NewEditPostActivity extends SherlockFragmentActivity implements ActionBar.TabListener {
+
+    public static String EXTRA_POSTID = "postId";
+    public static String EXTRA_IS_PAGE = "isPage";
+    public static String EXTRA_IS_NEW_POST = "isNewPost";
+
+    /**
+     * The {@link android.support.v4.view.PagerAdapter} that will provide
+     * fragments for each of the sections. We use a
+     * {@link FragmentPagerAdapter} derivative, which will keep every
+     * loaded fragment in memory. If this becomes too memory intensive, it
+     * may be best to switch to a
+     * {@link android.support.v4.app.FragmentStatePagerAdapter}.
+     */
+    SectionsPagerAdapter mSectionsPagerAdapter;
+
+    /**
+     * The {@link ViewPager} that will host the section contents.
+     */
+    ViewPager mViewPager;
+
+    private Post mPost;
+    private Post mOriginalPost;
+
+    private EditPostContentFragment mEditPostContentFragment;
+    private EditPostSettingsFragment mEditPostSettingsFragment;
+
+    private boolean mIsNewPost;
+
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        setContentView(R.layout.activity_new_edit_post);
+
+        // Set up the action bar.
+        final ActionBar actionBar = getSupportActionBar();
+        actionBar.setNavigationMode(ActionBar.NAVIGATION_MODE_TABS);
+        actionBar.setDisplayHomeAsUpEnabled(true);
+
+        // Create the adapter that will return a fragment for each of the three
+        // primary sections of the activity.
+        mSectionsPagerAdapter = new SectionsPagerAdapter(getSupportFragmentManager());
+
+        // Set up the ViewPager with the sections adapter.
+        mViewPager = (ViewPager) findViewById(R.id.pager);
+        mViewPager.setAdapter(mSectionsPagerAdapter);
+        mViewPager.setOffscreenPageLimit(2);
+
+        // When swiping between different sections, select the corresponding
+        // tab. We can also use ActionBar.Tab#select() to do this if we have
+        // a reference to the Tab.
+        mViewPager.setOnPageChangeListener(new ViewPager.SimpleOnPageChangeListener() {
+            @Override
+            public void onPageSelected(int position) {
+                actionBar.setSelectedNavigationItem(position);
+                mEditPostContentFragment.setContentEditTextFocusable(position == 0);
+            }
+        });
+
+        // Add the 3 tabs for the post editor
+        actionBar.addTab(
+                actionBar.newTab()
+                        .setText(mSectionsPagerAdapter.getPageTitle(0))
+                        .setTabListener(this)
+                        .setIcon(R.drawable.tab_icon_write));
+        actionBar.addTab(
+                actionBar.newTab()
+                        .setText(mSectionsPagerAdapter.getPageTitle(1))
+                        .setTabListener(this)
+                        .setIcon(R.drawable.tab_icon_settings));
+        actionBar.addTab(
+                actionBar.newTab()
+                        .setText(mSectionsPagerAdapter.getPageTitle(2))
+                        .setTabListener(this)
+                        .setIcon(R.drawable.tab_icon_preview));
+
+        setTitle(WordPress.getCurrentBlog().getBlogName());
+
+        Bundle extras = getIntent().getExtras();
+        if (extras != null) {
+            long postId = extras.getLong(EXTRA_POSTID, -1);
+            boolean isPage = extras.getBoolean(EXTRA_IS_PAGE);
+            mIsNewPost = extras.getBoolean(EXTRA_IS_NEW_POST);
+            try {
+                mPost = new Post(WordPress.getCurrentBlog().getId(), postId, isPage);
+                if (mPost == null) {
+                    // big oopsie
+                    Toast.makeText(this, getResources().getText(R.string.post_not_found), Toast.LENGTH_LONG).show();
+                    finish();
+                    return;
+                } else {
+                    mOriginalPost = new Post(WordPress.getCurrentBlog().getId(), postId, isPage);
+                }
+            } catch (Exception e) {
+                e.printStackTrace();
+                finish();
+            }
+        }
+    }
+
+    @Override
+    public boolean onCreateOptionsMenu(com.actionbarsherlock.view.Menu menu) {
+        super.onCreateOptionsMenu(menu);
+        MenuInflater inflater = getSupportMenuInflater();
+        inflater.inflate(R.menu.edit_post, menu);
+        return true;
+    }
+
+    @Override
+    public boolean onPrepareOptionsMenu(Menu menu) {
+        super.onPrepareOptionsMenu(menu);
+
+        if (getSupportActionBar() != null)
+            menu.findItem(R.id.menu_edit_post).setVisible(getSupportActionBar().getNavigationMode() == ActionBar.NAVIGATION_MODE_TABS);
+
+        return true;
+    }
+
+    // Menu actions
+    @Override
+    public boolean onOptionsItemSelected(com.actionbarsherlock.view.MenuItem item) {
+        int itemId = item.getItemId();
+        if (itemId == R.id.menu_edit_post) {
+
+            savePost();
+
+                /*if (mQuickMediaType >= 0) {
+                    if (mQuickMediaType == Constants.QUICK_POST_PHOTO_CAMERA || mQuickMediaType == Constants.QUICK_POST_PHOTO_LIBRARY)
+                        mPost.setQuickPostType("QuickPhoto");
+                    else if (mQuickMediaType == Constants.QUICK_POST_VIDEO_CAMERA || mQuickMediaType == Constants.QUICK_POST_VIDEO_LIBRARY)
+                        mPost.setQuickPostType("QuickVideo");
+                }*/
+            PostUploadService.addPostToUpload(mPost);
+            startService(new Intent(this, PostUploadService.class));
+            Intent i = new Intent();
+            i.putExtra("shouldRefresh", true);
+            setResult(RESULT_OK, i);
+            finish();
+            return true;
+        } else if (itemId == android.R.id.home) {
+            showCancelAlert(true);
+            return true;
+        }
+        return false;
+    }
+
+    public Post getPost() {
+        return mPost;
+    }
+
+    private void savePost() {
+        // Update post content from fragment fields
+        if (mEditPostContentFragment != null)
+            mEditPostContentFragment.savePostContent(false);
+        if (mEditPostSettingsFragment != null)
+            mEditPostSettingsFragment.savePostSettings(false);
+    }
+
+    @Override
+    public void onBackPressed() {
+        showCancelAlert(false);
+    }
+
+    private void showCancelAlert(final boolean isUpPress) {
+        // Empty post? Let's not prompt then.
+        if (mEditPostContentFragment != null && mEditPostContentFragment.hasEmptyContentFields()) {
+            if (mIsNewPost)
+                mPost.delete();
+            finish();
+            return;
+        }
+
+        AlertDialog.Builder dialogBuilder = new AlertDialog.Builder(this);
+        dialogBuilder.setTitle(getString((mPost.isPage()) ? R.string.edit_page : R.string.edit_post));
+        dialogBuilder.setMessage(getString(R.string.prompt_save_changes));
+        dialogBuilder.setPositiveButton(getResources().getText(R.string.save), new DialogInterface.OnClickListener() {
+            public void onClick(DialogInterface dialog, int whichButton) {
+                savePost();
+                Intent i = new Intent();
+                i.putExtra("shouldRefresh", true);
+                setResult(RESULT_OK, i);
+                finish();
+            }
+        });
+        dialogBuilder.setNeutralButton(getString(R.string.discard), new DialogInterface.OnClickListener() {
+            public void onClick(DialogInterface dialog, int whichButton) {
+                // When discard options is chosen, restore existing post or delete new post if it was autosaved.
+                if (mOriginalPost != null) {
+                    mOriginalPost.update();
+                } else if (mPost != null && mIsNewPost) {
+                    mPost.delete();
+                }
+                finish();
+            }
+        });
+        dialogBuilder.setNegativeButton(getString(R.string.cancel), new DialogInterface.OnClickListener() {
+            public void onClick(DialogInterface dialog, int whichButton) {
+                dialog.dismiss();
+            }
+        });
+        dialogBuilder.setCancelable(true);
+        dialogBuilder.create().show();
+    }
+
+    @Override
+    public void onTabSelected(ActionBar.Tab tab, FragmentTransaction fragmentTransaction) {
+        // When the given tab is selected, switch to the corresponding page in
+        // the ViewPager.
+        mViewPager.setCurrentItem(tab.getPosition());
+    }
+
+    @Override
+    public void onTabUnselected(ActionBar.Tab tab, FragmentTransaction fragmentTransaction) {
+    }
+
+    @Override
+    public void onTabReselected(ActionBar.Tab tab, FragmentTransaction fragmentTransaction) {
+    }
+
+    /**
+     * A {@link FragmentPagerAdapter} that returns a fragment corresponding to
+     * one of the sections/tabs/pages.
+     */
+    public class SectionsPagerAdapter extends FragmentPagerAdapter {
+
+        public SectionsPagerAdapter(FragmentManager fm) {
+            super(fm);
+        }
+
+        @Override
+        public Fragment getItem(int position) {
+            // getItem is called to instantiate the fragment for the given page.
+            // Return a PlaceholderFragment (defined as a static inner class below).
+
+
+            switch (position) {
+                case 0:
+                    mEditPostContentFragment = new EditPostContentFragment();
+                    return mEditPostContentFragment;
+                case 1:
+                    mEditPostSettingsFragment = new EditPostSettingsFragment();
+                    return mEditPostSettingsFragment;
+                default:
+                    return PlaceholderFragment.newInstance(position + 1);
+            }
+        }
+
+        @Override
+        public int getCount() {
+            // Show 3 total pages.
+            return 3;
+        }
+
+        @Override
+        public CharSequence getPageTitle(int position) {
+            Locale l = Locale.getDefault();
+            switch (position) {
+                case 0:
+                    return "WRITE";
+                case 1:
+                    return getString(R.string.settings).toUpperCase(l);
+                case 2:
+                    return getString(R.string.preview).toUpperCase(l);
+            }
+            return null;
+        }
+    }
+
+    /**
+     * A placeholder fragment containing a simple view.
+     */
+    public static class PlaceholderFragment extends Fragment {
+        /**
+         * The fragment argument representing the section number for this
+         * fragment.
+         */
+        private static final String ARG_SECTION_NUMBER = "section_number";
+
+        /**
+         * Returns a new instance of this fragment for the given section
+         * number.
+         */
+        public static PlaceholderFragment newInstance(int sectionNumber) {
+            PlaceholderFragment fragment = new PlaceholderFragment();
+            Bundle args = new Bundle();
+            args.putInt(ARG_SECTION_NUMBER, sectionNumber);
+            fragment.setArguments(args);
+            return fragment;
+        }
+
+        public PlaceholderFragment() {
+        }
+
+        @Override
+        public View onCreateView(LayoutInflater inflater, ViewGroup container,
+                Bundle savedInstanceState) {
+            View rootView = inflater.inflate(R.layout.fragment_new_edit_post, container, false);
+            TextView textView = (TextView) rootView.findViewById(R.id.section_label);
+            textView.setText(Integer.toString(getArguments().getInt(ARG_SECTION_NUMBER)));
+            return rootView;
+        }
+    }
+
+}
diff --git a/src/org/wordpress/android/ui/posts/PostsActivity.java b/src/org/wordpress/android/ui/posts/PostsActivity.java
index 8629d951efe9..8623e249d29a 100644
--- a/src/org/wordpress/android/ui/posts/PostsActivity.java
+++ b/src/org/wordpress/android/ui/posts/PostsActivity.java
@@ -312,11 +312,13 @@ public boolean onCreateOptionsMenu(Menu menu) {
     }
 
     public void newPost() {
-        Intent i = new Intent(this, EditPostActivity.class);
-        i.putExtra("id", WordPress.currentBlog.getId());
-        i.putExtra("isNew", true);
-        if (isPage)
-            i.putExtra("isPage", true);
+        // Create a new post object
+        Post newPost = new Post(WordPress.getCurrentBlog().getId(), isPage);
+        newPost.save();
+        Intent i = new Intent(this, NewEditPostActivity.class);
+        i.putExtra(NewEditPostActivity.EXTRA_POSTID, newPost.getId());
+        i.putExtra(NewEditPostActivity.EXTRA_IS_PAGE, isPage);
+        i.putExtra(NewEditPostActivity.EXTRA_IS_NEW_POST, true);
         startActivityForResult(i, ACTIVITY_EDIT_POST);
     }
 
diff --git a/src/org/wordpress/android/ui/posts/PostsListFragment.java b/src/org/wordpress/android/ui/posts/PostsListFragment.java
index c7088e4df8fc..d54e687d7a6a 100644
--- a/src/org/wordpress/android/ui/posts/PostsListFragment.java
+++ b/src/org/wordpress/android/ui/posts/PostsListFragment.java
@@ -526,16 +526,14 @@ public boolean onContextItemSelected(MenuItem item) {
             switch (item.getItemId()) {
             case MENU_ITEM_EDIT:
                 Intent i2 = new Intent(getActivity().getApplicationContext(),
-                        EditPostActivity.class);
-                i2.putExtra("postID", mSelectedID);
-                i2.putExtra("id", WordPress.currentBlog.getId());
+                        NewEditPostActivity.class);
+                i2.putExtra(NewEditPostActivity.EXTRA_POSTID, mSelectedID);
                 
                 if( itemGroupID == MENU_GROUP_PAGES ){ //page synced with the server
-                    i2.putExtra("isPage", true);
+                    i2.putExtra(NewEditPostActivity.EXTRA_IS_PAGE, true);
                 } else if ( itemGroupID == MENU_GROUP_DRAFTS ) { //local draft
                     if (isPage)
-                        i2.putExtra("isPage", true);
-                    i2.putExtra("localDraft", true);
+                        i2.putExtra(NewEditPostActivity.EXTRA_IS_PAGE, true);
                 }
                 
                 startActivityForResult(i2, 0);
