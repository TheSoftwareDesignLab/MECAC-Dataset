diff --git a/src/org/wordpress/android/WordPressDB.java b/src/org/wordpress/android/WordPressDB.java
index 87ff45970b54..87d6c20eb001 100644
--- a/src/org/wordpress/android/WordPressDB.java
+++ b/src/org/wordpress/android/WordPressDB.java
@@ -1511,7 +1511,7 @@ public void saveMediaFile(MediaFile mf) {
         values.put("horizontalAlignment", mf.getHorizontalAlignment());
         values.put("width", mf.getWidth());
         values.put("height", mf.getHeight());
-        values.put("mimeType", mf.getMIMEType());
+        values.put("mimeType", mf.getMimeType());
         values.put("featured", mf.isFeatured());
         values.put("isVideo", mf.isVideo());
         values.put("isFeaturedInPost", mf.isFeaturedInPost());
@@ -1539,47 +1539,13 @@ public void saveMediaFile(MediaFile mf) {
                     result = db.update(MEDIA_TABLE, values, "blogId=? AND mediaId=?", new String[]{ mf.getBlogId(), mf.getMediaId()});
             }
             
-            if (result == 0 && !isMarkedForDelete)
-                db.insert(MEDIA_TABLE, null, values);
-        }
-
-    }
-
-    public MediaFile[] getMediaFilesForPost(Post p) {
-
-        Cursor c = db.query(MEDIA_TABLE, null, "postID=" + p.getId(), null,
-                null, null, null);
-        int numRows = c.getCount();
-        c.moveToFirst();
-        MediaFile[] mediaFiles = new MediaFile[numRows];
-        for (int i = 0; i < numRows; i++) {
-
-            MediaFile mf = new MediaFile();
-            mf.setPostID(c.getInt(1));
-            mf.setFilePath(c.getString(2));
-            mf.setFileName(c.getString(3));
-            mf.setTitle(c.getString(4));
-            mf.setDescription(c.getString(5));
-            mf.setCaption(c.getString(6));
-            mf.setHorizontalAlignment(c.getInt(7));
-            mf.setWidth(c.getInt(8));
-            mf.setHeight(c.getInt(9));
-            mf.setMIMEType(c.getString(10));
-            mf.setFeatured(c.getInt(11) > 0);
-            mf.setVideo(c.getInt(12) > 0);
-            mf.setFeaturedInPost(c.getInt(13) > 0);
-            mf.setFileURL(c.getString(14));
-            mf.setThumbnailURL(c.getString(15));
-            mf.setMediaId(c.getString(16));
-            mf.setBlogId(c.getString(17));
-            mf.setDateCreatedGMT(c.getLong(18));
-            mf.setUploadState(c.getString(19));
-            mediaFiles[i] = mf;
-            c.moveToNext();
+            if (result == 0 && !isMarkedForDelete) {
+                result = db.update(MEDIA_TABLE, values, null, null);
+                if (result == 0)
+                    db.insert(MEDIA_TABLE, null, values);
+            }
         }
-        c.close();
 
-        return mediaFiles;
     }
     
     /** For a given blogId, get the first media files **/
@@ -1655,11 +1621,6 @@ public Cursor getMediaFilesForBlog(String blogId, long startDate, long endDate)
         return db.rawQuery("SELECT id as _id, * FROM " + MEDIA_TABLE + " WHERE blogId=? AND (uploadState IS NULL OR uploadState ='uploaded') AND (date_created_gmt >= ? AND date_created_gmt <= ?) ", new String[] { blogId , String.valueOf(startDate), String.valueOf(endDate) });
     }
     
-    /** For a given blogId, get all the media files for upload **/
-    public Cursor getMediaFilesForUpload(String blogId) {
-        return db.rawQuery("SELECT id as _id, * FROM " + MEDIA_TABLE + " WHERE blogId=? AND uploadState IN ('uploaded', 'queued', 'failed', 'uploading') ORDER BY date_created_gmt ASC", new String[] { blogId });
-    }
-    
     public Cursor getMediaFiles(String blogId, ArrayList<String> mediaIds) {
         
         if (mediaIds == null || mediaIds.size() == 0)
@@ -1673,20 +1634,6 @@ public Cursor getMediaFiles(String blogId, ArrayList<String> mediaIds) {
         
         return db.rawQuery("SELECT id as _id, * FROM " + MEDIA_TABLE + " WHERE blogId=? AND mediaId IN " + mediaIdsStr, new String[] { blogId });
     }
-    
-    public boolean deleteMediaFile(MediaFile mf) {
-
-        boolean returnValue = false;
-
-        int result = 0;
-        result = db.delete(MEDIA_TABLE, "blogId='" + mf.getBlogId() + "' AND id=" + mf.getId(), null);
-
-        if (result == 1) {
-            returnValue = true;
-        }
-
-        return returnValue;
-    }
 
     public MediaFile getMediaFile(String src, Post post) {
 
@@ -1705,7 +1652,7 @@ public MediaFile getMediaFile(String src, Post post) {
             mf.setHorizontalAlignment(c.getInt(7));
             mf.setWidth(c.getInt(8));
             mf.setHeight(c.getInt(9));
-            mf.setMIMEType(c.getString(10));
+            mf.setMimeType(c.getString(10));
             mf.setFeatured(c.getInt(11) > 0);
             mf.setVideo(c.getInt(12) > 0);
             mf.setFeaturedInPost(c.getInt(13) > 0);
diff --git a/src/org/wordpress/android/models/MediaFile.java b/src/org/wordpress/android/models/MediaFile.java
index 0b396796bc5d..0ddb0c3f9c6d 100644
--- a/src/org/wordpress/android/models/MediaFile.java
+++ b/src/org/wordpress/android/models/MediaFile.java
@@ -20,7 +20,7 @@ public class MediaFile {
     protected int horizontalAlignment; //0 = none, 1 = left, 2 = center, 3 = right
     protected boolean verticalAligment = false; //false = bottom, true = top
     protected int width = 500, height;
-    protected String MIMEType = ""; //do not store this value
+    protected String mimeType = "";
     protected String videoPressShortCode = null;
     protected boolean featured = false;
     protected boolean isVideo = false;
@@ -49,7 +49,7 @@ public MediaFile(String blogId, Map<?, ?> resultMap) {
         
         String fileType = new String(link).replaceAll(".*\\.(\\w+)$", "$1").toLowerCase();
         String mimeType = MimeTypeMap.getSingleton().getMimeTypeFromExtension(fileType);
-        setMIMEType(mimeType);
+        setMimeType(mimeType);
         
         // make the file urls be https://... so that we can get these images with oauth when the blogs are private
         // assume no https for images in self-hosted blogs
@@ -193,12 +193,12 @@ public void setFileName(String fileName) {
         this.fileName = fileName;
     }
 
-    public String getMIMEType() {
-        return MIMEType;
+    public String getMimeType() {
+        return mimeType;
     }
 
-    public void setMIMEType(String type) {
-        MIMEType = type;
+    public void setMimeType(String type) {
+        mimeType = type;
     }
 
     public String getVideoPressShortCode() {
diff --git a/src/org/wordpress/android/ui/media/MediaAddFragment.java b/src/org/wordpress/android/ui/media/MediaAddFragment.java
index 76470d155bb5..b52b9343e743 100644
--- a/src/org/wordpress/android/ui/media/MediaAddFragment.java
+++ b/src/org/wordpress/android/ui/media/MediaAddFragment.java
@@ -187,7 +187,7 @@ private void queueFileForUpload(String path) {
             mediaFile.setHeight(bfo.outHeight);
         }
         
-        mediaFile.setMIMEType(mimeType);
+        mediaFile.setMimeType(mimeType);
         mediaFile.save();
         
         mCallback.onMediaAdded(mediaFile.getMediaId());
diff --git a/src/org/wordpress/android/ui/media/MediaUtils.java b/src/org/wordpress/android/ui/media/MediaUtils.java
index b75c7a330bfb..f404f3234386 100644
--- a/src/org/wordpress/android/ui/media/MediaUtils.java
+++ b/src/org/wordpress/android/ui/media/MediaUtils.java
@@ -24,6 +24,7 @@
 import android.support.v4.app.Fragment;
 import android.support.v4.content.CursorLoader;
 
+import org.wordpress.android.models.MediaFile;
 import org.wordpress.android.util.ImageHelper;
 import org.wordpress.android.util.WPImageSpan;
 import org.wordpress.passcodelock.AppLockManager;
@@ -272,22 +273,23 @@ public static WPImageSpan prepareWPImageSpan(Context context, String blogId, fin
 
         Uri uri = Uri.parse(url);
         WPImageSpan imageSpan = new WPImageSpan(context, R.drawable.remote_image, uri);
-        imageSpan.setMediaId(mediaId);
-        imageSpan.setCaption(cursor.getString(cursor.getColumnIndex("caption")));
-        imageSpan.setDescription(cursor.getString(cursor.getColumnIndex("description")));
-        imageSpan.setTitle(cursor.getString(cursor.getColumnIndex("title")));
-        imageSpan.setWidth(cursor.getInt(cursor.getColumnIndex("width")));
-        imageSpan.setHeight(cursor.getInt(cursor.getColumnIndex("height")));
-        imageSpan.setMimeType(cursor.getString(cursor.getColumnIndex("mimeType")));
-        imageSpan.setFileName(cursor.getString(cursor.getColumnIndex("fileName")));
-        imageSpan.setThumbnailURL(cursor.getString(cursor.getColumnIndex("thumbnailURL")));
-        imageSpan.setDateCreatedGMT(cursor.getLong(cursor.getColumnIndex("date_created_gmt")));
+        MediaFile mediaFile = imageSpan.getMediaFile();
+        mediaFile.setMediaId(mediaId);
+        mediaFile.setCaption(cursor.getString(cursor.getColumnIndex("caption")));
+        mediaFile.setDescription(cursor.getString(cursor.getColumnIndex("description")));
+        mediaFile.setTitle(cursor.getString(cursor.getColumnIndex("title")));
+        mediaFile.setWidth(cursor.getInt(cursor.getColumnIndex("width")));
+        mediaFile.setHeight(cursor.getInt(cursor.getColumnIndex("height")));
+        mediaFile.setMimeType(cursor.getString(cursor.getColumnIndex("mimeType")));
+        mediaFile.setFileName(cursor.getString(cursor.getColumnIndex("fileName")));
+        mediaFile.setThumbnailURL(cursor.getString(cursor.getColumnIndex("thumbnailURL")));
+        mediaFile.setDateCreatedGMT(cursor.getLong(cursor.getColumnIndex("date_created_gmt")));
 
         boolean isVideo = false;
         String mimeType = cursor.getString(cursor.getColumnIndex("mimeType"));
         if (mimeType != null && mimeType.contains("video"))
             isVideo = true;
-        imageSpan.setVideo(isVideo);
+        mediaFile.setVideo(isVideo);
         cursor.close();
 
         return imageSpan;
@@ -318,7 +320,9 @@ public static int getMinimumImageWitdh(Context context, Uri curStream) {
     }
 
     public static void setWPImageSpanWidth(Context context, Uri curStream, WPImageSpan is) {
-        is.setWidth(getMinimumImageWitdh(context, curStream));
+        MediaFile mediaFile = is.getMediaFile();
+        if (mediaFile != null)
+            mediaFile.setWidth(getMinimumImageWitdh(context, curStream));
     }
 
     public static boolean isLocalImage(Uri imageUri) {
diff --git a/src/org/wordpress/android/ui/posts/EditPostContentFragment.java b/src/org/wordpress/android/ui/posts/EditPostContentFragment.java
index 4aaa93f5bb7c..cbc5b136c921 100644
--- a/src/org/wordpress/android/ui/posts/EditPostContentFragment.java
+++ b/src/org/wordpress/android/ui/posts/EditPostContentFragment.java
@@ -68,6 +68,7 @@
 import org.wordpress.android.ui.media.MediaGalleryPickerActivity;
 import org.wordpress.android.ui.media.MediaUtils;
 import org.wordpress.android.util.DeviceUtils;
+import org.wordpress.android.util.DisplayUtils;
 import org.wordpress.android.util.ImageHelper;
 import org.wordpress.android.util.MediaGalleryImageSpan;
 import org.wordpress.android.util.StringUtils;
@@ -550,24 +551,14 @@ public void savePostContent(boolean isAutoSave) {
 
             for (WPImageSpan wpIS : imageSpans) {
                 images += wpIS.getImageSource().toString() + ",";
-
-                if (wpIS.getMediaId() != null) {
+                MediaFile mediaFile = wpIS.getMediaFile();
+                if (mediaFile == null)
+                    continue;
+                if (mediaFile.getMediaId() != null) {
                     updateMediaFileOnServer(wpIS);
                 } else {
-                    MediaFile mf = new MediaFile();
-                    mf.setBlogId(WordPress.getCurrentBlog().getBlogId() + "");
-                    mf.setPostID(post.getId());
-                    mf.setTitle(wpIS.getTitle());
-                    mf.setCaption(wpIS.getCaption());
-                    // mf.setDescription(wpIS.getDescription());
-                    mf.setFeatured(wpIS.isFeatured());
-                    mf.setFeaturedInPost(wpIS.isFeaturedInPost());
-                    mf.setFileName(wpIS.getImageSource().toString());
-                    mf.setFilePath(wpIS.getImageSource().toString());
-                    mf.setHorizontalAlignment(wpIS.getHorizontalAlignment());
-                    mf.setWidth(wpIS.getWidth());
-                    mf.setVideo(wpIS.isVideo());
-                    mf.save();
+                    mediaFile.setFilePath(wpIS.getImageSource().toString());
+                    mediaFile.save();
                 }
 
                 int tagStart = s.getSpanStart(wpIS);
@@ -575,7 +566,7 @@ public void savePostContent(boolean isAutoSave) {
                     s.removeSpan(wpIS);
 
                     // network image has a mediaId
-                    if (wpIS.getMediaId() != null && wpIS.getMediaId().length() > 0) {
+                    if (mediaFile.getMediaId() != null && mediaFile.getMediaId().length() > 0) {
                         s.insert(tagStart, WPHtml.getContent(wpIS));
 
                     } else { // local image for upload
@@ -785,7 +776,7 @@ private void updateMediaFileOnServer(WPImageSpan wpIS) {
         if (currentBlog == null || wpIS == null)
             return;
 
-        MediaFile mf = getMediaFileFromWPImageSpan(wpIS);
+        MediaFile mf = wpIS.getMediaFile();
 
         final String mediaId = mf.getMediaId();
         final String title = mf.getTitle();
@@ -813,31 +804,13 @@ public void onFailure() {
         task.execute(apiArgs);
     }
 
-    private MediaFile getMediaFileFromWPImageSpan(WPImageSpan wpIS) {
-        MediaFile mf = new MediaFile();
-        mf.setMediaId(wpIS.getMediaId());
-        if (mActivity.getPost() != null)
-            mf.setPostID(mActivity.getPost().getId());
-        mf.setMIMEType(wpIS.getMimeType());
-        mf.setHeight(wpIS.getHeight());
-        mf.setFileName(wpIS.getFileName());
-        mf.setTitle(wpIS.getTitle());
-        mf.setCaption(wpIS.getCaption());
-        mf.setDescription(wpIS.getDescription());
-        mf.setFeatured(wpIS.isFeatured());
-        mf.setFeaturedInPost(wpIS.isFeaturedInPost());
-        mf.setHorizontalAlignment(wpIS.getHorizontalAlignment());
-        mf.setWidth(wpIS.getWidth());
-        mf.setBlogId(WordPress.getCurrentBlog().getBlogId() + "");
-        mf.setDateCreatedGMT(wpIS.getDateCreatedGMT());
-        mf.save();
-        return mf;
-    }
-
     /** Loads the thumbnail url in the imagespan from a server **/
     private void loadWPImageSpanThumbnail(WPImageSpan imageSpan) {
-        final String mediaId = imageSpan.getMediaId();
-        String imageUrl = imageSpan.getThumbnailURL();
+        MediaFile mediaFile = imageSpan.getMediaFile();
+        if (mediaFile == null)
+            return;
+        final String mediaId = mediaFile.getMediaId();
+        String imageUrl = mediaFile.getThumbnailURL();
         if (imageUrl == null || mediaId == null)
             return;
 
@@ -863,7 +836,7 @@ public void onResponse(ImageLoader.ImageContainer container, boolean arg1) {
                     ByteArrayOutputStream stream = new ByteArrayOutputStream();
                     bitmap.compress(Bitmap.CompressFormat.PNG, 100, stream);
                     byte[] bitmapByteArray = stream.toByteArray();
-                    Bitmap resizedBitmap = ih.getResizedImageThumbnail(getActivity(), bitmapByteArray, null);
+                    Bitmap resizedBitmap = ih.getThumbnailForWPImageSpan(getActivity(), bitmapByteArray, null);
                     if (resizedBitmap == null)
                         return;
                     Editable s = mContentEditText.getText();
@@ -872,26 +845,16 @@ public void onResponse(ImageLoader.ImageContainer container, boolean arg1) {
                     WPImageSpan[] spans = s.getSpans(0, s.length(), WPImageSpan.class);
                     if (spans.length != 0) {
                         for (WPImageSpan is : spans) {
-                            if (mediaId.equals(is.getMediaId()) && !is.isNetworkImageLoaded()) {
+                            MediaFile mediaFile = is.getMediaFile();
+                            if (mediaFile == null)
+                                continue;
+                            if (mediaId.equals(mediaFile.getMediaId()) && !is.isNetworkImageLoaded()) {
 
                                 // replace the existing span with a new one with the correct image, re-add it to the same position.
                                 int spanStart = s.getSpanStart(is);
                                 int spanEnd = s.getSpanEnd(is);
                                 WPImageSpan imageSpan = new WPImageSpan(getActivity(), resizedBitmap, is.getImageSource());
-                                imageSpan.setCaption(is.getCaption());
-                                imageSpan.setDescription(is.getDescription());
-                                imageSpan.setFeatured(is.isFeatured());
-                                imageSpan.setFeaturedInPost(is.isFeaturedInPost());
-                                imageSpan.setHeight(is.getHeight());
-                                imageSpan.setHorizontalAlignment(is.getHorizontalAlignment());
-                                imageSpan.setMediaId(is.getMediaId());
-                                imageSpan.setMimeType(is.getMimeType());
-                                imageSpan.setTitle(is.getTitle());
-                                imageSpan.setVideo(is.isVideo());
-                                imageSpan.setWidth(is.getWidth());
-                                imageSpan.setFileName(is.getFileName());
-                                imageSpan.setThumbnailURL(is.getThumbnailURL());
-                                imageSpan.setDateCreatedGMT(is.getDateCreatedGMT());
+                                imageSpan.setMediaFile(is.getMediaFile());
                                 imageSpan.setNetworkImageLoaded(true);
                                 s.removeSpan(is);
                                 s.setSpan(imageSpan, spanStart, spanEnd, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
@@ -1002,19 +965,20 @@ private boolean addMedia(Uri imageUri, SpannableStringBuilder ssb) {
             return false;
         }
 
-        Bitmap resizedBitmap = ih.getResizedImageThumbnail(getActivity(), (byte[]) mediaData.get("bytes"), (String) mediaData.get("orientation"));
+        Bitmap resizedBitmap = ih.getThumbnailForWPImageSpan(getActivity(), (byte[]) mediaData.get("bytes"), (String) mediaData.get("orientation"));
         if (resizedBitmap == null)
             return false;
 
         if (ssb != null) {
             WPImageSpan is = new WPImageSpan(getActivity(), resizedBitmap, imageUri);
-
+            MediaFile mediaFile = is.getMediaFile();
+            mediaFile.setPostID(mActivity.getPost().getId());
+            mediaFile.setTitle((String) mediaData.get("title"));
             MediaUtils.setWPImageSpanWidth(getActivity(), imageUri, is);
 
-            is.setTitle((String) mediaData.get("title"));
             is.setImageSource(imageUri);
             if (imageUri.getEncodedPath() != null)
-                is.setVideo(imageUri.getEncodedPath().contains("video"));
+                mediaFile.setVideo(imageUri.getEncodedPath().contains("video"));
             ssb.append(" ");
             ssb.setSpan(is, ssb.length() - 1, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
             AlignmentSpan.Standard as = new AlignmentSpan.Standard(Layout.Alignment.ALIGN_CENTER);
@@ -1035,13 +999,14 @@ private boolean addMedia(Uri imageUri, SpannableStringBuilder ssb) {
             if (s == null)
                 return false;
             WPImageSpan is = new WPImageSpan(getActivity(), resizedBitmap, imageUri);
-
+            MediaFile mediaFile = is.getMediaFile();
+            mediaFile.setPostID(mActivity.getPost().getId());
+            mediaFile.setTitle((String) mediaData.get("title"));
             MediaUtils.setWPImageSpanWidth(getActivity(), imageUri, is);
 
-            is.setTitle((String) mediaData.get("title"));
             is.setImageSource(imageUri);
             if (imageUri.getEncodedPath() != null)
-                is.setVideo(imageUri.getEncodedPath().contains("video"));
+                mediaFile.setVideo(imageUri.getEncodedPath().contains("video"));
 
             int line, column = 0;
             if (mContentEditText.getLayout() != null) {
@@ -1247,7 +1212,8 @@ public boolean onTouch(View v, MotionEvent event) {
             mLastYPos = pos;
 
         if (event.getAction() > 1) {
-            if (((mLastYPos - pos) > 2.0f) || ((pos - mLastYPos) > 2.0f))
+            int scrollThreshold = DisplayUtils.dpToPx(getActivity(), 2);
+            if (((mLastYPos - pos) > scrollThreshold) || ((pos - mLastYPos) > scrollThreshold))
                 mScrollDetected = true;
         }
 
@@ -1279,15 +1245,16 @@ public boolean onTouch(View v, MotionEvent event) {
 
                 if (image_spans.length != 0) {
                     final WPImageSpan span = image_spans[0];
-                    if (!span.isVideo()) {
+                    MediaFile mediaFile = span.getMediaFile();
+                    if (mediaFile == null)
+                        return false;
+                    if (!mediaFile.isVideo()) {
                         LayoutInflater factory = LayoutInflater.from(getActivity());
                         final View alertView = factory.inflate(R.layout.alert_image_options, null);
                         if (alertView == null)
                             return false;
                         final EditText imageWidthText = (EditText) alertView.findViewById(R.id.imageWidthText);
                         final EditText titleText = (EditText) alertView.findViewById(R.id.title);
-                        // final EditText descText = (EditText)
-                        // alertView.findViewById(R.id.description);
                         final EditText caption = (EditText) alertView.findViewById(R.id.caption);
                         final CheckBox featuredCheckBox = (CheckBox) alertView.findViewById(R.id.featuredImage);
                         final CheckBox featuredInPostCheckBox = (CheckBox) alertView.findViewById(R.id.featuredInPost);
@@ -1317,26 +1284,25 @@ public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
                         adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
                         alignmentSpinner.setAdapter(adapter);
 
-                        imageWidthText.setText(String.valueOf(span.getWidth()) + "px");
-                        seekBar.setProgress(span.getWidth());
-                        titleText.setText(span.getTitle());
-                        // descText.setText(span.getDescription());
-                        caption.setText(span.getCaption());
-                        featuredCheckBox.setChecked(span.isFeatured());
+                        imageWidthText.setText(String.valueOf(mediaFile.getWidth()) + "px");
+                        seekBar.setProgress(mediaFile.getWidth());
+                        titleText.setText(mediaFile.getTitle());
+                        caption.setText(mediaFile.getCaption());
+                        featuredCheckBox.setChecked(mediaFile.isFeatured());
 
-                        if (span.isFeatured())
+                        if (mediaFile.isFeatured())
                             featuredInPostCheckBox.setVisibility(View.VISIBLE);
                         else
                             featuredInPostCheckBox.setVisibility(View.GONE);
 
-                        featuredInPostCheckBox.setChecked(span.isFeaturedInPost());
+                        featuredInPostCheckBox.setChecked(mediaFile.isFeaturedInPost());
 
-                        alignmentSpinner.setSelection(span.getHorizontalAlignment(), true);
+                        alignmentSpinner.setSelection(mediaFile.getHorizontalAlignment(), true);
 
                         final int maxWidth = MediaUtils.getMinimumImageWitdh(getActivity(), span.getImageSource());
                         seekBar.setMax(maxWidth / 10);
-                        if (span.getWidth() != 0)
-                            seekBar.setProgress(span.getWidth() / 10);
+                        if (mediaFile.getWidth() != 0)
+                            seekBar.setProgress(mediaFile.getWidth() / 10);
                         seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
 
                             @Override
@@ -1384,27 +1350,31 @@ public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
                                     public void onClick(DialogInterface dialog, int whichButton) {
 
                                         String title = (titleText.getText() != null) ? titleText.getText().toString() : "";
-                                        span.setTitle(title);
-                                        // span.setDescription(descText.getText().toString());
-                                        span.setHorizontalAlignment(alignmentSpinner.getSelectedItemPosition());
-                                        span.setWidth(getEditTextIntegerClamped(imageWidthText, 10, maxWidth));
+                                        MediaFile mediaFile = span.getMediaFile();
+                                        if (mediaFile == null)
+                                            return;
+                                        mediaFile.setTitle(title);
+                                        mediaFile.setHorizontalAlignment(alignmentSpinner.getSelectedItemPosition());
+                                        mediaFile.setWidth(getEditTextIntegerClamped(imageWidthText, 10, maxWidth));
                                         String captionText = (caption.getText() != null) ? caption.getText().toString() : "";
-                                        span.setCaption(captionText);
-                                        span.setFeatured(featuredCheckBox.isChecked());
+                                        mediaFile.setCaption(captionText);
+                                        mediaFile.setFeatured(featuredCheckBox.isChecked());
                                         if (featuredCheckBox.isChecked()) {
-                                            // remove featured flag from all
-                                            // other images
+                                            // remove featured flag from all other images
                                             WPImageSpan[] click_spans = s.getSpans(0, s.length(), WPImageSpan.class);
                                             if (click_spans.length > 1) {
                                                 for (WPImageSpan verifySpan : click_spans) {
                                                     if (verifySpan != span) {
-                                                        verifySpan.setFeatured(false);
-                                                        verifySpan.setFeaturedInPost(false);
+                                                        MediaFile verifySpanMediaFile = verifySpan.getMediaFile();
+                                                        if (mediaFile != null){
+                                                            verifySpanMediaFile.setFeatured(false);
+                                                            verifySpanMediaFile.setFeaturedInPost(false);
+                                                        }
                                                     }
                                                 }
                                             }
                                         }
-                                        span.setFeaturedInPost(featuredInPostCheckBox.isChecked());
+                                        mediaFile.setFeaturedInPost(featuredInPostCheckBox.isChecked());
                                     }
                                 }).setNegativeButton(getString(R.string.cancel), new DialogInterface.OnClickListener() {
                                     public void onClick(DialogInterface dialog, int whichButton) {
diff --git a/src/org/wordpress/android/util/ImageHelper.java b/src/org/wordpress/android/util/ImageHelper.java
index e7814737cbd4..c8dfe2dbbac7 100644
--- a/src/org/wordpress/android/util/ImageHelper.java
+++ b/src/org/wordpress/android/util/ImageHelper.java
@@ -471,7 +471,14 @@ protected void onPostExecute(Bitmap bitmap) {
         }
     }
 
-    public Bitmap getResizedImageThumbnail(Context ctx, byte[] bytes, String orientation) {
+    /**
+     * Resizes an image to be placed in the Post Content Editor
+     * @param ctx
+     * @param bytes
+     * @param orientation
+     * @return resized bitmap
+     */
+    public Bitmap getThumbnailForWPImageSpan(Context ctx, byte[] bytes, String orientation) {
         Display display = ((Activity)ctx).getWindowManager().getDefaultDisplay();
         int width = display.getWidth();
         int height = display.getHeight();
@@ -482,10 +489,10 @@ public Bitmap getResizedImageThumbnail(Context ctx, byte[] bytes, String orienta
         opts.inJustDecodeBounds = true;
         BitmapFactory.decodeByteArray(bytes, 0, bytes.length, opts);
 
-        float conversionFactor = 0.25f;
+        float conversionFactor = 0.40f;
 
         if (opts.outWidth > opts.outHeight)
-            conversionFactor = 0.40f;
+            conversionFactor = 0.70f;
 
         byte[] finalBytes = createThumbnail(bytes, String.valueOf((int) (width * conversionFactor)),
                 orientation, true);
diff --git a/src/org/wordpress/android/util/MediaUploadService.java b/src/org/wordpress/android/util/MediaUploadService.java
index ac606649dcfa..4db85b2f94e4 100644
--- a/src/org/wordpress/android/util/MediaUploadService.java
+++ b/src/org/wordpress/android/util/MediaUploadService.java
@@ -116,7 +116,7 @@ private void uploadMediaFile(Cursor cursor) {
         mediaFile.setBlogId(blogIdStr);
         mediaFile.setFileName(fileName);
         mediaFile.setFilePath(filePath);
-        mediaFile.setMIMEType(mimeType);
+        mediaFile.setMimeType(mimeType);
 
         ApiHelper.UploadMediaTask task = new ApiHelper.UploadMediaTask(mContext, mediaFile, new Callback() {
             
diff --git a/src/org/wordpress/android/util/WPHtml.java b/src/org/wordpress/android/util/WPHtml.java
index 491b407dc9b2..1b4fb3882c3a 100644
--- a/src/org/wordpress/android/util/WPHtml.java
+++ b/src/org/wordpress/android/util/WPHtml.java
@@ -25,7 +25,6 @@
 import android.content.res.ColorStateList;
 import android.content.res.Resources;
 import android.graphics.Bitmap;
-import android.graphics.BitmapFactory;
 import android.graphics.Canvas;
 import android.graphics.Paint;
 import android.graphics.Typeface;
@@ -54,11 +53,10 @@
 import android.text.style.TextAppearanceSpan;
 import android.text.style.TypefaceSpan;
 import android.text.style.URLSpan;
-import android.view.Display;
-import android.view.WindowManager;
 
 import org.ccil.cowan.tagsoup.HTMLSchema;
 import org.ccil.cowan.tagsoup.Parser;
+import org.wordpress.android.ui.posts.EditPostActivity;
 import org.xml.sax.Attributes;
 import org.xml.sax.ContentHandler;
 import org.xml.sax.InputSource;
@@ -344,7 +342,7 @@ private static void withinParagraph(StringBuilder out, Spanned text,
                 }
                 if (style[j] instanceof MediaGalleryImageSpan) {
                     out.append(getGalleryShortcode((MediaGalleryImageSpan) style[j]));
-                } else if (style[j] instanceof WPImageSpan && ((WPImageSpan) style[j]).getMediaId() != null) {
+                } else if (style[j] instanceof WPImageSpan && ((WPImageSpan) style[j]).getMediaFile().getMediaId() != null) {
                     out.append(getContent((WPImageSpan) style[j]));
                 } else if (style[j] instanceof ImageSpan) {
                     out.append("<img src=\"");
@@ -455,23 +453,25 @@ public static String getContent(WPImageSpan imageSpan) {
         // based on PostUploadService
         
         String content = "";
-        
-        String mediaId = imageSpan.getMediaId();
+        MediaFile mediaFile = imageSpan.getMediaFile();
+        if (mediaFile == null)
+            return content;
+        String mediaId = mediaFile.getMediaId();
         if (mediaId == null || mediaId.length() == 0)
             return content;
         
-        boolean isVideo = imageSpan.isVideo();
+        boolean isVideo = mediaFile.isVideo();
         String url = imageSpan.getImageSource().toString();
         
         if (isVideo) {
-            int xRes = imageSpan.getWidth();
-            int yRes = imageSpan.getHeight();
-            String mimeType = imageSpan.getMimeType();
+            int xRes = mediaFile.getWidth();
+            int yRes = mediaFile.getHeight();
+            String mimeType = mediaFile.getMimeType();
             content = String.format("<video width=\"%s\" height=\"%s\" controls=\"controls\"><source src=\"%s\" type=\"%s\" /><a href=\"%s\">Click to view video</a>.</video>",
                     xRes, yRes, url, mimeType, url);
         } else {
             String alignment = "";
-            switch (imageSpan.getHorizontalAlignment()) {
+            switch (mediaFile.getHorizontalAlignment()) {
             case 0:
                 alignment = "alignnone";
                 break;
@@ -486,9 +486,9 @@ public static String getContent(WPImageSpan imageSpan) {
                 break;
             }
             String alignmentCSS = "class=\"" + alignment + " size-full\" ";
-            String title = imageSpan.getTitle();
-            String caption = imageSpan.getCaption();
-            int width = imageSpan.getWidth();
+            String title = mediaFile.getTitle();
+            String caption = mediaFile.getCaption();
+            int width = mediaFile.getWidth();
             
             content = content + "<a href=\"" + url + "\"><img title=\"" + title + "\" "
                     + alignmentCSS + "alt=\"image\" src=\"" + url + "?w=" + width +"\" /></a>";
@@ -832,38 +832,13 @@ private static void end(SpannableStringBuilder text, Class<?> kind,
     private static void startImg(SpannableStringBuilder text,
             Attributes attributes, WPHtml.ImageGetter img) {
         String src = attributes.getValue("android-uri");
-        Bitmap resizedBitmap = null;
-        Display display = ((WindowManager) ctx
-                .getSystemService(Context.WINDOW_SERVICE)).getDefaultDisplay();
-        int width = display.getWidth();
-        int height = display.getHeight();
-        if (width > height)
-            width = height;
         ImageHelper ih = new ImageHelper();
 
         Map<String, Object> mediaData = ih.getImageBytesForPath(src, ctx);
 
         if (mediaData != null) {
+            Bitmap resizedBitmap = ih.getThumbnailForWPImageSpan(ctx, (byte[]) mediaData.get("bytes"), (String) mediaData.get("orientation"));
 
-            BitmapFactory.Options opts = new BitmapFactory.Options();
-            opts.inJustDecodeBounds = true;
-            byte[] bytes = (byte[]) mediaData.get("bytes");
-            BitmapFactory.decodeByteArray(bytes, 0, bytes.length, opts);
-
-            float conversionFactor = 0.25f;
-
-            if (opts.outWidth > opts.outHeight)
-                conversionFactor = 0.40f;
-
-            byte[] finalBytes = ih.createThumbnail(
-                    (byte[]) mediaData.get("bytes"), String.valueOf((int) (width * conversionFactor)),
-                    (String) mediaData.get("orientation"), true);
-
-            if (finalBytes == null)
-                return;
-
-            resizedBitmap = BitmapFactory.decodeByteArray(finalBytes, 0,
-                    finalBytes.length);
             int len = text.length();
             text.append("\uFFFC");
 
@@ -878,15 +853,8 @@ private static void startImg(SpannableStringBuilder text,
             // get the MediaFile data from db
             MediaFile mf = WordPress.wpDB.getMediaFile(src, post);
             if (mf != null) {
-                is.setTitle(mf.getTitle());
-                is.setDescription(mf.getDescription());
-                is.setCaption(mf.getCaption());
-                is.setFeatured(mf.isFeatured());
-                is.setFeaturedInPost(mf.isFeaturedInPost());
-                is.setHorizontalAlignment(mf.getHorizontalAlignment());
+                is.setMediaFile(mf);
                 is.setImageSource(curStream);
-                is.setWidth(mf.getWidth());
-                is.setVideo(mf.isVideo());
                 text.setSpan(is, len, text.length(),
                         Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
                 AlignmentSpan.Standard as = new AlignmentSpan.Standard(
diff --git a/src/org/wordpress/android/util/WPImageSpan.java b/src/org/wordpress/android/util/WPImageSpan.java
index 6fc953d69885..0087eadf9857 100644
--- a/src/org/wordpress/android/util/WPImageSpan.java
+++ b/src/org/wordpress/android/util/WPImageSpan.java
@@ -4,171 +4,87 @@
 
 import android.content.Context;
 import android.graphics.Bitmap;
+import android.graphics.BitmapFactory;
+import android.graphics.Canvas;
+import android.graphics.Color;
+import android.graphics.Paint;
 import android.net.Uri;
 import android.text.style.ImageSpan;
-//import android.util.Log;
 
-public class WPImageSpan extends ImageSpan {
-
-        private Uri imageSource = null;
-
-        private int width = 500;
-        private String title = "";
-        private String description = "";
-        private String caption = "";
-        private int horizontalAlignment = 0;
-        private boolean isVideo;
-        private boolean featured = false;
-        private boolean featuredInPost = false;
-        private String mediaId;
-        private int height;
-        private String mimeType;
-        private String thumbnailURL;
-        private boolean networkImageLoaded = false;
-
-        private String fileName;
-
-        private long date_created_gmt;
-
-        public WPImageSpan(Context context, Bitmap b, Uri src) {
-            super(context, b);
-            this.imageSource = src;
-        }
-
-        public WPImageSpan(Context context, int resId, Uri src) {
-            super(context, resId);
-            this.imageSource = src;
-        }
-        
-        public String getTitle() {
-            return title;
-        }
-
-        public void setTitle(String title) {
-            this.title = title;
-        }
-
-        public String getDescription() {
-            return description;
-        }
-
-        public void setDescription(String description) {
-            this.description = description;
-        }
-
-        public int getHorizontalAlignment() {
-            return horizontalAlignment;
-        }
-
-        public void setHorizontalAlignment(int horizontalAlignment) {
-            this.horizontalAlignment = horizontalAlignment;
-        }
-
-        public void setImageSource(Uri imageSource) {
-            this.imageSource = imageSource;
-        }
-
-        public Uri getImageSource() {
-                return imageSource;
-        }
-
-        public int getWidth() {
-            return width;
-        }
-
-        public void setWidth(int width) {
-            this.width = width;
-        }
-
-        public String getCaption() {
-            return caption;
-        }
-
-        public void setCaption(String caption) {
-            this.caption = caption;
-        }
-
-        public boolean isFeatured() {
-            return featured;
-        }
-
-        public void setFeatured(boolean featured) {
-            this.featured = featured;
-        }
+import org.wordpress.android.R;
+import org.wordpress.android.models.MediaFile;
+import org.wordpress.android.ui.posts.EditPostActivity;
 
-        public boolean isFeaturedInPost() {
-            return featuredInPost;
-        }
-
-        public void setFeaturedInPost(boolean featuredInPost) {
-            this.featuredInPost = featuredInPost;
-        }
-
-        public boolean isVideo() {
-            return isVideo;
-        }
-
-        public void setVideo(boolean isVideo) {
-            this.isVideo = isVideo;
-        }
-
-        // methods below for use when WPImageSpan uses media files from the server
-        
-        public String getMediaId() {
-            return mediaId;
-        }
-
-        public void setMediaId(String mediaId) {
-            this.mediaId = mediaId;
-        }
-
-        public void setHeight(int height) {
-            this.height = height;
-        }
-        
-        public int getHeight() {
-            return height;
-        }
-
-        public void setMimeType(String mimeType) {
-            this.mimeType = mimeType;
-        }
-        
-        public String getMimeType() {
-            return mimeType;
-        }
-
-        public String getThumbnailURL() {
-            return thumbnailURL;
-        }
-
-        public void setThumbnailURL(String thumbnailURL) {
-            this.thumbnailURL = thumbnailURL;
-        }
-
-        public boolean isNetworkImageLoaded() {
-            return networkImageLoaded;
-        }
-
-        public void setNetworkImageLoaded(boolean networkImageLoaded) {
-            this.networkImageLoaded = networkImageLoaded;
-        }
-        
-        public void setFileName(String fileName) {
-            this.fileName = fileName;
-        }
-
-        public String getFileName() {
-            return fileName;
-        }
+public class WPImageSpan extends ImageSpan {
 
-        public void setDateCreatedGMT(long date) {
-            this.date_created_gmt = date;
-        }
-        
-        public long getDateCreatedGMT() {
-            return date_created_gmt;
-        }
-        
-        // -- end of methods for media files from the server
+    private Context mContext;
+
+    private Uri mImageSource = null;
+    private boolean mNetworkImageLoaded = false;
+    private boolean mIsInPostEditor;
+
+    private MediaFile mMediaFile;
+
+    public WPImageSpan(Context context, Bitmap b, Uri src) {
+        super(context, b);
+        this.mImageSource = src;
+        mContext = context;
+        mMediaFile = new MediaFile();
+        if (mContext instanceof EditPostActivity)
+            mIsInPostEditor = true;
+    }
+
+    public WPImageSpan(Context context, int resId, Uri src) {
+        super(context, resId);
+        this.mImageSource = src;
+        mContext = context;
+        mMediaFile = new MediaFile();
+        if (mContext instanceof EditPostActivity)
+            mIsInPostEditor = true;
+    }
+
+    public MediaFile getMediaFile() {
+        return mMediaFile;
+    }
+
+    public void setMediaFile(MediaFile mMediaFile) {
+        this.mMediaFile = mMediaFile;
+    }
+
+    public void setImageSource(Uri mImageSource) {
+        this.mImageSource = mImageSource;
+    }
+
+    public Uri getImageSource() {
+        return mImageSource;
+    }
+
+    public boolean isNetworkImageLoaded() {
+        return mNetworkImageLoaded;
+    }
+
+    public void setNetworkImageLoaded(boolean networkImageLoaded) {
+        this.mNetworkImageLoaded = networkImageLoaded;
+    }
+
+    @Override
+    public void draw(Canvas canvas, CharSequence text,
+                     int start, int end, float x,
+                     int top, int y, int bottom, Paint paint) {
+        super.draw(canvas, text, start, end, x, top, y, bottom, paint);
+
+        if (mIsInPostEditor) {
+            // Add 'edit' icon at bottom right of image
+            int width = getSize(paint, text, start, end, paint.getFontMetricsInt());
+            Bitmap editIconBitmap = BitmapFactory.decodeResource(mContext.getResources(), R.drawable.ab_icon_edit);
+            float editIconXPosition = (x + width) - editIconBitmap.getWidth();
+            float editIconYPosition = bottom - editIconBitmap.getHeight();
+            // Add a black background with a bit of alpha
+            Paint bgPaint = new Paint();
+            bgPaint.setColor(Color.argb(200, 0, 0, 0));
+            canvas.drawRect(editIconXPosition, editIconYPosition, editIconXPosition + editIconBitmap.getWidth(), editIconYPosition + editIconBitmap.getHeight(), bgPaint);
+            // Add the icon to the canvas
+            canvas.drawBitmap(editIconBitmap, editIconXPosition, editIconYPosition, paint);
+        }
+    }
 }
diff --git a/src/org/xmlrpc/android/ApiHelper.java b/src/org/xmlrpc/android/ApiHelper.java
index d828a3faa2eb..49da3084584f 100644
--- a/src/org/xmlrpc/android/ApiHelper.java
+++ b/src/org/xmlrpc/android/ApiHelper.java
@@ -656,7 +656,7 @@ protected String doInBackground(List<?>... params) {
          
             Map<String, Object> data = new HashMap<String, Object>();
             data.put("name", mMediaFile.getFileName());
-            data.put("type", mMediaFile.getMIMEType());
+            data.put("type", mMediaFile.getMimeType());
             data.put("bits", mMediaFile);
             data.put("overwrite", true);
             
