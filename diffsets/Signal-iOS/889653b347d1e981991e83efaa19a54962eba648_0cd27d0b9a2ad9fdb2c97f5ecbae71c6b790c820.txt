diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentMessage.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentMessage.swift
index 170d97782ac..b6085f38d63 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentMessage.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentMessage.swift
@@ -836,9 +836,7 @@ public class CVComponentMessage: CVComponentBase, CVRootComponent {
                 subviewSizes.append(subviewSize)
             }
             let subviewInfos: [ManualStackSubviewInfo] = subviewSizes.map { subviewSize in
-                (stackConfig.axis == .horizontal
-                    ? subviewSize.asManualSubviewInfo(hasFixedWidth: true)
-                    : subviewSize.asManualSubviewInfo(hasFixedHeight: true))
+                subviewSize.asManualSubviewInfo
             }
             let stackMeasurement = ManualStackView.measure(config: stackConfig,
                                                            measurementBuilder: measurementBuilder,
@@ -913,7 +911,7 @@ public class CVComponentMessage: CVComponentBase, CVRootComponent {
             }
 
             let subviewInfos: [ManualStackSubviewInfo] = subviewSizes.map { subviewSize in
-                subviewSize.asManualSubviewInfo(hasFixedHeight: true)
+                subviewSize.asManualSubviewInfo
             }
             return ManualStackView.measure(config: buildNoMarginsStackConfig(),
                                            measurementBuilder: measurementBuilder,
@@ -1128,7 +1126,7 @@ public class CVComponentMessage: CVComponentBase, CVRootComponent {
         // * Message Selection UI
         // * hInnerStack
         // * "Send failure" badge
-        fileprivate let hOuterStack = ManualStackView(name: "hOuterStack")
+        fileprivate let hOuterStack = ManualStackView(name: "message.hOuterStack")
 
         // Contains the cell contents which are arranged horizontally:
         //
@@ -1138,21 +1136,21 @@ public class CVComponentMessage: CVComponentBase, CVRootComponent {
         // Additionally, it contains:
         //
         // * Reactions view, which uses a custom layout block.
-        fileprivate let hInnerStack = ManualStackView(name: "hInnerStack")
+        fileprivate let hInnerStack = ManualStackView(name: "message.hInnerStack")
 
         fileprivate let avatarView = AvatarImageView()
 
         fileprivate let bubbleView = OWSBubbleView()
 
         // Contains the actual renderable message content, arranged vertically.
-        fileprivate let contentStack = ManualStackView(name: "contentStack")
+        fileprivate let contentStack = ManualStackView(name: "message.contentStack")
 
         // We use these stack views when there is a mixture of subcomponents,
         // some of which are full-width and some of which are not.
-        fileprivate let topFullWidthStackView = ManualStackView(name: "topFullWidthStackView")
-        fileprivate let topNestedStackView = ManualStackView(name: "topNestedStackView")
-        fileprivate let bottomFullWidthStackView = ManualStackView(name: "bottomFullWidthStackView")
-        fileprivate let bottomNestedStackView = ManualStackView(name: "bottomNestedStackView")
+        fileprivate let topFullWidthStackView = ManualStackView(name: "message.topFullWidthStackView")
+        fileprivate let topNestedStackView = ManualStackView(name: "message.topNestedStackView")
+        fileprivate let bottomFullWidthStackView = ManualStackView(name: "message.bottomFullWidthStackView")
+        fileprivate let bottomNestedStackView = ManualStackView(name: "message.bottomNestedStackView")
 
         fileprivate let selectionView = MessageSelectionView()
 
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSystemMessage.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSystemMessage.swift
index 4270fc2805e..7d3e4053b41 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSystemMessage.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSystemMessage.swift
@@ -42,26 +42,22 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
             owsAssertDebug(cellView.subviews.isEmpty)
 
             cellView.addSubview(rootView)
-            cellView.layoutMargins = cellLayoutMargins
-            rootView.autoPinEdgesToSuperviewMargins()
+            rootView.autoPinEdgesToSuperviewEdges()
         }
     }
 
-    private var cellLayoutMargins: UIEdgeInsets {
-        UIEdgeInsets(top: 0,
-                     leading: conversationStyle.fullWidthGutterLeading,
-                     bottom: 0,
-                     trailing: conversationStyle.fullWidthGutterTrailing)
-    }
-
-    private var outerStackConfig: CVStackViewConfig {
-        CVStackViewConfig(axis: .horizontal,
-                          alignment: .fill,
-                          spacing: ConversationStyle.messageStackSpacing,
-                          layoutMargins: .zero)
+    private var outerHStackConfig: CVStackViewConfig {
+        let cellLayoutMargins = UIEdgeInsets(top: 0,
+                                             leading: conversationStyle.fullWidthGutterLeading,
+                                             bottom: 0,
+                                             trailing: conversationStyle.fullWidthGutterTrailing)
+        return CVStackViewConfig(axis: .horizontal,
+                                 alignment: .fill,
+                                 spacing: ConversationStyle.messageStackSpacing,
+                                 layoutMargins: cellLayoutMargins)
     }
 
-    private var vStackConfig: CVStackViewConfig {
+    private var innerVStackConfig: CVStackViewConfig {
         let layoutMargins = UIEdgeInsets(hMargin: 10, vMargin: 8)
         return CVStackViewConfig(axis: .vertical,
                                  alignment: .center,
@@ -69,8 +65,8 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
                                  layoutMargins: layoutMargins)
     }
 
-    private var hStackConfig: CVStackViewConfig {
-        return CVStackViewConfig(axis: .horizontal,
+    private var outerVStackConfig: CVStackViewConfig {
+        return CVStackViewConfig(axis: .vertical,
                                  alignment: .center,
                                  spacing: 0,
                                  layoutMargins: .zero)
@@ -88,43 +84,6 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
             return
         }
 
-        let outerStack = componentView.outerStack
-        let vStackView = componentView.vStackView
-        let hStackView = componentView.hStackView
-        let selectionView = componentView.selectionView
-        let titleLabel = componentView.titleLabel
-
-        if isShowingSelectionUI {
-            selectionView.isSelected = componentDelegate.cvc_isMessageSelected(interaction)
-        }
-        selectionView.isHiddenInStackView = !isShowingSelectionUI
-
-        titleLabelConfig.applyForRendering(label: titleLabel)
-        titleLabel.accessibilityLabel = titleLabelConfig.stringValue
-
-        let isReusing = componentView.rootView.superview != nil
-        if !isReusing {
-            outerStack.apply(config: outerStackConfig)
-            vStackView.apply(config: vStackConfig)
-            hStackView.apply(config: hStackConfig)
-
-            outerStack.addArrangedSubview(selectionView)
-            outerStack.addArrangedSubview(.spacer(withWidth: 4))
-            outerStack.addArrangedSubview(hStackView)
-            outerStack.addArrangedSubview(.spacer(withWidth: 4))
-
-            let leadingSpacer = UIView.hStretchingSpacer()
-            let trailingSpacer = UIView.hStretchingSpacer()
-
-            hStackView.addArrangedSubview(leadingSpacer)
-            hStackView.addArrangedSubview(vStackView)
-            hStackView.addArrangedSubview(trailingSpacer)
-
-            leadingSpacer.autoMatch(.width, to: .width, of: trailingSpacer)
-
-            vStackView.addArrangedSubview(titleLabel)
-        }
-
         let themeHasChanged = conversationStyle.isDarkThemeEnabled != componentView.isDarkThemeEnabled
         componentView.isDarkThemeEnabled = conversationStyle.isDarkThemeEnabled
 
@@ -134,11 +93,93 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
 
         let isFirstInCluster = itemModel.itemViewState.isFirstInCluster
         let isLastInCluster = itemModel.itemViewState.isLastInCluster
-        let hasClusteringChanges = componentView.isFirstInCluster != isFirstInCluster || componentView.isLastInCluster != isLastInCluster
+        let hasClusteringChanges = (componentView.isFirstInCluster != isFirstInCluster ||
+                                        componentView.isLastInCluster != isLastInCluster)
         componentView.isFirstInCluster = isFirstInCluster
         componentView.isLastInCluster = isLastInCluster
 
-        if !isReusing || themeHasChanged || wallpaperModeHasChanged || hasClusteringChanges {
+        let outerHStack = componentView.outerHStack
+        let innerVStack = componentView.innerVStack
+        let outerVStack = componentView.outerVStack
+        let selectionView = componentView.selectionView
+        let titleLabel = componentView.titleLabel
+
+        titleLabelConfig.applyForRendering(label: titleLabel)
+        titleLabel.accessibilityLabel = titleLabelConfig.stringValue
+
+        var innerVStackViews: [UIView] = [
+            titleLabel
+        ]
+        let outerVStackViews = [
+            innerVStack
+        ]
+        var outerHStackViews = [UIView]()
+        if isShowingSelectionUI {
+            selectionView.isSelected = componentDelegate.cvc_isMessageSelected(interaction)
+            outerHStackViews.append(selectionView)
+        }
+        outerHStackViews.append(contentsOf: [
+            UIView.transparentSpacer(),
+            outerVStack,
+            UIView.transparentSpacer()
+        ])
+
+        if let action = action,
+           !itemViewState.shouldCollapseSystemMessageAction,
+           let actionButtonSize = cellMeasurement.size(key: Self.measurementKey_buttonSize) {
+
+            let buttonLabelConfig = self.buttonLabelConfig(action: action)
+            let button = OWSButton(title: action.title) {}
+            componentView.button = button
+            button.accessibilityIdentifier = action.accessibilityIdentifier
+            button.titleLabel?.textAlignment = .center
+            button.titleLabel?.font = buttonLabelConfig.font
+            button.setTitleColor(buttonLabelConfig.textColor, for: .normal)
+            if nil == interaction as? OWSGroupCallMessage {
+                if isDarkThemeEnabled && hasWallpaper {
+                    button.backgroundColor = .ows_gray65
+                } else {
+                    button.backgroundColor = Theme.conversationButtonBackgroundColor
+                }
+            }
+            button.contentEdgeInsets = buttonContentEdgeInsets
+            button.layer.cornerRadius = actionButtonSize.height / 2
+            button.isUserInteractionEnabled = false
+            innerVStackViews.append(button)
+        }
+
+        let isReusing = (componentView.rootView.superview != nil &&
+                            !themeHasChanged &&
+                            !wallpaperModeHasChanged &&
+                            !hasClusteringChanges &&
+                            componentView.isShowingSelectionUI == isShowingSelectionUI)
+        if isReusing {
+            innerVStack.configureForReuse(config: innerVStackConfig,
+                                          cellMeasurement: cellMeasurement,
+                                          measurementKey: Self.measurementKey_innerVStack)
+            outerVStack.configureForReuse(config: outerVStackConfig,
+                                          cellMeasurement: cellMeasurement,
+                                          measurementKey: Self.measurementKey_outerVStack)
+            outerHStack.configureForReuse(config: outerHStackConfig,
+                                          cellMeasurement: cellMeasurement,
+                                          measurementKey: Self.measurementKey_outerHStack)
+        } else {
+            outerHStack.reset()
+            innerVStack.reset()
+            outerVStack.reset()
+            innerVStack.configure(config: innerVStackConfig,
+                                  cellMeasurement: cellMeasurement,
+                                  measurementKey: Self.measurementKey_innerVStack,
+                                  subviews: innerVStackViews)
+            outerVStack.configure(config: outerVStackConfig,
+                                  cellMeasurement: cellMeasurement,
+                                  measurementKey: Self.measurementKey_outerVStack,
+                                  subviews: outerVStackViews)
+            outerHStack.configure(config: outerHStackConfig,
+                                  cellMeasurement: cellMeasurement,
+                                  measurementKey: Self.measurementKey_outerHStack,
+                                  subviews: outerHStackViews)
+
             componentView.blurView?.removeFromSuperview()
             componentView.blurView = nil
 
@@ -158,16 +199,15 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
                 backgroundView.backgroundColor = Theme.backgroundColor
             }
 
-            vStackView.insertSubview(bubbleView, at: 0)
-            bubbleView.autoPinVerticalEdges(toEdgesOf: hStackView)
-
             if isFirstInCluster && isLastInCluster {
-                bubbleView.autoPinHorizontalEdges(toEdgesOf: vStackView)
+                innerVStack.addSubviewToFillSuperviewEdges(bubbleView)
+                innerVStack.sendSubviewToBack(bubbleView)
 
                 bubbleView.layer.cornerRadius = 8
                 bubbleView.clipsToBounds = true
             } else {
-                bubbleView.autoPinHorizontalEdges(toEdgesOf: hStackView)
+                outerVStack.addSubviewToFillSuperviewEdges(bubbleView)
+                outerVStack.sendSubviewToBack(bubbleView)
 
                 if isFirstInCluster {
                     bubbleView.layer.cornerRadius = 12
@@ -180,31 +220,7 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
                 }
             }
         }
-
-        if let action = action, !itemViewState.shouldCollapseSystemMessageAction {
-            let button = OWSButton(title: action.title) {}
-            componentView.button = button
-            button.accessibilityIdentifier = action.accessibilityIdentifier
-            button.titleLabel?.textAlignment = .center
-            button.titleLabel?.font = UIFont.ows_dynamicTypeFootnote.ows_semibold
-            if nil != interaction as? OWSGroupCallMessage {
-                let buttonTitleColor: UIColor = Theme.isDarkThemeEnabled ? .ows_whiteAlpha90 : .white
-                button.setTitleColor(buttonTitleColor, for: .normal)
-                button.backgroundColor = UIColor.ows_accentGreen
-            } else {
-                button.setTitleColor(Theme.conversationButtonTextColor, for: .normal)
-                if isDarkThemeEnabled && hasWallpaper {
-                    button.backgroundColor = .ows_gray65
-                } else {
-                    button.backgroundColor = Theme.conversationButtonBackgroundColor
-                }
-            }
-            button.contentEdgeInsets = UIEdgeInsets(top: 3, leading: 12, bottom: 3, trailing: 12)
-            button.layer.cornerRadius = buttonHeight / 2
-            button.autoSetDimension(.height, toSize: buttonHeight)
-            button.isUserInteractionEnabled = false
-            vStackView.addArrangedSubview(button)
-        }
+        componentView.isShowingSelectionUI = isShowingSelectionUI
     }
 
     private var titleLabelConfig: CVLabelConfig {
@@ -216,42 +232,106 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
                       textAlignment: .center)
     }
 
+    private func buttonLabelConfig(action: CVMessageAction) -> CVLabelConfig {
+        let textColor: UIColor
+        if nil != interaction as? OWSGroupCallMessage {
+            textColor = Theme.isDarkThemeEnabled ? .ows_whiteAlpha90 : .white
+        } else {
+            textColor = Theme.conversationButtonTextColor
+        }
+        return CVLabelConfig(text: action.title,
+                             font: UIFont.ows_dynamicTypeFootnote.ows_semibold,
+                             textColor: textColor,
+                             textAlignment: .center)
+    }
+
+    private var buttonContentEdgeInsets: UIEdgeInsets {
+        UIEdgeInsets(top: 3, leading: 12, bottom: 3, trailing: 12)
+    }
+
     private static var titleLabelFont: UIFont {
         UIFont.ows_dynamicTypeFootnote
     }
 
+    private static let measurementKey_outerHStack = "CVComponentFooter.measurementKey_outerHStack"
+    private static let measurementKey_innerVStack = "CVComponentFooter.measurementKey_innerVStack"
+    private static let measurementKey_outerVStack = "CVComponentFooter.measurementKey_outerVStack"
+    private static let measurementKey_buttonSize = "CVComponentFooter.measurementKey_buttonSize"
+
     public func measure(maxWidth: CGFloat, measurementBuilder: CVCellMeasurement.Builder) -> CGSize {
         owsAssertDebug(maxWidth > 0)
 
-        var availableWidth = max(0, maxWidth - cellLayoutMargins.totalWidth)
+        var maxContentWidth = (maxWidth -
+                                (outerHStackConfig.layoutMargins.totalWidth +
+                                    outerVStackConfig.layoutMargins.totalWidth +
+                                    innerVStackConfig.layoutMargins.totalWidth))
+        Logger.verbose("maxContentWidth.1: \(maxContentWidth)")
+
+        let selectionViewSize = CGSize(width: ConversationStyle.selectionViewWidth, height: 0)
         if isShowingSelectionUI {
             // Account for selection UI when doing measurement.
-            availableWidth -= ConversationStyle.selectionViewWidth + outerStackConfig.spacing
+            maxContentWidth -= selectionViewSize.width + outerHStackConfig.spacing
         }
+        Logger.verbose("maxContentWidth.2: \(maxContentWidth)")
 
-        // Padding around the hStack (leading and trailing side)
-        availableWidth -= (outerStackConfig.spacing + 4) * 2
+        // Padding around the outerVStack (leading and trailing side)
+        maxContentWidth -= (outerHStackConfig.spacing + minBubbleHMargin) * 2
+        Logger.verbose("maxContentWidth.3: \(maxContentWidth)")
 
-        // Padding around the vStackView
-        availableWidth -= vStackConfig.layoutMargins.totalWidth
+        maxContentWidth = max(0, maxContentWidth)
 
-        var height: CGFloat = 0
+        Logger.verbose("maxWidth: \(maxWidth)")
+        Logger.verbose("maxContentWidth: \(maxContentWidth)")
+        Logger.verbose("outerHStackConfig.layoutMargins.totalWidth: \(outerHStackConfig.layoutMargins.totalWidth)")
 
         let titleSize = CVText.measureLabel(config: titleLabelConfig,
-                                            maxWidth: availableWidth)
-        height += titleSize.height
-        height += cellLayoutMargins.totalHeight
-        if action != nil, !itemViewState.shouldCollapseSystemMessageAction {
-            height += buttonHeight + vStackConfig.spacing
-        }
-        height += vStackConfig.layoutMargins.totalHeight
+                                            maxWidth: maxContentWidth)
 
-        // Full width.
-        return CGSize(width: maxWidth, height: height).ceil
+        var innerVStackSubviewInfos = [ManualStackSubviewInfo]()
+        innerVStackSubviewInfos.append(titleSize.asManualSubviewInfo)
+        if let action = action, !itemViewState.shouldCollapseSystemMessageAction {
+            let buttonLabelConfig = self.buttonLabelConfig(action: action)
+            let actionButtonSize = (CVText.measureLabel(config: buttonLabelConfig,
+                                                       maxWidth: maxContentWidth) +
+                                        buttonContentEdgeInsets.asSize)
+            measurementBuilder.setSize(key: Self.measurementKey_buttonSize, size: actionButtonSize)
+            innerVStackSubviewInfos.append(actionButtonSize.asManualSubviewInfo(hasFixedSize: true))
+            Logger.verbose("actionButtonSize: \(actionButtonSize)")
+        }
+        let innerVStackMeasurement = ManualStackView.measure(config: innerVStackConfig,
+                                                             measurementBuilder: measurementBuilder,
+                                                             measurementKey: Self.measurementKey_innerVStack,
+                                                             subviewInfos: innerVStackSubviewInfos)
+
+        let outerVStackSubviewInfos: [ManualStackSubviewInfo] = [
+            innerVStackMeasurement.measuredSize.asManualSubviewInfo
+        ]
+        let outerVStackMeasurement = ManualStackView.measure(config: outerVStackConfig,
+                                                             measurementBuilder: measurementBuilder,
+                                                             measurementKey: Self.measurementKey_outerVStack,
+                                                             subviewInfos: outerVStackSubviewInfos)
+
+        var outerHStackSubviewInfos = [ManualStackSubviewInfo]()
+        if isShowingSelectionUI {
+            outerHStackSubviewInfos.append(selectionViewSize.asManualSubviewInfo(hasFixedWidth: true))
+        }
+        outerHStackSubviewInfos.append(contentsOf: [
+            CGSize(width: minBubbleHMargin, height: 0).asManualSubviewInfo(hasFixedWidth: true),
+            outerVStackMeasurement.measuredSize.asManualSubviewInfo,
+            CGSize(width: minBubbleHMargin, height: 0).asManualSubviewInfo(hasFixedWidth: true)
+        ])
+        let outerHStackMeasurement = ManualStackView.measure(config: outerHStackConfig,
+                                                             measurementBuilder: measurementBuilder,
+                                                             measurementKey: Self.measurementKey_outerHStack,
+                                                             subviewInfos: outerHStackSubviewInfos)
+        Logger.verbose("titleSize: \(titleSize)")
+        Logger.verbose("innerVStackMeasurement: \(innerVStackMeasurement.measuredSize)")
+        Logger.verbose("outerVStackMeasurement: \(outerVStackMeasurement.measuredSize)")
+        Logger.verbose("outerHStackMeasurement: \(outerHStackMeasurement.measuredSize)")
+        return outerHStackMeasurement.measuredSize
     }
 
-    // Should this reflect dynamic type used in the button?
-    private let buttonHeight: CGFloat = 28
+    private let minBubbleHMargin: CGFloat = 4
 
     // MARK: - Events
 
@@ -306,9 +386,9 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
     @objc
     public class CVComponentViewSystemMessage: NSObject, CVComponentView {
 
-        fileprivate let outerStack = OWSStackView(name: "systemMessage.outerStack")
-        fileprivate let vStackView = OWSStackView(name: "systemMessage.vStackView")
-        fileprivate let hStackView = OWSStackView(name: "systemMessage.hStackView")
+        fileprivate let outerHStack = ManualStackView(name: "systemMessage.outerHStack")
+        fileprivate let innerVStack = ManualStackView(name: "systemMessage.innerVStack")
+        fileprivate let outerVStack = ManualStackView(name: "systemMessage.outerVStack")
         fileprivate let titleLabel = UILabel()
         fileprivate let selectionView = MessageSelectionView()
 
@@ -324,8 +404,10 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
 
         public var isDedicatedCellView = false
 
+        public var isShowingSelectionUI = false
+
         public var rootView: UIView {
-            outerStack
+            outerHStack
         }
 
         // MARK: -
@@ -342,9 +424,9 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
             owsAssertDebug(isDedicatedCellView)
 
             if !isDedicatedCellView {
-                outerStack.reset()
-                vStackView.reset()
-                hStackView.reset()
+                outerHStack.reset()
+                innerVStack.reset()
+                outerVStack.reset()
 
                 blurView?.removeFromSuperview()
                 blurView = nil
@@ -362,6 +444,8 @@ public class CVComponentSystemMessage: CVComponentBase, CVRootComponent {
 
             button?.removeFromSuperview()
             button = nil
+
+            isShowingSelectionUI = false
         }
     }
 }
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVStackView.swift b/Signal/src/ViewControllers/ConversationView/CV/CVStackView.swift
index 54947501736..51937bd0fbb 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVStackView.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVStackView.swift
@@ -11,7 +11,8 @@ public typealias CVStackViewConfig = OWSStackView.Config
 class CVStackView {
 
     public static func measure(config: CVStackViewConfig,
-                               subviewSizes: [CGSize]) -> CGSize {
+                               subviewSizes: [CGSize],
+                               verboseLogging: Bool = false) -> CGSize {
 
         let spacingCount = max(0, subviewSizes.count - 1)
 
@@ -21,12 +22,28 @@ class CVStackView {
             size.width = subviewSizes.map { $0.width }.reduce(0, +)
             size.height = subviewSizes.map { $0.height }.reduce(0, max)
 
+            if verboseLogging {
+                Logger.verbose("size of subviews: \(size)")
+            }
+
             size.width += CGFloat(spacingCount) * config.spacing
+
+            if verboseLogging {
+                Logger.verbose("size of subviews and spacing: \(size)")
+            }
         case .vertical:
             size.width = subviewSizes.map { $0.width }.reduce(0, max)
             size.height = subviewSizes.map { $0.height }.reduce(0, +)
 
+            if verboseLogging {
+                Logger.verbose("size of subviews: \(size)")
+            }
+
             size.height += CGFloat(spacingCount) * config.spacing
+
+            if verboseLogging {
+                Logger.verbose("size of subviews and spacing: \(size)")
+            }
         @unknown default:
             owsFailDebug("Unknown axis: \(config.axis)")
         }
@@ -34,6 +51,9 @@ class CVStackView {
         size.width += config.layoutMargins.left + config.layoutMargins.right
         size.height += config.layoutMargins.top + config.layoutMargins.bottom
 
+        if verboseLogging {
+            Logger.verbose("size of subviews and spacing and layoutMargins: \(size)")
+        }
         return size
     }
 }
@@ -79,11 +99,24 @@ public extension ManualStackView {
                   subviews: subviews)
     }
 
+    func configureForReuse(config: Config,
+                           cellMeasurement: CVCellMeasurement,
+                           measurementKey: String) {
+        guard let measurement = cellMeasurement.measurement(key: measurementKey) else {
+            owsFailDebug("Missing measurement.")
+            return
+        }
+        configureForReuse(config: config, measurement: measurement)
+    }
+
     static func measure(config: Config,
                         measurementBuilder: CVCellMeasurement.Builder,
                         measurementKey: String,
-                        subviewInfos: [ManualStackSubviewInfo]) -> Measurement {
-        let measurement = Self.measure(config: config, subviewInfos: subviewInfos)
+                        subviewInfos: [ManualStackSubviewInfo],
+                        verboseLogging: Bool = false) -> Measurement {
+        let measurement = Self.measure(config: config,
+                                       subviewInfos: subviewInfos,
+                                       verboseLogging: verboseLogging)
         measurementBuilder.setMeasurement(key: measurementKey, value: measurement)
         return measurement
     }
diff --git a/SignalMessaging/Views/ManualStackView.swift b/SignalMessaging/Views/ManualStackView.swift
index e9e83467d98..9b8d6c4d8d2 100644
--- a/SignalMessaging/Views/ManualStackView.swift
+++ b/SignalMessaging/Views/ManualStackView.swift
@@ -193,6 +193,13 @@ open class ManualStackView: ManualLayoutView {
         invalidateArrangement()
     }
 
+    public func configureForReuse(config: Config, measurement: Measurement) {
+        apply(config: config)
+        self.measurement = measurement
+
+        invalidateArrangement()
+    }
+
     private func ensureArrangement() -> Arrangement? {
         if let arrangement = arrangement {
             return arrangement
@@ -201,6 +208,8 @@ open class ManualStackView: ManualLayoutView {
             owsFailDebug("\(name): Missing measurement.")
             return nil
         }
+        // Ignore hidden subviews.
+        let arrangedSubviews = self.arrangedSubviews.filter { !$0.isHidden }
         if arrangedSubviews.count > measurement.subviewInfos.count {
             owsFailDebug("\(name): arrangedSubviews: \(arrangedSubviews.count) != subviewInfos: \(measurement.subviewInfos.count)")
         }
@@ -217,10 +226,7 @@ open class ManualStackView: ManualLayoutView {
                 owsFailDebug("\(name): Missing measuredSize.")
                 break
             }
-            guard !subview.isHidden else {
-                // Ignore hidden subviews.
-                continue
-            }
+            owsAssertDebug(!subview.isHidden)
             layoutItems.append(LayoutItem(subview: subview,
                                           subviewInfo: subviewInfo,
                                           isHorizontal: isHorizontal))
@@ -503,7 +509,9 @@ open class ManualStackView: ManualLayoutView {
         }
     }
 
-    public static func measure(config: Config, subviewInfos: [ManualStackSubviewInfo]) -> Measurement {
+    public static func measure(config: Config,
+                               subviewInfos: [ManualStackSubviewInfo],
+                               verboseLogging: Bool = false) -> Measurement {
 
         let subviewSizes = subviewInfos.map { $0.measuredSize.max(.zero) }
 
@@ -515,12 +523,28 @@ open class ManualStackView: ManualLayoutView {
             size.width = subviewSizes.map { $0.width }.reduce(0, +)
             size.height = subviewSizes.map { $0.height }.reduce(0, max)
 
+            if verboseLogging {
+                Logger.verbose("size of subviews: \(size)")
+            }
+
             size.width += CGFloat(spacingCount) * config.spacing
+
+            if verboseLogging {
+                Logger.verbose("size of subviews and spacing: \(size)")
+            }
         case .vertical:
             size.width = subviewSizes.map { $0.width }.reduce(0, max)
             size.height = subviewSizes.map { $0.height }.reduce(0, +)
 
+            if verboseLogging {
+                Logger.verbose("size of subviews: \(size)")
+            }
+
             size.height += CGFloat(spacingCount) * config.spacing
+
+            if verboseLogging {
+                Logger.verbose("size of subviews and spacing: \(size)")
+            }
         @unknown default:
             owsFailDebug("Unknown axis: \(config.axis)")
         }
@@ -528,6 +552,10 @@ open class ManualStackView: ManualLayoutView {
         size.width += config.layoutMargins.totalWidth
         size.height += config.layoutMargins.totalHeight
 
+        if verboseLogging {
+            Logger.verbose("size of subviews and spacing and layoutMargins: \(size)")
+        }
+
         size = size.ceil
 
         return Measurement(measuredSize: size, subviewInfos: subviewInfos)
diff --git a/SignalMessaging/categories/UIView+OWS.swift b/SignalMessaging/categories/UIView+OWS.swift
index 53906d723fc..a1063c104e6 100644
--- a/SignalMessaging/categories/UIView+OWS.swift
+++ b/SignalMessaging/categories/UIView+OWS.swift
@@ -152,6 +152,20 @@ public extension UIView {
         return view
     }
 
+    class func transparentSpacer() -> UIView {
+        let view = TransparentSpacer()
+        view.setContentHuggingHorizontalLow()
+        view.setCompressionResistanceHorizontalLow()
+        return view
+    }
+
+    @objc
+    class TransparentSpacer: UIView {
+        override open class var layerClass: AnyClass {
+            CATransformLayer.self
+        }
+    }
+
     func applyScaleAspectFitLayout(subview: UIView, aspectRatio: CGFloat) -> [NSLayoutConstraint] {
         guard subviews.contains(subview) else {
             owsFailDebug("Not a subview.")
