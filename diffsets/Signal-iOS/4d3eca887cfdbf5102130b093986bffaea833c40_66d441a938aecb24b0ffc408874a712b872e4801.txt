diff --git a/Signal.xcodeproj/project.pbxproj b/Signal.xcodeproj/project.pbxproj
index 81961bb5e01..af1c2309f9f 100644
--- a/Signal.xcodeproj/project.pbxproj
+++ b/Signal.xcodeproj/project.pbxproj
@@ -886,6 +886,7 @@
 		66A1DF73298C635E00C4E4A7 /* RegistrationRequestFactory.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66A1DF72298C635E00C4E4A7 /* RegistrationRequestFactory.swift */; };
 		66A1DF75298C73D900C4E4A7 /* RegistrationServiceResponses.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66A1DF74298C73D900C4E4A7 /* RegistrationServiceResponses.swift */; };
 		66A22C0928A18D49007CD4F5 /* RingerSwitch.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66A22C0828A18D49007CD4F5 /* RingerSwitch.swift */; };
+		66A5F2A72A016C5E0039AAC1 /* CVInteractionIdentifier.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66A5F2A62A016C5E0039AAC1 /* CVInteractionIdentifier.swift */; };
 		66A93A8029940A8200FA0291 /* RegistrationCoordinatorImpl+Service.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66A93A7F29940A8200FA0291 /* RegistrationCoordinatorImpl+Service.swift */; };
 		66AAC2C429CB6F1100566AD6 /* RegistrationChangeNumberSplashViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66AAC2C329CB6F1100566AD6 /* RegistrationChangeNumberSplashViewController.swift */; };
 		66AAC2C629CB942F00566AD6 /* RegistrationChangePhoneNumberViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66AAC2C529CB942F00566AD6 /* RegistrationChangePhoneNumberViewController.swift */; };
@@ -921,8 +922,6 @@
 		66FC638829E8B7CC00F00DAC /* OWSQuotedMessageView.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66FC638729E8B7CC00F00DAC /* OWSQuotedMessageView.swift */; };
 		66FC638C29E9E9D200F00DAC /* TextCheckingDataItem.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66FC638B29E9E9D200F00DAC /* TextCheckingDataItem.swift */; };
 		66FC638E29EDABAC00F00DAC /* SearchDisplayConfigurations.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66FC638D29EDABAC00F00DAC /* SearchDisplayConfigurations.swift */; };
-		66FC636929DE21A600F00DAC /* NSRangeUtil.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66FC636829DE21A600F00DAC /* NSRangeUtil.swift */; };
-		66FC636B29DE27A500F00DAC /* NSRangeUtilTests.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66FC636A29DE27A500F00DAC /* NSRangeUtilTests.swift */; };
 		66FC639029EDC1E600F00DAC /* ContactSupportAlert+Registration.swift in Sources */ = {isa = PBXBuildFile; fileRef = 66FC638F29EDC1E600F00DAC /* ContactSupportAlert+Registration.swift */; };
 		76057C4B29D268A800C9EDBD /* VideoPlaybackControls.swift in Sources */ = {isa = PBXBuildFile; fileRef = 76057C4A29D268A800C9EDBD /* VideoPlaybackControls.swift */; };
 		760981882936DE90008F8300 /* BezierPathView.swift in Sources */ = {isa = PBXBuildFile; fileRef = 760981872936DE90008F8300 /* BezierPathView.swift */; };
@@ -3385,6 +3384,7 @@
 		66A1DF72298C635E00C4E4A7 /* RegistrationRequestFactory.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = RegistrationRequestFactory.swift; sourceTree = "<group>"; };
 		66A1DF74298C73D900C4E4A7 /* RegistrationServiceResponses.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = RegistrationServiceResponses.swift; sourceTree = "<group>"; };
 		66A22C0828A18D49007CD4F5 /* RingerSwitch.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = RingerSwitch.swift; sourceTree = "<group>"; };
+		66A5F2A62A016C5E0039AAC1 /* CVInteractionIdentifier.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = CVInteractionIdentifier.swift; sourceTree = "<group>"; };
 		66A93A7F29940A8200FA0291 /* RegistrationCoordinatorImpl+Service.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "RegistrationCoordinatorImpl+Service.swift"; sourceTree = "<group>"; };
 		66AAC2C329CB6F1100566AD6 /* RegistrationChangeNumberSplashViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = RegistrationChangeNumberSplashViewController.swift; sourceTree = "<group>"; };
 		66AAC2C529CB942F00566AD6 /* RegistrationChangePhoneNumberViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = RegistrationChangePhoneNumberViewController.swift; sourceTree = "<group>"; };
@@ -3419,8 +3419,6 @@
 		66FC638729E8B7CC00F00DAC /* OWSQuotedMessageView.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = OWSQuotedMessageView.swift; sourceTree = "<group>"; };
 		66FC638B29E9E9D200F00DAC /* TextCheckingDataItem.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = TextCheckingDataItem.swift; sourceTree = "<group>"; };
 		66FC638D29EDABAC00F00DAC /* SearchDisplayConfigurations.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = SearchDisplayConfigurations.swift; sourceTree = "<group>"; };
-		66FC636829DE21A600F00DAC /* NSRangeUtil.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = NSRangeUtil.swift; sourceTree = "<group>"; };
-		66FC636A29DE27A500F00DAC /* NSRangeUtilTests.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = NSRangeUtilTests.swift; sourceTree = "<group>"; };
 		66FC638F29EDC1E600F00DAC /* ContactSupportAlert+Registration.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "ContactSupportAlert+Registration.swift"; sourceTree = "<group>"; };
 		70377AAA1918450100CAF501 /* MobileCoreServices.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = MobileCoreServices.framework; path = System/Library/Frameworks/MobileCoreServices.framework; sourceTree = SDKROOT; };
 		748A5CAEDD7C919FC64C6807 /* Pods_SignalTests.framework */ = {isa = PBXFileReference; explicitFileType = wrapper.framework; includeInIndex = 0; path = Pods_SignalTests.framework; sourceTree = BUILT_PRODUCTS_DIR; };
@@ -5780,6 +5778,7 @@
 			isa = PBXGroup;
 			children = (
 				34A95523271B510400B05242 /* CVCellMeasurement.swift */,
+				66A5F2A62A016C5E0039AAC1 /* CVInteractionIdentifier.swift */,
 				34A95525271B510400B05242 /* CVText.swift */,
 				34A95522271B510400B05242 /* CVTextLabel.swift */,
 				34A95524271B510400B05242 /* CVUtils.swift */,
@@ -10745,6 +10744,7 @@
 				508F0346296F72F4001D88D0 /* CustomCellBackgroundColor.swift in Sources */,
 				3402AA7B271D9E180084CBAE /* CustomKeyboard.swift in Sources */,
 				3402AA87271D9E180084CBAE /* CVCellMeasurement.swift in Sources */,
+				66A5F2A72A016C5E0039AAC1 /* CVInteractionIdentifier.swift in Sources */,
 				3402AA92271D9E180084CBAE /* CVText.swift in Sources */,
 				3402AAB3271D9E180084CBAE /* CVTextLabel.swift in Sources */,
 				3402AA7A271D9E180084CBAE /* CVUtils.swift in Sources */,
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponentState.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponentState.swift
index 5654d53dece..c0378c62f14 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponentState.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponentState.swift
@@ -732,7 +732,7 @@ fileprivate extension CVComponentState.Builder {
                 owsFailDebug("Invalid message.")
                 return build()
             }
-            return try populateAndBuild(message: message)
+            return try populateAndBuild(message: message, spoilerReveal: self.spoilerReveal)
         case .unknown:
             owsFailDebug("Unknown interaction type.")
             return build()
@@ -770,7 +770,10 @@ fileprivate extension CVComponentState.Builder {
         return FailedOrPendingDownloads(attachmentPointers: attachmentPointers)
     }
 
-    mutating func populateAndBuild(message: TSMessage) throws -> CVComponentState {
+    mutating func populateAndBuild(
+        message: TSMessage,
+        spoilerReveal: CVSpoilerReveal
+    ) throws -> CVComponentState {
 
         if message.wasRemotelyDeleted {
             // If the message has been remotely deleted, suppress everything else.
@@ -792,7 +795,7 @@ fileprivate extension CVComponentState.Builder {
 
         // Check for quoted replies _before_ media album handling,
         // since that logic may exit early.
-        buildQuotedReply(message: message)
+        buildQuotedReply(message: message, spoilerReveal: spoilerReveal)
 
         try buildBodyText(message: message)
 
@@ -1013,23 +1016,32 @@ fileprivate extension CVComponentState.Builder {
     }
 
     // TODO: Should we validate and throw errors?
-    mutating func buildQuotedReply(message: TSMessage) {
+    mutating func buildQuotedReply(
+        message: TSMessage,
+        spoilerReveal: CVSpoilerReveal
+    ) {
         guard let quotedReplyModel = OWSQuotedReplyModel.quotedReply(from: message, transaction: transaction) else {
             return
         }
         var displayableQuotedText: DisplayableText?
         if let quotedBody = quotedReplyModel.body,
            !quotedBody.isEmpty {
-            displayableQuotedText = CVComponentState.displayableQuotedText(text: quotedBody,
-                                                                           ranges: quotedReplyModel.bodyRanges,
-                                                                           interaction: message,
-                                                                           transaction: transaction)
-        }
-        let viewState = QuotedMessageView.stateForConversation(quotedReplyModel: quotedReplyModel,
-                                                               displayableQuotedText: displayableQuotedText,
-                                                               conversationStyle: conversationStyle,
-                                                               isOutgoing: isOutgoing,
-                                                               transaction: transaction)
+            displayableQuotedText = CVComponentState.displayableQuotedText(
+                text: quotedBody,
+                ranges: quotedReplyModel.bodyRanges,
+                interaction: message,
+                spoilerReveal: spoilerReveal,
+                transaction: transaction
+            )
+        }
+        let viewState = QuotedMessageView.stateForConversation(
+            quotedReplyModel: quotedReplyModel,
+            displayableQuotedText: displayableQuotedText,
+            conversationStyle: conversationStyle,
+            spoilerReveal: spoilerReveal,
+            isOutgoing: isOutgoing,
+            transaction: transaction
+        )
         self.quotedReply = QuotedReply(viewState: viewState)
     }
 
@@ -1258,15 +1270,20 @@ public extension CVComponentState {
 
 fileprivate extension CVComponentState {
 
-    static func displayableQuotedText(text: String,
-                                      ranges: MessageBodyRanges?,
-                                      interaction: TSInteraction,
-                                      transaction: SDSAnyReadTransaction) -> DisplayableText {
+    static func displayableQuotedText(
+        text: String,
+        ranges: MessageBodyRanges?,
+        interaction: TSInteraction,
+        spoilerReveal: CVSpoilerReveal,
+        transaction: SDSAnyReadTransaction
+    ) -> DisplayableText {
         return DisplayableText.displayableText(
             withMessageBody: MessageBody(text: text, ranges: ranges ?? .empty),
             displayConfig: HydratedMessageBody.DisplayConfiguration(
                 mention: .quotedReply,
-                style: .quotedReply,
+                style: .quotedReply(revealedSpoilerIds: spoilerReveal.revealedSpoilerIds(
+                    interactionIdentifier: .fromInteraction(interaction)
+                )),
                 searchRanges: nil
             ),
             transaction: transaction
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift
index 4454ae9432c..15581a3bb38 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift
@@ -121,14 +121,15 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
 
     private static let unfairLock = UnfairLock()
 
-    private static func detectItems(
+    public static func detectItems(
         text: String,
         attributedString: NSAttributedString?,
         hasPendingMessageRequest: Bool,
         shouldAllowLinkification: Bool,
         textWasTruncated: Bool,
         revealedSpoilerIds: Set<StyleIdType>,
-        interactionUniqueId: String
+        interactionUniqueId: String,
+        interactionIdentifier: CVInteractionIdentifier
     ) -> [CVTextLabel.Item] {
 
         // Use a lock to ensure that measurement on and off the main thread
@@ -179,6 +180,7 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
                             return .unrevealedSpoiler(CVTextLabel.UnrevealedSpoilerItem(
                                 spoilerId: unrevealedSpoilerItem.id,
                                 interactionUniqueId: interactionUniqueId,
+                                interactionIdentifier: interactionIdentifier,
                                 range: unrevealedSpoilerItem.range
                             ))
                         case .mention(let mentionItem):
@@ -215,7 +217,7 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
         let searchText = viewStateSnapshot.searchText
         let isTextExpanded = textExpansion.isTextExpanded(interactionId: interaction.uniqueId)
         let revealedSpoilerIds = viewStateSnapshot.spoilerReveal.revealedSpoilerIds(
-            interactionUniqueId: interaction.uniqueId
+            interactionIdentifier: .fromInteraction(interaction)
         )
 
         let items: [CVTextLabel.Item]
@@ -235,7 +237,8 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
                     shouldAllowLinkification: shouldAllowLinkification,
                     textWasTruncated: textWasTruncated,
                     revealedSpoilerIds: revealedSpoilerIds,
-                    interactionUniqueId: interaction.uniqueId
+                    interactionUniqueId: interaction.uniqueId,
+                    interactionIdentifier: .fromInteraction(interaction)
                 )
 
                 // UILabels are much cheaper than UITextViews, and we can
@@ -259,7 +262,8 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
                     shouldAllowLinkification: shouldAllowLinkification,
                     textWasTruncated: textWasTruncated,
                     revealedSpoilerIds: revealedSpoilerIds,
-                    interactionUniqueId: interaction.uniqueId
+                    interactionUniqueId: interaction.uniqueId,
+                    interactionIdentifier: .fromInteraction(interaction)
                 )
 
                 shouldUseAttributedText = true
@@ -519,7 +523,8 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
         shouldAllowLinkification: Bool,
         textWasTruncated: Bool,
         revealedSpoilerIds: Set<StyleIdType>,
-        interactionUniqueId: String
+        interactionUniqueId: String,
+        interactionIdentifier: CVInteractionIdentifier
     ) {
 
         let items = detectItems(
@@ -529,16 +534,19 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
             shouldAllowLinkification: shouldAllowLinkification,
             textWasTruncated: textWasTruncated,
             revealedSpoilerIds: revealedSpoilerIds,
-            interactionUniqueId: interactionUniqueId
+            interactionUniqueId: interactionUniqueId,
+            interactionIdentifier: interactionIdentifier
         )
         Self.linkifyData(attributedText: attributedText,
                          linkifyStyle: linkifyStyle,
                          items: items)
     }
 
-    private static func linkifyData(attributedText: NSMutableAttributedString,
-                                    linkifyStyle: LinkifyStyle,
-                                    items: [CVTextLabel.Item]) {
+    public static func linkifyData(
+        attributedText: NSMutableAttributedString,
+        linkifyStyle: LinkifyStyle,
+        items: [CVTextLabel.Item]
+    ) {
 
         // Sort so that we can detect overlap.
         let items = items.sorted {
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVLoadContext.swift b/Signal/src/ViewControllers/ConversationView/CV/CVLoadContext.swift
index 5e1972758d4..42ae45b38ac 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVLoadContext.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVLoadContext.swift
@@ -15,21 +15,25 @@ struct CVLoadContext: CVItemBuildingContext {
     let loadRequest: CVLoadRequest
     let threadViewModel: ThreadViewModel
     let viewStateSnapshot: CVViewStateSnapshot
+    let spoilerReveal: CVSpoilerReveal
     let messageMapping: CVMessageMapping
     let prevRenderState: CVRenderState
     let transaction: SDSAnyReadTransaction
     let avatarBuilder: CVAvatarBuilder
 
-    init(loadRequest: CVLoadRequest,
-         threadViewModel: ThreadViewModel,
-         viewStateSnapshot: CVViewStateSnapshot,
-         messageMapping: CVMessageMapping,
-         prevRenderState: CVRenderState,
-         transaction: SDSAnyReadTransaction) {
-
+    init(
+        loadRequest: CVLoadRequest,
+        threadViewModel: ThreadViewModel,
+        viewStateSnapshot: CVViewStateSnapshot,
+        spoilerReveal: CVSpoilerReveal,
+        messageMapping: CVMessageMapping,
+        prevRenderState: CVRenderState,
+        transaction: SDSAnyReadTransaction
+    ) {
         self.loadRequest = loadRequest
         self.threadViewModel = threadViewModel
         self.viewStateSnapshot = viewStateSnapshot
+        self.spoilerReveal = spoilerReveal
         self.messageMapping = messageMapping
         self.prevRenderState = prevRenderState
         self.transaction = transaction
@@ -53,6 +57,7 @@ protocol CVItemBuildingContext {
     var viewStateSnapshot: CVViewStateSnapshot { get }
     var transaction: SDSAnyReadTransaction { get }
     var avatarBuilder: CVAvatarBuilder { get }
+    var spoilerReveal: CVSpoilerReveal { get }
 }
 
 // MARK: -
@@ -72,6 +77,7 @@ struct CVItemBuildingContextImpl: CVItemBuildingContext {
     let viewStateSnapshot: CVViewStateSnapshot
     let transaction: SDSAnyReadTransaction
     let avatarBuilder: CVAvatarBuilder
+    let spoilerReveal: CVSpoilerReveal
 }
 
 // MARK: -
@@ -89,6 +95,7 @@ extension CVItemBuilding {
     var threadAssociatedData: ThreadAssociatedData { threadViewModel.associatedData }
     var viewStateSnapshot: CVViewStateSnapshot { itemBuildingContext.viewStateSnapshot }
     var conversationStyle: ConversationStyle { itemBuildingContext.conversationStyle }
+    var spoilerReveal: CVSpoilerReveal { itemBuildingContext.spoilerReveal }
     var mediaCache: CVMediaCache { itemBuildingContext.mediaCache }
     var transaction: SDSAnyReadTransaction { itemBuildingContext.transaction }
     var avatarBuilder: CVAvatarBuilder { itemBuildingContext.avatarBuilder }
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVLoadCoordinator.swift b/Signal/src/ViewControllers/ConversationView/CV/CVLoadCoordinator.swift
index ad016542c81..6c9cd9e601d 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVLoadCoordinator.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVLoadCoordinator.swift
@@ -57,6 +57,7 @@ public class CVLoadCoordinator: NSObject {
     private let threadUniqueId: String
 
     private var conversationStyle: ConversationStyle
+    private let spoilerReveal: CVSpoilerReveal
 
     var renderState: CVRenderState
 
@@ -86,6 +87,7 @@ public class CVLoadCoordinator: NSObject {
         self.threadUniqueId = threadViewModel.threadRecord.uniqueId
         self.thread = threadViewModel.threadRecord
         self.conversationStyle = viewState.conversationStyle
+        self.spoilerReveal = viewState.spoilerReveal
 
         let viewStateSnapshot = CVViewStateSnapshot.snapshot(viewState: viewState,
                                                              typingIndicatorsSender: nil,
@@ -513,6 +515,7 @@ public class CVLoadCoordinator: NSObject {
         AssertIsOnMainThread()
 
         let conversationStyle = self.conversationStyle
+        let spoilerReveal = self.spoilerReveal
         guard conversationStyle.viewWidth > 0 else {
             Logger.info("viewWidth not yet set.")
             return
@@ -535,11 +538,18 @@ public class CVLoadCoordinator: NSObject {
 
         loadRequestBuilder = CVLoadRequest.Builder()
 
-        load(loadRequest: loadRequest,
-             conversationStyle: conversationStyle)
+        load(
+            loadRequest: loadRequest,
+            conversationStyle: conversationStyle,
+            spoilerReveal: spoilerReveal
+        )
     }
 
-    private func load(loadRequest: CVLoadRequest, conversationStyle: ConversationStyle) {
+    private func load(
+        loadRequest: CVLoadRequest,
+        conversationStyle: ConversationStyle,
+        spoilerReveal: CVSpoilerReveal
+    ) {
         AssertIsOnMainThread()
         // We should do an "initial" load IFF this is our first load.
         owsAssertDebug(loadRequest.isInitialLoad == renderState.isEmptyInitialState)
@@ -564,6 +574,7 @@ public class CVLoadCoordinator: NSObject {
         let loader = CVLoader(threadUniqueId: threadUniqueId,
                               loadRequest: loadRequest,
                               viewStateSnapshot: viewStateSnapshot,
+                              spoilerReveal: spoilerReveal,
                               prevRenderState: prevRenderState,
                               messageMapping: messageMapping)
 
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVLoader.swift b/Signal/src/ViewControllers/ConversationView/CV/CVLoader.swift
index 045c81bf8d6..88d2525a37e 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVLoader.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVLoader.swift
@@ -15,19 +15,24 @@ public class CVLoader: NSObject {
     private let threadUniqueId: String
     private let loadRequest: CVLoadRequest
     private let viewStateSnapshot: CVViewStateSnapshot
+    private let spoilerReveal: CVSpoilerReveal
     private let prevRenderState: CVRenderState
     private let messageMapping: CVMessageMapping
 
     private let benchSteps = BenchSteps(title: "CVLoader")
 
-    required init(threadUniqueId: String,
-                  loadRequest: CVLoadRequest,
-                  viewStateSnapshot: CVViewStateSnapshot,
-                  prevRenderState: CVRenderState,
-                  messageMapping: CVMessageMapping) {
+    required init(
+        threadUniqueId: String,
+        loadRequest: CVLoadRequest,
+        viewStateSnapshot: CVViewStateSnapshot,
+        spoilerReveal: CVSpoilerReveal,
+        prevRenderState: CVRenderState,
+        messageMapping: CVMessageMapping
+    ) {
         self.threadUniqueId = threadUniqueId
         self.loadRequest = loadRequest
         self.viewStateSnapshot = viewStateSnapshot
+        self.spoilerReveal = spoilerReveal
         self.prevRenderState = prevRenderState
         self.messageMapping = messageMapping
     }
@@ -37,6 +42,7 @@ public class CVLoader: NSObject {
         let threadUniqueId = self.threadUniqueId
         let loadRequest = self.loadRequest
         let viewStateSnapshot = self.viewStateSnapshot
+        let spoilerReveal = self.spoilerReveal
         let prevRenderState = self.prevRenderState
         let messageMapping = self.messageMapping
 
@@ -64,12 +70,15 @@ public class CVLoader: NSObject {
                 }
                 let threadViewModel = loadThreadViewModel()
 
-                let loadContext = CVLoadContext(loadRequest: loadRequest,
-                                                threadViewModel: threadViewModel,
-                                                viewStateSnapshot: viewStateSnapshot,
-                                                messageMapping: messageMapping,
-                                                prevRenderState: prevRenderState,
-                                                transaction: transaction)
+                let loadContext = CVLoadContext(
+                    loadRequest: loadRequest,
+                    threadViewModel: threadViewModel,
+                    viewStateSnapshot: viewStateSnapshot,
+                    spoilerReveal: spoilerReveal,
+                    messageMapping: messageMapping,
+                    prevRenderState: prevRenderState,
+                    transaction: transaction
+                )
 
                 self.benchSteps.step("threadViewModel")
 
@@ -259,12 +268,36 @@ public class CVLoader: NSObject {
                              itemModel: itemModel)
     }
 
+    #if DEBUG
+
     @objc
-    public static func buildStandaloneRenderItem(interaction: TSInteraction,
-                                                 thread: TSThread,
-                                                 threadAssociatedData: ThreadAssociatedData,
-                                                 containerView: UIView,
-                                                 transaction: SDSAnyReadTransaction) -> CVRenderItem? {
+    public static func debugui_buildStandaloneRenderItem(
+        interaction: TSInteraction,
+        thread: TSThread,
+        threadAssociatedData: ThreadAssociatedData,
+        containerView: UIView,
+        transaction: SDSAnyReadTransaction
+    ) -> CVRenderItem? {
+        buildStandaloneRenderItem(
+            interaction: interaction,
+            thread: thread,
+            threadAssociatedData: threadAssociatedData,
+            containerView: containerView,
+            spoilerReveal: CVSpoilerReveal(),
+            transaction: transaction
+        )
+    }
+
+    #endif
+
+    public static func buildStandaloneRenderItem(
+        interaction: TSInteraction,
+        thread: TSThread,
+        threadAssociatedData: ThreadAssociatedData,
+        containerView: UIView,
+        spoilerReveal: CVSpoilerReveal,
+        transaction: SDSAnyReadTransaction
+    ) -> CVRenderItem? {
         let chatColor = ChatColors.chatColorForRendering(thread: thread, transaction: transaction)
         let conversationStyle = ConversationStyle(type: .`default`,
                                                   thread: thread,
@@ -274,44 +307,63 @@ public class CVLoader: NSObject {
                                                   chatColor: chatColor)
         let coreState = CVCoreState(conversationStyle: conversationStyle,
                                     mediaCache: CVMediaCache())
-        return CVLoader.buildStandaloneRenderItem(interaction: interaction,
-                                                  thread: thread,
-                                                  threadAssociatedData: threadAssociatedData,
-                                                  coreState: coreState,
-                                                  transaction: transaction)
+        return CVLoader.buildStandaloneRenderItem(
+            interaction: interaction,
+            thread: thread,
+            threadAssociatedData: threadAssociatedData,
+            coreState: coreState,
+            spoilerReveal: spoilerReveal,
+            transaction: transaction
+        )
     }
 
-    @objc
-    public static func buildStandaloneRenderItem(interaction: TSInteraction,
-                                                 thread: TSThread,
-                                                 threadAssociatedData: ThreadAssociatedData,
-                                                 conversationStyle: ConversationStyle,
-                                                 transaction: SDSAnyReadTransaction) -> CVRenderItem? {
-        let coreState = CVCoreState(conversationStyle: conversationStyle,
-                                    mediaCache: CVMediaCache())
-        return CVLoader.buildStandaloneRenderItem(interaction: interaction,
-                                                  thread: thread,
-                                                  threadAssociatedData: threadAssociatedData,
-                                                  coreState: coreState,
-                                                  transaction: transaction)
+    public static func buildStandaloneRenderItem(
+        interaction: TSInteraction,
+        thread: TSThread,
+        threadAssociatedData: ThreadAssociatedData,
+        conversationStyle: ConversationStyle,
+        spoilerReveal: CVSpoilerReveal,
+        transaction: SDSAnyReadTransaction
+    ) -> CVRenderItem? {
+        let coreState = CVCoreState(
+            conversationStyle: conversationStyle,
+            mediaCache: CVMediaCache()
+        )
+        return CVLoader.buildStandaloneRenderItem(
+            interaction: interaction,
+            thread: thread,
+            threadAssociatedData: threadAssociatedData,
+            coreState: coreState,
+            spoilerReveal: spoilerReveal,
+            transaction: transaction
+        )
     }
 
-    private static func buildStandaloneRenderItem(interaction: TSInteraction,
-                                                  thread: TSThread,
-                                                  threadAssociatedData: ThreadAssociatedData,
-                                                  coreState: CVCoreState,
-                                                  transaction: SDSAnyReadTransaction) -> CVRenderItem? {
+    private static func buildStandaloneRenderItem(
+        interaction: TSInteraction,
+        thread: TSThread,
+        threadAssociatedData: ThreadAssociatedData,
+        coreState: CVCoreState,
+        spoilerReveal: CVSpoilerReveal,
+        transaction: SDSAnyReadTransaction
+    ) -> CVRenderItem? {
         AssertIsOnMainThread()
 
         let threadViewModel = ThreadViewModel(thread: thread,
                                               forChatList: false,
                                               transaction: transaction)
-        let viewStateSnapshot = CVViewStateSnapshot.mockSnapshotForStandaloneItems(coreState: coreState)
+        let viewStateSnapshot = CVViewStateSnapshot.mockSnapshotForStandaloneItems(
+            coreState: coreState,
+            spoilerReveal: spoilerReveal
+        )
         let avatarBuilder = CVAvatarBuilder(transaction: transaction)
-        let itemBuildingContext = CVItemBuildingContextImpl(threadViewModel: threadViewModel,
-                                                            viewStateSnapshot: viewStateSnapshot,
-                                                            transaction: transaction,
-                                                            avatarBuilder: avatarBuilder)
+        let itemBuildingContext = CVItemBuildingContextImpl(
+            threadViewModel: threadViewModel,
+            viewStateSnapshot: viewStateSnapshot,
+            transaction: transaction,
+            avatarBuilder: avatarBuilder,
+            spoilerReveal: spoilerReveal
+        )
         guard let itemModel = CVItemModelBuilder.buildStandaloneItem(interaction: interaction,
                                                                      thread: thread,
                                                                      threadAssociatedData: threadAssociatedData,
@@ -325,8 +377,11 @@ public class CVLoader: NSObject {
                                     itemModel: itemModel)
     }
 
-    public static func buildStandaloneComponentState(interaction: TSInteraction,
-                                                     transaction: SDSAnyReadTransaction) -> CVComponentState? {
+    public static func buildStandaloneComponentState(
+        interaction: TSInteraction,
+        spoilerReveal: CVSpoilerReveal,
+        transaction: SDSAnyReadTransaction
+    ) -> CVComponentState? {
         AssertIsOnMainThread()
 
         let thread = interaction.thread(transaction: transaction)
@@ -343,12 +398,18 @@ public class CVLoader: NSObject {
         let threadViewModel = ThreadViewModel(thread: thread,
                                               forChatList: false,
                                               transaction: transaction)
-        let viewStateSnapshot = CVViewStateSnapshot.mockSnapshotForStandaloneItems(coreState: coreState)
+        let viewStateSnapshot = CVViewStateSnapshot.mockSnapshotForStandaloneItems(
+            coreState: coreState,
+            spoilerReveal: spoilerReveal
+        )
         let avatarBuilder = CVAvatarBuilder(transaction: transaction)
-        let itemBuildingContext = CVItemBuildingContextImpl(threadViewModel: threadViewModel,
-                                                            viewStateSnapshot: viewStateSnapshot,
-                                                            transaction: transaction,
-                                                            avatarBuilder: avatarBuilder)
+        let itemBuildingContext = CVItemBuildingContextImpl(
+            threadViewModel: threadViewModel,
+            viewStateSnapshot: viewStateSnapshot,
+            transaction: transaction,
+            avatarBuilder: avatarBuilder,
+            spoilerReveal: spoilerReveal
+        )
         do {
             return try CVComponentState.build(interaction: interaction,
                                               itemBuildingContext: itemBuildingContext)
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVViewStateSnapshot.swift b/Signal/src/ViewControllers/ConversationView/CV/CVViewStateSnapshot.swift
index 21f72e9f925..9eec11afa1e 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVViewStateSnapshot.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVViewStateSnapshot.swift
@@ -55,16 +55,21 @@ struct CVViewStateSnapshot: Dependencies {
                             currentCallThreadId: callService.currentCall?.thread.uniqueId)
     }
 
-    static func mockSnapshotForStandaloneItems(coreState: CVCoreState) -> CVViewStateSnapshot {
-        CVViewStateSnapshot(textExpansion: CVTextExpansion(),
-                            spoilerReveal: CVSpoilerReveal(),
-                            messageSwipeActionState: CVMessageSwipeActionState(),
-                            coreState: coreState,
-                            typingIndicatorsSender: nil,
-                            uiMode: .normal,
-                            previousUIMode: .normal,
-                            searchText: nil,
-                            hasClearedUnreadMessagesIndicator: false,
-                            currentCallThreadId: nil)
+    static func mockSnapshotForStandaloneItems(
+        coreState: CVCoreState,
+        spoilerReveal: CVSpoilerReveal
+    ) -> CVViewStateSnapshot {
+        CVViewStateSnapshot(
+            textExpansion: CVTextExpansion(),
+            spoilerReveal: spoilerReveal,
+            messageSwipeActionState: CVMessageSwipeActionState(),
+            coreState: coreState,
+            typingIndicatorsSender: nil,
+            uiMode: .normal,
+            previousUIMode: .normal,
+            searchText: nil,
+            hasClearedUnreadMessagesIndicator: false,
+            currentCallThreadId: nil
+        )
     }
 }
diff --git a/Signal/src/ViewControllers/ConversationView/CVViewState.swift b/Signal/src/ViewControllers/ConversationView/CVViewState.swift
index a100883a34d..09aec77f7cc 100644
--- a/Signal/src/ViewControllers/ConversationView/CVViewState.swift
+++ b/Signal/src/ViewControllers/ConversationView/CVViewState.swift
@@ -409,31 +409,93 @@ public class CVTextExpansion {
 
 // MARK: -
 
-public class CVSpoilerReveal {
-    private var revealedSpoilerIdsByInteractionUniqueId = [String: Set<Int>]()
+public protocol CVSpoilerObserver: NSObjectProtocol {
+    func didUpdateRevealedSpoilers()
+}
+
+@objc
+public class CVSpoilerReveal: NSObject {
+    private var revealedSpoilerIdsByMessage = [CVInteractionIdentifier: Set<StyleIdType>]()
 
     /// Returns the set of IDs in the ordered list of spoiler ranges for a given message that
     /// should be revealed.
     public func revealedSpoilerIds(
-        interactionUniqueId: String
-    ) -> Set<Int> {
-        return revealedSpoilerIdsByInteractionUniqueId[interactionUniqueId] ?? []
+        interactionIdentifier: CVInteractionIdentifier
+    ) -> Set<StyleIdType> {
+        return revealedSpoilerIdsByMessage[interactionIdentifier] ?? []
     }
 
     public func setSpoilerRevealed(
-        withID id: Int,
-        onInteractionUniqueId interactionUniqueId: String
+        withID id: StyleIdType,
+        interactionIdentifier: CVInteractionIdentifier
     ) {
-        var revealedIds = revealedSpoilerIdsByInteractionUniqueId[interactionUniqueId] ?? Set()
+        var revealedIds = revealedSpoilerIdsByMessage[interactionIdentifier] ?? Set()
         revealedIds.insert(id)
-        revealedSpoilerIdsByInteractionUniqueId[interactionUniqueId] = revealedIds
+        revealedSpoilerIdsByMessage[interactionIdentifier] = revealedIds
+        observers[interactionIdentifier]?.forEach {
+            $0.value?.didUpdateRevealedSpoilers()
+        }
+    }
+
+    private var observers = [CVInteractionIdentifier: [Weak<CVSpoilerObserver>]]()
+
+    public func observeChanges(
+        for interactionIdentifier: CVInteractionIdentifier,
+        observer: CVSpoilerObserver
+    ) {
+        var observers = observers[interactionIdentifier] ?? []
+        guard !observers.contains(where: {
+            $0.value === observer
+        }) else {
+            return
+        }
+        observers.append(Weak(value: observer))
+        self.observers[interactionIdentifier] = observers
+    }
+
+    public func removeObserver(
+        for interactionIdentifier: CVInteractionIdentifier,
+        observer: CVSpoilerObserver
+    ) {
+        var observers = observers[interactionIdentifier] ?? []
+        observers.removeAll(where: {
+            $0.value === observer
+        })
+        self.observers[interactionIdentifier] = observers
     }
 
     func copy() -> CVSpoilerReveal {
         let returnValue = CVSpoilerReveal()
-        returnValue.revealedSpoilerIdsByInteractionUniqueId = revealedSpoilerIdsByInteractionUniqueId
+        returnValue.revealedSpoilerIdsByMessage = revealedSpoilerIdsByMessage
         return returnValue
     }
+
+    public override func isEqual(_ object: Any?) -> Bool {
+        let lhs = self
+        guard let rhs = object as? CVSpoilerReveal else {
+            return false
+        }
+        guard lhs.revealedSpoilerIdsByMessage == rhs.revealedSpoilerIdsByMessage else {
+            return false
+        }
+        guard lhs.observers.count == rhs.observers.count else {
+            return false
+        }
+        for key in lhs.observers.keys {
+            guard let lhsObs = lhs.observers[key], let rhsObs = rhs.observers[key] else {
+                return false
+            }
+            guard lhsObs.count == rhsObs.count else {
+                return false
+            }
+            for i in 0..<lhsObs.count {
+                guard lhsObs[i].value === rhsObs[i].value else {
+                    return false
+                }
+            }
+        }
+        return true
+    }
 }
 
 // MARK: -
diff --git a/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.h b/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.h
index 16a8c89f74e..634beb5167f 100644
--- a/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.h
+++ b/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.h
@@ -5,6 +5,7 @@
 
 NS_ASSUME_NONNULL_BEGIN
 
+@class CVSpoilerReveal;
 @class ConversationStyle;
 @class DisplayableText;
 @class OWSQuotedReplyModel;
@@ -35,8 +36,10 @@ NS_ASSUME_NONNULL_BEGIN
 - (CGSize)sizeForMaxWidth:(CGFloat)maxWidth;
 
 // Factory method for "message compose" views.
-+ (OWSQuotedMessageView *)quotedMessageViewForPreview:(OWSQuotedReplyModel *)quotedMessage
-                                    conversationStyle:(ConversationStyle *)conversationStyle;
+- (instancetype)initWithQuotedMessage:(OWSQuotedReplyModel *)quotedMessage
+                displayableQuotedText:(nullable DisplayableText *)displayableQuotedText
+                    conversationStyle:(ConversationStyle *)conversationStyle
+                        spoilerReveal:(CVSpoilerReveal *)spoilerReveal;
 
 @end
 
diff --git a/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.m b/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.m
index 590324e33dd..4c898a8087c 100644
--- a/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.m
+++ b/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.m
@@ -24,6 +24,7 @@ @interface OWSQuotedMessageView ()
 @property (nonatomic, readonly) OWSQuotedReplyModel *quotedMessage;
 @property (nonatomic, nullable, readonly) DisplayableText *displayableQuotedText;
 @property (nonatomic, readonly) ConversationStyle *conversationStyle;
+@property (nonatomic, readonly) CVSpoilerReveal *spoilerReveal;
 
 @property (nonatomic, readonly) UILabel *quotedAuthorLabel;
 @property (nonatomic, readonly) UILabel *quotedTextLabel;
@@ -35,26 +36,10 @@ @interface OWSQuotedMessageView ()
 
 @implementation OWSQuotedMessageView
 
-+ (OWSQuotedMessageView *)quotedMessageViewForPreview:(OWSQuotedReplyModel *)quotedMessage
-                                    conversationStyle:(ConversationStyle *)conversationStyle
-{
-    OWSAssertDebug(quotedMessage);
-
-    DisplayableText *_Nullable displayableQuotedText = nil;
-    if (quotedMessage.body.length > 0) {
-        displayableQuotedText = [OWSQuotedMessageView displayableTextWithSneakyTransactionForPreview:quotedMessage];
-    }
-
-    OWSQuotedMessageView *instance = [[OWSQuotedMessageView alloc] initWithQuotedMessage:quotedMessage
-                                                                   displayableQuotedText:displayableQuotedText
-                                                                       conversationStyle:conversationStyle];
-    [instance createContents];
-    return instance;
-}
-
 - (instancetype)initWithQuotedMessage:(OWSQuotedReplyModel *)quotedMessage
                 displayableQuotedText:(nullable DisplayableText *)displayableQuotedText
                     conversationStyle:(ConversationStyle *)conversationStyle
+                        spoilerReveal:(CVSpoilerReveal *)spoilerReveal
 {
     self = [super init];
 
@@ -67,6 +52,7 @@ - (instancetype)initWithQuotedMessage:(OWSQuotedReplyModel *)quotedMessage
     _quotedMessage = quotedMessage;
     _displayableQuotedText = displayableQuotedText;
     _conversationStyle = conversationStyle;
+    _spoilerReveal = spoilerReveal;
 
     _quotedAuthorLabel = [UILabel new];
     _quotedTextLabel = [UILabel new];
@@ -403,13 +389,11 @@ - (UILabel *)configureQuotedTextLabel
     NSString *_Nullable sourceFilename = [self.quotedMessage.sourceFilename filterStringForDisplay];
 
     if (self.displayableQuotedText.displayAttributedText.length > 0) {
-        NSMutableAttributedString *mutableText = [self.displayableQuotedText.displayAttributedText mutableCopy];
-        [mutableText addAttributes:@{
-            NSFontAttributeName : self.quotedTextFont,
-            NSForegroundColorAttributeName : self.quotedTextColor
-        }
-                             range:NSMakeRange(0, mutableText.length)];
-        attributedText = mutableText;
+        attributedText = [self restyleDisplayableQuotedText:self.displayableQuotedText
+                                                       font:self.quotedTextFont
+                                                  textColor:self.quotedTextColor
+                                           quotedReplyModel:self.quotedMessage
+                                              spoilerReveal:self.spoilerReveal];
     } else if (fileTypeForSnippet) {
         attributedText = [[NSAttributedString alloc] initWithString:fileTypeForSnippet
                                                          attributes:@{
diff --git a/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.swift b/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.swift
index 905f350cc1f..6fbba2e3500 100644
--- a/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.swift
+++ b/Signal/src/ViewControllers/ConversationView/Cells/OWSQuotedMessageView.swift
@@ -7,8 +7,35 @@ import Foundation
 
 extension OWSQuotedMessageView {
 
-    @objc
-    static func displayableTextWithSneakyTransaction(forPreview quotedMessage: OWSQuotedReplyModel) -> DisplayableText? {
+    static func forPreview(
+        _ quotedMessage: OWSQuotedReplyModel,
+        conversationStyle: ConversationStyle,
+        spoilerReveal: CVSpoilerReveal
+    ) -> OWSQuotedMessageView {
+
+        let displayableQuotedText: DisplayableText?
+        if quotedMessage.body?.isEmpty == false {
+            displayableQuotedText = displayableTextWithSneakyTransaction(
+                forPreview: quotedMessage,
+                spoilerReveal: spoilerReveal
+            )
+        } else {
+            displayableQuotedText = nil
+        }
+        let instance = OWSQuotedMessageView(
+            quotedMessage: quotedMessage,
+            displayableQuotedText: displayableQuotedText,
+            conversationStyle: conversationStyle,
+            spoilerReveal: spoilerReveal
+        )
+        instance.createContents()
+        return instance
+    }
+
+    static func displayableTextWithSneakyTransaction(
+        forPreview quotedMessage: OWSQuotedReplyModel,
+        spoilerReveal: CVSpoilerReveal
+    ) -> DisplayableText? {
         guard let text = quotedMessage.body else {
             return nil
         }
@@ -18,11 +45,55 @@ extension OWSQuotedMessageView {
                 withMessageBody: messageBody,
                 displayConfig: HydratedMessageBody.DisplayConfiguration(
                     mention: .quotedReply,
-                    style: .quotedReply,
+                    style: .quotedReply(revealedSpoilerIds: spoilerReveal.revealedSpoilerIds(
+                        interactionIdentifier: CVInteractionIdentifier(
+                            timestamp: quotedMessage.timestamp,
+                            authorUuid: quotedMessage.authorAddress.uuidString
+                        )
+                    )),
                     searchRanges: nil
                 ),
                 transaction: tx
             )
         }
     }
+
+    @objc
+    func restyleDisplayableQuotedText(
+        _ displayableQuotedText: DisplayableText,
+        font: UIFont,
+        textColor: UIColor,
+        quotedReplyModel: OWSQuotedReplyModel,
+        spoilerReveal: CVSpoilerReveal
+    ) -> NSAttributedString {
+        let mutableCopy = NSMutableAttributedString(attributedString: displayableQuotedText.displayAttributedText)
+        mutableCopy.addAttributesToEntireString([
+            .font: font,
+            .foregroundColor: textColor
+        ])
+        return RecoveredHydratedMessageBody
+            .recover(from: mutableCopy)
+            .reapplyAttributes(
+                config: HydratedMessageBody.DisplayConfiguration(
+                    mention: MentionDisplayConfiguration(
+                        font: font,
+                        foregroundColor: .fixed(textColor),
+                        backgroundColor: nil
+                    ),
+                    style: StyleDisplayConfiguration(
+                        baseFont: font,
+                        textColor: .fixed(textColor),
+                        revealAllIds: false,
+                        revealedIds: spoilerReveal.revealedSpoilerIds(
+                            interactionIdentifier: CVInteractionIdentifier(
+                                timestamp: quotedReplyModel.timestamp,
+                                authorUuid: quotedReplyModel.authorAddress.uuidString
+                            )
+                        )
+                    ),
+                    searchRanges: nil
+                ),
+                isDarkThemeEnabled: Theme.isDarkThemeEnabled
+            )
+    }
 }
diff --git a/Signal/src/ViewControllers/ConversationView/Cells/QuotedMessageView.swift b/Signal/src/ViewControllers/ConversationView/Cells/QuotedMessageView.swift
index 1a6b1383607..3b93ba235ff 100644
--- a/Signal/src/ViewControllers/ConversationView/Cells/QuotedMessageView.swift
+++ b/Signal/src/ViewControllers/ConversationView/Cells/QuotedMessageView.swift
@@ -25,9 +25,17 @@ public class QuotedMessageView: ManualStackViewWithLayer {
         let quotedReplyModel: OWSQuotedReplyModel
         let displayableQuotedText: DisplayableText?
         let conversationStyle: ConversationStyle
+        let spoilerReveal: CVSpoilerReveal
         let isOutgoing: Bool
         let isForPreview: Bool
         let quotedAuthorName: String
+
+        var quotedInteractionIdentifier: CVInteractionIdentifier {
+            return CVInteractionIdentifier(
+                timestamp: quotedReplyModel.timestamp,
+                authorUuid: quotedReplyModel.authorAddress.uuidString
+            )
+        }
     }
 
     private var state: State?
@@ -53,11 +61,14 @@ public class QuotedMessageView: ManualStackViewWithLayer {
     private let chatColorView = CVColorOrGradientView()
     private let tintView = ManualLayoutViewWithLayer(name: "tintView")
 
-    static func stateForConversation(quotedReplyModel: OWSQuotedReplyModel,
-                                     displayableQuotedText: DisplayableText?,
-                                     conversationStyle: ConversationStyle,
-                                     isOutgoing: Bool,
-                                     transaction: SDSAnyReadTransaction) -> State {
+    static func stateForConversation(
+        quotedReplyModel: OWSQuotedReplyModel,
+        displayableQuotedText: DisplayableText?,
+        conversationStyle: ConversationStyle,
+        spoilerReveal: CVSpoilerReveal,
+        isOutgoing: Bool,
+        transaction: SDSAnyReadTransaction
+    ) -> State {
 
         let quotedAuthorName = contactsManager.displayName(for: quotedReplyModel.authorAddress,
                                                            transaction: transaction)
@@ -65,14 +76,18 @@ public class QuotedMessageView: ManualStackViewWithLayer {
         return State(quotedReplyModel: quotedReplyModel,
                      displayableQuotedText: displayableQuotedText,
                      conversationStyle: conversationStyle,
+                     spoilerReveal: spoilerReveal,
                      isOutgoing: isOutgoing,
                      isForPreview: false,
                      quotedAuthorName: quotedAuthorName)
     }
 
-    static func stateForPreview(quotedReplyModel: OWSQuotedReplyModel,
-                                conversationStyle: ConversationStyle,
-                                transaction: SDSAnyReadTransaction) -> State {
+    static func stateForPreview(
+        quotedReplyModel: OWSQuotedReplyModel,
+        conversationStyle: ConversationStyle,
+        spoilerReveal: CVSpoilerReveal,
+        transaction: SDSAnyReadTransaction
+    ) -> State {
 
         let quotedAuthorName = contactsManager.displayName(for: quotedReplyModel.authorAddress,
                                                            transaction: transaction)
@@ -84,7 +99,12 @@ public class QuotedMessageView: ManualStackViewWithLayer {
                 withMessageBody: messageBody,
                 displayConfig: HydratedMessageBody.DisplayConfiguration(
                     mention: .quotedReply,
-                    style: .quotedReply,
+                    style: .quotedReply(revealedSpoilerIds: spoilerReveal.revealedSpoilerIds(
+                        interactionIdentifier: CVInteractionIdentifier(
+                            timestamp: quotedReplyModel.timestamp,
+                            authorUuid: quotedReplyModel.authorAddress.uuidString
+                        )
+                    )),
                     searchRanges: nil
                 ),
                 transaction: transaction
@@ -94,6 +114,7 @@ public class QuotedMessageView: ManualStackViewWithLayer {
         return State(quotedReplyModel: quotedReplyModel,
                      displayableQuotedText: displayableQuotedText,
                      conversationStyle: conversationStyle,
+                     spoilerReveal: spoilerReveal,
                      isOutgoing: true,
                      isForPreview: true,
                      quotedAuthorName: quotedAuthorName)
@@ -109,6 +130,11 @@ public class QuotedMessageView: ManualStackViewWithLayer {
         var quotedReplyModel: OWSQuotedReplyModel { state.quotedReplyModel }
         var displayableQuotedText: DisplayableText? { state.displayableQuotedText }
         var conversationStyle: ConversationStyle { state.conversationStyle }
+        var revealedSpoilerIds: Set<StyleIdType> {
+            return state.spoilerReveal.revealedSpoilerIds(
+                interactionIdentifier: state.quotedInteractionIdentifier
+            )
+        }
         var isOutgoing: Bool { state.isOutgoing }
         var isIncoming: Bool { !isOutgoing }
         var isForPreview: Bool { state.isForPreview }
@@ -267,7 +293,23 @@ public class QuotedMessageView: ManualStackViewWithLayer {
                     .font: quotedTextFont,
                     .foregroundColor: quotedTextColor
                 ])
-                attributedText = mutableText
+                attributedText = RecoveredHydratedMessageBody.recover(from: mutableText).reapplyAttributes(
+                    config: HydratedMessageBody.DisplayConfiguration(
+                        mention: MentionDisplayConfiguration(
+                            font: quotedTextFont,
+                            foregroundColor: .fixed(quotedTextColor),
+                            backgroundColor: nil
+                        ),
+                        style: StyleDisplayConfiguration(
+                            baseFont: quotedTextFont,
+                            textColor: .fixed(quotedTextColor),
+                            revealAllIds: false,
+                            revealedIds: revealedSpoilerIds
+                        ),
+                        searchRanges: nil
+                    ),
+                    isDarkThemeEnabled: Theme.isDarkThemeEnabled
+                )
                 textAlignment = displayableQuotedText.displayTextNaturalAlignment
             } else if let fileTypeForSnippet = self.fileTypeForSnippet {
                 attributedText = NSAttributedString(string: fileTypeForSnippet,
@@ -423,6 +465,11 @@ public class QuotedMessageView: ManualStackViewWithLayer {
         self.state = state
         self.delegate = delegate
 
+        state.spoilerReveal.observeChanges(
+            for: state.quotedInteractionIdentifier,
+            observer: self
+        )
+
         let configurator = Configurator(state: state)
         let conversationStyle = configurator.conversationStyle
         let quotedReplyModel = configurator.quotedReplyModel
@@ -838,6 +885,13 @@ public class QuotedMessageView: ManualStackViewWithLayer {
     public override func reset() {
         super.reset()
 
+        if let state {
+            state.spoilerReveal.removeObserver(
+                for: state.quotedInteractionIdentifier,
+                observer: self
+            )
+        }
+
         self.state = nil
         self.delegate = nil
 
@@ -862,3 +916,15 @@ public class QuotedMessageView: ManualStackViewWithLayer {
         tintView.removeFromSuperview()
     }
 }
+
+extension QuotedMessageView: CVSpoilerObserver {
+    public func didUpdateRevealedSpoilers() {
+        guard let state else {
+            return
+        }
+        let configurator = Configurator(state: state)
+        let quotedTextLabelConfig = configurator.quotedTextLabelConfig
+        // Note: measurement doesn't change when spoiler state changes.
+        quotedTextLabelConfig.applyForRendering(label: quotedTextLabel)
+    }
+}
diff --git a/Signal/src/ViewControllers/ConversationView/ConversationInputToolbar.swift b/Signal/src/ViewControllers/ConversationView/ConversationInputToolbar.swift
index 96ba001e7c1..ea4b43d495e 100644
--- a/Signal/src/ViewControllers/ConversationView/ConversationInputToolbar.swift
+++ b/Signal/src/ViewControllers/ConversationView/ConversationInputToolbar.swift
@@ -60,6 +60,7 @@ protocol ConversationInputToolbarDelegate: AnyObject {
 public class ConversationInputToolbar: UIView, LinkPreviewViewDraftDelegate, QuotedReplyPreviewDelegate {
 
     private var conversationStyle: ConversationStyle
+    private let spoilerReveal: CVSpoilerReveal
 
     private let mediaCache: CVMediaCache
 
@@ -67,6 +68,7 @@ public class ConversationInputToolbar: UIView, LinkPreviewViewDraftDelegate, Quo
 
     init(
         conversationStyle: ConversationStyle,
+        spoilerReveal: CVSpoilerReveal,
         mediaCache: CVMediaCache,
         messageDraft: MessageBody?,
         quotedReply: OWSQuotedReplyModel?,
@@ -75,6 +77,7 @@ public class ConversationInputToolbar: UIView, LinkPreviewViewDraftDelegate, Quo
         mentionDelegate: MentionTextViewDelegate
     ) {
         self.conversationStyle = conversationStyle
+        self.spoilerReveal = spoilerReveal
         self.mediaCache = mediaCache
         self.inputToolbarDelegate = inputToolbarDelegate
         self.linkPreviewFetcher = LinkPreviewFetcher(
@@ -918,7 +921,11 @@ public class ConversationInputToolbar: UIView, LinkPreviewViewDraftDelegate, Quo
             return
         }
 
-        let quotedMessagePreview = QuotedReplyPreview(quotedReply: quotedReply, conversationStyle: conversationStyle)
+        let quotedMessagePreview = QuotedReplyPreview(
+            quotedReply: quotedReply,
+            conversationStyle: conversationStyle,
+            spoilerReveal: spoilerReveal
+        )
         quotedMessagePreview.delegate = self
         quotedMessagePreview.setContentHuggingHorizontalLow()
         quotedMessagePreview.setCompressionResistanceHorizontalLow()
diff --git a/Signal/src/ViewControllers/ConversationView/ConversationViewController+BodyTextItems.swift b/Signal/src/ViewControllers/ConversationView/ConversationViewController+BodyTextItems.swift
index becbf8ce88d..eb9106209c3 100644
--- a/Signal/src/ViewControllers/ConversationView/ConversationViewController+BodyTextItems.swift
+++ b/Signal/src/ViewControllers/ConversationView/ConversationViewController+BodyTextItems.swift
@@ -385,7 +385,7 @@ extension ConversationViewController {
     private func didTapOrLongPressUnrevealedSpoiler(_ unrevealedSpoilerItem: CVTextLabel.UnrevealedSpoilerItem) {
         viewState.spoilerReveal.setSpoilerRevealed(
             withID: unrevealedSpoilerItem.spoilerId,
-            onInteractionUniqueId: unrevealedSpoilerItem.interactionUniqueId
+            interactionIdentifier: unrevealedSpoilerItem.interactionIdentifier
         )
         self.loadCoordinator.enqueueReload(
             updatedInteractionIds: [unrevealedSpoilerItem.interactionUniqueId],
diff --git a/Signal/src/ViewControllers/ConversationView/ConversationViewController+MessageActionsDelegate.swift b/Signal/src/ViewControllers/ConversationView/ConversationViewController+MessageActionsDelegate.swift
index 1f79073db02..617441bd486 100644
--- a/Signal/src/ViewControllers/ConversationView/ConversationViewController+MessageActionsDelegate.swift
+++ b/Signal/src/ViewControllers/ConversationView/ConversationViewController+MessageActionsDelegate.swift
@@ -21,7 +21,11 @@ extension ConversationViewController: MessageActionsDelegate {
             return owsFailDebug("Missing panHandler")
         }
 
-        let detailVC = MessageDetailViewController(message: message, thread: thread)
+        let detailVC = MessageDetailViewController(
+            message: message,
+            spoilerReveal: self.viewState.spoilerReveal,
+            thread: thread
+        )
         detailVC.detailDelegate = self
         conversationSplitViewController?.navigationTransitionDelegate = detailVC
         panHandler.messageDetailViewController = detailVC
@@ -44,7 +48,11 @@ extension ConversationViewController: MessageActionsDelegate {
             detailVC = messageDetailViewController
             detailVC.pushPercentDrivenTransition = panHandler.percentDrivenTransition
         } else {
-            detailVC = MessageDetailViewController(message: message, thread: thread)
+            detailVC = MessageDetailViewController(
+                message: message,
+                spoilerReveal: self.viewState.spoilerReveal,
+                thread: thread
+            )
             detailVC.detailDelegate = self
             conversationSplitViewController?.navigationTransitionDelegate = detailVC
         }
diff --git a/Signal/src/ViewControllers/ConversationView/ConversationViewController+OWS.swift b/Signal/src/ViewControllers/ConversationView/ConversationViewController+OWS.swift
index 6d4d92f363a..b45f3e65926 100644
--- a/Signal/src/ViewControllers/ConversationView/ConversationViewController+OWS.swift
+++ b/Signal/src/ViewControllers/ConversationView/ConversationViewController+OWS.swift
@@ -491,7 +491,11 @@ extension ConversationViewController: LongTextViewDelegate {
             self.loadCoordinator.enqueueReload(updatedInteractionIds: [itemViewModel.interaction.uniqueId],
                                                deletedInteractionIds: [])
         } else {
-            let viewController = LongTextViewController(itemViewModel: itemViewModel)
+            let viewController = LongTextViewController(
+                itemViewModel: itemViewModel,
+                threadViewModel: self.threadViewModel,
+                spoilerReveal: self.viewState.spoilerReveal
+            )
             viewController.delegate = self
             navigationController?.pushViewController(viewController, animated: true)
         }
diff --git a/Signal/src/ViewControllers/ConversationView/ConversationViewController+Selection.swift b/Signal/src/ViewControllers/ConversationView/ConversationViewController+Selection.swift
index 5f65d2874db..6d41bad13f1 100644
--- a/Signal/src/ViewControllers/ConversationView/ConversationViewController+Selection.swift
+++ b/Signal/src/ViewControllers/ConversationView/ConversationViewController+Selection.swift
@@ -326,8 +326,11 @@ extension ConversationViewController {
                 owsFailDebug("Invalid interaction: \(type(of: interaction)).")
                 return false
             }
-            guard let componentState = CVLoader.buildStandaloneComponentState(interaction: interaction,
-                                                                              transaction: transaction) else {
+            guard let componentState = CVLoader.buildStandaloneComponentState(
+                interaction: interaction,
+                spoilerReveal: CVSpoilerReveal(),
+                transaction: transaction
+            ) else {
                 owsFailDebug("Could not load componentState.")
                 return false
             }
diff --git a/Signal/src/ViewControllers/ConversationView/ConversationViewController+UI.swift b/Signal/src/ViewControllers/ConversationView/ConversationViewController+UI.swift
index dbf758c7e3a..d05f2595ac3 100644
--- a/Signal/src/ViewControllers/ConversationView/ConversationViewController+UI.swift
+++ b/Signal/src/ViewControllers/ConversationView/ConversationViewController+UI.swift
@@ -284,13 +284,16 @@ extension ConversationViewController {
             quotedReply = nil
         }
 
-        let inputToolbar = ConversationInputToolbar(conversationStyle: conversationStyle,
-                                                    mediaCache: mediaCache,
-                                                    messageDraft: messageDraft,
-                                                    quotedReply: quotedReply,
-                                                    inputToolbarDelegate: self,
-                                                    inputTextViewDelegate: self,
-                                                    mentionDelegate: self)
+        let inputToolbar = ConversationInputToolbar(
+            conversationStyle: conversationStyle,
+            spoilerReveal: viewState.spoilerReveal,
+            mediaCache: mediaCache,
+            messageDraft: messageDraft,
+            quotedReply: quotedReply,
+            inputToolbarDelegate: self,
+            inputTextViewDelegate: self,
+            mentionDelegate: self
+        )
         inputToolbar.accessibilityIdentifier = "inputToolbar"
         if let voiceMemoDraft = voiceMemoDraft {
             inputToolbar.showVoiceMemoDraft(voiceMemoDraft)
@@ -323,8 +326,11 @@ extension ConversationViewController {
             ).first else {
                 return nil
             }
-            guard let componentState = CVLoader.buildStandaloneComponentState(interaction: interaction,
-                                                                              transaction: transaction) else {
+            guard let componentState = CVLoader.buildStandaloneComponentState(
+                interaction: interaction,
+                spoilerReveal: self.viewState.spoilerReveal,
+                transaction: transaction
+            ) else {
                 owsFailDebug("Failed to create component state.")
                 return nil
             }
diff --git a/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m b/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m
index b28922bc5f9..8d43e11af8a 100644
--- a/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m
+++ b/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m
@@ -1956,11 +1956,12 @@ + (DebugUIMessagesAction *)fakeRandomTextAction:(TSThread *)thread
                 OWSAssertDebug(messageToQuote);
 
                 UIView *containerView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 100)];
-                CVRenderItem *renderItem = [CVLoader buildStandaloneRenderItemWithInteraction:messageToQuote
-                                                                                       thread:thread
-                                                                         threadAssociatedData:threadAssociatedData
-                                                                                containerView:containerView
-                                                                                  transaction:transaction];
+                CVRenderItem *renderItem =
+                    [CVLoader debugui_buildStandaloneRenderItemWithInteraction:messageToQuote
+                                                                        thread:thread
+                                                          threadAssociatedData:threadAssociatedData
+                                                                 containerView:containerView
+                                                                   transaction:transaction];
                 CVItemViewModelImpl *itemViewModel = [[CVItemViewModelImpl alloc] initWithRenderItem:renderItem];
 
                 quotedMessage =
@@ -1982,11 +1983,12 @@ + (DebugUIMessagesAction *)fakeRandomTextAction:(TSThread *)thread
                 ThreadAssociatedData *threadAssociatedData = [self createFakeThreadAssociatedData:thread];
 
                 UIView *containerView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 100)];
-                CVRenderItem *renderItem = [CVLoader buildStandaloneRenderItemWithInteraction:messageToQuote
-                                                                                       thread:thread
-                                                                         threadAssociatedData:threadAssociatedData
-                                                                                containerView:containerView
-                                                                                  transaction:transaction];
+                CVRenderItem *renderItem =
+                    [CVLoader debugui_buildStandaloneRenderItemWithInteraction:messageToQuote
+                                                                        thread:thread
+                                                          threadAssociatedData:threadAssociatedData
+                                                                 containerView:containerView
+                                                                   transaction:transaction];
                 CVItemViewModelImpl *itemViewModel = [[CVItemViewModelImpl alloc] initWithRenderItem:renderItem];
 
                 quotedMessage =
diff --git a/Signal/src/ViewControllers/ForwardMessageViewController.swift b/Signal/src/ViewControllers/ForwardMessageViewController.swift
index bd72612a019..fb3c550ecdc 100644
--- a/Signal/src/ViewControllers/ForwardMessageViewController.swift
+++ b/Signal/src/ViewControllers/ForwardMessageViewController.swift
@@ -907,8 +907,11 @@ private enum ForwardMessageContent {
 
     private static func buildComponentState(interaction: TSInteraction,
                                             transaction: SDSAnyReadTransaction) throws -> CVComponentState {
-        guard let componentState = CVLoader.buildStandaloneComponentState(interaction: interaction,
-                                                                          transaction: transaction) else {
+        guard let componentState = CVLoader.buildStandaloneComponentState(
+            interaction: interaction,
+            spoilerReveal: CVSpoilerReveal(), // Nothing revealed, doesn't matter.
+            transaction: transaction
+        ) else {
             throw ForwardError.invalidInteraction
         }
         return componentState
diff --git a/Signal/src/ViewControllers/LongTextViewController.swift b/Signal/src/ViewControllers/LongTextViewController.swift
index 6ebb0a5d45b..6fb856abf5f 100644
--- a/Signal/src/ViewControllers/LongTextViewController.swift
+++ b/Signal/src/ViewControllers/LongTextViewController.swift
@@ -6,6 +6,7 @@
 import Foundation
 import SignalServiceKit
 import SignalMessaging
+import SignalUI
 
 protocol LongTextViewDelegate: AnyObject {
     func longTextViewMessageWasDeleted(_ longTextViewController: LongTextViewController)
@@ -19,17 +20,27 @@ public class LongTextViewController: OWSViewController {
     weak var delegate: LongTextViewDelegate?
 
     let itemViewModel: CVItemViewModelImpl
+    let threadViewModel: ThreadViewModel
+    let spoilerReveal: CVSpoilerReveal
 
     var messageTextView: UITextView!
     let footer = UIToolbar.clear()
 
+    private var linkItems: [CVTextLabel.Item]?
+
     var displayableText: DisplayableText? { itemViewModel.displayableBodyText }
     var fullAttributedText: NSAttributedString { displayableText?.fullAttributedText ?? NSAttributedString() }
 
     // MARK: Initializers
 
-    public required init(itemViewModel: CVItemViewModelImpl) {
+    public required init(
+        itemViewModel: CVItemViewModelImpl,
+        threadViewModel: ThreadViewModel,
+        spoilerReveal: CVSpoilerReveal
+    ) {
         self.itemViewModel = itemViewModel
+        self.threadViewModel = threadViewModel
+        self.spoilerReveal = spoilerReveal
         super.init()
     }
 
@@ -84,21 +95,49 @@ public class LongTextViewController: OWSViewController {
             let hasPendingMessageRequest = databaseStorage.read { transaction in
                 itemViewModel.thread.hasPendingMessageRequest(transaction: transaction.unwrapGrdbRead)
             }
-            CVComponentBodyText.configureTextView(messageTextView,
-                                                  interaction: itemViewModel.interaction,
-                                                  displayableText: displayableText)
-            CVComponentBodyText.linkifyData(
-                attributedText: mutableText,
-                linkifyStyle: .linkAttribute,
+            CVComponentBodyText.configureTextView(
+                messageTextView,
+                interaction: itemViewModel.interaction,
+                displayableText: displayableText
+            )
+
+            let items = CVComponentBodyText.detectItems(
+                text: mutableText.string,
+                attributedString: mutableText,
                 hasPendingMessageRequest: hasPendingMessageRequest,
                 shouldAllowLinkification: displayableText.shouldAllowLinkification,
                 textWasTruncated: false,
-                revealedSpoilerIds: Set(), // TODO[TextFormatting]
-                interactionUniqueId: itemViewModel.interaction.uniqueId
+                revealedSpoilerIds: spoilerReveal.revealedSpoilerIds(
+                    interactionIdentifier: .fromInteraction(itemViewModel.interaction)
+                ),
+                interactionUniqueId: itemViewModel.interaction.uniqueId,
+                interactionIdentifier: .fromInteraction(itemViewModel.interaction)
             )
-
-            messageTextView.attributedText = mutableText
+            CVComponentBodyText.linkifyData(
+                attributedText: mutableText,
+                linkifyStyle: .linkAttribute,
+                items: items
+            )
+            messageTextView.attributedText = RecoveredHydratedMessageBody.recover(from: mutableText)
+                .reapplyAttributes(
+                    config: HydratedMessageBody.DisplayConfiguration(
+                        mention: .longMessageView,
+                        style: .longTextView(revealedSpoilerIds: spoilerReveal.revealedSpoilerIds(
+                            interactionIdentifier: .fromInteraction(itemViewModel.interaction))
+                        ),
+                        searchRanges: nil
+                    ),
+                    isDarkThemeEnabled: Theme.isDarkThemeEnabled
+                )
             messageTextView.textAlignment = displayableText.fullTextNaturalAlignment
+            self.linkItems = items
+
+            if items.isEmpty.negated {
+                messageTextView.addGestureRecognizer(UITapGestureRecognizer(
+                    target: self,
+                    action: #selector(didTapMessageTextView)
+                ))
+            }
         } else {
             owsFailDebug("displayableText was unexpectedly nil")
             messageTextView.text = ""
@@ -200,6 +239,72 @@ public class LongTextViewController: OWSViewController {
                                              from: self,
                                              delegate: self)
     }
+
+    @objc
+    func didTapMessageTextView(_ sender: UIGestureRecognizer) {
+        guard let linkItems else {
+            return
+        }
+        let location = sender.location(in: messageTextView)
+
+        let layoutManager = messageTextView.layoutManager
+        let textContainer = messageTextView.textContainer
+        let glyphRange = layoutManager.glyphRange(for: textContainer)
+        let boundingRect = layoutManager.boundingRect(forGlyphRange: glyphRange, in: textContainer)
+        guard boundingRect.contains(location) else {
+            return
+        }
+
+        let glyphIndex = layoutManager.glyphIndex(for: location, in: textContainer)
+
+        // We have the _closest_ index, but that doesn't mean we tapped in a glyph.
+        // Check that directly.
+        // This will catch the below case, where "*" is the tap location:
+        //
+        // This is the first line that is long.
+        // Tap on the second line.    *
+        //
+        // The bounding rect includes the empty space below the first line,
+        // but the tap doesn't actually lie on any glyph.
+        let glyphRect = layoutManager.boundingRect(forGlyphRange: NSRange(location: glyphIndex, length: 1), in: textContainer)
+        guard glyphRect.contains(location) else {
+            return
+        }
+        let characterIndex = layoutManager.characterIndexForGlyph(at: glyphIndex)
+
+        for item in linkItems {
+            if item.range.contains(characterIndex) {
+                switch item {
+                case .referencedUser:
+                    owsFailDebug("Should not have referenced user in long message body.")
+                    return
+                case .dataItem(let dataItem):
+                    UIApplication.shared.open(dataItem.url, options: [:], completionHandler: nil)
+                    return
+                case .mention(let mentionItem):
+                    ImpactHapticFeedback.impactOccurred(style: .light)
+
+                    var groupViewHelper: GroupViewHelper?
+                    if threadViewModel.isGroupThread {
+                        groupViewHelper = GroupViewHelper(threadViewModel: threadViewModel)
+                        groupViewHelper!.delegate = self
+                    }
+
+                    let address = SignalServiceAddress(uuid: mentionItem.mentionUUID)
+                    let actionSheet = MemberActionSheet(address: address, groupViewHelper: groupViewHelper)
+                    actionSheet.present(from: self)
+                    return
+                case .unrevealedSpoiler(let unrevealedSpoiler):
+                    self.spoilerReveal.setSpoilerRevealed(
+                        withID: unrevealedSpoiler.spoilerId,
+                        interactionIdentifier: unrevealedSpoiler.interactionIdentifier
+                    )
+                    self.loadContent()
+                    return
+                }
+            }
+        }
+    }
 }
 
 // MARK: -
@@ -246,3 +351,17 @@ extension LongTextViewController: ForwardMessageDelegate {
         dismiss(animated: true)
     }
 }
+
+// MARK: -
+
+extension LongTextViewController: GroupViewHelperDelegate {
+    var currentGroupModel: TSGroupModel? {
+        return (threadViewModel.threadRecord as? TSGroupThread)?.groupModel
+    }
+
+    func groupViewHelperDidUpdateGroup() {}
+
+    var fromViewController: UIViewController? {
+        return self
+    }
+}
diff --git a/Signal/src/ViewControllers/MessageDetailViewController.swift b/Signal/src/ViewControllers/MessageDetailViewController.swift
index 6dcdfe95034..829e3b34ba2 100644
--- a/Signal/src/ViewControllers/MessageDetailViewController.swift
+++ b/Signal/src/ViewControllers/MessageDetailViewController.swift
@@ -25,6 +25,7 @@ class MessageDetailViewController: OWSTableViewController2 {
     private var thread: TSThread? { renderItem?.itemModel.thread }
 
     private(set) var message: TSMessage
+    private let spoilerReveal: CVSpoilerReveal
     private var wasDeleted: Bool = false
     private var isIncoming: Bool { message as? TSIncomingMessage != nil }
     private var expires: Bool { message.expiresInSeconds > 0 }
@@ -116,9 +117,11 @@ class MessageDetailViewController: OWSTableViewController2 {
 
     required init(
         message: TSMessage,
+        spoilerReveal: CVSpoilerReveal,
         thread: TSThread
     ) {
         self.message = message
+        self.spoilerReveal = spoilerReveal
         super.init()
     }
 
@@ -198,7 +201,11 @@ class MessageDetailViewController: OWSTableViewController2 {
         self.contents = contents
     }
 
-    private func buildRenderItem(message interaction: TSMessage, transaction: SDSAnyReadTransaction) -> CVRenderItem? {
+    private func buildRenderItem(
+        message interaction: TSMessage,
+        spoilerReveal: CVSpoilerReveal,
+        transaction: SDSAnyReadTransaction
+    ) -> CVRenderItem? {
         guard let thread = TSThread.anyFetch(
             uniqueId: interaction.uniqueThreadId,
             transaction: transaction
@@ -224,6 +231,7 @@ class MessageDetailViewController: OWSTableViewController2 {
             thread: thread,
             threadAssociatedData: threadAssociatedData,
             conversationStyle: conversationStyle,
+            spoilerReveal: spoilerReveal,
             transaction: transaction
         )
     }
@@ -832,7 +840,11 @@ extension MessageDetailViewController: DatabaseChangeDelegate {
             }
             self.message = newMessage
             self.attachments = newMessage.mediaAttachments(with: transaction.unwrapGrdbRead)
-            guard let renderItem = buildRenderItem(message: newMessage, transaction: transaction) else {
+            guard let renderItem = buildRenderItem(
+                message: newMessage,
+                spoilerReveal: spoilerReveal,
+                transaction: transaction
+            ) else {
                 return false
             }
             self.renderItem = renderItem
@@ -978,13 +990,7 @@ extension MessageDetailViewController: CVComponentDelegate {
     func didTapReactions(reactionState: InteractionReactionState,
                          message: TSMessage) {}
 
-    func didTapTruncatedTextMessage(_ itemViewModel: CVItemViewModelImpl) {
-        AssertIsOnMainThread()
-
-        let viewController = LongTextViewController(itemViewModel: itemViewModel)
-        viewController.delegate = self
-        navigationController?.pushViewController(viewController, animated: true)
-    }
+    func didTapTruncatedTextMessage(_ itemViewModel: CVItemViewModelImpl) {}
 
     // TODO:
     var hasPendingMessageRequest: Bool { false }
diff --git a/Signal/src/views/MockConversationView.swift b/Signal/src/views/MockConversationView.swift
index 32be4e51b1b..ba171a64ca8 100644
--- a/Signal/src/views/MockConversationView.swift
+++ b/Signal/src/views/MockConversationView.swift
@@ -146,6 +146,7 @@ class MockConversationView: UIView {
                     thread: self.thread,
                     threadAssociatedData: threadAssociatedData,
                     conversationStyle: conversationStyle,
+                    spoilerReveal: CVSpoilerReveal(),
                     transaction: transaction
                 ) else {
                     owsFailDebug("Could not build renderItem.")
diff --git a/Signal/src/views/QuotedReplyPreview.swift b/Signal/src/views/QuotedReplyPreview.swift
index 3208df6d7f3..fd3fab97380 100644
--- a/Signal/src/views/QuotedReplyPreview.swift
+++ b/Signal/src/views/QuotedReplyPreview.swift
@@ -9,12 +9,13 @@ protocol QuotedReplyPreviewDelegate: AnyObject {
     func quotedReplyPreviewDidPressCancel(_ preview: QuotedReplyPreview)
 }
 
-class QuotedReplyPreview: UIView, OWSQuotedMessageViewDelegate {
+class QuotedReplyPreview: UIView, OWSQuotedMessageViewDelegate, CVSpoilerObserver {
 
     public weak var delegate: QuotedReplyPreviewDelegate?
 
     private let quotedReply: OWSQuotedReplyModel
     private let conversationStyle: ConversationStyle
+    private let spoilerReveal: CVSpoilerReveal
     private var quotedMessageView: OWSQuotedMessageView?
     private var heightConstraint: NSLayoutConstraint!
 
@@ -28,9 +29,14 @@ class QuotedReplyPreview: UIView, OWSQuotedMessageViewDelegate {
         fatalError("init(frame:) has not been implemented")
     }
 
-    init(quotedReply: OWSQuotedReplyModel, conversationStyle: ConversationStyle) {
+    init(
+        quotedReply: OWSQuotedReplyModel,
+        conversationStyle: ConversationStyle,
+        spoilerReveal: CVSpoilerReveal
+    ) {
         self.quotedReply = quotedReply
         self.conversationStyle = conversationStyle
+        self.spoilerReveal = spoilerReveal
 
         super.init(frame: .zero)
 
@@ -38,9 +44,21 @@ class QuotedReplyPreview: UIView, OWSQuotedMessageViewDelegate {
 
         updateContents()
 
+        spoilerReveal.observeChanges(
+            for: CVInteractionIdentifier(
+                timestamp: quotedReply.timestamp,
+                authorUuid: quotedReply.authorAddress.uuidString
+            ),
+            observer: self
+        )
+
         NotificationCenter.default.addObserver(self, selector: #selector(contentSizeCategoryDidChange), name: UIContentSizeCategory.didChangeNotification, object: nil)
     }
 
+    public func didUpdateRevealedSpoilers() {
+        updateContents()
+    }
+
     private let draftMarginTop: CGFloat = 6
 
     func updateContents() {
@@ -55,7 +73,11 @@ class QuotedReplyPreview: UIView, OWSQuotedMessageViewDelegate {
         // We instantiate quotedMessageView late to ensure that it is updated
         // every time contentSizeCategoryDidChange (i.e. when dynamic type
         // sizes changes).
-        let quotedMessageView = OWSQuotedMessageView(forPreview: quotedReply, conversationStyle: conversationStyle)
+        let quotedMessageView = OWSQuotedMessageView.forPreview(
+            quotedReply,
+            conversationStyle: conversationStyle,
+            spoilerReveal: spoilerReveal
+        )
         quotedMessageView.delegate = self
         self.quotedMessageView = quotedMessageView
         quotedMessageView.setContentHuggingHorizontalLow()
diff --git a/Signal/test/ViewControllers/CVTextTest.swift b/Signal/test/ViewControllers/CVTextTest.swift
index 5394d3d55e4..8544c0b0b29 100644
--- a/Signal/test/ViewControllers/CVTextTest.swift
+++ b/Signal/test/ViewControllers/CVTextTest.swift
@@ -290,7 +290,8 @@ class CVTextTest: XCTestCase {
             shouldAllowLinkification: true,
             textWasTruncated: true,
             revealedSpoilerIds: Set(),
-            interactionUniqueId: UUID().uuidString
+            interactionUniqueId: UUID().uuidString,
+            interactionIdentifier: CVInteractionIdentifier(timestamp: 0, authorUuid: nil)
         )
         var values: [String] = []
         var ranges: [NSRange] = []
@@ -311,7 +312,8 @@ class CVTextTest: XCTestCase {
             shouldAllowLinkification: true,
             textWasTruncated: false,
             revealedSpoilerIds: Set(),
-            interactionUniqueId: UUID().uuidString
+            interactionUniqueId: UUID().uuidString,
+            interactionIdentifier: CVInteractionIdentifier(timestamp: 0, authorUuid: nil)
         )
         values.removeAll()
         ranges.removeAll()
@@ -333,7 +335,8 @@ class CVTextTest: XCTestCase {
             shouldAllowLinkification: true,
             textWasTruncated: true,
             revealedSpoilerIds: Set(),
-            interactionUniqueId: UUID().uuidString
+            interactionUniqueId: UUID().uuidString,
+            interactionIdentifier: CVInteractionIdentifier(timestamp: 0, authorUuid: nil)
         )
         values.removeAll()
         truncatedEmail.enumerateAttribute(.link, in: truncatedEmail.entireRange, options: []) { value, _, _ in
@@ -351,7 +354,8 @@ class CVTextTest: XCTestCase {
             shouldAllowLinkification: true,
             textWasTruncated: true,
             revealedSpoilerIds: Set(),
-            interactionUniqueId: UUID().uuidString
+            interactionUniqueId: UUID().uuidString,
+            interactionIdentifier: CVInteractionIdentifier(timestamp: 0, authorUuid: nil)
         )
         values.removeAll()
         truncatedPhone.enumerateAttribute(.link, in: truncatedPhone.entireRange, options: []) { value, _, _ in
diff --git a/SignalUI/Views/ConversationView/CVInteractionIdentifier.swift b/SignalUI/Views/ConversationView/CVInteractionIdentifier.swift
new file mode 100644
index 00000000000..01a0cecfce5
--- /dev/null
+++ b/SignalUI/Views/ConversationView/CVInteractionIdentifier.swift
@@ -0,0 +1,32 @@
+//
+// Copyright 2023 Signal Messenger, LLC
+// SPDX-License-Identifier: AGPL-3.0-only
+//
+
+import Foundation
+
+/// Used to uniquely identify one iteration of an interaction even if edits are applied.
+/// Note that the interaction's uniqueId, rowId, and sortId always point to the latest edit,
+/// so when an edit is applied they point to the new version not the old version.
+/// This is used instead to continue to point to the old version.
+///
+/// authorUuid is allowed to be null for outgoing or system messages because timestamp can
+/// be considered unique on its own for messages generated by oneself.
+/// Incoming messages should always have non-null authorUuid.
+/// NOTE: be careful using this for messages from before the introduction of uuids.
+/// Currently used for text formatting spoilers which were introduced after uuids.
+public struct CVInteractionIdentifier: Equatable, Hashable {
+    let timestamp: UInt64
+    // Note: this will always be the aci for incoming messages
+    // and nil for local/outgoing messages.
+    let authorUuid: String?
+
+    public init(timestamp: UInt64, authorUuid: String?) {
+        self.timestamp = timestamp
+        self.authorUuid = authorUuid
+    }
+
+    public static func fromInteraction(_ interaction: TSInteraction) -> Self {
+        return .init(timestamp: interaction.timestamp, authorUuid: (interaction as? TSIncomingMessage)?.authorUUID)
+    }
+}
diff --git a/SignalUI/Views/ConversationView/CVTextLabel.swift b/SignalUI/Views/ConversationView/CVTextLabel.swift
index 88f52144d8f..c078f6c360c 100644
--- a/SignalUI/Views/ConversationView/CVTextLabel.swift
+++ b/SignalUI/Views/ConversationView/CVTextLabel.swift
@@ -38,11 +38,18 @@ public class CVTextLabel: NSObject {
     public struct UnrevealedSpoilerItem: Equatable {
         public let spoilerId: Int
         public let interactionUniqueId: String
+        public let interactionIdentifier: CVInteractionIdentifier
         public let range: NSRange
 
-        public init(spoilerId: Int, interactionUniqueId: String, range: NSRange) {
+        public init(
+            spoilerId: Int,
+            interactionUniqueId: String,
+            interactionIdentifier: CVInteractionIdentifier,
+            range: NSRange
+        ) {
             self.spoilerId = spoilerId
             self.interactionUniqueId = interactionUniqueId
+            self.interactionIdentifier = interactionIdentifier
             self.range = range
         }
     }
diff --git a/SignalUI/Views/Mentions/SpoilerDisplayConfigurations.swift b/SignalUI/Views/Mentions/SpoilerDisplayConfigurations.swift
index 2786bc4dcc1..0e1ed92e5b5 100644
--- a/SignalUI/Views/Mentions/SpoilerDisplayConfigurations.swift
+++ b/SignalUI/Views/Mentions/SpoilerDisplayConfigurations.swift
@@ -22,13 +22,12 @@ extension StyleDisplayConfiguration {
         )
     }
 
-    public static var quotedReply: Self {
+    public static func quotedReply(revealedSpoilerIds: Set<StyleIdType>) -> Self {
         return StyleDisplayConfiguration(
             baseFont: .dynamicTypeBody,
             textColor: primaryTextColor,
             revealAllIds: false,
-            // No reveals in quoted replies under any circumstances.
-            revealedIds: Set()
+            revealedIds: revealedSpoilerIds
         )
     }
 
@@ -62,6 +61,15 @@ extension StyleDisplayConfiguration {
         )
     }
 
+    public static func longTextView(revealedSpoilerIds: Set<StyleIdType>) -> StyleDisplayConfiguration {
+        return StyleDisplayConfiguration(
+            baseFont: .dynamicTypeBody,
+            textColor: primaryTextColor,
+            revealAllIds: false,
+            revealedIds: revealedSpoilerIds
+        )
+    }
+
     private static let primaryTextColor = ThemedColor(
         light: Theme.lightThemePrimaryColor,
         dark: Theme.darkThemePrimaryColor
