diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentAudioAttachment.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentAudioAttachment.swift
index 3f945e080b6..ed252218ddb 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentAudioAttachment.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentAudioAttachment.swift
@@ -3,6 +3,7 @@
 //
 
 import Foundation
+import SignalMessaging
 
 @objc
 public class CVComponentAudioAttachment: CVComponentBase, CVComponent {
@@ -30,23 +31,46 @@ public class CVComponentAudioAttachment: CVComponentBase, CVComponent {
             return
         }
 
+        let stackView = componentView.stackView
+
         owsAssertDebug(attachment.isAudio)
         // TODO: We might want to convert AudioMessageView into a form that can be reused.
         let audioMessageView = AudioMessageView(audioAttachment: audioAttachment,
-                                                isIncoming: isIncoming,
-                                                conversationStyle: conversationStyle)
+                                                isIncoming: isIncoming)
+        audioMessageView.configureForRendering(cellMeasurement: cellMeasurement,
+                                               conversationStyle: conversationStyle)
         componentView.audioMessageView = audioMessageView
-        componentView.rootView.addSubview(audioMessageView)
-        audioMessageView.autoPinEdgesToSuperviewEdges()
+        stackView.configure(config: stackViewConfig,
+                            cellMeasurement: cellMeasurement,
+                            measurementKey: Self.measurementKey_stackView,
+                            subviews: [ audioMessageView ])
+    }
+
+    private var stackViewConfig: CVStackViewConfig {
+        CVStackViewConfig(axis: .vertical,
+                          alignment: .fill,
+                          spacing: 0,
+                          layoutMargins: .zero)
     }
 
+    private static let measurementKey_stackView = "CVComponentAudioAttachment.measurementKey_stackView"
+
     public func measure(maxWidth: CGFloat, measurementBuilder: CVCellMeasurement.Builder) -> CGSize {
         owsAssertDebug(maxWidth > 0)
 
-        let height = AudioMessageView.measureHeight(audioAttachment: audioAttachment,
-                                                    isIncoming: isIncoming,
-                                                    conversationStyle: conversationStyle)
-        return CGSize(width: maxWidth, height: height).ceil
+        let audioSize = AudioMessageView.measure(maxWidth: maxWidth,
+                                                 audioAttachment: audioAttachment,
+                                                 isIncoming: isIncoming,
+                                                 conversationStyle: conversationStyle,
+                                                 measurementBuilder: measurementBuilder).ceil
+        let audioInfo = ManualStackSubviewInfo(measuredSize: audioSize)
+        let stackMeasurement = ManualStackView.measure(config: stackViewConfig,
+                                                       measurementBuilder: measurementBuilder,
+                                                       measurementKey: Self.measurementKey_stackView,
+                                                       subviewInfos: [ audioInfo ])
+        var measuredSize = stackMeasurement.measuredSize
+        measuredSize.width = maxWidth
+        return measuredSize
     }
 
     // MARK: - Events
@@ -155,20 +179,20 @@ public class CVComponentAudioAttachment: CVComponentBase, CVComponent {
     @objc
     public class CVComponentViewAudioAttachment: NSObject, CVComponentView {
 
-        fileprivate let containerView = UIView.container()
+        fileprivate let stackView = ManualStackView(name: "CVComponentViewAudioAttachment.stackView")
 
         fileprivate var audioMessageView: AudioMessageView?
 
         public var isDedicatedCellView = false
 
         public var rootView: UIView {
-            containerView
+            stackView
         }
 
         public func setIsCellVisible(_ isCellVisible: Bool) {}
 
         public func reset() {
-            containerView.removeAllSubviews()
+            stackView.reset()
 
             audioMessageView?.removeFromSuperview()
             audioMessageView = nil
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyMedia.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyMedia.swift
index c2be5ed539f..81a2a100223 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyMedia.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyMedia.swift
@@ -65,6 +65,7 @@ public class CVComponentBodyMedia: CVComponentBase, CVComponent {
 
         let conversationStyle = self.conversationStyle
 
+        // TODO:
         let albumView = componentView.albumView
         albumView.configure(mediaCache: self.mediaCache,
                             items: self.items,
@@ -94,6 +95,7 @@ public class CVComponentBodyMedia: CVComponentBase, CVComponent {
                                                 cellMeasurement: cellMeasurement,
                                                 componentDelegate: componentDelegate)
             stackView.addSubview(footerView.rootView)
+            // TODO:
             footerView.rootView.autoPinEdge(toSuperviewEdge: .leading,
                                             withInset: conversationStyle.textInsetHorizontal)
             footerView.rootView.autoPinEdge(toSuperviewEdge: .trailing,
@@ -147,6 +149,7 @@ public class CVComponentBodyMedia: CVComponentBase, CVComponent {
                 let pillView = OWSLayerView.pillView()
                 pillView.backgroundColor = UIColor.ows_black.withAlphaComponent(0.8)
                 downloadStack.addSubview(pillView)
+                // TODO:
                 pillView.autoPinEdgesToSuperviewEdges()
 
                 iconView.autoSetDimensions(to: CGSize.square(20))
@@ -164,6 +167,7 @@ public class CVComponentBodyMedia: CVComponentBase, CVComponent {
                 downloadStack.addArrangedSubview(downloadLabel)
 
                 stackView.addSubview(downloadStack)
+                // TODO:
                 downloadStack.autoCenterInSuperview()
             } else {
                 let circleSize: CGFloat = 44
@@ -205,9 +209,11 @@ public class CVComponentBodyMedia: CVComponentBase, CVComponent {
                     downloadSizeLabel.textColor = UIColor.ows_white
                     downloadSizeLabel.font = .ows_dynamicTypeCaption1
                     downloadSizeView.addSubview(downloadSizeLabel)
+                    // TODO:
                     downloadSizeLabel.autoPinEdgesToSuperviewMargins()
 
                     componentView.rootView.addSubview(downloadSizeView)
+                    // TODO:
                     downloadSizeView.autoPinEdge(toSuperviewEdge: .top, withInset: 9)
                     downloadSizeView.autoPinEdge(toSuperviewEdge: .leading, withInset: 16)
                 }
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift
index 888968b0be2..4506f6db424 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentBodyText.swift
@@ -254,8 +254,6 @@ public class CVComponentBodyText: CVComponentBase, CVComponent {
             return
         }
 
-        let stackView = componentView.stackView
-
         switch bodyText {
         case .bodyText(let displayableText):
             configureForBodyText(componentView: componentView,
diff --git a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSticker.swift b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSticker.swift
index e56dde93821..9ad44da0236 100644
--- a/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSticker.swift
+++ b/Signal/src/ViewControllers/ConversationView/CV/CVComponents/CVComponentSticker.swift
@@ -52,6 +52,7 @@ public class CVComponentSticker: CVComponentBase, CVComponent {
                 reusableMediaView = cachedView
             } else {
                 let mediaViewAdapter = MediaViewAdapterSticker(attachmentStream: attachmentStream)
+                // TODO:
                 reusableMediaView = ReusableMediaView(mediaViewAdapter: mediaViewAdapter, mediaCache: mediaCache)
                 mediaCache.setMediaView(reusableMediaView, forKey: cacheKey, isAnimated: isAnimated)
             }
@@ -71,6 +72,7 @@ public class CVComponentSticker: CVComponentBase, CVComponent {
             case .none:
                 break
             case .uploading:
+                // TODO:
                 let progressView = CVAttachmentProgressView(direction: .upload(attachmentStream: attachmentStream),
                                                             style: .withCircle,
                                                             conversationStyle: conversationStyle)
@@ -100,6 +102,7 @@ public class CVComponentSticker: CVComponentBase, CVComponent {
                                 measurementKey: Self.measurementKey_stackView,
                                 subviews: [ placeholderView ])
 
+            // TODO:
             let progressView = CVAttachmentProgressView(direction: .download(attachmentPointer: attachmentPointer),
                                                         style: .withCircle,
                                                         conversationStyle: conversationStyle)
diff --git a/Signal/src/ViewControllers/ConversationView/Cells/AudioMessageView.swift b/Signal/src/ViewControllers/ConversationView/Cells/AudioMessageView.swift
index a2584c3e6cd..eec8c93fa96 100644
--- a/Signal/src/ViewControllers/ConversationView/Cells/AudioMessageView.swift
+++ b/Signal/src/ViewControllers/ConversationView/Cells/AudioMessageView.swift
@@ -5,7 +5,7 @@
 import Foundation
 import Lottie
 
-class AudioMessageView: OWSStackView {
+class AudioMessageView: ManualStackView {
 
     private let audioAttachment: AudioAttachment
     private var attachment: TSAttachment { audioAttachment.attachment }
@@ -28,12 +28,13 @@ class AudioMessageView: OWSStackView {
     }
 
     private let isIncoming: Bool
-    private let conversationStyle: ConversationStyle
 
     private let playPauseAnimation = AnimationView(name: "playPauseButton")
     private let playbackTimeLabel = UILabel()
     private let progressSlider = UISlider()
     private let waveformProgress = AudioWaveformProgressView()
+    private let waveformContainer = OWSLayerView()
+    private let waveformAndLabelContainer = OWSLayerView()
 
     private var audioPlaybackState: AudioPlaybackState {
         cvAudioPlayer.audioPlaybackState(forAttachmentId: attachment.uniqueId)
@@ -47,42 +48,48 @@ class AudioMessageView: OWSStackView {
     }
 
     @objc
-    init(audioAttachment: AudioAttachment, isIncoming: Bool, conversationStyle: ConversationStyle) {
+    init(audioAttachment: AudioAttachment, isIncoming: Bool) {
         self.audioAttachment = audioAttachment
         self.isIncoming = isIncoming
-        self.conversationStyle = conversationStyle
 
         super.init(name: "AudioMessageView")
+    }
+
+    public func configureForRendering(cellMeasurement: CVCellMeasurement,
+                                      conversationStyle: ConversationStyle) {
 
-        self.apply(config: Self.outerStackConfig)
+        var outerSubviews = [UIView]()
 
         if let topLabelConfig = Self.topLabelConfig(audioAttachment: audioAttachment,
-                                           isIncoming: isIncoming,
-                                           conversationStyle: conversationStyle) {
+                                                    isIncoming: isIncoming,
+                                                    conversationStyle: conversationStyle) {
             let topLabel = UILabel()
             topLabelConfig.applyForRendering(label: topLabel)
-            addArrangedSubview(topLabel)
+            outerSubviews.append(topLabel)
         }
 
-        let waveformContainer = UIView.container()
-        waveformContainer.autoSetDimension(.height, toSize: AudioMessageView.waveformHeight)
-
         waveformProgress.playedColor = playedColor
         waveformProgress.unplayedColor = unplayedColor
         waveformProgress.thumbColor = thumbColor
         waveformContainer.addSubview(waveformProgress)
-        waveformProgress.autoPinEdgesToSuperviewEdges()
 
         progressSlider.setThumbImage(UIImage(named: "audio_message_thumb")?.asTintedImage(color: thumbColor), for: .normal)
         progressSlider.setMinimumTrackImage(trackImage(color: playedColor), for: .normal)
         progressSlider.setMaximumTrackImage(trackImage(color: unplayedColor), for: .normal)
-
         waveformContainer.addSubview(progressSlider)
-        progressSlider.autoPinWidthToSuperview()
-        progressSlider.autoSetDimension(.height, toSize: 12)
-        progressSlider.autoVCenterInSuperview()
         progressSlider.isEnabled = isDownloaded
 
+        let waveformProgress = self.waveformProgress
+        let progressSlider = self.progressSlider
+        waveformContainer.layoutCallback = { view in
+            waveformProgress.frame = view.bounds
+
+            var sliderFrame = view.bounds
+            sliderFrame.height = 12
+            sliderFrame.y = (view.bounds.height - sliderFrame.height) * 0.5
+            progressSlider.frame = sliderFrame
+        }
+
         Self.playbackTimeLabelConfig(isIncoming: isIncoming,
                                      conversationStyle: conversationStyle).applyForRendering(label: playbackTimeLabel)
         playbackTimeLabel.setContentHuggingHigh()
@@ -97,8 +104,6 @@ class AudioMessageView: OWSStackView {
             playPauseAnimation.animationSpeed = 3
             playPauseAnimation.backgroundBehavior = .forceFinish
             playPauseAnimation.contentMode = .scaleAspectFit
-            playPauseAnimation.autoSetDimensions(to: CGSize(square: Self.animationSize))
-            playPauseAnimation.setContentHuggingHigh()
 
             let fillColorKeypath = AnimationKeypath(keypath: "**.Fill 1.Color")
             playPauseAnimation.setValueProvider(ColorValueProvider(thumbColor.lottieColorValue), keypath: fillColorKeypath)
@@ -113,16 +118,93 @@ class AudioMessageView: OWSStackView {
             leftView = UIView()
         }
 
-        let innerStack = OWSStackView(name: "playerStack",
-                                      arrangedSubviews: [leftView, waveformContainer, playbackTimeLabel])
-        innerStack.apply(config: Self.innerStackConfig)
-        addArrangedSubview(innerStack)
+        let waveformContainer = self.waveformContainer
+        let playbackTimeLabel = self.playbackTimeLabel
+        let waveformHeight = Self.waveformHeight
+        waveformAndLabelContainer.layoutCallback = { view in
+            // The size of playbackTimeLabel is constantly fluctuating,
+            // so we can't use a pre-measured, fixed size.
+            let spacing = Self.innerStackConfig.spacing
+            var labelSize = playbackTimeLabel.sizeThatFits(CGSize(width: CGFloat.greatestFiniteMagnitude,
+                                                                  height: CGFloat.greatestFiniteMagnitude))
+            labelSize.width = min(labelSize.width,
+                                  view.bounds.width - spacing)
+            labelSize.height = min(labelSize.height,
+                                   view.bounds.height)
+            let labelFrame = CGRect(origin: CGPoint(x: view.bounds.width - labelSize.width,
+                                                    y: (view.bounds.height - labelSize.height) * 0.5),
+                                    size: labelSize)
+            playbackTimeLabel.frame = labelFrame
+
+            let waveformContainerFrame = CGRect(x: 0,
+                                                y: (view.bounds.height - waveformHeight) * 0.5,
+                                                width: labelFrame.x - spacing,
+                                                height: waveformHeight)
+            waveformContainer.frame = waveformContainerFrame
+        }
+
+        let innerStack = ManualStackView(name: "playerStack")
+        innerStack.configure(config: Self.innerStackConfig,
+                             cellMeasurement: cellMeasurement,
+                             measurementKey: Self.measurementKey_innerStack,
+                             subviews: [
+                                leftView, waveformAndLabelContainer
+                             ])
+        outerSubviews.append(innerStack)
+
+        self.configure(config: Self.outerStackConfig,
+                       cellMeasurement: cellMeasurement,
+                       measurementKey: Self.measurementKey_outerStack,
+                       subviews: outerSubviews)
 
         updateContents(animated: false)
 
         cvAudioPlayer.addListener(self)
     }
 
+    private static let measurementKey_innerStack = "CVComponentAudioAttachment.measurementKey_innerStack"
+    private static let measurementKey_outerStack = "CVComponentAudioAttachment.measurementKey_outerStack"
+
+    public static func measure(maxWidth: CGFloat,
+                               audioAttachment: AudioAttachment,
+                               isIncoming: Bool,
+                               conversationStyle: ConversationStyle,
+                               measurementBuilder: CVCellMeasurement.Builder) -> CGSize {
+        owsAssertDebug(maxWidth > 0)
+
+        var outerSubviewInfos = [ManualStackSubviewInfo]()
+        if let topLabelConfig = Self.topLabelConfig(audioAttachment: audioAttachment,
+                                                    isIncoming: isIncoming,
+                                                    conversationStyle: conversationStyle) {
+            let topLabelSize = CGSize(width: 0, height: topLabelConfig.font.lineHeight)
+            outerSubviewInfos.append(ManualStackSubviewInfo(measuredSize: topLabelSize))
+        }
+
+        var innerSubviewInfos = [ManualStackSubviewInfo]()
+        let leftViewSize = CGSize(square: animationSize)
+        innerSubviewInfos.append(ManualStackSubviewInfo(measuredSize: leftViewSize,
+                                                        hasFixedSize: true))
+
+        let waveformAndLabelSize = CGSize(width: 0,
+                                          height: max(waveformHeight,
+                                                      playbackTimeLabelConfig(isIncoming: isIncoming,
+                                                                              conversationStyle: conversationStyle).font.lineHeight))
+        innerSubviewInfos.append(ManualStackSubviewInfo(measuredSize: waveformAndLabelSize))
+
+        let innerStackMeasurement = ManualStackView.measure(config: innerStackConfig,
+                                                            measurementBuilder: measurementBuilder,
+                                                            measurementKey: Self.measurementKey_innerStack,
+                                                            subviewInfos: innerSubviewInfos)
+        let innerStackSize = innerStackMeasurement.measuredSize
+        outerSubviewInfos.append(ManualStackSubviewInfo(measuredSize: innerStackSize.ceil))
+
+        let outerStackMeasurement = ManualStackView.measure(config: outerStackConfig,
+                                                            measurementBuilder: measurementBuilder,
+                                                            measurementKey: Self.measurementKey_outerStack,
+                                                            subviewInfos: outerSubviewInfos)
+        return outerStackMeasurement.measuredSize
+    }
+
     @available(swift, obsoleted: 1.0)
     required init(name: String, arrangedSubviews: [UIView] = []) {
         owsFail("Do not use this initializer.")
@@ -170,30 +252,6 @@ class AudioMessageView: OWSStackView {
                              textColor: conversationStyle.bubbleSecondaryTextColor(isIncoming: isIncoming))
     }
 
-    @objc
-    static func measureHeight(audioAttachment: AudioAttachment,
-                              isIncoming: Bool,
-                              conversationStyle: ConversationStyle) -> CGFloat {
-
-        var outerSubviewSizes = [CGSize]()
-        if let topLabelConfig = Self.topLabelConfig(audioAttachment: audioAttachment,
-                                                    isIncoming: isIncoming,
-                                                    conversationStyle: conversationStyle) {
-            outerSubviewSizes.append(CGSize(width: 0, height: topLabelConfig.font.lineHeight))
-        }
-
-        let playPauseAnimationSize = CGSize(square: animationSize)
-        let waveformSize = CGSize(width: 0, height: waveformHeight)
-        let playbackTimeLabelSize = CGSize(width: 0, height: playbackTimeLabelConfig(isIncoming: isIncoming,
-                                                                                     conversationStyle: conversationStyle).font.lineHeight)
-        let innerSubviewSizes = [playPauseAnimationSize, waveformSize, playbackTimeLabelSize]
-        let innerStackSize = CVStackView.measure(config: innerStackConfig, subviewSizes: innerSubviewSizes)
-        outerSubviewSizes.append(innerStackSize)
-
-        let outerStackSize = CVStackView.measure(config: outerStackConfig, subviewSizes: outerSubviewSizes)
-        return outerStackSize.height
-    }
-
     // MARK: - Scrubbing
 
     @objc var isScrubbing = false
@@ -291,6 +349,7 @@ class AudioMessageView: OWSStackView {
     private func updateElapsedTime(_ elapsedSeconds: TimeInterval) {
         let timeRemaining = Int(durationSeconds - elapsedSeconds)
         playbackTimeLabel.text = OWSFormat.formatDurationSeconds(timeRemaining)
+        waveformAndLabelContainer.setNeedsLayout()
     }
 
     private func updateAudioProgress() {
diff --git a/Signal/src/ViewControllers/ConversationView/Cells/AudioWaveformProgressView.swift b/Signal/src/ViewControllers/ConversationView/Cells/AudioWaveformProgressView.swift
index f1ac150c757..16b7346e15b 100644
--- a/Signal/src/ViewControllers/ConversationView/Cells/AudioWaveformProgressView.swift
+++ b/Signal/src/ViewControllers/ConversationView/Cells/AudioWaveformProgressView.swift
@@ -1,5 +1,5 @@
 //
-//  Copyright (c) 2020 Open Whisper Systems. All rights reserved.
+//  Copyright (c) 2021 Open Whisper Systems. All rights reserved.
 //
 
 import Foundation
@@ -126,6 +126,10 @@ class AudioWaveformProgressView: UIView {
         loadingAnimation.isHidden = true
         thumbImageView.isHidden = false
 
+        guard width > 0 else {
+            return
+        }
+
         let sampleWidth: CGFloat = 2
         let minSampleSpacing: CGFloat = 2
         let minSampleHeight: CGFloat = 2
diff --git a/SignalMessaging/Views/ManualStackView.swift b/SignalMessaging/Views/ManualStackView.swift
index 6bf71450fe3..710a2189174 100644
--- a/SignalMessaging/Views/ManualStackView.swift
+++ b/SignalMessaging/Views/ManualStackView.swift
@@ -17,6 +17,12 @@ public struct ManualStackSubviewInfo: Equatable {
         self.hasFixedHeight = hasFixedHeight
     }
 
+    public init(measuredSize: CGSize, hasFixedSize: Bool) {
+        self.measuredSize = measuredSize
+        self.hasFixedWidth = hasFixedSize
+        self.hasFixedHeight = hasFixedSize
+    }
+
     public init(measuredSize: CGSize, subview: UIView) {
         self.measuredSize = measuredSize
 
@@ -73,7 +79,8 @@ open class ManualStackView: OWSStackView {
 
         func apply() {
             if subview.frame != frame {
-                subview.frame = frame
+                ManualStackView.setSubviewFrame(subview: subview,
+                                                frame: frame)
             }
         }
     }
@@ -225,8 +232,21 @@ open class ManualStackView: OWSStackView {
 
     // An alignment enum that can be used whether the layout axis
     // is horizontal or vertical.
-    private enum OffAxisAlignment {
+    private enum OffAxisAlignment: CustomStringConvertible {
         case minimum, center, maximum, fill
+
+        public var description: String {
+            switch self {
+            case .minimum:
+                return ".minimum"
+            case .center:
+                return ".center"
+            case .maximum:
+                return ".maximum"
+            case .fill:
+                return ".fill"
+            }
+        }
     }
 
     private func buildArrangement(measurement: Measurement,
@@ -309,7 +329,7 @@ open class ManualStackView: OWSStackView {
             }
 
             let adjustment = underflow / CGFloat(underflowLayoutItems.count)
-            for layoutItem in layoutItems {
+            for layoutItem in underflowLayoutItems {
                 layoutItem.onAxisSize = max(0, layoutItem.onAxisSize + adjustment)
             }
         } else if onAxisSizeTotal > onAxisMaxSize {
@@ -327,7 +347,7 @@ open class ManualStackView: OWSStackView {
             }
 
             let adjustment = overflow / CGFloat(overflowLayoutItems.count)
-            for layoutItem in layoutItems {
+            for layoutItem in overflowLayoutItems {
                 layoutItem.onAxisSize = max(0, layoutItem.onAxisSize - adjustment)
             }
         }
@@ -340,13 +360,13 @@ open class ManualStackView: OWSStackView {
         }
 
         // Determine offAxisSize and offAxisLocation.
-        for layoutItem in layoutItems {
+        for (index, layoutItem) in layoutItems.enumerated() {
             if layoutItem.offAxisMeasuredSize > offAxisMaxSize {
                 Logger.warn("\(name): Off-axis overflow: offAxisMeasuredSize: \(layoutItem.offAxisMeasuredSize) > offAxisMaxSize: \(offAxisMaxSize)")
             }
             var offAxisSize: CGFloat = min(layoutItem.offAxisMeasuredSize, offAxisMaxSize)
             if offAxisAlignment == .fill,
-               layoutItem.subviewInfo.hasFixedSizeOffAxis(isHorizontalLayout: isHorizontal) {
+               !layoutItem.subviewInfo.hasFixedSizeOffAxis(isHorizontalLayout: isHorizontal) {
                 offAxisSize = offAxisMaxSize
             }
             layoutItem.offAxisSize = offAxisSize
@@ -367,11 +387,6 @@ open class ManualStackView: OWSStackView {
             layoutItem.frame.y += layoutMargins.top
         }
 
-        // Apply layoutMargins.
-        for layoutItem in layoutItems {
-            layoutItem.frame.x += layoutMargins.left
-            layoutItem.frame.y += layoutMargins.top
-        }
         let arrangementItems = layoutItems.map { $0.asArrangementItem }
         return Arrangement(items: arrangementItems)
     }
@@ -542,10 +557,20 @@ open class ManualStackView: OWSStackView {
 
             let siblingCenter = superview.convert(siblingView.center,
                                                   from: siblingView.superview)
-            subview.frame = CGRect(origin: CGPoint(x: siblingCenter.x - subview.width * 0.5,
+            let subviewFrame = CGRect(origin: CGPoint(x: siblingCenter.x - subview.width * 0.5,
                                                    y: siblingCenter.y - subview.height * 0.5),
-                                   size: size)
+                                      size: size)
+            Self.setSubviewFrame(subview: subview,
+                                 frame: subviewFrame)
+        }
+    }
+
+    private static func setSubviewFrame(subview: UIView, frame: CGRect) {
+        guard subview.frame != frame else {
+            return
         }
+        subview.frame = frame
+        subview.setNeedsLayout()
     }
 
     public func centerSubviewOnSuperviewWithLayoutBlock(_ subview: UIView,
@@ -561,9 +586,11 @@ open class ManualStackView: OWSStackView {
             }
 
             let superviewBounds = superview.bounds
-            subview.frame = CGRect(origin: CGPoint(x: (superviewBounds.width - subview.width) * 0.5,
-                                                   y: (superviewBounds.height - subview.height) * 0.5),
-                                   size: size)
+            let subviewFrame = CGRect(origin: CGPoint(x: (superviewBounds.width - subview.width) * 0.5,
+                                                      y: (superviewBounds.height - subview.height) * 0.5),
+                                      size: size)
+            Self.setSubviewFrame(subview: subview,
+                                 frame: subviewFrame)
         }
     }
 
@@ -578,7 +605,8 @@ open class ManualStackView: OWSStackView {
                 return
             }
 
-            subview.frame = superview.bounds
+            Self.setSubviewFrame(subview: subview,
+                                 frame: superview.bounds)
         }
     }
 }
diff --git a/SignalMessaging/Views/OWSLayerView.swift b/SignalMessaging/Views/OWSLayerView.swift
index 9fd436cd0d2..8e6b241cd1d 100644
--- a/SignalMessaging/Views/OWSLayerView.swift
+++ b/SignalMessaging/Views/OWSLayerView.swift
@@ -67,7 +67,7 @@ open class OWSLayerView: UIView {
     public override var bounds: CGRect {
         didSet {
             if oldValue != bounds {
-                layoutCallback(self)
+                layoutSubviews()
             }
         }
     }
@@ -75,7 +75,7 @@ open class OWSLayerView: UIView {
     public override var frame: CGRect {
         didSet {
             if oldValue != frame {
-                layoutCallback(self)
+                layoutSubviews()
             }
         }
     }
@@ -83,18 +83,24 @@ open class OWSLayerView: UIView {
     public override var center: CGPoint {
         didSet {
             if oldValue != center {
-                layoutCallback(self)
+                layoutSubviews()
             }
         }
     }
 
+    public override func layoutSubviews() {
+        super.layoutSubviews()
+
+        layoutCallback(self)
+    }
+
     public func updateContent() {
         if shouldAnimate {
-            layoutCallback(self)
+            layoutSubviews()
         } else {
             CATransaction.begin()
             CATransaction.setDisableActions(true)
-            layoutCallback(self)
+            layoutSubviews()
             CATransaction.commit()
         }
     }
