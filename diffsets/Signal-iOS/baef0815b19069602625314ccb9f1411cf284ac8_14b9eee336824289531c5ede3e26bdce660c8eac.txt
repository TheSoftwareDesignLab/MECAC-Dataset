diff --git a/Signal.xcodeproj/project.pbxproj b/Signal.xcodeproj/project.pbxproj
index 996c5c6c7f5..34405a7b378 100644
--- a/Signal.xcodeproj/project.pbxproj
+++ b/Signal.xcodeproj/project.pbxproj
@@ -367,7 +367,6 @@
 		452C7CA72037628B003D51A5 /* Weak.swift in Sources */ = {isa = PBXBuildFile; fileRef = 45F170D51E315310003FC1F2 /* Weak.swift */; };
 		452D1AF12081059C00A67F7F /* StringAdditionsTest.swift in Sources */ = {isa = PBXBuildFile; fileRef = 452D1AF02081059C00A67F7F /* StringAdditionsTest.swift */; };
 		452EC6DF205E9E30000E787C /* MediaGalleryViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = 452EC6DE205E9E30000E787C /* MediaGalleryViewController.swift */; };
-		452EC6E1205FF5DC000E787C /* Bench.swift in Sources */ = {isa = PBXBuildFile; fileRef = 452EC6E0205FF5DC000E787C /* Bench.swift */; };
 		452ECA4D1E087E7200E2F016 /* MessageFetcherJob.swift in Sources */ = {isa = PBXBuildFile; fileRef = 452ECA4C1E087E7200E2F016 /* MessageFetcherJob.swift */; };
 		4535186B1FC635DD00210559 /* ShareViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = 4535186A1FC635DD00210559 /* ShareViewController.swift */; };
 		4535186E1FC635DD00210559 /* MainInterface.storyboard in Resources */ = {isa = PBXBuildFile; fileRef = 4535186C1FC635DD00210559 /* MainInterface.storyboard */; };
@@ -492,7 +491,6 @@
 		4C7537892193779700DF5E37 /* OWS113MultiAttachmentMediaMessages.swift in Sources */ = {isa = PBXBuildFile; fileRef = 4C7537882193779700DF5E37 /* OWS113MultiAttachmentMediaMessages.swift */; };
 		4C858A52212DC5E1001B45D3 /* UIImage+OWS.swift in Sources */ = {isa = PBXBuildFile; fileRef = 4C858A51212DC5E1001B45D3 /* UIImage+OWS.swift */; };
 		4C948FF72146EB4800349F0D /* BlockListCache.swift in Sources */ = {isa = PBXBuildFile; fileRef = 4C948FF62146EB4800349F0D /* BlockListCache.swift */; };
-		4C9936D2225D4954006B040A /* InteractionFinder.swift in Sources */ = {isa = PBXBuildFile; fileRef = 4C9936D1225D4954006B040A /* InteractionFinder.swift */; };
 		4C9B4F23225025F100DD5B9A /* OWS115GRDBMigration.swift in Sources */ = {isa = PBXBuildFile; fileRef = 4C9B4F22225025F100DD5B9A /* OWS115GRDBMigration.swift */; };
 		4C9CA25D217E676900607C63 /* ZXingObjC.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = 4C9CA25C217E676900607C63 /* ZXingObjC.framework */; };
 		4CA46F4C219CCC630038ABDE /* CaptionView.swift in Sources */ = {isa = PBXBuildFile; fileRef = 4CA46F4B219CCC630038ABDE /* CaptionView.swift */; };
@@ -1092,7 +1090,6 @@
 		452C468E1E427E200087B011 /* OutboundCallInitiator.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = OutboundCallInitiator.swift; sourceTree = "<group>"; };
 		452D1AF02081059C00A67F7F /* StringAdditionsTest.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = StringAdditionsTest.swift; sourceTree = "<group>"; };
 		452EC6DE205E9E30000E787C /* MediaGalleryViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = MediaGalleryViewController.swift; sourceTree = "<group>"; };
-		452EC6E0205FF5DC000E787C /* Bench.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = Bench.swift; sourceTree = "<group>"; };
 		452ECA4C1E087E7200E2F016 /* MessageFetcherJob.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = MessageFetcherJob.swift; sourceTree = "<group>"; };
 		453518681FC635DD00210559 /* SignalShareExtension.appex */ = {isa = PBXFileReference; explicitFileType = "wrapper.app-extension"; includeInIndex = 0; path = SignalShareExtension.appex; sourceTree = BUILT_PRODUCTS_DIR; };
 		4535186A1FC635DD00210559 /* ShareViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = ShareViewController.swift; sourceTree = "<group>"; };
@@ -1243,7 +1240,6 @@
 		4C7537882193779700DF5E37 /* OWS113MultiAttachmentMediaMessages.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = OWS113MultiAttachmentMediaMessages.swift; sourceTree = "<group>"; };
 		4C858A51212DC5E1001B45D3 /* UIImage+OWS.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "UIImage+OWS.swift"; sourceTree = "<group>"; };
 		4C948FF62146EB4800349F0D /* BlockListCache.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = BlockListCache.swift; sourceTree = "<group>"; };
-		4C9936D1225D4954006B040A /* InteractionFinder.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = InteractionFinder.swift; sourceTree = "<group>"; };
 		4C9B4F22225025F100DD5B9A /* OWS115GRDBMigration.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = OWS115GRDBMigration.swift; sourceTree = "<group>"; };
 		4C9CA25C217E676900607C63 /* ZXingObjC.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = ZXingObjC.framework; path = ThirdParty/Carthage/Build/iOS/ZXingObjC.framework; sourceTree = "<group>"; };
 		4CA46F49219C78050038ABDE /* GalleryRailView.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = GalleryRailView.swift; sourceTree = "<group>"; };
@@ -1624,7 +1620,6 @@
 			isa = PBXGroup;
 			children = (
 				349ED991221EE80D008045B0 /* AppPreferences.swift */,
-				452EC6E0205FF5DC000E787C /* Bench.swift */,
 				4C948FF62146EB4800349F0D /* BlockListCache.swift */,
 				343D3D991E9283F100165CA4 /* BlockListUIUtils.h */,
 				343D3D9A1E9283F100165CA4 /* BlockListUIUtils.m */,
@@ -1712,7 +1707,6 @@
 				341341ED2187467900192D59 /* ConversationViewModel.h */,
 				341341EE2187467900192D59 /* ConversationViewModel.m */,
 				34B6A904218B4C90007C4606 /* TypingIndicatorInteraction.swift */,
-				4C9936D1225D4954006B040A /* InteractionFinder.swift */,
 			);
 			path = ConversationView;
 			sourceTree = "<group>";
@@ -3405,7 +3399,6 @@
 				346129B51FD1F7E800532771 /* OWSProfileManager.m in Sources */,
 				4CBBCA6321714B4500EEB37D /* OWS110SortIdMigration.swift in Sources */,
 				342950832124C9750000B063 /* OWSTextView.m in Sources */,
-				452EC6E1205FF5DC000E787C /* Bench.swift in Sources */,
 				34BBC85D220D19D600857249 /* ImageEditorPanGestureRecognizer.swift in Sources */,
 				342950882124CB0A0000B063 /* OWSSearchBar.m in Sources */,
 				342950822124C9750000B063 /* OWSTextField.m in Sources */,
@@ -3654,7 +3647,6 @@
 				340FC8AB204DAC8D007AEB0F /* DomainFrontingCountryViewController.m in Sources */,
 				4C586926224FAB83003FD070 /* AVAudioSession+OWS.m in Sources */,
 				3496744D2076768700080B5F /* OWSMessageBubbleView.m in Sources */,
-				4C9936D2225D4954006B040A /* InteractionFinder.swift in Sources */,
 				34B3F8751E8DF1700035BE1A /* CallViewController.swift in Sources */,
 				4C4AE6A1224AF35700D4AF6F /* SendMediaNavigationController.swift in Sources */,
 				34D8C0281ED3673300188D7C /* DebugUITableViewController.m in Sources */,
diff --git a/Signal/src/UserInterface/Notifications/AppNotifications.swift b/Signal/src/UserInterface/Notifications/AppNotifications.swift
index 1c1deadd8d5..c6e78c4aff5 100644
--- a/Signal/src/UserInterface/Notifications/AppNotifications.swift
+++ b/Signal/src/UserInterface/Notifications/AppNotifications.swift
@@ -350,7 +350,7 @@ public class NotificationPresenter: NSObject, NotificationsProtocol {
         }
 
         // While batch processing, some of the necessary changes have not been commited.
-        let rawMessageText = incomingMessage.previewText(with: transaction)
+        let rawMessageText = incomingMessage.previewText(with: SDSAnyReadTransaction(transitional_yapReadTransaction: transaction))
 
         // iOS strips anything that looks like a printf formatting character from
         // the notification body, so if we want to dispay a literal "%" in a notification
@@ -462,7 +462,7 @@ public class NotificationPresenter: NSObject, NotificationsProtocol {
             notificationTitle = nil
         }
 
-        let notificationBody = errorMessage.previewText(with: transaction)
+        let notificationBody = errorMessage.previewText(with: SDSAnyReadTransaction(transitional_yapReadTransaction: transaction))
 
         guard let threadId = thread.uniqueId else {
             owsFailDebug("threadId was unexpectedly nil")
@@ -484,7 +484,7 @@ public class NotificationPresenter: NSObject, NotificationsProtocol {
     }
 
     public func notifyUser(forThreadlessErrorMessage errorMessage: TSErrorMessage, transaction: YapDatabaseReadWriteTransaction) {
-        let notificationBody = errorMessage.previewText(with: transaction)
+        let notificationBody = errorMessage.previewText(with: SDSAnyReadTransaction(transitional_yapReadTransaction: transaction))
 
         transaction.addCompletionQueue(DispatchQueue.main) {
             let sound = self.checkIfShouldPlaySound() ? OWSSounds.globalNotificationSound() : nil
diff --git a/Signal/src/ViewControllers/ConversationView/ConversationViewItem.m b/Signal/src/ViewControllers/ConversationView/ConversationViewItem.m
index 49aeceb3212..3ebd15bdb32 100644
--- a/Signal/src/ViewControllers/ConversationView/ConversationViewItem.m
+++ b/Signal/src/ViewControllers/ConversationView/ConversationViewItem.m
@@ -582,11 +582,8 @@ - (void)ensureViewState:(SDSAnyReadTransaction *)transaction
         case OWSInteractionType_Error:
         case OWSInteractionType_Info:
         case OWSInteractionType_Call:
-            if (transaction.transitional_yapReadTransaction) {
-                self.systemMessageText =
-                    [self systemMessageTextWithTransaction:transaction.transitional_yapReadTransaction];
-                OWSAssertDebug(self.systemMessageText.length > 0);
-            }
+            self.systemMessageText = [self systemMessageTextWithTransaction:transaction];
+            OWSAssertDebug(self.systemMessageText.length > 0);
             return;
         case OWSInteractionType_IncomingMessage:
         case OWSInteractionType_OutgoingMessage:
@@ -810,7 +807,7 @@ - (void)ensureViewState:(SDSAnyReadTransaction *)transaction
     return mediaAlbumItems;
 }
 
-- (NSString *)systemMessageTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)systemMessageTextWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     OWSAssertDebug(transaction);
 
diff --git a/SignalMessaging/ViewModels/ThreadViewModel.swift b/SignalMessaging/ViewModels/ThreadViewModel.swift
index 16f8fa16aec..b1e8a1ac7a3 100644
--- a/SignalMessaging/ViewModels/ThreadViewModel.swift
+++ b/SignalMessaging/ViewModels/ThreadViewModel.swift
@@ -1,5 +1,5 @@
 //
-//  Copyright (c) 2018 Open Whisper Systems. All rights reserved.
+//  Copyright (c) 2019 Open Whisper Systems. All rights reserved.
 //
 
 import Foundation
@@ -29,8 +29,8 @@ public class ThreadViewModel: NSObject {
         self.isGroupThread = thread.isGroupThread()
         self.name = thread.name()
         self.isMuted = thread.isMuted
-        self.lastMessageText = thread.lastMessageText(transaction: transaction)
-        let lastInteraction = thread.lastInteractionForInbox(transaction: transaction)
+        self.lastMessageText = thread.lastMessageText(transaction: SDSAnyReadTransaction(transitional_yapReadTransaction: transaction))
+        let lastInteraction = thread.lastInteractionForInbox(transaction: SDSAnyReadTransaction(transitional_yapReadTransaction: transaction))
         self.lastMessageForInbox = lastInteraction
         self.lastMessageDate = lastInteraction?.receivedAtDate() ?? thread.creationDate
 
diff --git a/SignalMessaging/utils/FullTextSearcher.swift b/SignalMessaging/utils/FullTextSearcher.swift
index 0b3146a20d0..1ac50bea253 100644
--- a/SignalMessaging/utils/FullTextSearcher.swift
+++ b/SignalMessaging/utils/FullTextSearcher.swift
@@ -239,7 +239,7 @@ public class FullTextSearcher: NSObject {
         var signalContacts: [ContactSearchResult] = []
         var groups: [GroupSearchResult] = []
 
-        self.finder.enumerateObjects(searchText: searchText, transaction: transaction) { (match: Any, snippet: String?) in
+        self.finder.enumerateObjects(searchText: searchText, transaction: transaction) { (match: Any, _: String?) in
 
             switch match {
             case let signalAccount as SignalAccount:
@@ -247,7 +247,7 @@ public class FullTextSearcher: NSObject {
                 signalContacts.append(searchResult)
             case let groupThread as TSGroupThread:
                 let sortKey = ConversationSortKey(creationDate: groupThread.creationDate,
-                                                  lastMessageReceivedAtDate: groupThread.lastInteractionForInbox(transaction: transaction)?.receivedAtDate())
+                                                  lastMessageReceivedAtDate: groupThread.lastInteractionForInbox(transaction: SDSAnyReadTransaction(transitional_yapReadTransaction: transaction))?.receivedAtDate())
                 let threadViewModel = ThreadViewModel(thread: groupThread, transaction: transaction)
                 let searchResult = GroupSearchResult(thread: threadViewModel, sortKey: sortKey)
                 groups.append(searchResult)
@@ -287,7 +287,7 @@ public class FullTextSearcher: NSObject {
             if let thread = match as? TSThread {
                 let threadViewModel = ThreadViewModel(thread: thread, transaction: transaction)
                 let sortKey = ConversationSortKey(creationDate: thread.creationDate,
-                                                  lastMessageReceivedAtDate: thread.lastInteractionForInbox(transaction: transaction)?.receivedAtDate())
+                                                  lastMessageReceivedAtDate: thread.lastInteractionForInbox(transaction: SDSAnyReadTransaction(transitional_yapReadTransaction: transaction))?.receivedAtDate())
                 let searchResult = ConversationSearchResult(thread: threadViewModel, sortKey: sortKey)
 
                 if let contactThread = thread as? TSContactThread {
@@ -340,7 +340,7 @@ public class FullTextSearcher: NSObject {
             return ConversationScreenSearchResultSet.empty
         }
 
-        self.finder.enumerateObjects(searchText: searchText, transaction: transaction) { (match: Any, snippet: String?) in
+        self.finder.enumerateObjects(searchText: searchText, transaction: transaction) { (match: Any, _: String?) in
             if let message = match as? TSMessage {
                 guard message.uniqueThreadId == threadId else {
                     return
diff --git a/SignalServiceKit/src/Contacts/TSThread.h b/SignalServiceKit/src/Contacts/TSThread.h
index efc319ee32d..2053835479c 100644
--- a/SignalServiceKit/src/Contacts/TSThread.h
+++ b/SignalServiceKit/src/Contacts/TSThread.h
@@ -9,6 +9,7 @@ NS_ASSUME_NONNULL_BEGIN
 BOOL IsNoteToSelfEnabled(void);
 
 @class OWSDisappearingMessagesConfiguration;
+@class SDSAnyReadTransaction;
 @class TSInteraction;
 @class TSInvalidIdentityKeyReceivingErrorMessage;
 
@@ -123,10 +124,10 @@ NS_SWIFT_NAME(init(uniqueId:archivalDate:archivedAsOfMessageSortId:conversationC
  *
  *  @return Thread preview string.
  */
-- (NSString *)lastMessageTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)lastMessageTextWithTransaction:(SDSAnyReadTransaction *)transaction
     NS_SWIFT_NAME(lastMessageText(transaction:));
 
-- (nullable TSInteraction *)lastInteractionForInboxWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (nullable TSInteraction *)lastInteractionForInboxWithTransaction:(SDSAnyReadTransaction *)transaction
     NS_SWIFT_NAME(lastInteractionForInbox(transaction:));
 
 /**
@@ -193,6 +194,8 @@ NS_SWIFT_NAME(init(uniqueId:archivalDate:archivedAsOfMessageSortId:conversationC
 
 - (void)updateWithMutedUntilDate:(NSDate *)mutedUntilDate transaction:(YapDatabaseReadWriteTransaction *)transaction;
 
++ (BOOL)shouldInteractionAppearInInbox:(TSInteraction *)interaction;
+
 @end
 
 NS_ASSUME_NONNULL_END
diff --git a/SignalServiceKit/src/Contacts/TSThread.m b/SignalServiceKit/src/Contacts/TSThread.m
index 092e0493336..6e7f31c7141 100644
--- a/SignalServiceKit/src/Contacts/TSThread.m
+++ b/SignalServiceKit/src/Contacts/TSThread.m
@@ -396,40 +396,14 @@ - (void)markAllAsReadWithTransaction:(YapDatabaseReadWriteTransaction *)transact
     OWSAssertDebug([self unseenMessagesWithTransaction:transaction].count < 1);
 }
 
-- (nullable TSInteraction *)lastInteractionForInboxWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (nullable TSInteraction *)lastInteractionForInboxWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     OWSAssertDebug(transaction);
-
-    __block NSUInteger missedCount = 0;
-    __block TSInteraction *last = nil;
-    [[transaction ext:TSMessageDatabaseViewExtensionName]
-        enumerateKeysAndObjectsInGroup:self.uniqueId
-                           withOptions:NSEnumerationReverse
-                            usingBlock:^(NSString *collection, NSString *key, id object, NSUInteger index, BOOL *stop) {
-                                OWSAssertDebug([object isKindOfClass:[TSInteraction class]]);
-
-                                missedCount++;
-                                TSInteraction *interaction = (TSInteraction *)object;
-
-                                if ([TSThread shouldInteractionAppearInInbox:interaction]) {
-                                    last = interaction;
-
-                                    // For long ignored threads, with lots of SN changes this can get really slow.
-                                    // I see this in development because I have a lot of long forgotten threads with
-                                    // members who's test devices are constantly reinstalled. We could add a
-                                    // purpose-built DB view, but I think in the real world this is rare to be a
-                                    // hotspot.
-                                    if (missedCount > 50) {
-                                        OWSLogWarn(@"found last interaction for inbox after skipping %lu items",
-                                            (unsigned long)missedCount);
-                                    }
-                                    *stop = YES;
-                                }
-                            }];
-    return last;
+    return [[[InteractionFinder alloc] initWithThreadUniqueId:self.uniqueId]
+        mostRecentInteractionForInboxWithTransaction:transaction];
 }
 
-- (NSString *)lastMessageTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)lastMessageTextWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     TSInteraction *interaction = [self lastInteractionForInboxWithTransaction:transaction];
     if ([interaction conformsToProtocol:@protocol(OWSPreviewText)]) {
@@ -510,7 +484,9 @@ - (BOOL)isArchivedWithTransaction:(YapDatabaseReadTransaction *)transaction;
         return NO;
     }
 
-    TSInteraction *_Nullable latestInteraction = [self lastInteractionForInboxWithTransaction:transaction];
+    TSInteraction *_Nullable latestInteraction =
+        [self lastInteractionForInboxWithTransaction:[[SDSAnyReadTransaction alloc]
+                                                         initWithTransitional_yapReadTransaction:transaction]];
     uint64_t latestSortIdForInbox = latestInteraction ? latestInteraction.sortId : 0;
     return self.archivedAsOfMessageSortId.unsignedLongLongValue >= latestSortIdForInbox;
 }
diff --git a/SignalServiceKit/src/Messages/Interactions/OWSDisappearingConfigurationUpdateInfoMessage.m b/SignalServiceKit/src/Messages/Interactions/OWSDisappearingConfigurationUpdateInfoMessage.m
index 869c631f879..9c325da3e2b 100644
--- a/SignalServiceKit/src/Messages/Interactions/OWSDisappearingConfigurationUpdateInfoMessage.m
+++ b/SignalServiceKit/src/Messages/Interactions/OWSDisappearingConfigurationUpdateInfoMessage.m
@@ -125,7 +125,7 @@ - (BOOL)shouldUseReceiptDateForSorting
     return NO;
 }
 
--(NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)previewTextWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     if (self.createdInExistingGroup) {
         OWSAssertDebug(self.configurationIsEnabled && self.configurationDurationSeconds > 0);
diff --git a/SignalServiceKit/src/Messages/Interactions/TSErrorMessage.m b/SignalServiceKit/src/Messages/Interactions/TSErrorMessage.m
index 07808c20d31..33dec4c4d23 100644
--- a/SignalServiceKit/src/Messages/Interactions/TSErrorMessage.m
+++ b/SignalServiceKit/src/Messages/Interactions/TSErrorMessage.m
@@ -159,7 +159,7 @@ - (OWSInteractionType)interactionType
     return OWSInteractionType_Error;
 }
 
-- (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)previewTextWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     switch (_errorType) {
         case TSErrorMessageNoSession:
@@ -176,19 +176,20 @@ - (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transacti
             return NSLocalizedString(@"ERROR_MESSAGE_WRONG_TRUSTED_IDENTITY_KEY", @"");
         case TSErrorMessageNonBlockingIdentityChange: {
             if (self.recipientId) {
-                NSString *messageFormat = NSLocalizedString(@"ERROR_MESSAGE_NON_BLOCKING_IDENTITY_CHANGE_FORMAT",
-                    @"Shown when signal users safety numbers changed, embeds the user's {{name or phone number}}");
-
-                NSString *recipientDisplayName =
-                    [SSKEnvironment.shared.contactsManager displayNameForPhoneIdentifier:self.recipientId
-                                                                             transaction:transaction];
-                return [NSString stringWithFormat:messageFormat, recipientDisplayName];
+                if (transaction.transitional_yapReadTransaction) {
+                    NSString *messageFormat = NSLocalizedString(@"ERROR_MESSAGE_NON_BLOCKING_IDENTITY_CHANGE_FORMAT",
+                        @"Shown when signal users safety numbers changed, embeds the user's {{name or phone number}}");
+
+                    NSString *recipientDisplayName = [SSKEnvironment.shared.contactsManager
+                        displayNameForPhoneIdentifier:self.recipientId
+                                          transaction:transaction.transitional_yapReadTransaction];
+                    return [NSString stringWithFormat:messageFormat, recipientDisplayName];
+                }
             } else {
                 // recipientId will be nil for legacy errors
                 return NSLocalizedString(
                     @"ERROR_MESSAGE_NON_BLOCKING_IDENTITY_CHANGE", @"Shown when signal users safety numbers changed");
             }
-            break;
         }
         case TSErrorMessageUnknownContactBlockOffer:
             return NSLocalizedString(@"UNKNOWN_CONTACT_BLOCK_OFFER",
@@ -197,9 +198,10 @@ - (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transacti
             return NSLocalizedString(@"GROUP_CREATION_FAILED",
                 @"Message shown in conversation view that indicates there were issues with group creation.");
         default:
-            return NSLocalizedString(@"ERROR_MESSAGE_UNKNOWN_ERROR", @"");
+            OWSFailDebug(@"failure: unknown error type");
             break;
     }
+    return NSLocalizedString(@"ERROR_MESSAGE_UNKNOWN_ERROR", @"");
 }
 
 + (instancetype)corruptedMessageWithEnvelope:(SSKProtoEnvelope *)envelope
diff --git a/SignalServiceKit/src/Messages/Interactions/TSInfoMessage.m b/SignalServiceKit/src/Messages/Interactions/TSInfoMessage.m
index 8262994b63d..45f1bcbef70 100644
--- a/SignalServiceKit/src/Messages/Interactions/TSInfoMessage.m
+++ b/SignalServiceKit/src/Messages/Interactions/TSInfoMessage.m
@@ -6,6 +6,7 @@
 #import "ContactsManagerProtocol.h"
 #import "SSKEnvironment.h"
 #import <SignalCoreKit/NSDate+OWS.h>
+#import <SignalServiceKit/SignalServiceKit-Swift.h>
 #import <YapDatabase/YapDatabaseConnection.h>
 
 NS_ASSUME_NONNULL_BEGIN
@@ -173,7 +174,7 @@ - (OWSInteractionType)interactionType
     return OWSInteractionType_Info;
 }
 
-- (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)previewTextWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     switch (_messageType) {
         case TSInfoMessageTypeSessionDidEnd:
@@ -182,13 +183,16 @@ - (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transacti
             return NSLocalizedString(@"UNSUPPORTED_ATTACHMENT", nil);
         case TSInfoMessageUserNotRegistered:
             if (self.unregisteredRecipientId.length > 0) {
-                id<ContactsManagerProtocol> contactsManager = SSKEnvironment.shared.contactsManager;
-                NSString *recipientName = [contactsManager displayNameForPhoneIdentifier:self.unregisteredRecipientId
-                                                                             transaction:transaction];
-                return [NSString stringWithFormat:NSLocalizedString(@"ERROR_UNREGISTERED_USER_FORMAT",
-                                                      @"Format string for 'unregistered user' error. Embeds {{the "
-                                                      @"unregistered user's name or signal id}}."),
-                                 recipientName];
+                if (transaction.transitional_yapReadTransaction) {
+                    id<ContactsManagerProtocol> contactsManager = SSKEnvironment.shared.contactsManager;
+                    NSString *recipientName =
+                        [contactsManager displayNameForPhoneIdentifier:self.unregisteredRecipientId
+                                                           transaction:transaction.transitional_yapReadTransaction];
+                    return [NSString stringWithFormat:NSLocalizedString(@"ERROR_UNREGISTERED_USER_FORMAT",
+                                                          @"Format string for 'unregistered user' error. Embeds {{the "
+                                                          @"unregistered user's name or signal id}}."),
+                                     recipientName];
+                }
             } else {
                 return NSLocalizedString(@"CONTACT_DETAIL_COMM_TYPE_INSECURE", nil);
             }
diff --git a/SignalServiceKit/src/Messages/Interactions/TSInteraction.h b/SignalServiceKit/src/Messages/Interactions/TSInteraction.h
index 28dd600948f..2569a2726da 100644
--- a/SignalServiceKit/src/Messages/Interactions/TSInteraction.h
+++ b/SignalServiceKit/src/Messages/Interactions/TSInteraction.h
@@ -6,6 +6,7 @@
 
 NS_ASSUME_NONNULL_BEGIN
 
+@class SDSAnyReadTransaction;
 @class TSThread;
 
 typedef NS_ENUM(NSInteger, OWSInteractionType) {
@@ -23,7 +24,7 @@ NSString *NSStringFromOWSInteractionType(OWSInteractionType value);
 
 @protocol OWSPreviewText
 
-- (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transaction;
+- (NSString *)previewTextWithTransaction:(SDSAnyReadTransaction *)transaction;
 
 @end
 
diff --git a/SignalServiceKit/src/Messages/Interactions/TSMessage.m b/SignalServiceKit/src/Messages/Interactions/TSMessage.m
index b39e1e11d79..1eecd034556 100644
--- a/SignalServiceKit/src/Messages/Interactions/TSMessage.m
+++ b/SignalServiceKit/src/Messages/Interactions/TSMessage.m
@@ -373,7 +373,7 @@ - (nullable NSString *)bodyTextWithTransaction:(SDSAnyReadTransaction *)transact
 }
 
 // TODO: This method contains view-specific logic and probably belongs in NotificationsManager, not in SSK.
-- (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)previewTextWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     NSString *_Nullable bodyDescription = nil;
     if (self.body.length > 0) {
@@ -381,7 +381,11 @@ - (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transacti
     }
 
     if (bodyDescription == nil) {
-        TSAttachment *_Nullable oversizeTextAttachment = [self oversizeTextAttachmentWithTransaction:transaction];
+        TSAttachment *_Nullable oversizeTextAttachment;
+        if (transaction.transitional_yapReadTransaction) {
+            oversizeTextAttachment =
+                [self oversizeTextAttachmentWithTransaction:transaction.transitional_yapReadTransaction];
+        }
         if ([oversizeTextAttachment isKindOfClass:[TSAttachmentStream class]]) {
             TSAttachmentStream *oversizeTextAttachmentStream = (TSAttachmentStream *)oversizeTextAttachment;
             NSData *_Nullable data = [NSData dataWithContentsOfFile:oversizeTextAttachmentStream.originalFilePath];
@@ -395,7 +399,12 @@ - (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transacti
     }
 
     NSString *_Nullable attachmentDescription = nil;
-    TSAttachment *_Nullable mediaAttachment = [self mediaAttachmentsWithTransaction:transaction].firstObject;
+
+    TSAttachment *_Nullable mediaAttachment;
+    if (transaction.transitional_yapReadTransaction) {
+        mediaAttachment =
+            [self mediaAttachmentsWithTransaction:transaction.transitional_yapReadTransaction].firstObject;
+    }
     if (mediaAttachment != nil) {
         attachmentDescription = mediaAttachment.description;
     }
diff --git a/SignalServiceKit/src/Messages/TSCall.m b/SignalServiceKit/src/Messages/TSCall.m
index 6114dcbe743..7718b927df9 100644
--- a/SignalServiceKit/src/Messages/TSCall.m
+++ b/SignalServiceKit/src/Messages/TSCall.m
@@ -130,7 +130,7 @@ - (OWSInteractionType)interactionType
     return OWSInteractionType_Call;
 }
 
-- (NSString *)previewTextWithTransaction:(YapDatabaseReadTransaction *)transaction
+- (NSString *)previewTextWithTransaction:(SDSAnyReadTransaction *)transaction
 {
     // We don't actually use the `transaction` but other sibling classes do.
     switch (_callType) {
diff --git a/Signal/src/ViewControllers/ConversationView/InteractionFinder.swift b/SignalServiceKit/src/Storage/Database/Records/InteractionFinder.swift
similarity index 75%
rename from Signal/src/ViewControllers/ConversationView/InteractionFinder.swift
rename to SignalServiceKit/src/Storage/Database/Records/InteractionFinder.swift
index 653b813f55f..081c3325a60 100644
--- a/Signal/src/ViewControllers/ConversationView/InteractionFinder.swift
+++ b/SignalServiceKit/src/Storage/Database/Records/InteractionFinder.swift
@@ -10,7 +10,9 @@ protocol InteractionFinderAdapter {
 
     static func fetch(uniqueId: String, transaction: ReadTransaction) throws -> TSInteraction?
 
-    func mostRecentInteraction(transaction: ReadTransaction) throws -> TSInteraction?
+    func mostRecentInteraction(transaction: ReadTransaction) -> TSInteraction?
+    func mostRecentInteractionForInbox(transaction: ReadTransaction) -> TSInteraction?
+
     func sortIndex(interactionUniqueId: String, transaction: ReadTransaction) throws -> UInt?
     func count(transaction: ReadTransaction) throws -> UInt
     func enumerateInteractionIds(transaction: ReadTransaction, block: @escaping (String, UnsafeMutablePointer<ObjCBool>) throws -> Void) throws
@@ -51,12 +53,23 @@ public class InteractionFinder: NSObject, InteractionFinderAdapter {
 
     // MARK: - instance methods
 
-    public func mostRecentInteraction(transaction: SDSAnyReadTransaction) throws -> TSInteraction? {
+    @objc
+    public func mostRecentInteraction(transaction: SDSAnyReadTransaction) -> TSInteraction? {
         switch transaction.readTransaction {
         case .yapRead(let yapRead):
             return yapAdapter.mostRecentInteraction(transaction: yapRead)
         case .grdbRead(let grdbRead):
-            return try grdbAdapter.mostRecentInteraction(transaction: grdbRead.database)
+            return grdbAdapter.mostRecentInteraction(transaction: grdbRead.database)
+        }
+    }
+
+    @objc
+    func mostRecentInteractionForInbox(transaction: SDSAnyReadTransaction) -> TSInteraction? {
+        switch transaction.readTransaction {
+        case .yapRead(let yapRead):
+            return yapAdapter.mostRecentInteractionForInbox(transaction: yapRead)
+        case .grdbRead(let grdbRead):
+            return grdbAdapter.mostRecentInteractionForInbox(transaction: grdbRead.database)
         }
     }
 
@@ -112,6 +125,32 @@ struct YAPDBInteractionFinderAdapter: InteractionFinderAdapter {
         return ext(transaction).lastObject(inGroup: threadUniqueId) as? TSInteraction
     }
 
+    func mostRecentInteractionForInbox(transaction: YapDatabaseReadTransaction) -> TSInteraction? {
+        var last: TSInteraction?
+        var missedCount: UInt = 0
+        ext(transaction).enumerateKeysAndObjects(inGroup: threadUniqueId, with: NSEnumerationOptions.reverse) { (_, _, object, _, stopPtr) in
+            guard let interaction = object as? TSInteraction else {
+                owsFailDebug("unexpected interaction: \(type(of: object))")
+                return
+            }
+            if TSThread.shouldInteractionAppear(inInbox: interaction) {
+                last = interaction
+                stopPtr.pointee = true
+            }
+
+            missedCount += 1
+            // For long ignored threads, with lots of SN changes this can get really slow.
+            // I see this in development because I have a lot of long forgotten threads with
+            // members who's test devices are constantly reinstalled. We could add a
+            // purpose-built DB view, but I think in the real world this is rare to be a
+            // hotspot.
+            if (missedCount > 50) {
+                Logger.warn("found last interaction for inbox after skipping \(missedCount) items")
+            }
+        }
+        return last
+    }
+
     func count(transaction: YapDatabaseReadTransaction) -> UInt {
         return ext(transaction).numberOfItems(inGroup: threadUniqueId)
     }
@@ -157,6 +196,7 @@ struct YAPDBInteractionFinderAdapter: InteractionFinderAdapter {
 }
 
 struct GRDBInteractionFinderAdapter: InteractionFinderAdapter {
+
     typealias ReadTransaction = Database
 
     let threadUniqueId: String
@@ -182,8 +222,8 @@ struct GRDBInteractionFinderAdapter: InteractionFinderAdapter {
 
     // MARK: - instance methods
 
-    func mostRecentInteraction(transaction: Database) throws -> TSInteraction? {
-        guard let interactionRecord = try InteractionRecord.fetchOne(transaction,
+    func mostRecentInteraction(transaction: Database) -> TSInteraction? {
+        guard let interactionRecord = try! InteractionRecord.fetchOne(transaction,
                                                                      sql: """
             SELECT *
             FROM \(InteractionRecord.databaseTableName)
@@ -197,6 +237,23 @@ struct GRDBInteractionFinderAdapter: InteractionFinderAdapter {
         return TSInteraction.fromRecord(interactionRecord)
     }
 
+    func mostRecentInteractionForInbox(transaction: Database) -> TSInteraction? {
+        guard let interactionRecord = try! InteractionRecord.fetchOne(transaction,
+                                                                     sql: """
+            SELECT *
+            FROM \(InteractionRecord.databaseTableName)
+            WHERE \(cn(.threadUniqueId)) = ?
+            AND \(cn(.errorType)) != ?
+            AND \(cn(.messageType)) != ?
+            ORDER BY \(cn(.id)) DESC
+            """,
+            arguments: [threadUniqueId, TSErrorMessageType.nonBlockingIdentityChange, TSInfoMessageType.verificationStateChange]) else {
+                return nil
+        }
+
+        return TSInteraction.fromRecord(interactionRecord)
+    }
+
     func sortIndex(interactionUniqueId: String, transaction: Database) throws -> UInt? {
         return try UInt.fetchOne(transaction,
                                  sql: """
diff --git a/SignalServiceKit/src/Storage/TSDatabaseView.m b/SignalServiceKit/src/Storage/TSDatabaseView.m
index a565ceae3e8..c7142fd5592 100644
--- a/SignalServiceKit/src/Storage/TSDatabaseView.m
+++ b/SignalServiceKit/src/Storage/TSDatabaseView.m
@@ -11,6 +11,7 @@
 #import "TSInvalidIdentityKeyErrorMessage.h"
 #import "TSOutgoingMessage.h"
 #import "TSThread.h"
+#import <SignalServiceKit/SignalServiceKit-Swift.h>
 #import <YapDatabase/YapDatabaseAutoView.h>
 #import <YapDatabase/YapDatabaseCrossProcessNotification.h>
 #import <YapDatabase/YapDatabaseViewTypes.h>
@@ -330,12 +331,14 @@ + (YapDatabaseViewSorting *)threadSorting {
         TSThread *thread2 = (TSThread *)object2;
         if ([group isEqualToString:TSArchiveGroup] || [group isEqualToString:TSInboxGroup]) {
 
-            TSInteraction *_Nullable lastInteractionForInbox1 =
-                [thread1 lastInteractionForInboxWithTransaction:transaction];
+            TSInteraction *_Nullable lastInteractionForInbox1 = [thread1
+                lastInteractionForInboxWithTransaction:[[SDSAnyReadTransaction alloc]
+                                                           initWithTransitional_yapReadTransaction:transaction]];
             NSDate *date1 = lastInteractionForInbox1 ? lastInteractionForInbox1.receivedAtDate : thread1.creationDate;
 
-            TSInteraction *_Nullable lastInteractionForInbox2 =
-                [thread2 lastInteractionForInboxWithTransaction:transaction];
+            TSInteraction *_Nullable lastInteractionForInbox2 = [thread2
+                lastInteractionForInboxWithTransaction:[[SDSAnyReadTransaction alloc]
+                                                           initWithTransitional_yapReadTransaction:transaction]];
             NSDate *date2 = lastInteractionForInbox2 ? lastInteractionForInbox2.receivedAtDate : thread2.creationDate;
 
             return [date1 compare:date2];
diff --git a/SignalMessaging/utils/Bench.swift b/SignalServiceKit/src/Util/Bench.swift
similarity index 100%
rename from SignalMessaging/utils/Bench.swift
rename to SignalServiceKit/src/Util/Bench.swift
