diff --git a/Scripts/precommit.py b/Scripts/precommit.py
index 145a54349df..040050fb86d 100755
--- a/Scripts/precommit.py
+++ b/Scripts/precommit.py
@@ -5,7 +5,13 @@
 import subprocess
 import datetime
 import argparse
-import subprocess
+from typing import Iterable
+from pathlib import Path
+
+
+EXTENSIONS_TO_CHECK = set((
+    ".h", ".hpp", ".cpp", ".m", ".mm", ".pch", ".swift"
+))
 
 
 git_repo_path = os.path.abspath(
@@ -97,8 +103,6 @@ def parse_includes(text):
 
 
 def sort_include_block(text, filepath, filename, file_extension):
-    lines = text.split('\n')
-
     includes = parse_includes(text)
 
     blocks = []
@@ -286,24 +290,11 @@ def sort_forward_protocol_statements(filepath, filename, file_extension, text):
     return sort_matching_blocks('sort_forward_protocol_statements', filepath, filename, file_extension, text, find_forward_protocol_statement_section, sort_forward_decl_statement_block)
 
 
-def splitall(path):
-    allparts = []
-    while 1:
-        parts = os.path.split(path)
-        if parts[0] == path:  # sentinel for absolute paths
-            allparts.insert(0, parts[0])
-            break
-        elif parts[1] == path: # sentinel for relative paths
-            allparts.insert(0, parts[1])
-            break
-        else:
-            path = parts[0]
-            allparts.insert(0, parts[1])
-    return allparts
+def get_ext(file: str) -> str:
+    return os.path.splitext(file)[1]
 
 
 def process(filepath):
-
     short_filepath = filepath[len(git_repo_path):]
     if short_filepath.startswith(os.sep):
        short_filepath = short_filepath[len(os.sep):]
@@ -311,21 +302,7 @@ def process(filepath):
     filename = os.path.basename(filepath)
     if filename.startswith('.'):
         raise Exception("shouldn't call process with dotfile")
-    file_ext = os.path.splitext(filename)[1]
-    if file_ext in ('.swift'):
-        env_copy = os.environ.copy()
-        env_copy["SCRIPT_INPUT_FILE_COUNT"] = "1"
-        env_copy["SCRIPT_INPUT_FILE_0"] = '%s' % ( short_filepath, )
-        try:
-            lint_output = subprocess.check_output(['swiftlint', '--fix', '--use-script-input-files'], env=env_copy)
-        except subprocess.CalledProcessError as e:
-            lint_output = e.output
-        print(lint_output)
-        try:
-            lint_output = subprocess.check_output(['swiftlint', 'lint', '--use-script-input-files'], env=env_copy)
-        except subprocess.CalledProcessError as e:
-            lint_output = e.output
-        print(lint_output)
+    file_ext = get_ext(filename)
 
     with open(filepath, 'rt') as f:
         text = f.read()
@@ -366,34 +343,70 @@ def process(filepath):
         f.write(text)
 
 
-def should_ignore_path(path):
-    ignore_paths = [
-        os.path.join(git_repo_path, '.git')
-    ]
-    for ignore_path in ignore_paths:
-        if path.startswith(ignore_path):
-            return True
-    for component in splitall(path):
+def get_file_paths_in(path: str) -> Iterable[str]:
+    for rootdir, _, filenames in os.walk(path):
+        for filename in filenames:
+            yield os.path.abspath(os.path.join(rootdir, filename))
+
+
+def get_file_paths_for_commands(commands: Iterable[list[str]]) -> Iterable[str]:
+    for command in commands:
+        lines = subprocess.check_output(command, text=True).split("\n")
+        for line in lines:
+            file_path = os.path.abspath(os.path.join(git_repo_path, line))
+            if os.path.exists(file_path):
+                yield file_path
+
+
+def should_process_file(file_path: str) -> bool:
+    if get_ext(file_path) not in EXTENSIONS_TO_CHECK:
+        return False
+
+    for component in Path(file_path).parts:
         if component.startswith('.'):
-            return True
+            return False
         if component.endswith('.framework'):
-            return True
+            return False
         if component in ('Pods', 'ThirdParty', 'Carthage',):
-            return True
+            return False
 
-    return False
+    return True
 
 
-def process_if_appropriate(filepath):
-    filename = os.path.basename(filepath)
-    if filename.startswith('.'):
-        return
-    file_ext = os.path.splitext(filename)[1]
-    if file_ext not in ('.h', '.hpp', '.cpp', '.m', '.mm', '.pch', '.swift'):
-        return
-    if should_ignore_path(filepath):
+def lint_swift_files(file_paths: set[str]) -> None:
+    swift_file_paths = list(filter(
+        lambda f: get_ext(f) == ".swift",
+        file_paths
+    ))
+
+    file_count = len(swift_file_paths)
+    if file_count < 1:
         return
-    process(filepath)
+
+    env = os.environ.copy()
+    env["SCRIPT_INPUT_FILE_COUNT"] = str(file_count)
+    for i, file_path in enumerate(swift_file_paths):
+        env[f"SCRIPT_INPUT_FILE_{i}"] = file_path
+
+    try:
+        lint_output = subprocess.check_output(
+            ["swiftlint", "lint", "--fix", "--use-script-input-files"],
+            env=env,
+            text=True
+        )
+    except subprocess.CalledProcessError as error:
+        lint_output = error.output
+    print(lint_output)
+
+    try:
+        lint_output = subprocess.check_output(
+            ["swiftlint", "lint", "--use-script-input-files"],
+            env=env,
+            text=True
+        )
+    except subprocess.CalledProcessError as error:
+        lint_output = error.output
+    print(lint_output)
 
 
 def check_diff_for_keywords():
@@ -448,50 +461,29 @@ def check_diff_for_keywords():
     parser.add_argument('--ref', help='process all files that have changed since the given ref')
     args = parser.parse_args()
 
+    all_file_paths: Iterable[str] = []
     clang_format_commit = 'HEAD'
-
     if args.all:
-        for rootdir, dirnames, filenames in os.walk(git_repo_path):
-            for filename in filenames:
-                file_path = os.path.abspath(os.path.join(rootdir, filename))
-                process_if_appropriate(file_path)
+        all_file_paths = get_file_paths_in(git_repo_path)
     elif args.path:
-        for rootdir, dirnames, filenames in os.walk(args.path):
-            for filename in filenames:
-                file_path = os.path.abspath(os.path.join(rootdir, filename))
-                process_if_appropriate(file_path)
+        all_file_paths = get_file_paths_in(args.path)
     elif args.ref:
-        filepaths = []
-
-        output = subprocess.getoutput('git diff --name-only --diff-filter=ACMR %s HEAD' % args.ref)
-        filepaths.extend([line.strip() for line in output.split('\n')])
-
-        # Only process each path once.
-        filepaths = sorted(set(filepaths))
-
-        for filepath in filepaths:
-            filepath = os.path.abspath(os.path.join(git_repo_path, filepath))
-            if os.path.exists(filepath):
-                process_if_appropriate(filepath)
-
+        all_file_paths = get_file_paths_for_commands([
+            ["git", "diff", "--name-only", "--diff-filter=ACMR", args.ref, "HEAD"]
+        ])
         clang_format_commit = args.ref
     else:
-        filepaths = []
-
-        # Staging
-        output = subprocess.getoutput('git diff --cached --name-only --diff-filter=ACMR')
-        filepaths.extend([line.strip() for line in output.split('\n')])
+        all_file_paths = get_file_paths_for_commands([
+            ["git", "diff", "--cached", "--name-only", "--diff-filter=ACMR"],
+            ["git", "diff", "--name-only", "--diff-filter=ACMR"]
+        ])
 
-        # Working
-        output = subprocess.getoutput('git diff --name-only --diff-filter=ACMR')
-        filepaths.extend([line.strip() for line in output.split('\n')])
+    file_paths = set(filter(should_process_file, all_file_paths))
 
-        # Only process each path once.
-        filepaths = sorted(set(filepaths))
+    lint_swift_files(file_paths)
 
-        for filepath in filepaths:
-            filepath = os.path.abspath(os.path.join(git_repo_path, filepath))
-            process_if_appropriate(filepath)
+    for file_path in file_paths:
+        process(file_path)
 
     print('git clang-format...')
     # we don't want to format .proto files, so we specify every other supported extension
