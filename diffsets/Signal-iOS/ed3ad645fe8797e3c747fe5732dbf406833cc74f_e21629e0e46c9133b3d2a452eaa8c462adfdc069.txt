diff --git a/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m b/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m
index 16d80225cd1..f3778327e27 100644
--- a/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m
+++ b/Signal/src/ViewControllers/DebugUI/DebugUIMessages.m
@@ -3921,35 +3921,13 @@ + (void)sendFakeMessages:(NSUInteger)counter
                 break;
             }
             case 3: {
-                NSString *filename = @"test.png";
-                NSData *pngData = [[ImageFactory new] buildPNGData];
-                TSAttachmentStream *attachmentStream = [[TSAttachmentStream alloc] initWithContentType:@"image/png"
-                                                                                             byteCount:(uint32_t)pngData.length
-                                                                                        sourceFilename:filename
-                                                                                               caption:CommonGenerator.sentence
-                                                                                        albumMessageId:nil];
-
-                NSError *error;
-                BOOL success = [attachmentStream writeData:pngData error:&error];
-                OWSAssertDebug(success && !error);
-                [attachmentStream anyInsertWithTransaction:transaction];
-                [attachmentStream updateAsUploadedWithEncryptionKey:[Cryptography generateRandomBytes:32]
-                                                             digest:[Cryptography generateRandomBytes:32]
-                                                           serverId:1
-                                                        transaction:transaction];
-                [self createFakeOutgoingMessage:thread
-                                    messageBody:nil
-                                     attachment:attachmentStream
-                                       filename:filename
-                                   messageState:TSOutgoingMessageStateSent
-                                    isDelivered:NO
-                                         isRead:NO
-                                 isVoiceMessage:NO
-                                  quotedMessage:nil
-                                   contactShare:nil
-                                    linkPreview:nil
-                                 messageSticker:nil
-                                    transaction:transaction];
+                ConversationFactory *conversationFactory = [ConversationFactory new];
+                conversationFactory.attachmentCount = arc4random_uniform(33);
+                conversationFactory.threadCreator = ^(SDSAnyWriteTransaction *_transaction){
+                    return thread;
+                };
+                
+                [conversationFactory createSentMessageWithTransaction:transaction];
                 break;
             }
         }
diff --git a/SignalMessaging/utils/ThreadUtil.m b/SignalMessaging/utils/ThreadUtil.m
index 163622992bb..65e8a70201c 100644
--- a/SignalMessaging/utils/ThreadUtil.m
+++ b/SignalMessaging/utils/ThreadUtil.m
@@ -64,10 +64,6 @@ - (BOOL)isEqual:(id)object
 
 #pragma mark -
 
-typedef void (^BuildOutgoingMessageCompletionBlock)(TSOutgoingMessage *savedMessage,
-    NSMutableArray<OWSOutgoingAttachmentInfo *> *attachmentInfos,
-    SDSAnyWriteTransaction *writeTransaction);
-
 @implementation ThreadUtil
 
 #pragma mark - Dependencies
diff --git a/SignalServiceKit/src/TestUtils/Factories.swift b/SignalServiceKit/src/TestUtils/Factories.swift
index 96b584afa72..011c21a2cbe 100644
--- a/SignalServiceKit/src/TestUtils/Factories.swift
+++ b/SignalServiceKit/src/TestUtils/Factories.swift
@@ -426,6 +426,61 @@ public class GroupThreadFactory: NSObject, Factory {
     }
 }
 
+@objc
+public class ConversationFactory: NSObject {
+
+    var databaseStorage: SDSDatabaseStorage {
+        return SDSDatabaseStorage.shared
+    }
+
+    @objc
+    public var attachmentCount: Int = 0
+
+    @objc
+    public func createSentMessage(transaction: SDSAnyWriteTransaction) -> TSOutgoingMessage {
+        let outgoingFactory = OutgoingMessageFactory()
+        outgoingFactory.threadCreator = threadCreator
+        let message = outgoingFactory.create(transaction: transaction)
+
+        let attachmentInfos: [OutgoingAttachmentInfo] = (0..<attachmentCount).map { albumIndex in
+            let caption = Bool.random() ? "(\(albumIndex)) \(CommonGenerator.sentence)" : nil
+            return attachmentInfoBuilder(message, caption)
+        }
+
+        databaseStorage.asyncWrite { asyncTransaction in
+            let messagePreparer = OutgoingMessagePreparer(message, unsavedAttachmentInfos: attachmentInfos)
+            _ = try! messagePreparer.prepareMessage(transaction: asyncTransaction)
+
+            for attachment in message.allAttachments(with: asyncTransaction) as! [TSAttachmentStream] {
+                attachment.updateAsUploaded(withEncryptionKey: Randomness.generateRandomBytes(16),
+                                            digest: Randomness.generateRandomBytes(16),
+                                            serverId: 1,
+                                            transaction: asyncTransaction)
+            }
+
+            message.update(withFakeMessageState: .sent, transaction: asyncTransaction)
+        }
+
+        return message
+    }
+
+    @objc
+    public var threadCreator: (SDSAnyWriteTransaction) -> TSThread = { transaction in
+        ContactThreadFactory().create(transaction: transaction)
+    }
+
+    @objc
+    public var attachmentInfoBuilder: (TSOutgoingMessage, String?) -> OutgoingAttachmentInfo = { outgoingMessage, caption in
+        let dataSource = DataSourceValue.dataSource(with: ImageFactory().buildPNGData(), fileExtension: "png")!
+        return OutgoingAttachmentInfo(dataSource: dataSource,
+                                      contentType: "image/png",
+                                      sourceFilename: nil,
+                                      caption: caption,
+                                      albumMessageId: outgoingMessage.uniqueId)
+    }
+
+}
+
 @objc
 public class AttachmentStreamFactory: NSObject, Factory {
 
