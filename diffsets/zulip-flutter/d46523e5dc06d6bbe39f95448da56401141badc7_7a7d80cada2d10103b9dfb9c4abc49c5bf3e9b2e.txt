diff --git a/test/widgets/message_list_test.dart b/test/widgets/message_list_test.dart
index 17d99ed3ca..6b282d19d6 100644
--- a/test/widgets/message_list_test.dart
+++ b/test/widgets/message_list_test.dart
@@ -6,6 +6,7 @@ import 'package:flutter_test/flutter_test.dart';
 import 'package:zulip/api/model/events.dart';
 import 'package:zulip/api/model/model.dart';
 import 'package:zulip/model/narrow.dart';
+import 'package:zulip/model/store.dart';
 import 'package:zulip/widgets/content.dart';
 import 'package:zulip/widgets/message_list.dart';
 import 'package:zulip/widgets/sticky_header.dart';
@@ -19,39 +20,42 @@ import '../model/test_store.dart';
 import '../test_images.dart';
 import 'content_checks.dart';
 
-Future<void> setupMessageListPage(WidgetTester tester, {
-  Narrow narrow = const AllMessagesNarrow(),
-}) async {
-  addTearDown(TestZulipBinding.instance.reset);
-  addTearDown(tester.view.resetPhysicalSize);
+void main() {
+  TestZulipBinding.ensureInitialized();
 
-  tester.view.physicalSize = const Size(600, 800);
+  late PerAccountStore store;
+  late FakeApiConnection connection;
 
-  await TestZulipBinding.instance.globalStore.add(eg.selfAccount, eg.initialSnapshot());
-  final store = await TestZulipBinding.instance.globalStore.perAccount(eg.selfAccount.id);
-  final connection = store.connection as FakeApiConnection;
+  Future<void> setupMessageListPage(WidgetTester tester, {
+    Narrow narrow = const AllMessagesNarrow(),
+  }) async {
+    addTearDown(TestZulipBinding.instance.reset);
+    addTearDown(tester.view.resetPhysicalSize);
 
-  // prepare message list data
-  store.addUser(eg.selfUser);
-  final List<StreamMessage> messages = List.generate(10, (index) {
-    return eg.streamMessage(id: index, sender: eg.selfUser);
-  });
-  connection.prepare(json:
-    newestResult(foundOldest: true, messages: messages).toJson());
-
-  await tester.pumpWidget(
-    MaterialApp(
-      home: GlobalStoreWidget(
-        child: PerAccountStoreWidget(
-          accountId: eg.selfAccount.id,
-          child: MessageListPage(narrow: narrow)))));
-
-  // global store, per-account store, and message list get loaded
-  await tester.pumpAndSettle();
-}
+    tester.view.physicalSize = const Size(600, 800);
 
-void main() {
-  TestZulipBinding.ensureInitialized();
+    await TestZulipBinding.instance.globalStore.add(eg.selfAccount, eg.initialSnapshot());
+    store = await TestZulipBinding.instance.globalStore.perAccount(eg.selfAccount.id);
+    connection = store.connection as FakeApiConnection;
+
+    // prepare message list data
+    store.addUser(eg.selfUser);
+    final List<StreamMessage> messages = List.generate(10, (index) {
+      return eg.streamMessage(id: index, sender: eg.selfUser);
+    });
+    connection.prepare(json:
+      newestResult(foundOldest: true, messages: messages).toJson());
+
+    await tester.pumpWidget(
+      MaterialApp(
+        home: GlobalStoreWidget(
+          child: PerAccountStoreWidget(
+            accountId: eg.selfAccount.id,
+            child: MessageListPage(narrow: narrow)))));
+
+    // global store, per-account store, and message list get loaded
+    await tester.pumpAndSettle();
+  }
 
   group('ScrollToBottomButton interactions', () {
     ScrollController? findMessageListScrollController(WidgetTester tester) {
