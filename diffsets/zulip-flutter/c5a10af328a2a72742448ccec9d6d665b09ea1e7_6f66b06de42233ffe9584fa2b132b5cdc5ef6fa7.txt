diff --git a/lib/widgets/content.dart b/lib/widgets/content.dart
index 2263b74f8b..551956966e 100644
--- a/lib/widgets/content.dart
+++ b/lib/widgets/content.dart
@@ -1,7 +1,6 @@
 import 'dart:async';
 
 import 'package:flutter/cupertino.dart';
-import 'package:flutter/foundation.dart';
 import 'package:flutter/gestures.dart';
 import 'package:flutter/material.dart';
 import 'package:flutter/rendering.dart';
@@ -16,7 +15,6 @@ import '../model/binding.dart';
 import '../model/content.dart';
 import '../model/emoji.dart';
 import '../model/internal_link.dart';
-import '../model/katex.dart';
 import '../model/presence.dart';
 import 'actions.dart';
 import 'code_block.dart';
@@ -834,231 +832,6 @@ class MathBlock extends StatelessWidget {
   }
 }
 
-/// Creates a base text style for rendering KaTeX content.
-///
-/// This applies the CSS styles defined in .katex class in katex.scss :
-///   https://github.com/KaTeX/KaTeX/blob/613c3da8/src/styles/katex.scss#L13-L15
-///
-/// Requires the [style.fontSize] to be non-null.
-TextStyle mkBaseKatexTextStyle(TextStyle style) {
-  return style.copyWith(
-    fontSize: style.fontSize! * 1.21,
-    fontFamily: 'KaTeX_Main',
-    height: 1.2,
-    fontWeight: FontWeight.normal,
-    fontStyle: FontStyle.normal,
-    textBaseline: TextBaseline.alphabetic,
-    leadingDistribution: TextLeadingDistribution.even,
-    decoration: TextDecoration.none,
-    fontFamilyFallback: const []);
-}
-
-@visibleForTesting
-class KatexWidget extends StatelessWidget {
-  const KatexWidget({
-    super.key,
-    required this.textStyle,
-    required this.nodes,
-  });
-
-  final TextStyle textStyle;
-  final List<KatexNode> nodes;
-
-  @override
-  Widget build(BuildContext context) {
-    Widget widget = _KatexNodeList(nodes: nodes);
-
-    return Directionality(
-      textDirection: TextDirection.ltr,
-      child: DefaultTextStyle(
-        style: mkBaseKatexTextStyle(textStyle).copyWith(
-          color: ContentTheme.of(context).textStylePlainParagraph.color),
-        child: widget));
-  }
-}
-
-class _KatexNodeList extends StatelessWidget {
-  const _KatexNodeList({required this.nodes});
-
-  final List<KatexNode> nodes;
-
-  @override
-  Widget build(BuildContext context) {
-    return Text.rich(TextSpan(
-      children: List.unmodifiable(nodes.map((e) {
-        return WidgetSpan(
-          alignment: PlaceholderAlignment.baseline,
-          baseline: TextBaseline.alphabetic,
-          // Work around a bug where text inside a WidgetSpan could be scaled
-          // multiple times incorrectly, if the system font scale is larger
-          // than 1x.
-          // See: https://github.com/flutter/flutter/issues/126962
-          child: MediaQuery(
-            data: MediaQueryData(textScaler: TextScaler.noScaling),
-            child: switch (e) {
-              KatexSpanNode() => _KatexSpan(e),
-              KatexStrutNode() => _KatexStrut(e),
-              KatexVlistNode() => _KatexVlist(e),
-              KatexNegativeMarginNode() => _KatexNegativeMargin(e),
-            }));
-      }))));
-  }
-}
-
-class _KatexSpan extends StatelessWidget {
-  const _KatexSpan(this.node);
-
-  final KatexSpanNode node;
-
-  @override
-  Widget build(BuildContext context) {
-    var em = DefaultTextStyle.of(context).style.fontSize!;
-
-    Widget widget = const SizedBox.shrink();
-    if (node.text != null) {
-      widget = Text(node.text!);
-    } else if (node.nodes != null && node.nodes!.isNotEmpty) {
-      widget = _KatexNodeList(nodes: node.nodes!);
-    }
-
-    final styles = node.styles;
-
-    // Currently, we expect `top` to be only present with the
-    // vlist inner row span, and parser handles that explicitly.
-    assert(styles.topEm == null);
-
-    final fontFamily = styles.fontFamily;
-    final fontSize = switch (styles.fontSizeEm) {
-      double fontSizeEm => fontSizeEm * em,
-      null => null,
-    };
-    if (fontSize != null) em = fontSize;
-
-    final fontWeight = switch (styles.fontWeight) {
-      KatexSpanFontWeight.bold => FontWeight.bold,
-      null => null,
-    };
-    var fontStyle = switch (styles.fontStyle) {
-      KatexSpanFontStyle.normal => FontStyle.normal,
-      KatexSpanFontStyle.italic => FontStyle.italic,
-      null => null,
-    };
-
-    TextStyle? textStyle;
-    if (fontFamily != null ||
-        fontSize != null ||
-        fontWeight != null ||
-        fontStyle != null) {
-      // TODO(upstream) remove this workaround when upstream fixes the broken
-      //   rendering of KaTeX_Math font with italic font style on Android:
-      //     https://github.com/flutter/flutter/issues/167474
-      if (defaultTargetPlatform == TargetPlatform.android &&
-          fontFamily == 'KaTeX_Math') {
-        fontStyle = FontStyle.normal;
-      }
-
-      textStyle = TextStyle(
-        fontFamily: fontFamily,
-        fontSize: fontSize,
-        fontWeight: fontWeight,
-        fontStyle: fontStyle,
-      );
-    }
-    final textAlign = switch (styles.textAlign) {
-      KatexSpanTextAlign.left => TextAlign.left,
-      KatexSpanTextAlign.center => TextAlign.center,
-      KatexSpanTextAlign.right => TextAlign.right,
-      null => null,
-    };
-
-    if (textStyle != null || textAlign != null) {
-      widget = DefaultTextStyle.merge(
-        style: textStyle,
-        textAlign: textAlign,
-        child: widget);
-    }
-
-    widget = SizedBox(
-      height: styles.heightEm != null
-        ? styles.heightEm! * em
-        : null,
-      child: widget);
-
-    final margin = switch ((styles.marginLeftEm, styles.marginRightEm)) {
-      (null, null) => null,
-      (null, final marginRightEm?) =>
-        EdgeInsets.only(right: marginRightEm * em),
-      (final marginLeftEm?, null) =>
-        EdgeInsets.only(left: marginLeftEm * em),
-      (final marginLeftEm?, final marginRightEm?) =>
-        EdgeInsets.only(left: marginLeftEm * em, right: marginRightEm * em),
-    };
-
-    if (margin != null) {
-      assert(margin.isNonNegative);
-      widget = Padding(padding: margin, child: widget);
-    }
-
-    return widget;
-  }
-}
-
-class _KatexStrut extends StatelessWidget {
-  const _KatexStrut(this.node);
-
-  final KatexStrutNode node;
-
-  @override
-  Widget build(BuildContext context) {
-    final em = DefaultTextStyle.of(context).style.fontSize!;
-
-    final verticalAlignEm = node.verticalAlignEm;
-    if (verticalAlignEm == null) {
-      return SizedBox(height: node.heightEm * em);
-    }
-
-    return SizedBox(
-      height: node.heightEm * em,
-      child: Baseline(
-        baseline: (verticalAlignEm + node.heightEm) * em,
-        baselineType: TextBaseline.alphabetic,
-        child: const Text('')),
-    );
-  }
-}
-
-class _KatexVlist extends StatelessWidget {
-  const _KatexVlist(this.node);
-
-  final KatexVlistNode node;
-
-  @override
-  Widget build(BuildContext context) {
-    final em = DefaultTextStyle.of(context).style.fontSize!;
-
-    return Stack(children: List.unmodifiable(node.rows.map((row) {
-      return Transform.translate(
-        offset: Offset(0, row.verticalOffsetEm * em),
-        child: _KatexSpan(row.node));
-    })));
-  }
-}
-
-class _KatexNegativeMargin extends StatelessWidget {
-  const _KatexNegativeMargin(this.node);
-
-  final KatexNegativeMarginNode node;
-
-  @override
-  Widget build(BuildContext context) {
-    final em = DefaultTextStyle.of(context).style.fontSize!;
-
-    return NegativeLeftOffset(
-      leftOffset: node.leftOffsetEm * em,
-      child: _KatexNodeList(nodes: node.nodes));
-  }
-}
-
 class WebsitePreview extends StatelessWidget {
   const WebsitePreview({super.key, required this.node});
 
diff --git a/lib/widgets/katex.dart b/lib/widgets/katex.dart
index 9b89270c8b..9d439ffdd3 100644
--- a/lib/widgets/katex.dart
+++ b/lib/widgets/katex.dart
@@ -4,6 +4,235 @@ import 'package:flutter/foundation.dart';
 import 'package:flutter/widgets.dart';
 import 'package:flutter/rendering.dart';
 
+import '../model/content.dart';
+import '../model/katex.dart';
+import 'content.dart';
+
+/// Creates a base text style for rendering KaTeX content.
+///
+/// This applies the CSS styles defined in .katex class in katex.scss :
+///   https://github.com/KaTeX/KaTeX/blob/613c3da8/src/styles/katex.scss#L13-L15
+///
+/// Requires the [style.fontSize] to be non-null.
+TextStyle mkBaseKatexTextStyle(TextStyle style) {
+  return style.copyWith(
+    fontSize: style.fontSize! * 1.21,
+    fontFamily: 'KaTeX_Main',
+    height: 1.2,
+    fontWeight: FontWeight.normal,
+    fontStyle: FontStyle.normal,
+    textBaseline: TextBaseline.alphabetic,
+    leadingDistribution: TextLeadingDistribution.even,
+    decoration: TextDecoration.none,
+    fontFamilyFallback: const []);
+}
+
+@visibleForTesting
+class KatexWidget extends StatelessWidget {
+  const KatexWidget({
+    super.key,
+    required this.textStyle,
+    required this.nodes,
+  });
+
+  final TextStyle textStyle;
+  final List<KatexNode> nodes;
+
+  @override
+  Widget build(BuildContext context) {
+    Widget widget = _KatexNodeList(nodes: nodes);
+
+    return Directionality(
+      textDirection: TextDirection.ltr,
+      child: DefaultTextStyle(
+        style: mkBaseKatexTextStyle(textStyle).copyWith(
+          color: ContentTheme.of(context).textStylePlainParagraph.color),
+        child: widget));
+  }
+}
+
+class _KatexNodeList extends StatelessWidget {
+  const _KatexNodeList({required this.nodes});
+
+  final List<KatexNode> nodes;
+
+  @override
+  Widget build(BuildContext context) {
+    return Text.rich(TextSpan(
+      children: List.unmodifiable(nodes.map((e) {
+        return WidgetSpan(
+          alignment: PlaceholderAlignment.baseline,
+          baseline: TextBaseline.alphabetic,
+          // Work around a bug where text inside a WidgetSpan could be scaled
+          // multiple times incorrectly, if the system font scale is larger
+          // than 1x.
+          // See: https://github.com/flutter/flutter/issues/126962
+          child: MediaQuery(
+            data: MediaQueryData(textScaler: TextScaler.noScaling),
+            child: switch (e) {
+              KatexSpanNode() => _KatexSpan(e),
+              KatexStrutNode() => _KatexStrut(e),
+              KatexVlistNode() => _KatexVlist(e),
+              KatexNegativeMarginNode() => _KatexNegativeMargin(e),
+            }));
+      }))));
+  }
+}
+
+class _KatexSpan extends StatelessWidget {
+  const _KatexSpan(this.node);
+
+  final KatexSpanNode node;
+
+  @override
+  Widget build(BuildContext context) {
+    var em = DefaultTextStyle.of(context).style.fontSize!;
+
+    Widget widget = const SizedBox.shrink();
+    if (node.text != null) {
+      widget = Text(node.text!);
+    } else if (node.nodes != null && node.nodes!.isNotEmpty) {
+      widget = _KatexNodeList(nodes: node.nodes!);
+    }
+
+    final styles = node.styles;
+
+    // Currently, we expect `top` to be only present with the
+    // vlist inner row span, and parser handles that explicitly.
+    assert(styles.topEm == null);
+
+    final fontFamily = styles.fontFamily;
+    final fontSize = switch (styles.fontSizeEm) {
+      double fontSizeEm => fontSizeEm * em,
+      null => null,
+    };
+    if (fontSize != null) em = fontSize;
+
+    final fontWeight = switch (styles.fontWeight) {
+      KatexSpanFontWeight.bold => FontWeight.bold,
+      null => null,
+    };
+    var fontStyle = switch (styles.fontStyle) {
+      KatexSpanFontStyle.normal => FontStyle.normal,
+      KatexSpanFontStyle.italic => FontStyle.italic,
+      null => null,
+    };
+
+    TextStyle? textStyle;
+    if (fontFamily != null ||
+        fontSize != null ||
+        fontWeight != null ||
+        fontStyle != null) {
+      // TODO(upstream) remove this workaround when upstream fixes the broken
+      //   rendering of KaTeX_Math font with italic font style on Android:
+      //     https://github.com/flutter/flutter/issues/167474
+      if (defaultTargetPlatform == TargetPlatform.android &&
+          fontFamily == 'KaTeX_Math') {
+        fontStyle = FontStyle.normal;
+      }
+
+      textStyle = TextStyle(
+        fontFamily: fontFamily,
+        fontSize: fontSize,
+        fontWeight: fontWeight,
+        fontStyle: fontStyle,
+      );
+    }
+    final textAlign = switch (styles.textAlign) {
+      KatexSpanTextAlign.left => TextAlign.left,
+      KatexSpanTextAlign.center => TextAlign.center,
+      KatexSpanTextAlign.right => TextAlign.right,
+      null => null,
+    };
+
+    if (textStyle != null || textAlign != null) {
+      widget = DefaultTextStyle.merge(
+        style: textStyle,
+        textAlign: textAlign,
+        child: widget);
+    }
+
+    widget = SizedBox(
+      height: styles.heightEm != null
+        ? styles.heightEm! * em
+        : null,
+      child: widget);
+
+    final margin = switch ((styles.marginLeftEm, styles.marginRightEm)) {
+      (null, null) => null,
+      (null, final marginRightEm?) =>
+        EdgeInsets.only(right: marginRightEm * em),
+      (final marginLeftEm?, null) =>
+        EdgeInsets.only(left: marginLeftEm * em),
+      (final marginLeftEm?, final marginRightEm?) =>
+        EdgeInsets.only(left: marginLeftEm * em, right: marginRightEm * em),
+    };
+
+    if (margin != null) {
+      assert(margin.isNonNegative);
+      widget = Padding(padding: margin, child: widget);
+    }
+
+    return widget;
+  }
+}
+
+class _KatexStrut extends StatelessWidget {
+  const _KatexStrut(this.node);
+
+  final KatexStrutNode node;
+
+  @override
+  Widget build(BuildContext context) {
+    final em = DefaultTextStyle.of(context).style.fontSize!;
+
+    final verticalAlignEm = node.verticalAlignEm;
+    if (verticalAlignEm == null) {
+      return SizedBox(height: node.heightEm * em);
+    }
+
+    return SizedBox(
+      height: node.heightEm * em,
+      child: Baseline(
+        baseline: (verticalAlignEm + node.heightEm) * em,
+        baselineType: TextBaseline.alphabetic,
+        child: const Text('')),
+    );
+  }
+}
+
+class _KatexVlist extends StatelessWidget {
+  const _KatexVlist(this.node);
+
+  final KatexVlistNode node;
+
+  @override
+  Widget build(BuildContext context) {
+    final em = DefaultTextStyle.of(context).style.fontSize!;
+
+    return Stack(children: List.unmodifiable(node.rows.map((row) {
+      return Transform.translate(
+        offset: Offset(0, row.verticalOffsetEm * em),
+        child: _KatexSpan(row.node));
+    })));
+  }
+}
+
+class _KatexNegativeMargin extends StatelessWidget {
+  const _KatexNegativeMargin(this.node);
+
+  final KatexNegativeMarginNode node;
+
+  @override
+  Widget build(BuildContext context) {
+    final em = DefaultTextStyle.of(context).style.fontSize!;
+
+    return NegativeLeftOffset(
+      leftOffset: node.leftOffsetEm * em,
+      child: _KatexNodeList(nodes: node.nodes));
+  }
+}
+
 class NegativeLeftOffset extends SingleChildRenderObjectWidget {
   NegativeLeftOffset({super.key, required this.leftOffset, super.child})
     : assert(leftOffset.isNegative),
diff --git a/test/widgets/content_test.dart b/test/widgets/content_test.dart
index cae7414083..e615dc7b81 100644
--- a/test/widgets/content_test.dart
+++ b/test/widgets/content_test.dart
@@ -3,7 +3,6 @@ import 'package:flutter/cupertino.dart';
 import 'package:flutter/foundation.dart';
 import 'package:flutter/material.dart';
 import 'package:flutter/rendering.dart';
-import 'package:flutter/services.dart';
 import 'package:flutter_checks/flutter_checks.dart';
 import 'package:flutter_test/flutter_test.dart';
 import 'package:url_launcher/url_launcher.dart';
@@ -14,6 +13,7 @@ import 'package:zulip/model/settings.dart';
 import 'package:zulip/model/store.dart';
 import 'package:zulip/widgets/content.dart';
 import 'package:zulip/widgets/icons.dart';
+import 'package:zulip/widgets/katex.dart';
 import 'package:zulip/widgets/message_list.dart';
 import 'package:zulip/widgets/page.dart';
 import 'package:zulip/widgets/store.dart';
@@ -23,7 +23,6 @@ import '../example_data.dart' as eg;
 import '../flutter_checks.dart';
 import '../model/binding.dart';
 import '../model/content_test.dart';
-import '../model/katex_test.dart';
 import '../model/store_checks.dart';
 import '../model/test_store.dart';
 import '../stdlib_checks.dart';
@@ -557,6 +556,10 @@ void main() {
   });
 
   group('MathBlock', () {
+    // See also katex_test.dart for detailed tests of
+    // how we render the inside of a math block.
+    // These tests check how it relates to the enclosing Zulip message.
+
     testContentSmoke(ContentExample.mathBlock);
 
     testWidgets('displays KaTeX source; experimental flag disabled', (tester) async {
@@ -577,100 +580,6 @@ void main() {
       await prepareContent(tester, plainContent(ContentExample.mathBlock.html));
       tester.widget(find.text('λ', findRichText: true));
     });
-
-    group('characters render at specific offsets with specific size', () {
-      const testCases = <(KatexExample, List<(String, Offset, Size)>, {bool? skip})>[
-        (KatexExample.mathBlockKatexSizing, skip: false, [
-          ('1', Offset(0.00, 2.24), Size(25.59, 61.00)),
-          ('2', Offset(25.59, 10.04), Size(21.33, 51.00)),
-          ('3', Offset(46.91, 16.55), Size(17.77, 43.00)),
-          ('4', Offset(64.68, 21.98), Size(14.80, 36.00)),
-          ('5', Offset(79.48, 26.50), Size(12.34, 30.00)),
-          ('6', Offset(91.82, 30.26), Size(10.28, 25.00)),
-          ('7', Offset(102.10, 32.15), Size(9.25, 22.00)),
-          ('8', Offset(111.35, 34.03), Size(8.23, 20.00)),
-          ('9', Offset(119.58, 35.91), Size(7.20, 17.00)),
-          ('0', Offset(126.77, 39.68), Size(5.14, 12.00)),
-        ]),
-        (KatexExample.mathBlockKatexNestedSizing, skip: false, [
-          ('1', Offset(0.00, 40.24), Size(5.14, 12.00)),
-          ('2', Offset(5.14, 2.80), Size(25.59, 61.00)),
-        ]),
-        (KatexExample.mathBlockKatexDelimSizing, skip: false, [
-          ('(', Offset(8.00, 20.14), Size(9.42, 25.00)),
-          ('[', Offset(17.42, 20.14), Size(9.71, 25.00)),
-          ('⌈', Offset(27.12, 20.14), Size(11.99, 25.00)),
-          ('⌊', Offset(39.11, 20.14), Size(13.14, 25.00)),
-        ]),
-        (KatexExample.mathBlockKatexSpace, skip: false, [
-          ('1', Offset(0.00, 2.24), Size(10.28, 25.00)),
-          (':', Offset(16.00, 2.24), Size(5.72, 25.00)),
-          ('2', Offset(27.43, 2.24), Size(10.28, 25.00)),
-        ]),
-        (KatexExample.mathBlockKatexSuperscript, skip: false, [
-          ('a', Offset(0.00, 5.28), Size(10.88, 25.00)),
-          ('′', Offset(10.88, 1.13), Size(3.96, 17.00)),
-        ]),
-        (KatexExample.mathBlockKatexSubscript, skip: false, [
-          ('x', Offset(0.00, 5.28), Size(11.76, 25.00)),
-          ('n', Offset(11.76, 13.65), Size(8.63, 17.00)),
-        ]),
-        (KatexExample.mathBlockKatexSubSuperScript, skip: false, [
-          ('u', Offset(0.00, 15.65), Size(8.23, 17.00)),
-          ('o', Offset(0.00, 2.07), Size(6.98, 17.00)),
-        ]),
-        (KatexExample.mathBlockKatexRaisebox, skip: false, [
-          ('a', Offset(0.00, 4.16), Size(10.88, 25.00)),
-          ('b', Offset(10.88, -0.66), Size(8.82, 25.00)),
-          ('c', Offset(19.70, 4.16), Size(8.90, 25.00)),
-        ]),
-        (KatexExample.mathBlockKatexNegativeMargin, skip: false, [
-          ('1', Offset(0.00, 3.12), Size(10.28, 25.00)),
-          ('2', Offset(6.85, 3.36), Size(10.28, 25.00)),
-        ]),
-        (KatexExample.mathBlockKatexLogo, skip: false, [
-          ('K', Offset(0.0, 8.64), Size(16.0, 25.0)),
-          ('A', Offset(12.50, 10.85), Size(10.79, 17.0)),
-          ('T', Offset(20.21, 9.36), Size(14.85, 25.0)),
-          ('E', Offset(31.63, 14.52), Size(14.0, 25.0)),
-          ('X', Offset(43.06, 9.85), Size(15.42, 25.0)),
-        ]),
-        (KatexExample.mathBlockKatexNegativeMarginsOnVlistRow, skip: false, [
-          ('X', Offset(0.00, 7.04), Size(17.03, 25.00)),
-          ('n', Offset(17.03, 15.90), Size(8.63, 17.00)),
-        ]),
-      ];
-
-      for (final testCase in testCases) {
-        testWidgets(testCase.$1.description, (tester) async {
-          await _loadKatexFonts();
-
-          addTearDown(testBinding.reset);
-          final globalSettings = testBinding.globalStore.settings;
-          await globalSettings.setBool(BoolGlobalSetting.renderKatex, true);
-          check(globalSettings).getBool(BoolGlobalSetting.renderKatex).isTrue();
-
-          await prepareContent(tester, plainContent(testCase.$1.html));
-
-          final baseRect = tester.getRect(find.byType(KatexWidget));
-
-          for (final characterData in testCase.$2) {
-            final character = characterData.$1;
-            final expectedTopLeftOffset = characterData.$2;
-            final expectedSize = characterData.$3;
-
-            final rect = tester.getRect(find.text(character));
-            final topLeftOffset = rect.topLeft - baseRect.topLeft;
-            final size = rect.size;
-
-            check(topLeftOffset)
-              .within(distance: 0.05, from: expectedTopLeftOffset);
-            check(size)
-              .within(distance: 0.05, from: expectedSize);
-          }
-        }, skip: testCase.skip);
-      }
-    });
   });
 
   /// Make a [TargetFontSizeFinder] to pass to [checkFontSizeRatio],
@@ -1078,6 +987,10 @@ void main() {
   });
 
   group('inline math', () {
+    // See also katex_test.dart for detailed tests of
+    // how we render the inside of a math span.
+    // These tests check how it relates to the enclosing Zulip message.
+
     testContentSmoke(ContentExample.mathInline);
 
     testWidgets('maintains font-size ratio with surrounding text', (tester) async {
@@ -1486,45 +1399,3 @@ void main() {
     });
   });
 }
-
-Future<void> _loadKatexFonts() async {
-  const fonts = {
-    'KaTeX_AMS': ['KaTeX_AMS-Regular.ttf'],
-    'KaTeX_Caligraphic': [
-      'KaTeX_Caligraphic-Regular.ttf',
-      'KaTeX_Caligraphic-Bold.ttf',
-    ],
-    'KaTeX_Fraktur': [
-      'KaTeX_Fraktur-Regular.ttf',
-      'KaTeX_Fraktur-Bold.ttf',
-    ],
-    'KaTeX_Main': [
-      'KaTeX_Main-Regular.ttf',
-      'KaTeX_Main-Bold.ttf',
-      'KaTeX_Main-Italic.ttf',
-      'KaTeX_Main-BoldItalic.ttf',
-    ],
-    'KaTeX_Math': [
-      'KaTeX_Math-Italic.ttf',
-      'KaTeX_Math-BoldItalic.ttf',
-    ],
-    'KaTeX_SansSerif': [
-      'KaTeX_SansSerif-Regular.ttf',
-      'KaTeX_SansSerif-Bold.ttf',
-      'KaTeX_SansSerif-Italic.ttf',
-    ],
-    'KaTeX_Script': ['KaTeX_Script-Regular.ttf'],
-    'KaTeX_Size1': ['KaTeX_Size1-Regular.ttf'],
-    'KaTeX_Size2': ['KaTeX_Size2-Regular.ttf'],
-    'KaTeX_Size3': ['KaTeX_Size3-Regular.ttf'],
-    'KaTeX_Size4': ['KaTeX_Size4-Regular.ttf'],
-    'KaTeX_Typewriter': ['KaTeX_Typewriter-Regular.ttf'],
-  };
-  for (final MapEntry(key: fontFamily, value: fontFiles) in fonts.entries) {
-    final fontLoader = FontLoader(fontFamily);
-    for (final fontFile in fontFiles) {
-      fontLoader.addFont(rootBundle.load('assets/KaTeX/$fontFile'));
-    }
-    await fontLoader.load();
-  }
-}
diff --git a/test/widgets/katex_test.dart b/test/widgets/katex_test.dart
new file mode 100644
index 0000000000..eb1c776a30
--- /dev/null
+++ b/test/widgets/katex_test.dart
@@ -0,0 +1,153 @@
+import 'package:checks/checks.dart';
+import 'package:flutter/services.dart';
+import 'package:flutter_checks/flutter_checks.dart';
+import 'package:flutter_test/flutter_test.dart';
+import 'package:zulip/model/settings.dart';
+import 'package:zulip/widgets/katex.dart';
+
+import '../model/binding.dart';
+import '../model/katex_test.dart';
+import '../model/store_checks.dart';
+import 'content_test.dart';
+
+void main() {
+  TestZulipBinding.ensureInitialized();
+
+  group('MathBlock', () {
+    group('characters render at specific offsets with specific size', () {
+      const testCases = <(KatexExample, List<(String, Offset, Size)>, {bool? skip})>[
+        (KatexExample.mathBlockKatexSizing, skip: false, [
+          ('1', Offset(0.00, 2.24), Size(25.59, 61.00)),
+          ('2', Offset(25.59, 10.04), Size(21.33, 51.00)),
+          ('3', Offset(46.91, 16.55), Size(17.77, 43.00)),
+          ('4', Offset(64.68, 21.98), Size(14.80, 36.00)),
+          ('5', Offset(79.48, 26.50), Size(12.34, 30.00)),
+          ('6', Offset(91.82, 30.26), Size(10.28, 25.00)),
+          ('7', Offset(102.10, 32.15), Size(9.25, 22.00)),
+          ('8', Offset(111.35, 34.03), Size(8.23, 20.00)),
+          ('9', Offset(119.58, 35.91), Size(7.20, 17.00)),
+          ('0', Offset(126.77, 39.68), Size(5.14, 12.00)),
+        ]),
+        (KatexExample.mathBlockKatexNestedSizing, skip: false, [
+          ('1', Offset(0.00, 40.24), Size(5.14, 12.00)),
+          ('2', Offset(5.14, 2.80), Size(25.59, 61.00)),
+        ]),
+        (KatexExample.mathBlockKatexDelimSizing, skip: false, [
+          ('(', Offset(8.00, 20.14), Size(9.42, 25.00)),
+          ('[', Offset(17.42, 20.14), Size(9.71, 25.00)),
+          ('⌈', Offset(27.12, 20.14), Size(11.99, 25.00)),
+          ('⌊', Offset(39.11, 20.14), Size(13.14, 25.00)),
+        ]),
+        (KatexExample.mathBlockKatexSpace, skip: false, [
+          ('1', Offset(0.00, 2.24), Size(10.28, 25.00)),
+          (':', Offset(16.00, 2.24), Size(5.72, 25.00)),
+          ('2', Offset(27.43, 2.24), Size(10.28, 25.00)),
+        ]),
+        (KatexExample.mathBlockKatexSuperscript, skip: false, [
+          ('a', Offset(0.00, 5.28), Size(10.88, 25.00)),
+          ('′', Offset(10.88, 1.13), Size(3.96, 17.00)),
+        ]),
+        (KatexExample.mathBlockKatexSubscript, skip: false, [
+          ('x', Offset(0.00, 5.28), Size(11.76, 25.00)),
+          ('n', Offset(11.76, 13.65), Size(8.63, 17.00)),
+        ]),
+        (KatexExample.mathBlockKatexSubSuperScript, skip: false, [
+          ('u', Offset(0.00, 15.65), Size(8.23, 17.00)),
+          ('o', Offset(0.00, 2.07), Size(6.98, 17.00)),
+        ]),
+        (KatexExample.mathBlockKatexRaisebox, skip: false, [
+          ('a', Offset(0.00, 4.16), Size(10.88, 25.00)),
+          ('b', Offset(10.88, -0.66), Size(8.82, 25.00)),
+          ('c', Offset(19.70, 4.16), Size(8.90, 25.00)),
+        ]),
+        (KatexExample.mathBlockKatexNegativeMargin, skip: false, [
+          ('1', Offset(0.00, 3.12), Size(10.28, 25.00)),
+          ('2', Offset(6.85, 3.36), Size(10.28, 25.00)),
+        ]),
+        (KatexExample.mathBlockKatexLogo, skip: false, [
+          ('K', Offset(0.0, 8.64), Size(16.0, 25.0)),
+          ('A', Offset(12.50, 10.85), Size(10.79, 17.0)),
+          ('T', Offset(20.21, 9.36), Size(14.85, 25.0)),
+          ('E', Offset(31.63, 14.52), Size(14.0, 25.0)),
+          ('X', Offset(43.06, 9.85), Size(15.42, 25.0)),
+        ]),
+        (KatexExample.mathBlockKatexNegativeMarginsOnVlistRow, skip: false, [
+          ('X', Offset(0.00, 7.04), Size(17.03, 25.00)),
+          ('n', Offset(17.03, 15.90), Size(8.63, 17.00)),
+        ]),
+      ];
+
+      for (final testCase in testCases) {
+        testWidgets(testCase.$1.description, (tester) async {
+          await _loadKatexFonts();
+
+          addTearDown(testBinding.reset);
+          final globalSettings = testBinding.globalStore.settings;
+          await globalSettings.setBool(BoolGlobalSetting.renderKatex, true);
+          check(globalSettings).getBool(BoolGlobalSetting.renderKatex).isTrue();
+
+          await prepareContent(tester, plainContent(testCase.$1.html));
+
+          final baseRect = tester.getRect(find.byType(KatexWidget));
+
+          for (final characterData in testCase.$2) {
+            final character = characterData.$1;
+            final expectedTopLeftOffset = characterData.$2;
+            final expectedSize = characterData.$3;
+
+            final rect = tester.getRect(find.text(character));
+            final topLeftOffset = rect.topLeft - baseRect.topLeft;
+            final size = rect.size;
+
+            check(topLeftOffset)
+              .within(distance: 0.05, from: expectedTopLeftOffset);
+            check(size)
+              .within(distance: 0.05, from: expectedSize);
+          }
+        }, skip: testCase.skip);
+      }
+    });
+  });
+}
+
+Future<void> _loadKatexFonts() async {
+  const fonts = {
+    'KaTeX_AMS': ['KaTeX_AMS-Regular.ttf'],
+    'KaTeX_Caligraphic': [
+      'KaTeX_Caligraphic-Regular.ttf',
+      'KaTeX_Caligraphic-Bold.ttf',
+    ],
+    'KaTeX_Fraktur': [
+      'KaTeX_Fraktur-Regular.ttf',
+      'KaTeX_Fraktur-Bold.ttf',
+    ],
+    'KaTeX_Main': [
+      'KaTeX_Main-Regular.ttf',
+      'KaTeX_Main-Bold.ttf',
+      'KaTeX_Main-Italic.ttf',
+      'KaTeX_Main-BoldItalic.ttf',
+    ],
+    'KaTeX_Math': [
+      'KaTeX_Math-Italic.ttf',
+      'KaTeX_Math-BoldItalic.ttf',
+    ],
+    'KaTeX_SansSerif': [
+      'KaTeX_SansSerif-Regular.ttf',
+      'KaTeX_SansSerif-Bold.ttf',
+      'KaTeX_SansSerif-Italic.ttf',
+    ],
+    'KaTeX_Script': ['KaTeX_Script-Regular.ttf'],
+    'KaTeX_Size1': ['KaTeX_Size1-Regular.ttf'],
+    'KaTeX_Size2': ['KaTeX_Size2-Regular.ttf'],
+    'KaTeX_Size3': ['KaTeX_Size3-Regular.ttf'],
+    'KaTeX_Size4': ['KaTeX_Size4-Regular.ttf'],
+    'KaTeX_Typewriter': ['KaTeX_Typewriter-Regular.ttf'],
+  };
+  for (final MapEntry(key: fontFamily, value: fontFiles) in fonts.entries) {
+    final fontLoader = FontLoader(fontFamily);
+    for (final fontFile in fontFiles) {
+      fontLoader.addFont(rootBundle.load('assets/KaTeX/$fontFile'));
+    }
+    await fontLoader.load();
+  }
+}
