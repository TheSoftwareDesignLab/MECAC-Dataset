diff --git a/lib/widgets/action_sheet.dart b/lib/widgets/action_sheet.dart
index be35bd0a31..ba3ad34d2b 100644
--- a/lib/widgets/action_sheet.dart
+++ b/lib/widgets/action_sheet.dart
@@ -14,6 +14,7 @@ import '../model/narrow.dart';
 import 'actions.dart';
 import 'clipboard.dart';
 import 'color.dart';
+import 'compose_box.dart';
 import 'dialog.dart';
 import 'icons.dart';
 import 'inset_shadow.dart';
@@ -331,13 +332,12 @@ class QuoteAndReplyButton extends MessageActionSheetMenuItemButton {
     // or when a DM recipient becomes deactivated.
     var composeBoxController = findMessageListPage().composeBoxController;
     if (composeBoxController == null) return;
-    final topicController = composeBoxController.topicController;
     if (
-      topicController != null
-      && topicController.textNormalized == kNoTopicTopic
+      composeBoxController is StreamComposeBoxController
+      && composeBoxController.topicController.textNormalized == kNoTopicTopic
       && message is StreamMessage
     ) {
-      topicController.value = TextEditingValue(text: message.topic);
+      composeBoxController.topicController.value = TextEditingValue(text: message.topic);
     }
 
     // This inserts a "[Quoting…]" placeholder into the content input,
diff --git a/lib/widgets/compose_box.dart b/lib/widgets/compose_box.dart
index 5d3a379dab..15a3c7448e 100644
--- a/lib/widgets/compose_box.dart
+++ b/lib/widgets/compose_box.dart
@@ -1099,12 +1099,37 @@ class _ComposeBoxLayout extends StatelessWidget {
   }
 }
 
-abstract class ComposeBoxController<T extends StatefulWidget> extends State<T> {
-  ComposeTopicController? get topicController;
-  ComposeContentController get contentController;
-  FocusNode get contentFocusNode;
+sealed class ComposeBoxController {
+  ComposeContentController get contentController => _contentController;
+  final _contentController = ComposeContentController();
+
+  FocusNode get contentFocusNode => _contentFocusNode;
+  final _contentFocusNode = FocusNode();
+
+  @mustCallSuper
+  void dispose() {
+    _contentController.dispose();
+    _contentFocusNode.dispose();
+  }
 }
 
+class StreamComposeBoxController extends ComposeBoxController {
+  ComposeTopicController get topicController => _topicController;
+  final _topicController = ComposeTopicController();
+
+  FocusNode get topicFocusNode => _topicFocusNode;
+  final _topicFocusNode = FocusNode();
+
+  @override
+  void dispose() {
+    _topicController.dispose();
+    _topicFocusNode.dispose();
+    super.dispose();
+  }
+}
+
+class FixedDestinationComposeBoxController extends ComposeBoxController {}
+
 /// A compose box for use in a channel narrow.
 ///
 /// This offers a text input for the topic to send to,
@@ -1119,50 +1144,42 @@ class _StreamComposeBox extends StatefulWidget {
   State<_StreamComposeBox> createState() => _StreamComposeBoxState();
 }
 
-class _StreamComposeBoxState extends State<_StreamComposeBox> implements ComposeBoxController<_StreamComposeBox> {
-  @override ComposeTopicController get topicController => _topicController;
-  final _topicController = ComposeTopicController();
-
-  @override ComposeContentController get contentController => _contentController;
-  final _contentController = ComposeContentController();
-
-  @override FocusNode get contentFocusNode => _contentFocusNode;
-  final _contentFocusNode = FocusNode();
-
-  FocusNode get topicFocusNode => _topicFocusNode;
-  final _topicFocusNode = FocusNode();
+class _StreamComposeBoxState extends State<_StreamComposeBox> {
+  StreamComposeBoxController get controller => _controller;
+  final _controller = StreamComposeBoxController();
 
   @override
   void dispose() {
-    _topicController.dispose();
-    _contentController.dispose();
-    _contentFocusNode.dispose();
-    _topicFocusNode.dispose();
+    _controller.dispose();
     super.dispose();
   }
 
   @override
   Widget build(BuildContext context) {
+    final StreamComposeBoxController(
+      :topicController, :contentController, :topicFocusNode, :contentFocusNode,
+    ) = controller;
+
     return _ComposeBoxLayout(
-      contentController: _contentController,
-      contentFocusNode: _contentFocusNode,
+      contentController: contentController,
+      contentFocusNode: contentFocusNode,
       topicInput: _TopicInput(
         streamId: widget.narrow.streamId,
-        controller: _topicController,
+        controller: topicController,
         focusNode: topicFocusNode,
-        contentFocusNode: _contentFocusNode,
+        contentFocusNode: contentFocusNode,
       ),
       contentInput: _StreamContentInput(
         narrow: widget.narrow,
-        topicController: _topicController,
-        controller: _contentController,
-        focusNode: _contentFocusNode,
+        topicController: topicController,
+        controller: contentController,
+        focusNode: contentFocusNode,
       ),
       sendButton: _SendButton(
-        topicController: _topicController,
-        contentController: _contentController,
+        topicController: topicController,
+        contentController: contentController,
         getDestination: () => StreamDestination(
-          widget.narrow.streamId, _topicController.textNormalized),
+          widget.narrow.streamId, topicController.textNormalized),
       ));
   }
 }
@@ -1197,46 +1214,43 @@ class _FixedDestinationComposeBox extends StatefulWidget {
   State<_FixedDestinationComposeBox> createState() => _FixedDestinationComposeBoxState();
 }
 
-class _FixedDestinationComposeBoxState extends State<_FixedDestinationComposeBox> implements ComposeBoxController<_FixedDestinationComposeBox>  {
-  @override ComposeTopicController? get topicController => null;
-
-  @override ComposeContentController get contentController => _contentController;
-  final _contentController = ComposeContentController();
-
-  @override FocusNode get contentFocusNode => _contentFocusNode;
-  final _contentFocusNode = FocusNode();
+class _FixedDestinationComposeBoxState extends State<_FixedDestinationComposeBox> {
+  FixedDestinationComposeBoxController get controller => _controller;
+  final _controller = FixedDestinationComposeBoxController();
 
   @override
   void dispose() {
-    _contentController.dispose();
-    _contentFocusNode.dispose();
+    _controller.dispose();
     super.dispose();
   }
 
   @override
   Widget build(BuildContext context) {
+    final FixedDestinationComposeBoxController(
+      :contentController, :contentFocusNode,
+    ) = controller;
+
     return _ComposeBoxLayout(
-      contentController: _contentController,
-      contentFocusNode: _contentFocusNode,
+      contentController: contentController,
+      contentFocusNode: contentFocusNode,
       topicInput: null,
       contentInput: _FixedDestinationContentInput(
         narrow: widget.narrow,
-        controller: _contentController,
-        focusNode: _contentFocusNode,
+        controller: contentController,
+        focusNode: contentFocusNode,
       ),
       sendButton: _SendButton(
         topicController: null,
-        contentController: _contentController,
+        contentController: contentController,
         getDestination: () => widget.narrow.destination,
       ));
   }
 }
 
-class ComposeBox extends StatelessWidget {
-  ComposeBox({super.key, this.controllerKey, required this.narrow})
+class ComposeBox extends StatefulWidget {
+  ComposeBox({super.key, required this.narrow})
     : assert(ComposeBox.hasComposeBox(narrow));
 
-  final GlobalKey<ComposeBoxController>? controllerKey;
   final Narrow narrow;
 
   static bool hasComposeBox(Narrow narrow) {
@@ -1253,10 +1267,30 @@ class ComposeBox extends StatelessWidget {
     }
   }
 
+  @override
+  State<ComposeBox> createState() => _ComposeBoxState();
+}
+
+/// The interface for the state of a [ComposeBox].
+abstract class ComposeBoxState extends State<ComposeBox> {
+  ComposeBoxController? get controller;
+}
+
+class _ComposeBoxState extends State<ComposeBox> implements ComposeBoxState {
+  @override ComposeBoxController? get controller {
+    final forStream = _streamComposeBoxControllerKey.currentState?.controller;
+    final forFixedDestination = _fixedDestinationComposeBoxControllerKey.currentState?.controller;
+    assert(forStream == null || forFixedDestination == null);
+    // Both can be null (error-banner case).
+    return forStream ?? forFixedDestination;
+  }
+  final _streamComposeBoxControllerKey = GlobalKey<_StreamComposeBoxState>();
+  final _fixedDestinationComposeBoxControllerKey = GlobalKey<_FixedDestinationComposeBoxState>();
+
   Widget? _errorBanner(BuildContext context) {
     final store = PerAccountStoreWidget.of(context);
     final selfUser = store.users[store.selfUserId]!;
-    switch (narrow) {
+    switch (widget.narrow) {
       case ChannelNarrow(:final streamId):
       case TopicNarrow(:final streamId):
         final channel = store.streams[streamId];
@@ -1287,14 +1321,16 @@ class ComposeBox extends StatelessWidget {
       return _ComposeBoxContainer(child: errorBanner);
     }
 
-    final narrow = this.narrow;
+    final narrow = widget.narrow;
     switch (narrow) {
       case ChannelNarrow():
-        return _StreamComposeBox(key: controllerKey, narrow: narrow);
+        return _StreamComposeBox(key: _streamComposeBoxControllerKey, narrow: narrow);
       case TopicNarrow():
-        return _FixedDestinationComposeBox(key: controllerKey, narrow: narrow);
+        return _FixedDestinationComposeBox(key: _fixedDestinationComposeBoxControllerKey,
+          narrow: narrow);
       case DmNarrow():
-        return _FixedDestinationComposeBox(key: controllerKey, narrow: narrow);
+        return _FixedDestinationComposeBox(key: _fixedDestinationComposeBoxControllerKey,
+          narrow: narrow);
       case CombinedFeedNarrow():
       case MentionsNarrow():
       case StarredMessagesNarrow():
diff --git a/lib/widgets/message_list.dart b/lib/widgets/message_list.dart
index c6803f2484..f9e62f01ce 100644
--- a/lib/widgets/message_list.dart
+++ b/lib/widgets/message_list.dart
@@ -213,9 +213,9 @@ class _MessageListPageState extends State<MessageListPage> implements MessageLis
   late Narrow narrow;
 
   @override
-  ComposeBoxController? get composeBoxController => _composeBoxKey.currentState;
+  ComposeBoxController? get composeBoxController => _composeBoxKey.currentState?.controller;
 
-  final GlobalKey<ComposeBoxController> _composeBoxKey = GlobalKey();
+  final GlobalKey<ComposeBoxState> _composeBoxKey = GlobalKey();
 
   @override
   void initState() {
@@ -302,7 +302,7 @@ class _MessageListPageState extends State<MessageListPage> implements MessageLis
               child: Expanded(
                 child: MessageList(narrow: narrow, onNarrowChanged: _narrowChanged))),
             if (ComposeBox.hasComposeBox(narrow))
-              ComposeBox(controllerKey: _composeBoxKey, narrow: narrow)
+              ComposeBox(key: _composeBoxKey, narrow: narrow)
           ]))));
   }
 }
diff --git a/test/widgets/action_sheet_test.dart b/test/widgets/action_sheet_test.dart
index 719a1f18d6..c581c505e8 100644
--- a/test/widgets/action_sheet_test.dart
+++ b/test/widgets/action_sheet_test.dart
@@ -230,8 +230,8 @@ void main() {
 
   group('QuoteAndReplyButton', () {
     ComposeBoxController? findComposeBoxController(WidgetTester tester) {
-      return tester.widgetList<ComposeBox>(find.byType(ComposeBox))
-        .singleOrNull?.controllerKey?.currentState;
+      return tester.stateList<ComposeBoxState>(find.byType(ComposeBox))
+        .singleOrNull?.controller;
     }
 
     Widget? findQuoteAndReplyButton(WidgetTester tester) {
@@ -283,14 +283,14 @@ void main() {
       final message = eg.streamMessage();
       await setupToMessageActionSheet(tester, message: message, narrow: ChannelNarrow(message.streamId));
 
-      final composeBoxController = findComposeBoxController(tester)!;
+      final composeBoxController = findComposeBoxController(tester) as StreamComposeBoxController;
       final contentController = composeBoxController.contentController;
 
       // Ensure channel-topics are loaded before testing quote & reply behavior
       connection.prepare(body:
         jsonEncode(GetStreamTopicsResult(topics: [eg.getStreamTopicsEntry()]).toJson()));
       final topicController = composeBoxController.topicController;
-      topicController?.value = const TextEditingValue(text: kNoTopicTopic);
+      topicController.value = const TextEditingValue(text: kNoTopicTopic);
 
       final valueBefore = contentController.value;
       prepareRawContentResponseSuccess(message: message, rawContent: 'Hello world');
diff --git a/test/widgets/compose_box_test.dart b/test/widgets/compose_box_test.dart
index f611357cb3..8f297350c6 100644
--- a/test/widgets/compose_box_test.dart
+++ b/test/widgets/compose_box_test.dart
@@ -38,7 +38,7 @@ void main() {
 
   late PerAccountStore store;
   late FakeApiConnection connection;
-  late GlobalKey<ComposeBoxController> controllerKey;
+  late ComposeBoxController? controller;
 
   final contentInputFinder = find.byWidgetPredicate(
     (widget) => widget is TextField && widget.controller is ComposeContentController);
@@ -66,16 +66,17 @@ void main() {
     await store.addStreams(streams);
     connection = store.connection as FakeApiConnection;
 
-    controllerKey = GlobalKey<ComposeBoxController>();
     await tester.pumpWidget(TestZulipApp(accountId: selfAccount.id,
       child: Column(
         // This positions the compose box at the bottom of the screen,
         // simulating the layout of the message list page.
         children: [
           const Expanded(child: SizedBox.expand()),
-          ComposeBox(controllerKey: controllerKey, narrow: narrow),
+          ComposeBox(narrow: narrow),
         ])));
     await tester.pumpAndSettle();
+
+    controller = tester.state<ComposeBoxState>(find.byType(ComposeBox)).controller;
   }
 
   Future<void> enterTopic(WidgetTester tester, {
@@ -199,21 +200,21 @@ void main() {
     void checkComposeBoxTextFields(WidgetTester tester, {
       required bool expectTopicTextField,
     }) {
-      final composeBoxController = controllerKey.currentState!;
-
-      final topicTextField = tester.widgetList<TextField>(find.byWidgetPredicate(
-        (widget) => widget is TextField
-          && widget.controller == composeBoxController.topicController)).singleOrNull;
       if (expectTopicTextField) {
+        final topicController = (controller as StreamComposeBoxController).topicController;
+        final topicTextField = tester.widgetList<TextField>(find.byWidgetPredicate(
+          (widget) => widget is TextField && widget.controller == topicController
+        )).singleOrNull;
         check(topicTextField).isNotNull()
           .textCapitalization.equals(TextCapitalization.none);
       } else {
-        check(topicTextField).isNull();
+        check(controller).isA<FixedDestinationComposeBoxController>();
+        check(find.byType(TextField)).findsOne(); // just content input, no topic
       }
 
       final contentTextField = tester.widget<TextField>(find.byWidgetPredicate(
         (widget) => widget is TextField
-          && widget.controller == composeBoxController.contentController));
+          && widget.controller == controller!.contentController));
       check(contentTextField)
         .textCapitalization.equals(TextCapitalization.sentences);
     }
@@ -351,7 +352,6 @@ void main() {
 
     testWidgets('selection change sends a "typing started" notice', (tester) async {
       await prepareComposeBox(tester, narrow: narrow, streams: [channel]);
-      final composeBoxController = controllerKey.currentState!;
 
       await checkStartTyping(tester, narrow);
 
@@ -360,7 +360,7 @@ void main() {
       checkTypingRequest(TypingOp.stop, narrow);
 
       connection.prepare(json: {});
-      composeBoxController.contentController.selection =
+      controller!.contentController.selection =
         const TextSelection(baseOffset: 0, extentOffset: 2);
       checkTypingRequest(TypingOp.start, narrow);
 
@@ -471,12 +471,11 @@ void main() {
         final channel = eg.stream();
         final narrow = ChannelNarrow(channel.streamId);
         await prepareComposeBox(tester, narrow: narrow, streams: [channel]);
-        final composeBoxController = controllerKey.currentState!;
 
         // (When we check that the send button looks disabled, it should be because
         // the file is uploading, not a pre-existing reason.)
         await enterTopic(tester, narrow: narrow, topic: 'some topic');
-        composeBoxController.contentController.value = const TextEditingValue(text: 'see image: ');
+        controller!.contentController.value = const TextEditingValue(text: 'see image: ');
         await tester.pump();
         checkAppearsLoading(tester, false);
 
@@ -500,7 +499,7 @@ void main() {
         final errorDialogs = tester.widgetList(find.byType(AlertDialog));
         check(errorDialogs).isEmpty();
 
-        check(composeBoxController.contentController.text)
+        check(controller!.contentController.text)
           .equals('see image: [Uploading image.jpg…]()\n\n');
         // (the request is checked more thoroughly in API tests)
         check(connection.lastRequest!).isA<http.MultipartRequest>()
@@ -516,7 +515,7 @@ void main() {
         checkAppearsLoading(tester, true);
 
         await tester.pump(const Duration(seconds: 1));
-        check(composeBoxController.contentController.text)
+        check(controller!.contentController.text)
           .equals('see image: [image.jpg](/user_uploads/1/4e/m2A3MSqFnWRLUf9SaPzQ0Up_/image.jpg)\n\n');
         checkAppearsLoading(tester, false);
       });
@@ -532,12 +531,11 @@ void main() {
         final channel = eg.stream();
         final narrow = ChannelNarrow(channel.streamId);
         await prepareComposeBox(tester, narrow: narrow, streams: [channel]);
-        final composeBoxController = controllerKey.currentState!;
 
         // (When we check that the send button looks disabled, it should be because
         // the file is uploading, not a pre-existing reason.)
         await enterTopic(tester, narrow: narrow, topic: 'some topic');
-        composeBoxController.contentController.value = const TextEditingValue(text: 'see image: ');
+        controller!.contentController.value = const TextEditingValue(text: 'see image: ');
         await tester.pump();
         checkAppearsLoading(tester, false);
 
@@ -561,7 +559,7 @@ void main() {
         final errorDialogs = tester.widgetList(find.byType(AlertDialog));
         check(errorDialogs).isEmpty();
 
-        check(composeBoxController.contentController.text)
+        check(controller!.contentController.text)
           .equals('see image: [Uploading image.jpg…]()\n\n');
         // (the request is checked more thoroughly in API tests)
         check(connection.lastRequest!).isA<http.MultipartRequest>()
@@ -577,7 +575,7 @@ void main() {
         checkAppearsLoading(tester, true);
 
         await tester.pump(const Duration(seconds: 1));
-        check(composeBoxController.contentController.text)
+        check(controller!.contentController.text)
           .equals('see image: [image.jpg](/user_uploads/1/4e/m2A3MSqFnWRLUf9SaPzQ0Up_/image.jpg)\n\n');
         checkAppearsLoading(tester, false);
       });
