diff --git a/lib/api/route/account.dart b/lib/api/route/account.dart
index fdf57d1ce6..1d29d3da1c 100644
--- a/lib/api/route/account.dart
+++ b/lib/api/route/account.dart
@@ -5,22 +5,14 @@ import '../core.dart';
 part 'account.g.dart';
 
 /// https://zulip.com/api/fetch-api-key
-Future<FetchApiKeyResult> fetchApiKey({
-  required Uri realmUrl,
-  required int? zulipFeatureLevel,
+Future<FetchApiKeyResult> fetchApiKey(ApiConnection connection, {
   required String username,
   required String password,
-}) async {
-  // TODO make this function testable by taking ApiConnection from caller
-  final connection = ApiConnection.live(realmUrl: realmUrl, zulipFeatureLevel: zulipFeatureLevel);
-  try {
-    return await connection.post('fetchApiKey', FetchApiKeyResult.fromJson, 'fetch_api_key', {
-      'username': RawParameter(username),
-      'password': RawParameter(password),
-    });
-  } finally {
-    connection.close();
-  }
+}) {
+  return connection.post('fetchApiKey', FetchApiKeyResult.fromJson, 'fetch_api_key', {
+    'username': RawParameter(username),
+    'password': RawParameter(password),
+  });
 }
 
 @JsonSerializable(fieldRename: FieldRename.snake)
diff --git a/lib/api/route/realm.dart b/lib/api/route/realm.dart
index b9939c3a6e..aca71e85b5 100644
--- a/lib/api/route/realm.dart
+++ b/lib/api/route/realm.dart
@@ -15,17 +15,8 @@ part 'realm.g.dart';
 // TODO(#107): Perhaps detect realmless root domain, for more specific onboarding feedback.
 //   See thread, and the zulip-mobile code and chat thread it links to:
 //     https://github.com/zulip/zulip-flutter/pull/55#discussion_r1160267577
-Future<GetServerSettingsResult> getServerSettings({
-  required Uri realmUrl,
-  required int? zulipFeatureLevel,
-}) async {
-  // TODO make this function testable by taking ApiConnection from caller
-  final connection = ApiConnection.live(realmUrl: realmUrl, zulipFeatureLevel: zulipFeatureLevel);
-  try {
-    return await connection.get('getServerSettings', GetServerSettingsResult.fromJson, 'server_settings', null);
-  } finally {
-    connection.close();
-  }
+Future<GetServerSettingsResult> getServerSettings(ApiConnection connection) {
+  return connection.get('getServerSettings', GetServerSettingsResult.fromJson, 'server_settings', null);
 }
 
 @JsonSerializable(fieldRename: FieldRename.snake)
diff --git a/lib/widgets/login.dart b/lib/widgets/login.dart
index de1587217a..3714366a37 100644
--- a/lib/widgets/login.dart
+++ b/lib/widgets/login.dart
@@ -153,7 +153,13 @@ class _AddAccountPageState extends State<AddAccountPage> {
     try {
       final GetServerSettingsResult serverSettings;
       try {
-        serverSettings = await getServerSettings(realmUrl: url!, zulipFeatureLevel: null);
+        // TODO make this function testable by controlling ApiConnection
+        final connection = ApiConnection.live(realmUrl: url!, zulipFeatureLevel: null);
+        try {
+          serverSettings = await getServerSettings(connection);
+        } finally {
+          connection.close();
+        }
       } catch (e) {
         if (!context.mounted) {
           return;
@@ -343,10 +349,15 @@ class _UsernamePasswordFormState extends State<_UsernamePasswordForm> {
     try {
       final FetchApiKeyResult result;
       try {
-        result = await fetchApiKey(
-          realmUrl: realmUrl,
-          zulipFeatureLevel: serverSettings.zulipFeatureLevel,
-          username: username, password: password);
+        // TODO make this function testable by controlling ApiConnection
+        final connection = ApiConnection.live(realmUrl: realmUrl,
+          zulipFeatureLevel: serverSettings.zulipFeatureLevel);
+        try {
+          result = await fetchApiKey(connection,
+            username: username, password: password);
+        } finally {
+          connection.close();
+        }
       } on ApiRequestException catch (e) {
         if (!context.mounted) return;
         // TODO(#105) give more helpful feedback. The RN app is
