diff --git a/packages/smooth_app/lib/helpers/attributes_card_helper.dart b/packages/smooth_app/lib/helpers/attributes_card_helper.dart
index c24cdb318edd..69e43731edff 100644
--- a/packages/smooth_app/lib/helpers/attributes_card_helper.dart
+++ b/packages/smooth_app/lib/helpers/attributes_card_helper.dart
@@ -32,17 +32,35 @@ enum AttributeEvaluation {
   }
 }
 
-Widget getAttributeDisplayIcon(final Attribute attribute) => Padding(
-      padding: const EdgeInsetsDirectional.only(end: VERY_SMALL_SPACE),
-      child: _attributeMatchComparison(
-        attribute,
-        const Icon(CupertinoIcons.question, color: RED_COLOR),
-        const Icon(Icons.lens, color: RED_COLOR),
-        const Icon(Icons.lens, color: LIGHT_ORANGE_COLOR),
-        const Icon(Icons.lens, color: LIGHT_ORANGE_COLOR),
-        const Icon(Icons.lens, color: LIGHT_GREEN_COLOR),
-        const Icon(Icons.lens, color: LIGHT_GREEN_COLOR),
-      ),
+Widget getAttributeDisplayIcon(final Attribute attribute) {
+  final Color color = getAttributeDisplayBackgroundColor(attribute);
+  final IconData iconData = getAttributeDisplayIconData(attribute);
+  return Padding(
+    padding: const EdgeInsetsDirectional.only(end: VERY_SMALL_SPACE),
+    child: Icon(iconData, color: color),
+  );
+}
+
+Color getAttributeDisplayBackgroundColor(final Attribute attribute) =>
+    _attributeMatchComparison<Color>(
+      attribute,
+      RED_COLOR,
+      RED_COLOR,
+      LIGHT_ORANGE_COLOR,
+      LIGHT_ORANGE_COLOR,
+      LIGHT_GREEN_COLOR,
+      LIGHT_GREEN_COLOR,
+    );
+
+IconData getAttributeDisplayIconData(final Attribute attribute) =>
+    _attributeMatchComparison<IconData>(
+      attribute,
+      CupertinoIcons.question,
+      Icons.lens,
+      Icons.lens,
+      Icons.lens,
+      Icons.lens,
+      Icons.lens,
     );
 
 bool isMatchAvailable(Attribute attribute) {
diff --git a/packages/smooth_app/lib/helpers/product_cards_helper.dart b/packages/smooth_app/lib/helpers/product_cards_helper.dart
index 48c3bbfb38d6..56e179b3b71f 100644
--- a/packages/smooth_app/lib/helpers/product_cards_helper.dart
+++ b/packages/smooth_app/lib/helpers/product_cards_helper.dart
@@ -95,7 +95,24 @@ List<Attribute> getMandatoryAttributes(
   final List<String> attributeGroupOrder,
   final Set<String> attributesToExcludeIfStatusIsUnknown,
   final ProductPreferences preferences,
-) {
+) =>
+    getSortedAttributes(
+      product,
+      attributeGroupOrder,
+      attributesToExcludeIfStatusIsUnknown,
+      preferences,
+      PreferenceImportance.ID_MANDATORY,
+    );
+
+/// Returns the attributes, ordered by importance desc and attribute group order
+List<Attribute> getSortedAttributes(
+  final Product product,
+  final List<String> attributeGroupOrder,
+  final Set<String> attributesToExcludeIfStatusIsUnknown,
+  final ProductPreferences preferences,
+  final String importance, {
+  final bool excludeMainScoreAttributes = true,
+}) {
   final List<Attribute> result = <Attribute>[];
   if (product.attributeGroups == null) {
     return result;
@@ -106,9 +123,10 @@ List<Attribute> getMandatoryAttributes(
   for (final AttributeGroup attributeGroup in product.attributeGroups!) {
     mandatoryAttributesByGroup[attributeGroup.id!] = getFilteredAttributes(
       attributeGroup,
-      PreferenceImportance.ID_MANDATORY,
+      importance,
       attributesToExcludeIfStatusIsUnknown,
       preferences,
+      excludeMainScoreAttributes: excludeMainScoreAttributes,
     );
   }
 
@@ -131,15 +149,17 @@ List<Attribute> getFilteredAttributes(
   final AttributeGroup attributeGroup,
   final String importance,
   final Set<String> attributesToExcludeIfStatusIsUnknown,
-  final ProductPreferences preferences,
-) {
+  final ProductPreferences preferences, {
+  final bool excludeMainScoreAttributes = true,
+}) {
   final List<Attribute> result = <Attribute>[];
   if (attributeGroup.attributes == null) {
     return result;
   }
   for (final Attribute attribute in attributeGroup.attributes!) {
     final String attributeId = attribute.id!;
-    if (SCORE_ATTRIBUTE_IDS.contains(attributeId)) {
+    if (excludeMainScoreAttributes &&
+        SCORE_ATTRIBUTE_IDS.contains(attributeId)) {
       continue;
     }
     if (attributeGroup.id == AttributeGroup.ATTRIBUTE_GROUP_LABELS) {
diff --git a/packages/smooth_app/lib/pages/preferences/user_preferences_dev_mode.dart b/packages/smooth_app/lib/pages/preferences/user_preferences_dev_mode.dart
index 338c317d5ffd..e0b56a424768 100644
--- a/packages/smooth_app/lib/pages/preferences/user_preferences_dev_mode.dart
+++ b/packages/smooth_app/lib/pages/preferences/user_preferences_dev_mode.dart
@@ -42,6 +42,8 @@ class UserPreferencesDevMode extends AbstractUserPreferences {
   static const String userPreferencesFlagProd = '__devWorkingOnProd';
   static const String userPreferencesTestEnvHost = '__testEnvHost';
   static const String userPreferencesFlagEditIngredients = '__editIngredients';
+  static const String userPreferencesFlagBoostedComparison =
+      '__boostedComparison';
   static const String userPreferencesEnumScanMode = '__scanMode';
   static const String userPreferencesAppLanguageCode = '__appLanguage';
   static const String userPreferencesFlagAccessibilityNoColor =
@@ -338,6 +340,17 @@ class UserPreferencesDevMode extends AbstractUserPreferences {
             ProductQuery.setLanguage(context, userPreferences);
           },
         ),
+        SwitchListTile(
+          title: const Text('Side by side comparison for 2 or 3 products'),
+          value:
+              userPreferences.getFlag(userPreferencesFlagBoostedComparison) ??
+                  false,
+          onChanged: (bool value) async {
+            await userPreferences.setFlag(
+                userPreferencesFlagBoostedComparison, value);
+            _showSuccessMessage();
+          },
+        ),
         ListTile(
           title: const Text('Debugging information'),
           onTap: () async => Navigator.of(context).push(MaterialPageRoute<void>(
diff --git a/packages/smooth_app/lib/pages/product/common/product_list_item_popup_items.dart b/packages/smooth_app/lib/pages/product/common/product_list_item_popup_items.dart
new file mode 100644
index 000000000000..b97f58f32b0e
--- /dev/null
+++ b/packages/smooth_app/lib/pages/product/common/product_list_item_popup_items.dart
@@ -0,0 +1,186 @@
+import 'package:flutter/material.dart';
+import 'package:flutter_gen/gen_l10n/app_localizations.dart';
+import 'package:openfoodfacts/openfoodfacts.dart';
+import 'package:smooth_app/data_models/product_list.dart';
+import 'package:smooth_app/database/dao_product.dart';
+import 'package:smooth_app/database/dao_product_list.dart';
+import 'package:smooth_app/database/local_database.dart';
+import 'package:smooth_app/generic_lib/design_constants.dart';
+import 'package:smooth_app/generic_lib/dialogs/smooth_alert_dialog.dart';
+import 'package:smooth_app/pages/personalized_ranking_page.dart';
+import 'package:smooth_app/pages/product/compare_products3_page.dart';
+import 'package:smooth_app/pages/product/ordered_nutrients_cache.dart';
+
+/// Popup menu item entries for the product list page, for selected items.
+enum ProductListItemPopupMenuEntry {
+  compareSideBySide,
+  rank,
+  delete,
+}
+
+/// Popup menu items for the product list page, for selected items.
+abstract class ProductListItemPopupItem {
+  /// Title of the popup menu item.
+  String getTitle(final AppLocalizations appLocalizations);
+
+  /// IconData of the popup menu item.
+  IconData getIconData();
+
+  /// Action of the popup menu item.
+  ///
+  /// Returns true if the caller must refresh (setState) (e.g. after deleting).
+  Future<bool> doSomething({
+    required final ProductList productList,
+    required final LocalDatabase localDatabase,
+    required final BuildContext context,
+    required final Iterable<String> selectedBarcodes,
+  });
+
+  /// Returns the popup menu item.
+  PopupMenuItem<ProductListItemPopupItem> getMenuItem(
+    final AppLocalizations appLocalizations,
+    final bool enabled,
+  ) =>
+      PopupMenuItem<ProductListItemPopupItem>(
+        value: this,
+        enabled: enabled,
+        child: ListTile(
+          leading: Icon(getIconData()),
+          title: Text(getTitle(appLocalizations)),
+        ),
+      );
+}
+
+/// Popup menu item for the product list page: compare side by side selected items.
+class ProductListItemPopupSideBySide extends ProductListItemPopupItem {
+  @override
+  String getTitle(final AppLocalizations appLocalizations) =>
+      'Compare side by side';
+
+  @override
+  IconData getIconData() => Icons.difference_outlined;
+
+  @override
+  Future<bool> doSomething({
+    required final ProductList productList,
+    required final LocalDatabase localDatabase,
+    required final BuildContext context,
+    required final Iterable<String> selectedBarcodes,
+  }) async {
+    final OrderedNutrientsCache? cache =
+        await OrderedNutrientsCache.getCache(context);
+    if (context.mounted) {
+      if (cache == null) {
+        ScaffoldMessenger.of(context).showSnackBar(
+          SnackBar(
+            content: Text(
+              AppLocalizations.of(context).nutrition_cache_loading_error,
+            ),
+          ),
+        );
+        return false;
+      }
+      final DaoProduct daoProduct = DaoProduct(localDatabase);
+      final List<Product> list = <Product>[];
+      for (final String barcode in selectedBarcodes) {
+        list.add((await daoProduct.get(barcode))!);
+      }
+      if (context.mounted) {
+        await Navigator.push<void>(
+          context,
+          MaterialPageRoute<void>(
+            builder: (BuildContext context) => CompareProducts3Page(
+              products: list,
+              orderedNutrientsCache: cache,
+            ),
+          ),
+        );
+      }
+    }
+    return false;
+  }
+}
+
+/// Popup menu item for the product list page: rank selected items.
+class ProductListItemPopupRank extends ProductListItemPopupItem {
+  @override
+  String getTitle(final AppLocalizations appLocalizations) =>
+      appLocalizations.compare_products_mode;
+
+  @override
+  IconData getIconData() => Icons.compare_arrows;
+
+  @override
+  Future<bool> doSomething({
+    required final ProductList productList,
+    required final LocalDatabase localDatabase,
+    required final BuildContext context,
+    required final Iterable<String> selectedBarcodes,
+  }) async {
+    await Navigator.push<void>(
+      context,
+      MaterialPageRoute<void>(
+        builder: (_) => PersonalizedRankingPage(
+          barcodes: selectedBarcodes.toList(),
+          title: AppLocalizations.of(context).product_list_your_ranking,
+        ),
+      ),
+    );
+    return false;
+  }
+}
+
+/// Popup menu item for the product list page: delete selected items.
+class ProductListItemPopupDelete extends ProductListItemPopupItem {
+  @override
+  String getTitle(final AppLocalizations appLocalizations) =>
+      'Delete selected items'; //appLocalizations.action_delete_list;
+
+  @override
+  IconData getIconData() => Icons.delete;
+
+  @override
+  Future<bool> doSomething({
+    required final ProductList productList,
+    required final LocalDatabase localDatabase,
+    required final BuildContext context,
+    required final Iterable<String> selectedBarcodes,
+  }) async {
+    final AppLocalizations appLocalizations = AppLocalizations.of(context);
+    final DaoProductList daoProductList = DaoProductList(localDatabase);
+    final bool? letsDoIt = await showDialog<bool>(
+      context: context,
+      builder: (BuildContext context) => SmoothAlertDialog(
+        body: Container(
+          padding: const EdgeInsetsDirectional.only(start: SMALL_SPACE),
+          child: Column(
+            crossAxisAlignment: CrossAxisAlignment.start,
+            children: <Widget>[
+              Text(appLocalizations.alert_clear_selected_user_list),
+              const SizedBox(height: SMALL_SPACE),
+              Text(appLocalizations.confirm_clear_selected_user_list),
+            ],
+          ),
+        ),
+        positiveAction: SmoothActionButton(
+          onPressed: () async => Navigator.of(context).pop(true),
+          text: appLocalizations.yes,
+        ),
+        negativeAction: SmoothActionButton(
+          onPressed: () => Navigator.of(context).pop(false),
+          text: appLocalizations.no,
+        ),
+      ),
+    );
+    if (letsDoIt != true) {
+      return false;
+    }
+    await daoProductList.bulkSet(
+      productList,
+      selectedBarcodes.toList(growable: false),
+      include: false,
+    );
+    await daoProductList.get(productList);
+    return true;
+  }
+}
diff --git a/packages/smooth_app/lib/pages/product/common/product_list_page.dart b/packages/smooth_app/lib/pages/product/common/product_list_page.dart
index 42906f034c84..d6d01335cfb7 100644
--- a/packages/smooth_app/lib/pages/product/common/product_list_page.dart
+++ b/packages/smooth_app/lib/pages/product/common/product_list_page.dart
@@ -7,6 +7,7 @@ import 'package:matomo_tracker/matomo_tracker.dart';
 import 'package:openfoodfacts/openfoodfacts.dart';
 import 'package:provider/provider.dart';
 import 'package:smooth_app/data_models/continuous_scan_model.dart';
+import 'package:smooth_app/data_models/preferences/user_preferences.dart';
 import 'package:smooth_app/data_models/product_list.dart';
 import 'package:smooth_app/data_models/up_to_date_product_list_mixin.dart';
 import 'package:smooth_app/database/dao_product.dart';
@@ -14,7 +15,6 @@ import 'package:smooth_app/database/dao_product_list.dart';
 import 'package:smooth_app/database/local_database.dart';
 import 'package:smooth_app/generic_lib/bottom_sheets/smooth_bottom_sheet.dart';
 import 'package:smooth_app/generic_lib/design_constants.dart';
-import 'package:smooth_app/generic_lib/dialogs/smooth_alert_dialog.dart';
 import 'package:smooth_app/generic_lib/duration_constants.dart';
 import 'package:smooth_app/generic_lib/loading_dialog.dart';
 import 'package:smooth_app/generic_lib/widgets/smooth_responsive.dart';
@@ -22,7 +22,8 @@ import 'package:smooth_app/helpers/app_helper.dart';
 import 'package:smooth_app/helpers/robotoff_insight_helper.dart';
 import 'package:smooth_app/pages/all_product_list_modal.dart';
 import 'package:smooth_app/pages/carousel_manager.dart';
-import 'package:smooth_app/pages/personalized_ranking_page.dart';
+import 'package:smooth_app/pages/preferences/user_preferences_dev_mode.dart';
+import 'package:smooth_app/pages/product/common/product_list_item_popup_items.dart';
 import 'package:smooth_app/pages/product/common/product_list_item_simple.dart';
 import 'package:smooth_app/pages/product/common/product_list_popup_items.dart';
 import 'package:smooth_app/pages/product/common/product_query_page_helper.dart';
@@ -67,6 +68,10 @@ class _ProductListPageState extends State<ProductListPage>
   final ProductListPopupItem _clear = ProductListPopupClear();
   final ProductListPopupItem _openInWeb = ProductListPopupOpenInWeb();
   final ProductListPopupItem _share = ProductListPopupShare();
+  final ProductListItemPopupItem _deleteItems = ProductListItemPopupDelete();
+  final ProductListItemPopupItem _rankItems = ProductListItemPopupRank();
+  final ProductListItemPopupItem _sideBySideItems =
+      ProductListItemPopupSideBySide();
 
   //returns bool to handle WillPopScope
   Future<bool> _handleUserBacktap() async {
@@ -89,6 +94,7 @@ class _ProductListPageState extends State<ProductListPage>
     final DaoProductList daoProductList = DaoProductList(localDatabase);
     final ThemeData themeData = Theme.of(context);
     final AppLocalizations appLocalizations = AppLocalizations.of(context);
+    final UserPreferences userPreferences = context.watch<UserPreferences>();
     refreshUpToDate();
 
     /// If we were on a user list, but it has been deleted, we switch to history
@@ -131,18 +137,12 @@ class _ProductListPageState extends State<ProductListPage>
               onPressed: () =>
                   ExternalCarouselManager.read(context).showSearchCard(),
             )
-          : _selectionMode || products.length <= 1
-              ? _CompareProductsButton(
-                  selectedBarcodes: _selectedBarcodes,
-                  barcodes: products,
-                  onComparisonEnded: () {
-                    setState(() => _selectionMode = false);
-                  },
-                )
+          : _selectionMode
+              ? null
               : FloatingActionButton.extended(
                   onPressed: () => setState(() => _selectionMode = true),
-                  label: Text(appLocalizations.compare_products_mode),
-                  icon: const Icon(Icons.compare_arrows),
+                  label: const Text('Multi-select'),
+                  icon: const Icon(Icons.checklist),
                 ),
       appBar: SmoothAppBar(
         centerTitle: false,
@@ -215,76 +215,41 @@ class _ProductListPageState extends State<ProductListPage>
         onLeaveActionMode: () {
           setState(() => _selectionMode = false);
         },
-        actionModeTitle: Text(appLocalizations.compare_products_appbar_title),
-        actionModeSubTitle:
-            Text(appLocalizations.compare_products_appbar_subtitle),
+        actionModeTitle: Text('${_selectedBarcodes.length}'),
         actionModeActions: <Widget>[
-          IconButton(
-            icon: const Icon(Icons.delete),
-            onPressed: () async {
-              if (_selectedBarcodes.isNotEmpty) {
-                await showDialog<void>(
-                  context: context,
-                  builder: (BuildContext context) {
-                    return SmoothAlertDialog(
-                      body: Container(
-                        padding: const EdgeInsetsDirectional.only(
-                            start: SMALL_SPACE),
-                        child: Column(
-                          crossAxisAlignment: CrossAxisAlignment.start,
-                          children: <Widget>[
-                            Text(
-                              appLocalizations.alert_clear_selected_user_list,
-                            ),
-                            const SizedBox(
-                              height: SMALL_SPACE,
-                            ),
-                            Text(
-                              appLocalizations.confirm_clear_selected_user_list,
-                            ),
-                          ],
-                        ),
-                      ),
-                      positiveAction: SmoothActionButton(
-                        onPressed: () async {
-                          await daoProductList.bulkSet(
-                            productList,
-                            _selectedBarcodes.toList(growable: false),
-                            include: false,
-                          );
-                          await daoProductList.get(productList);
-                          if (!mounted) {
-                            return;
-                          }
-                          setState(() {});
-                          Navigator.of(context).maybePop();
-                        },
-                        text: appLocalizations.yes,
-                      ),
-                      negativeAction: SmoothActionButton(
-                        onPressed: () => Navigator.of(context).maybePop(),
-                        text: appLocalizations.no,
-                      ),
-                    );
-                  },
-                );
-              } else {
-                await showDialog<void>(
-                  context: context,
-                  builder: (BuildContext context) {
-                    return SmoothAlertDialog(
-                      body: Text(
-                        appLocalizations.alert_select_items_to_clear,
-                      ),
-                      positiveAction: SmoothActionButton(
-                        onPressed: () => Navigator.of(context).maybePop(),
-                        text: appLocalizations.okay,
-                      ),
-                    );
-                  },
-                );
+          PopupMenuButton<ProductListItemPopupItem>(
+            onSelected: (final ProductListItemPopupItem action) async {
+              final bool andThenSetState = await action.doSomething(
+                productList: productList,
+                localDatabase: localDatabase,
+                context: context,
+                selectedBarcodes: _selectedBarcodes,
+              );
+              if (andThenSetState) {
+                if (context.mounted) {
+                  setState(() {});
+                }
               }
             },
+            itemBuilder: (BuildContext context) =>
+                <PopupMenuEntry<ProductListItemPopupItem>>[
+              if (userPreferences.getFlag(UserPreferencesDevMode
+                      .userPreferencesFlagBoostedComparison) ==
+                  true)
+                _sideBySideItems.getMenuItem(
+                  appLocalizations,
+                  _selectedBarcodes.length >= 2 &&
+                      _selectedBarcodes.length <= 3,
+                ),
+              _rankItems.getMenuItem(
+                appLocalizations,
+                _selectedBarcodes.length >= 2,
+              ),
+              _deleteItems.getMenuItem(
+                appLocalizations,
+                _selectedBarcodes.isNotEmpty,
+              ),
+            ],
           ),
         ],
       ),
@@ -390,7 +355,12 @@ class _ProductListPageState extends State<ProductListPage>
                 barcode: barcode,
                 onTap: _selectionMode ? onTap : null,
                 onLongPress: !_selectionMode
-                    ? () => setState(() => _selectionMode = true)
+                    ? () => setState(
+                          () {
+                            _selectedBarcodes.add(barcode);
+                            _selectionMode = true;
+                          },
+                        )
                     : null,
               ),
             ),
@@ -530,59 +500,3 @@ class _ProductListPageState extends State<ProductListPage>
     return false;
   }
 }
-
-class _CompareProductsButton extends StatelessWidget {
-  const _CompareProductsButton({
-    required this.selectedBarcodes,
-    required this.barcodes,
-    this.onComparisonEnded,
-    Key? key,
-  }) : super(key: key);
-
-  final Set<String> selectedBarcodes;
-  final List<String> barcodes;
-  final VoidCallback? onComparisonEnded;
-
-  @override
-  Widget build(BuildContext context) {
-    final AppLocalizations appLocalizations = AppLocalizations.of(context);
-
-    final bool enabled = selectedBarcodes.length >= 2;
-
-    return AnimatedOpacity(
-      opacity: enabled ? 1.0 : 0.5,
-      duration: SmoothAnimationsDuration.brief,
-      child: FloatingActionButton.extended(
-        label: Text(appLocalizations.compare_products_mode),
-        icon: const Icon(Icons.compare_arrows),
-        tooltip: enabled
-            ? appLocalizations.plural_compare_x_products(
-                selectedBarcodes.length,
-              )
-            : appLocalizations.compare_products_appbar_subtitle,
-        onPressed: enabled
-            ? () async {
-                final List<String> list = <String>[];
-                for (final String barcode in barcodes) {
-                  if (selectedBarcodes.contains(barcode)) {
-                    list.add(barcode);
-                  }
-                }
-
-                await Navigator.push<void>(
-                  context,
-                  MaterialPageRoute<void>(
-                    builder: (_) => PersonalizedRankingPage(
-                      barcodes: list,
-                      title: appLocalizations.product_list_your_ranking,
-                    ),
-                  ),
-                );
-
-                onComparisonEnded?.call();
-              }
-            : null,
-      ),
-    );
-  }
-}
diff --git a/packages/smooth_app/lib/pages/product/common/product_list_popup_items.dart b/packages/smooth_app/lib/pages/product/common/product_list_popup_items.dart
index 92c4e38bc435..8fdcbd345d9d 100644
--- a/packages/smooth_app/lib/pages/product/common/product_list_popup_items.dart
+++ b/packages/smooth_app/lib/pages/product/common/product_list_popup_items.dart
@@ -10,6 +10,7 @@ import 'package:smooth_app/helpers/temp_product_list_share_helper.dart';
 import 'package:smooth_app/pages/product_list_user_dialog_helper.dart';
 import 'package:url_launcher/url_launcher.dart';
 
+/// Popup menu item entries for the product list page.
 enum ProductListPopupMenuEntry {
   share,
   openInBrowser,
diff --git a/packages/smooth_app/lib/pages/product/compare_products3_page.dart b/packages/smooth_app/lib/pages/product/compare_products3_page.dart
new file mode 100644
index 000000000000..5e5041d6e56e
--- /dev/null
+++ b/packages/smooth_app/lib/pages/product/compare_products3_page.dart
@@ -0,0 +1,352 @@
+import 'package:auto_size_text/auto_size_text.dart';
+import 'package:flutter/material.dart';
+import 'package:flutter_gen/gen_l10n/app_localizations.dart';
+import 'package:openfoodfacts/openfoodfacts.dart';
+import 'package:provider/provider.dart';
+import 'package:smooth_app/data_models/product_preferences.dart';
+import 'package:smooth_app/database/local_database.dart';
+import 'package:smooth_app/generic_lib/design_constants.dart';
+import 'package:smooth_app/generic_lib/svg_icon_chip.dart';
+import 'package:smooth_app/generic_lib/widgets/smooth_product_image.dart';
+import 'package:smooth_app/helpers/attributes_card_helper.dart';
+import 'package:smooth_app/helpers/product_cards_helper.dart';
+import 'package:smooth_app/helpers/product_compatibility_helper.dart';
+import 'package:smooth_app/pages/product/nutrition_container.dart';
+import 'package:smooth_app/pages/product/ordered_nutrients_cache.dart';
+import 'package:smooth_app/widgets/smooth_app_bar.dart';
+import 'package:smooth_app/widgets/smooth_scaffold.dart';
+
+// cf. SummaryCard
+const List<String> _ATTRIBUTE_GROUP_ORDER = <String>[
+  AttributeGroup.ATTRIBUTE_GROUP_ALLERGENS,
+  AttributeGroup.ATTRIBUTE_GROUP_INGREDIENT_ANALYSIS,
+  AttributeGroup.ATTRIBUTE_GROUP_PROCESSING,
+  AttributeGroup.ATTRIBUTE_GROUP_NUTRITIONAL_QUALITY,
+  AttributeGroup.ATTRIBUTE_GROUP_LABELS,
+  AttributeGroup.ATTRIBUTE_GROUP_ENVIRONMENT,
+];
+
+/// Test page about comparing 3 products. Work in progress.
+class CompareProducts3Page extends StatefulWidget {
+  const CompareProducts3Page({
+    required this.products,
+    required this.orderedNutrientsCache,
+  });
+
+  final List<Product> products;
+  final OrderedNutrientsCache orderedNutrientsCache;
+
+  @override
+  State<CompareProducts3Page> createState() => _CompareProducts3PageState();
+}
+
+class _CompareProducts3PageState extends State<CompareProducts3Page> {
+  final Set<String> _attributesToExcludeIfStatusIsUnknown = <String>{};
+
+  static const List<String> _sortedImportances = <String>[
+    PreferenceImportance.ID_MANDATORY,
+    PreferenceImportance.ID_VERY_IMPORTANT,
+    PreferenceImportance.ID_IMPORTANT,
+  ];
+
+  final List<NutritionContainer> _nutritionContainers = <NutritionContainer>[];
+
+  @override
+  void initState() {
+    super.initState();
+    for (final Product product in widget.products) {
+      _nutritionContainers.add(
+        NutritionContainer(
+          orderedNutrients: widget.orderedNutrientsCache.orderedNutrients,
+          product: product,
+        ),
+      );
+    }
+  }
+
+  @override
+  Widget build(BuildContext context) {
+    final AppLocalizations appLocalizations = AppLocalizations.of(context);
+    context.watch<LocalDatabase>();
+
+    final bool darkMode = Theme.of(context).brightness == Brightness.dark;
+
+    final ProductPreferences productPreferences =
+        context.watch<ProductPreferences>();
+    final List<List<Attribute>> scoreAttributesArray = <List<Attribute>>[];
+    final List<Widget> scoreWidgets = <Widget>[];
+    for (final Product product in widget.products) {
+      final MatchedProductV2 matchedProduct = MatchedProductV2(
+        product,
+        productPreferences,
+      );
+      final ProductCompatibilityHelper helper =
+          ProductCompatibilityHelper.product(matchedProduct);
+      scoreWidgets.add(
+        Expanded(
+          child: Container(
+            color: helper.getHeaderBackgroundColor(darkMode),
+            child: Center(
+              child: Text(
+                matchedProduct.score.toInt().toString(),
+                style: const TextStyle(
+                  color: Colors.white,
+                  fontWeight: FontWeight.w500,
+                ),
+              ),
+            ),
+          ),
+        ),
+      );
+    }
+
+    final List<String> names = <String>[];
+    final List<String> brands = <String>[];
+    final List<String> quantities = <String>[];
+    final List<Widget> pictures = <Widget>[];
+    final Size screenSize = MediaQuery.of(context).size;
+    for (final Product product in widget.products) {
+      names.add(getProductName(product, appLocalizations));
+      brands.add(getProductBrands(product, appLocalizations));
+      quantities.add(product.quantity ?? '');
+      pictures.add(Expanded(
+        child: Center(
+          child: SmoothMainProductImage(
+            product: product,
+            width: screenSize.width * 0.20,
+            height: screenSize.width * 0.20,
+          ),
+        ),
+      ));
+    }
+    for (final Product product in widget.products) {
+      final List<Attribute> tmp = <Attribute>[];
+      for (final String importance in _sortedImportances) {
+        final List<Attribute> attributes = getSortedAttributes(
+          product,
+          _ATTRIBUTE_GROUP_ORDER,
+          _attributesToExcludeIfStatusIsUnknown,
+          productPreferences,
+          importance,
+          excludeMainScoreAttributes: false,
+        );
+        tmp.addAll(attributes);
+      }
+      scoreAttributesArray.add(tmp);
+    }
+
+    final List<Widget> nutrientValues = <Widget>[];
+    final NutritionContainer backBone = _nutritionContainers.first;
+    for (final OrderedNutrient orderedNutrient in backBone.allNutrients) {
+      final Nutrient nutrient = _getNutrient(orderedNutrient);
+      final List<double?> values = <double?>[];
+      bool notNull = false;
+      for (final NutritionContainer nutritionContainer
+          in _nutritionContainers) {
+        final double? value = nutritionContainer.getValue(nutrient);
+        values.add(value);
+        if (value != null) {
+          notNull = true;
+        }
+      }
+      if (notNull) {
+        nutrientValues.add(
+          _getNutrientRow(
+            values: values,
+            nutrient: nutrient,
+          ),
+        );
+      }
+    }
+    return SmoothScaffold(
+      contentBehindStatusBar: true,
+      spaceBehindStatusBar: false,
+      statusBarBackgroundColor: SmoothScaffold.semiTranslucentStatusBar,
+      appBar: SmoothAppBar(
+        title: Text('Compare ${widget.products.length} products'),
+      ),
+      body: Padding(
+        padding: const EdgeInsets.all(8.0),
+        child: ListView(
+          children: <Widget>[
+            const Center(child: Text('Personal compatibility score')),
+            _getWidgetRow(scoreWidgets),
+            _getTextRow(names),
+            const SizedBox(height: 8.0),
+            _getTextRow(brands),
+            const SizedBox(height: 8.0),
+            _getTextRow(quantities),
+            _getWidgetRow(pictures),
+            const Divider(),
+            for (int i = 0; i < scoreAttributesArray.first.length; i++)
+              _getAttributeRow(
+                attributesArray: scoreAttributesArray,
+                index: i,
+                products: widget.products,
+              ),
+            ...nutrientValues,
+          ],
+        ),
+      ),
+    );
+  }
+
+  Row _getTextRow(final List<String> texts) => _getWidgetRow(
+        <Widget>[
+          for (final String text in texts) Expanded(child: Text(text)),
+        ],
+      );
+
+  Row _getWidgetRow(final List<Widget> widgets) {
+    final List<Widget> children = <Widget>[];
+    bool first = true;
+    for (final Widget widget in widgets) {
+      if (first) {
+        first = false;
+      } else {
+        children.add(const VerticalDivider());
+      }
+      children.add(widget);
+    }
+    return Row(
+      crossAxisAlignment: CrossAxisAlignment.start,
+      children: children,
+    );
+  }
+
+  Nutrient? _getAttributeNutrient(final String attributeId) {
+    switch (attributeId) {
+      case Attribute.ATTRIBUTE_LOW_FAT:
+        return Nutrient.fat;
+      case Attribute.ATTRIBUTE_LOW_SATURATED_FAT:
+        return Nutrient.saturatedFat;
+      case Attribute.ATTRIBUTE_LOW_SALT:
+        return Nutrient.salt;
+      case Attribute.ATTRIBUTE_LOW_SUGARS:
+        return Nutrient.sugars;
+    }
+    return null;
+  }
+
+  Widget? _getChild(
+    final Attribute attribute,
+    final Product product,
+  ) {
+    final Nutrient? nutrient = _getAttributeNutrient(attribute.id!);
+    if (nutrient != null) {
+      if (product.nutriments == null) {
+        return null;
+      }
+      final double? value =
+          product.nutriments!.getValue(nutrient, PerSize.oneHundredGrams);
+      if (value == null) {
+        return null;
+      }
+      return Text(
+        '${value.toStringAsFixed(2)} ${UnitHelper.unitToString(nutrient.typicalUnit)}',
+        style: const TextStyle(
+          fontWeight: FontWeight.w500,
+        ),
+      );
+    }
+    switch (attribute.id) {
+      case Attribute.ATTRIBUTE_NOVA:
+      case Attribute.ATTRIBUTE_NUTRISCORE:
+      case Attribute.ATTRIBUTE_ECOSCORE:
+        return SvgIconChip(attribute.iconUrl!, height: 30);
+    }
+    return null;
+  }
+
+  Widget _getAttributeRow({
+    required final List<List<Attribute>> attributesArray,
+    required final int index,
+    required final List<Product> products,
+  }) {
+    final List<Widget> children = <Widget>[];
+    late String title;
+    for (int i = 0; i < widget.products.length; i++) {
+      final Attribute attribute = attributesArray[i][index];
+      title = attribute.name!;
+      final Product product = products[i];
+      Widget? child = _getChild(attribute, product);
+      child = Expanded(
+        child: Container(
+          height: 36,
+          color: getAttributeDisplayBackgroundColor(attribute),
+          child: child,
+        ),
+      );
+      final bool first = children.isEmpty;
+      if (!first) {
+        children.add(const VerticalDivider());
+      }
+      children.add(child);
+    }
+    return Column(
+      children: <Widget>[
+        const Divider(),
+        Padding(
+          padding: const EdgeInsets.only(top: SMALL_SPACE),
+          child: AutoSizeText(
+            '$title (?)',
+            maxLines: 2,
+          ),
+        ),
+        Row(
+          mainAxisAlignment: MainAxisAlignment.spaceBetween,
+          children: children,
+        ),
+      ],
+    );
+  }
+
+  Widget _getNutrientRow({
+    required final List<double?> values,
+    required final Nutrient nutrient,
+  }) {
+    final List<Widget> children = <Widget>[];
+    for (final double? value in values) {
+      Widget? child = value == null
+          ? null
+          : Center(
+              child: Text(
+                '${value.toStringAsFixed(2)} ${UnitHelper.unitToString(nutrient.typicalUnit)}',
+                style: const TextStyle(
+                  fontWeight: FontWeight.w500,
+                ),
+              ),
+            );
+      child = Expanded(
+        child: SizedBox(
+          height: 36,
+          child: child,
+        ),
+      );
+      children.add(child);
+    }
+    return Column(
+      children: <Widget>[
+        const Divider(),
+        Padding(
+          padding: const EdgeInsets.only(top: SMALL_SPACE),
+          child: AutoSizeText(nutrient.name, maxLines: 2),
+        ),
+        Row(
+          mainAxisAlignment: MainAxisAlignment.spaceBetween,
+          children: children,
+        ),
+      ],
+    );
+  }
+
+  Nutrient _getNutrient(final OrderedNutrient orderedNutrient) {
+    if (orderedNutrient.nutrient != null) {
+      return orderedNutrient.nutrient!;
+    }
+    if (orderedNutrient.id == 'energy') {
+      return Nutrient.energyKJ;
+    }
+    throw Exception('unknown nutrient for "${orderedNutrient.id}"');
+  }
+}
diff --git a/packages/smooth_app/lib/pages/product/nutrition_container.dart b/packages/smooth_app/lib/pages/product/nutrition_container.dart
index 46bce5afa9dd..f56ec31dce73 100644
--- a/packages/smooth_app/lib/pages/product/nutrition_container.dart
+++ b/packages/smooth_app/lib/pages/product/nutrition_container.dart
@@ -38,6 +38,8 @@ class NutritionContainer {
   /// All the nutrients (country-related) that do match [Nutrient]s.
   final List<OrderedNutrient> _nutrients = <OrderedNutrient>[];
 
+  List<OrderedNutrient> get allNutrients => _nutrients;
+
   /// Nutrient values.
   final Map<Nutrient, double?> _values = <Nutrient, double?>{};
 
