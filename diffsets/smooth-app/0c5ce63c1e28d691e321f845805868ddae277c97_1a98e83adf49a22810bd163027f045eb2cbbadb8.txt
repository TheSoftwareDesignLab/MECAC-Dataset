diff --git a/packages/smooth_app/lib/bottom_sheet_views/user_preferences_view.dart b/packages/smooth_app/lib/bottom_sheet_views/user_preferences_view.dart
index 174468b4d960..870e62fefaf4 100644
--- a/packages/smooth_app/lib/bottom_sheet_views/user_preferences_view.dart
+++ b/packages/smooth_app/lib/bottom_sheet_views/user_preferences_view.dart
@@ -1,10 +1,14 @@
 import 'dart:ui';
 
 import 'package:flutter/material.dart';
+import 'package:flutter_svg/flutter_svg.dart';
 import 'package:provider/provider.dart';
 import 'package:smooth_app/data_models/user_preferences_model.dart';
 import 'package:smooth_app/generated/l10n.dart';
 import 'package:smooth_ui_library/buttons/smooth_main_button.dart';
+import 'package:smooth_app/temp/user_preferences.dart';
+import 'package:smooth_app/temp/attribute.dart';
+import 'package:smooth_app/temp/attribute_group.dart';
 
 class UserPreferencesView extends StatelessWidget {
   const UserPreferencesView(this._scrollController, {this.callback});
@@ -22,143 +26,232 @@ class UserPreferencesView extends StatelessWidget {
 
   static Color getColor(final int index) => _colors[index] ?? _COLOR_DEFAULT;
 
+  static const double _TYPICAL_PADDING_OR_MARGIN = 10;
+  static const double _PCT_ICON = .20;
+
   @override
   Widget build(BuildContext context) {
-    final List<String> preferencesVariables =
-        UserPreferencesModel.getVariables();
+    final Size screenSize = MediaQuery.of(context).size;
+    final UserPreferences userPreferences = context.watch<UserPreferences>();
+    final UserPreferencesModel userPreferencesModel =
+        context.watch<UserPreferencesModel>();
     return Material(
-      child: ChangeNotifierProvider<UserPreferencesModel>(
-        create: (BuildContext context) => UserPreferencesModel.load(context),
-        child: Container(
-          height: MediaQuery.of(context).size.height * 0.9,
-          child: Stack(
-            children: <Widget>[
-              Column(
-                mainAxisSize: MainAxisSize.max,
-                mainAxisAlignment: MainAxisAlignment.end,
-                children: <Widget>[
-                  Container(
-                    height: MediaQuery.of(context).size.height * 0.9,
-                    child: ListView(
-                      controller: _scrollController,
-                      shrinkWrap: true,
-                      scrollDirection: Axis.vertical,
-                      children: <Widget>[
-                        Container(
-                          padding: const EdgeInsets.symmetric(horizontal: 20.0),
-                          margin:
-                              const EdgeInsets.only(top: 20.0, bottom: 24.0),
-                          child: Text(
-                            S.of(context).myPreferences,
-                            style: Theme.of(context).textTheme.headline1,
-                          ),
-                        ),
-                        Column(
-                          mainAxisSize: MainAxisSize.min,
-                          children: List<Widget>.generate(
-                            preferencesVariables.length,
-                            (int index) => _generatePreferenceRow(
-                              preferencesVariables[index],
-                            ),
-                          ),
+      child: Container(
+        height: screenSize.height * 0.9,
+        child: Stack(
+          children: <Widget>[
+            Column(
+              mainAxisSize: MainAxisSize.max,
+              mainAxisAlignment: MainAxisAlignment.end,
+              children: <Widget>[
+                Container(
+                  height: screenSize.height * 0.9,
+                  child: ListView(
+                    controller: _scrollController,
+                    shrinkWrap: true,
+                    scrollDirection: Axis.vertical,
+                    children: <Widget>[
+                      Container(
+                        padding: const EdgeInsets.symmetric(horizontal: 20.0),
+                        margin: const EdgeInsets.only(top: 20.0, bottom: 24.0),
+                        child: Text(
+                          S.of(context).myPreferences,
+                          style: Theme.of(context).textTheme.headline1,
                         ),
-                        SizedBox(
-                          height: MediaQuery.of(context).size.height * 0.15,
-                        )
-                      ],
-                    ),
-                  ),
-                ],
-              ),
-              Column(
-                mainAxisSize: MainAxisSize.max,
-                mainAxisAlignment: MainAxisAlignment.end,
-                children: <Widget>[
-                  ClipRect(
-                    child: BackdropFilter(
-                      filter: ImageFilter.blur(
-                        sigmaX: 4.0,
-                        sigmaY: 4.0,
                       ),
-                      child: Container(
-                        color: Colors.black12,
-                        padding: const EdgeInsets.symmetric(
-                            horizontal: 12.0, vertical: 20.0),
-                        child: Consumer<UserPreferencesModel>(
-                          builder: (BuildContext context,
-                              UserPreferencesModel userPreferencesModel,
-                              Widget child) {
-                            return SmoothMainButton(
-                              text: S.of(context).saveButtonText,
-                              onPressed: () {
-                                userPreferencesModel.saveUserPreferences();
-                                Navigator.pop(context);
-                                if (callback != null) {
-                                  callback();
-                                }
-                              },
-                            );
-                          },
-                        ),
+                      _generateGroups(
+                        screenSize.width,
+                        userPreferences,
+                        userPreferencesModel,
+                      ),
+                      SizedBox(
+                        height: screenSize.height * 0.15,
+                      ),
+                    ],
+                  ),
+                ),
+              ],
+            ),
+            Column(
+              mainAxisSize: MainAxisSize.max,
+              mainAxisAlignment: MainAxisAlignment.end,
+              children: <Widget>[
+                ClipRect(
+                  child: BackdropFilter(
+                    filter: ImageFilter.blur(
+                      sigmaX: 4.0,
+                      sigmaY: 4.0,
+                    ),
+                    child: Container(
+                      color: Colors.black12,
+                      padding: const EdgeInsets.symmetric(
+                          horizontal: 12.0, vertical: 20.0),
+                      child: SmoothMainButton(
+                        text: 'OK',
+                        onPressed: () {
+                          Navigator.pop(context);
+                          if (callback != null) {
+                            callback();
+                          }
+                        },
                       ),
                     ),
                   ),
-                ],
-              ),
-            ],
-          ),
+                ),
+              ],
+            ),
+          ],
         ),
       ),
     );
   }
 
-  Widget _generatePreferenceRow(String variable) {
+  Widget _generatePreferenceRow(
+    final Attribute variable,
+    final double screenWidth,
+    final UserPreferences userPreferences,
+    final UserPreferencesModel userPreferencesModel,
+  ) {
+    final double iconWidth =
+        (screenWidth - _TYPICAL_PADDING_OR_MARGIN * 5) * _PCT_ICON;
+    final double sliderWidth =
+        (screenWidth - _TYPICAL_PADDING_OR_MARGIN * 5) * (1 - _PCT_ICON);
+    final PreferencesValue importance =
+        userPreferencesModel.getPreferencesValue(
+      variable.id,
+      userPreferences,
+    );
     return Container(
-      padding: const EdgeInsets.all(10.0),
-      margin: const EdgeInsets.all(10.0),
+      padding: const EdgeInsets.all(_TYPICAL_PADDING_OR_MARGIN),
+      margin: const EdgeInsets.all(_TYPICAL_PADDING_OR_MARGIN),
+      width: screenWidth,
       decoration: BoxDecoration(
           color: Colors.black.withAlpha(5),
           borderRadius: const BorderRadius.all(Radius.circular(20.0))),
-      child: Column(
+      child: Row(
+        mainAxisAlignment: MainAxisAlignment.start,
+        crossAxisAlignment: CrossAxisAlignment.center,
         children: <Widget>[
-          Row(
-            mainAxisSize: MainAxisSize.max,
-            mainAxisAlignment: MainAxisAlignment.spaceBetween,
-            children: <Widget>[
-              Text(UserPreferencesModel.getVariableName(variable)),
-            ],
+          Container(
+            width: iconWidth,
+            child: SvgPicture.network(
+              variable.iconUrl,
+              alignment: Alignment.centerLeft,
+              width: iconWidth,
+              fit: BoxFit.scaleDown,
+              placeholderBuilder: (BuildContext context) => Container(
+                  padding: const EdgeInsets.all(30.0),
+                  child: const CircularProgressIndicator()),
+            ),
           ),
-          Consumer<UserPreferencesModel>(
-            builder: (BuildContext context,
-                UserPreferencesModel userPreferencesModel, Widget child) {
-              if (!userPreferencesModel.dataLoaded) {
-                return Container();
-              }
-              final int index = userPreferencesModel.getValueIndex(variable);
-              return SliderTheme(
-                data: SliderThemeData(
-                  //thumbColor: Colors.black,
-                  activeTrackColor: Colors.black54,
-                  valueIndicatorColor: getColor(index),
-                  trackHeight: 5.0,
-                  inactiveTrackColor: Colors.black12,
-                  showValueIndicator: ShowValueIndicator.always,
-                ),
-                child: Slider(
-                  min: 0.0,
-                  max: 3.0,
-                  divisions: 3,
-                  value: index.toDouble(),
-                  onChanged: (double value) =>
-                      userPreferencesModel.setValue(variable, value.toInt()),
-                  activeColor: Colors.black,
-                  label: userPreferencesModel.getValueName(variable),
+          Container(width: _TYPICAL_PADDING_OR_MARGIN),
+          Container(
+            width: sliderWidth,
+            child: Column(
+              mainAxisAlignment: MainAxisAlignment.spaceBetween,
+              crossAxisAlignment: CrossAxisAlignment.start,
+              children: <Widget>[
+                Text(variable.settingName),
+                SliderTheme(
+                  data: SliderThemeData(
+                    //thumbColor: Colors.black,
+                    activeTrackColor: Colors.black54,
+                    valueIndicatorColor: getColor(userPreferencesModel
+                        .getValueIndex(variable.id, userPreferences)),
+                    trackHeight: 5.0,
+                    inactiveTrackColor: Colors.black12,
+                    showValueIndicator: ShowValueIndicator.always,
+                  ),
+                  child: Slider(
+                    min: 0.0,
+                    max: 3.0,
+                    divisions: 3,
+                    value: userPreferencesModel
+                        .getValueIndex(variable.id, userPreferences)
+                        .toDouble(),
+                    onChanged: (double value) => userPreferences.setImportance(
+                        variable.id, value.toInt()),
+                    activeColor: Colors.black,
+                    label: importance.name,
+                  ),
                 ),
-              );
-            },
+              ],
+            ),
           ),
         ],
       ),
     );
   }
+
+  Widget _generateGroups(
+    final double screenWidth,
+    final UserPreferences userPreferences,
+    final UserPreferencesModel userPreferencesModel,
+  ) {
+    final List<AttributeGroup> groups =
+        userPreferencesModel.preferenceVariableGroups;
+    return Column(
+      mainAxisSize: MainAxisSize.min,
+      children: List<Widget>.generate(
+          groups.length,
+          (int index) => _generateGroup(
+                groups[index],
+                screenWidth,
+                userPreferences,
+                userPreferencesModel,
+              )),
+    );
+  }
+
+  Widget _generateGroup(
+    final AttributeGroup group,
+    final double screenWidth,
+    final UserPreferences userPreferences,
+    final UserPreferencesModel userPreferencesModel,
+  ) =>
+      !userPreferences.isAttributeGroupVisible(group)
+          ? _generateGroupTitle(group, userPreferences)
+          : Column(
+              mainAxisSize: MainAxisSize.min,
+              children: List<Widget>.generate(
+                group.attributes.length + 2,
+                (int index) => index == 0
+                    ? _generateGroupTitle(group, userPreferences)
+                    : index == 1
+                        ? _generateGroupWarning(group.warning)
+                        : _generatePreferenceRow(
+                            group.attributes[index - 2],
+                            screenWidth,
+                            userPreferences,
+                            userPreferencesModel,
+                          ),
+              ),
+            );
+
+  Widget _generateGroupTitle(
+    final AttributeGroup group,
+    final UserPreferences userPreferences,
+  ) =>
+      GestureDetector(
+          child: Container(
+            color: Colors.grey[300],
+            width: double.infinity,
+            padding: const EdgeInsets.all(_TYPICAL_PADDING_OR_MARGIN),
+            child: Text(group.name),
+          ),
+          onTap: () => userPreferences.setAttributeGroupVisibility(
+              group, !userPreferences.isAttributeGroupVisible(group)));
+
+  Widget _generateGroupWarning(final String warning) => warning == null
+      ? Container()
+      : Container(
+          color: Colors.deepOrange,
+          width: double.infinity,
+          padding: const EdgeInsets.all(_TYPICAL_PADDING_OR_MARGIN),
+          margin: const EdgeInsets.all(_TYPICAL_PADDING_OR_MARGIN),
+          child: Text(
+            warning,
+            style: const TextStyle(color: Colors.white),
+          ),
+        );
 }
diff --git a/packages/smooth_app/lib/cards/product_cards/smooth_product_card_found.dart b/packages/smooth_app/lib/cards/product_cards/smooth_product_card_found.dart
index 163994e0cd58..94647f6ff5b7 100644
--- a/packages/smooth_app/lib/cards/product_cards/smooth_product_card_found.dart
+++ b/packages/smooth_app/lib/cards/product_cards/smooth_product_card_found.dart
@@ -10,222 +10,24 @@ import 'package:smooth_app/pages/product_page.dart';
 import 'package:smooth_ui_library/widgets/smooth_product_image.dart';
 
 class SmoothProductCardFound extends SmoothProductCardTemplate {
-  SmoothProductCardFound(
-      {@required this.product,
-      @required this.heroTag,
-      this.elevation = 0.0,
-      this.useNewStyle = true});
+  SmoothProductCardFound({
+    @required this.product,
+    @required this.heroTag,
+    this.elevation = 0.0,
+    this.useNewStyle = true,
+    this.backgroundColor = Colors.white,
+  });
 
   final Product product;
   final String heroTag;
   final double elevation;
   final bool useNewStyle;
+  final Color backgroundColor;
 
   @override
   Widget build(BuildContext context) {
-    if (useNewStyle) {
-      return GestureDetector(
-        onTap: () {
-          //_openSneakPeek(context);
-          Navigator.push<dynamic>(
-            context,
-            MaterialPageRoute<dynamic>(
-                builder: (BuildContext context) => ProductPage(
-                      product: product,
-                    )),
-          );
-        },
-        child: Hero(
-          tag: heroTag,
-          child: Material(
-            elevation: elevation,
-            borderRadius: const BorderRadius.all(Radius.circular(15.0)),
-            child: Container(
-              decoration: const BoxDecoration(
-                color: Colors.white,
-                borderRadius: BorderRadius.all(Radius.circular(15.0)),
-              ),
-              padding: const EdgeInsets.all(5.0),
-              height: 120.0,
-              child: Row(
-                children: <Widget>[
-                  SmoothProductImage(
-                    product: product,
-                    width: MediaQuery.of(context).size.width * 0.20,
-                    height: double.infinity,
-                  ),
-                  const SizedBox(
-                    width: 8.0,
-                  ),
-                  Column(
-                    mainAxisSize: MainAxisSize.max,
-                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
-                    crossAxisAlignment: CrossAxisAlignment.start,
-                    children: <Widget>[
-                      Container(
-                        width: MediaQuery.of(context).size.width * 0.65,
-                        child: Column(
-                          children: <Widget>[
-                            Row(
-                              children: <Widget>[
-                                Flexible(
-                                  child: Text(
-                                    product.productName ??
-                                        'Unknown product name',
-                                    maxLines: 2,
-                                    overflow: TextOverflow.fade,
-                                    style: const TextStyle(
-                                        color: Colors.black,
-                                        fontWeight: FontWeight.bold),
-                                  ),
-                                ),
-                              ],
-                            ),
-                            const SizedBox(
-                              height: 2.0,
-                            ),
-                            Row(
-                              children: <Widget>[
-                                Flexible(
-                                  child: Text(
-                                    product.brands ?? 'Unknown brand',
-                                    maxLines: 1,
-                                    overflow: TextOverflow.fade,
-                                    style: const TextStyle(
-                                        color: Colors.black,
-                                        fontWeight: FontWeight.w300,
-                                        fontStyle: FontStyle.italic),
-                                  ),
-                                )
-                              ],
-                            ),
-                          ],
-                        ),
-                      ),
-                      Container(
-                        decoration: const BoxDecoration(
-                          border: Border(
-                              top: BorderSide(color: Colors.grey, width: 1.0)),
-                        ),
-                        width: MediaQuery.of(context).size.width * 0.65,
-                        child: Row(
-                          mainAxisSize: MainAxisSize.max,
-                          mainAxisAlignment: MainAxisAlignment.start,
-                          children: <Widget>[
-                            Container(
-                              width: MediaQuery.of(context).size.width * 0.225,
-                              child: product.nutriscore != null
-                                  ? Image.asset(
-                                      'assets/product/nutri_score_${product.nutriscore}.png',
-                                      fit: BoxFit.fitWidth,
-                                    )
-                                  : Row(
-                                      children: <Widget>[
-                                        Flexible(
-                                          child: Text(
-                                            'Nutri-score unavailable',
-                                            style: Theme.of(context)
-                                                .textTheme
-                                                .subtitle1
-                                                .copyWith(
-                                                    color: Colors.black,
-                                                    fontSize: 12.0),
-                                            textAlign: TextAlign.center,
-                                          ),
-                                        ),
-                                      ],
-                                    ),
-                            ),
-                            Container(
-                              height: 35.0,
-                              width: 1.0,
-                              margin:
-                                  const EdgeInsets.symmetric(horizontal: 4.0),
-                              color: Colors.grey,
-                            ),
-                            Container(
-                              width: 20.0,
-                              height: 40.0,
-                              child: product.nutriments.novaGroup != null
-                                  ? SvgPicture.asset(
-                                      'assets/product/nova_group_${product.nutriments.novaGroup}.svg',
-                                      fit: BoxFit.contain,
-                                    )
-                                  : Container(),
-                            ),
-                            Container(
-                              width: MediaQuery.of(context).size.width * 0.225,
-                              margin: const EdgeInsets.only(left: 4.0),
-                              child: Row(
-                                children: <Widget>[
-                                  Flexible(
-                                    child: Text(
-                                      product.nutriments.novaGroup != null
-                                          ? _getNovaText(
-                                              product.nutriments.novaGroup)
-                                          : 'NOVA group unavailable',
-                                      style: Theme.of(context)
-                                          .textTheme
-                                          .subtitle1
-                                          .copyWith(
-                                              color: Colors.black,
-                                              fontSize: 12.0),
-                                    ),
-                                  ),
-                                ],
-                              ),
-                            ),
-                            Container(
-                              height: 35.0,
-                              width: 1.0,
-                              margin:
-                                  const EdgeInsets.symmetric(horizontal: 4.0),
-                              color: Colors.grey,
-                            ),
-                            Container(
-                              width: 30.0,
-                              height: 30.0,
-                              decoration: BoxDecoration(
-                                color: _getEnvironmentImpactColor(
-                                    product.environmentImpactLevels),
-                                borderRadius: const BorderRadius.all(
-                                    Radius.circular(30.0)),
-                              ),
-                              child: Center(
-                                child: Stack(
-                                  children: <Widget>[
-                                    const Text(
-                                      'CO  ',
-                                      style: TextStyle(
-                                          fontSize: 12.0,
-                                          fontWeight: FontWeight.w900,
-                                          color: Colors.white),
-                                    ),
-                                    Transform.translate(
-                                      offset: const Offset(16.0, 4.0),
-                                      child: const Text(
-                                        '2',
-                                        style: TextStyle(
-                                            fontSize: 10.0,
-                                            fontWeight: FontWeight.w900,
-                                            color: Colors.white),
-                                      ),
-                                    ),
-                                  ],
-                                ),
-                              ),
-                            ),
-                          ],
-                        ),
-                      ),
-                    ],
-                  )
-                ],
-              ),
-            ),
-          ),
-        ),
-      );
+    if (!useNewStyle) {
+      return _getOldStyle(context);
     }
     return GestureDetector(
       onTap: () {
@@ -244,95 +46,182 @@ class SmoothProductCardFound extends SmoothProductCardTemplate {
           elevation: elevation,
           borderRadius: const BorderRadius.all(Radius.circular(15.0)),
           child: Container(
-            decoration: const BoxDecoration(
-              color: Colors.white,
-              borderRadius: BorderRadius.all(Radius.circular(15.0)),
+            decoration: BoxDecoration(
+              color: backgroundColor,
+              borderRadius: const BorderRadius.all(Radius.circular(15.0)),
             ),
-            padding: const EdgeInsets.all(10.0),
-            child: Column(
+            padding: const EdgeInsets.all(5.0),
+            height: 120.0,
+            child: Row(
               children: <Widget>[
-                Row(
+                SmoothProductImage(
+                  product: product,
+                  width: MediaQuery.of(context).size.width * 0.20,
+                  height: double.infinity,
+                ),
+                const SizedBox(
+                  width: 8.0,
+                ),
+                Column(
                   mainAxisSize: MainAxisSize.max,
-                  mainAxisAlignment: MainAxisAlignment.start,
+                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                  crossAxisAlignment: CrossAxisAlignment.start,
                   children: <Widget>[
-                    SmoothProductImage(
-                      product: product,
-                      width: MediaQuery.of(context).size.width * 0.25,
-                      height: 140.0,
-                    ),
                     Container(
-                      margin: const EdgeInsets.only(left: 10.0),
-                      padding: const EdgeInsets.only(top: 7.5),
-                      width: MediaQuery.of(context).size.width * 0.5,
-                      height: 140.0,
+                      width: MediaQuery.of(context).size.width * 0.65,
                       child: Column(
-                        mainAxisSize: MainAxisSize.max,
-                        mainAxisAlignment: MainAxisAlignment.spaceBetween,
                         children: <Widget>[
-                          Column(
+                          Row(
                             children: <Widget>[
-                              Row(
-                                children: <Widget>[
-                                  Flexible(
-                                    child: Text(
-                                      product.productName,
-                                      maxLines: 3,
-                                      overflow: TextOverflow.fade,
-                                      style: const TextStyle(
-                                          color: Colors.black,
-                                          fontWeight: FontWeight.bold),
-                                    ),
-                                  ),
-                                ],
-                              ),
-                              const SizedBox(
-                                height: 4.0,
-                              ),
-                              Row(
-                                children: <Widget>[
-                                  Flexible(
-                                    child: Text(
-                                      product.brands ?? 'Unknown brand',
-                                      maxLines: 1,
-                                      overflow: TextOverflow.fade,
-                                      style: const TextStyle(
-                                          color: Colors.black,
-                                          fontWeight: FontWeight.w300,
-                                          fontStyle: FontStyle.italic),
-                                    ),
-                                  )
-                                ],
+                              Flexible(
+                                child: Text(
+                                  product.productName ?? 'Unknown product name',
+                                  maxLines: 2,
+                                  overflow: TextOverflow.fade,
+                                  style: const TextStyle(
+                                      color: Colors.black,
+                                      fontWeight: FontWeight.bold),
+                                ),
                               ),
                             ],
                           ),
+                          const SizedBox(
+                            height: 2.0,
+                          ),
                           Row(
-                            mainAxisSize: MainAxisSize.max,
-                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                             children: <Widget>[
-                              Container(
-                                width: 100.0,
-                                child: product.nutriscore != null
-                                    ? Image.asset(
-                                        'assets/product/nutri_score_${product.nutriscore}.png',
-                                        fit: BoxFit.contain,
-                                      )
-                                    : Center(
+                              Flexible(
+                                child: Text(
+                                  product.brands ?? 'Unknown brand',
+                                  maxLines: 1,
+                                  overflow: TextOverflow.fade,
+                                  style: const TextStyle(
+                                      color: Colors.black,
+                                      fontWeight: FontWeight.w300,
+                                      fontStyle: FontStyle.italic),
+                                ),
+                              )
+                            ],
+                          ),
+                        ],
+                      ),
+                    ),
+                    Container(
+                      decoration: const BoxDecoration(
+                        border: Border(
+                            top: BorderSide(color: Colors.grey, width: 1.0)),
+                      ),
+                      width: MediaQuery.of(context).size.width * 0.65,
+                      child: Row(
+                        mainAxisSize: MainAxisSize.max,
+                        mainAxisAlignment: MainAxisAlignment.start,
+                        children: <Widget>[
+                          Container(
+                            width: MediaQuery.of(context).size.width * 0.225,
+                            child: product.nutriscore != null
+                                ? Image.asset(
+                                    'assets/product/nutri_score_${product.nutriscore}.png',
+                                    fit: BoxFit.fitWidth,
+                                  )
+                                : Row(
+                                    children: <Widget>[
+                                      Flexible(
                                         child: Text(
                                           'Nutri-score unavailable',
                                           style: Theme.of(context)
                                               .textTheme
-                                              .subtitle1,
+                                              .subtitle1
+                                              .copyWith(
+                                                  color: Colors.black,
+                                                  fontSize: 12.0),
                                           textAlign: TextAlign.center,
                                         ),
                                       ),
+                                    ],
+                                  ),
+                          ),
+                          Container(
+                            height: 35.0,
+                            width: 1.0,
+                            margin: const EdgeInsets.symmetric(horizontal: 4.0),
+                            color: Colors.grey,
+                          ),
+                          Container(
+                            width: 20.0,
+                            height: 40.0,
+                            child: product.nutriments.novaGroup != null
+                                ? SvgPicture.asset(
+                                    'assets/product/nova_group_${product.nutriments.novaGroup}.svg',
+                                    fit: BoxFit.contain,
+                                  )
+                                : Container(),
+                          ),
+                          Container(
+                            width: MediaQuery.of(context).size.width * 0.225,
+                            margin: const EdgeInsets.only(left: 4.0),
+                            child: Row(
+                              children: <Widget>[
+                                Flexible(
+                                  child: Text(
+                                    product.nutriments.novaGroup != null
+                                        ? _getNovaText(
+                                            product.nutriments.novaGroup)
+                                        : 'NOVA group unavailable',
+                                    style: Theme.of(context)
+                                        .textTheme
+                                        .subtitle1
+                                        .copyWith(
+                                            color: Colors.black,
+                                            fontSize: 12.0),
+                                  ),
+                                ),
+                              ],
+                            ),
+                          ),
+                          Container(
+                            height: 35.0,
+                            width: 1.0,
+                            margin: const EdgeInsets.symmetric(horizontal: 4.0),
+                            color: Colors.grey,
+                          ),
+                          Container(
+                            width: 30.0,
+                            height: 30.0,
+                            decoration: BoxDecoration(
+                              color: _getEnvironmentImpactColor(
+                                  product.environmentImpactLevels),
+                              borderRadius:
+                                  const BorderRadius.all(Radius.circular(30.0)),
+                            ),
+                            child: Center(
+                              child: Stack(
+                                children: <Widget>[
+                                  const Text(
+                                    'CO  ',
+                                    style: TextStyle(
+                                        fontSize: 12.0,
+                                        fontWeight: FontWeight.w900,
+                                        color: Colors.white),
+                                  ),
+                                  Transform.translate(
+                                    offset: const Offset(16.0, 4.0),
+                                    child: const Text(
+                                      '2',
+                                      style: TextStyle(
+                                          fontSize: 10.0,
+                                          fontWeight: FontWeight.w900,
+                                          color: Colors.white),
+                                    ),
+                                  ),
+                                ],
                               ),
-                            ],
+                            ),
                           ),
                         ],
                       ),
-                    )
+                    ),
                   ],
-                ),
+                )
               ],
             ),
           ),
@@ -341,6 +230,119 @@ class SmoothProductCardFound extends SmoothProductCardTemplate {
     );
   }
 
+  Widget _getOldStyle(final BuildContext context) => GestureDetector(
+        onTap: () {
+          //_openSneakPeek(context);
+          Navigator.push<dynamic>(
+            context,
+            MaterialPageRoute<dynamic>(
+                builder: (BuildContext context) => ProductPage(
+                      product: product,
+                    )),
+          );
+        },
+        child: Hero(
+          tag: heroTag,
+          child: Material(
+            elevation: elevation,
+            borderRadius: const BorderRadius.all(Radius.circular(15.0)),
+            child: Container(
+              decoration: const BoxDecoration(
+                color: Colors.white,
+                borderRadius: BorderRadius.all(Radius.circular(15.0)),
+              ),
+              padding: const EdgeInsets.all(10.0),
+              child: Column(
+                children: <Widget>[
+                  Row(
+                    mainAxisSize: MainAxisSize.max,
+                    mainAxisAlignment: MainAxisAlignment.start,
+                    children: <Widget>[
+                      SmoothProductImage(
+                        product: product,
+                        width: MediaQuery.of(context).size.width * 0.25,
+                        height: 140.0,
+                      ),
+                      Container(
+                        margin: const EdgeInsets.only(left: 10.0),
+                        padding: const EdgeInsets.only(top: 7.5),
+                        width: MediaQuery.of(context).size.width * 0.5,
+                        height: 140.0,
+                        child: Column(
+                          mainAxisSize: MainAxisSize.max,
+                          mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                          children: <Widget>[
+                            Column(
+                              children: <Widget>[
+                                Row(
+                                  children: <Widget>[
+                                    Flexible(
+                                      child: Text(
+                                        product.productName,
+                                        maxLines: 3,
+                                        overflow: TextOverflow.fade,
+                                        style: const TextStyle(
+                                            color: Colors.black,
+                                            fontWeight: FontWeight.bold),
+                                      ),
+                                    ),
+                                  ],
+                                ),
+                                const SizedBox(
+                                  height: 4.0,
+                                ),
+                                Row(
+                                  children: <Widget>[
+                                    Flexible(
+                                      child: Text(
+                                        product.brands ?? 'Unknown brand',
+                                        maxLines: 1,
+                                        overflow: TextOverflow.fade,
+                                        style: const TextStyle(
+                                            color: Colors.black,
+                                            fontWeight: FontWeight.w300,
+                                            fontStyle: FontStyle.italic),
+                                      ),
+                                    )
+                                  ],
+                                ),
+                              ],
+                            ),
+                            Row(
+                              mainAxisSize: MainAxisSize.max,
+                              mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                              children: <Widget>[
+                                Container(
+                                  width: 100.0,
+                                  child: product.nutriscore != null
+                                      ? Image.asset(
+                                          'assets/product/nutri_score_${product.nutriscore}.png',
+                                          fit: BoxFit.contain,
+                                        )
+                                      : Center(
+                                          child: Text(
+                                            'Nutri-score unavailable',
+                                            style: Theme.of(context)
+                                                .textTheme
+                                                .subtitle1,
+                                            textAlign: TextAlign.center,
+                                          ),
+                                        ),
+                                ),
+                              ],
+                            ),
+                          ],
+                        ),
+                      )
+                    ],
+                  ),
+                ],
+              ),
+            ),
+          ),
+        ),
+      );
+
   String _getNovaText(int novaGroup) {
     switch (novaGroup) {
       case 1:
diff --git a/packages/smooth_app/lib/data_models/match.dart b/packages/smooth_app/lib/data_models/match.dart
index 2c9ed48c3ce5..2e025caab36b 100644
--- a/packages/smooth_app/lib/data_models/match.dart
+++ b/packages/smooth_app/lib/data_models/match.dart
@@ -2,10 +2,15 @@ import 'package:openfoodfacts/model/AttributeGroups.dart';
 import 'package:smooth_app/data_models/user_preferences_model.dart';
 import 'package:openfoodfacts/model/Product.dart';
 import 'package:smooth_app/structures/ranked_product.dart';
+import 'package:smooth_app/temp/user_preferences.dart';
 
 /// cf. https://github.com/openfoodfacts/smooth-app/issues/39
 class Match {
-  Match(final Product product, final UserPreferencesModel model) {
+  Match(
+    final Product product,
+    final UserPreferences userPreferences,
+    final UserPreferencesModel userPreferencesModel,
+  ) {
     final AttributeGroups attributeGroups = product.attributeGroups;
     if (attributeGroups == null) {
       _status = null;
@@ -15,7 +20,7 @@ class Match {
       for (final Attribute attribute in attributes) {
         final String variable = attribute.id;
         final PreferencesValue preferencesValue =
-            model.getPreferencesValue(variable);
+            userPreferencesModel.getPreferencesValue(variable, userPreferences);
         final String value = preferencesValue.id;
         _attributes[value] ??= <Attribute>[];
         _attributes[value].add(attribute);
@@ -54,15 +59,16 @@ class Match {
 
   static List<RankedProduct> sort(
     final List<Product> products,
-    final UserPreferencesModel model,
+    final UserPreferences userPreferences,
+    final UserPreferencesModel userPreferencesModel,
   ) {
     final List<RankedProduct> result = <RankedProduct>[];
     for (final Product product in products) {
-      final Match match = Match(product, model);
-      result.add(RankedProduct(product: product, score: match.score));
+      final Match match = Match(product, userPreferences, userPreferencesModel);
+      result.add(RankedProduct(product: product, match: match));
     }
-    result
-        .sort((RankedProduct a, RankedProduct b) => b.score.compareTo(a.score));
+    result.sort((RankedProduct a, RankedProduct b) =>
+        b.match.score.compareTo(a.match.score));
     return result;
   }
 }
diff --git a/packages/smooth_app/lib/data_models/product_group_query_model.dart b/packages/smooth_app/lib/data_models/product_group_query_model.dart
deleted file mode 100644
index 565c1b7e3067..000000000000
--- a/packages/smooth_app/lib/data_models/product_group_query_model.dart
+++ /dev/null
@@ -1,8 +0,0 @@
-import 'package:flutter/material.dart';
-import 'package:openfoodfacts/utils/PnnsGroups.dart';
-import 'package:smooth_app/data_models/product_keywords_search_result_model.dart';
-
-class ProductGroupQueryModel extends ProductKeywordsSearchResultModel {
-  ProductGroupQueryModel(final PnnsGroup2 group, final BuildContext context)
-      : super(group.id, context);
-}
diff --git a/packages/smooth_app/lib/data_models/product_keywords_search_result_model.dart b/packages/smooth_app/lib/data_models/product_query_model.dart
similarity index 55%
rename from packages/smooth_app/lib/data_models/product_keywords_search_result_model.dart
rename to packages/smooth_app/lib/data_models/product_query_model.dart
index ced06f659f0a..7dbe7d8bfcf6 100644
--- a/packages/smooth_app/lib/data_models/product_keywords_search_result_model.dart
+++ b/packages/smooth_app/lib/data_models/product_query_model.dart
@@ -1,43 +1,38 @@
-import 'package:flutter/foundation.dart';
-import 'package:flutter/material.dart';
 import 'package:openfoodfacts/model/Product.dart';
 import 'package:smooth_app/data_models/user_preferences_model.dart';
-import 'package:smooth_app/database/full_products_database.dart';
 import 'package:smooth_app/data_models/match.dart';
+import 'package:smooth_app/database/product_query.dart';
+import 'package:smooth_app/temp/user_preferences.dart';
 
-class ProductKeywordsSearchResultModel extends ChangeNotifier {
-  ProductKeywordsSearchResultModel(this.keywords, BuildContext context) {
-    _loadData(context);
-    scrollController.addListener(_scrollListener);
-  }
-
-  final String keywords;
-  final ScrollController scrollController = ScrollController();
+class ProductQueryModel {
+  ProductQueryModel();
 
-  List<Product> products;
+  List<Product> _products;
   List<Product> displayProducts;
-  FullProductsDatabase productsDatabase;
+  bool isNotEmpty() => _products != null && _products.isNotEmpty;
 
   Map<String, String> categories = <String, String>{};
   Map<String, int> categoriesCounter = <String, int>{};
   List<String> sortedCategories;
   String selectedCategory = 'all';
 
-  bool showTitle = true;
-
-  Future<bool> _loadData(final BuildContext context) async {
-    productsDatabase = FullProductsDatabase();
+  Future<bool> loadData(
+    final ProductQuery productQuery,
+    final UserPreferences userPreferences,
+    final UserPreferencesModel userPreferencesModel,
+  ) async {
+    if (_products != null) {
+      return true;
+    }
 
-    products = await productsDatabase.queryProductsFromKeyword(keywords);
-    final UserPreferencesModel model = UserPreferencesModel();
-    await model.loadData(context);
-    Match.sort(products, model);
+    _products = await productQuery.queryProducts();
+    Match.sort(_products, userPreferences, userPreferencesModel);
 
-    displayProducts = products;
+    displayProducts = _products;
 
     categories['all'] = 'All';
 
-    for (final Product product in products) {
+    for (final Product product in _products) {
       for (final String category in product.categoriesTags) {
         categories.putIfAbsent(category, () {
           String title = category.substring(3).replaceAll('-', ' ');
@@ -49,7 +44,6 @@ class ProductKeywordsSearchResultModel extends ChangeNotifier {
     }
 
     final List<String> tempCategories = categories.keys.toList();
-    print(tempCategories);
 
     for (final String category in tempCategories) {
       if (category != 'all') {
@@ -72,7 +66,6 @@ class ProductKeywordsSearchResultModel extends ChangeNotifier {
       return categoriesCounter[b].compareTo(categoriesCounter[a]);
     });
 
-    notifyListeners();
     return true;
   }
 
@@ -80,25 +73,11 @@ class ProductKeywordsSearchResultModel extends ChangeNotifier {
     selectedCategory = category;
 
     if (category == 'all') {
-      displayProducts = products;
+      displayProducts = _products;
     } else {
-      displayProducts = products
+      displayProducts = _products
           .where((Product product) => product.categoriesTags.contains(category))
           .toList();
     }
-
-    notifyListeners();
-  }
-
-  void _scrollListener() {
-    if (scrollController.offset <= scrollController.position.minScrollExtent &&
-        !scrollController.position.outOfRange) {
-      // Reached Top
-      showTitle = true;
-      notifyListeners();
-    } else {
-      showTitle = false;
-      notifyListeners();
-    }
   }
 }
diff --git a/packages/smooth_app/lib/data_models/profile_page_model.dart b/packages/smooth_app/lib/data_models/profile_page_model.dart
deleted file mode 100644
index 7c182133f6af..000000000000
--- a/packages/smooth_app/lib/data_models/profile_page_model.dart
+++ /dev/null
@@ -1,30 +0,0 @@
-import 'package:flutter/foundation.dart';
-import 'package:shared_preferences/shared_preferences.dart';
-
-class ProfilePageModel extends ChangeNotifier {
-  ProfilePageModel() {
-    _loadData();
-  }
-
-  Future<bool> _loadData() async {
-    sharedPreferences = await SharedPreferences.getInstance();
-    useMlKit = sharedPreferences.getBool('useMlKit') ?? false;
-    notifyListeners();
-    return true;
-  }
-
-  SharedPreferences sharedPreferences;
-
-  bool useMlKit;
-  bool initialBuild = true;
-
-  void setMlKitState(bool state) {
-    if (!initialBuild && sharedPreferences != null) {
-      sharedPreferences.setBool('useMlKit', state);
-      useMlKit = state;
-      notifyListeners();
-    } else {
-      initialBuild = false;
-    }
-  }
-}
diff --git a/packages/smooth_app/lib/data_models/smooth_it_model.dart b/packages/smooth_app/lib/data_models/smooth_it_model.dart
index 3aa65519f8b4..218abf0ee4ac 100644
--- a/packages/smooth_app/lib/data_models/smooth_it_model.dart
+++ b/packages/smooth_app/lib/data_models/smooth_it_model.dart
@@ -1,64 +1,41 @@
-import 'package:flutter/cupertino.dart';
-import 'package:flutter/foundation.dart';
-import 'package:flutter/material.dart';
 import 'package:openfoodfacts/model/Product.dart';
 import 'package:smooth_app/structures/ranked_product.dart';
 import 'package:smooth_app/data_models/user_preferences_model.dart';
 import 'package:smooth_app/data_models/match.dart';
-
-class SmoothItModel extends ChangeNotifier {
-  SmoothItModel(this.unprocessedProducts, final BuildContext context) {
-    _loadData(context);
-    scrollController.addListener(_scrollListener);
-  }
-
-  final ScrollController scrollController = ScrollController();
-  final GlobalKey<ScaffoldState> scaffoldKey = GlobalKey<ScaffoldState>();
-
-  Future<bool> _loadData(final BuildContext context) async {
-    try {
-      dataLoaded = await processProductList(context);
-      notifyListeners();
+import 'package:smooth_app/temp/user_preferences.dart';
+
+class SmoothItModel {
+  Future<bool> loadData(
+    final List<Product> unprocessedProducts,
+    final UserPreferences userPreferences,
+    final UserPreferencesModel userPreferencesModel,
+  ) async {
+    if (_loaded) {
       return true;
-    } catch (e) {
-      print('An error occurred while processing the product list : $e');
-      dataLoaded = false;
-      return false;
     }
-  }
-
-  List<Product> unprocessedProducts;
-  List<RankedProduct> products;
-
-  bool dataLoaded = false;
-
-  bool showTitle = true;
-
-  Future<bool> processProductList(final BuildContext context) async {
-    try {
-      final UserPreferencesModel model = UserPreferencesModel();
-      await model.loadData(context);
-      products = Match.sort(unprocessedProducts, model);
-      products.sort(
-          (RankedProduct a, RankedProduct b) => b.score.compareTo(a.score));
-      print('Processed products');
-      notifyListeners();
-      return true;
-    } catch (e) {
-      print(e);
-      return false;
+    final List<RankedProduct> rankedProducts =
+        Match.sort(unprocessedProducts, userPreferences, userPreferencesModel);
+    greenProducts.clear();
+    redProducts.clear();
+    whiteProducts.clear();
+    for (final RankedProduct rankedProduct in rankedProducts) {
+      final bool status = rankedProduct.match.status;
+      List<RankedProduct> target;
+      if (status == null) {
+        target = whiteProducts;
+      } else if (status) {
+        target = greenProducts;
+      } else {
+        target = redProducts;
+      }
+      target.add(rankedProduct);
     }
+    _loaded = true;
+    return true;
   }
 
-  void _scrollListener() {
-    if (scrollController.offset <= scrollController.position.minScrollExtent &&
-        !scrollController.position.outOfRange) {
-      // Reached Top
-      showTitle = true;
-      notifyListeners();
-    } else {
-      showTitle = false;
-      notifyListeners();
-    }
-  }
+  final List<RankedProduct> greenProducts = <RankedProduct>[];
+  final List<RankedProduct> redProducts = <RankedProduct>[];
+  final List<RankedProduct> whiteProducts = <RankedProduct>[];
+  bool _loaded = false;
 }
diff --git a/packages/smooth_app/lib/data_models/user_preferences_model.dart b/packages/smooth_app/lib/data_models/user_preferences_model.dart
index e9325650705f..e335020f3a6f 100644
--- a/packages/smooth_app/lib/data_models/user_preferences_model.dart
+++ b/packages/smooth_app/lib/data_models/user_preferences_model.dart
@@ -1,80 +1,83 @@
 import 'dart:convert';
+
 import 'package:flutter/material.dart';
-import 'package:flutter/cupertino.dart';
-import 'package:smooth_app/database/user_database.dart';
 import 'package:smooth_app/temp/user_preferences.dart';
+import 'package:smooth_app/temp/attribute_group.dart';
 
 class UserPreferencesModel extends ChangeNotifier {
-  UserPreferencesModel() : _userDatabase = UserDatabase();
+  UserPreferencesModel._();
 
-  UserPreferencesModel.load(final BuildContext context)
-      : _userDatabase = UserDatabase() {
-    loadData(context);
+  static Future<UserPreferencesModel> getUserPreferencesModel(
+      final BuildContext context) async {
+    final UserPreferencesModel result = UserPreferencesModel._();
+    final bool ok = await result._loadAssets(context);
+    return ok ? result : null;
   }
 
-  static final List<String> _preferencesVariables = <String>[];
-  static final Map<String, String> _preferencesVariableLabels =
-      <String, String>{};
-  static List<PreferencesValue> _preferenceValues;
-  static Map<String, int> _preferenceValuesReverse;
-  static List<PreferencesVariableGroup> _preferenceVariableGroups;
+  List<PreferencesValue> _preferenceValues;
+  Map<String, int> _preferenceValuesReverse;
+  List<AttributeGroup> _preferenceVariableGroups;
 
-  final UserDatabase _userDatabase;
-  UserPreferences _userPreferences;
-  bool _dataLoaded = false;
+  List<AttributeGroup> get preferenceVariableGroups =>
+      _preferenceVariableGroups;
 
-  bool get dataLoaded => _dataLoaded;
-  UserPreferences get userPreferences => _userPreferences;
+  bool _loadStrings(
+      final String importanceString, final String variableString) {
+    try {
+      if (!_loadJsonString(importanceString, _loadValues)) {
+        return false;
+      }
+      if (!_loadJsonString(variableString, _loadVariables)) {
+        return false;
+      }
+      notifyListeners();
+      return true;
+    } catch (e) {
+      print('An error occurred while loading user preferences : $e');
+      return false;
+    }
+  }
 
-  Future<bool> loadData(final BuildContext context) async {
+  Future<bool> _loadAssets(final BuildContext context) async {
     try {
-      final String valueString = await DefaultAssetBundle.of(context)
+      final String importanceString = await DefaultAssetBundle.of(context)
           .loadString('assets/metadata/init_preferences.json');
-      final dynamic valueJson =
-          json.decode(valueString).cast<Map<String, dynamic>>();
-      _loadValues(valueJson);
       final String variableString = await DefaultAssetBundle.of(context)
           .loadString('assets/metadata/init_attribute_groups.json');
-      final dynamic variableJson = json.decode(variableString);
-      _loadVariables(variableJson);
-      _userPreferences = await _userDatabase.getUserPreferences();
-      _dataLoaded = true;
-      notifyListeners();
-      return true;
+      return _loadStrings(importanceString, variableString);
     } catch (e) {
       print('An error occurred while loading user preferences : $e');
-      _dataLoaded = false;
       return false;
     }
   }
 
-  int getValueIndex(final String variable) =>
-      _preferenceValuesReverse[getPreferencesValue(variable).id] ??
-      UserPreferences.INDEX_NOT_IMPORTANT;
-
-  PreferencesValue getPreferencesValue(final String variable) =>
-      _preferenceValues[_userPreferences.getValue(variable)];
-
-  void setValue(final String variable, final int value) {
-    if (_dataLoaded) {
-      _userPreferences.setValue(variable, value);
-      notifyListeners();
+  bool _loadJsonString(final String inputString, final Function fromJson) {
+    try {
+      final dynamic inputJson = json.decode(inputString);
+      fromJson(inputJson);
+      return true;
+    } catch (e) {
+      print('An error occurred while loading user preferences : $e');
+      return false;
     }
   }
 
-  void saveUserPreferences() =>
-      _userDatabase.saveUserPreferences(_userPreferences);
-
-  static String getVariableName(final String variable) =>
-      _preferencesVariableLabels[variable];
-
-  String getValueName(final String variable) =>
-      _preferenceValues[_userPreferences.getValue(variable)].name;
+  int getValueIndex(
+    final String variable,
+    final UserPreferences userPreferences,
+  ) =>
+      _preferenceValuesReverse[
+          getPreferencesValue(variable, userPreferences).id] ??
+      UserPreferences.INDEX_NOT_IMPORTANT;
 
-  static List<String> getVariables() => _preferencesVariables;
+  PreferencesValue getPreferencesValue(
+    final String variable,
+    final UserPreferences userPreferences,
+  ) =>
+      _preferenceValues[userPreferences.getImportance(variable)];
 
   void _loadValues(dynamic json) {
-    _preferenceValues = (json as List)
+    _preferenceValues = (json as List<dynamic>)
         .map((dynamic item) => PreferencesValue.fromJson(item))
         .toList();
     _preferenceValuesReverse = <String, int>{};
@@ -84,19 +87,10 @@ class UserPreferencesModel extends ChangeNotifier {
     }
   }
 
-  void _loadVariables(dynamic json) {
-    _preferenceVariableGroups = (json as List)
-        .map((dynamic item) => PreferencesVariableGroup.fromJson(item))
-        .toList();
-    _preferencesVariables.clear();
-    _preferencesVariableLabels.clear();
-    for (final PreferencesVariableGroup group in _preferenceVariableGroups) {
-      for (final PreferencesVariable variable in group.list) {
-        _preferencesVariables.add(variable.id);
-        _preferencesVariableLabels[variable.id] = variable.name;
-      }
-    }
-  }
+  void _loadVariables(dynamic json) =>
+      _preferenceVariableGroups = (json as List<dynamic>)
+          .map((dynamic item) => AttributeGroup.fromJson(item))
+          .toList();
 }
 
 class PreferencesValue {
@@ -119,80 +113,3 @@ class PreferencesValue {
       'id: $id, name: $name, factor: $factor, minimalWatch: $minimalMatch'
       ')';
 }
-
-class PreferencesVariable {
-  PreferencesVariable({
-    this.id,
-    this.name,
-    this.iconUrl,
-    this.defaultF,
-    this.settingNote,
-    this.settingName,
-    this.description,
-    this.descriptionShort,
-  });
-
-  factory PreferencesVariable.fromJson(dynamic json) => PreferencesVariable(
-        id: json['id'] as String,
-        name: json['name'] as String,
-        iconUrl: json['icon_url'] as String,
-        defaultF: json['default'] as String,
-        settingNote: json['setting_note'] as String,
-        settingName: json['setting_name'] as String,
-        description: json['description'] as String,
-        descriptionShort: json['description_short'] as String,
-      );
-
-  final String id;
-  final String name;
-  final String iconUrl;
-  final String defaultF;
-  final String settingNote;
-  final String settingName;
-  final String description;
-  final String descriptionShort;
-
-  @override
-  String toString() => 'PreferencesVariable('
-      'id: $id'
-      ', name: $name'
-      ', icon_url: $iconUrl'
-      ', default: $defaultF'
-      ', settingNote: $settingNote'
-      ', settingName: $settingName'
-      ', description: $description'
-      ', description_short: $descriptionShort'
-      ')';
-}
-
-class PreferencesVariableGroup {
-  PreferencesVariableGroup({
-    this.id,
-    this.name,
-    this.warning,
-    this.list,
-  });
-
-  factory PreferencesVariableGroup.fromJson(dynamic json) {
-    final attributes = json['attributes'] as List;
-    final List<PreferencesVariable> variables = attributes
-        .map((dynamic item) => PreferencesVariable.fromJson(item))
-        .toList();
-    return PreferencesVariableGroup(
-      id: json['id'] as String,
-      name: json['name'] as String,
-      warning: json['warning'] as String,
-      list: variables,
-    );
-  }
-
-  final String id;
-  final String name;
-  final String warning;
-  final List<PreferencesVariable> list;
-
-  @override
-  String toString() => 'PreferencesVariableGroup('
-      'id: $id, name: $name, warning: $warning, list: $list'
-      ')';
-}
diff --git a/packages/smooth_app/lib/database/full_products_database.dart b/packages/smooth_app/lib/database/full_products_database.dart
index 05f674c8f0f9..76f8f2c3027e 100644
--- a/packages/smooth_app/lib/database/full_products_database.dart
+++ b/packages/smooth_app/lib/database/full_products_database.dart
@@ -42,13 +42,12 @@ class FullProductsDatabase {
     ProductField.LABELS_TAGS,
     ProductField.ENVIRONMENT_IMPACT_LEVELS,
     ProductField.CATEGORIES_TAGS,
-    ProductField.LANGUAGE
+    ProductField.LANGUAGE,
+    ProductField.ATTRIBUTE_GROUPS,
   ];
 
   Future<bool> checkAndFetchProduct(String barcode) async {
-    final Directory directory = await getApplicationDocumentsDirectory();
-    final String path = join(directory.path, 'full_products_database.db');
-    final Database database = await factory.openDatabase(path);
+    final Database database = await _getDatabase();
 
     final StoreRef<dynamic, dynamic> store = StoreRef<dynamic, dynamic>.main();
 
@@ -105,11 +104,8 @@ class FullProductsDatabase {
   }
 
   Future<bool> saveProduct(Product newProduct) async {
-    final Directory directory = await getApplicationDocumentsDirectory();
-    final String path = join(directory.path, 'full_products_database.db');
-    final Database database = await factory.openDatabase(path);
+    final Database database = await _getDatabase();
 
-    //print(newProduct.toJson());
     try {
       final StoreRef<dynamic, dynamic> store =
           StoreRef<dynamic, dynamic>.main();
@@ -121,17 +117,36 @@ class FullProductsDatabase {
     }
   }
 
-  Future<Product> getProduct(String barcode) async {
+  Future<bool> saveProducts(List<Product> products) async {
+    final Database database = await _getDatabase();
+
+    try {
+      final StoreRef<dynamic, dynamic> store =
+          StoreRef<dynamic, dynamic>.main();
+      for (final Product product in products) {
+        await store.record(product.barcode).put(database, product.toJson());
+      }
+      return true;
+    } catch (e) {
+      print('An error occurred while saving product to local database : $e');
+      return false;
+    }
+  }
+
+  Future<Database> _getDatabase() async {
     final Directory directory = await getApplicationDocumentsDirectory();
     final String path = join(directory.path, 'full_products_database.db');
-    final Database database = await factory.openDatabase(path);
+    return await factory.openDatabase(path);
+  }
+
+  Future<Product> getProduct(String barcode) async {
+    final Database database = await _getDatabase();
 
     final StoreRef<dynamic, dynamic> store = StoreRef<dynamic, dynamic>.main();
     final Map<String, dynamic> jsonProduct =
         await store.record(barcode).get(database) as Map<String, dynamic>;
 
     if (jsonProduct != null) {
-      //print(jsonProduct);
       return Product.fromJson(jsonProduct);
     }
 
diff --git a/packages/smooth_app/lib/database/group_product_query.dart b/packages/smooth_app/lib/database/group_product_query.dart
new file mode 100644
index 000000000000..ae6f5506a858
--- /dev/null
+++ b/packages/smooth_app/lib/database/group_product_query.dart
@@ -0,0 +1,26 @@
+import 'dart:async';
+
+import 'package:openfoodfacts/model/SearchResult.dart';
+import 'package:openfoodfacts/openfoodfacts.dart';
+import 'package:openfoodfacts/utils/PnnsGroupQueryConfiguration.dart';
+import 'package:openfoodfacts/utils/PnnsGroups.dart';
+import 'package:smooth_app/database/product_query.dart';
+import 'package:openfoodfacts/utils/LanguageHelper.dart';
+
+class GroupProductQuery extends ProductQuery {
+  GroupProductQuery(this.group) : super();
+
+  final PnnsGroup2 group;
+  final int page = 1;
+
+  @override
+  Future<SearchResult> runInnerQuery() async =>
+      await OpenFoodAPIClient.queryPnnsGroup(
+          ProductQuery.SMOOTH_USER,
+          PnnsGroupQueryConfiguration(
+            group,
+            fields: ProductQuery.fields,
+            page: page,
+            language: OpenFoodFactsLanguage.ENGLISH,
+          ));
+}
diff --git a/packages/smooth_app/lib/database/keywords_product_query.dart b/packages/smooth_app/lib/database/keywords_product_query.dart
new file mode 100644
index 000000000000..2a42a2c86460
--- /dev/null
+++ b/packages/smooth_app/lib/database/keywords_product_query.dart
@@ -0,0 +1,32 @@
+import 'dart:async';
+
+import 'package:smooth_app/database/product_query.dart';
+import 'package:openfoodfacts/model/parameter/TagFilter.dart';
+import 'package:openfoodfacts/openfoodfacts.dart';
+import 'package:smooth_app/database/full_products_database.dart';
+import 'package:openfoodfacts/model/SearchResult.dart';
+import 'package:openfoodfacts/utils/LanguageHelper.dart';
+
+class KeywordsProductQuery extends ProductQuery {
+  KeywordsProductQuery(this.keywords) : super();
+
+  final String keywords;
+
+  @override
+  Future<SearchResult> runInnerQuery() async =>
+      await OpenFoodAPIClient.searchProducts(
+        FullProductsDatabase.SMOOTH_USER,
+        ProductSearchQueryConfiguration(
+          fields: FullProductsDatabase.fields,
+          parametersList: <Parameter>[
+            const PageSize(size: 500),
+            TagFilter(
+              tagType: 'categories',
+              contains: true,
+              tagName: keywords,
+            )
+          ],
+          language: OpenFoodFactsLanguage.ENGLISH,
+        ),
+      );
+}
diff --git a/packages/smooth_app/lib/database/product_query.dart b/packages/smooth_app/lib/database/product_query.dart
new file mode 100644
index 000000000000..66ca3c6c07d3
--- /dev/null
+++ b/packages/smooth_app/lib/database/product_query.dart
@@ -0,0 +1,21 @@
+import 'package:openfoodfacts/model/SearchResult.dart';
+import 'package:openfoodfacts/model/Product.dart';
+import 'package:openfoodfacts/openfoodfacts.dart';
+import 'package:smooth_app/database/full_products_database.dart';
+
+abstract class ProductQuery {
+  ProductQuery();
+
+  final FullProductsDatabase database = FullProductsDatabase();
+
+  static const User SMOOTH_USER = FullProductsDatabase.SMOOTH_USER;
+  static const List<ProductField> fields = FullProductsDatabase.fields;
+
+  Future<SearchResult> runInnerQuery();
+
+  Future<List<Product>> queryProducts() async {
+    final SearchResult result = await runInnerQuery();
+    database.saveProducts(result.products);
+    return result.products;
+  }
+}
diff --git a/packages/smooth_app/lib/database/user_database.dart b/packages/smooth_app/lib/database/user_database.dart
deleted file mode 100644
index 163b47aeab1c..000000000000
--- a/packages/smooth_app/lib/database/user_database.dart
+++ /dev/null
@@ -1,54 +0,0 @@
-import 'dart:io';
-
-import 'package:path_provider/path_provider.dart';
-import 'package:sembast/sembast.dart';
-import 'package:sembast/sembast_io.dart';
-import 'package:path/path.dart';
-import 'package:smooth_app/temp/user_preferences.dart';
-
-class UserDatabase {
-  UserDatabase() {
-    factory = databaseFactoryIo;
-  }
-
-  DatabaseFactory factory;
-
-  Future<bool> saveUserPreferences(UserPreferences userPreferences) async {
-    final Directory directory = await getApplicationDocumentsDirectory();
-    final String path = join(directory.path, 'user_database.db');
-    final Database database = await factory.openDatabase(path);
-
-    try {
-      final StoreRef<dynamic, dynamic> store =
-          StoreRef<dynamic, dynamic>.main();
-      await store
-          .record('user_preferences')
-          .put(database, userPreferences.toJson());
-      return true;
-    } catch (e) {
-      print(
-          'An error occurred while saving user preferences to local database : $e');
-      return false;
-    }
-  }
-
-  Future<UserPreferences> getUserPreferences() async {
-    final Directory directory = await getApplicationDocumentsDirectory();
-    final String path = join(directory.path, 'user_database.db');
-    final Database database = await factory.openDatabase(path);
-
-    try {
-      final StoreRef<dynamic, dynamic> store =
-          StoreRef<dynamic, dynamic>.main();
-      final Map<String, dynamic> jsonUserPreferences = await store
-          .record('user_preferences')
-          .get(database) as Map<String, dynamic>;
-      return jsonUserPreferences != null
-          ? UserPreferences.filled(jsonUserPreferences)
-          : UserPreferences();
-    } catch (e) {
-      print('An error occurred while loading user preferences : $e');
-      return null;
-    }
-  }
-}
diff --git a/packages/smooth_app/lib/main.dart b/packages/smooth_app/lib/main.dart
index 627296689835..0c3a2febaf6d 100644
--- a/packages/smooth_app/lib/main.dart
+++ b/packages/smooth_app/lib/main.dart
@@ -4,6 +4,7 @@ import 'package:flutter_localizations/flutter_localizations.dart';
 import 'package:flutter_svg/flutter_svg.dart';
 import 'package:sentry/sentry.dart';
 import 'package:shared_preferences/shared_preferences.dart';
+import 'package:smooth_app/data_models/user_preferences_model.dart';
 
 import 'package:smooth_app/generated/l10n.dart';
 import 'package:smooth_app/pages/alternative_continuous_scan_page.dart';
@@ -17,27 +18,16 @@ import 'package:smooth_ui_library/navigation/models/smooth_navigation_action_mod
 import 'package:smooth_ui_library/navigation/models/smooth_navigation_layout_model.dart';
 import 'package:smooth_ui_library/navigation/models/smooth_navigation_screen_model.dart';
 import 'package:smooth_ui_library/navigation/smooth_navigation_layout.dart';
+import 'package:provider/provider.dart';
+import 'package:smooth_app/temp/user_preferences.dart';
 
 final SentryClient sentry = SentryClient(
     dsn:
         'https://22ec5d0489534b91ba455462d3736680@o241488.ingest.sentry.io/5376745');
 
-// ignore: avoid_void_async
-void main() async {
+Future<void> main() async {
   try {
-    runApp(
-      MaterialApp(
-        localizationsDelegates: const <LocalizationsDelegate<dynamic>>[
-          S.delegate,
-          GlobalMaterialLocalizations.delegate,
-          GlobalWidgetsLocalizations.delegate,
-          GlobalCupertinoLocalizations.delegate,
-        ],
-        supportedLocales: S.delegate.supportedLocales,
-        home: SmoothApp(),
-        theme: SmoothThemes.getSmoothThemeData(),
-      ),
-    );
+    runApp(MyApp());
   } catch (error, stackTrace) {
     await sentry.captureException(
       exception: error,
@@ -46,6 +36,54 @@ void main() async {
   }
 }
 
+class MyApp extends StatefulWidget {
+  // This widget is the root of your application.
+  @override
+  _MyAppState createState() => _MyAppState();
+}
+
+class _MyAppState extends State<MyApp> {
+  UserPreferences userPreferences;
+  UserPreferencesModel userPreferencesModel;
+
+  Future<void> _init(BuildContext context) async {
+    userPreferences = await UserPreferences.getUserPreferences();
+    userPreferencesModel =
+        await UserPreferencesModel.getUserPreferencesModel(context);
+  }
+
+  @override
+  Widget build(BuildContext context) {
+    return FutureBuilder<void>(
+      future: _init(context),
+      builder: (BuildContext context, AsyncSnapshot<void> snapshot) {
+        if (snapshot.connectionState == ConnectionState.done) {
+          return MultiProvider(
+            providers: <ChangeNotifierProvider<dynamic>>[
+              ChangeNotifierProvider<UserPreferences>.value(
+                  value: userPreferences),
+              ChangeNotifierProvider<UserPreferencesModel>.value(
+                  value: userPreferencesModel),
+            ],
+            child: MaterialApp(
+              localizationsDelegates: const <LocalizationsDelegate<dynamic>>[
+                S.delegate,
+                GlobalMaterialLocalizations.delegate,
+                GlobalWidgetsLocalizations.delegate,
+                GlobalCupertinoLocalizations.delegate,
+              ],
+              supportedLocales: S.delegate.supportedLocales,
+              home: SmoothApp(),
+              theme: SmoothThemes.getSmoothThemeData(),
+            ),
+          );
+        }
+        return Container(); // as simple as possible
+      },
+    );
+  }
+}
+
 class SmoothApp extends StatelessWidget {
   final double _navigationIconSize = 32.0;
   final double _navigationIconPadding = 5.0;
diff --git a/packages/smooth_app/lib/pages/choose_page.dart b/packages/smooth_app/lib/pages/choose_page.dart
index b448306a950e..7cd6256343af 100644
--- a/packages/smooth_app/lib/pages/choose_page.dart
+++ b/packages/smooth_app/lib/pages/choose_page.dart
@@ -10,8 +10,9 @@ import 'package:smooth_app/cards/category_cards/category_chip.dart';
 import 'package:smooth_app/cards/category_cards/subcategory_card.dart';
 import 'package:smooth_app/data_models/choose_page_model.dart';
 import 'package:smooth_app/database/full_products_database.dart';
-import 'package:smooth_app/pages/product_group_query_page.dart';
-import 'package:smooth_app/pages/product_keywords_search_result_page.dart';
+import 'package:smooth_app/database/keywords_product_query.dart';
+import 'package:smooth_app/database/group_product_query.dart';
+import 'package:smooth_app/pages/product_query_page.dart';
 import 'package:smooth_app/pages/product_page.dart';
 import 'package:smooth_ui_library/widgets/smooth_search_bar.dart';
 import 'package:smooth_app/generated/l10n.dart';
@@ -136,11 +137,15 @@ class ChoosePage extends StatelessWidget {
                                           context,
                                           MaterialPageRoute<dynamic>(
                                               builder: (BuildContext context) =>
-                                                  ProductKeywordsSearchResultPage(
-                                                      heroTag: 'search_bar',
-                                                      mainColor:
-                                                          Colors.deepPurple,
-                                                      keywords: value)));
+                                                  ProductQueryPage(
+                                                    productQuery:
+                                                        KeywordsProductQuery(
+                                                            value),
+                                                    heroTag: 'search_bar',
+                                                    mainColor:
+                                                        Colors.deepPurple,
+                                                    name: value,
+                                                  )));
                                     }
                                   },
                                 ),
@@ -294,22 +299,19 @@ class ChoosePage extends StatelessWidget {
                                     title: choosePageModel
                                         .selectedCategory.subGroups[index].name,
                                     color: choosePageModel.selectedColor,
-                                    onTap: () {
-                                      Navigator.push<dynamic>(
-                                          context,
-                                          MaterialPageRoute<dynamic>(
-                                              builder: (BuildContext context) =>
-                                                  ProductGroupQueryPage(
-                                                      heroTag: choosePageModel
-                                                          .selectedCategory
-                                                          .subGroups[index]
-                                                          .name,
-                                                      mainColor: choosePageModel
-                                                          .selectedColor,
-                                                      group: choosePageModel
-                                                          .selectedCategory
-                                                          .subGroups[index])));
-                                    },
+                                    onTap: () => Navigator.push<dynamic>(
+                                        context, MaterialPageRoute<dynamic>(
+                                            builder: (BuildContext context) {
+                                      final PnnsGroup2 group = choosePageModel
+                                          .selectedCategory.subGroups[index];
+                                      return ProductQueryPage(
+                                        productQuery: GroupProductQuery(group),
+                                        heroTag: group.id,
+                                        mainColor:
+                                            choosePageModel.selectedColor,
+                                        name: group.name,
+                                      );
+                                    })),
                                   )),
                                 ),
                               );
diff --git a/packages/smooth_app/lib/pages/personalized_ranking_page.dart b/packages/smooth_app/lib/pages/personalized_ranking_page.dart
index bacdec4ccfc1..bd1667732050 100644
--- a/packages/smooth_app/lib/pages/personalized_ranking_page.dart
+++ b/packages/smooth_app/lib/pages/personalized_ranking_page.dart
@@ -5,262 +5,291 @@ import 'package:provider/provider.dart';
 import 'package:smooth_app/bottom_sheet_views/user_preferences_view.dart';
 import 'package:smooth_app/cards/product_cards/smooth_product_card_found.dart';
 import 'package:smooth_app/data_models/smooth_it_model.dart';
+import 'package:smooth_app/data_models/user_preferences_model.dart';
 import 'package:smooth_app/structures/ranked_product.dart';
 import 'package:modal_bottom_sheet/modal_bottom_sheet.dart';
+import 'package:smooth_app/temp/user_preferences.dart';
 
-class PersonalizedRankingPage extends StatelessWidget {
+class PersonalizedRankingPage extends StatefulWidget {
   const PersonalizedRankingPage({@required this.input});
 
   final List<Product> input;
 
+  @override
+  _PersonalizedRankingPageState createState() =>
+      _PersonalizedRankingPageState();
+}
+
+class _PersonalizedRankingPageState extends State<PersonalizedRankingPage> {
+  final SmoothItModel _model = SmoothItModel();
+  final ScrollController _scrollController = ScrollController();
+  final GlobalKey<ScaffoldState> _scaffoldKey = GlobalKey<ScaffoldState>();
+
+  bool _showTitle = true;
+
+  @override
+  void initState() {
+    super.initState();
+    _scrollController.addListener(() {
+      if (_scrollController.offset <=
+              _scrollController.position.minScrollExtent &&
+          !_scrollController.position.outOfRange) {
+        // Reached Top
+        if (!_showTitle) {
+          setState(() => _showTitle = true);
+        }
+      } else {
+        if (_showTitle) {
+          setState(() => _showTitle = false);
+        }
+      }
+    });
+  }
+
   @override
   Widget build(BuildContext context) {
-    return ChangeNotifierProvider<SmoothItModel>(
-      create: (BuildContext context) => SmoothItModel(input, context),
-      child: Consumer<SmoothItModel>(
-        builder: (BuildContext context, SmoothItModel personalizedRankingModel,
-            Widget child) {
-          return Scaffold(
-            key: personalizedRankingModel.scaffoldKey,
-            floatingActionButton: AnimatedOpacity(
-              opacity: !personalizedRankingModel.showTitle ? 1.0 : 0.0,
-              duration: const Duration(milliseconds: 250),
-              child: FloatingActionButton(
-                heroTag: 'do_not_use_hero_animation',
-                child: const Icon(Icons.arrow_upward),
-                onPressed: () {
-                  personalizedRankingModel.scrollController.animateTo(0.0,
-                      duration: const Duration(milliseconds: 400),
-                      curve: Curves.ease);
-                },
-              ),
-            ),
-            body:
-                _buildGroupedStickyListView(context, personalizedRankingModel),
-            /*Stack(
-                children: <Widget>[
-                  Container(
-                      padding: const EdgeInsets.only(
-                          left: 10.0, right: 10.0, top: 96.0),
-                      child: Column(
-                        children: <Widget>[
-                          Container(
-                            height: 80.0,
-                            child: Row(
-                              mainAxisSize: MainAxisSize.max,
-                              mainAxisAlignment: MainAxisAlignment.center,
-                              crossAxisAlignment: CrossAxisAlignment.start,
-                              children: <Widget>[
-                                Flexible(
-                                  child: AnimatedOpacity(
-                                      opacity: personalizedRankingModel.showTitle
-                                          ? 1.0
-                                          : 0.0,
-                                      duration:
-                                          const Duration(milliseconds: 250),
-                                      child: Text('My personalized ranking',
-                                          textAlign: TextAlign.center,
-                                          style: Theme.of(context)
-                                              .textTheme
-                                              .headline1)),
-                                ),
-                              ],
-                            ),
-                          ),
-                        ],
-                      )),
-                  _buildGroupedStickyListView(context, personalizedRankingModel),
-                  AnimatedOpacity(
-                    opacity: personalizedRankingModel.showTitle ? 1.0 : 0.0,
-                    duration: const Duration(milliseconds: 250),
-                    child: Row(
-                      mainAxisSize: MainAxisSize.max,
-                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
+    final UserPreferences userPreferences = context.watch<UserPreferences>();
+    final UserPreferencesModel userPreferencesModel =
+        context.watch<UserPreferencesModel>();
+    _model.loadData(widget.input, userPreferences, userPreferencesModel);
+    return Scaffold(
+      key: _scaffoldKey,
+      floatingActionButton: AnimatedOpacity(
+        opacity: !_showTitle ? 1.0 : 0.0,
+        duration: const Duration(milliseconds: 250),
+        child: FloatingActionButton(
+          heroTag: 'do_not_use_hero_animation',
+          child: const Icon(Icons.arrow_upward),
+          onPressed: () {
+            _scrollController.animateTo(0.0,
+                duration: const Duration(milliseconds: 400),
+                curve: Curves.ease);
+          },
+        ),
+      ),
+      body: _buildGroupedStickyListView(context),
+      /*Stack(
+              children: <Widget>[
+                Container(
+                    padding: const EdgeInsets.only(
+                        left: 10.0, right: 10.0, top: 96.0),
+                    child: Column(
                       children: <Widget>[
-                        Padding(
-                          padding: const EdgeInsets.only(top: 28.0),
-                          child: IconButton(
-                            icon: const Icon(
-                              Icons.arrow_back,
-                            ),
-                            onPressed: () => Navigator.pop(context),
+                        Container(
+                          height: 80.0,
+                          child: Row(
+                            mainAxisSize: MainAxisSize.max,
+                            mainAxisAlignment: MainAxisAlignment.center,
+                            crossAxisAlignment: CrossAxisAlignment.start,
+                            children: <Widget>[
+                              Flexible(
+                                child: AnimatedOpacity(
+                                    opacity: personalizedRankingModel.showTitle
+                                        ? 1.0
+                                        : 0.0,
+                                    duration:
+                                        const Duration(milliseconds: 250),
+                                    child: Text('My personalized ranking',
+                                        textAlign: TextAlign.center,
+                                        style: Theme.of(context)
+                                            .textTheme
+                                            .headline1)),
+                              ),
+                            ],
                           ),
                         ),
-                        Padding(
-                          padding: const EdgeInsets.only(top: 28.0),
-                          child: IconButton(
-                            icon: const Icon(
-                              Icons.settings,
-                            ),
-                            onPressed: () =>
-                                showCupertinoModalBottomSheet<Widget>(
-                              expand: false,
-                              context: context,
-                              backgroundColor: Colors.transparent,
-                              bounce: true,
-                              barrierColor: Colors.black45,
-                              builder: (BuildContext context,
-                                      ScrollController scrollController) =>
-                                  UserPreferencesView(scrollController,
-                                      callback: () {
-                                personalizedRankingModel.processProductList();
-                                const SnackBar snackBar = SnackBar(
-                                  content: Text(
-                                    'Reloaded with new preferences',
-                                  ),
-                                  duration: Duration(milliseconds: 1500),
-                                );
-                                personalizedRankingModel.scaffoldKey.currentState
-                                    .showSnackBar(snackBar);
-                              }),
-                            ),
+                      ],
+                    )),
+                _buildGroupedStickyListView(context, personalizedRankingModel),
+                AnimatedOpacity(
+                  opacity: personalizedRankingModel.showTitle ? 1.0 : 0.0,
+                  duration: const Duration(milliseconds: 250),
+                  child: Row(
+                    mainAxisSize: MainAxisSize.max,
+                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                    children: <Widget>[
+                      Padding(
+                        padding: const EdgeInsets.only(top: 28.0),
+                        child: IconButton(
+                          icon: const Icon(
+                            Icons.arrow_back,
                           ),
+                          onPressed: () => Navigator.pop(context),
                         ),
-                      ],
-                    ),
+                      ),
+                      Padding(
+                        padding: const EdgeInsets.only(top: 28.0),
+                        child: IconButton(
+                          icon: const Icon(
+                            Icons.settings,
+                          ),
+                          onPressed: () =>
+                              showCupertinoModalBottomSheet<Widget>(
+                            expand: false,
+                            context: context,
+                            backgroundColor: Colors.transparent,
+                            bounce: true,
+                            barrierColor: Colors.black45,
+                            builder: (BuildContext context,
+                                    ScrollController scrollController) =>
+                                UserPreferencesView(scrollController,
+                                    callback: () {
+                              personalizedRankingModel.processProductList();
+                              const SnackBar snackBar = SnackBar(
+                                content: Text(
+                                  'Reloaded with new preferences',
+                                ),
+                                duration: Duration(milliseconds: 1500),
+                              );
+                              personalizedRankingModel.scaffoldKey.currentState
+                                  .showSnackBar(snackBar);
+                            }),
+                          ),
+                        ),
+                      ),
+                    ],
                   ),
-                ],
-              )*/
-          );
-        },
-      ),
+                ),
+              ],
+            )*/
     );
   }
 
   Widget _buildSmoothProductCard(
-      RankedProduct rankedProduct, BuildContext context) {
-    return Padding(
-      padding: const EdgeInsets.symmetric(horizontal: 12.0, vertical: 8.0),
-      child: Column(
-        children: <Widget>[
-          //Text(rankedProduct.score.toString()),
-          SmoothProductCardFound(
-                  heroTag: rankedProduct.product.barcode,
-                  product: rankedProduct.product,
-                  elevation: 4.0)
-              .build(context),
-        ],
-      ),
-    );
-  }
-
-  Widget _buildGroupedStickyListView(
-      BuildContext context, SmoothItModel personalizedRankingModel) {
-    if (!personalizedRankingModel.dataLoaded) {
-      return const Center(
-        child: CircularProgressIndicator(),
+    RankedProduct rankedProduct,
+    BuildContext context,
+    Color backgroundColor,
+  ) =>
+      Padding(
+        padding: const EdgeInsets.symmetric(horizontal: 12.0, vertical: 8.0),
+        child: Column(
+          children: <Widget>[
+            //Text(rankedProduct.score.toString()),
+            SmoothProductCardFound(
+              heroTag: rankedProduct.product.barcode,
+              product: rankedProduct.product,
+              elevation: 4.0,
+              backgroundColor: backgroundColor,
+            ).build(
+                context), // TODO(monsieurtanuki): check that "build.content" thing
+          ],
+        ),
       );
-    }
-    return AnimatedContainer(
-      duration: const Duration(milliseconds: 200),
-      padding: EdgeInsets.only(
-          top: personalizedRankingModel.showTitle
-              ? MediaQuery.of(context).size.height * 0.0
-              : 0.0),
-      child: CustomScrollView(
-        controller: personalizedRankingModel.scrollController,
-        slivers: <Widget>[
-          SliverAppBar(
-            leading: IconButton(
-              icon: const Icon(Icons.arrow_back, color: Colors.black),
-              onPressed: () => Navigator.of(context).pop(),
+
+  Widget _buildGroupedStickyListView(BuildContext context) => AnimatedContainer(
+        duration: const Duration(milliseconds: 200),
+        padding: EdgeInsets.only(
+            top: _showTitle ? MediaQuery.of(context).size.height * 0.0 : 0.0),
+        child: CustomScrollView(
+          controller: _scrollController,
+          slivers: <Widget>[
+            SliverAppBar(
+              leading: IconButton(
+                icon: const Icon(Icons.arrow_back, color: Colors.black),
+                onPressed: () => Navigator.of(context).pop(),
+              ),
+              expandedHeight: 120.0,
+              floating: true,
+              pinned: true,
+              snap: true,
+              elevation: 8,
+              backgroundColor: Theme.of(context).scaffoldBackgroundColor,
+              flexibleSpace: FlexibleSpaceBar(
+                centerTitle: true,
+                title: Text('My personalized ranking',
+                    textAlign: TextAlign.center,
+                    style: Theme.of(context)
+                        .textTheme
+                        .headline4
+                        .copyWith(color: Colors.black)),
+              ),
+              actions: <IconButton>[
+                IconButton(
+                  icon: const Icon(
+                    Icons.settings,
+                    color: Colors.black,
+                  ),
+                  onPressed: () => showCupertinoModalBottomSheet<Widget>(
+                    expand: false,
+                    context: context,
+                    backgroundColor: Colors.transparent,
+                    bounce: true,
+                    barrierColor: Colors.black45,
+                    builder: (BuildContext context,
+                            ScrollController scrollController) =>
+                        UserPreferencesView(scrollController, callback: () {
+                      // TODO(monsieurtanuki): refresh??? personalizedRankingModel.processProductList(usercontext);
+                      const SnackBar snackBar = SnackBar(
+                        content: Text(
+                          'Reloaded with new preferences',
+                        ),
+                        duration: Duration(milliseconds: 1500),
+                      );
+                      _scaffoldKey.currentState.showSnackBar(snackBar);
+                    }),
+                  ),
+                )
+              ],
             ),
-            expandedHeight: 120.0,
-            floating: true,
-            pinned: true,
-            snap: true,
-            elevation: 8,
-            backgroundColor: Theme.of(context).scaffoldBackgroundColor,
-            flexibleSpace: FlexibleSpaceBar(
-              centerTitle: true,
-              title: Text('My personalized ranking',
-                  textAlign: TextAlign.center,
+            _getStickyHeader(_model.greenProducts, 'green', Colors.green),
+            _getStickyHeader(_model.redProducts, 'red', Colors.red),
+            _getStickyHeader(_model.whiteProducts, 'white', Colors.yellow),
+          ],
+        ),
+      );
+
+  Widget _getStickyHeader(
+    final List<RankedProduct> products,
+    final String title,
+    final Color backgroundColor,
+  ) =>
+      SliverStickyHeader(
+        header: Row(
+          mainAxisSize: MainAxisSize.max,
+          mainAxisAlignment: MainAxisAlignment.center,
+          children: <Widget>[
+            Container(
+              width: MediaQuery.of(context).size.width * 0.5,
+              height: 40.0,
+              margin: const EdgeInsets.only(top: 32.0, bottom: 8.0),
+              decoration: const BoxDecoration(
+                  color: Colors.greenAccent,
+                  borderRadius: BorderRadius.all(Radius.circular(50.0))),
+              child: Center(
+                child: Text(
+                  title,
                   style: Theme.of(context)
                       .textTheme
-                      .headline4
-                      .copyWith(color: Colors.black)),
-            ),
-            actions: <IconButton>[
-              IconButton(
-                icon: const Icon(
-                  Icons.settings,
-                  color: Colors.black,
-                ),
-                onPressed: () => showCupertinoModalBottomSheet<Widget>(
-                  expand: false,
-                  context: context,
-                  backgroundColor: Colors.transparent,
-                  bounce: true,
-                  barrierColor: Colors.black45,
-                  builder: (BuildContext context,
-                          ScrollController scrollController) =>
-                      UserPreferencesView(scrollController, callback: () {
-                    personalizedRankingModel.processProductList(context);
-                    const SnackBar snackBar = SnackBar(
-                      content: Text(
-                        'Reloaded with new preferences',
-                      ),
-                      duration: Duration(milliseconds: 1500),
-                    );
-                    personalizedRankingModel.scaffoldKey.currentState
-                        .showSnackBar(snackBar);
-                  }),
+                      .headline3
+                      .copyWith(color: Colors.white),
                 ),
-              )
-            ],
-          ),
-          SliverStickyHeader(
-            header: Row(
-              mainAxisSize: MainAxisSize.max,
-              mainAxisAlignment: MainAxisAlignment.center,
-              children: <Widget>[
-                Container(
-                  width: MediaQuery.of(context).size.width * 0.5,
-                  height: 40.0,
-                  margin: const EdgeInsets.only(top: 32.0, bottom: 8.0),
-                  decoration: const BoxDecoration(
-                      color: Colors.greenAccent,
-                      borderRadius: BorderRadius.all(Radius.circular(50.0))),
-                  child: Center(
-                    child: Text(
-                        'Products', // TODO(monsieurtanuki): better text?
-                        style: Theme.of(context)
-                            .textTheme
-                            .headline3
-                            .copyWith(color: Colors.white)),
-                  ),
-                ),
-              ],
-            ),
-            sliver: SliverList(
-              delegate: SliverChildBuilderDelegate(
-                (BuildContext context, int index) =>
-                    personalizedRankingModel.products.first.product == null
-                        ? Container(
-                            height: 80.0,
-                            child: Row(
-                              mainAxisSize: MainAxisSize.max,
-                              mainAxisAlignment: MainAxisAlignment.center,
-                              children: <Widget>[
-                                Flexible(
-                                  child: Text(
-                                      'There is no product in this section',
-                                      style: Theme.of(context)
-                                          .textTheme
-                                          .subtitle1
-                                          .copyWith(color: Colors.black)),
-                                )
-                              ],
-                            ),
-                          )
-                        : _buildSmoothProductCard(
-                            personalizedRankingModel.products[index], context),
-                childCount: personalizedRankingModel.products.length,
               ),
             ),
+          ],
+        ),
+        sliver: SliverList(
+          delegate: SliverChildBuilderDelegate(
+            (BuildContext context, int index) => products.first.product == null
+                ? Container(
+                    height: 80.0,
+                    child: Row(
+                      mainAxisSize: MainAxisSize.max,
+                      mainAxisAlignment: MainAxisAlignment.center,
+                      children: <Widget>[
+                        Flexible(
+                          child: Text('There is no product in this section',
+                              style: Theme.of(context)
+                                  .textTheme
+                                  .subtitle1
+                                  .copyWith(color: Colors.black)),
+                        )
+                      ],
+                    ),
+                  )
+                : _buildSmoothProductCard(
+                    products[index], context, backgroundColor),
+            childCount: products.length,
           ),
-        ],
-      ),
-    );
-  }
+        ),
+      );
 }
diff --git a/packages/smooth_app/lib/pages/product_group_query_page.dart b/packages/smooth_app/lib/pages/product_group_query_page.dart
deleted file mode 100644
index 60b9db896c1c..000000000000
--- a/packages/smooth_app/lib/pages/product_group_query_page.dart
+++ /dev/null
@@ -1,253 +0,0 @@
-import 'package:flutter/material.dart';
-import 'package:flutter_svg/flutter_svg.dart';
-import 'package:modal_bottom_sheet/modal_bottom_sheet.dart';
-import 'package:openfoodfacts/utils/PnnsGroups.dart';
-import 'package:provider/provider.dart';
-import 'package:smooth_app/bottom_sheet_views/group_query_filter_view.dart';
-import 'package:smooth_app/cards/product_cards/smooth_product_card_found.dart';
-import 'package:smooth_app/data_models/product_group_query_model.dart';
-import 'package:smooth_app/pages/personalized_ranking_page.dart';
-import 'package:smooth_ui_library/animations/smooth_reveal_animation.dart';
-
-class ProductGroupQueryPage extends StatelessWidget {
-  const ProductGroupQueryPage(
-      {@required this.group, @required this.heroTag, @required this.mainColor});
-
-  final PnnsGroup2 group;
-  final String heroTag;
-  final Color mainColor;
-
-  @override
-  Widget build(BuildContext context) {
-    return ChangeNotifierProvider<ProductGroupQueryModel>(
-      create: (BuildContext context) => ProductGroupQueryModel(group, context),
-      child: Consumer<ProductGroupQueryModel>(
-        builder: (BuildContext context,
-            ProductGroupQueryModel productGroupQueryModel, Widget child) {
-          return Scaffold(
-              floatingActionButton: productGroupQueryModel.products != null &&
-                      productGroupQueryModel.products.isNotEmpty
-                  ? SmoothRevealAnimation(
-                      animationCurve: Curves.easeInOutBack,
-                      startOffset: const Offset(0.0, 1.0),
-                      child: Row(
-                        mainAxisSize: MainAxisSize.max,
-                        mainAxisAlignment: MainAxisAlignment.center,
-                        children: <Widget>[
-                          SizedBox(
-                            width: MediaQuery.of(context).size.width * 0.09,
-                          ),
-                          FloatingActionButton.extended(
-                            elevation: 12.0,
-                            icon: SvgPicture.asset(
-                              'assets/actions/smoothie.svg',
-                              width: 24.0,
-                              height: 24.0,
-                              color: mainColor,
-                            ),
-                            label: Text(
-                              'My personalized ranking',
-                              style: TextStyle(color: mainColor),
-                            ),
-                            backgroundColor: Colors.white,
-                            onPressed: () {
-                              Navigator.push<dynamic>(
-                                context,
-                                MaterialPageRoute<dynamic>(
-                                    builder: (BuildContext context) =>
-                                        PersonalizedRankingPage(
-                                          input: productGroupQueryModel
-                                              .displayProducts,
-                                        )),
-                              );
-                            },
-                          ),
-                        ],
-                      ),
-                    )
-                  : null,
-              body: Stack(
-                children: <Widget>[
-                  Hero(
-                    tag: heroTag,
-                    child: Container(
-                        width: MediaQuery.of(context).size.width,
-                        height: MediaQuery.of(context).size.height,
-                        decoration: BoxDecoration(
-                          color: mainColor.withAlpha(32),
-                          borderRadius: const BorderRadius.only(
-                              bottomLeft: Radius.circular(20.0),
-                              bottomRight: Radius.circular(20.0)),
-                        ),
-                        padding: const EdgeInsets.only(
-                            left: 10.0, right: 10.0, top: 96.0),
-                        child: Column(
-                          children: <Widget>[
-                            Container(
-                              height: 80.0,
-                              child: Row(
-                                mainAxisSize: MainAxisSize.max,
-                                mainAxisAlignment: MainAxisAlignment.center,
-                                crossAxisAlignment: CrossAxisAlignment.start,
-                                children: <Widget>[
-                                  Flexible(
-                                    child: AnimatedOpacity(
-                                        opacity:
-                                            productGroupQueryModel.showTitle
-                                                ? 1.0
-                                                : 0.0,
-                                        duration:
-                                            const Duration(milliseconds: 250),
-                                        child: Text(group.name,
-                                            textAlign: TextAlign.center,
-                                            style: Theme.of(context)
-                                                .textTheme
-                                                .headline1
-                                                .copyWith(color: mainColor))),
-                                  ),
-                                ],
-                              ),
-                            ),
-                          ],
-                        )),
-                  ),
-                  if (productGroupQueryModel.products != null)
-                    if (productGroupQueryModel.products.isNotEmpty)
-                      ListView.builder(
-                        itemCount:
-                            productGroupQueryModel.displayProducts.length,
-                        itemBuilder: (BuildContext context, int index) {
-                          return Padding(
-                            padding: const EdgeInsets.symmetric(
-                                horizontal: 12.0, vertical: 8.0),
-                            child: SmoothProductCardFound(
-                                    heroTag: productGroupQueryModel
-                                        .displayProducts[index].barcode,
-                                    product: productGroupQueryModel
-                                        .displayProducts[index],
-                                    elevation: 4.0)
-                                .build(context),
-                          );
-                        },
-                        padding: EdgeInsets.only(
-                            top: MediaQuery.of(context).size.height * 0.25,
-                            bottom: 80.0),
-                        controller: productGroupQueryModel.scrollController,
-                      )
-                    else
-                      Center(
-                        child: Row(
-                          mainAxisSize: MainAxisSize.max,
-                          mainAxisAlignment: MainAxisAlignment.center,
-                          children: <Widget>[
-                            Flexible(
-                              child: Text('No product found in this category',
-                                  textAlign: TextAlign.center,
-                                  style: Theme.of(context)
-                                      .textTheme
-                                      .subtitle1
-                                      .copyWith(
-                                          color: mainColor, fontSize: 18.0)),
-                            ),
-                          ],
-                        ),
-                      )
-                  else
-                    Center(
-                      child: Container(
-                        child: CircularProgressIndicator(
-                          valueColor: AlwaysStoppedAnimation<Color>(mainColor),
-                        ),
-                      ),
-                    ),
-                  AnimatedOpacity(
-                    opacity: productGroupQueryModel.showTitle ? 1.0 : 0.0,
-                    duration: const Duration(milliseconds: 250),
-                    child: Row(
-                      mainAxisSize: MainAxisSize.max,
-                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
-                      children: <Widget>[
-                        Padding(
-                          padding: const EdgeInsets.only(top: 28.0),
-                          child: IconButton(
-                            icon: Icon(
-                              Icons.arrow_back,
-                              color: mainColor,
-                            ),
-                            onPressed: () => Navigator.pop(context),
-                          ),
-                        ),
-                        if (productGroupQueryModel.products != null)
-                          if (productGroupQueryModel.products.isNotEmpty)
-                            Padding(
-                              padding: const EdgeInsets.only(top: 24.0),
-                              child: FlatButton.icon(
-                                icon: Icon(
-                                  Icons.filter_list,
-                                  color: mainColor,
-                                ),
-                                label: const Text('Filter'),
-                                textColor: mainColor,
-                                onPressed: () {
-                                  showCupertinoModalBottomSheet<Widget>(
-                                    expand: false,
-                                    context: context,
-                                    backgroundColor: Colors.transparent,
-                                    bounce: true,
-                                    barrierColor: Colors.black45,
-                                    builder: (BuildContext context,
-                                            ScrollController
-                                                scrollController) =>
-                                        GroupQueryFilterView(
-                                      categories:
-                                          productGroupQueryModel.categories,
-                                      categoriesList: productGroupQueryModel
-                                          .sortedCategories,
-                                      callback:
-                                          productGroupQueryModel.selectCategory,
-                                    ),
-                                  );
-                                },
-                              ),
-                            ),
-                        /*Container(
-                              margin:
-                                  const EdgeInsets.only(top: 28.0, right: 8.0),
-                              padding: const EdgeInsets.only(left: 10.0),
-                              width: MediaQuery.of(context).size.width * 0.75,
-                              decoration: const BoxDecoration(
-                                color: Colors.white30,
-                                borderRadius: BorderRadius.all(Radius.circular(12.0))
-                              ),
-                              child: DropdownButton<String>(
-                                items: productGroupQueryModel.sortedCategories
-                                    .map((String key) {
-                                  return DropdownMenuItem<String>(
-                                    value: key,
-                                    child: Container(
-                                      width: MediaQuery.of(context).size.width * 0.65,
-                                      child: Text(productGroupQueryModel.categories[key] ?? 'error', style: Theme.of(context)
-                                          .textTheme
-                                          .bodyText1
-                                          .copyWith(
-                                          color: mainColor, fontSize: 12.0)),
-                                    ),
-                                  );
-                                }).toList(),
-                                value: productGroupQueryModel.selectedCategory,
-                                onChanged: (String value) => productGroupQueryModel.selectCategory(value),
-                                icon: Icon(Icons.arrow_drop_down, color: mainColor,),
-                                underline: Container(),
-                              ),
-                            ),*/
-                      ],
-                    ),
-                  ),
-                ],
-              ));
-          /**/
-        },
-      ),
-    );
-  }
-}
diff --git a/packages/smooth_app/lib/pages/product_keywords_search_result_page.dart b/packages/smooth_app/lib/pages/product_keywords_search_result_page.dart
deleted file mode 100644
index 3098b6631db5..000000000000
--- a/packages/smooth_app/lib/pages/product_keywords_search_result_page.dart
+++ /dev/null
@@ -1,264 +0,0 @@
-import 'package:flutter/material.dart';
-import 'package:flutter_svg/flutter_svg.dart';
-import 'package:modal_bottom_sheet/modal_bottom_sheet.dart';
-import 'package:provider/provider.dart';
-import 'package:smooth_app/bottom_sheet_views/group_query_filter_view.dart';
-import 'package:smooth_app/cards/product_cards/smooth_product_card_found.dart';
-import 'package:smooth_app/data_models/product_keywords_search_result_model.dart';
-import 'package:smooth_app/pages/personalized_ranking_page.dart';
-import 'package:smooth_ui_library/animations/smooth_reveal_animation.dart';
-
-class ProductKeywordsSearchResultPage extends StatelessWidget {
-  const ProductKeywordsSearchResultPage(
-      {@required this.keywords,
-      @required this.heroTag,
-      @required this.mainColor});
-
-  final String keywords;
-  final String heroTag;
-  final Color mainColor;
-
-  @override
-  Widget build(BuildContext context) {
-    return ChangeNotifierProvider<ProductKeywordsSearchResultModel>(
-      create: (BuildContext context) =>
-          ProductKeywordsSearchResultModel(keywords, context),
-      child: Consumer<ProductKeywordsSearchResultModel>(
-        builder: (BuildContext context,
-            ProductKeywordsSearchResultModel productKeywordsSearchResultModel,
-            Widget child) {
-          return Scaffold(
-              floatingActionButton:
-                  productKeywordsSearchResultModel.products != null &&
-                          productKeywordsSearchResultModel.products.isNotEmpty
-                      ? SmoothRevealAnimation(
-                          animationCurve: Curves.easeInOutBack,
-                          startOffset: const Offset(0.0, 1.0),
-                          child: Row(
-                            mainAxisSize: MainAxisSize.max,
-                            mainAxisAlignment: MainAxisAlignment.center,
-                            children: <Widget>[
-                              SizedBox(
-                                width: MediaQuery.of(context).size.width * 0.09,
-                              ),
-                              FloatingActionButton.extended(
-                                elevation: 12.0,
-                                icon: SvgPicture.asset(
-                                  'assets/actions/smoothie.svg',
-                                  width: 24.0,
-                                  height: 24.0,
-                                  color: mainColor,
-                                ),
-                                label: Text(
-                                  'My personalized ranking',
-                                  style: TextStyle(color: mainColor),
-                                ),
-                                backgroundColor: Colors.white,
-                                onPressed: () {
-                                  Navigator.push<dynamic>(
-                                    context,
-                                    MaterialPageRoute<dynamic>(
-                                        builder: (BuildContext context) =>
-                                            PersonalizedRankingPage(
-                                              input:
-                                                  productKeywordsSearchResultModel
-                                                      .displayProducts,
-                                            )),
-                                  );
-                                },
-                              ),
-                            ],
-                          ),
-                        )
-                      : null,
-              body: Stack(
-                children: <Widget>[
-                  Hero(
-                    tag: heroTag,
-                    child: Container(
-                        width: MediaQuery.of(context).size.width,
-                        height: MediaQuery.of(context).size.height,
-                        decoration: BoxDecoration(
-                          color: mainColor.withAlpha(32),
-                          borderRadius: const BorderRadius.only(
-                              bottomLeft: Radius.circular(20.0),
-                              bottomRight: Radius.circular(20.0)),
-                        ),
-                        padding: const EdgeInsets.only(
-                            left: 10.0, right: 10.0, top: 96.0),
-                        child: Column(
-                          children: <Widget>[
-                            Container(
-                              height: 80.0,
-                              child: Row(
-                                mainAxisSize: MainAxisSize.max,
-                                mainAxisAlignment: MainAxisAlignment.center,
-                                crossAxisAlignment: CrossAxisAlignment.start,
-                                children: <Widget>[
-                                  Flexible(
-                                    child: AnimatedOpacity(
-                                        opacity:
-                                            productKeywordsSearchResultModel
-                                                    .showTitle
-                                                ? 1.0
-                                                : 0.0,
-                                        duration:
-                                            const Duration(milliseconds: 250),
-                                        child: Text(keywords,
-                                            textAlign: TextAlign.center,
-                                            style: Theme.of(context)
-                                                .textTheme
-                                                .headline1
-                                                .copyWith(color: mainColor))),
-                                  ),
-                                ],
-                              ),
-                            ),
-                          ],
-                        )),
-                  ),
-                  if (productKeywordsSearchResultModel.products != null)
-                    if (productKeywordsSearchResultModel.products.isNotEmpty)
-                      ListView.builder(
-                        itemCount: productKeywordsSearchResultModel
-                            .displayProducts.length,
-                        itemBuilder: (BuildContext context, int index) {
-                          return Padding(
-                            padding: const EdgeInsets.symmetric(
-                                horizontal: 12.0, vertical: 8.0),
-                            child: SmoothProductCardFound(
-                                    heroTag: productKeywordsSearchResultModel
-                                        .displayProducts[index].barcode,
-                                    product: productKeywordsSearchResultModel
-                                        .displayProducts[index],
-                                    elevation: 4.0)
-                                .build(context),
-                          );
-                        },
-                        padding: EdgeInsets.only(
-                            top: MediaQuery.of(context).size.height * 0.25,
-                            bottom: 80.0),
-                        controller:
-                            productKeywordsSearchResultModel.scrollController,
-                      )
-                    else
-                      Center(
-                        child: Row(
-                          mainAxisSize: MainAxisSize.max,
-                          mainAxisAlignment: MainAxisAlignment.center,
-                          children: <Widget>[
-                            Flexible(
-                              child: Text('No product found in this category',
-                                  textAlign: TextAlign.center,
-                                  style: Theme.of(context)
-                                      .textTheme
-                                      .subtitle1
-                                      .copyWith(
-                                          color: mainColor, fontSize: 18.0)),
-                            ),
-                          ],
-                        ),
-                      )
-                  else
-                    Center(
-                      child: Container(
-                        child: CircularProgressIndicator(
-                          valueColor: AlwaysStoppedAnimation<Color>(mainColor),
-                        ),
-                      ),
-                    ),
-                  AnimatedOpacity(
-                    opacity:
-                        productKeywordsSearchResultModel.showTitle ? 1.0 : 0.0,
-                    duration: const Duration(milliseconds: 250),
-                    child: Row(
-                      mainAxisSize: MainAxisSize.max,
-                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
-                      children: <Widget>[
-                        Padding(
-                          padding: const EdgeInsets.only(top: 28.0),
-                          child: IconButton(
-                            icon: Icon(
-                              Icons.arrow_back,
-                              color: mainColor,
-                            ),
-                            onPressed: () => Navigator.pop(context),
-                          ),
-                        ),
-                        if (productKeywordsSearchResultModel.products != null)
-                          if (productKeywordsSearchResultModel
-                              .products.isNotEmpty)
-                            Padding(
-                              padding: const EdgeInsets.only(top: 24.0),
-                              child: FlatButton.icon(
-                                icon: Icon(
-                                  Icons.filter_list,
-                                  color: mainColor,
-                                ),
-                                label: const Text('Filter'),
-                                textColor: mainColor,
-                                onPressed: () {
-                                  showCupertinoModalBottomSheet<Widget>(
-                                    expand: false,
-                                    context: context,
-                                    backgroundColor: Colors.transparent,
-                                    bounce: true,
-                                    barrierColor: Colors.black45,
-                                    builder: (BuildContext context,
-                                            ScrollController
-                                                scrollController) =>
-                                        GroupQueryFilterView(
-                                      categories:
-                                          productKeywordsSearchResultModel
-                                              .categories,
-                                      categoriesList:
-                                          productKeywordsSearchResultModel
-                                              .sortedCategories,
-                                      callback: productKeywordsSearchResultModel
-                                          .selectCategory,
-                                    ),
-                                  );
-                                },
-                              ),
-                            ),
-                        /*Container(
-                              margin:
-                                  const EdgeInsets.only(top: 28.0, right: 8.0),
-                              padding: const EdgeInsets.only(left: 10.0),
-                              width: MediaQuery.of(context).size.width * 0.75,
-                              decoration: const BoxDecoration(
-                                color: Colors.white30,
-                                borderRadius: BorderRadius.all(Radius.circular(12.0))
-                              ),
-                              child: DropdownButton<String>(
-                                items: productGroupQueryModel.sortedCategories
-                                    .map((String key) {
-                                  return DropdownMenuItem<String>(
-                                    value: key,
-                                    child: Container(
-                                      width: MediaQuery.of(context).size.width * 0.65,
-                                      child: Text(productGroupQueryModel.categories[key] ?? 'error', style: Theme.of(context)
-                                          .textTheme
-                                          .bodyText1
-                                          .copyWith(
-                                          color: mainColor, fontSize: 12.0)),
-                                    ),
-                                  );
-                                }).toList(),
-                                value: productGroupQueryModel.selectedCategory,
-                                onChanged: (String value) => productGroupQueryModel.selectCategory(value),
-                                icon: Icon(Icons.arrow_drop_down, color: mainColor,),
-                                underline: Container(),
-                              ),
-                            ),*/
-                      ],
-                    ),
-                  ),
-                ],
-              ));
-          /**/
-        },
-      ),
-    );
-  }
-}
diff --git a/packages/smooth_app/lib/pages/product_query_page.dart b/packages/smooth_app/lib/pages/product_query_page.dart
new file mode 100644
index 000000000000..3d37ca911d9c
--- /dev/null
+++ b/packages/smooth_app/lib/pages/product_query_page.dart
@@ -0,0 +1,342 @@
+import 'package:flutter/material.dart';
+import 'package:modal_bottom_sheet/modal_bottom_sheet.dart';
+import 'package:provider/provider.dart';
+import 'package:smooth_app/bottom_sheet_views/group_query_filter_view.dart';
+import 'package:smooth_app/database/product_query.dart';
+import 'package:smooth_app/temp/user_preferences.dart';
+import 'package:smooth_app/data_models/user_preferences_model.dart';
+import 'package:smooth_app/data_models/product_query_model.dart';
+import 'package:flutter_svg/flutter_svg.dart';
+import 'package:smooth_app/cards/product_cards/smooth_product_card_found.dart';
+import 'package:smooth_app/pages/personalized_ranking_page.dart';
+import 'package:smooth_ui_library/animations/smooth_reveal_animation.dart';
+import 'package:openfoodfacts/model/Product.dart';
+
+class ProductQueryPage extends StatefulWidget {
+  const ProductQueryPage({
+    @required this.productQuery,
+    @required this.heroTag,
+    @required this.mainColor,
+    @required this.name,
+  });
+
+  final ProductQuery productQuery;
+  final String heroTag;
+  final Color mainColor;
+  final String name;
+
+  @override
+  _ProductQueryPageState createState() => _ProductQueryPageState();
+}
+
+class _ProductQueryPageState extends State<ProductQueryPage> {
+  final ProductQueryModel _model = ProductQueryModel();
+  final ScrollController _scrollController = ScrollController();
+  bool _showTitle = true;
+
+  @override
+  void initState() {
+    super.initState();
+    _scrollController.addListener(() {
+      if (_scrollController.offset <=
+              _scrollController.position.minScrollExtent &&
+          !_scrollController.position.outOfRange) {
+        // Reached Top
+        if (!_showTitle) {
+          setState(() => _showTitle = true);
+        }
+      } else {
+        if (_showTitle) {
+          setState(() => _showTitle = false);
+        }
+      }
+    });
+  }
+
+  @override
+  Widget build(BuildContext context) {
+    final UserPreferences userPreferences = context.watch<UserPreferences>();
+    final UserPreferencesModel userPreferencesModel =
+        context.watch<UserPreferencesModel>();
+    final Size screenSize = MediaQuery.of(context).size;
+    final ThemeData themeData = Theme.of(context);
+    return FutureBuilder<bool>(
+        future: _model.loadData(
+          widget.productQuery,
+          userPreferences,
+          userPreferencesModel,
+        ),
+        builder: (BuildContext context, AsyncSnapshot<bool> snapshot) {
+          if (snapshot.hasData) {
+            return Scaffold(
+                floatingActionButton: _model.isNotEmpty()
+                    ? _getFAB(
+                        screenSize,
+                        context,
+                        _model.displayProducts,
+                        widget.mainColor,
+                      )
+                    : null,
+                body: Stack(
+                  children: <Widget>[
+                    _innerGetHero(screenSize, themeData),
+                    _getList(_model, screenSize, themeData, widget.mainColor),
+                    AnimatedOpacity(
+                      opacity: _showTitle ? 1.0 : 0.0,
+                      duration: const Duration(milliseconds: 250),
+                      child: Row(
+                        mainAxisSize: MainAxisSize.max,
+                        mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                        children: <Widget>[
+                          Padding(
+                            padding: const EdgeInsets.only(top: 28.0),
+                            child: IconButton(
+                              icon: Icon(
+                                Icons.arrow_back,
+                                color: widget.mainColor,
+                              ),
+                              onPressed: () => Navigator.pop(context),
+                            ),
+                          ),
+                          if (_model.isNotEmpty())
+                            Padding(
+                              padding: const EdgeInsets.only(top: 24.0),
+                              child: FlatButton.icon(
+                                icon: Icon(
+                                  Icons.filter_list,
+                                  color: widget.mainColor,
+                                ),
+                                label: const Text('Filter'),
+                                textColor: widget.mainColor,
+                                onPressed: () {
+                                  showCupertinoModalBottomSheet<Widget>(
+                                    expand: false,
+                                    context: context,
+                                    backgroundColor: Colors.transparent,
+                                    bounce: true,
+                                    barrierColor: Colors.black45,
+                                    builder: (BuildContext context,
+                                            ScrollController
+                                                scrollController) =>
+                                        GroupQueryFilterView(
+                                      categories: _model.categories,
+                                      categoriesList: _model.sortedCategories,
+                                      callback: (String category) {
+                                        _model.selectCategory(category);
+                                        setState(() {});
+                                      },
+                                    ),
+                                  );
+                                },
+                              ),
+                            ),
+                          /*Container(
+                              margin:
+                                  const EdgeInsets.only(top: 28.0, right: 8.0),
+                              padding: const EdgeInsets.only(left: 10.0),
+                              width: screenSize.width * 0.75,
+                              decoration: const BoxDecoration(
+                                color: Colors.white30,
+                                borderRadius: BorderRadius.all(Radius.circular(12.0))
+                              ),
+                              child: DropdownButton<String>(
+                                items: productGroupQueryModel.sortedCategories
+                                    .map((String key) {
+                                  return DropdownMenuItem<String>(
+                                    value: key,
+                                    child: Container(
+                                      width: screenSize.width * 0.65,
+                                      child: Text(productGroupQueryModel.categories[key] ?? 'error', style: Theme.of(context)
+                                          .textTheme
+                                          .bodyText1
+                                          .copyWith(
+                                          color: mainColor, fontSize: 12.0)),
+                                    ),
+                                  );
+                                }).toList(),
+                                value: productGroupQueryModel.selectedCategory,
+                                onChanged: (String value) => productGroupQueryModel.selectCategory(value),
+                                icon: Icon(Icons.arrow_drop_down, color: mainColor,),
+                                underline: Container(),
+                              ),
+                            ),*/
+                        ],
+                      ),
+                    ),
+                  ],
+                ));
+          }
+          return Scaffold(
+              floatingActionButton: null,
+              body: Stack(
+                children: <Widget>[
+                  _innerGetHero(screenSize, themeData),
+                  Center(
+                    child: Container(
+                      child: CircularProgressIndicator(
+                        valueColor:
+                            AlwaysStoppedAnimation<Color>(widget.mainColor),
+                      ),
+                    ),
+                  ),
+                  AnimatedOpacity(
+                    opacity: _showTitle ? 1.0 : 0.0,
+                    duration: const Duration(milliseconds: 250),
+                    child: Row(
+                      mainAxisSize: MainAxisSize.max,
+                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                      children: <Widget>[
+                        Padding(
+                          padding: const EdgeInsets.only(top: 28.0),
+                          child: IconButton(
+                            icon: Icon(
+                              Icons.arrow_back,
+                              color: widget.mainColor,
+                            ),
+                            onPressed: () => Navigator.pop(context),
+                          ),
+                        ),
+                      ],
+                    ),
+                  ),
+                ],
+              ));
+        });
+  }
+
+  Widget _innerGetHero(final Size screenSize, final ThemeData themeData) =>
+      _getHero(
+        screenSize,
+        themeData,
+        _showTitle,
+        widget.heroTag,
+        widget.name,
+        widget.mainColor,
+      );
+
+  Widget _getFAB(
+    final Size screenSize,
+    final BuildContext context,
+    final List<Product> products,
+    final Color color,
+  ) =>
+      SmoothRevealAnimation(
+        animationCurve: Curves.easeInOutBack,
+        startOffset: const Offset(0.0, 1.0),
+        child: Row(
+          mainAxisSize: MainAxisSize.max,
+          mainAxisAlignment: MainAxisAlignment.center,
+          children: <Widget>[
+            SizedBox(
+              width: screenSize.width * 0.09,
+            ),
+            FloatingActionButton.extended(
+              elevation: 12.0,
+              icon: SvgPicture.asset(
+                'assets/actions/smoothie.svg',
+                width: 24.0,
+                height: 24.0,
+                color: color,
+              ),
+              label: Text(
+                'My personalized ranking',
+                style: TextStyle(color: color),
+              ),
+              backgroundColor: Colors.white,
+              onPressed: () {
+                Navigator.push<dynamic>(
+                  context,
+                  MaterialPageRoute<dynamic>(
+                      builder: (BuildContext context) =>
+                          PersonalizedRankingPage(input: products)),
+                );
+              },
+            ),
+          ],
+        ),
+      );
+
+  Widget _getList(
+    final ProductQueryModel model,
+    final Size screenSize,
+    final ThemeData themeData,
+    final Color color,
+  ) =>
+      _model.isNotEmpty()
+          ? ListView.builder(
+              itemCount: model.displayProducts.length,
+              itemBuilder: (BuildContext context, int index) {
+                return Padding(
+                  padding: const EdgeInsets.symmetric(
+                      horizontal: 12.0, vertical: 8.0),
+                  child: SmoothProductCardFound(
+                          heroTag: model.displayProducts[index].barcode,
+                          product: model.displayProducts[index],
+                          elevation: 4.0)
+                      .build(context),
+                );
+              },
+              padding:
+                  EdgeInsets.only(top: screenSize.height * 0.25, bottom: 80.0),
+              controller: _scrollController,
+            )
+          : Center(
+              child: Row(
+                mainAxisSize: MainAxisSize.max,
+                mainAxisAlignment: MainAxisAlignment.center,
+                children: <Widget>[
+                  Flexible(
+                    child: Text('No product found in this category',
+                        textAlign: TextAlign.center,
+                        style: themeData.textTheme.subtitle1
+                            .copyWith(color: color, fontSize: 18.0)),
+                  ),
+                ],
+              ),
+            );
+
+  Widget _getHero(
+    final Size screenSize,
+    final ThemeData themeData,
+    final bool showTitle,
+    final String heroTag,
+    final String keywords,
+    final Color color,
+  ) =>
+      Hero(
+        tag: heroTag,
+        child: Container(
+            width: screenSize.width,
+            height: screenSize.height,
+            decoration: BoxDecoration(
+              color: color.withAlpha(32),
+              borderRadius: const BorderRadius.only(
+                  bottomLeft: Radius.circular(20.0),
+                  bottomRight: Radius.circular(20.0)),
+            ),
+            padding: const EdgeInsets.only(left: 10.0, right: 10.0, top: 96.0),
+            child: Column(
+              children: <Widget>[
+                Container(
+                  height: 80.0,
+                  child: Row(
+                    mainAxisSize: MainAxisSize.max,
+                    mainAxisAlignment: MainAxisAlignment.center,
+                    crossAxisAlignment: CrossAxisAlignment.start,
+                    children: <Widget>[
+                      Flexible(
+                        child: AnimatedOpacity(
+                            opacity: showTitle ? 1.0 : 0.0,
+                            duration: const Duration(milliseconds: 250),
+                            child: Text(keywords,
+                                textAlign: TextAlign.center,
+                                style: themeData.textTheme.headline1
+                                    .copyWith(color: color))),
+                      ),
+                    ],
+                  ),
+                ),
+              ],
+            )),
+      );
+}
diff --git a/packages/smooth_app/lib/pages/profile_page.dart b/packages/smooth_app/lib/pages/profile_page.dart
index 6e51c3a90693..adebee4eb4d3 100644
--- a/packages/smooth_app/lib/pages/profile_page.dart
+++ b/packages/smooth_app/lib/pages/profile_page.dart
@@ -3,37 +3,71 @@ import 'package:flutter_svg/svg.dart';
 import 'package:modal_bottom_sheet/modal_bottom_sheet.dart';
 import 'package:provider/provider.dart';
 import 'package:smooth_app/bottom_sheet_views/user_preferences_view.dart';
-import 'package:smooth_app/data_models/profile_page_model.dart';
 import 'package:smooth_app/generated/l10n.dart';
+import 'package:smooth_app/temp/user_preferences.dart';
 import 'package:smooth_ui_library/widgets/smooth_toggle.dart';
 
 class ProfilePage extends StatelessWidget {
   @override
   Widget build(BuildContext context) {
+    final UserPreferences userPreferences = context.watch<UserPreferences>();
     return Scaffold(
-      body: ChangeNotifierProvider<ProfilePageModel>(
-        create: (BuildContext context) => ProfilePageModel(),
-        child: Column(
-          children: <Widget>[
-            Padding(
-              padding: const EdgeInsets.only(
-                  top: 46.0, right: 16.0, left: 16.0, bottom: 4.0),
-              child: Row(
-                children: <Widget>[
-                  Flexible(
-                    child: Text(
-                      S.of(context).testerSettingTitle,
-                      style: Theme.of(context).textTheme.headline1,
-                      textAlign: TextAlign.start,
-                    ),
+      body: Column(
+        children: <Widget>[
+          Padding(
+            padding: const EdgeInsets.only(
+                top: 46.0, right: 16.0, left: 16.0, bottom: 4.0),
+            child: Row(
+              children: <Widget>[
+                Flexible(
+                  child: Text(
+                    S.of(context).testerSettingTitle,
+                    style: Theme.of(context).textTheme.headline1,
+                    textAlign: TextAlign.start,
                   ),
-                ],
-              ),
+                ),
+              ],
             ),
-            const SizedBox(
-              height: 10.0,
+          ),
+          const SizedBox(
+            height: 10.0,
+          ),
+          Container(
+            height: 60.0,
+            padding:
+                const EdgeInsets.symmetric(vertical: 5.0, horizontal: 10.0),
+            margin: const EdgeInsets.all(10.0),
+            decoration: BoxDecoration(
+                color: Colors.black.withAlpha(5),
+                borderRadius: const BorderRadius.all(Radius.circular(20.0))),
+            child: Row(
+              mainAxisSize: MainAxisSize.max,
+              mainAxisAlignment: MainAxisAlignment.spaceBetween,
+              children: <Widget>[
+                Text(S.of(context).useMLKitText),
+                SmoothToggle(
+                    value: userPreferences.getMlKitState(),
+                    width: 80.0,
+                    height: 38.0,
+                    textLeft: S.of(context).yes,
+                    textRight: S.of(context).no,
+                    onChanged: (bool newValue) async =>
+                        userPreferences.setMlKitState(newValue)),
+              ],
             ),
-            Container(
+          ),
+          GestureDetector(
+            onTap: () => showCupertinoModalBottomSheet<Widget>(
+              expand: false,
+              context: context,
+              backgroundColor: Colors.transparent,
+              bounce: true,
+              barrierColor: Colors.black45,
+              builder:
+                  (BuildContext context, ScrollController scrollController) =>
+                      UserPreferencesView(scrollController),
+            ),
+            child: Container(
               height: 60.0,
               padding:
                   const EdgeInsets.symmetric(vertical: 5.0, horizontal: 10.0),
@@ -45,64 +79,16 @@ class ProfilePage extends StatelessWidget {
                 mainAxisSize: MainAxisSize.max,
                 mainAxisAlignment: MainAxisAlignment.spaceBetween,
                 children: <Widget>[
-                  Text(S.of(context).useMLKitText),
-                  Consumer<ProfilePageModel>(
-                    builder: (BuildContext context,
-                        ProfilePageModel profilePageModel, Widget child) {
-                      if (profilePageModel.useMlKit != null) {
-                        return SmoothToggle(
-                          value: profilePageModel.useMlKit,
-                          width: 80.0,
-                          height: 38.0,
-                          textLeft: S.of(context).yes,
-                          textRight: S.of(context).no,
-                          onChanged: (bool newValue) {
-                            profilePageModel.setMlKitState(newValue);
-                          },
-                        );
-                      } else {
-                        return Container();
-                      }
-                    },
+                  Text(S.of(context).configurePreferences),
+                  SvgPicture.asset(
+                    'assets/misc/right_arrow.svg',
+                    color: Colors.black,
                   ),
                 ],
               ),
             ),
-            GestureDetector(
-              onTap: () => showCupertinoModalBottomSheet<Widget>(
-                expand: false,
-                context: context,
-                backgroundColor: Colors.transparent,
-                bounce: true,
-                barrierColor: Colors.black45,
-                builder:
-                    (BuildContext context, ScrollController scrollController) =>
-                        UserPreferencesView(scrollController),
-              ),
-              child: Container(
-                height: 60.0,
-                padding:
-                    const EdgeInsets.symmetric(vertical: 5.0, horizontal: 10.0),
-                margin: const EdgeInsets.all(10.0),
-                decoration: BoxDecoration(
-                    color: Colors.black.withAlpha(5),
-                    borderRadius:
-                        const BorderRadius.all(Radius.circular(20.0))),
-                child: Row(
-                  mainAxisSize: MainAxisSize.max,
-                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
-                  children: <Widget>[
-                    Text(S.of(context).configurePreferences),
-                    SvgPicture.asset(
-                      'assets/misc/right_arrow.svg',
-                      color: Colors.black,
-                    ),
-                  ],
-                ),
-              ),
-            ),
-          ],
-        ),
+          ),
+        ],
       ),
     );
   }
diff --git a/packages/smooth_app/lib/structures/ranked_product.dart b/packages/smooth_app/lib/structures/ranked_product.dart
index c81a9df49440..a4d475dd002a 100644
--- a/packages/smooth_app/lib/structures/ranked_product.dart
+++ b/packages/smooth_app/lib/structures/ranked_product.dart
@@ -1,9 +1,10 @@
 import 'package:flutter/cupertino.dart';
+import 'package:smooth_app/data_models/match.dart';
 import 'package:openfoodfacts/model/Product.dart';
 
 class RankedProduct {
-  RankedProduct({@required this.product, @required this.score});
+  RankedProduct({@required this.product, @required this.match});
 
   final Product product;
-  final double score;
+  final Match match;
 }
diff --git a/packages/smooth_app/lib/temp/attribute.dart b/packages/smooth_app/lib/temp/attribute.dart
new file mode 100644
index 000000000000..7f602c8950e2
--- /dev/null
+++ b/packages/smooth_app/lib/temp/attribute.dart
@@ -0,0 +1,90 @@
+import 'package:openfoodfacts/interface/JsonObject.dart';
+
+class Attribute extends JsonObject {
+  Attribute({
+    this.id,
+    this.name,
+    this.title,
+    this.iconUrl,
+    this.defaultF,
+    this.settingNote,
+    this.settingName,
+    this.description,
+    this.shortDescription,
+    this.match,
+    this.status,
+  });
+
+  factory Attribute.fromJson(dynamic json) => Attribute(
+        id: json[_JSON_TAG_ID] as String,
+        name: json[_JSON_TAG_NAME] as String,
+        title: json[_JSON_TAG_TITLE] as String,
+        iconUrl: json[_JSON_TAG_ICON_URL] as String,
+        defaultF: json[_JSON_TAG_DEFAULT] as String,
+        settingNote: json[_JSON_TAG_SETTING_NOTE] as String,
+        settingName: json[_JSON_TAG_SETTING_NAME] as String,
+        description: json[_JSON_TAG_DESCRIPTION] as String,
+        shortDescription: json[_JSON_TAG_DESCRIPTION_SHORT] as String,
+        match: JsonObject.parseDouble(json[_JSON_TAG_MATCH]),
+        status: json[_JSON_TAG_STATUS] as String,
+      );
+
+  @override
+  Map<String, dynamic>
+      toJson() => // TODO(monsieurtanuki): branch to JsonObject.removeNullEntries when available
+          JsonObject_removeNullEntries(<String, dynamic>{
+            _JSON_TAG_ID: id,
+            _JSON_TAG_NAME: name,
+            _JSON_TAG_TITLE: title,
+            _JSON_TAG_ICON_URL: iconUrl,
+            _JSON_TAG_DEFAULT: defaultF,
+            _JSON_TAG_SETTING_NOTE: settingNote,
+            _JSON_TAG_SETTING_NAME: settingName,
+            _JSON_TAG_DESCRIPTION: description,
+            _JSON_TAG_DESCRIPTION_SHORT: shortDescription,
+            _JSON_TAG_MATCH: match,
+            _JSON_TAG_STATUS: status,
+          });
+
+  static const String _JSON_TAG_ID = 'id';
+  static const String _JSON_TAG_NAME = 'name';
+  static const String _JSON_TAG_TITLE = 'title';
+  static const String _JSON_TAG_ICON_URL = 'icon_url';
+  static const String _JSON_TAG_DEFAULT = 'default';
+  static const String _JSON_TAG_SETTING_NOTE = 'setting_note';
+  static const String _JSON_TAG_SETTING_NAME = 'setting_name';
+  static const String _JSON_TAG_DESCRIPTION = 'description';
+  static const String _JSON_TAG_DESCRIPTION_SHORT = 'description_short';
+  static const String _JSON_TAG_MATCH = 'match';
+  static const String _JSON_TAG_STATUS = 'status';
+
+  final String id;
+  final String name;
+  final String title;
+  final String iconUrl;
+  final String defaultF;
+  final String settingNote;
+  final String settingName;
+  final String description;
+  final String shortDescription;
+  final double match;
+  final String status;
+
+  @override
+  String toString() => 'Attribute(${toJson()})';
+
+  // TODO(monsieurtanuki): remove when the lib is upgraded
+  static Map<String, dynamic> JsonObject_removeNullEntries(
+      final Map<String, dynamic> input) {
+    if (input == null) {
+      return null;
+    }
+    final Map<String, dynamic> result = <String, dynamic>{};
+    input.forEach((String key, dynamic value) {
+      if (key != null) {
+        result[key] = value;
+      }
+    });
+    return result;
+  }
+}
diff --git a/packages/smooth_app/lib/temp/attribute_group.dart b/packages/smooth_app/lib/temp/attribute_group.dart
new file mode 100644
index 000000000000..d3796d2e4234
--- /dev/null
+++ b/packages/smooth_app/lib/temp/attribute_group.dart
@@ -0,0 +1,54 @@
+import 'package:openfoodfacts/interface/JsonObject.dart';
+import 'package:smooth_app/temp/attribute.dart';
+
+class AttributeGroup extends JsonObject {
+  AttributeGroup({
+    this.id,
+    this.name,
+    this.warning,
+    this.attributes,
+  });
+
+  factory AttributeGroup.fromJson(dynamic json) => AttributeGroup(
+        id: json[_JSON_TAG_ID] as String,
+        name: json[_JSON_TAG_NAME] as String,
+        warning: json[_JSON_TAG_WARNING] as String,
+        attributes: (json[_JSON_TAG_ATTRIBUTES] as List<dynamic>)
+            ?.map((dynamic item) => Attribute.fromJson(item))
+            ?.toList(),
+      );
+
+  @override
+  Map<String, dynamic>
+      toJson() => // TODO(monsieurtanuki): branch to JsonObject.removeNullEntries when available
+          Attribute.JsonObject_removeNullEntries(<String, dynamic>{
+            _JSON_TAG_ID: id,
+            _JSON_TAG_NAME: name,
+            _JSON_TAG_WARNING: warning,
+            _JSON_TAG_ATTRIBUTES: _listToJson(),
+          });
+
+  static const String _JSON_TAG_ID = 'id';
+  static const String _JSON_TAG_NAME = 'name';
+  static const String _JSON_TAG_WARNING = 'warning';
+  static const String _JSON_TAG_ATTRIBUTES = 'attributes';
+
+  final String id;
+  final String name;
+  final String warning;
+  final List<Attribute> attributes;
+
+  @override
+  String toString() => 'AttributeGroup(${toJson()})';
+
+  List<Map<String, dynamic>> _listToJson() {
+    if (attributes == null || attributes.isEmpty) {
+      return null;
+    }
+    final List<Map<String, dynamic>> result = [];
+    for (final Attribute item in attributes) {
+      result.add(item.toJson());
+    }
+    return result;
+  }
+}
diff --git a/packages/smooth_app/lib/temp/user_preferences.dart b/packages/smooth_app/lib/temp/user_preferences.dart
index 1f29efa78ecb..3a7bfad28191 100644
--- a/packages/smooth_app/lib/temp/user_preferences.dart
+++ b/packages/smooth_app/lib/temp/user_preferences.dart
@@ -1,50 +1,70 @@
 // Note to myself : this needs to be transferred to the openfoodfacts-dart plugin when ready
 
-import 'package:smooth_app/data_models/user_preferences_model.dart';
+import 'package:shared_preferences/shared_preferences.dart';
+import 'package:flutter/material.dart';
+import 'package:smooth_app/temp/attribute_group.dart';
 
-class UserPreferences {
-  UserPreferences();
+class UserPreferences extends ChangeNotifier {
+  UserPreferences._shared(final SharedPreferences sharedPreferences) {
+    _sharedPreferences = sharedPreferences;
+  }
+
+  SharedPreferences _sharedPreferences;
 
-  UserPreferences.filled(Map<String, dynamic> data) {
-    loadJson(data);
+  static Future<UserPreferences> getUserPreferences() async {
+    final SharedPreferences preferences = await SharedPreferences.getInstance();
+    return UserPreferences._shared(preferences);
   }
 
   static const int INDEX_NOT_IMPORTANT = 0;
 
-  final Map<String, int> _currentValues = <String, int>{};
+  static const String _TAG_PREFIX_IMPORTANCE = 'IMPORTANCE';
+  static const String _TAG_HIDDEN_GROUPS = 'hidden_groups';
+  static const String _TAG_USE_ML_KIT = 'useMlKit';
+
+  String _getImportanceTag(final String variable) =>
+      _TAG_PREFIX_IMPORTANCE + variable;
 
-  void setValue(String variable, int value) => _currentValues[variable] = value;
+  Future<void> setImportance(String variable, int value) async {
+    _sharedPreferences.setInt(_getImportanceTag(variable), value);
+    notifyListeners();
+  }
 
-  int getValue(String variable) =>
-      _currentValues[variable] ?? INDEX_NOT_IMPORTANT;
+  int getImportance(String variable) =>
+      _sharedPreferences.getInt(_getImportanceTag(variable)) ??
+      INDEX_NOT_IMPORTANT;
 
-  List<String> getActiveVariables() {
-    final List<String> result = <String>[];
-    for (final String variable in UserPreferencesModel.getVariables()) {
-      if (getValue(variable) != INDEX_NOT_IMPORTANT) {
-        result.add(variable);
-      }
-    }
-    return result;
+  bool isAttributeGroupVisible(final AttributeGroup group) {
+    final List<String> hiddenList =
+        _sharedPreferences.getStringList(_TAG_HIDDEN_GROUPS);
+    return hiddenList == null || !hiddenList.contains(group.id);
   }
 
-  void loadJson(Map<String, dynamic> data) {
-    for (final String variable in UserPreferencesModel.getVariables()) {
-      if (data[variable] is! int) {
-        setValue(variable, INDEX_NOT_IMPORTANT);
-      } else {
-        setValue(variable, data[variable] as int ?? INDEX_NOT_IMPORTANT);
+  Future<void> setAttributeGroupVisibility(
+      final AttributeGroup group, final bool visible) async {
+    List<String> hiddenList =
+        _sharedPreferences.getStringList(_TAG_HIDDEN_GROUPS);
+    final String tag = group.id;
+    if (hiddenList != null && hiddenList.contains(tag)) {
+      if (!visible) {
+        return;
       }
+      hiddenList.remove(tag);
+    } else {
+      if (visible) {
+        return;
+      }
+      hiddenList ??= <String>[];
+      hiddenList.add(tag);
     }
+    await _sharedPreferences.setStringList(_TAG_HIDDEN_GROUPS, hiddenList);
+    notifyListeners();
   }
 
-  Map<String, int> toJson() {
-    final Map<String, int> result = <String, int>{};
-
-    for (final String variable in UserPreferencesModel.getVariables()) {
-      result[variable] = getValue(variable);
-    }
-
-    return result;
+  Future<void> setMlKitState(final bool state) async {
+    await _sharedPreferences.setBool(_TAG_USE_ML_KIT, state);
+    notifyListeners();
   }
+
+  bool getMlKitState() => _sharedPreferences.getBool(_TAG_USE_ML_KIT) ?? false;
 }
