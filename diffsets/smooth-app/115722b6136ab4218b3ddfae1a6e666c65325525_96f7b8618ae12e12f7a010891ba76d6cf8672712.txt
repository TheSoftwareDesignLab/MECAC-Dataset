diff --git a/packages/smooth_app/lib/data_models/continuous_scan_model.dart b/packages/smooth_app/lib/data_models/continuous_scan_model.dart
index 32e0e451dfd1..75437f077805 100644
--- a/packages/smooth_app/lib/data_models/continuous_scan_model.dart
+++ b/packages/smooth_app/lib/data_models/continuous_scan_model.dart
@@ -98,8 +98,6 @@ class ContinuousScanModel with ChangeNotifier {
   ScannedProductState? getBarcodeState(final String barcode) =>
       _states[barcode];
 
-  Product getProduct(final String barcode) => _productList.getProduct(barcode);
-
   /// Adds a barcode
   /// Will return [true] if this barcode is successfully added
   Future<bool> onScan(String? code) async {
@@ -146,10 +144,12 @@ class ContinuousScanModel with ChangeNotifier {
     }
     if (state == ScannedProductState.FOUND ||
         state == ScannedProductState.CACHED) {
-      final Product product = getProduct(barcode);
       _barcodes.remove(barcode);
       _barcodes.add(barcode);
-      _addProduct(product, state);
+      _addProduct(barcode, state);
+      if (state == ScannedProductState.CACHED) {
+        _updateBarcode(barcode);
+      }
       lastConsultedBarcode = barcode;
       return true;
     }
@@ -171,17 +171,17 @@ class ContinuousScanModel with ChangeNotifier {
         final FetchedProduct fetchedProduct =
             await _queryBarcode(barcode).timeout(const Duration(seconds: 5));
         if (fetchedProduct.product != null) {
-          _addProduct(fetchedProduct.product!, ScannedProductState.CACHED);
+          _addProduct(barcode, ScannedProductState.CACHED);
           return true;
         }
       } on TimeoutException {
         // We tried to load the product from the server,
         // but it was taking more than 5 seconds.
         // So we'll just show the already cached product.
-        _addProduct(product, ScannedProductState.CACHED);
+        _addProduct(barcode, ScannedProductState.CACHED);
         return true;
       }
-      _addProduct(product, ScannedProductState.CACHED);
+      _addProduct(barcode, ScannedProductState.CACHED);
       return true;
     }
     return false;
@@ -202,7 +202,7 @@ class ContinuousScanModel with ChangeNotifier {
     final FetchedProduct fetchedProduct = await _queryBarcode(barcode);
     switch (fetchedProduct.status) {
       case FetchedProductStatus.ok:
-        _addProduct(fetchedProduct.product!, ScannedProductState.FOUND);
+        _addProduct(barcode, ScannedProductState.FOUND);
         return;
       case FetchedProductStatus.internetNotFound:
         _setBarcodeState(barcode, ScannedProductState.NOT_FOUND);
@@ -225,7 +225,7 @@ class ContinuousScanModel with ChangeNotifier {
     final FetchedProduct fetchedProduct = await _queryBarcode(barcode);
     switch (fetchedProduct.status) {
       case FetchedProductStatus.ok:
-        _addProduct(fetchedProduct.product!, ScannedProductState.FOUND);
+        _addProduct(barcode, ScannedProductState.FOUND);
         return;
       case FetchedProductStatus.internetNotFound:
         _setBarcodeState(barcode, ScannedProductState.NOT_FOUND);
@@ -243,17 +243,16 @@ class ContinuousScanModel with ChangeNotifier {
   }
 
   Future<void> _addProduct(
-    final Product product,
+    final String barcode,
     final ScannedProductState state,
   ) async {
-    _productList.refresh(product);
-    if (_latestFoundBarcode != product.barcode!) {
-      _latestFoundBarcode = product.barcode;
+    if (_latestFoundBarcode != barcode) {
+      _latestFoundBarcode = barcode;
       _daoProductList.push(productList, _latestFoundBarcode!);
       _daoProductList.push(_history, _latestFoundBarcode!);
       _daoProductList.localDatabase.notifyListeners();
     }
-    _setBarcodeState(product.barcode!, state);
+    _setBarcodeState(barcode, state);
   }
 
   Future<void> clearScanSession() async {
diff --git a/packages/smooth_app/lib/data_models/partial_product_list.dart b/packages/smooth_app/lib/data_models/partial_product_list.dart
index 391c95a9d89b..573c0d682edc 100644
--- a/packages/smooth_app/lib/data_models/partial_product_list.dart
+++ b/packages/smooth_app/lib/data_models/partial_product_list.dart
@@ -1,23 +1,22 @@
-import 'package:openfoodfacts/openfoodfacts.dart';
 import 'package:smooth_app/data_models/product_list.dart';
 
 /// List of [Product]s out of partial results (e.g. paged results).
 class PartialProductList {
-  final List<Product> _products = <Product>[];
+  final List<String> _barcodes = <String>[];
   int _totalSize = 0;
 
   /// Total size of the list from which this partial list is taken.
   int get totalSize => _totalSize;
 
-  List<Product> getProducts() => _products;
+  List<String> getBarcodes() => _barcodes;
 
   void add(final ProductList productList) {
-    _products.addAll(productList.getList());
+    _barcodes.addAll(productList.getList());
     _totalSize = productList.totalSize;
   }
 
   void clear() {
-    _products.clear();
+    _barcodes.clear();
     _totalSize = 0;
   }
 }
diff --git a/packages/smooth_app/lib/data_models/personalized_ranking_model.dart b/packages/smooth_app/lib/data_models/personalized_ranking_model.dart
new file mode 100644
index 000000000000..5b8fe0adda5e
--- /dev/null
+++ b/packages/smooth_app/lib/data_models/personalized_ranking_model.dart
@@ -0,0 +1,104 @@
+import 'package:flutter/foundation.dart';
+import 'package:openfoodfacts/openfoodfacts.dart';
+import 'package:smooth_app/data_models/product_preferences.dart';
+import 'package:smooth_app/data_models/up_to_date_product_provider.dart';
+import 'package:smooth_app/database/dao_product.dart';
+import 'package:smooth_app/database/local_database.dart';
+import 'package:smooth_app/pages/tmp_matched_product_v2.dart';
+
+enum LoadingStatus {
+  LOADING,
+  LOADED,
+  ERROR,
+}
+
+/// Model that computes the scores and sorts the barcodes accordingly.
+class PersonalizedRankingModel with ChangeNotifier {
+  PersonalizedRankingModel(this.initialBarcodes);
+
+  final List<String> initialBarcodes;
+
+  late LoadingStatus _loadingStatus;
+  String? _loadingError;
+
+  String? get loadingError => _loadingError;
+  LoadingStatus get loadingStatus => _loadingStatus;
+
+  final List<MatchedScoreV2> scores = <MatchedScoreV2>[];
+
+  int? _timestamp;
+
+  /// Refreshes the computations.
+  Future<void> refresh(
+    final LocalDatabase localDatabase,
+    final ProductPreferences productPreferences,
+  ) async {
+    _clear();
+    _asyncLoad(localDatabase, productPreferences);
+  }
+
+  /// Clears the computations.
+  void _clear() {
+    _loadingStatus = LoadingStatus.LOADING;
+    _loadingError = null;
+    scores.clear();
+  }
+
+  /// Returns the loading progress between 0 (min) and 1 (max).
+  double? getLoadingProgress() {
+    if (_loadingStatus != LoadingStatus.LOADING) {
+      return null;
+    }
+    if (initialBarcodes.isEmpty) {
+      return 1;
+    }
+    return scores.length / initialBarcodes.length;
+  }
+
+  /// Removes a barcode from the barcodes and from the scores.
+  void dismiss(final String barcode) {
+    initialBarcodes.remove(barcode);
+    int? index;
+    int i = 0;
+    for (final MatchedScoreV2 score in scores) {
+      if (score.barcode == barcode) {
+        index = i;
+      }
+      i++;
+    }
+    if (index == null) {
+      return;
+    }
+    scores.removeAt(index);
+  }
+
+  /// Computes the scores from the [Product]s extracted one by one from the db.
+  Future<bool> _asyncLoad(
+    final LocalDatabase localDatabase,
+    final ProductPreferences productPreferences,
+  ) async {
+    try {
+      final DaoProduct daoProduct = DaoProduct(localDatabase);
+      for (final String barcode in initialBarcodes) {
+        final Product? product = await daoProduct.get(barcode);
+        if (product == null) {
+          // unlikely, but what shall we do?
+          continue;
+        }
+        scores.add(MatchedScoreV2(product, productPreferences));
+        notifyListeners(); // refreshes the progress
+      }
+      MatchedScoreV2.sort(scores);
+      _loadingStatus = LoadingStatus.LOADED;
+    } catch (e) {
+      _loadingError = e.toString();
+      _loadingStatus = LoadingStatus.ERROR;
+    }
+    _timestamp = LocalDatabase.nowInMillis();
+    notifyListeners();
+    return _loadingStatus == LoadingStatus.LOADED;
+  }
+
+  bool needsRefresh(final UpToDateProductProvider provider) =>
+      provider.needsRefresh(_timestamp, initialBarcodes);
+}
diff --git a/packages/smooth_app/lib/data_models/product_list.dart b/packages/smooth_app/lib/data_models/product_list.dart
index 45b59942004b..074b70a67c40 100644
--- a/packages/smooth_app/lib/data_models/product_list.dart
+++ b/packages/smooth_app/lib/data_models/product_list.dart
@@ -194,22 +194,11 @@ class ProductList {
   int totalSize = 0;
 
   final List<String> _barcodes = <String>[];
-  final Map<String, Product> _products = <String, Product>{};
 
   List<String> get barcodes => _barcodes;
 
   bool isEmpty() => _barcodes.isEmpty;
 
-  Product getProduct(final String barcode) => _products[barcode]!;
-
-  void refresh(final Product product) {
-    final String? barcode = product.barcode;
-    if (barcode == null) {
-      throw Exception('null barcode');
-    }
-    _products[barcode] = product;
-  }
-
   /// Removes a barcode from the list
   ///
   /// Returns false if not already in the list
@@ -219,43 +208,29 @@ class ProductList {
       return false;
     }
     _barcodes.remove(barcode);
-    _products.remove(barcode);
     return true;
   }
 
   /// Sets all products with the same order as the input list
   void setAll(final List<Product> products) {
     final List<String> barcodes = <String>[];
-    final Map<String, Product> productMap = <String, Product>{};
     for (final Product product in products) {
       final String barcode = product.barcode!;
       barcodes.add(barcode);
-      productMap[barcode] = product;
     }
-    set(barcodes, productMap);
+    set(barcodes);
   }
 
-  void set(
-    final List<String> barcodes,
-    final Map<String, Product> products,
-  ) {
+  void set(final Iterable<String> barcodes) {
     _barcodes.clear();
-    _products.clear();
-    _products.addAll(products);
     _barcodes.addAll(barcodes);
   }
 
-  List<Product> getList() {
-    final List<Product> result = <Product>[];
+  List<String> getList() {
+    final List<String> result = <String>[];
     final Iterable<String> barcodes =
         _isReversed() ? _barcodes.reversed : _barcodes;
-    for (final String barcode in barcodes) {
-      final Product? product = _products[barcode];
-      if (product == null) {
-        throw Exception('no product for barcode $barcode');
-      }
-      result.add(product);
-    }
+    result.addAll(barcodes);
     return result;
   }
 
diff --git a/packages/smooth_app/lib/data_models/product_preferences.dart b/packages/smooth_app/lib/data_models/product_preferences.dart
index 913cc2ebdf99..1e8ed3b70657 100644
--- a/packages/smooth_app/lib/data_models/product_preferences.dart
+++ b/packages/smooth_app/lib/data_models/product_preferences.dart
@@ -6,6 +6,7 @@ import 'package:openfoodfacts/model/AttributeGroup.dart';
 import 'package:openfoodfacts/personalized_search/available_attribute_groups.dart';
 import 'package:openfoodfacts/personalized_search/available_preference_importances.dart';
 import 'package:openfoodfacts/personalized_search/available_product_preferences.dart';
+import 'package:openfoodfacts/personalized_search/preference_importance.dart';
 import 'package:openfoodfacts/personalized_search/product_preferences_manager.dart';
 import 'package:openfoodfacts/personalized_search/product_preferences_selection.dart';
 import 'package:smooth_app/data_models/downloadable_string.dart';
@@ -228,4 +229,31 @@ class ProductPreferences extends ProductPreferencesManager with ChangeNotifier {
     }
     throw Exception('unknown attribute group for $attributeId');
   }
+
+  /// Returns a compact view of the preferences.
+  ///
+  /// Useful if you want to know if the preferences actually changed.
+  List<String> getCompactView() {
+    final List<String> result = <String>[];
+    if (attributeGroups == null) {
+      return result;
+    }
+    for (final AttributeGroup attributeGroup in attributeGroups!) {
+      if (attributeGroup.attributes == null) {
+        continue;
+      }
+      for (final Attribute attribute in attributeGroup.attributes!) {
+        final String? attributeId = attribute.id;
+        if (attributeId == null) {
+          continue;
+        }
+        final String importanceId = getImportanceIdForAttributeId(attributeId);
+        if (importanceId != PreferenceImportance.ID_NOT_IMPORTANT) {
+          result.add('$attributeId=$importanceId');
+          continue;
+        }
+      }
+    }
+    return result;
+  }
 }
diff --git a/packages/smooth_app/lib/data_models/product_query_model.dart b/packages/smooth_app/lib/data_models/product_query_model.dart
index 386624bbe449..8aa6dfd7b756 100644
--- a/packages/smooth_app/lib/data_models/product_query_model.dart
+++ b/packages/smooth_app/lib/data_models/product_query_model.dart
@@ -1,23 +1,23 @@
 import 'package:flutter/material.dart';
 import 'package:openfoodfacts/openfoodfacts.dart';
 import 'package:smooth_app/data_models/product_list_supplier.dart';
+import 'package:smooth_app/database/dao_product.dart';
 import 'package:smooth_app/query/product_query.dart';
 
 enum LoadingStatus {
   LOADING,
   LOADED,
-  POST_LOAD_STARTED,
-  COMPLETE,
   ERROR,
 }
 
 class ProductQueryModel with ChangeNotifier {
-  ProductQueryModel(this._supplier) {
+  ProductQueryModel(this._supplier, this._daoProduct) {
     _clear();
-    _asyncLoad();
+    _asyncLoad(notify: true);
   }
 
   ProductListSupplier _supplier;
+  final DaoProduct _daoProduct;
 
   ProductListSupplier get supplier => _supplier;
 
@@ -26,9 +26,10 @@ class ProductQueryModel with ChangeNotifier {
 
   late LoadingStatus _loadingStatus;
   String? _loadingError;
-  final List<Product> _products = <Product>[];
-  List<Product>? displayProducts;
-  bool isNotEmpty() => _products.isNotEmpty;
+  final List<String> _barcodes = <String>[];
+  List<String>? displayBarcodes;
+  bool isNotEmpty() => _barcodes.isNotEmpty;
+  final Map<String, List<String>> _productCategories = <String, List<String>>{};
 
   /// <Label, Label (count)> [Map]
   final Map<String, String> categories = <String, String>{};
@@ -42,26 +43,33 @@ class ProductQueryModel with ChangeNotifier {
   String? get loadingError => _loadingError;
   LoadingStatus get loadingStatus => _loadingStatus;
 
+  /// Sets the translation for meta category "All".
+  void setTranslationForAll(final String translationForAll) =>
+      categories[_CATEGORY_ALL] = translationForAll;
+
   void _clear() {
     currentCategory = _CATEGORY_ALL;
     _loadingStatus = LoadingStatus.LOADING;
     _loadingError = null;
-    _products.clear();
-    displayProducts = null;
+    _barcodes.clear();
+    displayBarcodes = null;
+    _productCategories.clear();
     categories.clear();
     _categoriesCounter.clear();
     sortedCategories.clear();
   }
 
-  Future<bool> _asyncLoad() async {
+  Future<bool> _asyncLoad({final bool notify = false}) async {
     _loadingError = await supplier.asyncLoad();
     if (_loadingError != null) {
       _loadingStatus = LoadingStatus.ERROR;
     } else {
+      await _process(supplier.partialProductList.getBarcodes());
       _loadingStatus = LoadingStatus.LOADED;
-      _products.addAll(supplier.partialProductList.getProducts());
     }
-    notifyListeners();
+    if (notify) {
+      notifyListeners();
+    }
     return _loadingStatus == LoadingStatus.LOADED;
   }
 
@@ -95,22 +103,27 @@ class ProductQueryModel with ChangeNotifier {
 
   /// Sorts the products by category.
   ///
-  /// [translationForAll] is the displayed translation for meta category "All".
-  void process(final String translationForAll) {
-    if (_loadingStatus != LoadingStatus.LOADED) {
-      return;
-    }
-    _loadingStatus = LoadingStatus.POST_LOAD_STARTED;
-
-    displayProducts = _products;
-
-    categories[_CATEGORY_ALL] = translationForAll;
-
-    for (final Product product in _products) {
+  /// Is a bit long because we need to get each product from the database,
+  /// in order to know before display all the available categories.
+  /// Optim 1: dismiss this filter altogether.
+  /// Optim 2: get several products at a time - how faster would that be?
+  /// Optim 3: compute the filter async.
+  Future<void> _process(final List<String> barcodes) async {
+    _barcodes.addAll(barcodes);
+    displayBarcodes = _barcodes;
+
+    categories[_CATEGORY_ALL] = ''; // to be overridden later
+    for (final String barcode in barcodes) {
+      final Product? product = await _daoProduct.get(barcode);
+      if (product == null) {
+        // unexpected
+        continue;
+      }
       if (product.categoriesTagsInLanguages != null) {
         final List<String>? translatedCategories =
             product.categoriesTagsInLanguages![ProductQuery.getLanguage()];
         if (translatedCategories != null) {
+          _productCategories[product.barcode!] = translatedCategories;
           for (final String category in translatedCategories) {
             categories[category] = '';
             _categoriesCounter[category] =
@@ -143,20 +156,23 @@ class ProductQueryModel with ChangeNotifier {
       return _categoriesCounter[b]!.compareTo(_categoriesCounter[a]!);
     });
 
-    _loadingStatus = LoadingStatus.COMPLETE;
+    _loadingStatus = LoadingStatus.LOADED;
   }
 
   void selectCategory(String category) {
     currentCategory = category;
     if (category == _CATEGORY_ALL) {
-      displayProducts = _products;
+      displayBarcodes = _barcodes;
     } else {
-      displayProducts = _products
-          .where((Product product) =>
-              product.categoriesTagsInLanguages?[ProductQuery.getLanguage()]
-                  ?.contains(category) ??
-              false)
-          .toList();
+      final List<String> result = <String>[];
+      _productCategories.forEach(
+        (final String barcode, final List<String> categories) {
+          if (categories.contains(category)) {
+            result.add(barcode);
+          }
+        },
+      );
+      displayBarcodes = result;
     }
   }
 }
diff --git a/packages/smooth_app/lib/data_models/up_to_date_product_provider.dart b/packages/smooth_app/lib/data_models/up_to_date_product_provider.dart
index 0853c4bd4f1a..0d1958a5e4ba 100644
--- a/packages/smooth_app/lib/data_models/up_to_date_product_provider.dart
+++ b/packages/smooth_app/lib/data_models/up_to_date_product_provider.dart
@@ -1,20 +1,40 @@
 import 'package:flutter/foundation.dart';
 import 'package:flutter/widgets.dart';
 import 'package:openfoodfacts/model/Product.dart';
+import 'package:smooth_app/database/local_database.dart';
 
 /// Provider that reflects all the user changes on [Product]s.
 class UpToDateProductProvider with ChangeNotifier {
   final Map<String, Product> _map = <String, Product>{};
+  final Map<String, int> _timestamps = <String, int>{};
 
   Product? get(final Product product) => _map[product.barcode!];
 
+  Product? getFromBarcode(final String barcode) => _map[barcode];
+
   void set(
     final Product product, {
     final bool notify = true,
   }) {
     _map[product.barcode!] = product;
+    _timestamps[product.barcode!] = LocalDatabase.nowInMillis();
     if (notify) {
       notifyListeners();
     }
   }
+
+  /// Returns true if at least one barcode was refreshed after the [timestamp].
+  bool needsRefresh(final int? latestTimestamp, final List<String> barcodes) {
+    if (latestTimestamp == null) {
+      // no need to "refresh", need to start instead!
+      return false;
+    }
+    for (final String barcode in barcodes) {
+      final int? timestamp = _timestamps[barcode];
+      if (timestamp != null && timestamp > latestTimestamp) {
+        return true;
+      }
+    }
+    return false;
+  }
 }
diff --git a/packages/smooth_app/lib/database/dao_product.dart b/packages/smooth_app/lib/database/dao_product.dart
index b387dc158f08..95d8d556b510 100644
--- a/packages/smooth_app/lib/database/dao_product.dart
+++ b/packages/smooth_app/lib/database/dao_product.dart
@@ -14,7 +14,7 @@ import 'package:sqflite/sqflite.dart';
 
 class DaoProduct extends AbstractSqlDao
     implements BulkDeletable, DaoProductMigrationDestination {
-  DaoProduct(final LocalDatabase localDatabase) : super(localDatabase);
+  DaoProduct(super.localDatabase);
 
   static const String _TABLE_PRODUCT = 'gzipped_product';
   static const String _TABLE_PRODUCT_COLUMN_BARCODE = 'barcode';
@@ -22,6 +22,12 @@ class DaoProduct extends AbstractSqlDao
       'encoded_gzipped_json';
   static const String _TABLE_PRODUCT_COLUMN_LAST_UPDATE = 'last_update';
 
+  static const List<String> _columns = <String>[
+    _TABLE_PRODUCT_COLUMN_BARCODE,
+    _TABLE_PRODUCT_COLUMN_GZIPPED_JSON,
+    _TABLE_PRODUCT_COLUMN_LAST_UPDATE,
+  ];
+
   static FutureOr<void> onUpgrade(
     final Database db,
     final int oldVersion,
@@ -37,11 +43,23 @@ class DaoProduct extends AbstractSqlDao
     }
   }
 
+  /// Returns the [Product] that matches the [barcode], or null.
   Future<Product?> get(final String barcode) async {
-    final Map<String, Product> map = await getAll(<String>[barcode]);
-    return map[barcode];
+    final List<Map<String, dynamic>> queryResults =
+        await localDatabase.database.query(
+      _TABLE_PRODUCT,
+      columns: _columns,
+      where: '$_TABLE_PRODUCT_COLUMN_BARCODE = ?',
+      whereArgs: <String>[barcode],
+    );
+    // O or 1 row expected
+    for (final Map<String, dynamic> row in queryResults) {
+      return _getProductFromQueryResult(row);
+    }
+    return null;
   }
 
+  /// Returns the [Product]s that match the [barcodes].
   Future<Map<String, Product>> getAll(final List<String> barcodes) async {
     final Map<String, Product> result = <String, Product>{};
     if (barcodes.isEmpty) {
@@ -57,11 +75,7 @@ class DaoProduct extends AbstractSqlDao
       final List<Map<String, dynamic>> queryResults =
           await localDatabase.database.query(
         _TABLE_PRODUCT,
-        columns: <String>[
-          _TABLE_PRODUCT_COLUMN_BARCODE,
-          _TABLE_PRODUCT_COLUMN_GZIPPED_JSON,
-          _TABLE_PRODUCT_COLUMN_LAST_UPDATE,
-        ],
+        columns: _columns,
         where: '$_TABLE_PRODUCT_COLUMN_BARCODE in(? ${',?' * (size - 1)})',
         whereArgs: barcodes.sublist(start, start + size),
       );
@@ -133,11 +147,7 @@ class DaoProduct extends AbstractSqlDao
   }
 
   @override
-  List<String> getInsertColumns() => <String>[
-        _TABLE_PRODUCT_COLUMN_BARCODE,
-        _TABLE_PRODUCT_COLUMN_GZIPPED_JSON,
-        _TABLE_PRODUCT_COLUMN_LAST_UPDATE,
-      ];
+  List<String> getInsertColumns() => _columns;
 
   @override
   String getDeleteWhere(final List<dynamic> deleteWhereArgs) =>
diff --git a/packages/smooth_app/lib/database/dao_product_list.dart b/packages/smooth_app/lib/database/dao_product_list.dart
index 12a9c7d766f6..cda551be6120 100644
--- a/packages/smooth_app/lib/database/dao_product_list.dart
+++ b/packages/smooth_app/lib/database/dao_product_list.dart
@@ -7,7 +7,6 @@ import 'package:smooth_app/data_models/product_list.dart';
 import 'package:smooth_app/database/abstract_dao.dart';
 import 'package:smooth_app/database/dao_product.dart';
 import 'package:smooth_app/database/local_database.dart';
-import 'package:smooth_app/services/smooth_services.dart';
 
 /// "Total size" fake value for lists that are not partial/paged.
 const int _uselessTotalSizeValue = 0;
@@ -142,31 +141,16 @@ class DaoProductList extends AbstractDao {
     return true;
   }
 
-  /// Loads the barcodes AND all the products.
+  /// Loads the barcode list.
   Future<void> get(final ProductList productList) async {
     final _BarcodeList? list = _get(productList);
     final List<String> barcodes = <String>[];
-    final Map<String, Product> products = <String, Product>{};
     productList.totalSize = list?.totalSize ?? 0;
     if (list == null || list.barcodes.isEmpty) {
-      productList.set(barcodes, products);
+      productList.set(barcodes);
       return;
     }
-    final DaoProduct daoProduct = DaoProduct(localDatabase);
-    for (final String barcode in list.barcodes) {
-      try {
-        final Product? product = await daoProduct.get(barcode);
-        if (product != null) {
-          barcodes.add(barcode);
-          products[barcode] = product;
-        } else {
-          Logs.e('unexpected: unknown product for $barcode');
-        }
-      } catch (e) {
-        Logs.e('unexpected: unknown product for $barcode', ex: e);
-      }
-    }
-    productList.set(barcodes, products);
+    productList.set(list.barcodes);
   }
 
   /// Returns the number of barcodes quickly but without product check.
diff --git a/packages/smooth_app/lib/generic_lib/buttons/smooth_main_button.dart b/packages/smooth_app/lib/generic_lib/buttons/smooth_main_button.dart
deleted file mode 100644
index 798bdf3d33ae..000000000000
--- a/packages/smooth_app/lib/generic_lib/buttons/smooth_main_button.dart
+++ /dev/null
@@ -1,43 +0,0 @@
-import 'package:flutter/material.dart';
-import 'package:smooth_app/generic_lib/design_constants.dart';
-
-// TODO(monsieurtanuki): probably useless now, [SmoothActionButton] should be enough
-class SmoothMainButton extends StatelessWidget {
-  const SmoothMainButton({
-    required this.text,
-    required this.onPressed,
-    this.width = double.infinity,
-    this.important = true,
-    this.height = 56.0,
-  });
-
-  final String text;
-  final VoidCallback onPressed;
-  final double width;
-  final bool important;
-  final double height;
-
-  @override
-  Widget build(BuildContext context) => ElevatedButton(
-        style: ButtonStyle(
-          backgroundColor: MaterialStateProperty.all(
-              important ? Colors.black : Colors.white),
-          shape: MaterialStateProperty.all(
-            const RoundedRectangleBorder(
-              borderRadius: ROUNDED_BORDER_RADIUS,
-            ),
-          ),
-          minimumSize: MaterialStateProperty.all(
-            Size(
-              width,
-              height,
-            ),
-          ),
-        ),
-        child: Text(
-          text,
-          style: TextStyle(color: important ? Colors.white : Colors.black),
-        ),
-        onPressed: () => onPressed(),
-      );
-}
diff --git a/packages/smooth_app/lib/helpers/data_importer/product_list_import_export.dart b/packages/smooth_app/lib/helpers/data_importer/product_list_import_export.dart
index ff613f051b3b..8c1cafb91197 100644
--- a/packages/smooth_app/lib/helpers/data_importer/product_list_import_export.dart
+++ b/packages/smooth_app/lib/helpers/data_importer/product_list_import_export.dart
@@ -150,26 +150,10 @@ class ProductListImportExport {
       return;
     }
 
-    productList.set(list.barcodes, _extractProductsMap(list, fetchedProducts));
+    productList.set(list.barcodes);
+    await DaoProduct(daoProductList.localDatabase).putAll(fetchedProducts);
     return daoProductList.put(productList);
   }
-
-  Map<String, Product> _extractProductsMap(
-    ImportableList list,
-    List<Product> fetchedProducts,
-  ) {
-    final Map<String, Product> productsToAdd = <String, Product>{};
-    for (final String barcode in list.barcodes) {
-      final Product? product = fetchedProducts.firstWhereOrNull(
-        (Product product) => product.barcode == barcode,
-      );
-
-      if (product != null) {
-        productsToAdd[barcode] = product;
-      }
-    }
-    return productsToAdd;
-  }
 }
 
 class ImportableLists {
diff --git a/packages/smooth_app/lib/l10n/app_en.arb b/packages/smooth_app/lib/l10n/app_en.arb
index c1db530e84a1..7812edd53126 100644
--- a/packages/smooth_app/lib/l10n/app_en.arb
+++ b/packages/smooth_app/lib/l10n/app_en.arb
@@ -363,6 +363,10 @@
     "ranking_subtitle_match_yes": "A great match for you",
     "ranking_subtitle_match_no": "Very poor match",
     "ranking_subtitle_match_maybe": "Unknown match",
+    "refresh_with_new_preferences": "Refresh the list with your new preferences",
+    "@refresh_with_new_preferences": {
+        "description": "Action button label: Refresh the list with your new preferences"
+    },
     "reloaded_with_new_preferences": "Reloaded with your new preferences",
     "@reloaded_with_new_preferences": {
         "description": "Snackbar title: Shows that the modified settings have been applied"
diff --git a/packages/smooth_app/lib/l10n/app_fr.arb b/packages/smooth_app/lib/l10n/app_fr.arb
index 3868a02ab1fb..f095c8aeb9a5 100644
--- a/packages/smooth_app/lib/l10n/app_fr.arb
+++ b/packages/smooth_app/lib/l10n/app_fr.arb
@@ -363,6 +363,7 @@
     "ranking_subtitle_match_yes": "Une bonne correspondance pour vous",
     "ranking_subtitle_match_no": "Très mauvaise correspondance",
     "ranking_subtitle_match_maybe": "Correspondance inconnue",
+    "refresh_with_new_preferences": "Refraîchir la liste avec vos nouvelles préférences",
     "reloaded_with_new_preferences": "Rechargé avec vos nouvelles préférences",
     "@reloaded_with_new_preferences": {
         "description": "Snackbar title: Shows that the modified settings have been applied"
diff --git a/packages/smooth_app/lib/pages/personalized_ranking_page.dart b/packages/smooth_app/lib/pages/personalized_ranking_page.dart
index 28ce219b5885..797e4d7f388c 100644
--- a/packages/smooth_app/lib/pages/personalized_ranking_page.dart
+++ b/packages/smooth_app/lib/pages/personalized_ranking_page.dart
@@ -1,25 +1,28 @@
+import 'package:collection/collection.dart';
 import 'package:flutter/material.dart';
 import 'package:flutter_gen/gen_l10n/app_localizations.dart';
 import 'package:matomo_tracker/matomo_tracker.dart';
-import 'package:openfoodfacts/openfoodfacts.dart';
 import 'package:openfoodfacts/personalized_search/matched_product_v2.dart';
 import 'package:provider/provider.dart';
-import 'package:smooth_app/cards/product_cards/smooth_product_card_found.dart';
+import 'package:smooth_app/data_models/personalized_ranking_model.dart';
 import 'package:smooth_app/data_models/product_preferences.dart';
-import 'package:smooth_app/database/dao_product_list.dart';
+import 'package:smooth_app/data_models/up_to_date_product_provider.dart';
 import 'package:smooth_app/database/local_database.dart';
+import 'package:smooth_app/generic_lib/buttons/smooth_large_button_with_icon.dart';
 import 'package:smooth_app/generic_lib/design_constants.dart';
 import 'package:smooth_app/helpers/analytics_helper.dart';
 import 'package:smooth_app/helpers/product_compatibility_helper.dart';
+import 'package:smooth_app/pages/product/common/product_list_item_simple.dart';
+import 'package:smooth_app/pages/tmp_matched_product_v2.dart';
 import 'package:smooth_app/widgets/smooth_scaffold.dart';
 
 class PersonalizedRankingPage extends StatefulWidget {
   const PersonalizedRankingPage({
-    required this.products,
+    required this.barcodes,
     required this.title,
   });
 
-  final List<Product> products;
+  final List<String> barcodes;
   final String title;
 
   @override
@@ -37,44 +40,94 @@ class _PersonalizedRankingPageState extends State<PersonalizedRankingPage>
 
   static const int _backgroundAlpha = 51;
 
+  late final PersonalizedRankingModel _model;
+
+  List<String>? _compactPreferences;
+
+  @override
+  void initState() {
+    super.initState();
+    _model = PersonalizedRankingModel(widget.barcodes);
+  }
+
   @override
   Widget build(BuildContext context) {
     final ProductPreferences productPreferences =
         context.watch<ProductPreferences>();
-    final LocalDatabase localDatabase = context.watch<LocalDatabase>();
-    final DaoProductList daoProductList = DaoProductList(localDatabase);
-    final List<MatchedProductV2> allProducts = MatchedProductV2.sort(
-      widget.products,
-      productPreferences,
-    );
     final AppLocalizations appLocalizations = AppLocalizations.of(context);
-
-    AnalyticsHelper.trackPersonalizedRanking(widget.products.length);
-
-    MatchedProductStatusV2? status;
-    final List<_VirtualItem> list = <_VirtualItem>[];
-    for (final MatchedProductV2 product in allProducts) {
-      if (status == null || status != product.status) {
-        status = product.status;
-        list.add(_VirtualItem.status(status));
-      }
-      list.add(_VirtualItem.product(product));
-    }
-    final bool darkMode = Theme.of(context).brightness == Brightness.dark;
-    return SmoothScaffold(
-      appBar: AppBar(
-        title: Text(
-          widget.title,
-          overflow: TextOverflow.fade,
+    return Consumer<UpToDateProductProvider>(
+      builder: (
+        final BuildContext context,
+        final UpToDateProductProvider upToDateProductProvider,
+        final Widget? child,
+      ) =>
+          SmoothScaffold(
+        appBar: AppBar(
+          title: Text(widget.title, overflow: TextOverflow.fade),
         ),
-      ),
-      body: ListView.builder(
-        itemCount: list.length,
-        itemBuilder: (BuildContext context, int index) => _buildItem(
-          list[index],
-          daoProductList,
-          appLocalizations,
-          darkMode,
+        body: ChangeNotifierProvider<PersonalizedRankingModel>(
+          create: (final BuildContext context) => _model,
+          builder: (final BuildContext context, final Widget? wtf) {
+            context.watch<PersonalizedRankingModel>();
+            final List<String> compactPreferences =
+                productPreferences.getCompactView();
+            if (_compactPreferences == null) {
+              _compactPreferences = compactPreferences;
+              _model.refresh(context.read<LocalDatabase>(), productPreferences);
+            } else {
+              bool refresh = !_compactPreferences!.equals(compactPreferences);
+              if (!refresh) {
+                refresh = _model.needsRefresh(upToDateProductProvider);
+              }
+              if (refresh) {
+                // TODO(monsieurtanuki): could maybe be automatic with VisibilityDetector
+                return Center(
+                  child: Padding(
+                    padding: const EdgeInsets.all(SMALL_SPACE),
+                    child: SmoothLargeButtonWithIcon(
+                      icon: Icons.refresh,
+                      text: appLocalizations.refresh_with_new_preferences,
+                      onPressed: () {
+                        _compactPreferences = compactPreferences;
+                        _model.refresh(
+                            context.read<LocalDatabase>(), productPreferences);
+                      },
+                    ),
+                  ),
+                );
+              }
+            }
+            if (_model.loadingStatus == LoadingStatus.LOADING) {
+              return Center(
+                child: CircularProgressIndicator(
+                  value: _model.getLoadingProgress() ?? 1,
+                ),
+              );
+            }
+            if (_model.loadingStatus != LoadingStatus.LOADED) {
+              return const Center(child: CircularProgressIndicator());
+            }
+            AnalyticsHelper.trackPersonalizedRanking(widget.barcodes.length);
+            MatchedProductStatusV2? status;
+            final List<_VirtualItem> list = <_VirtualItem>[];
+            for (final MatchedScoreV2 score in _model.scores) {
+              if (status == null || status != score.status) {
+                status = score.status;
+                list.add(_VirtualItem.status(status));
+              }
+              list.add(_VirtualItem.score(score));
+            }
+            final bool darkMode =
+                Theme.of(context).brightness == Brightness.dark;
+            return ListView.builder(
+              itemCount: list.length,
+              itemBuilder: (BuildContext context, int index) => _buildItem(
+                list[index],
+                appLocalizations,
+                darkMode,
+              ),
+            );
+          },
         ),
       ),
     );
@@ -82,7 +135,6 @@ class _PersonalizedRankingPageState extends State<PersonalizedRankingPage>
 
   Widget _buildItem(
     final _VirtualItem item,
-    final DaoProductList daoProductList,
     final AppLocalizations appLocalizations,
     final bool darkMode,
   ) =>
@@ -93,8 +145,7 @@ class _PersonalizedRankingPageState extends State<PersonalizedRankingPage>
               darkMode,
             )
           : _buildSmoothProductCard(
-              item.product!,
-              daoProductList,
+              item.score!,
               appLocalizations,
               darkMode,
             );
@@ -118,8 +169,7 @@ class _PersonalizedRankingPageState extends State<PersonalizedRankingPage>
   }
 
   Widget _buildSmoothProductCard(
-    final MatchedProductV2 matchedProduct,
-    final DaoProductList daoProductList,
+    final MatchedScoreV2 matchedProduct,
     final AppLocalizations appLocalizations,
     final bool darkMode,
   ) =>
@@ -135,19 +185,12 @@ class _PersonalizedRankingPageState extends State<PersonalizedRankingPage>
             color: Colors.white,
           ),
         ),
-        key: Key(matchedProduct.product.barcode!),
-        onDismissed: (final DismissDirection direction) async {
-          final bool removed = widget.products.remove(matchedProduct.product);
-          if (removed) {
-            setState(() {});
-          }
+        key: Key(matchedProduct.barcode),
+        onDismissed: (final DismissDirection direction) {
+          _model.dismiss(matchedProduct.barcode);
           ScaffoldMessenger.of(context).showSnackBar(
             SnackBar(
-              content: Text(
-                removed
-                    ? appLocalizations.product_removed_comparison
-                    : appLocalizations.product_could_not_remove,
-              ),
+              content: Text(appLocalizations.product_removed_comparison),
               duration: const Duration(seconds: 3),
             ),
           );
@@ -157,12 +200,12 @@ class _PersonalizedRankingPageState extends State<PersonalizedRankingPage>
             horizontal: MEDIUM_SPACE,
             vertical: SMALL_SPACE,
           ),
-          child: SmoothProductCardFound(
-            heroTag: matchedProduct.product.barcode!,
-            product: matchedProduct.product,
-            backgroundColor: ProductCompatibilityHelper.product(matchedProduct)
-                .getHeaderBackgroundColor(darkMode)
-                .withAlpha(_backgroundAlpha),
+          child: ProductListItemSimple(
+            barcode: matchedProduct.barcode,
+            backgroundColor:
+                ProductCompatibilityHelper.status(matchedProduct.status)
+                    .getHeaderBackgroundColor(darkMode)
+                    .withAlpha(_backgroundAlpha),
           ),
         ),
       );
@@ -170,9 +213,8 @@ class _PersonalizedRankingPageState extends State<PersonalizedRankingPage>
 
 /// Virtual item in the list: either a product or a status header
 class _VirtualItem {
-  const _VirtualItem.product(this.product) : status = null;
-
-  const _VirtualItem.status(this.status) : product = null;
-  final MatchedProductV2? product;
+  const _VirtualItem.score(this.score) : status = null;
+  const _VirtualItem.status(this.status) : score = null;
+  final MatchedScoreV2? score;
   final MatchedProductStatusV2? status;
 }
diff --git a/packages/smooth_app/lib/pages/preferences/user_preferences_account.dart b/packages/smooth_app/lib/pages/preferences/user_preferences_account.dart
index 5b19ef4643b6..f7a26462b486 100644
--- a/packages/smooth_app/lib/pages/preferences/user_preferences_account.dart
+++ b/packages/smooth_app/lib/pages/preferences/user_preferences_account.dart
@@ -243,7 +243,6 @@ class _UserPreferencesPageState extends State<UserPreferencesSection> {
           ),
           title: appLocalizations.user_search_contributor_title,
           iconData: Icons.add_circle_outline,
-          heroTag: 'contributor',
           context: context,
           localDatabase: localDatabase,
         ),
@@ -255,7 +254,6 @@ class _UserPreferencesPageState extends State<UserPreferencesSection> {
           ),
           title: appLocalizations.user_search_informer_title,
           iconData: Icons.edit,
-          heroTag: 'informer',
           context: context,
           localDatabase: localDatabase,
         ),
@@ -267,7 +265,6 @@ class _UserPreferencesPageState extends State<UserPreferencesSection> {
           ),
           title: appLocalizations.user_search_photographer_title,
           iconData: Icons.add_a_photo,
-          heroTag: 'photographer',
           context: context,
           localDatabase: localDatabase,
         ),
@@ -279,7 +276,6 @@ class _UserPreferencesPageState extends State<UserPreferencesSection> {
           ),
           title: appLocalizations.user_search_to_be_completed_title,
           iconData: Icons.more_horiz,
-          heroTag: 'to_be_completed',
           context: context,
           localDatabase: localDatabase,
         ),
@@ -288,7 +284,6 @@ class _UserPreferencesPageState extends State<UserPreferencesSection> {
           productQuery: PagedToBeCompletedProductQuery(),
           title: appLocalizations.all_search_to_be_completed_title,
           iconData: Icons.more_outlined,
-          heroTag: 'all_to_be_completed',
           context: context,
           localDatabase: localDatabase,
         ),
@@ -372,13 +367,11 @@ class _UserPreferencesPageState extends State<UserPreferencesSection> {
     required final PagedProductQuery productQuery,
     required final String title,
     required final IconData iconData,
-    required final String heroTag,
     required final BuildContext context,
     required final LocalDatabase localDatabase,
   }) =>
       ListTile(
         onTap: () async => ProductQueryPageHelper().openBestChoice(
-          heroTag: heroTag,
           name: title,
           localDatabase: localDatabase,
           productQuery: productQuery,
diff --git a/packages/smooth_app/lib/pages/preferences/user_preferences_contribute.dart b/packages/smooth_app/lib/pages/preferences/user_preferences_contribute.dart
index 8c31c1712648..70f7d26c003f 100644
--- a/packages/smooth_app/lib/pages/preferences/user_preferences_contribute.dart
+++ b/packages/smooth_app/lib/pages/preferences/user_preferences_contribute.dart
@@ -110,7 +110,6 @@ class UserPreferencesContribute extends AbstractUserPreferences {
                     Navigator.of(context).pop();
                     ProductQueryPageHelper().openBestChoice(
                       name: appLocalizations.all_search_to_be_completed_title,
-                      heroTag: 'all_to_be_completed',
                       localDatabase: localDatabase,
                       productQuery: PagedToBeCompletedProductQuery(),
                       // the other "context"s being popped
diff --git a/packages/smooth_app/lib/pages/product/common/product_list_item_simple.dart b/packages/smooth_app/lib/pages/product/common/product_list_item_simple.dart
index 57388238ac56..23269a99da6f 100644
--- a/packages/smooth_app/lib/pages/product/common/product_list_item_simple.dart
+++ b/packages/smooth_app/lib/pages/product/common/product_list_item_simple.dart
@@ -1,25 +1,82 @@
 import 'package:flutter/material.dart';
-import 'package:openfoodfacts/model/Product.dart';
+import 'package:provider/provider.dart';
 import 'package:smooth_app/cards/product_cards/smooth_product_card_found.dart';
+import 'package:smooth_app/cards/product_cards/smooth_product_card_template.dart';
 import 'package:smooth_app/data_models/product_list.dart';
+import 'package:smooth_app/data_models/up_to_date_product_provider.dart';
+import 'package:smooth_app/database/local_database.dart';
+import 'package:smooth_app/pages/product/common/product_model.dart';
+import 'package:smooth_app/services/smooth_services.dart';
 
 /// Widget for a [ProductList] item (simple product list)
-class ProductListItemSimple extends StatelessWidget {
+class ProductListItemSimple extends StatefulWidget {
   const ProductListItemSimple({
-    required this.product,
+    required this.barcode,
     this.onTap,
     this.onLongPress,
+    this.backgroundColor,
   });
 
-  final Product product;
+  final String barcode;
   final VoidCallback? onTap;
   final VoidCallback? onLongPress;
+  final Color? backgroundColor;
 
   @override
-  Widget build(BuildContext context) => SmoothProductCardFound(
-        heroTag: product.barcode!,
-        product: product,
-        onTap: onTap,
-        onLongPress: onLongPress,
+  State<ProductListItemSimple> createState() => _ProductListItemSimpleState();
+}
+
+class _ProductListItemSimpleState extends State<ProductListItemSimple> {
+  late final ProductModel _model;
+
+  @override
+  void initState() {
+    super.initState();
+    _model = ProductModel(
+      widget.barcode,
+      context.read<LocalDatabase>(),
+    );
+  }
+
+  @override
+  Widget build(BuildContext context) => Consumer<UpToDateProductProvider>(
+        builder: (
+          final BuildContext context,
+          final UpToDateProductProvider provider,
+          final Widget? child,
+        ) =>
+            ChangeNotifierProvider<ProductModel>(
+          create: (final BuildContext context) => _model,
+          builder: (final BuildContext context, final Widget? wtf) {
+            context.watch<ProductModel>();
+            _model.setRefreshedProduct(provider.getFromBarcode(widget.barcode));
+            switch (_model.loadingStatus) {
+              case LoadingStatus.LOADING:
+                return const SmoothProductCardTemplate();
+              case LoadingStatus.ERROR:
+                Logs.e(
+                  'product list item simple fatal error'
+                  ' on ${widget.barcode} (${_model.loadingError})',
+                );
+                return Text('Fatal Error: ${_model.loadingError}');
+              case LoadingStatus.LOADED:
+            }
+            if (_model.product == null) {
+              // TODO(monsieurtanuki): button "Something strange happened: would you like to download that product again?"
+              Logs.w(
+                'product list item simple / could not load ${widget.barcode}',
+              );
+              return Text(
+                  'Oops: could not load this product (${widget.barcode})');
+            }
+            return SmoothProductCardFound(
+              heroTag: _model.product!.barcode!,
+              product: _model.product!,
+              onTap: widget.onTap,
+              onLongPress: widget.onLongPress,
+              backgroundColor: widget.backgroundColor,
+            );
+          },
+        ),
       );
 }
diff --git a/packages/smooth_app/lib/pages/product/common/product_list_page.dart b/packages/smooth_app/lib/pages/product/common/product_list_page.dart
index 1403e1f96447..772298459b66 100644
--- a/packages/smooth_app/lib/pages/product/common/product_list_page.dart
+++ b/packages/smooth_app/lib/pages/product/common/product_list_page.dart
@@ -59,7 +59,7 @@ class _ProductListPageState extends State<ProductListPage>
     final ThemeData themeData = Theme.of(context);
     final ColorScheme colorScheme = Theme.of(context).colorScheme;
     final AppLocalizations appLocalizations = AppLocalizations.of(context);
-    final List<Product> products = productList.getList();
+    final List<String> products = productList.getList();
     final bool dismissible;
     switch (productList.listType) {
       case ProductListType.SCAN_SESSION:
@@ -213,20 +213,12 @@ class _ProductListPageState extends State<ProductListPage>
                           ListView.builder(
                         itemCount: products.length,
                         itemBuilder: (BuildContext context, int index) {
-                          Product product = products[index];
-                          final Product? refreshedProduct =
-                              provider.get(product);
-                          if (refreshedProduct != null) {
-                            product = refreshedProduct;
-                            productList.refresh(product);
-                          }
                           return _buildItem(
                             dismissible,
                             products,
                             index,
                             localDatabase,
                             appLocalizations,
-                            refreshedProduct,
                           );
                         },
                       ),
@@ -240,14 +232,12 @@ class _ProductListPageState extends State<ProductListPage>
 
   Widget _buildItem(
     final bool dismissible,
-    final List<Product> products,
+    final List<String> barcodes,
     final int index,
     final LocalDatabase localDatabase,
     final AppLocalizations appLocalizations,
-    final Product? refreshedProduct,
   ) {
-    final Product product = refreshedProduct ?? products[index];
-    final String barcode = product.barcode!;
+    final String barcode = barcodes[index];
     final bool selected = _selectedBarcodes.contains(barcode);
     void onTap() => setState(
           () {
@@ -273,7 +263,7 @@ class _ProductListPageState extends State<ProductListPage>
               ),
             Expanded(
               child: ProductListItemSimple(
-                product: product,
+                barcode: barcode,
                 onTap: _selectionMode ? onTap : null,
                 onLongPress: !_selectionMode
                     ? () => setState(() => _selectionMode = true)
@@ -297,16 +287,13 @@ class _ProductListPageState extends State<ProductListPage>
             color: Colors.white,
           ),
         ),
-        key: Key(product.barcode!),
+        key: Key(barcode),
         onDismissed: (final DismissDirection direction) async {
-          final bool removed = productList.remove(product.barcode!);
+          final bool removed = productList.remove(barcode);
           if (removed) {
             DaoProductList(localDatabase).put(productList);
-            _selectedBarcodes.remove(product.barcode);
-            setState(() => products.removeAt(index));
-          }
-          if (!mounted) {
-            return;
+            _selectedBarcodes.remove(barcode);
+            setState(() => barcodes.removeAt(index));
           }
           ScaffoldMessenger.of(context).showSnackBar(
             SnackBar(
@@ -324,14 +311,14 @@ class _ProductListPageState extends State<ProductListPage>
       );
     }
     return Container(
-      key: Key(product.barcode!),
+      key: Key(barcode),
       child: child,
     );
   }
 
   /// Calls the "refresh products" part with dialogs on top.
   Future<void> _refreshListProducts(
-    final List<Product> products,
+    final List<String> products,
     final LocalDatabase localDatabase,
     final AppLocalizations appLocalizations,
   ) async {
@@ -369,14 +356,10 @@ class _ProductListPageState extends State<ProductListPage>
 
   /// Fetches the products from the API and refreshes the local database
   Future<bool> _reloadProducts(
-    final List<Product> products,
+    final List<String> barcodes,
     final LocalDatabase localDatabase,
   ) async {
     try {
-      final List<String> barcodes = <String>[];
-      for (final Product product in products) {
-        barcodes.add(product.barcode!);
-      }
       final SearchResult searchResult = await OpenFoodAPIClient.getProductList(
         ProductQuery.getUser(),
         ProductListQueryConfiguration(
@@ -391,7 +374,6 @@ class _ProductListPageState extends State<ProductListPage>
         return false;
       }
       await DaoProduct(localDatabase).putAll(freshProducts);
-      freshProducts.forEach(productList.refresh);
       final RobotoffInsightHelper robotoffInsightHelper =
           RobotoffInsightHelper(localDatabase);
       await robotoffInsightHelper.clearInsightAnnotationsSaved();
@@ -403,7 +385,7 @@ class _ProductListPageState extends State<ProductListPage>
   }
 
   Widget _buildCompareBar(
-    final List<Product> products,
+    final List<String> barcodes,
     final AppLocalizations appLocalizations,
   ) =>
       Row(
@@ -413,18 +395,21 @@ class _ProductListPageState extends State<ProductListPage>
             onPressed: _selectedBarcodes.length >=
                     2 // compare button is enabled only if 2 or more products have been selected
                 ? () async {
-                    final List<Product> list = <Product>[];
-                    for (final Product product in products) {
-                      if (_selectedBarcodes.contains(product.barcode)) {
-                        list.add(product);
+                    final List<String> list = <String>[];
+                    for (final String barcode in barcodes) {
+                      if (_selectedBarcodes.contains(barcode)) {
+                        list.add(barcode);
                       }
                     }
+                    if (!mounted) {
+                      return;
+                    }
                     await Navigator.push<Widget>(
                       context,
                       MaterialPageRoute<Widget>(
                         builder: (BuildContext context) =>
                             PersonalizedRankingPage(
-                          products: list,
+                          barcodes: list,
                           title: appLocalizations.product_list_your_ranking,
                         ),
                       ),
diff --git a/packages/smooth_app/lib/pages/product/common/product_model.dart b/packages/smooth_app/lib/pages/product/common/product_model.dart
new file mode 100644
index 000000000000..073c5aee4e73
--- /dev/null
+++ b/packages/smooth_app/lib/pages/product/common/product_model.dart
@@ -0,0 +1,60 @@
+import 'package:flutter/material.dart';
+import 'package:openfoodfacts/openfoodfacts.dart';
+import 'package:smooth_app/database/dao_product.dart';
+import 'package:smooth_app/database/local_database.dart';
+
+/// Loading status.
+enum LoadingStatus {
+  LOADING,
+  LOADED,
+  ERROR,
+}
+
+/// Model for product database get and refresh.
+class ProductModel with ChangeNotifier {
+  /// In the constructor we retrieve async'ly the product from the local db.
+  ProductModel(this.barcode, this.localDatabase) {
+    _clear();
+    _asyncLoad(localDatabase);
+  }
+
+  final String barcode;
+  final LocalDatabase localDatabase;
+
+  Product? _product;
+  Product? get product =>
+      _loadingStatus == LoadingStatus.LOADED ? _product : null;
+
+  late LoadingStatus _loadingStatus;
+  LoadingStatus get loadingStatus => _loadingStatus;
+
+  String? _loadingError;
+  String? get loadingError => _loadingError;
+
+  /// To be called when the up-to-date provider says the product was refreshed.
+  void setRefreshedProduct(final Product? product) {
+    if (product == null) {
+      return;
+    }
+    _product = product;
+    _loadingStatus = LoadingStatus.LOADED;
+  }
+
+  void _clear() {
+    _loadingStatus = LoadingStatus.LOADING;
+    _loadingError = null;
+  }
+
+  Future<bool> _asyncLoad(final LocalDatabase localDatabase) async {
+    try {
+      final DaoProduct daoProduct = DaoProduct(localDatabase);
+      _product = await daoProduct.get(barcode);
+      _loadingStatus = LoadingStatus.LOADED;
+    } catch (e) {
+      _loadingError = e.toString();
+      _loadingStatus = LoadingStatus.ERROR;
+    }
+    notifyListeners();
+    return _loadingStatus == LoadingStatus.LOADED;
+  }
+}
diff --git a/packages/smooth_app/lib/pages/product/common/product_query_page.dart b/packages/smooth_app/lib/pages/product/common/product_query_page.dart
index 35221675a2c6..e4ca3550b886 100644
--- a/packages/smooth_app/lib/pages/product/common/product_query_page.dart
+++ b/packages/smooth_app/lib/pages/product/common/product_query_page.dart
@@ -6,11 +6,11 @@ import 'package:flutter/material.dart';
 import 'package:flutter_gen/gen_l10n/app_localizations.dart';
 import 'package:matomo_tracker/matomo_tracker.dart';
 import 'package:modal_bottom_sheet/modal_bottom_sheet.dart';
-import 'package:openfoodfacts/openfoodfacts.dart';
 import 'package:provider/provider.dart';
-import 'package:smooth_app/cards/product_cards/smooth_product_card_found.dart';
 import 'package:smooth_app/data_models/product_list_supplier.dart';
 import 'package:smooth_app/data_models/product_query_model.dart';
+import 'package:smooth_app/database/dao_product.dart';
+import 'package:smooth_app/database/local_database.dart';
 import 'package:smooth_app/generic_lib/animations/smooth_reveal_animation.dart';
 import 'package:smooth_app/generic_lib/design_constants.dart';
 import 'package:smooth_app/generic_lib/duration_constants.dart';
@@ -18,6 +18,7 @@ import 'package:smooth_app/generic_lib/loading_dialog.dart';
 import 'package:smooth_app/generic_lib/widgets/smooth_error_card.dart';
 import 'package:smooth_app/helpers/analytics_helper.dart';
 import 'package:smooth_app/pages/personalized_ranking_page.dart';
+import 'package:smooth_app/pages/product/common/product_list_item_simple.dart';
 import 'package:smooth_app/pages/product/common/product_query_page_helper.dart';
 import 'package:smooth_app/themes/constant_icons.dart';
 import 'package:smooth_app/views/bottom_sheet_views/group_query_filter_view.dart';
@@ -27,13 +28,11 @@ import 'package:smooth_app/widgets/smooth_scaffold.dart';
 class ProductQueryPage extends StatefulWidget {
   const ProductQueryPage({
     required this.productListSupplier,
-    required this.heroTag,
     required this.name,
     this.lastUpdate,
   });
 
   final ProductListSupplier productListSupplier;
-  final String heroTag;
   final String name;
   final int? lastUpdate;
 
@@ -65,7 +64,7 @@ class _ProductQueryPageState extends State<ProductQueryPage>
   void initState() {
     super.initState();
     _lastUpdate = widget.lastUpdate;
-    _model = ProductQueryModel(widget.productListSupplier);
+    _model = _getModel(widget.productListSupplier);
     _scrollController = ScrollController()
       ..addListener(() {
         setState(() {
@@ -93,25 +92,20 @@ class _ProductQueryPageState extends State<ProductQueryPage>
         final AppLocalizations appLocalizations = AppLocalizations.of(context);
         final Size screenSize = MediaQuery.of(context).size;
         final ThemeData themeData = Theme.of(context);
-        if (_model.loadingStatus == LoadingStatus.LOADED) {
-          _model.process(appLocalizations.category_all);
-        }
         switch (_model.loadingStatus) {
-          case LoadingStatus.POST_LOAD_STARTED:
           case LoadingStatus.LOADING:
-          case LoadingStatus.LOADED:
             return _getEmptyScreen(
               screenSize,
               themeData,
               const CircularProgressIndicator(),
             );
-          case LoadingStatus.COMPLETE:
+          case LoadingStatus.LOADED:
             if (_model.isNotEmpty()) {
               _showRefreshSnackBar(_scaffoldKeyNotEmpty);
               AnalyticsHelper.trackSearch(
                 search: widget.name,
                 searchCategory: _model.currentCategory,
-                searchCount: _model.displayProducts?.length,
+                searchCount: _model.displayBarcodes?.length,
               );
               return _getNotEmptyScreen(
                 screenSize,
@@ -149,10 +143,7 @@ class _ProductQueryPageState extends State<ProductQueryPage>
             leading: const _BackButton(),
             title: _getAppBarTitle(),
           ),
-          body: Hero(
-            tag: widget.heroTag,
-            child: Center(child: emptiness),
-          ),
+          body: Center(child: emptiness),
         ),
       );
 
@@ -176,7 +167,7 @@ class _ProductQueryPageState extends State<ProductQueryPage>
                   context,
                   MaterialPageRoute<Widget>(
                     builder: (BuildContext context) => PersonalizedRankingPage(
-                      products: _model.displayProducts!,
+                      barcodes: _model.displayBarcodes!,
                       title: widget.name,
                     ),
                   ),
@@ -211,142 +202,112 @@ class _ProductQueryPageState extends State<ProductQueryPage>
               ),
             ],
           ),
-          body: Stack(
-            children: <Widget>[
-              _getHero(screenSize, themeData),
-              RefreshIndicator(
-                onRefresh: () => refreshList(),
-                child: Scrollbar(
-                  child: CustomScrollView(
-                    controller: _scrollController,
-                    slivers: <Widget>[
-                      SliverAppBar(
-                        backgroundColor: themeData.scaffoldBackgroundColor,
-                        pinned: true,
-                        elevation: 0,
-                        automaticallyImplyLeading: false,
-                        leading: const _BackButton(),
-                        actions: <Widget>[
-                          TextButton.icon(
-                            icon: const Icon(Icons.filter_list),
-                            label: Text(
-                              appLocalizations.filter,
-                              style: themeData.textTheme.subtitle1,
-                            ),
-                            onPressed: () {
-                              showCupertinoModalBottomSheet<Widget>(
-                                expand: false,
-                                context: context,
-                                backgroundColor: Colors.transparent,
-                                bounce: true,
-                                builder: (BuildContext context) =>
-                                    GroupQueryFilterView(
-                                  categories: _model.categories,
-                                  categoriesList: _model.sortedCategories,
-                                  callback: (String category) {
-                                    _model.selectCategory(category);
-                                    setState(() {});
-                                  },
-                                ),
-                              );
-                            },
-                          )
-                        ],
-                        title: _getAppBarTitle(),
+          appBar: AppBar(
+            backgroundColor: themeData.scaffoldBackgroundColor,
+            elevation: 0,
+            automaticallyImplyLeading: false,
+            leading: const _BackButton(),
+            actions: <Widget>[
+              TextButton.icon(
+                icon: const Icon(Icons.filter_list),
+                label: Text(
+                  appLocalizations.filter,
+                  style: themeData.textTheme.subtitle1,
+                ),
+                onPressed: () {
+                  _model.setTranslationForAll(appLocalizations.category_all);
+                  showCupertinoModalBottomSheet<Widget>(
+                    expand: false,
+                    context: context,
+                    backgroundColor: Colors.transparent,
+                    bounce: true,
+                    builder: (BuildContext context) => GroupQueryFilterView(
+                      categories: _model.categories,
+                      categoriesList: _model.sortedCategories,
+                      callback: (String category) {
+                        _model.selectCategory(category);
+                        setState(() {});
+                      },
+                    ),
+                  );
+                },
+              )
+            ],
+            title: _getAppBarTitle(),
+          ),
+          body: RefreshIndicator(
+            onRefresh: () => refreshList(),
+            child: ListView.builder(
+              controller: _scrollController,
+              itemBuilder: (BuildContext context, int index) {
+                if (index >= _model.displayBarcodes!.length) {
+                  // final button
+                  final int already = _model.displayBarcodes!.length;
+                  final int totalSize =
+                      _model.supplier.partialProductList.totalSize;
+                  final int next = max(
+                    0,
+                    min(
+                      _model.supplier.productQuery.pageSize,
+                      totalSize - already,
+                    ),
+                  );
+                  final Widget child;
+                  if (next == 0) {
+                    child = Text(
+                      appLocalizations.product_search_no_more_results(
+                        totalSize,
                       ),
-                      SliverList(
-                        delegate: SliverChildBuilderDelegate(
-                          (BuildContext context, int index) {
-                            if (index >= _model.displayProducts!.length) {
-                              // final button
-                              final int already =
-                                  _model.displayProducts!.length;
-                              final int totalSize =
-                                  _model.supplier.partialProductList.totalSize;
-                              final int next = max(
-                                0,
-                                min(
-                                  _model.supplier.productQuery.pageSize,
-                                  totalSize - already,
-                                ),
-                              );
-                              final Widget child;
-                              if (next == 0) {
-                                child = Text(
-                                  appLocalizations
-                                      .product_search_no_more_results(
-                                    totalSize,
-                                  ),
-                                );
-                              } else {
-                                child = ElevatedButton.icon(
-                                  icon: const Icon(Icons.download_rounded),
-                                  label: Text(
-                                    appLocalizations
-                                        .product_search_button_download_more(
-                                      next,
-                                      already,
-                                      totalSize,
-                                    ),
-                                  ),
-                                  onPressed: () async {
-                                    final bool? error =
-                                        await LoadingDialog.run<bool>(
-                                      context: context,
-                                      future: _model.loadNextPage(),
-                                    );
-                                    if (error != true) {
-                                      await LoadingDialog.error(
-                                        context: context,
-                                        title: _model.loadingError,
-                                      );
-                                    }
-                                  },
-                                );
-                              }
-                              return Padding(
-                                padding: const EdgeInsetsDirectional.only(
-                                  bottom: 90.0,
-                                  start: VERY_LARGE_SPACE,
-                                  end: VERY_LARGE_SPACE,
-                                ),
-                                child: child,
-                              );
-                            }
-                            final Product product =
-                                _model.displayProducts![index];
-                            return Padding(
-                              padding: const EdgeInsets.symmetric(
-                                horizontal: MEDIUM_SPACE,
-                                vertical: SMALL_SPACE,
-                              ),
-                              child: SmoothProductCardFound(
-                                heroTag: product.barcode!,
-                                product: product,
-                              ),
-                            );
-                          },
-                          childCount: _model.displayProducts!.length + 1,
+                    );
+                  } else {
+                    child = ElevatedButton.icon(
+                      icon: const Icon(Icons.download_rounded),
+                      label: Text(
+                        appLocalizations.product_search_button_download_more(
+                          next,
+                          already,
+                          totalSize,
                         ),
                       ),
-                    ],
+                      onPressed: () async {
+                        final bool? success = await LoadingDialog.run<bool>(
+                          context: context,
+                          future: _model.loadNextPage(),
+                        );
+                        if (success == null) {
+                          return;
+                        } else if (success == false) {
+                          await LoadingDialog.error(
+                            context: context,
+                            title: _model.loadingError,
+                          );
+                        } else {
+                          setState(() {});
+                        }
+                      },
+                    );
+                  }
+                  return Padding(
+                    padding: const EdgeInsetsDirectional.only(
+                      bottom: 90.0,
+                      start: VERY_LARGE_SPACE,
+                      end: VERY_LARGE_SPACE,
+                    ),
+                    child: child,
+                  );
+                }
+                return Padding(
+                  padding: const EdgeInsets.symmetric(
+                    horizontal: MEDIUM_SPACE,
+                    vertical: SMALL_SPACE,
                   ),
-                ),
-              ),
-            ],
-          ),
-        ),
-      );
-
-  Widget _getHero(final Size screenSize, final ThemeData themeData) => Hero(
-        tag: widget.heroTag,
-        child: Container(
-          width: screenSize.width,
-          height: double.infinity,
-          padding: const EdgeInsetsDirectional.only(
-            start: 10.0,
-            end: 10.0,
-            top: 96.0,
+                  child: ProductListItemSimple(
+                    barcode: _model.displayBarcodes![index],
+                  ),
+                );
+              },
+              itemCount: _model.displayBarcodes!.length + 1,
+            ),
           ),
         ),
       );
@@ -428,21 +389,22 @@ class _ProductQueryPageState extends State<ProductQueryPage>
     );
   }
 
-  void retryConnection() {
-    setState(() {
-      _model = ProductQueryModel(widget.productListSupplier);
-    });
-  }
+  void retryConnection() =>
+      setState(() => _model = _getModel(widget.productListSupplier));
+
+  ProductQueryModel _getModel(final ProductListSupplier supplier) =>
+      ProductQueryModel(
+        supplier,
+        DaoProduct(context.read<LocalDatabase>()),
+      );
 
   Future<void> refreshList() async {
     final ProductListSupplier? refreshSupplier =
         widget.productListSupplier.getRefreshSupplier();
     setState(
       // How do we refresh a supplier that has no refresher? With itself.
-      () => _model =
-          ProductQueryModel(refreshSupplier ?? widget.productListSupplier),
+      () => _model = _getModel(refreshSupplier ?? widget.productListSupplier),
     );
-    return;
   }
 
   void _scrollToTop() {
diff --git a/packages/smooth_app/lib/pages/product/common/product_query_page_helper.dart b/packages/smooth_app/lib/pages/product/common/product_query_page_helper.dart
index 4afe7ba19a5e..0531b1673bea 100644
--- a/packages/smooth_app/lib/pages/product/common/product_query_page_helper.dart
+++ b/packages/smooth_app/lib/pages/product/common/product_query_page_helper.dart
@@ -10,7 +10,6 @@ class ProductQueryPageHelper {
   Future<void> openBestChoice({
     required final PagedProductQuery productQuery,
     required final LocalDatabase localDatabase,
-    required final String heroTag,
     required final String name,
     required final BuildContext context,
   }) async {
@@ -25,7 +24,6 @@ class ProductQueryPageHelper {
       MaterialPageRoute<Widget>(
         builder: (BuildContext context) => ProductQueryPage(
           productListSupplier: supplier,
-          heroTag: heroTag,
           name: name,
           lastUpdate: supplier.timestamp,
         ),
diff --git a/packages/smooth_app/lib/pages/product/summary_card.dart b/packages/smooth_app/lib/pages/product/summary_card.dart
index 9197703564ed..a5647a6e0553 100644
--- a/packages/smooth_app/lib/pages/product/summary_card.dart
+++ b/packages/smooth_app/lib/pages/product/summary_card.dart
@@ -305,7 +305,6 @@ class _SummaryCardState extends State<SummaryCard> {
             localizations.product_search_same_category,
             iconData: Icons.leaderboard,
             onPressed: () async => ProductQueryPageHelper().openBestChoice(
-              heroTag: 'search_bar',
               name: categoryLabel!,
               localDatabase: localDatabase,
               productQuery: CategoryProductQuery(categoryTag!),
diff --git a/packages/smooth_app/lib/pages/scan/scan_header.dart b/packages/smooth_app/lib/pages/scan/scan_header.dart
index ebfa44badd51..643eafa17748 100644
--- a/packages/smooth_app/lib/pages/scan/scan_header.dart
+++ b/packages/smooth_app/lib/pages/scan/scan_header.dart
@@ -4,14 +4,18 @@ import 'package:provider/provider.dart';
 import 'package:smooth_app/data_models/continuous_scan_model.dart';
 import 'package:smooth_app/generic_lib/design_constants.dart';
 import 'package:smooth_app/generic_lib/duration_constants.dart';
-import 'package:smooth_app/pages/scan/scan_page_helper.dart';
+import 'package:smooth_app/pages/personalized_ranking_page.dart';
+import 'package:smooth_app/pages/product/common/product_query_page_helper.dart';
 import 'package:smooth_app/widgets/ranking_floating_action_button.dart';
 
-class ScanHeader extends StatelessWidget {
-  const ScanHeader({
-    super.key,
-  });
+class ScanHeader extends StatefulWidget {
+  const ScanHeader();
 
+  @override
+  State<ScanHeader> createState() => _ScanHeaderState();
+}
+
+class _ScanHeaderState extends State<ScanHeader> {
   static const double _visibleOpacity = 0.8;
   static const double _invisibleOpacity = 0.0;
 
@@ -49,7 +53,26 @@ class ScanHeader extends StatelessWidget {
             ElevatedButton.icon(
               style: buttonStyle,
               icon: const Icon(RankingFloatingActionButton.rankingIconData),
-              onPressed: () => openPersonalizedRankingPage(context),
+              onPressed: () async {
+                final ContinuousScanModel model =
+                    context.read<ContinuousScanModel>();
+                await model.refreshProductList();
+                if (!mounted) {
+                  return;
+                }
+                await Navigator.push<Widget>(
+                  context,
+                  MaterialPageRoute<Widget>(
+                    builder: (BuildContext context) => PersonalizedRankingPage(
+                      barcodes: model.productList.barcodes,
+                      title: ProductQueryPageHelper.getProductListLabel(
+                        model.productList,
+                        context,
+                      ),
+                    ),
+                  ),
+                );
+              },
               label: Text(
                 appLocalizations.plural_compare_x_products(
                   model.getBarcodes().length,
diff --git a/packages/smooth_app/lib/pages/scan/scan_page_helper.dart b/packages/smooth_app/lib/pages/scan/scan_page_helper.dart
deleted file mode 100644
index 174d06c1337f..000000000000
--- a/packages/smooth_app/lib/pages/scan/scan_page_helper.dart
+++ /dev/null
@@ -1,23 +0,0 @@
-import 'package:flutter/material.dart';
-import 'package:provider/provider.dart';
-import 'package:smooth_app/data_models/continuous_scan_model.dart';
-import 'package:smooth_app/pages/personalized_ranking_page.dart';
-import 'package:smooth_app/pages/product/common/product_query_page_helper.dart';
-
-Future<void> openPersonalizedRankingPage(BuildContext context) async {
-  final ContinuousScanModel model = context.read<ContinuousScanModel>();
-  await model.refreshProductList();
-  //ignore: use_build_context_synchronously
-  await Navigator.push<Widget>(
-    context,
-    MaterialPageRoute<Widget>(
-      builder: (BuildContext context) => PersonalizedRankingPage(
-        products: model.productList.getList(),
-        title: ProductQueryPageHelper.getProductListLabel(
-          model.productList,
-          context,
-        ),
-      ),
-    ),
-  );
-}
diff --git a/packages/smooth_app/lib/pages/scan/scan_product_card_loader.dart b/packages/smooth_app/lib/pages/scan/scan_product_card_loader.dart
new file mode 100644
index 000000000000..4fc71fffa3ac
--- /dev/null
+++ b/packages/smooth_app/lib/pages/scan/scan_product_card_loader.dart
@@ -0,0 +1,35 @@
+import 'package:flutter/material.dart';
+import 'package:openfoodfacts/model/Product.dart';
+import 'package:provider/provider.dart';
+import 'package:smooth_app/cards/product_cards/smooth_product_card_loading.dart';
+import 'package:smooth_app/database/dao_product.dart';
+import 'package:smooth_app/database/local_database.dart';
+import 'package:smooth_app/pages/scan/scan_product_card.dart';
+
+/// Display of product for the scan page, after async load from local database.
+class ScanProductCardLoader extends StatelessWidget {
+  const ScanProductCardLoader(this.barcode);
+
+  final String barcode;
+
+  @override
+  Widget build(BuildContext context) {
+    final LocalDatabase localDatabase = context.watch<LocalDatabase>();
+    return FutureBuilder<Product?>(
+      future: DaoProduct(localDatabase).get(barcode),
+      builder: (
+        final BuildContext context,
+        final AsyncSnapshot<Product?> snapshot,
+      ) {
+        if (snapshot.connectionState != ConnectionState.done) {
+          return SmoothProductCardLoading(barcode: barcode);
+        }
+        if (snapshot.data != null) {
+          return ScanProductCard(snapshot.data!);
+        }
+        // TODO(monsieurtanuki): something like "hey, no product found, click to download) + LOGS
+        return Container();
+      },
+    );
+  }
+}
diff --git a/packages/smooth_app/lib/pages/scan/search_page.dart b/packages/smooth_app/lib/pages/scan/search_page.dart
index bafe0b12a379..7abe5cc6a3ae 100644
--- a/packages/smooth_app/lib/pages/scan/search_page.dart
+++ b/packages/smooth_app/lib/pages/scan/search_page.dart
@@ -79,7 +79,6 @@ Future<void> _onSubmittedText(
   final LocalDatabase localDatabase,
 ) async =>
     ProductQueryPageHelper().openBestChoice(
-      heroTag: 'search_bar',
       name: value,
       localDatabase: localDatabase,
       productQuery: KeywordsProductQuery(value),
diff --git a/packages/smooth_app/lib/pages/tmp_matched_product_v2.dart b/packages/smooth_app/lib/pages/tmp_matched_product_v2.dart
new file mode 100644
index 000000000000..371ecd89437b
--- /dev/null
+++ b/packages/smooth_app/lib/pages/tmp_matched_product_v2.dart
@@ -0,0 +1,158 @@
+import 'package:openfoodfacts/model/Attribute.dart';
+import 'package:openfoodfacts/model/AttributeGroup.dart';
+import 'package:openfoodfacts/model/Product.dart';
+import 'package:openfoodfacts/personalized_search/matched_product_v2.dart';
+import 'package:openfoodfacts/personalized_search/preference_importance.dart';
+import 'package:openfoodfacts/personalized_search/product_preferences_manager.dart';
+
+// TODO(monsieurtanuki): merge to off-dart
+/// This is a copy of the algorithm in off-dart's [MatchedProductV2].
+/// The idea behind is to do the same computing, but without having to store
+/// the product. Because in the rest of the app we never need all the products
+/// in memory.
+/// Another solution would be to store, instead of the product, just the
+/// attributeGroups (id => match and status)
+/// Should be merged into off-dart this way:
+/// * add [MatchedScoreV2]
+/// * make [MatchedProductV2] extend [MatchedScoreV2]
+/// * deprecated some methods too, if possible.
+class MatchedScoreV2 {
+  MatchedScoreV2(
+    final Product product,
+    final ProductPreferencesManager productPreferencesManager,
+  ) : barcode = product.barcode! {
+    _score = 0;
+    _debug = '';
+
+    final List<AttributeGroup>? attributeGroups = product.attributeGroups;
+    if (attributeGroups == null) {
+      // the product does not have the attribute_groups field
+      _status = MatchedProductStatusV2.UNKNOWN_MATCH;
+      _debug = 'no attribute_groups';
+      return;
+    }
+
+    int sumOfFactors = 0;
+    int sumOfFactorsForUnknownAttributes = 0;
+    bool mayNotMatch = false;
+    bool doesNotMatch = false;
+    bool isUnknown = false;
+
+    for (final AttributeGroup group in attributeGroups) {
+      if (group.attributes == null) {
+        continue;
+      }
+      for (final Attribute attribute in group.attributes!) {
+        final String attributeId = attribute.id!;
+        final double match = attribute.match ?? 0;
+        final String importanceId = productPreferencesManager
+            .getImportanceIdForAttributeId(attributeId);
+
+        if (importanceId == PreferenceImportance.ID_NOT_IMPORTANT) {
+          // Ignore attribute
+          _debug += '$attributeId $importanceId\n';
+          continue;
+        }
+
+        final int factor = _preferencesFactors[importanceId]!;
+        sumOfFactors += factor;
+
+        if (attribute.status == Attribute.STATUS_UNKNOWN) {
+          sumOfFactorsForUnknownAttributes += factor;
+          if (importanceId == PreferenceImportance.ID_MANDATORY) {
+            isUnknown = true;
+          }
+        } else {
+          _score += match * factor;
+          _debug += '$attributeId $importanceId - match: $match\n';
+
+          if (importanceId == PreferenceImportance.ID_MANDATORY) {
+            if (match <= 10) {
+              // Mandatory attribute with a very bad score (e.g. contains an allergen) -> status: does not match
+              doesNotMatch = true;
+            }
+            // Mandatory attribute with a bad score (e.g. may contain traces of an allergen) -> status: may not match
+            else if (match <= 50) {
+              mayNotMatch = true;
+            }
+          }
+        }
+      }
+    }
+
+    // Normalize the score from 0 to 100
+    if (sumOfFactors == 0) {
+      _score = 0;
+    } else {
+      _score /= sumOfFactors;
+    }
+
+    // If one of the attributes does not match, the product does not match
+    if (doesNotMatch) {
+      // Set score to 0 for products that do not match
+      _score = 0;
+      _status = MatchedProductStatusV2.DOES_NOT_MATCH;
+    } else if (mayNotMatch) {
+      _status = MatchedProductStatusV2.MAY_NOT_MATCH;
+    } else if (isUnknown) {
+      _status = MatchedProductStatusV2.UNKNOWN_MATCH;
+    }
+    // If too many attributes are unknown, set an unknown match
+    else if (sumOfFactorsForUnknownAttributes >= sumOfFactors / 2) {
+      _status = MatchedProductStatusV2.UNKNOWN_MATCH;
+    }
+    // If the product matches, check how well it matches user preferences
+    else if (score >= 75) {
+      _status = MatchedProductStatusV2.VERY_GOOD_MATCH;
+    } else if (score >= 50) {
+      _status = MatchedProductStatusV2.GOOD_MATCH;
+    } else {
+      _status = MatchedProductStatusV2.POOR_MATCH;
+    }
+  }
+
+  final String barcode;
+  double _score = 0;
+  late MatchedProductStatusV2 _status;
+  String _debug = '';
+  int _initialOrder = 0;
+
+  double get score => _score;
+
+  MatchedProductStatusV2 get status => _status;
+
+  String get debug => _debug;
+
+  /// Weights for score
+  static const Map<String, int> _preferencesFactors = <String, int>{
+    PreferenceImportance.ID_MANDATORY: 2,
+    PreferenceImportance.ID_VERY_IMPORTANT: 2,
+    PreferenceImportance.ID_IMPORTANT: 1,
+    PreferenceImportance.ID_NOT_IMPORTANT: 0,
+  };
+
+  static void sort(final List<MatchedScoreV2> scores) {
+    int i = 0;
+    for (final MatchedScoreV2 score in scores) {
+      score._initialOrder = i++;
+    }
+    scores.sort(
+      (MatchedScoreV2 a, MatchedScoreV2 b) {
+        late int compare;
+        // Highest score first
+        compare = b.score.compareTo(a.score);
+        if (compare != 0) {
+          return compare;
+        }
+        // Matching products second
+        compare = (b.status == MatchedProductStatusV2.DOES_NOT_MATCH ? 0 : 1) -
+            (a.status == MatchedProductStatusV2.DOES_NOT_MATCH ? 0 : 1);
+        if (compare != 0) {
+          return compare;
+        }
+        // Initial order third
+        return a._initialOrder.compareTo(b._initialOrder);
+      },
+    );
+  }
+}
diff --git a/packages/smooth_app/lib/views/bottom_sheet_views/group_query_filter_view.dart b/packages/smooth_app/lib/views/bottom_sheet_views/group_query_filter_view.dart
index b3a4dd23ff58..dc9fc17ca18c 100644
--- a/packages/smooth_app/lib/views/bottom_sheet_views/group_query_filter_view.dart
+++ b/packages/smooth_app/lib/views/bottom_sheet_views/group_query_filter_view.dart
@@ -3,7 +3,7 @@ import 'dart:ui';
 import 'package:flutter/material.dart';
 import 'package:flutter_gen/gen_l10n/app_localizations.dart';
 import 'package:provider/provider.dart';
-import 'package:smooth_app/generic_lib/buttons/smooth_main_button.dart';
+import 'package:smooth_app/generic_lib/buttons/smooth_large_button_with_icon.dart';
 import 'package:smooth_app/generic_lib/design_constants.dart';
 
 class GroupQueryFilterView extends StatelessWidget {
@@ -147,14 +147,13 @@ class GroupQueryFilterView extends StatelessWidget {
                             sigmaX: 4.0,
                             sigmaY: 4.0,
                           ),
-                          child: Container(
-                            color: Colors.black12,
+                          child: Padding(
                             padding: const EdgeInsets.symmetric(
                                 horizontal: MEDIUM_SPACE,
                                 vertical: VERY_LARGE_SPACE),
-                            child: SmoothMainButton(
-                              text:
-                                  AppLocalizations.of(context).applyButtonText,
+                            child: SmoothLargeButtonWithIcon(
+                              icon: Icons.filter_list_outlined,
+                              text: appLocalizations.applyButtonText,
                               onPressed: () {
                                 Navigator.pop(context);
                                 callback(
diff --git a/packages/smooth_app/lib/widgets/smooth_product_carousel.dart b/packages/smooth_app/lib/widgets/smooth_product_carousel.dart
index 552a60b292e1..7dc45a835645 100644
--- a/packages/smooth_app/lib/widgets/smooth_product_carousel.dart
+++ b/packages/smooth_app/lib/widgets/smooth_product_carousel.dart
@@ -5,7 +5,6 @@ import 'package:carousel_slider/carousel_slider.dart';
 import 'package:flutter/material.dart';
 import 'package:flutter_gen/gen_l10n/app_localizations.dart';
 import 'package:flutter_svg/flutter_svg.dart';
-import 'package:openfoodfacts/model/Product.dart';
 import 'package:provider/provider.dart';
 import 'package:smooth_app/cards/product_cards/smooth_product_card_error.dart';
 import 'package:smooth_app/cards/product_cards/smooth_product_card_loading.dart';
@@ -17,7 +16,7 @@ import 'package:smooth_app/data_models/user_preferences.dart';
 import 'package:smooth_app/generic_lib/design_constants.dart';
 import 'package:smooth_app/generic_lib/widgets/smooth_card.dart';
 import 'package:smooth_app/pages/inherited_data_manager.dart';
-import 'package:smooth_app/pages/scan/scan_product_card.dart';
+import 'package:smooth_app/pages/scan/scan_product_card_loader.dart';
 import 'package:smooth_app/pages/scan/search_page.dart';
 import 'package:url_launcher/url_launcher.dart';
 import 'package:url_launcher/url_launcher_string.dart';
@@ -148,8 +147,7 @@ class _SmoothProductCarouselState extends State<SmoothProductCarousel> {
     switch (_model.getBarcodeState(barcode)!) {
       case ScannedProductState.FOUND:
       case ScannedProductState.CACHED:
-        final Product product = _model.getProduct(barcode);
-        return ScanProductCard(product);
+        return ScanProductCardLoader(barcode);
       case ScannedProductState.LOADING:
         return SmoothProductCardLoading(barcode: barcode);
       case ScannedProductState.NOT_FOUND:
