diff --git a/HabitRPG/AppDelegate.swift b/HabitRPG/AppDelegate.swift
index 200e2dc1f..abe61b972 100644
--- a/HabitRPG/AppDelegate.swift
+++ b/HabitRPG/AppDelegate.swift
@@ -344,8 +344,7 @@ class HabiticaAppDelegate: UIResponder, MessagingDelegate, UIApplicationDelegate
     }
     
     func applySearchAdAttribution() {
-        let defaults = UserDefaults.standard
-        if defaults.bool(forKey: "userWasAttributed") {
+        if UserDefaults.standard.bool(forKey: "userWasAttributed") {
             return
         }
         DispatchQueue.global(qos: .background).async {
@@ -356,7 +355,7 @@ class HabiticaAppDelegate: UIResponder, MessagingDelegate, UIApplicationDelegate
                 request.httpMethod = "POST"
                 request.setValue("text/plain", forHTTPHeaderField: "Content-Type")
                 request.httpBody = Data(attributionToken.utf8)
-                let task = URLSession.shared.dataTask(with: request as URLRequest) { (data, _, error) in
+                let task = URLSession.shared.dataTask(with: request as URLRequest) { [weak self] (data, _, error) in
                     if let error = error {
                         logger.log(error)
                         return
@@ -364,29 +363,13 @@ class HabiticaAppDelegate: UIResponder, MessagingDelegate, UIApplicationDelegate
                     guard let data = data else {
                         return
                     }
+
                     do {
                         guard let data = try JSONSerialization.jsonObject(with: data, options: .allowFragments) as? [String: Any] else {
                             return
                         }
-                        if let campaignId = data["campaignId"] as? Int {
-                            var analyticsData = [String: Any]()
-                            analyticsData["attribution"] = data["iad-attribution"]
-                            analyticsData["campaignID"] = campaignId
-                            analyticsData["campaignName"] = data["iad-campaign-name"]
-                            analyticsData["purchaseDate"] = data["iad-purchase-date"]
-                            analyticsData["conversionDate"] = data["iad-conversion-date"]
-                            analyticsData["conversionType"] = data["iad-conversion-type"]
-                            analyticsData["clickDate"] = data["iad-click-date"]
-                            analyticsData["keyword"] = data["iad-keyword"]
-                            analyticsData["keywordMatchtype"] = data["iad-keyword-matchtype"]
-                            defaults.set(true, forKey: "userWasAttributed")
-                            Amplitude.instance().setUserProperties([
-                                "clickedSearchAd": data["iad-attribution"] ?? "",
-                                "searchAdName": data["iad-campaign-name"] ?? "",
-                                "searchAdConversionDate": data["iad-conversion-date"] ?? ""
-                            ])
-                        } else {
-                        }
+
+                        self?.handleCampaign(data)
                     } catch {
                         if (error as NSError).code == 3840 {
                             defaults.set(true, forKey: "userWasAttributed")
@@ -403,6 +386,30 @@ class HabiticaAppDelegate: UIResponder, MessagingDelegate, UIApplicationDelegate
         }
     }
     
+    private func handleCampaign(_ data: [String: Any]) {
+        guard let campaignId = data["campaignId"] as? Int else {
+            return
+        }
+
+        var analyticsData = [String: Any]()
+        analyticsData["attribution"] = data["iad-attribution"]
+        analyticsData["campaignID"] = campaignId
+        analyticsData["campaignName"] = data["iad-campaign-name"]
+        analyticsData["purchaseDate"] = data["iad-purchase-date"]
+        analyticsData["conversionDate"] = data["iad-conversion-date"]
+        analyticsData["conversionType"] = data["iad-conversion-type"]
+        analyticsData["clickDate"] = data["iad-click-date"]
+        analyticsData["keyword"] = data["iad-keyword"]
+        analyticsData["keywordMatchtype"] = data["iad-keyword-matchtype"]
+
+        UserDefaults.standard.set(true, forKey: "userWasAttributed")
+        Amplitude.instance().setUserProperties([
+            "clickedSearchAd": data["iad-attribution"] ?? "",
+            "searchAdName": data["iad-campaign-name"] ?? "",
+            "searchAdConversionDate": data["iad-conversion-date"] ?? ""
+        ])
+    }
+    
     static func isRunningScreenshots() -> Bool {
         #if !targetEnvironment(simulator)
         return false
diff --git a/HabitRPG/UI/Settings/AccountSettingsViewController.swift b/HabitRPG/UI/Settings/AccountSettingsViewController.swift
index 5bdb21f52..2081f3cc6 100644
--- a/HabitRPG/UI/Settings/AccountSettingsViewController.swift
+++ b/HabitRPG/UI/Settings/AccountSettingsViewController.swift
@@ -66,6 +66,7 @@ class AccountSettingsViewController: FormViewController, Themeable, UITextFieldD
         buildDangerSection()
     }
     
+    //MARK: - Build Info Section
     func buildAccountInfoSection() {
         form +++ Section(L10n.Settings.accountInfo)
         <<< LabelRow { row in
@@ -102,6 +103,7 @@ class AccountSettingsViewController: FormViewController, Themeable, UITextFieldD
         }
     }
     
+    //MARK: - Build LoginMethods Section
     func buildLoginMethodsSection() {
         form +++ Section(L10n.Settings.loginMethods)
         <<< LabelRow { row in
@@ -182,6 +184,7 @@ class AccountSettingsViewController: FormViewController, Themeable, UITextFieldD
         }
     }
     
+    //MARK: - Build Profile Section
     func buildPublicProfileSection() {
         form +++ Section(L10n.Settings.publicProfile)
         <<< LabelRow { row in
@@ -222,6 +225,7 @@ class AccountSettingsViewController: FormViewController, Themeable, UITextFieldD
         }
     }
     
+    //MARK: - Build API Section
     func buildApiSection() {
         form +++ Section(L10n.Settings.api)
         <<< LabelRow { row in
@@ -256,6 +260,7 @@ class AccountSettingsViewController: FormViewController, Themeable, UITextFieldD
             }
         }
     
+    //MARK: - Build Danger Section
     func buildDangerSection() {
         form +++ Section(L10n.Settings.dangerZone)
         <<< ButtonRow { row in
@@ -279,24 +284,24 @@ class AccountSettingsViewController: FormViewController, Themeable, UITextFieldD
     @IBAction func unwindToListSave(_ segue: UIStoryboardSegue) {
     }
 
-private func setUser(_ user: UserProtocol) {
-    if !user.isValid {
-        self.user = nil
-        return
-    }
-    isSettingUserData = true
-    if user.authentication?.hasFacebookAuth == true {
-        form.rowBy(tag: "facebookRow")?.hidden = false
-    } else {
-        form.rowBy(tag: "facebookRow")?.hidden = true
-    }
-    form.rowBy(tag: "facebookRow")?.evaluateHidden()
-    isSettingUserData = false
-    self.tableView.reloadData()
-    form.allRows.forEach { row in
-        row.updateCell()
+    private func setUser(_ user: UserProtocol) {
+        if !user.isValid {
+            self.user = nil
+            return
+        }
+        isSettingUserData = true
+        if user.authentication?.hasFacebookAuth == true {
+            form.rowBy(tag: "facebookRow")?.hidden = false
+        } else {
+            form.rowBy(tag: "facebookRow")?.hidden = true
+        }
+        form.rowBy(tag: "facebookRow")?.evaluateHidden()
+        isSettingUserData = false
+        self.tableView.reloadData()
+        form.allRows.forEach { row in
+            row.updateCell()
+        }
     }
-}
 
     private func copyToClipboard(_ name: String, value: String?) {
         let pasteboard = UIPasteboard.general
