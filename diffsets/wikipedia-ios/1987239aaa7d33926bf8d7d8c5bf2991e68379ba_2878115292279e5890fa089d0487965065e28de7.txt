diff --git a/Wikipedia/Code/WMFAppViewController.m b/Wikipedia/Code/WMFAppViewController.m
index 729eb83c353..d2efa503bc5 100644
--- a/Wikipedia/Code/WMFAppViewController.m
+++ b/Wikipedia/Code/WMFAppViewController.m
@@ -112,7 +112,7 @@ @interface WMFAppViewController () <UITabBarControllerDelegate, UINavigationCont
 @property (nonatomic, strong) WMFArticlePreviewDataStore *previewStore;
 @property (nonatomic, strong) WMFContentGroupDataStore *contentStore;
 
-@property (nonatomic, strong) NSArray<id<WMFContentSource>>* contentSources;
+@property (nonatomic, strong) NSArray<id<WMFContentSource>> *contentSources;
 
 @property (nonatomic) BOOL isPresentingOnboarding;
 
@@ -153,7 +153,7 @@ - (BOOL)uiIsLoaded {
     return _rootTabBarController != nil;
 }
 
-- (NSURL*)siteURL{
+- (NSURL *)siteURL {
     return [[[MWKLanguageLinkController sharedInstance] appLanguage] siteURL];
 }
 
@@ -299,18 +299,17 @@ - (void)finishLaunch {
     @weakify(self)
         [self presentOnboardingIfNeededWithCompletion:^(BOOL didShowOnboarding) {
             @strongify(self)
-            self.previewStore = [[WMFArticlePreviewDataStore alloc] initWithDatabase:[YapDatabase sharedInstance]];
+                self.previewStore = [[WMFArticlePreviewDataStore alloc] initWithDatabase:[YapDatabase sharedInstance]];
             self.contentStore = [[WMFContentGroupDataStore alloc] initWithDatabase:[YapDatabase sharedInstance]];
-            
+
             [self preloadContentSourcesIfNeededWithCompletion:^{
                 [self loadMainUI];
                 [self hideSplashViewAnimated:!didShowOnboarding];
                 [self resumeApp];
                 [[PiwikTracker wmf_configuredInstance] wmf_logView:[self rootViewControllerForTab:WMFAppTabTypeExplore]];
             }];
-            
+
         }];
-    
 }
 
 #pragma mark - Start/Pause/Resume App
@@ -355,8 +354,6 @@ - (void)resumeApp {
     //        [[WMFAlertManager sharedInstance] showAlert:@"You have been notified" sticky:NO dismissPreviousAlerts:NO tapCallBack:NULL];
     //    }
 
-    [self.notificationsController start];
-
     DDLogWarn(@"Resuming… Logging Important Statistics");
     [self logImportantStatistics];
 }
@@ -371,7 +368,6 @@ - (void)pauseApp {
     [self.dataStore clearMemoryCache];
     [self.savedArticlesFetcher stop];
     [self stopContentSources];
-    [self.notificationsController stop];
 
     DDLogWarn(@"Backgrounding… Logging Important Statistics");
     [self logImportantStatistics];
@@ -413,85 +409,96 @@ - (WMFDailyStatsLoggingFunnel *)statsFunnel {
 #pragma mark - Content Sources
 
 - (void)preloadContentSourcesIfNeededWithCompletion:(void (^)(void))completion {
-    
-    if([[NSUserDefaults wmf_userDefaults] wmf_didMigrateToNewFeed]){
-        if(completion){
+
+    if ([[NSUserDefaults wmf_userDefaults] wmf_didMigrateToNewFeed]) {
+        if (completion) {
             completion();
         }
-    }else{
-        WMFTaskGroup* group = [WMFTaskGroup new];
-        [self.contentSources enumerateObjectsUsingBlock:^(id<WMFContentSource>  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
-            
-            if([obj respondsToSelector:@selector(preloadContentForNumberOfDays:completion:)]){
+    } else {
+        WMFTaskGroup *group = [WMFTaskGroup new];
+        [self.contentSources enumerateObjectsUsingBlock:^(id<WMFContentSource> _Nonnull obj, NSUInteger idx, BOOL *_Nonnull stop) {
+
+            if ([obj respondsToSelector:@selector(preloadContentForNumberOfDays:completion:)]) {
                 [group enter];
-                [obj preloadContentForNumberOfDays:2 completion:^{
-                    [group leave];
-                }];
+                [obj preloadContentForNumberOfDays:2
+                                        completion:^{
+                                            [group leave];
+                                        }];
             }
         }];
-        
+
         [group waitInBackgroundWithCompletion:^{
             [[NSUserDefaults wmf_userDefaults] wmf_setDidMigrateToNewFeed:YES];
-            if(completion){
+            if (completion) {
                 completion();
             }
         }];
     }
-
 }
 
-
-- (void)updateFeedSourcesWithCompletion:(dispatch_block_t)completion{
-    WMFTaskGroup* group = [WMFTaskGroup new];
-    [self.contentSources enumerateObjectsUsingBlock:^(id<WMFContentSource>  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
+- (void)updateFeedSourcesWithCompletion:(dispatch_block_t)completion {
+    WMFTaskGroup *group = [WMFTaskGroup new];
+    [self.contentSources enumerateObjectsUsingBlock:^(id<WMFContentSource> _Nonnull obj, NSUInteger idx, BOOL *_Nonnull stop) {
         [group enter];
-        [obj loadNewContentForce:NO completion:^{
-            [group leave];
-        }];
+        [obj loadNewContentForce:NO
+                      completion:^{
+                          [group leave];
+                      }];
     }];
-    
+
     //TODO: nearby doesnt always fire.
     //May need to time it out or exclude
     [group waitInBackgroundWithCompletion:^{
-        if(completion){
+        if (completion) {
             completion();
         }
     }];
 }
 
-- (void)startContentSources{
+- (void)startContentSources {
     [self.contentSources makeObjectsPerformSelector:@selector(startUpdating)];
 }
 
-- (void)stopContentSources{
+- (void)stopContentSources {
     [self.contentSources makeObjectsPerformSelector:@selector(stopUpdating)];
 }
 
-- (WMFNearbyContentSource*)nearbyContentSource{
+- (WMFNearbyContentSource *)nearbyContentSource {
     return [self.contentSources bk_match:^BOOL(id<WMFContentSource> obj) {
         return [obj isKindOfClass:[WMFNearbyContentSource class]];
     }];
 }
 
-- (NSArray<id<WMFContentSource>>*)contentSources{
+- (NSArray<id<WMFContentSource>> *)contentSources {
     NSParameterAssert(self.contentStore);
     NSParameterAssert(self.dataStore);
     NSParameterAssert(self.previewStore);
     NSParameterAssert([self siteURL]);
-    if(!_contentSources){
+    if (!_contentSources) {
         _contentSources = @[
-                            [[WMFRelatedPagesContentSource alloc] initWithContentGroupDataStore:self.contentStore userDataStore:self.dataStore articlePreviewDataStore:self.previewStore],
-                            [[WMFMainPageContentSource alloc] initWithSiteURL:[self siteURL] contentGroupDataStore:self.contentStore articlePreviewDataStore:self.previewStore],
-                            [[WMFContinueReadingContentSource alloc] initWithContentGroupDataStore:self.contentStore userDataStore:self.dataStore articlePreviewDataStore:self.previewStore],
-                            [[WMFNearbyContentSource alloc] initWithSiteURL:[self siteURL] contentGroupDataStore:self.contentStore articlePreviewDataStore:self.previewStore],
-                            [[WMFFeedContentSource alloc] initWithSiteURL:[self siteURL] contentGroupDataStore:self.contentStore articlePreviewDataStore:self.previewStore],
-                            [[WMFRandomContentSource alloc] initWithSiteURL:[self siteURL] contentGroupDataStore:self.contentStore articlePreviewDataStore:self.previewStore]
-                            ];
+            [[WMFRelatedPagesContentSource alloc] initWithContentGroupDataStore:self.contentStore
+                                                                  userDataStore:self.dataStore
+                                                        articlePreviewDataStore:self.previewStore],
+            [[WMFMainPageContentSource alloc] initWithSiteURL:[self siteURL]
+                                        contentGroupDataStore:self.contentStore
+                                      articlePreviewDataStore:self.previewStore],
+            [[WMFContinueReadingContentSource alloc] initWithContentGroupDataStore:self.contentStore
+                                                                     userDataStore:self.dataStore
+                                                           articlePreviewDataStore:self.previewStore],
+            [[WMFNearbyContentSource alloc] initWithSiteURL:[self siteURL]
+                                      contentGroupDataStore:self.contentStore
+                                    articlePreviewDataStore:self.previewStore],
+            [[WMFFeedContentSource alloc] initWithSiteURL:[self siteURL]
+                                    contentGroupDataStore:self.contentStore
+                                  articlePreviewDataStore:self.previewStore],
+            [[WMFRandomContentSource alloc] initWithSiteURL:[self siteURL]
+                                      contentGroupDataStore:self.contentStore
+                                    articlePreviewDataStore:self.previewStore]
+        ];
     }
     return _contentSources;
 }
 
-
 #pragma mark - Shortcut
 
 - (BOOL)canProcessShortcutItem:(UIApplicationShortcutItem *)item {
@@ -606,18 +613,18 @@ - (BOOL)processUserActivity:(NSUserActivity *)activity {
             if (date == nil || host == nil) {
                 break;
             }
-//            MWKDataStore *dataStore = [[SessionSingleton sharedInstance] dataStore];
-//            [dataStore readWithBlock:^(YapDatabaseReadTransaction *_Nonnull transaction) {
-//                NSString *collection = [@[@"wmftopread", host] componentsJoinedByString:@":"];
-//                NSString *key = [[NSDateFormatter wmf_englishUTCNonDelimitedYearMonthDayFormatter] stringFromDate:date];
-//                NSArray *previews = [transaction objectForKey:key inCollection:collection];
-//                if ([previews count] > 0) {
-//                    dispatch_async(dispatch_get_main_queue(), ^{
-//                        WMFMostReadListTableViewController *mostReadListVC = [[WMFMostReadListTableViewController alloc] initWithPreviews:previews fromSiteURL:siteURL forDate:date dataStore:dataStore];
-//                        [navController pushViewController:mostReadListVC animated:NO];
-//                    });
-//                }
-//            }];
+            //            MWKDataStore *dataStore = [[SessionSingleton sharedInstance] dataStore];
+            //            [dataStore readWithBlock:^(YapDatabaseReadTransaction *_Nonnull transaction) {
+            //                NSString *collection = [@[@"wmftopread", host] componentsJoinedByString:@":"];
+            //                NSString *key = [[NSDateFormatter wmf_englishUTCNonDelimitedYearMonthDayFormatter] stringFromDate:date];
+            //                NSArray *previews = [transaction objectForKey:key inCollection:collection];
+            //                if ([previews count] > 0) {
+            //                    dispatch_async(dispatch_get_main_queue(), ^{
+            //                        WMFMostReadListTableViewController *mostReadListVC = [[WMFMostReadListTableViewController alloc] initWithPreviews:previews fromSiteURL:siteURL forDate:date dataStore:dataStore];
+            //                        [navController pushViewController:mostReadListVC animated:NO];
+            //                    });
+            //                }
+            //            }];
         } break;
         case WMFUserActivityTypeSavedPages:
             [self.rootTabBarController setSelectedIndex:WMFAppTabTypeSaved];
@@ -716,8 +723,8 @@ - (SavedArticlesFetcher *)savedArticlesFetcher {
     }
     if (!_savedArticlesFetcher) {
         _savedArticlesFetcher =
-        [[SavedArticlesFetcher alloc] initWithDataStore:[[SessionSingleton sharedInstance] dataStore]
-                                           previewStore:self.previewStore
+            [[SavedArticlesFetcher alloc] initWithDataStore:[[SessionSingleton sharedInstance] dataStore]
+                                               previewStore:self.previewStore
                                               savedPageList:[self.dataStore savedPageList]];
     }
     return _savedArticlesFetcher;
@@ -898,8 +905,8 @@ - (void)showRandomArticleAnimated:(BOOL)animated {
     if (exploreNavController.presentedViewController) {
         [exploreNavController dismissViewControllerAnimated:NO completion:NULL];
     }
-    
-    WMFFirstRandomViewController* vc = [[WMFFirstRandomViewController alloc] initWithSiteURL:[self siteURL] dataStore:self.dataStore previewStore:self.previewStore];
+
+    WMFFirstRandomViewController *vc = [[WMFFirstRandomViewController alloc] initWithSiteURL:[self siteURL] dataStore:self.dataStore previewStore:self.previewStore];
     [exploreNavController pushViewController:vc animated:animated];
 }
 
@@ -910,19 +917,20 @@ - (void)showNearbyListAnimated:(BOOL)animated {
         [exploreNavController dismissViewControllerAnimated:NO completion:NULL];
     }
     [[self navigationControllerForTab:WMFAppTabTypeExplore] popToRootViewControllerAnimated:NO];
-    [[self nearbyContentSource] loadNewContentForce:NO completion:^{
-        WMFContentGroup* nearby = [self.contentStore firstGroupOfKind:[WMFLocationContentGroup kind] forDate:[NSDate date]];
-        if(!nearby){
-            //TODO: show an error?
-            return;
-        }
-        
-        NSArray* urls = [self.contentStore contentForContentGroup:nearby];
-        
-        WMFMorePageListViewController* vc = [[WMFMorePageListViewController alloc] initWithGroup:nearby articleURLs:urls userDataStore:self.dataStore previewStore:self.previewStore];
-        vc.cellType = WMFMorePageListCellTypeLocation;
-        [[self navigationControllerForTab:WMFAppTabTypeExplore] pushViewController:vc animated:animated];
-    }];
+    [[self nearbyContentSource] loadNewContentForce:NO
+                                         completion:^{
+                                             WMFContentGroup *nearby = [self.contentStore firstGroupOfKind:[WMFLocationContentGroup kind] forDate:[NSDate date]];
+                                             if (!nearby) {
+                                                 //TODO: show an error?
+                                                 return;
+                                             }
+
+                                             NSArray *urls = [self.contentStore contentForContentGroup:nearby];
+
+                                             WMFMorePageListViewController *vc = [[WMFMorePageListViewController alloc] initWithGroup:nearby articleURLs:urls userDataStore:self.dataStore previewStore:self.previewStore];
+                                             vc.cellType = WMFMorePageListCellTypeLocation;
+                                             [[self navigationControllerForTab:WMFAppTabTypeExplore] pushViewController:vc animated:animated];
+                                         }];
 }
 
 #pragma mark - Download Assets
diff --git a/Wikipedia/Code/WMFNotificationsController.h b/Wikipedia/Code/WMFNotificationsController.h
index 68941ee2dc7..d75f8315e58 100644
--- a/Wikipedia/Code/WMFNotificationsController.h
+++ b/Wikipedia/Code/WMFNotificationsController.h
@@ -1,5 +1,6 @@
 #import <Foundation/Foundation.h>
 
+NS_ASSUME_NONNULL_BEGIN
 
 extern NSString *const WMFInTheNewsNotificationCategoryIdentifier;
 extern NSString *const WMFInTheNewsNotificationReadNowActionIdentifier;
@@ -15,7 +16,10 @@ extern NSString *const WMFNotificationInfoViewCountsKey;
 
 @interface WMFNotificationsController : NSObject
 
-- (void)start;
-- (void)stop;
+- (void)requestAuthenticationIfNecessaryWithCompletionHandler:(void (^)(BOOL granted, NSError *__nullable error))completionHandler;
+
+- (void)sendNotificationWithTitle:(NSString *)title body:(NSString *)body categoryIdentifier:(NSString *)categoryIdentifier  userInfo:(NSDictionary *)userInfo atDateComponents:(NSDateComponents *)dateComponents;
 
 @end
+
+NS_ASSUME_NONNULL_END
diff --git a/Wikipedia/Code/WMFNotificationsController.m b/Wikipedia/Code/WMFNotificationsController.m
index 5b34164e1d9..625c027c39d 100644
--- a/Wikipedia/Code/WMFNotificationsController.m
+++ b/Wikipedia/Code/WMFNotificationsController.m
@@ -19,38 +19,10 @@
 NSString *const WMFNotificationInfoStoryHTMLKey = @"storyHTML";
 NSString *const WMFNotificationInfoViewCountsKey = @"viewCounts";
 
-const CGFloat WMFNotificationImageCropNormalizedMinDimension = 1; //for some reason, cropping isn't respected if a full dimension (1) is indicated
-
-@interface WMFNotificationsController ()
-@property (nonatomic, strong) dispatch_queue_t notificationQueue;
-@property (nonatomic, strong) dispatch_source_t notificationSource;
-@end
+//const CGFloat WMFNotificationImageCropNormalizedMinDimension = 1; //for some reason, cropping isn't respected if a full dimension (1) is indicated
 
 @implementation WMFNotificationsController
 
-- (instancetype)init {
-    self = [super init];
-    if (self) {
-        self.notificationQueue = dispatch_queue_create("org.wikimedia.notifications", DISPATCH_QUEUE_SERIAL);
-    }
-    return self;
-}
-
-- (void)start {
-    [self requestAuthenticationIfNecessaryWithCompletionHandler:^(BOOL granted, NSError *_Nullable error) {
-        if (error) {
-            DDLogError(@"Error requesting authentication: %@", error);
-        }
-        dispatch_async(self.notificationQueue, ^{
-            self.notificationSource = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, self.notificationQueue);
-            dispatch_source_set_timer(self.notificationSource, DISPATCH_TIME_NOW, WMFNotificationUpdateInterval * NSEC_PER_SEC, WMFNotificationUpdateInterval * NSEC_PER_SEC / 10);
-            dispatch_source_set_event_handler(self.notificationSource, ^{
-                [self sendNotification];
-            });
-            dispatch_resume(self.notificationSource);
-        });
-    }];
-}
 
 - (void)requestAuthenticationIfNecessaryWithCompletionHandler:(void (^)(BOOL granted, NSError *__nullable error))completionHandler {
     UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
@@ -73,105 +45,116 @@ - (void)requestAuthenticationIfNecessaryWithCompletionHandler:(void (^)(BOOL gra
     [center requestAuthorizationWithOptions:UNAuthorizationOptionAlert | UNAuthorizationOptionSound completionHandler:completionHandler];
 }
 
-- (void)sendNotification {
-    NSString *thumbnailURLString = @"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/President_Barack_Obama.jpg/640px-President_Barack_Obama.jpg";
-    NSURL *thumbnailURL = [NSURL URLWithString:thumbnailURLString];
 
+- (NSString *)sendNotificationWithTitle:(NSString *)title body:(NSString *)body categoryIdentifier:(NSString *)categoryIdentifier userInfo:(NSDictionary *)userInfo atDateComponents:(NSDateComponents *)dateComponents withAttachements:(nullable NSArray <UNNotificationAttachment *>*)attachements {
+    UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
+    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
+    content.title = title;
+    content.body = body;
+    content.categoryIdentifier = categoryIdentifier;
+    content.attachments = attachements;
+    content.userInfo = userInfo;
+    UNCalendarNotificationTrigger *trigger = [UNCalendarNotificationTrigger triggerWithDateMatchingComponents:dateComponents repeats:NO];
+    NSString *identifier = [[NSUUID UUID] UUIDString];
+    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:identifier content:content trigger:trigger];
+    [center addNotificationRequest:request
+             withCompletionHandler:^(NSError *_Nullable error) {
+                 if (error) {
+                     DDLogError(@"Error adding notification request: %@", error);
+                 }
+             }];
+    return identifier;
+}
+
+- (void)sendNotificationWithTitle:(NSString *)title body:(NSString *)body categoryIdentifier:(NSString *)categoryIdentifier  userInfo:(NSDictionary *)userInfo atDateComponents:(NSDateComponents *)dateComponents {
+    
+    NSString *thumbnailURLString = userInfo[WMFNotificationInfoThumbnailURLStringKey];
+    if (!thumbnailURLString) {
+        [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:nil];
+        return;
+    }
+    
+    NSURL *thumbnailURL = [NSURL URLWithString:thumbnailURLString];
+    if (!thumbnailURL) {
+        [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:nil];
+        return;
+    }
+    
+    NSString *typeHint = nil;
+    NSString *pathExtension = thumbnailURL.pathExtension.lowercaseString;
+    if ([pathExtension isEqualToString:@"jpg"] || [pathExtension isEqualToString:@"jpeg"]) {
+        typeHint = (NSString *)kUTTypeJPEG;
+    }
+    
+    if (!typeHint) {
+        [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:nil];
+        return;
+    }
+    
     WMFImageController *imageController = [WMFImageController sharedInstance];
     [imageController cacheImageWithURLInBackground:thumbnailURL
         failure:^(NSError *_Nonnull error) {
-
-        }
-        success:^(BOOL didCache) {
+            [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:nil];
+        } success:^(BOOL didCache) {
             NSString *cachedThumbnailPath = [imageController cachePathForImageWithURL:thumbnailURL];
+            NSURL *cachedThumbnailURL = [NSURL fileURLWithPath:cachedThumbnailPath];
             UIImage *image = [UIImage imageWithContentsOfFile:cachedThumbnailPath];
-            CGFloat aspect = image.size.width / image.size.height;
+            
+            if (!cachedThumbnailURL || !image) {
+                [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:nil];
+                return;
+            }
+            
             WMFFaceDetectionCache *faceDetectionCache = [WMFFaceDetectionCache sharedCache];
             BOOL useGPU = YES;
+            UNNotificationAttachment *attachement = [UNNotificationAttachment attachmentWithIdentifier:thumbnailURLString
+                                                                                                   URL:cachedThumbnailURL
+                                                                                               options:@{ UNNotificationAttachmentOptionsTypeHintKey: typeHint, UNNotificationAttachmentOptionsThumbnailClippingRectKey: (__bridge_transfer NSDictionary *)CGRectCreateDictionaryRepresentation(CGRectMake(0, 0, 1, 1)) }
+                                                                                                 error:nil];
+            NSArray *imageAttachements = nil;
+            if (attachement) {
+                imageAttachements = @[attachement];
+            }
+         
             [faceDetectionCache detectFaceBoundsInImage:image
-                onGPU:useGPU
-                URL:thumbnailURL
-                failure:^(NSError *_Nonnull error) {
-
-                }
-                success:^(NSValue *_Nonnull faceRectValue) {
-                    CGRect cropRect = CGRectMake(0, 0, 1, 1);
-                    if (faceRectValue) {
-                        CGRect faceRect = [faceRectValue CGRectValue];
-                        if (aspect < 1) {
-                            CGFloat faceMidY = CGRectGetMidY(faceRect);
-                            CGFloat normalizedHeight = WMFNotificationImageCropNormalizedMinDimension * aspect;
-                            CGFloat halfNormalizedHeight = 0.5 * normalizedHeight;
-                            CGFloat originY = MAX(0, faceMidY - halfNormalizedHeight);
-                            CGFloat normalizedWidth = MAX(faceRect.size.width, WMFNotificationImageCropNormalizedMinDimension);
-                            CGFloat originX = 0.5 * (1 - normalizedWidth);
-                            cropRect = CGRectMake(originX, originY, normalizedWidth, normalizedHeight);
-                        } else {
-                            CGFloat faceMidX = CGRectGetMidX(faceRect);
-                            CGFloat normalizedWidth = WMFNotificationImageCropNormalizedMinDimension / aspect;
-                            CGFloat halfNormalizedWidth = 0.5 * normalizedWidth;
-                            CGFloat originX = MAX(0, faceMidX - halfNormalizedWidth);
-                            CGFloat normalizedHeight = MAX(faceRect.size.height, WMFNotificationImageCropNormalizedMinDimension);
-                            CGFloat originY = 0.5 * (1 - normalizedHeight);
-                            cropRect = CGRectMake(originX, originY, normalizedWidth, normalizedHeight);
-                        }
-                    }
-                    
-                    
-                    cropRect = CGRectApplyAffineTransform(cropRect, CGAffineTransformMakeScale(image.size.width, image.size.height));
-                    
-                    CGImageRef imageRef = CGImageCreateWithImageInRect(image.CGImage, cropRect);
-                    NSMutableData *data = [[NSMutableData alloc] init];
-                    CGImageDestinationRef destinationRef = CGImageDestinationCreateWithData((CFMutableDataRef)data, kUTTypeJPEG, 1, NULL);
-                    CGImageDestinationAddImage(destinationRef, imageRef, NULL);
-                    CGImageDestinationFinalize(destinationRef);
-                    NSURL *croppedURL = [NSURL URLWithString:@"wikimedia://bogus"];
-                    [imageController cacheImageData:data url:croppedURL MIMEType:@"image/jpeg"];
-                    NSString *cachedCroppedImagePath = [imageController cachePathForImageWithURL:croppedURL];
-
-                
-                    UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
-                    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
-                    NSString *HTMLString = @"<!--Sep 25--> The <b id=\"mwCw\"><a rel=\"mw:WikiLink\" href=\"./Five_hundred_meter_Aperture_Spherical_Telescope\" title=\"Five hundred meter Aperture Spherical Telescope\" id=\"mwDA\">Five hundred meter Aperture Spherical Telescope</a></b> (FAST) makes its <a rel=\"mw:WikiLink\" href=\"./First_light_(astronomy)\" title=\"First light (astronomy)\" id=\"mwDQ\">first observations</a> in <a rel=\"mw:WikiLink\" href=\"./Guizhou\" title=\"Guizhou\" id=\"mwDg\">Guizhou</a>, China.";
-                    content.title = NSLocalizedString(@"in-the-news-notification-title", nil);
-                    content.body = [HTMLString wmf_stringByRemovingHTML];
-                    content.categoryIdentifier = WMFInTheNewsNotificationCategoryIdentifier;
-                    UNNotificationAttachment *attachement = [UNNotificationAttachment attachmentWithIdentifier:thumbnailURLString
-                                                                                                           URL:[NSURL fileURLWithPath:cachedCroppedImagePath]
-                                                                                                       options:@{ UNNotificationAttachmentOptionsTypeHintKey: (id)kUTTypeJPEG, UNNotificationAttachmentOptionsThumbnailClippingRectKey: (__bridge_transfer NSDictionary *)CGRectCreateDictionaryRepresentation(CGRectMake(0, 0, 1, 1)) }
-                                                                                                         error:nil];
-                    if (attachement) {
-                        content.attachments = @[attachement];
-                    }
-                    content.userInfo = @{
-                        WMFNotificationInfoArticleTitleKey: @"Five hundred meter Aperture Spherical Telescope",
-                        WMFNotificationInfoArticleURLStringKey: @"https://en.wikipedia.org/wiki/Five_hundred_meter_Aperture_Spherical_Telescope",
-                        WMFNotificationInfoThumbnailURLStringKey: thumbnailURLString,
-                        WMFNotificationInfoArticleExtractKey: @"The Five hundred metre Aperture Spherical Telescope (FAST; Chinese: 五百米口径球面射电望远镜), nicknamed Tianyan (天眼, lit. \"Heavenly Eye\" or \"The Eye of Heaven\"), is a radio telescope located in the Dawodang depression (大窝凼洼地), a natural basin in Pingtang County, Guizhou Province, southwest China.",
-                        WMFNotificationInfoStoryHTMLKey: HTMLString,
-                        WMFNotificationInfoViewCountsKey: @[@110000, @123000, @145000, @210000, @198000, @235000, @867539]
-                    };
-                    UNTimeIntervalNotificationTrigger *trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:5 repeats:NO];
-                    NSString *identifier = [[NSUUID UUID] UUIDString];
-                    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:identifier content:content trigger:trigger];
-                    [center addNotificationRequest:request
-                             withCompletionHandler:^(NSError *_Nullable error) {
-                                 if (error) {
-                                     DDLogError(@"Error adding notification request: %@", error);
-                                 }
-                             }];
-                }];
-
-        }];
+                                                  onGPU:useGPU
+                                                    URL:thumbnailURL
+                                                failure:^(NSError *_Nonnull error) {
+                                                    [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:imageAttachements];
+                                                }
+                                                success:^(NSValue * faceRectValue) {
+                                                    if (faceRectValue) {
+                                                        //CGFloat aspect = image.size.width / image.size.height;
+                                                        //                                                    CGRect cropRect = CGRectMake(0, 0, 1, 1);
+                                                        //                                                    if (faceRectValue) {
+                                                        //                                                        CGRect faceRect = [faceRectValue CGRectValue];
+                                                        //                                                        if (aspect < 1) {
+                                                        //                                                            CGFloat faceMidY = CGRectGetMidY(faceRect);
+                                                        //                                                            CGFloat normalizedHeight = WMFNotificationImageCropNormalizedMinDimension * aspect;
+                                                        //                                                            CGFloat halfNormalizedHeight = 0.5 * normalizedHeight;
+                                                        //                                                            CGFloat originY = MAX(0, faceMidY - halfNormalizedHeight);
+                                                        //                                                            CGFloat normalizedWidth = MAX(faceRect.size.width, WMFNotificationImageCropNormalizedMinDimension);
+                                                        //                                                            CGFloat originX = 0.5 * (1 - normalizedWidth);
+                                                        //                                                            cropRect = CGRectMake(originX, originY, normalizedWidth, normalizedHeight);
+                                                        //                                                        } else {
+                                                        //                                                            CGFloat faceMidX = CGRectGetMidX(faceRect);
+                                                        //                                                            CGFloat normalizedWidth = WMFNotificationImageCropNormalizedMinDimension / aspect;
+                                                        //                                                            CGFloat halfNormalizedWidth = 0.5 * normalizedWidth;
+                                                        //                                                            CGFloat originX = MAX(0, faceMidX - halfNormalizedWidth);
+                                                        //                                                            CGFloat normalizedHeight = MAX(faceRect.size.height, WMFNotificationImageCropNormalizedMinDimension);
+                                                        //                                                            CGFloat originY = 0.5 * (1 - normalizedHeight);
+                                                        //                                                            cropRect = CGRectMake(originX, originY, normalizedWidth, normalizedHeight);
+                                                        //                                                        }
+                                                        //                                                    }
+
+                                                        //Since face cropping is broken, don't attach images with faces
+                                                        [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:nil];
+                                                    } else {
+                                                        [self sendNotificationWithTitle:title body:body categoryIdentifier:categoryIdentifier userInfo:userInfo atDateComponents:dateComponents withAttachements:imageAttachements];
+                                                    }
+                                                }];
+    }];
 }
 
-- (void)stop {
-    dispatch_async(self.notificationQueue, ^{
-        if (self.notificationSource) {
-            dispatch_source_cancel(self.notificationSource);
-            self.notificationSource = NULL;
-        }
-    });
-}
 
 @end
