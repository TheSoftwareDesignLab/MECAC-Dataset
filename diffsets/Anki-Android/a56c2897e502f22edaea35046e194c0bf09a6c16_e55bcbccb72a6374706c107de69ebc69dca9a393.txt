diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.kt b/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.kt
index 64d7e74998a6..fe8faebf7842 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.kt
@@ -19,6 +19,7 @@
 package com.ichi2.anki
 
 import android.content.*
+import android.content.res.Configuration
 import android.os.Bundle
 import android.os.SystemClock
 import android.text.TextUtils
@@ -29,6 +30,7 @@ import androidx.activity.result.ActivityResult
 import androidx.activity.result.contract.ActivityResultContracts.StartActivityForResult
 import androidx.annotation.CheckResult
 import androidx.annotation.ColorInt
+import androidx.annotation.MainThread
 import androidx.annotation.VisibleForTesting
 import androidx.appcompat.widget.SearchView
 import androidx.appcompat.widget.ThemeUtils
@@ -239,15 +241,9 @@ open class CardBrowser :
     }
 
     @VisibleForTesting(otherwise = VisibleForTesting.PROTECTED)
-    fun changeCardOrder(which: SortType) {
-        when (viewModel.changeCardOrder(which)) {
-            ChangeCardOrderResult.OrderChange -> { searchCards() }
-            ChangeCardOrderResult.DirectionChange -> {
-                cards.reverse()
-                updateList()
-            }
-            null -> {}
-        }
+    fun changeCardOrder(sortType: SortType) = launchCatchingTask {
+        // TODO: remove withProgress and replace with search progress bar
+        withProgress { viewModel.changeCardOrder(sortType)?.join() }
     }
 
     @VisibleForTesting
@@ -302,11 +298,12 @@ open class CardBrowser :
     private val selectedRowIds: List<CardId>
         get() = viewModel.selectedRowIds
 
+    @MainThread
     @NeedsTest("search bar is set after selecting a saved search as first action")
     private fun searchForQuery(query: String) {
         // setQuery before expand does not set the view's value
         searchItem!!.expandActionView()
-        searchView!!.setQuery(query, true)
+        searchView!!.setQuery(query, submit = true)
     }
 
     private fun canPerformCardInfo(): Boolean {
@@ -325,12 +322,7 @@ open class CardBrowser :
     @VisibleForTesting
     fun moveSelectedCardsToDeck(did: DeckId): Job {
         return launchCatchingTask {
-            val changed = withProgress {
-                val selectedCardIds = viewModel.queryAllSelectedCardIds()
-                undoableOp {
-                    setDeck(selectedCardIds, did)
-                }
-            }
+            val changed = withProgress { viewModel.moveSelectedCardsToDeck(did).await() }
             showUndoSnackbar(TR.browsingCardsUpdated(changed.count))
         }
     }
@@ -375,6 +367,9 @@ open class CardBrowser :
         cardsListView.adapter = cardsAdapter
         // make the items (e.g. question & answer) render dynamically when scrolling
         cardsListView.setOnScrollListener(RenderOnScroll())
+
+        updateNumCardsToRender()
+
         startLoadingCollection()
 
         when (val options = launchOptions) {
@@ -408,9 +403,7 @@ open class CardBrowser :
     @Suppress("UNUSED_PARAMETER")
     private fun setupFlows() {
         // provides a name for each flow receiver to improve stack traces
-        fun onSearchTermsChanged(terms: String) = searchCards()
         fun onIsTruncatedChanged(isTruncated: Boolean) = cardsAdapter.notifyDataSetChanged()
-        fun onCardsOrNotesChanged(cardsOrNotes: CardsOrNotes) = searchCards()
         fun onSearchQueryExpanded(searchQueryExpanded: Boolean) {
             Timber.d("query expansion changed: %b", searchQueryExpanded)
             if (searchQueryExpanded) {
@@ -426,12 +419,15 @@ open class CardBrowser :
             cardsAdapter.updateMapping { it[0] = COLUMN1_KEYS[index] }
         fun onColumnIndex2Changed(index: Int) =
             cardsAdapter.updateMapping { it[1] = COLUMN2_KEYS[index] }
-        fun onFilterQueryChanged(filterQuery: String) = searchForQuery(filterQuery)
+        fun onFilterQueryChanged(filterQuery: String) {
+            // setQuery before expand does not set the view's value
+            searchItem!!.expandActionView()
+            searchView!!.setQuery(filterQuery, submit = false)
+        }
         suspend fun onDeckIdChanged(deckId: DeckId?) {
             if (deckId == null) return
             // this handles ALL_DECKS_ID
             deckSpinnerSelection!!.selectDeckById(deckId, false)
-            searchCards()
         }
         fun onCanSaveChanged(canSave: Boolean) {
             saveSearchItem?.isVisible = canSave
@@ -457,13 +453,28 @@ open class CardBrowser :
             invalidateOptionsMenu()
         }
         fun cardsUpdatedChanged(unit: Unit) = cardsAdapter.notifyDataSetChanged()
+        fun searchStateChanged(searchState: SearchState) {
+            Timber.d("search state: %s", searchState)
+            when (searchState) {
+                SearchState.Initializing -> { }
+                SearchState.Searching -> {
+                    invalidate()
+                    if ("" != viewModel.searchTerms && searchView != null) {
+                        searchView!!.setQuery(viewModel.searchTerms, false)
+                        searchItem!!.expandActionView()
+                    }
+                }
+                SearchState.Completed -> redrawAfterSearch()
+                is SearchState.Error -> {
+                    showError(this, searchState.error)
+                }
+            }
+        }
         fun initCompletedChanged(completed: Boolean) {
             if (completed) searchCards()
         }
 
-        viewModel.flowOfSearchTerms.launchCollectionInLifecycleScope(::onSearchTermsChanged)
         viewModel.flowOfIsTruncated.launchCollectionInLifecycleScope(::onIsTruncatedChanged)
-        viewModel.flowOfCardsOrNotes.launchCollectionInLifecycleScope(::onCardsOrNotesChanged)
         viewModel.flowOfSearchQueryExpanded.launchCollectionInLifecycleScope(::onSearchQueryExpanded)
         viewModel.flowOfSelectedRows.launchCollectionInLifecycleScope(::onSelectedRowsChanged)
         viewModel.flowOfColumnIndex1.launchCollectionInLifecycleScope(::onColumnIndex1Changed)
@@ -473,7 +484,7 @@ open class CardBrowser :
         viewModel.flowOfCanSearch.launchCollectionInLifecycleScope(::onCanSaveChanged)
         viewModel.flowOfIsInMultiSelectMode.launchCollectionInLifecycleScope(::isInMultiSelectModeChanged)
         viewModel.flowOfCardsUpdated.launchCollectionInLifecycleScope(::cardsUpdatedChanged)
-        viewModel.flowOfCardsUpdated.launchCollectionInLifecycleScope(::cardsUpdatedChanged)
+        viewModel.flowOfSearchState.launchCollectionInLifecycleScope(::searchStateChanged)
         viewModel.flowOfInitCompleted.launchCollectionInLifecycleScope(::initCompletedChanged)
     }
 
@@ -706,6 +717,12 @@ open class CardBrowser :
     override fun onResume() {
         super.onResume()
         selectNavigationItem(R.id.nav_browser)
+        updateNumCardsToRender()
+    }
+
+    override fun onConfigurationChanged(newConfig: Configuration) {
+        super.onConfigurationChanged(newConfig)
+        updateNumCardsToRender()
     }
 
     @KotlinCleanup("Add a few variables to get rid of the !!")
@@ -1215,15 +1232,7 @@ open class CardBrowser :
 
     @get:VisibleForTesting
     val addNoteIntent: Intent
-        get() {
-            val intent = Intent(this@CardBrowser, NoteEditor::class.java)
-            intent.putExtra(NoteEditor.EXTRA_CALLER, NoteEditor.CALLER_CARDBROWSER_ADD)
-            if (viewModel.lastDeckId?.let { id -> id > 0 } == true) {
-                intent.putExtra(NoteEditor.EXTRA_DID, viewModel.lastDeckId)
-            }
-            intent.putExtra(NoteEditor.EXTRA_TEXT_FROM_SEARCH_VIEW, viewModel.searchTerms)
-            return intent
-        }
+        get() = createAddNoteIntent(this, viewModel)
 
     private fun addNoteFromCardBrowser() {
         onAddNoteActivityResult.launch(addNoteIntent)
@@ -1317,23 +1326,14 @@ open class CardBrowser :
     @RustCleanup("remove card cache; switch to RecyclerView and browserRowForId (#11889)")
     @VisibleForTesting
     fun searchCards() {
-        if (!viewModel.initCompleted) {
-            Timber.d("!initCompleted, not searching")
-            return
-        }
-        // cancel the previous search & render tasks if still running
-        invalidate()
-        if ("" != viewModel.searchTerms && searchView != null) {
-            searchView!!.setQuery(viewModel.searchTerms, false)
-            searchItem!!.expandActionView()
-        }
         launchCatchingTask {
-            withProgress { viewModel.searchForCards(numCardsToRender()) }
-            redrawAfterSearch()
+            // TODO: Move this to a LinearProgressIndicator and remove withProgress
+            withProgress { viewModel.launchSearchForCards()?.join() }
         }
     }
 
-    fun redrawAfterSearch() {
+    @MainThread
+    private fun redrawAfterSearch() {
         Timber.i("CardBrowser:: Completed searchCards() Successfully")
         updateList()
         /*check whether mSearchView is initialized as it is lateinit property.*/
@@ -1374,8 +1374,8 @@ open class CardBrowser :
     }
 
     @VisibleForTesting
-    protected open fun numCardsToRender(): Int {
-        return ceil(
+    protected open fun updateNumCardsToRender() {
+        viewModel.numCardsToRender = ceil(
             (
                 cardsListView.height /
                     TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 20f, resources.displayMetrics)
@@ -1383,6 +1383,7 @@ open class CardBrowser :
         ).toInt() + 5
     }
 
+    @MainThread
     private fun updateList() {
         if (colIsOpenUnsafe()) {
             cardsAdapter.notifyDataSetChanged()
@@ -2090,9 +2091,10 @@ open class CardBrowser :
     }
 
     @VisibleForTesting
-    fun searchCards(searchQuery: String) {
-        viewModel.setSearchTerms(searchQuery)
-    }
+    fun searchCards(searchQuery: String) =
+        launchCatchingTask {
+            withProgress { viewModel.launchSearchForCards(searchQuery)?.join() }
+        }
 
     override fun opExecuted(changes: OpChanges, handler: Any?) {
         if (handler === this || handler === viewModel) {
@@ -2127,6 +2129,17 @@ open class CardBrowser :
 
         fun clearLastDeckId() = SharedPreferencesLastDeckIdRepository.clearLastDeckId()
 
+        @VisibleForTesting
+        fun createAddNoteIntent(context: Context, viewModel: CardBrowserViewModel): Intent {
+            val intent = Intent(context, NoteEditor::class.java)
+            intent.putExtra(NoteEditor.EXTRA_CALLER, NoteEditor.CALLER_CARDBROWSER_ADD)
+            if (viewModel.lastDeckId?.let { id -> id > 0 } == true) {
+                intent.putExtra(NoteEditor.EXTRA_DID, viewModel.lastDeckId)
+            }
+            intent.putExtra(NoteEditor.EXTRA_TEXT_FROM_SEARCH_VIEW, viewModel.searchTerms)
+            return intent
+        }
+
         @CheckResult
         private fun formatQA(
             text: String,
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/CoroutineHelpers.kt b/AnkiDroid/src/main/java/com/ichi2/anki/CoroutineHelpers.kt
index 81168559bdae..1c8b4aa4a7b8 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/CoroutineHelpers.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/CoroutineHelpers.kt
@@ -82,7 +82,7 @@ var throwOnShowError = false
 fun CoroutineScope.launchCatching(
     context: CoroutineContext = EmptyCoroutineContext,
     errorMessageHandler: suspend (String) -> Unit,
-    block: suspend () -> Unit
+    block: suspend CoroutineScope.() -> Unit
 ): Job {
     return launch(context) {
         try {
@@ -113,6 +113,16 @@ fun <T> T.launchCatchingIO(block: suspend T.() -> Unit): Job where T : ViewModel
     )
 }
 
+fun <T> T.launchCatchingIO(
+    errorMessageHandler: suspend (String) -> Unit,
+    block: suspend CoroutineScope.() -> Unit
+): Job where T : ViewModel {
+    return viewModelScope.launchCatching(
+        ioDispatcher,
+        errorMessageHandler
+    ) { block() }
+}
+
 fun <T> CoroutineScope.asyncIO(block: suspend CoroutineScope.() -> T): Deferred<T> {
     return async(ioDispatcher, block = block)
 }
@@ -232,7 +242,21 @@ fun Fragment.launchCatchingTask(
     }
 }
 
-private fun showError(context: Context, msg: String, exception: Throwable, crashReport: Boolean = true) {
+fun showError(context: Context, msg: String) {
+    if (throwOnShowError) throw IllegalStateException("throwOnShowError: $msg")
+    try {
+        AlertDialog.Builder(context).show {
+            title(R.string.vague_error)
+            message(text = msg)
+            positiveButton(R.string.dialog_ok)
+        }
+    } catch (ex: BadTokenException) {
+        // issue 12718: activity provided by `context` was not running
+        Timber.w(ex, "unable to display error dialog")
+    }
+}
+
+fun showError(context: Context, msg: String, exception: Throwable, crashReport: Boolean = true) {
     if (throwOnShowError) throw IllegalStateException("throwOnShowError: $msg", exception)
     try {
         AlertDialog.Builder(context).show {
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/browser/CardBrowserViewModel.kt b/AnkiDroid/src/main/java/com/ichi2/anki/browser/CardBrowserViewModel.kt
index 1ce4afb52f96..67320ed3cdf3 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/browser/CardBrowserViewModel.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/browser/CardBrowserViewModel.kt
@@ -21,6 +21,7 @@ import androidx.lifecycle.ViewModel
 import androidx.lifecycle.viewModelScope
 import androidx.lifecycle.viewmodel.initializer
 import androidx.lifecycle.viewmodel.viewModelFactory
+import anki.collection.OpChangesWithCount
 import com.ichi2.anki.AnkiDroidApp
 import com.ichi2.anki.CardBrowser
 import com.ichi2.anki.CollectionManager.withCol
@@ -28,6 +29,7 @@ import com.ichi2.anki.DeckSpinnerSelection.Companion.ALL_DECKS_ID
 import com.ichi2.anki.Flag
 import com.ichi2.anki.PreviewerDestination
 import com.ichi2.anki.export.ExportDialogFragment
+import com.ichi2.anki.launchCatchingIO
 import com.ichi2.anki.model.CardStateFilter
 import com.ichi2.anki.model.CardsOrNotes
 import com.ichi2.anki.model.CardsOrNotes.*
@@ -43,12 +45,18 @@ import com.ichi2.libanki.Consts
 import com.ichi2.libanki.DeckId
 import com.ichi2.libanki.hasTag
 import com.ichi2.libanki.undoableOp
+import kotlinx.coroutines.Deferred
+import kotlinx.coroutines.Job
+import kotlinx.coroutines.async
+import kotlinx.coroutines.ensureActive
 import kotlinx.coroutines.flow.Flow
 import kotlinx.coroutines.flow.MutableSharedFlow
 import kotlinx.coroutines.flow.MutableStateFlow
 import kotlinx.coroutines.flow.SharingStarted
 import kotlinx.coroutines.flow.combine
+import kotlinx.coroutines.flow.combineTransform
 import kotlinx.coroutines.flow.filter
+import kotlinx.coroutines.flow.flattenMerge
 import kotlinx.coroutines.flow.flowOf
 import kotlinx.coroutines.flow.launchIn
 import kotlinx.coroutines.flow.map
@@ -77,26 +85,38 @@ class CardBrowserViewModel(
     preferences: SharedPreferencesProvider
 ) : ViewModel(), SharedPreferencesProvider by preferences {
 
+    // Set by the UI to determine the number of cards to preload before returning search results
+    // This is a hack, but will be removed soon when we move to the backend for card rendering
+    // so isn't worth refactoring further
+    var numCardsToRender: Int? = null
+
+    /** A job which ensures that parallel searches do not occur */
+    var searchJob: Job? = null
+        private set
+
     // temporary flow for refactoring - called when cards are cleared
     val flowOfCardsUpdated = MutableSharedFlow<Unit>()
 
     val cards = CardBrowser.CardCollection<CardBrowser.CardCache>()
 
+    val flowOfSearchState = MutableSharedFlow<SearchState>()
+
     /** The CardIds of all the cards in the results */
     val allCardIds get() = cards.map { c -> c.id }
 
-    val flowOfSearchTerms = MutableStateFlow("")
-    val searchTerms get() = flowOfSearchTerms.value
+    var searchTerms = ""
+        private set
     private var restrictOnDeck: String = ""
-    var currentFlag = Flag.NONE
 
+    /** text in the search box (potentially unsubmitted) */
+    // this does not currently bind to the value in the UI and is only used for posting
     val flowOfFilterQuery = MutableSharedFlow<String>()
 
     /**
      * Whether the browser is working in Cards mode or Notes mode.
      * default: [CARDS]
      * */
-    val flowOfCardsOrNotes = MutableStateFlow(CARDS)
+    private val flowOfCardsOrNotes = MutableStateFlow(CARDS)
     val cardsOrNotes get() = flowOfCardsOrNotes.value
 
     // card that was clicked (not marked)
@@ -185,7 +205,7 @@ class CardBrowserViewModel(
             return CardInfoDestination(firstSelectedCard)
         }
 
-    suspend fun getInitialDeck(): DeckId {
+    private suspend fun getInitialDeck(): DeckId {
         // TODO: Handle the launch intent
         val lastDeckId = lastDeckId
         if (lastDeckId == ALL_DECKS_ID) {
@@ -210,6 +230,24 @@ class CardBrowserViewModel(
     @get:VisibleForTesting
     val initCompleted get() = flowOfInitCompleted.value
 
+    /**
+     * A search should be triggered if these properties change
+     */
+    private val searchRequested = flowOf(flowOfCardsOrNotes, flowOfDeckId)
+        .flattenMerge()
+
+    /**
+     * Emits an item when:
+     * * [initCompleted] is true
+     * * A property which defines the search has been changed ([searchRequested])
+     *
+     * @see launchSearchForCards
+     */
+    private val performSearchFlow = flowOfInitCompleted.combineTransform(searchRequested) { init, _ ->
+        if (!init) return@combineTransform
+        emit(Unit)
+    }
+
     init {
         Timber.d("CardBrowserViewModel::init")
         flowOfColumnIndex1
@@ -220,6 +258,10 @@ class CardBrowserViewModel(
             .onEach { index -> sharedPrefs().edit { putInt(DISPLAY_COLUMN_2_KEY, index) } }
             .launchIn(viewModelScope)
 
+        performSearchFlow.onEach {
+            launchSearchForCards()
+        }.launchIn(viewModelScope)
+
         reverseDirectionFlow
             .ignoreValuesFromViewModelLaunch()
             .onEach { newValue -> withCol { newValue.updateConfig(config) } }
@@ -345,19 +387,29 @@ class CardBrowserViewModel(
 
     fun selectedRowCount(): Int = selectedRows.size
 
-    fun changeCardOrder(which: SortType): ChangeCardOrderResult? {
-        if (which != order) {
-            Timber.i("updating order to %s", which)
-            sortTypeFlow.update { which }
-            reverseDirectionFlow.update { ReverseDirection(orderAsc = false) }
-            return ChangeCardOrderResult.OrderChange
-        } else if (which != SortType.NO_SORTING) {
-            Timber.i("reversing search order")
+    suspend fun changeCardOrder(which: SortType): Job? {
+        val changeType = when {
+            which != order -> ChangeCardOrder.OrderChange(which)
             // if the same element is selected again, reverse the order
-            reverseDirectionFlow.update { ReverseDirection(orderAsc = !orderAsc) }
-            return ChangeCardOrderResult.DirectionChange
+            which != SortType.NO_SORTING -> ChangeCardOrder.DirectionChange
+            else -> null
+        } ?: return null
+
+        Timber.i("updating order: %s", changeType)
+
+        return when (changeType) {
+            is ChangeCardOrder.OrderChange -> {
+                sortTypeFlow.update { which }
+                reverseDirectionFlow.update { ReverseDirection(orderAsc = false) }
+                launchSearchForCards()
+            }
+            ChangeCardOrder.DirectionChange -> {
+                reverseDirectionFlow.update { ReverseDirection(orderAsc = !orderAsc) }
+                cards.reverse()
+                flowOfSearchState.emit(SearchState.Completed)
+                null
+            }
         }
-        return null
     }
 
     fun setColumn1Index(value: Int) = flowOfColumnIndex1.update { value }
@@ -464,13 +516,14 @@ class CardBrowserViewModel(
 
     suspend fun setFilterQuery(filterQuery: String) {
         this.flowOfFilterQuery.emit(filterQuery)
+        launchSearchForCards(filterQuery)
     }
 
     suspend fun searchForMarkedNotes() = setFilterQuery("tag:marked")
 
     suspend fun searchForSuspendedCards() = setFilterQuery("is:suspended")
     suspend fun setFlagFilter(flag: Flag) {
-        currentFlag = flag
+        Timber.i("filtering to flag: %s", flag)
         val flagSearchTerm = "flag:${flag.code}"
         val searchTerms = when {
             searchTerms.contains("flag:") -> searchTerms.replaceFirst("flag:.".toRegex(), flagSearchTerm)
@@ -535,6 +588,13 @@ class CardBrowserViewModel(
         searchQueryInputFlow.update { null }
     }
 
+    fun moveSelectedCardsToDeck(deckId: DeckId): Deferred<OpChangesWithCount> = viewModelScope.async {
+        val selectedCardIds = queryAllSelectedCardIds()
+        return@async undoableOp {
+            setDeck(selectedCardIds, deckId)
+        }
+    }
+
     suspend fun updateSelectedCardsFlag(flag: Flag): List<Card> {
         val idsToChange = queryAllSelectedCardIds()
         return withCol {
@@ -550,12 +610,17 @@ class CardBrowserViewModel(
      */
     fun endMultiSelectMode() = selectNone()
 
-    fun setSearchTerms(searchQuery: String) = flowOfSearchTerms.update { searchQuery }
+    suspend fun launchSearchForCards(searchQuery: String): Job? {
+        searchTerms = searchQuery
+        return launchSearchForCards()
+    }
 
     /**
      * @see com.ichi2.anki.searchForCards
      */
-    suspend fun searchForCards(numCardsToRender: Int): MutableList<CardBrowser.CardCache> {
+    @NeedsTest("Invalid searches are handled. For instance: 'and'")
+    suspend fun launchSearchForCards(): Job? {
+        if (!initCompleted) return null
         // update the UI while we're searching
         clearCardsList()
 
@@ -565,15 +630,26 @@ class CardBrowserViewModel(
             if ("" != searchTerms) "$restrictOnDeck($searchTerms)" else restrictOnDeck
         }
 
-        Timber.d("performing search")
-        val cards = com.ichi2.anki.searchForCards(query, order.toSortOrder(), cardsOrNotes)
-        Timber.d("Search returned %d cards", cards.size)
-        // Render the first few items
-        for (i in 0 until min(numCardsToRender, cards.size)) {
-            cards[i].load(false, column1Index, column2Index)
+        searchJob?.cancel()
+        searchJob = launchCatchingIO(
+            errorMessageHandler = { error -> flowOfSearchState.emit(SearchState.Error(error)) }
+        ) {
+            flowOfSearchState.emit(SearchState.Searching)
+            Timber.d("performing search: '%s'", query)
+            val cards = com.ichi2.anki.searchForCards(query, order.toSortOrder(), cardsOrNotes)
+            Timber.d("Search returned %d card(s)", cards.size)
+
+            // Render the first few items
+            val cardsToRender = min((numCardsToRender ?: 0), cards.size)
+            for (i in 0 until cardsToRender) {
+                ensureActive()
+                cards[i].load(false, column1Index, column2Index)
+            }
+            ensureActive()
+            this@CardBrowserViewModel.cards.replaceWith(cards)
+            flowOfSearchState.emit(SearchState.Completed)
         }
-        this.cards.replaceWith(cards)
-        return cards
+        return searchJob!!
     }
 
     private suspend fun clearCardsList() {
@@ -595,10 +671,31 @@ class CardBrowserViewModel(
         }
     }
 
-    /** temporary result class for [changeCardOrder] */
-    enum class ChangeCardOrderResult {
-        OrderChange,
-        DirectionChange
+    private sealed interface ChangeCardOrder {
+        data class OrderChange(val sortType: SortType) : ChangeCardOrder
+        data object DirectionChange : ChangeCardOrder
+    }
+
+    /** Whether [CardBrowserViewModel] is processing a search */
+    sealed interface SearchState {
+        /** The class is initializing */
+        data object Initializing : SearchState
+
+        /** A search is in progress */
+        data object Searching : SearchState
+
+        /** A search has been completed */
+        data object Completed : SearchState
+
+        /**
+         * A search error, for instance:
+         *
+         * [net.ankiweb.rsdroid.BackendException.BackendSearchException]
+         *
+         * Invalid search: an `and` was found but it is not connecting two search terms.
+         * If you want to search for the word itself, wrap it in double quotes: `"and"`.
+         */
+        data class Error(val error: String) : SearchState
     }
 }
 
diff --git a/AnkiDroid/src/test/java/com/ichi2/anki/CardBrowserTest.kt b/AnkiDroid/src/test/java/com/ichi2/anki/CardBrowserTest.kt
index 68e2d71e6299..7b925f2326a5 100644
--- a/AnkiDroid/src/test/java/com/ichi2/anki/CardBrowserTest.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/anki/CardBrowserTest.kt
@@ -29,13 +29,12 @@ import androidx.test.ext.junit.runners.AndroidJUnit4
 import com.ichi2.anki.CardBrowser.CardCache
 import com.ichi2.anki.CardBrowser.Companion.dueString
 import com.ichi2.anki.CardBrowser.Companion.nextDue
-import com.ichi2.anki.DeckSpinnerSelection.Companion.ALL_DECKS_ID
 import com.ichi2.anki.IntentHandler.Companion.grantedStoragePermissions
 import com.ichi2.anki.browser.CardBrowserColumn
+import com.ichi2.anki.browser.CardBrowserViewModel
 import com.ichi2.anki.browser.CardBrowserViewModel.Companion.DISPLAY_COLUMN_1_KEY
 import com.ichi2.anki.browser.CardBrowserViewModel.Companion.DISPLAY_COLUMN_2_KEY
-import com.ichi2.anki.model.CardsOrNotes.CARDS
-import com.ichi2.anki.model.CardsOrNotes.NOTES
+import com.ichi2.anki.model.CardsOrNotes.*
 import com.ichi2.anki.model.SortType
 import com.ichi2.anki.scheduling.ForgetCardsViewModel
 import com.ichi2.anki.servicelayer.NoteService
@@ -49,6 +48,7 @@ import com.ichi2.testutils.AnkiAssert.assertDoesNotThrowSuspend
 import com.ichi2.testutils.Flaky
 import com.ichi2.testutils.IntentAssert
 import com.ichi2.testutils.OS
+import com.ichi2.testutils.TestClass
 import com.ichi2.testutils.getSharedPrefs
 import com.ichi2.ui.FixedTextView
 import com.ichi2.utils.AdaptionUtil
@@ -294,28 +294,6 @@ class CardBrowserTest : RobolectricTest() {
         }
     }
 
-    @Test
-    fun `change deck in notes mode 15444`() = runTest {
-        val newDeck = addDeck("World")
-        selectDefaultDeck()
-        val b = getBrowserWithNotes(5, reversed = true)
-        b.viewModel.setCardsOrNotes(NOTES)
-
-        b.selectRowsWithPositions(0, 2)
-
-        val allCardIds = b.viewModel.queryAllSelectedCardIds()
-        assertThat(allCardIds.size, equalTo(4))
-
-        b.moveSelectedCardsToDeck(newDeck).join()
-
-        for (cardId in allCardIds) {
-            assertThat("Deck should be changed", col.getCard(cardId).did, equalTo(newDeck))
-        }
-
-        val hasSomeDecksUnchanged = b.viewModel.cards.any { row -> row.card.did != newDeck }
-        assertThat("some decks are unchanged", hasSomeDecksUnchanged)
-    }
-
     @Test // see #13391
     fun newlyCreatedDeckIsShownAsOptionInBrowser() = runTest {
         val deckOneId = addDeck("one")
@@ -421,29 +399,11 @@ class CardBrowserTest : RobolectricTest() {
         n.flush()
 
         val b = browserWithNoNewCards
-        b.filterByTag("sketchy::(1)")
+        b.filterByTagSync("sketchy::(1)")
 
         assertThat("tagged card should be returned", b.viewModel.rowCount, equalTo(1))
     }
 
-    @Test
-    fun filterByFlagDisplaysProperly() = runTest {
-        val cardWithRedFlag = addNoteUsingBasicModel("Card with red flag", "Reverse")
-        flagCardForNote(cardWithRedFlag, Flag.RED)
-
-        val cardWithGreenFlag = addNoteUsingBasicModel("Card with green flag", "Reverse")
-        flagCardForNote(cardWithGreenFlag, Flag.GREEN)
-
-        val anotherCardWithRedFlag = addNoteUsingBasicModel("Second card with red flag", "Reverse")
-        flagCardForNote(anotherCardWithRedFlag, Flag.RED)
-
-        val b = browserWithNoNewCards
-        b.viewModel.setFlagFilter(Flag.RED)
-        waitForAsyncTasksToComplete()
-
-        assertThat("Flagged cards should be returned", b.viewModel.rowCount, equalTo(2))
-    }
-
     @Test
     @Flaky(os = OS.WINDOWS, "IllegalStateException: Card '1596783600440' not found")
     fun previewWorksAfterSort() {
@@ -481,24 +441,6 @@ class CardBrowserTest : RobolectricTest() {
         )
     }
 
-    /** 7420  */
-    @Test
-    fun addCardDeckIsNotSetIfAllDecksSelectedAfterLoad() = runTest {
-        addDeck("NotDefault")
-
-        val b = browserWithNoNewCards
-
-        assertThat("All decks should not be selected", b.hasSelectedAllDecks(), equalTo(false))
-
-        b.viewModel.setDeckId(ALL_DECKS_ID)
-
-        assertThat("All decks should be selected", b.hasSelectedAllDecks(), equalTo(true))
-
-        val addIntent = b.addNoteIntent
-
-        IntentAssert.doesNotHaveExtra(addIntent, NoteEditor.EXTRA_DID)
-    }
-
     /** 7420  */
     @Test
     fun addCardDeckISetIfDeckIsSelected() = runTest {
@@ -656,7 +598,7 @@ class CardBrowserTest : RobolectricTest() {
         }
 
         val cardBrowser = browserWithNoNewCards
-        cardBrowser.searchCards("world or hello")
+        cardBrowser.searchCardsSync("world or hello")
 
         assertThat(
             "Cardbrowser has Deck 1 as selected deck",
@@ -726,7 +668,7 @@ class CardBrowserTest : RobolectricTest() {
         }
 
         val cardBrowser = browserWithNoNewCards
-        cardBrowser.searchCards("Hello")
+        cardBrowser.searchCards("Hello").join()
         waitForAsyncTasksToComplete()
         assertThat(
             "Card browser should have Test Deck as the selected deck",
@@ -735,7 +677,7 @@ class CardBrowserTest : RobolectricTest() {
         )
         assertThat("Result should be empty", cardBrowser.viewModel.rowCount, equalTo(0))
 
-        cardBrowser.searchAllDecks()
+        cardBrowser.searchAllDecks().join()
         waitForAsyncTasksToComplete()
         assertThat("Result should contain one card", cardBrowser.viewModel.rowCount, equalTo(1))
     }
@@ -748,6 +690,7 @@ class CardBrowserTest : RobolectricTest() {
 
         browserWithNoNewCards.apply {
             searchAllDecks().join()
+            waitForAsyncTasksToComplete()
             with(viewModel) {
                 assertThat("Result should contain 4 cards", rowCount, equalTo(4))
                 setCardsOrNotes(NOTES).join()
@@ -786,16 +729,6 @@ class CardBrowserTest : RobolectricTest() {
         return b.getPropertiesForCardId(ids[0])
     }
 
-    private fun flagCardForNote(n: Note, flag: Flag) {
-        n.firstCard().update {
-            setUserFlag(flag)
-        }
-    }
-
-    private fun selectDefaultDeck() {
-        col.decks.select(1)
-    }
-
     private fun deleteCardAtPosition(browser: CardBrowser, positionToCorrupt: Int) {
         removeCardFromCollection(browser.viewModel.allCardIds[positionToCorrupt])
         browser.clearCardData(positionToCorrupt)
@@ -836,8 +769,8 @@ class CardBrowserTest : RobolectricTest() {
     }
 
     private class CardBrowserSizeOne : CardBrowser() {
-        override fun numCardsToRender(): Int {
-            return 1
+        override fun updateNumCardsToRender() {
+            viewModel.numCardsToRender = 1
         }
     }
 
@@ -1189,3 +1122,23 @@ val CardBrowser.lastDeckId
 
 val CardBrowser.validDecksForChangeDeck
     get() = runBlocking { getValidDecksForChangeDeck() }
+
+suspend fun CardBrowser.searchCardsSync(query: String) {
+    searchCards(query)
+    viewModel.searchJob?.join()
+}
+suspend fun CardBrowser.filterByTagSync(vararg tags: String) {
+    filterByTag(*tags)
+    viewModel.searchJob?.join()
+}
+
+suspend fun CardBrowserViewModel.setFlagFilterSync(flag: Flag) {
+    setFlagFilter(flag)
+    searchJob?.join()
+}
+
+fun TestClass.flagCardForNote(n: Note, flag: Flag) {
+    n.firstCard().update {
+        setUserFlag(flag)
+    }
+}
diff --git a/AnkiDroid/src/test/java/com/ichi2/anki/browser/CardBrowserViewModelTest.kt b/AnkiDroid/src/test/java/com/ichi2/anki/browser/CardBrowserViewModelTest.kt
index a2ee2ec0de6c..46bd35e9588f 100644
--- a/AnkiDroid/src/test/java/com/ichi2/anki/browser/CardBrowserViewModelTest.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/anki/browser/CardBrowserViewModelTest.kt
@@ -18,8 +18,17 @@ package com.ichi2.anki.browser
 
 import androidx.test.ext.junit.runners.AndroidJUnit4
 import com.ichi2.anki.AnkiDroidApp
+import com.ichi2.anki.CardBrowser
+import com.ichi2.anki.DeckSpinnerSelection
+import com.ichi2.anki.Flag
+import com.ichi2.anki.NoteEditor
+import com.ichi2.anki.flagCardForNote
+import com.ichi2.anki.model.CardsOrNotes
+import com.ichi2.anki.setFlagFilterSync
+import com.ichi2.testutils.IntentAssert
 import com.ichi2.testutils.JvmTest
 import com.ichi2.testutils.createTransientDirectory
+import com.ichi2.testutils.mockIt
 import org.hamcrest.MatcherAssert.assertThat
 import org.hamcrest.Matchers.equalTo
 import org.junit.Test
@@ -38,6 +47,64 @@ class CardBrowserViewModelTest : JvmTest() {
         assertThat("filters should be empty after removing", savedSearches().size, equalTo(0))
     }
 
+    @Test
+    fun `change deck in notes mode 15444`() = runViewModelTest {
+        val newDeck = addDeck("World")
+        selectDefaultDeck()
+
+        for (i in 0 until 5) {
+            addNoteUsingBasicAndReversedModel()
+        }
+        setCardsOrNotes(CardsOrNotes.NOTES)
+        waitForSearchResults()
+
+        selectRowsWithPositions(0, 2)
+
+        val allCardIds = queryAllSelectedCardIds()
+        assertThat(allCardIds.size, equalTo(4))
+
+        moveSelectedCardsToDeck(newDeck).join()
+
+        for (cardId in allCardIds) {
+            assertThat("Deck should be changed", col.getCard(cardId).did, equalTo(newDeck))
+        }
+
+        val hasSomeDecksUnchanged = cards.any { row -> row.card.did != newDeck }
+        assertThat("some decks are unchanged", hasSomeDecksUnchanged)
+    }
+
+    /** 7420  */
+    @Test
+    fun addCardDeckIsNotSetIfAllDecksSelectedAfterLoad() = runViewModelTest {
+        addDeck("NotDefault")
+
+        assertThat("All decks should not be selected", !hasSelectedAllDecks())
+
+        setDeckId(DeckSpinnerSelection.ALL_DECKS_ID)
+
+        assertThat("All decks should be selected", hasSelectedAllDecks())
+
+        val addIntent = CardBrowser.createAddNoteIntent(mockIt(), this)
+
+        IntentAssert.doesNotHaveExtra(addIntent, NoteEditor.EXTRA_DID)
+    }
+
+    @Test
+    fun filterByFlagDisplaysProperly() = runViewModelTest {
+        val cardWithRedFlag = addNoteUsingBasicModel("Card with red flag", "Reverse")
+        flagCardForNote(cardWithRedFlag, Flag.RED)
+
+        val cardWithGreenFlag = addNoteUsingBasicModel("Card with green flag", "Reverse")
+        flagCardForNote(cardWithGreenFlag, Flag.GREEN)
+
+        val anotherCardWithRedFlag = addNoteUsingBasicModel("Second card with red flag", "Reverse")
+        flagCardForNote(anotherCardWithRedFlag, Flag.RED)
+
+        setFlagFilterSync(Flag.RED)
+
+        assertThat("Flagged cards should be returned", rowCount, equalTo(2))
+    }
+
     private fun runViewModelTest(testBody: suspend CardBrowserViewModel.() -> Unit) = runTest {
         val viewModel = CardBrowserViewModel(
             lastDeckIdRepository = SharedPreferencesLastDeckIdRepository(),
@@ -47,3 +114,16 @@ class CardBrowserViewModelTest : JvmTest() {
         testBody(viewModel)
     }
 }
+
+@Suppress("SameParameterValue")
+private fun CardBrowserViewModel.selectRowsWithPositions(vararg positions: Int) {
+    for (pos in positions) {
+        selectRowAtPosition(pos)
+    }
+}
+
+private suspend fun CardBrowserViewModel.waitForSearchResults() {
+    searchJob?.join()
+}
+
+private fun CardBrowserViewModel.hasSelectedAllDecks() = lastDeckId == DeckSpinnerSelection.ALL_DECKS_ID
diff --git a/AnkiDroid/src/test/java/com/ichi2/testutils/MockUtils.kt b/AnkiDroid/src/test/java/com/ichi2/testutils/MockUtils.kt
new file mode 100644
index 000000000000..b049f86ffbe3
--- /dev/null
+++ b/AnkiDroid/src/test/java/com/ichi2/testutils/MockUtils.kt
@@ -0,0 +1,23 @@
+/*
+ *  Copyright (c) 2024 David Allison <davidallisongithub@gmail.com>
+ *
+ *  This program is free software; you can redistribute it and/or modify it under
+ *  the terms of the GNU General Public License as published by the Free Software
+ *  Foundation; either version 3 of the License, or (at your option) any later
+ *  version.
+ *
+ *  This program is distributed in the hope that it will be useful, but WITHOUT ANY
+ *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+ *  PARTICULAR PURPOSE. See the GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License along with
+ *  this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package com.ichi2.testutils
+
+import org.mockito.Mockito
+import org.mockito.Mockito.RETURNS_DEFAULTS
+
+/** A much which is faster than mockk(relaxed = true) */
+inline fun <reified T> mockIt(): T = Mockito.mock(T::class.java, RETURNS_DEFAULTS)
diff --git a/AnkiDroid/src/test/java/com/ichi2/testutils/TestClass.kt b/AnkiDroid/src/test/java/com/ichi2/testutils/TestClass.kt
index 3deb6c8da932..2505b4fcf54d 100644
--- a/AnkiDroid/src/test/java/com/ichi2/testutils/TestClass.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/testutils/TestClass.kt
@@ -138,6 +138,10 @@ interface TestClass {
         }
     }
 
+    fun selectDefaultDeck() {
+        col.decks.select(Consts.DEFAULT_DECK_ID)
+    }
+
     /** Adds [count] notes in the same deck with the same front & back */
     fun addNotes(count: Int): List<Note> = (0..count).map { addNoteUsingBasicModel() }
 
