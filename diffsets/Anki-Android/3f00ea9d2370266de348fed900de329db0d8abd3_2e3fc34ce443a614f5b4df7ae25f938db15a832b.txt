diff --git a/AnkiDroid/src/main/AndroidManifest.xml b/AnkiDroid/src/main/AndroidManifest.xml
index 28088ed2dc57..bdd1d2c6888f 100644
--- a/AnkiDroid/src/main/AndroidManifest.xml
+++ b/AnkiDroid/src/main/AndroidManifest.xml
@@ -79,11 +79,11 @@
         <activity android:name=".DrawingActivity"
             android:label="@string/drawing"
             android:exported="false"
-            android:configChanges="keyboardHidden|locale|orientation|screenSize"
+            android:configChanges="keyboardHidden|locale|orientation|screenSize|uiMode"
             />
         <activity
             android:name="com.ichi2.anki.IntentHandler"
-            android:configChanges="keyboardHidden|orientation|screenSize|locale"
+            android:configChanges="keyboardHidden|orientation|screenSize|locale|uiMode"
             android:theme="@android:style/Theme.Translucent.NoTitleBar"
             android:exported="true"
             >
@@ -173,13 +173,13 @@
             android:name="com.ichi2.anki.DeckPicker"
             android:theme="@style/Theme_Dark_Compat.Launcher"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|screenSize|locale"
+            android:configChanges="keyboardHidden|orientation|screenSize|locale|uiMode"
             />
         <activity
             android:name="com.ichi2.anki.StudyOptionsActivity"
             android:label="StudyOptions"
             android:exported="false"
-            android:configChanges="keyboardHidden|locale|orientation|screenSize"
+            android:configChanges="keyboardHidden|locale|orientation|screenSize|uiMode"
             android:parentActivityName=".DeckPicker"
             >
         </activity>
@@ -203,7 +203,7 @@
             android:label="@string/card_browser"
             android:theme="@style/Theme_Dark_Compat.Launcher"
             android:exported="true"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:parentActivityName=".DeckPicker"
             >
         </activity>
@@ -211,18 +211,18 @@
             android:name=".ModelBrowser"
             android:label="@string/model_browser_label"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             />
         <activity
             android:name=".ModelFieldEditor"
             android:label="@string/model_editor_label"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             />
         <activity
             android:name="com.ichi2.anki.Reviewer"
             android:exported="true"
             android:theme="@style/Theme_Dark_Compat.Launcher"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:windowSoftInputMode="adjustResize"
             android:parentActivityName=".DeckPicker">
             <intent-filter>
@@ -233,20 +233,20 @@
         <activity
             android:name="com.ichi2.anki.VideoPlayer"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:theme="@android:style/Theme.NoTitleBar.Fullscreen"
             />
         <activity
             android:name="com.ichi2.anki.MyAccount"
             android:label="@string/menu_my_account"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             />
         <activity
             android:name="com.ichi2.anki.Preferences"
             android:label="@string/settings"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:theme="@style/LegacyActionBarLight"
             >
             <intent-filter>
@@ -257,21 +257,21 @@
             android:name="com.ichi2.anki.DeckOptions"
             android:label="@string/deckpreferences_title"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:theme="@style/LegacyActionBarLight"
             />
         <activity
             android:name=".FilteredDeckOptions"
             android:label="@string/deckpreferences_title"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:theme="@style/LegacyActionBarLight"
             />
         <activity
             android:name="com.ichi2.anki.Info"
             android:label="@string/about_title"
             android:exported="false"
-            android:configChanges="locale"
+            android:configChanges="locale|uiMode"
             />
 
         <activity-alias
@@ -291,7 +291,7 @@
             android:label="@string/fact_adder_intent_title"
             android:theme="@style/Theme_Dark_Compat.Launcher"
             android:exported="true"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             >
             <intent-filter>
                 <action android:name="org.openintents.action.CREATE_FLASHCARD" />
@@ -306,7 +306,7 @@
         <activity
             android:name="com.canhub.cropper.CropImageActivity"
             android:exported="true"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:theme="@style/Base.Theme.AppCompat" />
         <activity
             android:name="com.ichi2.anki.analytics.AnkiDroidCrashReportDialog"
@@ -319,7 +319,7 @@
         <activity
             android:name="com.ichi2.anki.Statistics"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:parentActivityName=".DeckPicker"
             >
         </activity>
@@ -327,33 +327,33 @@
             android:name="com.ichi2.anki.Previewer"
             android:label="@string/preview_title"
             android:exported="false"
-            android:configChanges="locale"
+            android:configChanges="locale|uiMode"
             />
         <activity
             android:name="com.ichi2.anki.CardTemplatePreviewer"
             android:label="@string/preview_title"
             android:exported="false"
-            android:configChanges="locale"
+            android:configChanges="locale|uiMode"
             />
         <activity
             android:name=".multimediacard.activity.MultimediaEditFieldActivity"
             android:label="@string/title_activity_edit_text"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             >
         </activity>
         <activity
             android:name="com.ichi2.anki.multimediacard.activity.LoadPronunciationActivity"
             android:label="@string/multimedia_editor_text_field_editing_say"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             >
         </activity>
         <activity
             android:name="com.ichi2.anki.CardTemplateEditor"
             android:label="@string/title_activity_template_editor"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             android:windowSoftInputMode="stateAlwaysHidden|adjustPan"
             >
         </activity>
@@ -361,17 +361,17 @@
             android:name=".CardTemplateBrowserAppearanceEditor"
             android:label="@string/card_template_browser_appearance_title"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             />
         <activity
             android:name=".CardInfo"
             android:label="@string/card_info_title"
             android:exported="false"
-            android:configChanges="keyboardHidden|orientation|locale|screenSize"
+            android:configChanges="keyboardHidden|orientation|locale|screenSize|uiMode"
             />
         <activity
             android:name=".SharedDecksActivity"
-            android:configChanges="keyboardHidden|orientation|screenSize|locale"
+            android:configChanges="keyboardHidden|orientation|screenSize|locale|uiMode"
             android:label="@string/download_deck"
             android:theme="@style/Theme.MaterialComponents.NoActionBar" />
 
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.kt b/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.kt
index dcd8c847147a..c0fa0d4d3ec7 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.kt
@@ -53,7 +53,6 @@ import com.ichi2.anki.UIUtils.getSnackbar
 import com.ichi2.anki.UIUtils.saveCollectionInBackground
 import com.ichi2.anki.UIUtils.showThemedToast
 import com.ichi2.anki.cardviewer.*
-import com.ichi2.anki.cardviewer.CardAppearance.Companion.isInNightMode
 import com.ichi2.anki.cardviewer.CardHtml.Companion.legacyGetTtsTags
 import com.ichi2.anki.cardviewer.HtmlGenerator.Companion.createInstance
 import com.ichi2.anki.cardviewer.SoundPlayer.CardSoundConfig
@@ -85,6 +84,7 @@ import com.ichi2.libanki.Collection
 import com.ichi2.libanki.Consts.BUTTON_TYPE
 import com.ichi2.libanki.Sound.SoundSide
 import com.ichi2.libanki.sched.AbstractSched
+import com.ichi2.themes.Themes
 import com.ichi2.themes.Themes.getResFromAttr
 import com.ichi2.ui.FixedEditText
 import com.ichi2.utils.AdaptionUtil.hasWebBrowser
@@ -1425,7 +1425,7 @@ abstract class AbstractFlashcardViewer :
 
     @KotlinCleanup("internal for AnkiDroidJsApi")
     internal val isInNightMode: Boolean
-        get() = isInNightMode(AnkiDroidApp.getSharedPrefs(this))
+        get() = Themes.currentTheme.isDark
 
     private fun updateCard(content: CardHtml) {
         Timber.d("updateCard()")
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/AnkiActivity.java b/AnkiDroid/src/main/java/com/ichi2/anki/AnkiActivity.java
index 9253eb94fb79..0a2af1a3d6a9 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/AnkiActivity.java
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/AnkiActivity.java
@@ -8,6 +8,7 @@
 import android.content.Context;
 import android.content.Intent;
 import android.content.SharedPreferences;
+import android.content.res.Configuration;
 import android.graphics.BitmapFactory;
 import android.graphics.Color;
 import android.media.AudioManager;
@@ -65,6 +66,7 @@
 import static com.ichi2.anim.ActivityTransitionAnimation.Direction.*;
 import static com.ichi2.anim.ActivityTransitionAnimation.Direction;
 import static com.ichi2.anki.Preferences.MINIMUM_CARDS_DUE_FOR_NOTIFICATION;
+import static com.ichi2.themes.Themes.currentTheme;
 
 public class AnkiActivity extends AppCompatActivity implements SimpleMessageDialog.SimpleMessageDialogListener, CollectionGetter {
 
@@ -128,6 +130,20 @@ protected void onStop() {
         mCustomTabActivityHelper.unbindCustomTabsService(this);
     }
 
+    @Override
+    public void onConfigurationChanged(@NonNull Configuration newConfig) {
+        super.onConfigurationChanged(newConfig);
+        boolean newNightModeStatus = (newConfig.uiMode & Configuration.UI_MODE_NIGHT_MASK) == Configuration.UI_MODE_NIGHT_YES;
+        // Check if theme should change
+        if (Themes.systemIsInNightMode != newNightModeStatus) {
+            Themes.systemIsInNightMode = newNightModeStatus;
+            if (Themes.themeFollowsSystem()) {
+                Themes.updateCurrentTheme();
+                restartActivity();
+            }
+        }
+    }
+
 
     @Override
     protected void onPause() {
@@ -468,10 +484,9 @@ public void openUrl(@NonNull Uri url) {
 
 
     private int getColorScheme() {
-        SharedPreferences prefs = AnkiDroidApp.getSharedPrefs(this);
         if (AppCompatDelegate.getDefaultNightMode() == AppCompatDelegate.MODE_NIGHT_FOLLOW_SYSTEM) {
             return COLOR_SCHEME_SYSTEM;
-        } else if (prefs.getBoolean("invertedColors", false)) {
+        } else if (currentTheme.isDark()) {
             return COLOR_SCHEME_DARK;
         } else {
             return COLOR_SCHEME_LIGHT;
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java b/AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java
index fcb25ce71ca1..2c33f3db16b0 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java
@@ -44,6 +44,7 @@
 import com.ichi2.anki.services.BootService;
 import com.ichi2.anki.services.NotificationService;
 import com.ichi2.compat.CompatHelper;
+import com.ichi2.themes.Themes;
 import com.ichi2.utils.AdaptionUtil;
 import com.ichi2.utils.ExceptionUtil;
 import com.ichi2.utils.LanguageUtil;
@@ -229,6 +230,9 @@ public void onCreate() {
 
         // Register for notifications
         mNotifications.observeForever(unused -> NotificationService.triggerNotificationFor(this));
+
+        Themes.systemIsInNightMode = (getResources().getConfiguration().uiMode & Configuration.UI_MODE_NIGHT_MASK) == Configuration.UI_MODE_NIGHT_YES;
+        Themes.updateCurrentTheme();
     }
 
     public void scheduleNotification() {
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/CustomMaterialTapTargetPromptBuilder.kt b/AnkiDroid/src/main/java/com/ichi2/anki/CustomMaterialTapTargetPromptBuilder.kt
index 9a21c51b13c9..a00eb146d0da 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/CustomMaterialTapTargetPromptBuilder.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/CustomMaterialTapTargetPromptBuilder.kt
@@ -20,6 +20,7 @@ package com.ichi2.anki
 import android.app.Activity
 import androidx.core.content.ContextCompat
 import com.ichi2.anki.PromptBackgroundAdapter.Companion.toPromptBackground
+import com.ichi2.themes.Themes
 import com.ichi2.utils.DimmedPromptBackgroundDecorator
 import uk.co.samuelwall.materialtaptargetprompt.MaterialTapTargetPrompt
 import uk.co.samuelwall.materialtaptargetprompt.extras.backgrounds.CirclePromptBackground
@@ -29,10 +30,6 @@ import uk.co.samuelwall.materialtaptargetprompt.extras.focals.RectanglePromptFoc
 
 class CustomMaterialTapTargetPromptBuilder<T>(val activity: Activity, val featureIdentifier: T) : MaterialTapTargetPrompt.Builder(activity) where T : Enum<T>, T : OnboardingFlag {
 
-    companion object {
-        private const val NIGHT_MODE_PREFERENCE = "invertedColors"
-    }
-
     fun createRectangle(): CustomMaterialTapTargetPromptBuilder<T> {
         promptFocal = RectanglePromptFocal()
         return this
@@ -80,7 +77,7 @@ class CustomMaterialTapTargetPromptBuilder<T>(val activity: Activity, val featur
     override fun show(): MaterialTapTargetPrompt? {
         /* Keep the focal colour as transparent for night mode
            so that the contents being highlighted are visible properly */
-        if (AnkiDroidApp.getSharedPrefs(activity).getBoolean(NIGHT_MODE_PREFERENCE, false)) {
+        if (Themes.currentTheme.isDark) {
             setFocalColourResource(R.color.transparent)
         }
 
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.kt b/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.kt
index c96e2ad21e66..8af16f4084e0 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Preferences.kt
@@ -69,8 +69,10 @@ import com.ichi2.libanki.utils.TimeManager
 import com.ichi2.preferences.*
 import com.ichi2.preferences.ControlPreference.Companion.addAllControlPreferencesToCategory
 import com.ichi2.themes.Themes
+import com.ichi2.themes.Themes.currentTheme
 import com.ichi2.themes.Themes.setThemeLegacy
 import com.ichi2.themes.Themes.systemIsInNightMode
+import com.ichi2.themes.Themes.updateCurrentTheme
 import com.ichi2.utils.AdaptionUtil.isRestrictedLearningDevice
 import com.ichi2.utils.KotlinCleanup
 import com.ichi2.utils.LanguageUtil
@@ -884,30 +886,41 @@ class Preferences : AnkiActivity() {
                 appThemePref.entryValues = appThemesValues.sliceArray(1..appThemesValues.lastIndex)
             }
 
-            val followSystem = Themes.themeFollowsSystem(requireContext())
-            dayThemePref.isEnabled = followSystem
-            nightThemePref.isEnabled = followSystem
+            val themeIsFollowSystem = appThemePref.value == Themes.FOLLOW_SYSTEM_MODE
+            dayThemePref.isEnabled = themeIsFollowSystem
+            nightThemePref.isEnabled = themeIsFollowSystem
 
             appThemePref.setOnPreferenceChangeListener { _, newValue ->
-                dayThemePref.isEnabled = newValue == Themes.FOLLOW_SYSTEM_MODE
-                nightThemePref.isEnabled = newValue == Themes.FOLLOW_SYSTEM_MODE
+                val selectedThemeIsFollowSystem = newValue == Themes.FOLLOW_SYSTEM_MODE
+                dayThemePref.isEnabled = selectedThemeIsFollowSystem
+                nightThemePref.isEnabled = selectedThemeIsFollowSystem
 
-                // Only restart if value was changed
+                // Only restart if theme has changed
                 if (newValue != appThemePref.value) {
-                    restartActivityOnBackStackTop()
+                    val previousThemeId = currentTheme.id
+                    appThemePref.value = newValue.toString()
+                    updateCurrentTheme()
+
+                    if (previousThemeId != currentTheme.id) {
+                        restartActivityOnBackStackTop()
+                    }
                 }
                 true
             }
 
             dayThemePref.setOnPreferenceChangeListener { _, newValue ->
-                if (newValue != dayThemePref.value && !systemIsInNightMode(requireContext())) {
+                if (newValue != dayThemePref.value && !systemIsInNightMode && newValue != currentTheme.id) {
+                    dayThemePref.value = newValue.toString()
+                    updateCurrentTheme()
                     restartActivityOnBackStackTop()
                 }
                 true
             }
 
             nightThemePref.setOnPreferenceChangeListener { _, newValue ->
-                if (newValue != nightThemePref.value && systemIsInNightMode(requireContext())) {
+                if (newValue != nightThemePref.value && systemIsInNightMode && newValue != currentTheme.id) {
+                    nightThemePref.value = newValue.toString()
+                    updateCurrentTheme()
                     restartActivityOnBackStackTop()
                 }
                 true
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.kt b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.kt
index daff6a769594..a5287514daf2 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.kt
@@ -57,7 +57,6 @@ import com.ichi2.anki.UIUtils.saveCollectionInBackground
 import com.ichi2.anki.UIUtils.showThemedToast
 import com.ichi2.anki.Whiteboard.Companion.createInstance
 import com.ichi2.anki.Whiteboard.OnPaintColorChangeListener
-import com.ichi2.anki.cardviewer.CardAppearance.Companion.isInNightMode
 import com.ichi2.anki.cardviewer.Gesture
 import com.ichi2.anki.cardviewer.ViewerCommand
 import com.ichi2.anki.dialogs.ConfirmationDialog
@@ -82,6 +81,7 @@ import com.ichi2.libanki.Collection
 import com.ichi2.libanki.sched.Counts
 import com.ichi2.libanki.utils.TimeManager
 import com.ichi2.themes.Themes
+import com.ichi2.themes.Themes.currentTheme
 import com.ichi2.themes.Themes.getColorFromAttr
 import com.ichi2.utils.AndroidUiUtils.isRunningOnTv
 import com.ichi2.utils.Computation
@@ -1335,18 +1335,17 @@ open class Reviewer : AbstractFlashcardViewer() {
     }
 
     private fun createWhiteboard() {
-        val sharedPrefs = AnkiDroidApp.getSharedPrefs(this)
         whiteboard = createInstance(this, true, this)
 
         // We use the pen color of the selected deck at the time the whiteboard is enabled.
         // This is how all other whiteboard settings are
-        val whiteboardPenColor = MetaDB.getWhiteboardPenColor(this, parentDid).fromPreferences(sharedPrefs)
+        val whiteboardPenColor = MetaDB.getWhiteboardPenColor(this, parentDid).fromPreferences()
         if (whiteboardPenColor != null) {
             whiteboard!!.penColor = whiteboardPenColor
         }
         whiteboard!!.setOnPaintColorChangeListener(object : OnPaintColorChangeListener {
             override fun onPaintColorChange(color: Int?) {
-                MetaDB.storeWhiteboardPenColor(this@Reviewer, parentDid, !isInNightMode(sharedPrefs), color)
+                MetaDB.storeWhiteboardPenColor(this@Reviewer, parentDid, !currentTheme.isDark, color)
             }
         })
         whiteboard!!.setOnTouchListener { v: View, event: MotionEvent? ->
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.kt b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.kt
index b0454c41930e..404ee2fb033d 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.kt
@@ -31,11 +31,11 @@ import android.widget.LinearLayout
 import androidx.annotation.CheckResult
 import androidx.annotation.VisibleForTesting
 import androidx.core.content.ContextCompat
-import com.ichi2.anki.cardviewer.CardAppearance.Companion.isInNightMode
 import com.ichi2.anki.dialogs.WhiteBoardWidthDialog
 import com.ichi2.compat.CompatHelper
 import com.ichi2.libanki.utils.Time
 import com.ichi2.libanki.utils.TimeUtils
+import com.ichi2.themes.Themes.currentTheme
 import com.ichi2.utils.DisplayUtils.getDisplayDimensions
 import com.ichi2.utils.KotlinCleanup
 import com.mrudultora.colorpicker.ColorPickerPopUp
@@ -519,8 +519,7 @@ class Whiteboard(activity: AnkiActivity, handleMultiTouch: Boolean, inverted: Bo
         private var mWhiteboardMultiTouchMethods: WhiteboardMultiTouchMethods? = null
         @JvmStatic
         fun createInstance(context: AnkiActivity, handleMultiTouch: Boolean, whiteboardMultiTouchMethods: WhiteboardMultiTouchMethods?): Whiteboard {
-            val sharedPrefs = AnkiDroidApp.getSharedPrefs(context)
-            val whiteboard = Whiteboard(context, handleMultiTouch, isInNightMode(sharedPrefs))
+            val whiteboard = Whiteboard(context, handleMultiTouch, currentTheme.isDark)
             mWhiteboardMultiTouchMethods = whiteboardMultiTouchMethods
             val lp2 = FrameLayout.LayoutParams(
                 ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardAppearance.kt b/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardAppearance.kt
index 1078a617d1cb..62377930822b 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardAppearance.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardAppearance.kt
@@ -19,11 +19,11 @@ import android.content.SharedPreferences
 import androidx.annotation.CheckResult
 import com.ichi2.anki.reviewer.ReviewerCustomFonts
 import com.ichi2.libanki.Card
-import com.ichi2.themes.Themes
-import com.ichi2.themes.Themes.AppTheme
+import com.ichi2.themes.Theme
+import com.ichi2.themes.Themes.currentTheme
 
 /** Responsible for calculating CSS and element styles and modifying content on a flashcard  */
-class CardAppearance(private val customFonts: ReviewerCustomFonts, private val cardZoom: Int, private val imageZoom: Int, val isNightMode: Boolean, private val centerVertically: Boolean) {
+class CardAppearance(private val customFonts: ReviewerCustomFonts, private val cardZoom: Int, private val imageZoom: Int, private val centerVertically: Boolean) {
     /** Below could be in a better abstraction.  */
     fun appendCssStyle(style: StringBuilder) {
         // Zoom cards
@@ -38,22 +38,22 @@ class CardAppearance(private val customFonts: ReviewerCustomFonts, private val c
     }
 
     @CheckResult
-    fun getCssClasses(@AppTheme currentTheme: String): String {
+    fun getCssClasses(): String {
         val cardClass = StringBuilder()
         if (centerVertically) {
             cardClass.append(" vertically_centered")
         }
-        if (isNightMode) {
+        if (currentTheme.isDark) {
             // Enable the night-mode class
             cardClass.append(" night_mode nightMode")
 
             // Emit the dark_mode selector to allow dark theme overrides
-            if (currentTheme == Themes.APP_DARK_THEME) {
+            if (currentTheme == Theme.DARK) {
                 cardClass.append(" ankidroid_dark_mode")
             }
         } else {
             // Emit the plain_mode selector to allow plain theme overrides
-            if (currentTheme == Themes.APP_PLAIN_THEME) {
+            if (currentTheme == Theme.PLAIN) {
                 cardClass.append(" ankidroid_plain_mode")
             }
         }
@@ -68,9 +68,9 @@ class CardAppearance(private val customFonts: ReviewerCustomFonts, private val c
             return style.toString()
         }
 
-    fun getCardClass(oneBasedCardOrdinal: Int, @AppTheme currentTheme: String): String {
+    fun getCardClass(oneBasedCardOrdinal: Int): String {
         var cardClass = "card card$oneBasedCardOrdinal"
-        cardClass += getCssClasses(currentTheme)
+        cardClass += getCssClasses()
         return cardClass
     }
 
@@ -81,14 +81,8 @@ class CardAppearance(private val customFonts: ReviewerCustomFonts, private val c
         fun create(customFonts: ReviewerCustomFonts, preferences: SharedPreferences): CardAppearance {
             val cardZoom = preferences.getInt("cardZoom", 100)
             val imageZoom = preferences.getInt("imageZoom", 100)
-            val nightMode = isInNightMode(preferences)
             val centerVertically = preferences.getBoolean("centerVertically", false)
-            return CardAppearance(customFonts, cardZoom, imageZoom, nightMode, centerVertically)
-        }
-
-        @JvmStatic
-        fun isInNightMode(sharedPrefs: SharedPreferences): Boolean {
-            return sharedPrefs.getBoolean("invertedColors", false)
+            return CardAppearance(customFonts, cardZoom, imageZoom, centerVertically)
         }
 
         @JvmStatic
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardHtml.kt b/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardHtml.kt
index ad399d09ce0a..bbabf432ed67 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardHtml.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardHtml.kt
@@ -23,6 +23,7 @@ import com.ichi2.anki.cardviewer.CardAppearance.Companion.hasUserDefinedNightMod
 import com.ichi2.libanki.*
 import com.ichi2.libanki.template.MathJax
 import com.ichi2.themes.HtmlColors
+import com.ichi2.themes.Themes.currentTheme
 import com.ichi2.utils.JSONObject
 import net.ankiweb.rsdroid.RustCleanup
 import timber.log.Timber
@@ -110,7 +111,7 @@ class CardHtml(
 
     private fun getCardClass(requiresMathjax: Boolean): String {
         // CSS class for card-specific styling
-        var cardClass: String = context.cardAppearance.getCardClass(ord + 1, context.currentTheme)
+        var cardClass: String = context.cardAppearance.getCardClass(ord + 1)
         if (requiresMathjax) {
             cardClass += " mathjax-needs-to-render"
         }
@@ -130,7 +131,7 @@ class CardHtml(
         fun createInstance(card: Card, reload: Boolean, side: Side, context: HtmlGenerator): CardHtml {
             val content = displayString(card, reload, side, context)
 
-            val nightModeInversion = context.cardAppearance.isNightMode && !hasUserDefinedNightMode(card)
+            val nightModeInversion = currentTheme.isDark && !hasUserDefinedNightMode(card)
 
             val renderOutput = card.render_output()
             val questionAv = renderOutput.question_av_tags
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/HtmlGenerator.kt b/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/HtmlGenerator.kt
index 2563e0056db2..9ae6a600e574 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/HtmlGenerator.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/HtmlGenerator.kt
@@ -24,8 +24,6 @@ import com.ichi2.anki.reviewer.ReviewerCustomFonts
 import com.ichi2.libanki.Card
 import com.ichi2.libanki.Sound
 import com.ichi2.libanki.Utils
-import com.ichi2.themes.Themes.AppTheme
-import com.ichi2.themes.Themes.getCurrentTheme
 import timber.log.Timber
 import java.io.IOException
 
@@ -33,7 +31,6 @@ class HtmlGenerator(
     private val typeAnswer: TypeAnswer,
     val cardAppearance: CardAppearance,
     val cardTemplate: CardTemplate,
-    val currentTheme: String,
     val resources: Resources,
     private val baseUrl: String
 ) {
@@ -58,11 +55,10 @@ class HtmlGenerator(
         @JvmStatic
         fun createInstance(context: Context, typeAnswer: TypeAnswer, baseUrl: String): HtmlGenerator {
             val preferences = AnkiDroidApp.getSharedPrefs(context)
-            @AppTheme val currentTheme = getCurrentTheme(context)
             val cardAppearance = CardAppearance.create(ReviewerCustomFonts(context), preferences)
             val cardHtmlTemplate = loadCardTemplate(context)
 
-            return HtmlGenerator(typeAnswer, cardAppearance, cardHtmlTemplate, currentTheme, context.resources, baseUrl)
+            return HtmlGenerator(typeAnswer, cardAppearance, cardHtmlTemplate, context.resources, baseUrl)
         }
 
         /**
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/ScopedStorageMigrationDialog.kt b/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/ScopedStorageMigrationDialog.kt
index ced38f3b4edb..34580c2973d6 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/ScopedStorageMigrationDialog.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/dialogs/ScopedStorageMigrationDialog.kt
@@ -26,7 +26,7 @@ import android.widget.CheckBox
 import com.afollestad.materialdialogs.MaterialDialog
 import com.afollestad.materialdialogs.util.DialogUtils
 import com.ichi2.anki.*
-import com.ichi2.anki.cardviewer.CardAppearance
+import com.ichi2.themes.Themes
 import com.ichi2.ui.FixedTextView
 import timber.log.Timber
 
@@ -128,9 +128,7 @@ object ScopedStorageMigrationConfirmationDialog {
 
     private fun getContentColor(ctx: Context): Int? {
         return try {
-            val isDarkTheme = CardAppearance.isInNightMode(AnkiDroidApp.getSharedPrefs(ctx))
-
-            val theme = if (isDarkTheme) com.afollestad.materialdialogs.R.style.MD_Dark else com.afollestad.materialdialogs.R.style.MD_Light
+            val theme = if (Themes.currentTheme.isDark) com.afollestad.materialdialogs.R.style.MD_Dark else com.afollestad.materialdialogs.R.style.MD_Light
 
             val contextThemeWrapper = ContextThemeWrapper(ctx, theme)
             val contentColorFallback = DialogUtils.resolveColor(contextThemeWrapper, android.R.attr.textColorSecondary)
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/model/WhiteboardPenColor.kt b/AnkiDroid/src/main/java/com/ichi2/anki/model/WhiteboardPenColor.kt
index abea5a261c38..da29a9beee01 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/model/WhiteboardPenColor.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/model/WhiteboardPenColor.kt
@@ -16,14 +16,12 @@
 
 package com.ichi2.anki.model
 
-import android.content.SharedPreferences
 import androidx.annotation.CheckResult
-import com.ichi2.anki.cardviewer.CardAppearance.Companion.isInNightMode
+import com.ichi2.themes.Themes.currentTheme
 
 class WhiteboardPenColor(val lightPenColor: Int?, val darkPenColor: Int?) {
-    fun fromPreferences(sharedPrefs: SharedPreferences): Int? {
-        val isInNightMode = isInNightMode(sharedPrefs)
-        return if (isInNightMode) {
+    fun fromPreferences(): Int? {
+        return if (currentTheme.isDark) {
             darkPenColor
         } else {
             lightPenColor
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt b/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt
index a6881cb2bb8f..0f5344bb48ea 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt
@@ -31,6 +31,7 @@ import com.ichi2.anki.reviewer.FullScreenMode
 import com.ichi2.anki.reviewer.MappableBinding
 import com.ichi2.anki.web.CustomSyncServer
 import com.ichi2.libanki.Consts
+import com.ichi2.themes.Themes
 import com.ichi2.utils.HashUtil.HashSetInit
 import timber.log.Timber
 
@@ -84,6 +85,7 @@ object PreferenceUpgradeService {
                 yield(RemoveLegacyMediaSyncUrl())
                 yield(UpdateNoteEditorToolbarPrefs())
                 yield(UpgradeGesturesToControls())
+                yield(UpgradeDayAndNightThemes())
             }
 
             /** Returns a list of preference upgrade classes which have not been applied */
@@ -339,5 +341,28 @@ object PreferenceUpgradeService {
                 command.addBindingAtEnd(preferences, mappableBinding)
             }
         }
+        internal class UpgradeDayAndNightThemes : PreferenceUpgrade(6) {
+            override fun upgrade(preferences: SharedPreferences) {
+                val dayTheme = preferences.getString("dayTheme", "0")
+                val nightTheme = preferences.getString("nightTheme", "0")
+
+                preferences.edit {
+                    if (dayTheme == "1") { // plain
+                        putString("dayTheme", "2")
+                    } else { // light
+                        putString("dayTheme", "1")
+                    }
+                    if (nightTheme == "1") { // dark
+                        putString("nightTheme", "4")
+                    } else { // black
+                        putString("nightTheme", "3")
+                    }
+                    remove("invertedColors")
+                }
+                if (AnkiDroidApp.isInitialized()) {
+                    Themes.updateCurrentTheme()
+                }
+            }
+        }
     }
 }
diff --git a/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt b/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt
index c5cd8565dfcc..b6b4e8550ebb 100644
--- a/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt
@@ -18,13 +18,10 @@
 
 package com.ichi2.themes
 
-import android.app.UiModeManager
 import android.content.Context
-import androidx.annotation.StringDef
 import androidx.core.content.ContextCompat
 import com.ichi2.anki.AnkiDroidApp
 import com.ichi2.anki.R
-import timber.log.Timber
 
 /**
  * Handles the user selectable themes
@@ -36,100 +33,52 @@ import timber.log.Timber
 object Themes {
     const val ALPHA_ICON_ENABLED_LIGHT = 255 // 100%
     const val ALPHA_ICON_DISABLED_LIGHT = 76 // 31%
-    const val ALPHA_ICON_ENABLED_DARK = 138 // 54%
 
-    // Themes preferences keys
+    const val FOLLOW_SYSTEM_MODE = "0"
     private const val APP_THEME_KEY = "appTheme"
     private const val DAY_THEME_KEY = "dayTheme"
     private const val NIGHT_THEME_KEY = "nightTheme"
-    private const val NIGHT_MODE_PREFERENCE = "invertedColors"
 
-    /* App themes values
-     * These are unique values which be used to differentiate the themes,
-     * following their values set on their ListPreference
-     */
-    const val FOLLOW_SYSTEM_MODE = "0"
-    private const val APP_LIGHT_THEME = "1"
-    const val APP_PLAIN_THEME = "2"
-    private const val APP_BLACK_THEME = "3"
-    const val APP_DARK_THEME = "4"
-
-    @kotlin.annotation.Retention(AnnotationRetention.SOURCE)
-    @StringDef(APP_LIGHT_THEME, APP_PLAIN_THEME, APP_BLACK_THEME, APP_DARK_THEME)
-    annotation class AppTheme
-
-    /*
-     * Follow system day and night themes.
-     * Only used if "Follow system" is the selected app theme
-     */
-    // Day themes
-    private const val DAY_LIGHT_THEME = "0"
-    private const val DAY_PLAIN_THEME = "1"
+    @JvmField
+    var currentTheme: Theme = Theme.fallback
 
-    // Night themes
-    private const val NIGHT_BLACK_THEME = "0"
-    private const val NIGHT_DARK_THEME = "1"
+    @JvmField
+    var systemIsInNightMode: Boolean = false
 
     /**
-     * Sets the current theme based on what is selected
-     * by the user on the themes preference.
-     * Also sets [NIGHT_MODE_PREFERENCE] if night mode is being used or not
+     * Sets theme to [currentTheme]
      */
     @JvmStatic
     fun setTheme(context: Context) {
-        val prefs = AnkiDroidApp.getSharedPrefs(context.applicationContext)
-        if (themeFollowsSystem(context)) {
-            if (systemIsInNightMode(context)) {
-                when (prefs.getString(NIGHT_THEME_KEY, NIGHT_BLACK_THEME)) {
-                    NIGHT_BLACK_THEME -> context.setTheme(R.style.Theme_Black_Compat)
-                    NIGHT_DARK_THEME -> context.setTheme(R.style.Theme_Dark_Compat)
-                }
-                setNightModePreference(context, true)
-            } else {
-                when (prefs.getString(DAY_THEME_KEY, DAY_LIGHT_THEME)) {
-                    DAY_LIGHT_THEME -> context.setTheme(R.style.Theme_Light_Compat)
-                    DAY_PLAIN_THEME -> context.setTheme(R.style.Theme_Plain_Compat)
-                }
-                setNightModePreference(context, false)
-            }
-        } else {
-            when (prefs.getString(APP_THEME_KEY, APP_LIGHT_THEME)) {
-                APP_LIGHT_THEME -> { setNightModePreference(context, false); context.setTheme(R.style.Theme_Light_Compat) }
-                APP_PLAIN_THEME -> { setNightModePreference(context, false); context.setTheme(R.style.Theme_Plain_Compat) }
-                APP_BLACK_THEME -> { setNightModePreference(context, true); context.setTheme(R.style.Theme_Black_Compat) }
-                APP_DARK_THEME -> { setNightModePreference(context, true); context.setTheme(R.style.Theme_Dark_Compat) }
-            }
-        }
-        disableXiaomiForceDarkMode(context)
+        context.setTheme(currentTheme.resId)
     }
 
-    @JvmStatic
+    /**
+     * Sets theme to the legacy version of [currentTheme]
+     */
     fun setThemeLegacy(context: Context) {
-        // we need the applicationContext to obtain preferences, we can't do this with a regular
-        // Activity context since this is called before super.onCreate()
-        val applicationContext = context.applicationContext
-        val prefs = AnkiDroidApp.getSharedPrefs(applicationContext)
-        if (themeFollowsSystem(applicationContext)) {
-            if (systemIsInNightMode(applicationContext)) {
-                when (prefs.getString(NIGHT_THEME_KEY, NIGHT_BLACK_THEME)) {
-                    NIGHT_BLACK_THEME -> context.setTheme(R.style.LegacyActionBarBlack)
-                    NIGHT_DARK_THEME -> context.setTheme(R.style.LegacyActionBarDark)
-                }
+        context.setTheme(currentTheme.legacyResId)
+    }
+
+    /**
+     * Updates [currentTheme] value based on preferences.
+     * If `Follow system` is selected, it's updated to the theme set
+     * on `Day` or `Night` theme according to system's current mode
+     * Otherwise, updates to the selected theme.
+     */
+    @JvmStatic
+    fun updateCurrentTheme() {
+        val prefs = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance().applicationContext)
+
+        currentTheme = if (themeFollowsSystem()) {
+            if (systemIsInNightMode) {
+                Theme.ofId(prefs.getString(NIGHT_THEME_KEY, Theme.BLACK.id)!!)
             } else {
-                when (prefs.getString(DAY_THEME_KEY, DAY_LIGHT_THEME)) {
-                    DAY_LIGHT_THEME -> context.setTheme(R.style.LegacyActionBarLight)
-                    DAY_PLAIN_THEME -> context.setTheme(R.style.LegacyActionBarPlain)
-                }
+                Theme.ofId(prefs.getString(DAY_THEME_KEY, Theme.LIGHT.id)!!)
             }
         } else {
-            when (prefs.getString(APP_THEME_KEY, APP_LIGHT_THEME)) {
-                APP_LIGHT_THEME -> context.setTheme(R.style.LegacyActionBarLight)
-                APP_PLAIN_THEME -> context.setTheme(R.style.LegacyActionBarPlain)
-                APP_BLACK_THEME -> context.setTheme(R.style.LegacyActionBarBlack)
-                APP_DARK_THEME -> context.setTheme(R.style.LegacyActionBarDark)
-            }
+            Theme.ofId(prefs.getString(APP_THEME_KEY, Theme.fallback.id)!!)
         }
-        disableXiaomiForceDarkMode(context)
     }
 
     /**
@@ -141,13 +90,11 @@ object Themes {
         context.setTheme(R.style.ThemeOverlay_Xiaomi)
     }
 
-    @JvmStatic
     fun getResFromAttr(context: Context, resAttr: Int): Int {
         val attrs = intArrayOf(resAttr)
         return getResFromAttr(context, attrs)[0]
     }
 
-    @JvmStatic
     fun getResFromAttr(context: Context, attrs: IntArray): IntArray {
         val ta = context.obtainStyledAttributes(attrs)
         for (i in attrs.indices) {
@@ -174,58 +121,11 @@ object Themes {
     }
 
     /**
-     * @return code of the theme being used.
-     * Follow system Day and Night themes are exchanged
-     * to their [AppTheme] equivalents so they can be differentiated by value
-     */
-    @JvmStatic
-    @AppTheme
-    fun getCurrentTheme(context: Context): String {
-        val prefs = AnkiDroidApp.getSharedPrefs(context)
-        if (themeFollowsSystem(context)) {
-            if (systemIsInNightMode(context)) {
-                when (prefs.getString(NIGHT_THEME_KEY, NIGHT_BLACK_THEME)) {
-                    NIGHT_BLACK_THEME -> return APP_BLACK_THEME
-                    NIGHT_DARK_THEME -> return APP_DARK_THEME
-                }
-            } else {
-                when (prefs.getString(DAY_THEME_KEY, DAY_LIGHT_THEME)) {
-                    DAY_LIGHT_THEME -> return APP_LIGHT_THEME
-                    DAY_PLAIN_THEME -> return APP_PLAIN_THEME
-                }
-            }
-        }
-        return prefs.getString(APP_THEME_KEY, APP_LIGHT_THEME)!!
-    }
-
-    /**
-     * @return if user system is in night mode
-     */
-    @JvmStatic
-    fun systemIsInNightMode(context: Context): Boolean {
-        val uiModeManager = ContextCompat.getSystemService(context, UiModeManager::class.java)
-        if (uiModeManager != null) {
-            return uiModeManager.nightMode == UiModeManager.MODE_NIGHT_YES
-        }
-        Timber.w("Unable to getSystemService() - UIModeManager")
-        return false
-    }
-
-    /**
-     * Sets [NIGHT_MODE_PREFERENCE] to [isNightMode]
-     */
-    @JvmStatic
-    fun setNightModePreference(context: Context, isNightMode: Boolean) {
-        AnkiDroidApp.getSharedPrefs(context).edit().putBoolean(NIGHT_MODE_PREFERENCE, isNightMode).apply()
-    }
-
-    /**
-     * @return if user current selected theme is "Follow system"
+     * @return if current selected theme is `Follow system`
      */
     @JvmStatic
-    fun themeFollowsSystem(context: Context): Boolean {
-        val prefs = AnkiDroidApp.getSharedPrefs(context)
-        val selectedAppTheme = prefs.getString(APP_THEME_KEY, FOLLOW_SYSTEM_MODE)
-        return selectedAppTheme == FOLLOW_SYSTEM_MODE
+    fun themeFollowsSystem(): Boolean {
+        val prefs = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance().applicationContext)
+        return prefs.getString(APP_THEME_KEY, FOLLOW_SYSTEM_MODE) == FOLLOW_SYSTEM_MODE
     }
 }
diff --git a/AnkiDroid/src/main/res/values/constants.xml b/AnkiDroid/src/main/res/values/constants.xml
index 888db6d9d1d0..4ff4bd8ad137 100644
--- a/AnkiDroid/src/main/res/values/constants.xml
+++ b/AnkiDroid/src/main/res/values/constants.xml
@@ -244,13 +244,14 @@
         <item>3</item> <!-- Black -->
         <item>4</item> <!-- Dark -->
     </string-array>
+    <!-- Day and night values should be the same as their App theme equivalent -->
     <string-array name="day_theme_values">
-        <item>0</item>
         <item>1</item>
+        <item>2</item>
     </string-array>
     <string-array name="night_theme_values">
-        <item>0</item>
-        <item>1</item>
+        <item>3</item>
+        <item>4</item>
     </string-array>
 
     <string name="answer_buttons_position_preference" translatable="false">answerButtonPosition</string>
diff --git a/AnkiDroid/src/test/java/com/ichi2/anki/ReviewerNoParamTest.kt b/AnkiDroid/src/test/java/com/ichi2/anki/ReviewerNoParamTest.kt
index a86767361959..7a44d93f510e 100644
--- a/AnkiDroid/src/test/java/com/ichi2/anki/ReviewerNoParamTest.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/anki/ReviewerNoParamTest.kt
@@ -31,6 +31,8 @@ import com.ichi2.anki.reviewer.FullScreenMode
 import com.ichi2.anki.reviewer.FullScreenMode.Companion.setPreference
 import com.ichi2.anki.reviewer.MappableBinding
 import com.ichi2.libanki.Consts
+import com.ichi2.themes.Theme
+import com.ichi2.themes.Themes.currentTheme
 import org.hamcrest.MatcherAssert.assertThat
 import org.hamcrest.Matchers.*
 import org.junit.Before
@@ -306,10 +308,6 @@ class ReviewerNoParamTest : RobolectricTest() {
         MetaDB.storeWhiteboardPenColor(targetContext, Consts.DEFAULT_DECK_ID, true, value)
     }
 
-    private fun enableDarkMode() {
-        AnkiDroidApp.getSharedPrefs(targetContext).edit().putBoolean("invertedColors", true).apply()
-    }
-
     private val penColor: WhiteboardPenColor
         get() = MetaDB.getWhiteboardPenColor(targetContext, Consts.DEFAULT_DECK_ID)
 
@@ -331,7 +329,7 @@ class ReviewerNoParamTest : RobolectricTest() {
         addNoteUsingBasicModel("Hello", "World")
 
         val reviewer = startReviewer()
-        enableDarkMode()
+        currentTheme = Theme.DARK
         reviewer.toggleWhiteboard()
 
         return reviewer.whiteboard
diff --git a/AnkiDroid/src/test/java/com/ichi2/anki/servicemodel/PreferenceUpgradeServiceTest.kt b/AnkiDroid/src/test/java/com/ichi2/anki/servicemodel/PreferenceUpgradeServiceTest.kt
index 8aae0fdac633..3a1d0fd9967e 100644
--- a/AnkiDroid/src/test/java/com/ichi2/anki/servicemodel/PreferenceUpgradeServiceTest.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/anki/servicemodel/PreferenceUpgradeServiceTest.kt
@@ -144,4 +144,30 @@ class PreferenceUpgradeServiceTest : RobolectricTest() {
         assertEquals("Button text prefs", "1", toolbarButtons[0].buttonText)
         assertEquals("Button text prefs", "2", toolbarButtons[1].buttonText)
     }
+
+    @Test
+    fun day_and_night_themes() {
+        // Plain and Dark
+        mPrefs.edit {
+            putString("dayTheme", "1")
+            putString("nightTheme", "1")
+            putBoolean("invertedColors", true)
+        }
+        PreferenceUpgrade.UpgradeDayAndNightThemes().performUpgrade(mPrefs)
+
+        assertThat(mPrefs.getString("dayTheme", "0"), equalTo("2"))
+        assertThat(mPrefs.getString("nightTheme", "0"), equalTo("4"))
+        assertThat(mPrefs.contains("invertedColors"), equalTo(false))
+
+        // Light and Black
+        mPrefs.edit {
+            putString("dayTheme", "0")
+            putString("nightTheme", "0")
+        }
+        PreferenceUpgrade.UpgradeDayAndNightThemes().performUpgrade(mPrefs)
+
+        assertThat(mPrefs.getString("dayTheme", "1"), equalTo("1"))
+        assertThat(mPrefs.getString("nightTheme", "1"), equalTo("3"))
+        assertThat(mPrefs.contains("invertedColors"), equalTo(false))
+    }
 }
