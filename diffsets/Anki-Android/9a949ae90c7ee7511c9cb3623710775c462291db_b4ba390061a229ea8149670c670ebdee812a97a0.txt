diff --git a/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/CustomStudyDialogTest.kt b/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/CustomStudyDialogTest.kt
index 4a174a453eb8..25f8a3d1e8f9 100644
--- a/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/CustomStudyDialogTest.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/CustomStudyDialogTest.kt
@@ -68,36 +68,37 @@ class CustomStudyDialogTest : RobolectricTest() {
             .withArguments(CustomStudyDialog.ContextMenuOption.STUDY_AHEAD, 1)
             .arguments
         val factory = CustomStudyDialogFactory({ this.col }, mockListener)
-        val scenario = FragmentScenario.launch(CustomStudyDialog::class.java, args, androidx.appcompat.R.style.Theme_AppCompat, factory)
-        scenario.moveToState(Lifecycle.State.RESUMED)
-        scenario.onFragment { f: CustomStudyDialog ->
-            val dialog = assertNotNull(f.dialog as AlertDialog?)
-            dialog.performPositiveClick()
+        FragmentScenario.launch(CustomStudyDialog::class.java, args, androidx.appcompat.R.style.Theme_AppCompat, factory).use { scenario ->
+            scenario.moveToState(Lifecycle.State.RESUMED)
+            scenario.onFragment { f: CustomStudyDialog ->
+                val dialog = assertNotNull(f.dialog as AlertDialog?)
+                dialog.performPositiveClick()
+            }
+            val customStudy = col.decks.current()
+            MatcherAssert.assertThat("Custom Study should be dynamic", customStudy.isFiltered)
+            MatcherAssert.assertThat("could not find deck: Custom study session", customStudy, notNullValue())
+            customStudy.remove("id")
+            customStudy.remove("mod")
+            customStudy.remove("name")
+            val expected = "{" +
+                "\"browserCollapsed\":false," +
+                "\"collapsed\":false," +
+                "\"delays\":null," +
+                "\"desc\":\"\"," +
+                "\"dyn\":1," +
+                "\"lrnToday\":[0,0]," +
+                "\"newToday\":[0,0]," +
+                "\"previewDelay\":0," +
+                "\"previewAgainSecs\":60,\"previewHardSecs\":600,\"previewGoodSecs\":0," +
+                "\"resched\":true," +
+                "\"revToday\":[0,0]," +
+                "\"separate\":true," +
+                "\"terms\":[[\"deck:\\\"Default\\\" prop:due<=1\",99999,6]]," +
+                "\"timeToday\":[0,0]," +
+                "\"usn\":-1" +
+                "}"
+            MatcherAssert.assertThat(customStudy, isJsonEqual(JSONObject(expected)))
         }
-        val customStudy = col.decks.current()
-        MatcherAssert.assertThat("Custom Study should be dynamic", customStudy.isFiltered)
-        MatcherAssert.assertThat("could not find deck: Custom study session", customStudy, notNullValue())
-        customStudy.remove("id")
-        customStudy.remove("mod")
-        customStudy.remove("name")
-        val expected = "{" +
-            "\"browserCollapsed\":false," +
-            "\"collapsed\":false," +
-            "\"delays\":null," +
-            "\"desc\":\"\"," +
-            "\"dyn\":1," +
-            "\"lrnToday\":[0,0]," +
-            "\"newToday\":[0,0]," +
-            "\"previewDelay\":0," +
-            "\"previewAgainSecs\":60,\"previewHardSecs\":600,\"previewGoodSecs\":0," +
-            "\"resched\":true," +
-            "\"revToday\":[0,0]," +
-            "\"separate\":true," +
-            "\"terms\":[[\"deck:\\\"Default\\\" prop:due<=1\",99999,6]]," +
-            "\"timeToday\":[0,0]," +
-            "\"usn\":-1" +
-            "}"
-        MatcherAssert.assertThat(customStudy, isJsonEqual(JSONObject(expected)))
     }
 
     @Test
@@ -118,12 +119,13 @@ class CustomStudyDialogTest : RobolectricTest() {
         whenever(mockCollection.sched).thenReturn(mockSched)
         whenever(mockSched.newCount()).thenReturn(0)
         val factory = CustomStudyDialogFactory({ mockCollection }, mockListener)
-        val scenario = FragmentScenario.launch(CustomStudyDialog::class.java, args, androidx.appcompat.R.style.Theme_AppCompat, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: CustomStudyDialog ->
-            val dialog = f.dialog as AlertDialog?
-            MatcherAssert.assertThat(dialog, IsNull.notNullValue())
-            onView(withText(R.string.custom_study_increase_new_limit)).inRoot(isDialog()).check(doesNotExist())
+        FragmentScenario.launch(CustomStudyDialog::class.java, args, androidx.appcompat.R.style.Theme_AppCompat, factory).use { scenario ->
+            scenario.moveToState(Lifecycle.State.STARTED)
+            scenario.onFragment { f: CustomStudyDialog ->
+                val dialog = f.dialog as AlertDialog?
+                MatcherAssert.assertThat(dialog, IsNull.notNullValue())
+                onView(withText(R.string.custom_study_increase_new_limit)).inRoot(isDialog()).check(doesNotExist())
+            }
         }
     }
 }
diff --git a/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/DeckPickerContextMenuTest.kt b/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/DeckPickerContextMenuTest.kt
index e4b78db5b69d..df856aee72bc 100644
--- a/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/DeckPickerContextMenuTest.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/DeckPickerContextMenuTest.kt
@@ -20,6 +20,7 @@ import android.os.Bundle
 import androidx.appcompat.app.AlertDialog
 import androidx.core.content.edit
 import androidx.core.os.bundleOf
+import androidx.fragment.app.testing.FragmentScenario
 import androidx.fragment.app.testing.FragmentScenario.Companion.launch
 import androidx.test.core.app.ApplicationProvider
 import androidx.test.ext.junit.runners.AndroidJUnit4
@@ -31,14 +32,19 @@ import com.ichi2.libanki.DeckId
 import com.ichi2.testutils.BackupManagerTestUtilities.setupSpaceForBackup
 import org.hamcrest.CoreMatchers.equalTo
 import org.hamcrest.MatcherAssert
+import org.junit.After
 import org.junit.Before
 import org.junit.Test
 import org.junit.runner.RunWith
+import timber.log.Timber
 import kotlin.test.assertFailsWith
 import kotlin.test.assertTrue
 
 @RunWith(AndroidJUnit4::class)
 class DeckPickerContextMenuTest {
+
+    private val scenariosForCleanup = ArrayList<FragmentScenario<*>>()
+
     @Before
     fun before() {
         val context = ApplicationProvider.getApplicationContext<AnkiDroidApp>()
@@ -46,6 +52,17 @@ class DeckPickerContextMenuTest {
         setupSpaceForBackup(context)
     }
 
+    @After
+    fun after() {
+        for (scenario in scenariosForCleanup) {
+            try {
+                scenario.close()
+            } catch (e: Exception) {
+                Timber.e(e, "ignored")
+            }
+        }
+    }
+
     @Test
     fun ensure_cannot_be_instantiated_without_expected_arguments() {
         // fails on deck id missing from arguments
@@ -80,16 +97,12 @@ class DeckPickerContextMenuTest {
                 DeckPickerContextMenu.ARG_DECK_HAS_BURIED_IN_DECK to false
             }
         }
-        launch(DeckPickerContextMenu::class.java, arguments, R.style.Theme_Light)
+        launch(arguments)
     }
 
     @Test
     fun `Shows standard options`() {
-        launch(
-            DeckPickerContextMenu::class.java,
-            withArguments(),
-            R.style.Theme_Light
-        ).onFragment { fragment ->
+        launch(withArguments()).onFragment { fragment ->
             fragment.assertOptionPresent(R.string.menu_add)
             fragment.assertOptionPresent(R.string.browse_cards)
             fragment.assertOptionPresent(R.string.rename_deck)
@@ -112,11 +125,7 @@ class DeckPickerContextMenuTest {
     fun `DELETE_DECK is the last option in the menu(issue 10283)`() {
         // "Delete deck" was previously close to "Custom study" which caused misclicks.
         // This is less likely at the bottom of the list
-        launch(
-            DeckPickerContextMenu::class.java,
-            withArguments(),
-            R.style.Theme_Light
-        ).onFragment { fragment ->
+        launch(withArguments()).onFragment { fragment ->
             MatcherAssert.assertThat(
                 "'Delete deck' should be last item in the menu",
                 fragment.foundOptions().last(),
@@ -127,11 +136,7 @@ class DeckPickerContextMenuTest {
 
     @Test
     fun `Shows options to empty and rebuild when deck is dynamic`() {
-        launch(
-            DeckPickerContextMenu::class.java,
-            withArguments(isDynamic = true),
-            R.style.Theme_Light
-        ).onFragment { fragment ->
+        launch(withArguments(isDynamic = true)).onFragment { fragment ->
             assertTrue(
                 fragment.foundOptions().contains(fragment.getString(R.string.empty_cram_label)),
                 "'Empty' should be present when deck is dynamic"
@@ -145,11 +150,7 @@ class DeckPickerContextMenuTest {
 
     @Test
     fun `Shows option to create subdeck when deck is not dynamic`() {
-        launch(
-            DeckPickerContextMenu::class.java,
-            withArguments(),
-            R.style.Theme_Light
-        ).onFragment { fragment ->
+        launch(withArguments()).onFragment { fragment ->
             assertTrue(
                 fragment.foundOptions().contains(fragment.getString(R.string.create_subdeck)),
                 "'Create subdeck' should be present when deck is not dynamic"
@@ -159,11 +160,7 @@ class DeckPickerContextMenuTest {
 
     @Test
     fun `Shows option to unbury if deck has buried cards`() {
-        launch(
-            DeckPickerContextMenu::class.java,
-            withArguments(hasBuriedCards = true),
-            R.style.Theme_Light
-        ).onFragment { fragment ->
+        launch(withArguments(hasBuriedCards = true)).onFragment { fragment ->
             assertTrue(
                 fragment.foundOptions().contains(fragment.getString(R.string.unbury)),
                 "'Unbury' should be present when deck has buried cards"
@@ -171,6 +168,10 @@ class DeckPickerContextMenuTest {
         }
     }
 
+    private fun launch(arguments: Bundle) = launch(DeckPickerContextMenu::class.java, arguments, R.style.Theme_Light).also {
+        scenariosForCleanup.add(it)
+    }
+
     private fun DeckPickerContextMenu.foundOptions(): List<String> {
         val foundOptions = mutableListOf<String>()
         val menuAdapter = (dialog as AlertDialog).listView.adapter
diff --git a/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/tags/TagsDialogTest.kt b/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/tags/TagsDialogTest.kt
index 766098f0cd4b..51aff6a8c8a5 100644
--- a/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/tags/TagsDialogTest.kt
+++ b/AnkiDroid/src/test/java/com/ichi2/anki/dialogs/tags/TagsDialogTest.kt
@@ -36,8 +36,6 @@ import com.ichi2.compat.CompatHelper.Companion.getSerializableCompat
 import com.ichi2.testutils.HamcrestUtils.containsInAnyOrder
 import com.ichi2.testutils.ParametersUtils
 import com.ichi2.testutils.RecyclerViewUtils
-import com.ichi2.testutils.common.Flaky
-import com.ichi2.testutils.common.OS
 import com.ichi2.ui.CheckBoxTriStates
 import com.ichi2.utils.ListUtil
 import org.hamcrest.MatcherAssert.assertThat
@@ -51,8 +49,6 @@ import timber.log.Timber
 import java.util.concurrent.atomic.AtomicReference
 
 @RunWith(AndroidJUnit4::class)
-// inheriting from RobolectricTest is required for @Flaky
-@Flaky(OS.WINDOWS, "16404: tests in this class occasionally hang")
 class TagsDialogTest : RobolectricTest() {
     @Test
     fun testTagsDialogCustomStudyOptionInterface() {
@@ -60,12 +56,10 @@ class TagsDialogTest : RobolectricTest() {
         val allTags = listOf("1", "2", "3", "4")
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, ArrayList(), allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -85,10 +79,8 @@ class TagsDialogTest : RobolectricTest() {
         val allTags = listOf("1", "2", "3", "4")
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, ArrayList(), allTags)
-            .arguments
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+            .requireArguments()
+        runTagsDialogScenario(args) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
             val returnedList = AtomicReference<List<String>?>()
@@ -121,12 +113,10 @@ class TagsDialogTest : RobolectricTest() {
         val checkedTags = listOf("a", "b")
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -156,12 +146,10 @@ class TagsDialogTest : RobolectricTest() {
         val checkedTags = listOf("a", "b")
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -194,12 +182,10 @@ class TagsDialogTest : RobolectricTest() {
         val expectedIndeterminate = listOf("b")
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, uncheckedTags, expectedAllTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -249,12 +235,10 @@ class TagsDialogTest : RobolectricTest() {
         )
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -296,12 +280,10 @@ class TagsDialogTest : RobolectricTest() {
         val checkedTags = listOf("common::speak::daily", "common::sport::tennis")
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -350,12 +332,10 @@ class TagsDialogTest : RobolectricTest() {
         val checkedTags = listOf("common")
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -398,12 +378,10 @@ class TagsDialogTest : RobolectricTest() {
         )
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -439,12 +417,10 @@ class TagsDialogTest : RobolectricTest() {
         val checkedTags = emptyList<String>()
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -486,12 +462,10 @@ class TagsDialogTest : RobolectricTest() {
         val checkedTags = emptyList<String>()
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
 
@@ -605,12 +579,10 @@ class TagsDialogTest : RobolectricTest() {
         val checkedTags = emptyList<String>()
         val args = TagsDialog(ParametersUtils.whatever())
             .withTestArguments(type, checkedTags, allTags)
-            .arguments
+            .requireArguments()
         val mockListener = Mockito.mock(TagsDialogListener::class.java)
         val factory = TagsDialogFactory(mockListener)
-        val scenario = FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory)
-        scenario.moveToState(Lifecycle.State.STARTED)
-        scenario.onFragment { f: TagsDialog ->
+        runTagsDialogScenario(args, factory) { f: TagsDialog ->
             val dialog = f.dialog as AlertDialog?
             assertThat(dialog, IsNull.notNullValue())
             val editText = f.getSearchView()!!.findViewById<EditText>(androidx.appcompat.R.id.search_src_text)!!
@@ -708,6 +680,19 @@ class TagsDialogTest : RobolectricTest() {
         allTags = allTags
     )
 
+    private fun runTagsDialogScenario(
+        args: Bundle,
+        factory: TagsDialogFactory? = null,
+        block: (TagsDialog) -> Unit
+    ) {
+        FragmentScenario.launch(TagsDialog::class.java, args, R.style.Theme_Light, factory).use { scenario ->
+            scenario.moveToState(Lifecycle.State.STARTED)
+            scenario.onFragment { tagsDialog: TagsDialog ->
+                block(tagsDialog)
+            }
+        }
+    }
+
     companion object {
         private fun mockLifecycleOwner(): LifecycleOwner {
             val owner = Mockito.mock(LifecycleOwner::class.java)
