diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/preferences/AppearanceSettingsFragment.kt b/AnkiDroid/src/main/java/com/ichi2/anki/preferences/AppearanceSettingsFragment.kt
index 0739eae19c31..a9d371c4709f 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/preferences/AppearanceSettingsFragment.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/preferences/AppearanceSettingsFragment.kt
@@ -27,6 +27,8 @@ import com.ichi2.anki.snackbar.showSnackbar
 import com.ichi2.libanki.Utils
 import com.ichi2.themes.Theme
 import com.ichi2.themes.Themes
+import com.ichi2.themes.Themes.systemIsInNightMode
+import com.ichi2.themes.Themes.updateCurrentTheme
 import timber.log.Timber
 import java.io.File
 import java.io.FileInputStream
@@ -97,7 +99,7 @@ class AppearanceSettingsFragment : SettingsFragment() {
             if (newValue != appThemePref.value) {
                 val previousThemeId = Themes.currentTheme.id
                 appThemePref.value = newValue.toString()
-                Themes.updateCurrentTheme()
+                updateCurrentTheme(requireContext())
 
                 if (previousThemeId != Themes.currentTheme.id) {
                     requireActivity().recreate()
@@ -106,17 +108,13 @@ class AppearanceSettingsFragment : SettingsFragment() {
         }
 
         dayThemePref.setOnPreferenceChangeListener { newValue ->
-            if (newValue != dayThemePref.value && !Themes.systemIsInNightMode && newValue != Themes.currentTheme.id) {
-                dayThemePref.value = newValue.toString()
-                Themes.updateCurrentTheme()
+            if (newValue != dayThemePref.value && !systemIsInNightMode(requireContext()) && newValue != Themes.currentTheme.id) {
                 requireActivity().recreate()
             }
         }
 
         nightThemePref.setOnPreferenceChangeListener { newValue ->
-            if (newValue != nightThemePref.value && Themes.systemIsInNightMode && newValue != Themes.currentTheme.id) {
-                nightThemePref.value = newValue.toString()
-                Themes.updateCurrentTheme()
+            if (newValue != nightThemePref.value && systemIsInNightMode(requireContext()) && newValue != Themes.currentTheme.id) {
                 requireActivity().recreate()
             }
         }
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt b/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt
index 1a91b6fcce7f..06269b11f0cd 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/servicelayer/PreferenceUpgradeService.kt
@@ -32,7 +32,6 @@ import com.ichi2.anki.reviewer.CardSide
 import com.ichi2.anki.reviewer.FullScreenMode
 import com.ichi2.anki.reviewer.MappableBinding
 import com.ichi2.libanki.Consts
-import com.ichi2.themes.Themes
 import com.ichi2.utils.HashUtil.HashSetInit
 import timber.log.Timber
 import java.util.*
@@ -353,9 +352,6 @@ object PreferenceUpgradeService {
                     }
                     remove("invertedColors")
                 }
-                if (AnkiDroidApp.isInitialized) {
-                    Themes.updateCurrentTheme()
-                }
             }
         }
 
diff --git a/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt b/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt
index da54a6d4c330..62adabf85a3a 100644
--- a/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/themes/Themes.kt
@@ -19,6 +19,7 @@
 package com.ichi2.themes
 
 import android.content.Context
+import android.content.SharedPreferences
 import android.content.res.Configuration
 import androidx.annotation.AttrRes
 import androidx.annotation.ColorInt
@@ -26,6 +27,8 @@ import androidx.core.content.ContextCompat
 import androidx.fragment.app.Fragment
 import com.ichi2.anki.AnkiDroidApp
 import com.ichi2.anki.R
+import com.ichi2.ui.AppCompatPreferenceActivity
+import timber.log.Timber
 
 /**
  * Helper methods to configure things related to AnkiDroid's themes
@@ -40,12 +43,10 @@ object Themes {
     private const val NIGHT_THEME_KEY = "nightTheme"
 
     var currentTheme: Theme = Theme.fallback
-    var systemIsInNightMode: Boolean = false
 
-    /**
-     * Sets theme to [currentTheme]
-     */
     fun setTheme(context: Context) {
+        updateCurrentTheme(context)
+        Timber.i("Setting theme to %s", currentTheme.name)
         context.setTheme(currentTheme.resId)
     }
 
@@ -59,11 +60,18 @@ object Themes {
      * on `Day` or `Night` theme according to system's current mode
      * Otherwise, updates to the selected theme.
      */
-    fun updateCurrentTheme() {
-        val prefs = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.instance.applicationContext)
+    fun updateCurrentTheme(context: Context) {
+        // AppCompatPreferenceActivity's sharedPreferences is initialized
+        // after the time when the theme should be set
+        // TODO (#5019): always use the context as the parameter for getSharedPrefs
+        val prefs = if (context is AppCompatPreferenceActivity<*>) {
+            AnkiDroidApp.getSharedPrefs(AnkiDroidApp.instance)
+        } else {
+            AnkiDroidApp.getSharedPrefs(context)
+        }
 
-        currentTheme = if (themeFollowsSystem()) {
-            if (systemIsInNightMode) {
+        currentTheme = if (themeFollowsSystem(prefs)) {
+            if (systemIsInNightMode(context)) {
                 Theme.ofId(prefs.getString(NIGHT_THEME_KEY, Theme.BLACK.id)!!)
             } else {
                 Theme.ofId(prefs.getString(DAY_THEME_KEY, Theme.LIGHT.id)!!)
@@ -73,23 +81,6 @@ object Themes {
         }
     }
 
-    enum class ThemeChanged { Yes, No }
-
-    fun updateCurrentThemeByUiMode(uiMode: Int): ThemeChanged {
-        val systemIsInNightMode =
-            uiMode and Configuration.UI_MODE_NIGHT_MASK == Configuration.UI_MODE_NIGHT_YES
-
-        if (Themes.systemIsInNightMode != systemIsInNightMode) {
-            Themes.systemIsInNightMode = systemIsInNightMode
-            if (themeFollowsSystem()) {
-                updateCurrentTheme()
-                return ThemeChanged.Yes
-            }
-        }
-
-        return ThemeChanged.No
-    }
-
     /**
      * #8150: Fix icons not appearing in Note Editor due to MIUI 12's "force dark" mode
      */
@@ -141,8 +132,12 @@ object Themes {
     /**
      * @return if current selected theme is `Follow system`
      */
-    fun themeFollowsSystem(): Boolean {
-        val prefs = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.instance.applicationContext)
-        return prefs.getString(APP_THEME_KEY, FOLLOW_SYSTEM_MODE) == FOLLOW_SYSTEM_MODE
+    private fun themeFollowsSystem(sharedPreferences: SharedPreferences): Boolean {
+        return sharedPreferences.getString(APP_THEME_KEY, FOLLOW_SYSTEM_MODE) == FOLLOW_SYSTEM_MODE
+    }
+
+    fun systemIsInNightMode(context: Context): Boolean {
+        return context.resources.configuration.uiMode and Configuration.UI_MODE_NIGHT_MASK ==
+            Configuration.UI_MODE_NIGHT_YES
     }
 }
