diff --git a/AnkiDroid/src/main/AndroidManifest.xml b/AnkiDroid/src/main/AndroidManifest.xml
index fce8900af1f8..e0f41b55054a 100644
--- a/AnkiDroid/src/main/AndroidManifest.xml
+++ b/AnkiDroid/src/main/AndroidManifest.xml
@@ -275,7 +275,6 @@
             />
         <activity
             android:name="com.ichi2.anki.StudyOptionsActivity"
-            android:label="StudyOptions"
             android:exported="false"
             android:configChanges="keyboardHidden|orientation|screenSize"
             android:parentActivityName=".DeckPicker"
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.kt b/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.kt
index 3d8bc2d50745..1b3ec8821bc6 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.kt
@@ -493,6 +493,7 @@ open class DeckPicker :
         }
 
         setContentView(R.layout.homescreen)
+        enableToolbar()
         handleStartup()
         val mainView = findViewById<View>(android.R.id.content)
 
@@ -852,15 +853,11 @@ open class DeckPicker :
         }
         toolbarSearchView?.maxWidth = Integer.MAX_VALUE
 
-        if (fragmented && studyoptionsFrame!!.visibility == View.VISIBLE) {
-            menu.setGroupVisible(R.id.commonItems, false)
-        } else {
-            menu.findItem(R.id.action_export_collection)?.title = TR.actionsExport()
-            setupMediaSyncMenuItem(menu)
-            // redraw menu synchronously to avoid flicker
-            updateMenuFromState(menu)
-            updateSearchVisibilityFromState(menu)
-        }
+        menu.findItem(R.id.action_export_collection)?.title = TR.actionsExport()
+        setupMediaSyncMenuItem(menu)
+        // redraw menu synchronously to avoid flicker
+        updateMenuFromState(menu)
+        updateSearchVisibilityFromState(menu)
         // ...then launch a task to possibly update the visible icons.
         // Store the job so that tests can easily await it. In the future
         // this may be better done by injecting a custom test scheduler
@@ -875,6 +872,13 @@ open class DeckPicker :
         return super.onCreateOptionsMenu(menu)
     }
 
+    override fun onPrepareOptionsMenu(menu: Menu): Boolean {
+        menu.findItem(R.id.action_custom_study)?.setShowAsAction(
+            if (fragmented) MenuItem.SHOW_AS_ACTION_ALWAYS else MenuItem.SHOW_AS_ACTION_NEVER
+        )
+        return super.onPrepareOptionsMenu(menu)
+    }
+
     fun setupMediaSyncMenuItem(menu: Menu) {
         // shouldn't be necessary, but `invalidateOptionsMenu()` is called way more than necessary
         syncMediaProgressJob?.cancel()
@@ -1080,6 +1084,20 @@ open class DeckPicker :
                 showDatabaseErrorDialog(DatabaseErrorDialogType.DIALOG_CONFIRM_RESTORE_BACKUP)
                 return true
             }
+            R.id.action_deck_rename -> {
+                launchCatchingTask {
+                    val targetDeckId = withCol { decks.selected() }
+                    renameDeckDialog(targetDeckId)
+                }
+                return true
+            }
+            R.id.action_deck_delete -> {
+                launchCatchingTask {
+                    val targetDeckId = withCol { decks.selected() }
+                    confirmDeckDeletion(targetDeckId)
+                }
+                return true
+            }
             R.id.action_export_collection -> {
                 Timber.i("DeckPicker:: Export menu item selected")
                 ExportDialogFragment.newInstance().show(supportFragmentManager, "exportDialog")
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsActivity.kt b/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsActivity.kt
index 09314d19b31f..d4c6bde2106a 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsActivity.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsActivity.kt
@@ -15,17 +15,33 @@
  ****************************************************************************************/
 package com.ichi2.anki
 
+import android.content.Intent
 import android.os.Bundle
+import android.view.Menu
 import android.view.MenuItem
+import androidx.core.view.MenuItemCompat
 import androidx.fragment.app.commit
+import androidx.lifecycle.lifecycleScope
+import anki.collection.OpChanges
+import com.ichi2.anki.CollectionManager.withCol
 import com.ichi2.anki.StudyOptionsFragment.StudyOptionsListener
 import com.ichi2.anki.dialogs.customstudy.CustomStudyDialog.CustomStudyListener
 import com.ichi2.anki.dialogs.customstudy.CustomStudyDialogFactory
+import com.ichi2.libanki.ChangeManager
+import com.ichi2.ui.RtlCompliantActionProvider
 import com.ichi2.utils.ExtendedFragmentFactory
 import com.ichi2.widget.WidgetStatus
+import kotlinx.coroutines.launch
 import timber.log.Timber
 
-class StudyOptionsActivity : AnkiActivity(), StudyOptionsListener, CustomStudyListener {
+class StudyOptionsActivity :
+    AnkiActivity(),
+    StudyOptionsListener,
+    CustomStudyListener,
+    ChangeManager.Subscriber {
+
+    private var undoState = UndoState()
+
     override fun onCreate(savedInstanceState: Bundle?) {
         if (showedActivityFailedScreen(savedInstanceState)) {
             return
@@ -34,6 +50,7 @@ class StudyOptionsActivity : AnkiActivity(), StudyOptionsListener, CustomStudyLi
         customStudyDialogFactory.attachToActivity<ExtendedFragmentFactory>(this)
         super.onCreate(savedInstanceState)
         setContentView(R.layout.studyoptions)
+        enableToolbar().apply { title = "" }
         if (savedInstanceState == null) {
             loadStudyOptionsFragment()
         }
@@ -53,12 +70,36 @@ class StudyOptionsActivity : AnkiActivity(), StudyOptionsListener, CustomStudyLi
     private val currentFragment: StudyOptionsFragment?
         get() = supportFragmentManager.findFragmentById(R.id.studyoptions_frame) as StudyOptionsFragment?
 
+    override fun onCreateOptionsMenu(menu: Menu): Boolean {
+        menuInflater.inflate(R.menu.activity_study_options, menu)
+        val undoMenuItem = menu.findItem(R.id.action_undo)
+        val undoActionProvider = MenuItemCompat.getActionProvider(undoMenuItem) as? RtlCompliantActionProvider
+        // Set the proper click target for the undo button's ActionProvider
+        undoActionProvider?.clickHandler = { _, menuItem -> onOptionsItemSelected(menuItem) }
+        undoMenuItem.isVisible = undoState.hasAction
+        undoMenuItem.title = undoState.label
+        return true
+    }
+
     override fun onOptionsItemSelected(item: MenuItem): Boolean {
-        if (item.itemId == android.R.id.home) {
-            closeStudyOptions()
-            return true
+        return when (item.itemId) {
+            android.R.id.home -> {
+                closeStudyOptions()
+                true
+            }
+            R.id.action_undo -> {
+                launchCatchingTask {
+                    undoAndShowSnackbar()
+                    // TODO why are we going to the Reviewer from here? Desktop doesn't do this
+                    Intent(this@StudyOptionsActivity, Reviewer::class.java)
+                        .apply { flags = Intent.FLAG_ACTIVITY_FORWARD_RESULT }
+                        .also { startActivity(it) }
+                    finish()
+                }
+                true
+            }
+            else -> return super.onOptionsItemSelected(item)
         }
-        return super.onOptionsItemSelected(item)
     }
 
     private fun closeStudyOptions(result: Int = RESULT_OK) {
@@ -75,6 +116,11 @@ class StudyOptionsActivity : AnkiActivity(), StudyOptionsListener, CustomStudyLi
         super.onBackPressed()
     }
 
+    override fun onResume() {
+        super.onResume()
+        refreshUndoState()
+    }
+
     public override fun onStop() {
         super.onStop()
         if (colIsOpenUnsafe()) {
@@ -98,4 +144,28 @@ class StudyOptionsActivity : AnkiActivity(), StudyOptionsListener, CustomStudyLi
         // Sched needs to be reset so provide true argument
         currentFragment!!.refreshInterface()
     }
+
+    override fun opExecuted(changes: OpChanges, handler: Any?) {
+        refreshUndoState()
+    }
+
+    private fun refreshUndoState() {
+        lifecycleScope.launch {
+            val newUndoState = withCol {
+                UndoState(
+                    hasAction = undoAvailable(),
+                    label = undoLabel()
+                )
+            }
+            if (undoState != newUndoState) {
+                undoState = newUndoState
+                invalidateOptionsMenu()
+            }
+        }
+    }
+
+    private data class UndoState(
+        val hasAction: Boolean = false,
+        val label: String? = null
+    )
 }
diff --git a/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsFragment.kt b/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsFragment.kt
index eaf7848d1f82..5f9a0e61aba2 100644
--- a/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsFragment.kt
+++ b/AnkiDroid/src/main/java/com/ichi2/anki/StudyOptionsFragment.kt
@@ -20,6 +20,8 @@ import android.os.Bundle
 import android.text.Spanned
 import android.text.method.LinkMovementMethod
 import android.view.LayoutInflater
+import android.view.Menu
+import android.view.MenuInflater
 import android.view.MenuItem
 import android.view.View
 import android.view.ViewGroup
@@ -28,32 +30,32 @@ import android.widget.TextView
 import androidx.activity.result.ActivityResult
 import androidx.activity.result.contract.ActivityResultContracts
 import androidx.annotation.VisibleForTesting
-import androidx.appcompat.content.res.AppCompatResources
-import androidx.appcompat.widget.Toolbar
 import androidx.constraintlayout.widget.Group
 import androidx.core.text.HtmlCompat
-import androidx.core.view.MenuItemCompat
+import androidx.core.view.MenuProvider
 import androidx.core.view.isVisible
 import androidx.fragment.app.Fragment
+import androidx.lifecycle.Lifecycle
+import androidx.lifecycle.lifecycleScope
 import anki.collection.OpChanges
 import com.ichi2.anki.CollectionManager.TR
 import com.ichi2.anki.CollectionManager.withCol
 import com.ichi2.anki.dialogs.customstudy.CustomStudyDialog
 import com.ichi2.anki.snackbar.showSnackbar
 import com.ichi2.anki.utils.ext.description
-import com.ichi2.annotations.NeedsTest
 import com.ichi2.libanki.ChangeManager
 import com.ichi2.libanki.Collection
 import com.ichi2.libanki.Decks
 import com.ichi2.libanki.Utils
-import com.ichi2.ui.RtlCompliantActionProvider
 import com.ichi2.utils.FragmentFactoryUtils.instantiate
 import com.ichi2.utils.HtmlUtils.convertNewlinesToHtml
 import kotlinx.coroutines.Job
+import kotlinx.coroutines.delay
+import kotlinx.coroutines.launch
 import org.intellij.lang.annotations.Language
 import timber.log.Timber
 
-class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMenuItemClickListener {
+class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, MenuProvider {
     /**
      * Preferences
      */
@@ -82,14 +84,8 @@ class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMen
     private lateinit var learningBuryText: TextView
     private lateinit var reviewCountText: TextView
     private lateinit var reviewBuryText: TextView
-    private var toolbar: Toolbar? = null
 
-    private var createMenuJob: Job? = null
-
-    /** Current activity.*/
-    // TODO: nullability is temporary while #17284 is being diagnosed
-    private val deckPicker: DeckPicker?
-        get() = requireActivity() as? DeckPicker
+    private var retryMenuRefreshJob: Job? = null
 
     // Flag to indicate if the fragment should load the deck options immediately after it loads
     private var loadWithDeckOptions = false
@@ -146,28 +142,26 @@ class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMen
         }
     }
 
-    /** Executes [action] if [DeckPicker] is not null, otherwise report the calling site **/
-    private inline fun DeckPicker?.executeDeckAction(actionName: String, action: DeckPicker.() -> Unit) {
-        this?.action() ?: CrashReportService.sendExceptionReport("Failed to $actionName: deckPicker is null", "StudyOptionsFragment")
-    }
-
     override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {
         Timber.i("onCreateView()")
         val studyOptionsView = inflater.inflate(R.layout.studyoptions_fragment, container, false)
         this.studyOptionsView = studyOptionsView
         fragmented = requireActivity().javaClass != StudyOptionsActivity::class.java
         initAllContentViews(studyOptionsView)
-        toolbar = studyOptionsView.findViewById(R.id.studyOptionsToolbar)
-        if (toolbar != null) {
-            toolbar!!.inflateMenu(R.menu.deck_picker)
-            toolbar!!.inflateMenu(R.menu.study_options_fragment)
-            configureToolbar()
-        }
         refreshInterface()
         ChangeManager.subscribe(this)
         return studyOptionsView
     }
 
+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
+        super.onViewCreated(view, savedInstanceState)
+        requireActivity().addMenuProvider(this, viewLifecycleOwner, Lifecycle.State.RESUMED)
+    }
+
+    override fun onCreateMenu(menu: Menu, menuInflater: MenuInflater) {
+        menuInflater.inflate(R.menu.study_options_fragment, menu)
+    }
+
     override fun onDestroy() {
         super.onDestroy()
         if (fullNewCountThread != null) {
@@ -245,16 +239,8 @@ class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMen
         ankiActivity.showDialogFragment(contextMenu)
     }
 
-    override fun onMenuItemClick(item: MenuItem): Boolean {
+    override fun onMenuItemSelected(item: MenuItem): Boolean {
         when (item.itemId) {
-            R.id.action_undo_study_options -> {
-                Timber.i("StudyOptionsFragment:: Undo button pressed")
-                launchCatchingTask {
-                    requireActivity().undoAndShowSnackbar()
-                    openReviewer()
-                }
-                return true
-            }
             R.id.action_deck_or_study_options -> {
                 Timber.i("StudyOptionsFragment:: Deck or study options button pressed")
                 if (col!!.decks.isFiltered(col!!.decks.selected())) {
@@ -290,26 +276,7 @@ class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMen
                 launchCatchingTask { emptyCram() }
                 return true
             }
-            R.id.action_rename -> {
-                deckPicker.executeDeckAction("rename deck") {
-                    renameDeckDialog(col!!.decks.selected())
-                }
-                return true
-            }
-            R.id.action_delete -> {
-                deckPicker.executeDeckAction("delete deck") {
-                    confirmDeckDeletion(col!!.decks.selected())
-                }
-                return true
-            }
-            R.id.action_export_deck -> {
-                deckPicker.executeDeckAction("export deck") {
-                    exportDeck(col!!.decks.selected())
-                }
-                return true
-            }
-            // If the menu item is not specific to study options, delegate it to the deck picker
-            else -> return deckPicker?.onOptionsItemSelected(item) ?: false
+            else -> return false
         }
     }
 
@@ -337,17 +304,13 @@ class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMen
     }
 
     private fun configureToolbar() {
-        configureToolbarInternal(true)
+        activity?.invalidateMenu()
     }
 
-    // This will allow a maximum of one recur in order to workaround database closes
-    // caused by sync on startup where this might be running then have the collection close
-    @NeedsTest("test whether the navigationIcon and navigationOnClickListener are set properly")
-    private fun configureToolbarInternal(recur: Boolean) {
+    override fun onPrepareMenu(menu: Menu) {
+        super.onPrepareMenu(menu)
         Timber.i("configureToolbarInternal()")
         try {
-            toolbar!!.setOnMenuItemClickListener(this)
-            val menu = toolbar!!.menu
             // Switch on or off rebuild/empty/custom study depending on whether or not filtered deck
             if (col != null && col!!.decks.isFiltered(col!!.decks.selected())) {
                 menu.findItem(R.id.action_rebuild).isVisible = true
@@ -364,80 +327,21 @@ class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMen
             if (currentContentView == CONTENT_CONGRATS) {
                 menu.findItem(R.id.action_custom_study).isVisible = false
             }
-            // Switch on rename / delete / export if tablet layout
-            if (fragmented) {
-                menu.setGroupVisible(R.id.commonItems, true)
-                menu.findItem(R.id.action_rename).isVisible = true
-                menu.findItem(R.id.action_delete).isVisible = true
-                menu.findItem(R.id.action_export).isVisible = true
-                menu.findItem(R.id.action_export).title = TR.actionsExport()
-                /**
-                 * Add "export collection" item in the export menu and remove it from the main menu.
-                 * The "export collection" action appears in the menu directly when we only display the deck picker.
-                 * When we display the split view, we want to move it to a submenu that already contains "export deck".
-                 */
-                val exportMenu = menu.findItem(R.id.action_export).subMenu
-                if (exportMenu?.findItem(R.id.action_export_collection) == null) {
-                    exportMenu?.add(0, R.id.action_export_collection, 0, R.string.export_collection)
-                }
-                menu.removeItem(R.id.action_export_collection)
-
-                deckPicker.executeDeckAction("configureToolbarInternal:: unable to set up menu items") {
-                    setupMediaSyncMenuItem(menu)
-                    updateMenuFromState(menu)
-
-                    /**
-                     * Launch a task to possibly update the visible icons.
-                     * Save the job in a member variable to manage the lifecycle
-                     */
-                    createMenuJob = launchCatchingTask {
-                        updateMenuState()
-                        updateMenuFromState(menu)
-                    }
-                }
-            } else {
-                menu.setGroupVisible(R.id.commonItems, false)
-                menu.findItem(R.id.action_rename).isVisible = false
-                menu.findItem(R.id.action_delete).isVisible = false
-                menu.findItem(R.id.action_export).isVisible = false
-            }
             // Switch on or off unbury depending on if there are cards to unbury
             menu.findItem(R.id.action_unbury).isVisible = col != null && col!!.sched.haveBuried()
-            // Set the proper click target for the undo button's ActionProvider
-            val undoActionProvider: RtlCompliantActionProvider? = MenuItemCompat.getActionProvider(
-                menu.findItem(R.id.action_undo_study_options)
-            ) as? RtlCompliantActionProvider
-            undoActionProvider?.clickHandler = { _, menuItem -> onMenuItemClick(menuItem) }
-            // Switch on or off undo depending on whether undo is available
-            if (col == null || !col!!.undoAvailable()) {
-                menu.findItem(R.id.action_undo_study_options).isVisible = false
-            } else {
-                menu.findItem(R.id.action_undo_study_options).isVisible = true
-                menu.findItem(R.id.action_undo_study_options).title = col?.undoLabel()
-            }
-            // Set the back button listener
-            if (fragmented) {
-                // when the fragment is attached to deck picker on large screen, the "back" button had no purpose, so it should be removed
-                toolbar!!.navigationIcon = null
-            } else {
-                val icon = AppCompatResources.getDrawable(requireContext(), R.drawable.ic_arrow_back_white)
-                icon!!.isAutoMirrored = true
-                toolbar!!.navigationIcon = icon
-                toolbar!!.setNavigationOnClickListener { (activity as AnkiActivity).finish() }
-            }
         } catch (e: IllegalStateException) {
             if (!CollectionManager.isOpenUnsafe()) {
-                if (recur) {
-                    Timber.i(e, "Database closed while working. Probably auto-sync. Will re-try after sleep.")
-                    try {
-                        Thread.sleep(1000)
-                    } catch (ex: InterruptedException) {
-                        Timber.i(ex, "Thread interrupted while waiting to retry. Likely unimportant.")
-                        Thread.currentThread().interrupt()
-                    }
-                    configureToolbarInternal(false)
-                } else {
-                    Timber.w(e, "Database closed while working. No re-tries left.")
+                // This will allow a maximum of one invalidate menu attempt in order to workaround
+                // database closes caused by sync on startup where this might be running then have
+                // the collection close
+                Timber.i(e, "Database closed while working. Probably auto-sync. Will re-try after sleep.")
+                if (retryMenuRefreshJob != null) {
+                    return // we already are doing a refresh, so abort to avoid entering an endless loop
+                }
+                retryMenuRefreshJob = viewLifecycleOwner.lifecycleScope.launch {
+                    delay(1000)
+                    retryMenuRefreshJob = null
+                    activity?.invalidateMenu()
                 }
             }
         }
@@ -453,11 +357,7 @@ class StudyOptionsFragment : Fragment(), ChangeManager.Subscriber, Toolbar.OnMen
         }
 
         Timber.d("Handling onActivityResult for StudyOptionsFragment (openReview, resultCode = %d)", result.resultCode)
-        if (toolbar != null) {
-            configureToolbar() // FIXME we were crashing here because mToolbar is null #8913
-        } else {
-            CrashReportService.sendExceptionReport("mToolbar null after return from tablet review session? Issue 8913", "StudyOptionsFragment")
-        }
+        configureToolbar()
         if (result.resultCode == DeckPicker.RESULT_DB_ERROR || result.resultCode == DeckPicker.RESULT_MEDIA_EJECTED) {
             closeStudyOptions(result.resultCode)
             return@registerForActivityResult
diff --git a/AnkiDroid/src/main/res/layout-xlarge/homescreen.xml b/AnkiDroid/src/main/res/layout-xlarge/homescreen.xml
index 56185eaa4618..5fb3d6fe7c6d 100644
--- a/AnkiDroid/src/main/res/layout-xlarge/homescreen.xml
+++ b/AnkiDroid/src/main/res/layout-xlarge/homescreen.xml
@@ -2,6 +2,13 @@
 <androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
     android:layout_width="match_parent"
     android:layout_height="match_parent">
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"
+        android:orientation="vertical">
+
+        <include layout="@layout/toolbar" />
+
         <LinearLayout
             android:id="@+id/deckpicker_xl_view"
             android:layout_width="match_parent"
@@ -18,5 +25,6 @@
                 android:layout_width="1dip"
                 android:layout_height="match_parent"/>
         </LinearLayout>
+    </LinearLayout>
 </androidx.coordinatorlayout.widget.CoordinatorLayout>
 
diff --git a/AnkiDroid/src/main/res/layout/deck_picker.xml b/AnkiDroid/src/main/res/layout/deck_picker.xml
index 0b14053aa497..1d31f141cfad 100644
--- a/AnkiDroid/src/main/res/layout/deck_picker.xml
+++ b/AnkiDroid/src/main/res/layout/deck_picker.xml
@@ -16,8 +16,6 @@
         android:layout_height="match_parent"
         android:orientation="vertical" >
 
-        <include layout="@layout/toolbar" />
-
         <androidx.swiperefreshlayout.widget.SwipeRefreshLayout
             android:id="@+id/pull_to_sync_wrapper"
             android:layout_width="match_parent"
diff --git a/AnkiDroid/src/main/res/layout/homescreen.xml b/AnkiDroid/src/main/res/layout/homescreen.xml
index 46b2f9877bb5..e309b0069856 100644
--- a/AnkiDroid/src/main/res/layout/homescreen.xml
+++ b/AnkiDroid/src/main/res/layout/homescreen.xml
@@ -2,5 +2,13 @@
 <androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
     android:layout_width="match_parent"
     android:layout_height="match_parent">
-    <include layout="@layout/deck_picker" />
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"
+        android:orientation="vertical">
+
+        <include layout="@layout/toolbar" />
+
+        <include layout="@layout/deck_picker" />
+    </LinearLayout>
 </androidx.coordinatorlayout.widget.CoordinatorLayout>
diff --git a/AnkiDroid/src/main/res/layout/studyoptions.xml b/AnkiDroid/src/main/res/layout/studyoptions.xml
index e8ac958d4102..a28f4d4c0f32 100644
--- a/AnkiDroid/src/main/res/layout/studyoptions.xml
+++ b/AnkiDroid/src/main/res/layout/studyoptions.xml
@@ -7,6 +7,9 @@
                 android:layout_width="match_parent"
                 android:layout_height="match_parent"
                 android:orientation="vertical">
+
+                <include layout="@layout/toolbar" />
+
                 <FrameLayout
                     android:id="@+id/studyoptions_frame"
                     android:layout_width="match_parent"
diff --git a/AnkiDroid/src/main/res/layout/studyoptions_fragment.xml b/AnkiDroid/src/main/res/layout/studyoptions_fragment.xml
index 589f160c7174..a6b380f936be 100644
--- a/AnkiDroid/src/main/res/layout/studyoptions_fragment.xml
+++ b/AnkiDroid/src/main/res/layout/studyoptions_fragment.xml
@@ -8,24 +8,11 @@
     <androidx.constraintlayout.widget.ConstraintLayout
         android:layout_width="match_parent"
         android:layout_height="match_parent">
-        <androidx.appcompat.widget.Toolbar
-            android:id="@+id/studyOptionsToolbar"
-            android:layout_width="match_parent"
-            android:layout_height="wrap_content"
-            android:minHeight="?attr/actionBarSize"
-            android:theme="@style/ActionBarStyle"
-            app:layout_constraintTop_toTopOf="parent"
-            app:layout_constraintStart_toStartOf="parent"
-            app:layout_constraintEnd_toEndOf="parent"
-            android:background="?attr/appBarColor"
-            app:popupTheme="@style/ActionBar.Popup"
-            app:navigationContentDescription="@string/abc_action_bar_up_description"
-            app:navigationIcon="?attr/homeAsUpIndicator"/>
         <View
             android:id="@+id/studyoptions_gradient"
             android:layout_width="15dp"
             android:layout_height="0dp"
-            app:layout_constraintTop_toBottomOf="@id/studyOptionsToolbar"
+            app:layout_constraintTop_toTopOf="parent"
             app:layout_constraintStart_toStartOf="parent"
             android:background="@drawable/shadow_left"
             android:visibility="gone"/>
@@ -46,7 +33,7 @@
             android:layout_above="@id/bottom_area_layout"
             android:layout_width="0dp"
             android:layout_height="0dp"
-            app:layout_constraintTop_toBottomOf="@id/studyOptionsToolbar"
+            app:layout_constraintTop_toTopOf="parent"
             app:layout_constraintStart_toEndOf="@id/studyoptions_gradient"
             app:layout_constraintEnd_toEndOf="parent"
             app:layout_constraintBottom_toTopOf="@id/studyoptions_start"
diff --git a/AnkiDroid/src/main/res/menu-xlarge/deck_picker.xml b/AnkiDroid/src/main/res/menu-xlarge/deck_picker.xml
new file mode 100644
index 000000000000..36973def2b06
--- /dev/null
+++ b/AnkiDroid/src/main/res/menu-xlarge/deck_picker.xml
@@ -0,0 +1,67 @@
+<menu xmlns:tools="http://schemas.android.com/tools"
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto">
+    <item
+        android:id="@+id/deck_picker_action_filter"
+        android:icon="@drawable/ic_search_white"
+        android:title="@string/search_decks"
+        android:visible="false"
+        app:actionViewClass="com.ichi2.ui.AccessibleSearchView"
+        app:showAsAction="always|collapseActionView"/>
+    <item
+        android:id="@+id/action_sync"
+        android:icon="@drawable/ic_sync"
+        android:title="@string/button_sync"
+        app:actionProviderClass="com.ichi2.anki.SyncActionProvider"
+        app:showAsAction="always"/>
+    <item
+        android:id="@+id/action_deck_rename"
+        android:icon="@drawable/ic_popup_menu_item_editor"
+        android:title="@string/rename_deck"
+        app:showAsAction="always"/>
+    <item
+        android:id="@+id/action_deck_delete"
+        android:icon="@drawable/ic_delete_white"
+        android:title="@string/delete_deck"
+        app:showAsAction="always"/>
+    <item
+        android:id="@+id/action_undo"
+        android:icon="@drawable/ic_undo_white"
+        app:showAsAction="never"
+        android:visible="false"
+        tools:title="Undo X"/>
+    <item
+        android:id="@+id/checks"
+        android:title="@string/checks_action"
+        app:showAsAction="never">
+        <menu>
+            <item
+                android:id="@+id/action_check_database"
+                android:menuCategory="secondary"
+                android:title="@string/check_db"/>
+            <item
+                android:id="@+id/action_check_media"
+                android:menuCategory="secondary"
+                android:title="@string/check_media"/>
+            <item
+                android:id="@+id/action_empty_cards"
+                android:menuCategory="secondary"
+                android:title="@string/empty_cards"/>
+        </menu>
+    </item>
+    <item
+        android:id="@+id/action_restore_backup"
+        android:menuCategory="secondary"
+        android:title="@string/backup_restore"/>
+    <item
+        android:id="@+id/action_model_browser_open"
+        android:menuCategory="secondary"
+        android:title="@string/model_browser_label"/>
+    <item
+        android:id="@+id/action_import"
+        android:menuCategory="secondary"
+        android:title="@string/menu_import"/>
+    <item
+        android:id="@+id/action_export_collection"
+        android:menuCategory="secondary" />
+</menu>
diff --git a/AnkiDroid/src/main/res/menu/activity_study_options.xml b/AnkiDroid/src/main/res/menu/activity_study_options.xml
new file mode 100644
index 000000000000..93505191d100
--- /dev/null
+++ b/AnkiDroid/src/main/res/menu/activity_study_options.xml
@@ -0,0 +1,10 @@
+<?xml version="1.0" encoding="utf-8"?>
+<menu xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto">
+    <item
+        android:id="@+id/action_undo"
+        android:icon="@drawable/ic_undo_white"
+        android:title="@string/undo"
+        app:actionProviderClass="com.ichi2.ui.RtlCompliantActionProvider"
+        app:showAsAction="always"/>
+</menu>
\ No newline at end of file
diff --git a/AnkiDroid/src/main/res/menu/deck_picker.xml b/AnkiDroid/src/main/res/menu/deck_picker.xml
index 07824e35be6a..3b1523074b65 100644
--- a/AnkiDroid/src/main/res/menu/deck_picker.xml
+++ b/AnkiDroid/src/main/res/menu/deck_picker.xml
@@ -9,51 +9,49 @@
         android:visible="false"
         ankidroid:actionViewClass="com.ichi2.ui.AccessibleSearchView"
         ankidroid:showAsAction="always|collapseActionView"/>
-    <group android:id="@+id/commonItems">
-        <item
-            android:id="@+id/action_sync"
-            android:icon="@drawable/ic_sync"
-            android:title="@string/button_sync"
-            ankidroid:actionProviderClass="com.ichi2.anki.SyncActionProvider"
-            ankidroid:showAsAction="always"/>
-        <item
-            android:id="@+id/action_undo"
-            ankidroid:showAsAction="never"
-            android:visible="false"
-            tools:title="Undo X"/>
-        <item
-            android:id="@+id/checks"
-            android:title="@string/checks_action"
-            ankidroid:showAsAction="never">
-            <menu>
-                <item
-                    android:id="@+id/action_check_database"
-                    android:menuCategory="secondary"
-                    android:title="@string/check_db"/>
-                <item
-                    android:id="@+id/action_check_media"
-                    android:menuCategory="secondary"
-                    android:title="@string/check_media"/>
-                <item
-                    android:id="@+id/action_empty_cards"
-                    android:menuCategory="secondary"
-                    android:title="@string/empty_cards"/>
-            </menu>
-        </item>
-        <item
-            android:id="@+id/action_restore_backup"
-            android:menuCategory="secondary"
-            android:title="@string/backup_restore"/>
-        <item
-            android:id="@+id/action_model_browser_open"
-            android:menuCategory="secondary"
-            android:title="@string/model_browser_label"/>
-        <item
-            android:id="@+id/action_import"
-            android:menuCategory="secondary"
-            android:title="@string/menu_import"/>
-        <item
-            android:id="@+id/action_export_collection"
-            android:menuCategory="secondary" />
-    </group>
+    <item
+        android:id="@+id/action_sync"
+        android:icon="@drawable/ic_sync"
+        android:title="@string/button_sync"
+        ankidroid:actionProviderClass="com.ichi2.anki.SyncActionProvider"
+        ankidroid:showAsAction="always"/>
+    <item
+        android:id="@+id/action_undo"
+        ankidroid:showAsAction="never"
+        android:visible="false"
+        tools:title="Undo X"/>
+    <item
+        android:id="@+id/checks"
+        android:title="@string/checks_action"
+        ankidroid:showAsAction="never">
+        <menu>
+            <item
+                android:id="@+id/action_check_database"
+                android:menuCategory="secondary"
+                android:title="@string/check_db"/>
+            <item
+                android:id="@+id/action_check_media"
+                android:menuCategory="secondary"
+                android:title="@string/check_media"/>
+            <item
+                android:id="@+id/action_empty_cards"
+                android:menuCategory="secondary"
+                android:title="@string/empty_cards"/>
+        </menu>
+    </item>
+    <item
+        android:id="@+id/action_restore_backup"
+        android:menuCategory="secondary"
+        android:title="@string/backup_restore"/>
+    <item
+        android:id="@+id/action_model_browser_open"
+        android:menuCategory="secondary"
+        android:title="@string/model_browser_label"/>
+    <item
+        android:id="@+id/action_import"
+        android:menuCategory="secondary"
+        android:title="@string/menu_import"/>
+    <item
+        android:id="@+id/action_export_collection"
+        android:menuCategory="secondary" />
 </menu>
diff --git a/AnkiDroid/src/main/res/menu/study_options_fragment.xml b/AnkiDroid/src/main/res/menu/study_options_fragment.xml
index 8e234656cfb9..dbfe9647998f 100644
--- a/AnkiDroid/src/main/res/menu/study_options_fragment.xml
+++ b/AnkiDroid/src/main/res/menu/study_options_fragment.xml
@@ -1,13 +1,5 @@
 <menu xmlns:android="http://schemas.android.com/apk/res/android"
-    xmlns:ankidroid="http://schemas.android.com/apk/res-auto"
-    xmlns:tools="http://schemas.android.com/tools">
-    <item
-        android:id="@+id/action_undo_study_options"
-        android:enabled="true"
-        android:icon="@drawable/ic_undo_white"
-        android:title="@string/undo"
-        ankidroid:actionProviderClass="com.ichi2.ui.RtlCompliantActionProvider"
-        ankidroid:showAsAction="always"/>
+    xmlns:ankidroid="http://schemas.android.com/apk/res-auto">
     <item
         android:id="@+id/action_rebuild"
         android:title="@string/rebuild_cram_label"
@@ -25,31 +17,12 @@
         android:title="@string/custom_study"
         android:icon="@drawable/ic_build_white"
         ankidroid:showAsAction="ifRoom"/>
-    <item
-        android:id="@+id/action_rename"
-        android:title="@string/rename_deck"
-        android:visibility = "gone"/>
     <!-- the title for the following option will be set dynamically -->
     <item
         android:id="@+id/action_deck_or_study_options"
         android:title="@string/menu__deck_options"
         android:icon="@drawable/ic_tune_white"
         ankidroid:showAsAction="always"/>
-    <item
-        android:id="@+id/action_delete"
-        android:title="@string/contextmenu_deckpicker_delete_deck"
-        android:visibility = "gone"/>
-    <item
-        android:id="@+id/action_export"
-        tools:text="Export"
-        android:visibility="gone">
-        <menu>
-            <item
-                android:id="@+id/action_export_deck"
-                android:menuCategory="secondary"
-                android:title="@string/export_deck" />
-        </menu>
-    </item>
     <item
         android:id="@+id/action_unbury"
         android:title="@string/unbury"
