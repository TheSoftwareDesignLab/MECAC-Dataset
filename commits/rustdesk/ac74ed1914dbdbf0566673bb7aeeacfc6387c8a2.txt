legacy mode, win, fix layout code simulation

Signed-off-by: fufesou <shuanglongchen@yeah.net>