Fix NoSuchMethodError, possible npe and improve ui