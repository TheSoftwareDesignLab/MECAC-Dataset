Fix widget update race condition