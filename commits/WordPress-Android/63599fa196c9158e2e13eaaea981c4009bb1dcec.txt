Changes to stop blocking UI thread