Cleaned up the ui state observer code.