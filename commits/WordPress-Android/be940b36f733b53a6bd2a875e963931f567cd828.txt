feat: Authenticate protected media requests on private sites (#22047)

* feat: Authenticate protected media requests on private Atomic sites

* style: Address lint warning

* Fix WordPressCookieAuthenticator to properly use CookieJar for authentication

- Use CookieJar to retrieve cookies instead of parsing response headers
- Extract cookies from jar using loadForRequest() for proper cookie management
- Add createDefaultOkHttpClient() with JavaNetCookieJar configuration
- Support both dependency injection and direct instantiation patterns
- Maintain comprehensive debug logging for cookie authentication flow

This should resolve the issue where only wordpress_test_cookie was received
by properly leveraging OkHttp's cookie management infrastructure.

* feat: Configure cookies for private WPCOM Simple sites

Ensure protected media loads.

* refactor: Address Detekt errors

* fix: Address build errors

* fix: Address build errors

* fix: Implement rudimentary okhttp3 cookie jar

Enable retrieving cookies for GutenbergKit requests.

* style: Fix lint warnings

* test: Assert WordPressCookieAuthenticator expectations

* refactor: Address lint warnings

* refactor: Remove unnecessary comments and empty lines

* refactor: Move WordPressCookieAuthenticator to WordPress module

Move WordPressCookieAuthenticator from libs:editor to WordPress/auth to enable dependency injection.

Changes:
- Move class from libs/editor to WordPress/auth package
- Update to use @Named dependency injection for OkHttpClient and CoroutineDispatcher
- Update EditPostActivity import
- Remove unused ApplicationModule providers
- Simplify tests to only include parameter validation

* Remove no longer necessary libs/editor/build.gradle dependency additions

* refactor: Extract authentication logic to ViewModel with sealed classes

Moved cookie authentication from Activity to dedicated ViewModel for better
architecture and state management.

Changes:
- Extract EditPostAuthViewModel with sealed class states
- Remove callback complexity from WordPressCookieAuthenticator
- Use coroutines and postValue() for thread safety
- Consolidate cookie logic with single source of truth
- Fix Idle state handling to prevent premature UI setup
- Use functional programming patterns for cookie processing

This improves maintainability, testability, and follows modern Android
architecture patterns with proper separation of concerns.

* refactor: Simplify cookie logic and add comprehensive unit tests

Refactor getCookiesForPrivateSites method to use cleaner when expression
that prioritizes checking if site is private first, making the logic more
readable and maintainable.

Add comprehensive unit tests for EditPostAuthViewModel covering:
- Authentication state transitions (Loading, Success, Error)
- Cookie processing for different site types (WPCom, atomic, private/public)
- Edge cases including authentication failures and missing cookies
- Cookie filtering to only include wordpress_logged_in cookies

Changes:
- Simplify conditional logic in getCookiesForPrivateSites method
- Add EditPostAuthViewModelTest with 11 comprehensive test cases
- Use mock-based approach for PrivateAtomicCookie in tests

* feat: Add caching and logout cleanup to WordPressCookieAuthenticator

- Implement cookie caching with 6-hour expiration using SharedPreferences
- Add cache invalidation on corrupted data and expired entries
- Include logout cleanup in AppInitializer to clear cached cookies
- Update logging to use API tag and specify WordPress.com account cookies
- Fix unit tests to properly mock HTTP requests instead of making real network calls
- Add comprehensive test coverage for caching scenarios, HTTP errors, and network failures

Changes:
- Add @Singleton annotation and PreferenceUtilsWrapper dependency
- Implement getCachedCookies(), cacheCookies(), clearCachedCookies(), and clearAllCachedCookies() methods
- Add cache-first logic in authenticateForCookies() with automatic caching of successful results
- Integrate clearAllCachedCookies() call in AppInitializer.removeWpComUserRelatedData()
- Replace real OkHttpClient with mocked version in tests to prevent actual network requests
- Add 3 new test cases covering successful authentication, HTTP errors, and network failures

* refactor: Extract request execution to separate method in WordPressCookieAuthenticator

- Extract HTTP request execution logic from authenticateForCookies() into performAuthenticationRequest() helper method
- Add ValidatedAuthParams data class to represent validated parameters passed to helper method
- Improve separation of concerns: main method handles validation and caching orchestration, helper method handles HTTP execution
- Maintain existing functionality with clearer code organization

Changes:
- Add ValidatedAuthParams private data class for validated parameter passing
- Create performAuthenticationRequest() method containing HTTP request logic
- Update authenticateForCookies() to validate parameters then delegate to helper method
- All tests continue to pass, confirming refactoring preserves behavior

* feat: Extend cookie cache expiration from 6 hours to 6 months

WordPress.com authentication cookies are now cached for 6 months instead of 6 hours to provide better user experience by reducing authentication requests.

* Fix flaky test that caused uncaught exceptions in CI

The test `fetchWpComCookies starts with Loading state` was causing
NoWhenBranchMatchedException to leak into other tests due to missing
mock setup for the authenticator.

The test was also fundamentally flawed because it tried to check the
Loading state immediately after calling fetchWpComCookies(), but
postValue() is asynchronous and the mocked authenticator would complete
immediately, potentially skipping the Loading state.

Changes:
- Renamed test to better reflect what it actually tests
- Added proper mock setup to prevent exception leakage
- Changed approach to observe all state changes using observeForever
- Now validates the complete flow: Loading â†’ Success states
- Uses advanceUntilIdle() for proper async test handling

---------

Co-authored-by: Oguz Kocer <oguz.kocer@automattic.com>