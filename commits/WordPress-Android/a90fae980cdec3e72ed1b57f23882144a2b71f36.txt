Remove static variables in GCM, and other minor changes, mostly to improve code readability.
Also noticed that the static version of `note_id` was also used in an expression instead of the actual value.