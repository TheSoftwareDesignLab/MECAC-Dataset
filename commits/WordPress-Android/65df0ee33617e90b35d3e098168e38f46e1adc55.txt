Adding slight optimization for layout calculation