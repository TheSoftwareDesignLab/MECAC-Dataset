use State and Mode enums for TOC mode and visibility

also fix TOC update on scroll