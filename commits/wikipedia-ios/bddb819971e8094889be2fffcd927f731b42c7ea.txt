consolidate header logic, fix layout mismatch