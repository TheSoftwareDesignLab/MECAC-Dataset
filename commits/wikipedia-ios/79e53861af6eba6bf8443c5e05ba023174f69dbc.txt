Revert "Revert "only completely re-query the layout if invalidateEverything == YES""

This reverts commit d82f8c44d9c50978673d9cc605093f4deba031f3.