rewriting progress determination to speed it up and reimplement it in the ui