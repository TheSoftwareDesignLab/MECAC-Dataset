Save widget states so we can restore them when calls fail (#1412)

* Save widget states so they can be restored if the update call fails

* Fix db crash